"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[3905],{43905:(Oe,Z,u)=>{u.r(Z),u.d(Z,{default:()=>Pe});var Q=u(85105),N=u.n(Q),C=u(99663),S=u(22600),A=u(49135),D=u(93196),n=u(67294),q=u(60022),W=u(64712),B=u(77863),O=u(96841),L=u(74127),_=u(53894),v=u(88239),ee=u(66946),G=u(54208),E=u(33867),b=u(67707);const j={getRulesWithMainTarget:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("ProjectUserRule","GetRulesWithMainTarget",e,o)},getRule:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("ProjectUserRule","GetRule",e,o)},addRule:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("ProjectUserRule","AddRule",e,o)},resetRule:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("ProjectUserRule","ResetRule",e,o)},removeRule:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("ProjectUserRule","RemoveRule",e,o)}};var U=function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return function(a,l){a({type:"UPDATE_EDITTYPW",showEdit:e,editType:o}),e&&a(t?ae(t):{type:"RULES_BY_RULEID",ruleId:"",data:[]})}},te=function(e){return function(o,t){o({type:"UPDATE_PROJECT_ID",projectId:e})}},w=function(e){return function(o,t){o({type:"ACTION_ING"}),j.getRulesWithMainTarget({projectId:e}).then(function(a){o({type:"ACTION_END"}),o({type:"RULES_ALL",data:a})})}},ne=function(e,o){return function(t,a){t({type:"ACTION_ING"}),j.removeRule({projectId:e,ruleId:o}).then(function(l){l?(alert(_l("\u5220\u9664\u6210\u529F")),t(w(e))):(t({type:"ACTION_END"}),alert(_l("\u5220\u9664\u5931\u8D25"),2))})}},ae=function(e){return function(o,t){o({type:"ACTION_ING"}),j.getRule({projectId:t().contact.projectId,ruleId:e}).then(function(a){o({type:"ACTION_END"}),o({type:"RULES_BY_RULEID",ruleId:e,data:a})})}},re=function(e){return function(o,t){o({type:"UPDATE_RULES_BY_RULEID",data:e})}},oe=function(e,o,t,a,l){return function(i,d){i({type:"ISLOADING",isSaveing:!0});var c=function(p){i({type:"ISLOADING",isSaveing:!1}),p.success?(l([]),i(U(!1)),i(w(e))):(l(p.errorIds),alert(_l(p.errorMessage||"\u5DF2\u8BBE\u7F6E\u89C4\u5219\u6210\u5458\uFF0C \u4E0D\u80FD\u91CD\u590D\u8BBE\u7F6E"),2,5e3))};t?j.resetRule({ruleId:t,projectId:e,items:o}).then(function(r){c(r)},function(){}):j.addRule({projectId:e,items:o,ruleType:a}).then(function(r){c(r)},function(){})}},le=u(45697),R=u.n(le),se=u(41143),ie=u.n(se);function de(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:s}function ce(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):s.__proto__=e)}var F=function(s){ce(e,s);function e(){return de(this,e),ue(this,s.apply(this,arguments))}return e.prototype.enable=function(t){this.unblock&&this.unblock(),this.unblock=this.context.router.history.block(t)},e.prototype.disable=function(){this.unblock&&(this.unblock(),this.unblock=null)},e.prototype.componentWillMount=function(){ie()(this.context.router,"You should not use <Prompt> outside a <Router>"),this.props.when&&this.enable(this.props.message)},e.prototype.componentWillReceiveProps=function(t){t.when?(!this.props.when||this.props.message!==t.message)&&this.enable(t.message):this.disable()},e.prototype.componentWillUnmount=function(){this.disable()},e.prototype.render=function(){return null},e}(n.Component);F.propTypes={when:R().bool,message:R().oneOfType([R().func,R().string]).isRequired},F.defaultProps={when:!0},F.contextTypes={router:R().shape({history:R().shape({block:R().func.isRequired}).isRequired}).isRequired};const pe=F;var me=u(93967),T=u.n(me),fe=u(57853),ge=u(86735),he=u(5017),ve=(0,ge.Z)([`
  display: inline-block !important;
  font-size: 0;
  line-height: 24px;
`],[`
  display: inline-block !important;
  font-size: 0;
  line-height: 24px;
`]),Ie=(0,he.ZP)(fe.Z)(ve),Y=function(s){(0,D.default)(e,s);function e(){return(0,C.default)(this,e),(0,A.default)(this,(e.__proto__||N()(e)).apply(this,arguments))}return(0,S.default)(e,[{key:"render",value:function(){var t=this.props.user,a=t===void 0?[]:t;return n.createElement(Ie,{className:"avatar",accountId:a.targetId,user:{userHead:a.peopleAvatar,accountId:a.targetId},size:24})}}]),e}(n.Component),ye=u(75809),Ee=u(60510),Re=u(27749),z=u(85997),Te=u(96486),y=u.n(Te),f={user:10,dept:20,orgRole:30},g={self:10,extra:15,whiteList:20},Ne=function(s){(0,D.default)(e,s);function e(o){(0,C.default)(this,e);var t=(0,A.default)(this,(e.__proto__||N()(e)).call(this,o));return t.updateData=function(a){var l=t.props.dispatch;l(re(a))},t.addUser=function(a,l){var i=t,d=t.props.projectId,c={unique:!1,projectId:d,filterAll:!0,filterFriend:!0,filterOthers:!0,filterOtherProject:!0,dataRange:2,callback:function(p){i.addDataFn(p,l,f.user)}};(0,ye.Z)({fromAdmin:!0,showMoreInvite:!1,SelectUserSettings:c})},t.addDept=function(a,l){var i=t.props.projectId,d=t;(0,Ee.Z)({projectId:i,unique:!1,fromAdmin:!0,selectedDepartment:[],showCreateBtn:!1,selectFn:function(r){d.addDataFn(r,l,f.dept)}})},t.addOrgRoles=function(a){var l=t.props.projectId;(0,Re.Z)({projectId:l,onSave:function(d){t.addDataFn(d,a,f.orgRole)}})},t.addDataFn=function(a,l,i){var d=t.props.dataByRuleId,c=[];y().map(a,function(r){var p={targetId:i===f.dept?r.departmentId:i===f.orgRole?r.organizeId:r.accountId,targetType:i,ruleItemType:l,targetName:i===f.dept?r.departmentName:i===f.orgRole?r.organizeName:r.fullname,peopleAvatar:i===f.user?r.avatar:""};y().find(d,function(h){return p.targetId===h.targetId&&p.targetType===h.targetType&&p.ruleItemType===h.ruleItemType})||c.push(p)}),t.updateData(d.concat(c))},t.renderRuleItem=function(a,l){var i=t.props,d=i.dataByRuleId,c=i.errorIds;return n.createElement("div",{className:T()({mBottom15:a.length})},y().map(a,function(r){return n.createElement("div",{className:T()("userItem",{active:y().includes(c,r.targetId)})},n.createElement(E.Z,{className:"Font24 Red delete Hand",icon:"cancel",onClick:function(){var h=d.filter(function(m){return!(m.targetId===r.targetId&&l===m.ruleItemType&&m.targetType===r.targetType)});t.updateData(h)}}),r.targetType===f.dept||r.targetType===f.orgRole?n.createElement(n.Fragment,null,n.createElement("span",{className:T()("depIcon",{orgRoleIcon:r.targetType===f.orgRole})},n.createElement(E.Z,{className:"department Hand",icon:r.targetType===f.dept?"department":"user"})),n.createElement("span",{className:"fullname"},r.targetName)):n.createElement(n.Fragment,null,n.createElement(Y,{user:r}),n.createElement("span",{className:"fullname"},r.targetName)))}))},t.rulesCon=function(a,l){var i=y().findIndex(a,function(r){return r.targetType===f.dept||r.targetType===f.orgRole}),d=a.filter(function(r){return r.ruleItemType===g.self||r.ruleItemType===g.extra}),c=a.filter(function(r){return r.ruleItemType===g.whiteList});return n.createElement(n.Fragment,null,t.renderRuleItem(d,l),n.createElement("span",{className:"addBtn Font13 Hand mLeft15",onClick:function(p){l===g.self?t.setState({showMoreActionSelf:!0}):t.setState({showMoreActionExtra:!0})}},n.createElement(E.Z,{className:"Font16 mRight5",icon:"add"}),_l("\u6DFB\u52A0"),n.createElement(z.Z,{onClickAway:function(){l===g.self?t.setState({showMoreActionSelf:!1}):t.setState({showMoreActionExtra:!1})},showMoreAction:l===g.self?t.state.showMoreActionSelf:t.state.showMoreActionExtra,addUser:function(){return t.addUser(d.filter(function(p){return p.targetType===f.user}),l)},addDept:function(){return t.addDept(d.filter(function(p){return p.targetType===f.dept}),l)},addOrgRoles:function(){return t.addOrgRoles(l)}})),l===g.self&&i!==-1&&n.createElement("div",{className:"whitelist"},n.createElement("div",{className:"Gray_9e mBottom15"},_l("\u767D\u540D\u5355")),t.renderRuleItem(c,g.whiteList),n.createElement("span",{className:"addBtn Font13 Hand",onClick:function(p){t.setState({showMoreActionWhiteList:!0})}},n.createElement(E.Z,{className:"Font16 mRight5",icon:"add"}),_l("\u6DFB\u52A0"),n.createElement(z.Z,{onClickAway:function(){t.setState({showMoreActionWhiteList:!1})},showMoreAction:t.state.showMoreActionWhiteList,addUser:function(){return t.addUser(d.filter(function(p){return p.targetType===f.user}),g.whiteList)},addDept:function(){return t.addDept(d.filter(function(p){return p.targetType===f.dept}),g.whiteList)},addOrgRoles:function(){return t.addOrgRoles(g.whiteList)}}))))},t.listCon=function(a,l){return n.createElement("div",{className:"listCon"},t.rulesCon(a,l))},t.extraCon=function(a){var l=t.props,i=l.editType,d=l.dispatch,c=l.currentEditRule;return n.createElement("div",null,n.createElement("p",{className:"Font13"},c.extraTxt),t.listCon(a,g.extra))},t.state={showMoreActionSelf:!1,showMoreActionExtra:!1},t}return(0,S.default)(e,[{key:"render",value:function(){var t=this.props,a=t.editType,l=t.dispatch,i=t.dataByRuleId,d=i===void 0?[]:i,c=t.currentEditRule,r=c===void 0?{}:c,p=d.filter(function(m){return m.ruleItemType===g.self||m.ruleItemType===g.whiteList}),h=d.filter(function(m){return m.ruleItemType===g.extra});return n.createElement("div",{className:""},n.createElement("p",{className:"Font13"},r.limitTxt),this.listCon(p,g.self),this.extraCon(h))}}]),e}(n.Component),Ce=function(e){var o=e.contact;return(0,v.default)({},o)};const Se=(0,O.$j)(Ce)(Ne);var V=u(15577),M=[{type:"hiddeRules",title:_l("\u9690\u85CF\u7684\u6210\u5458"),description:_l("\u88AB\u9690\u85CF\u7684\u6210\u5458 \uFF0C\u4E0D\u4F1A\u663E\u793A\u5728\u901A\u8BAF\u5F55\u4E2D")},{type:"refuseExternalDepRules",title:_l("\u9650\u5236\u67E5\u770B\u5916\u90E8\u95E8"),description:_l("\u88AB\u9650\u5236\u540E\uFF0C\u53EA\u80FD\u770B\u5230\u672C\u90E8\u95E8\u7684\u901A\u8BAF\u5F55"),editDescription:_l("\u89C4\u5219\u751F\u6548\u8303\u56F4\u5305\u542B\u6240\u9009\u90E8\u95E8\u7684\u5B50\u90E8\u95E8"),limitTxt:_l("\u53EA\u5141\u8BB8\u67E5\u770B\u672C\u90E8\u95E8\u901A\u8BAF\u5F55"),extraTxt:_l("\u989D\u5916\u53EF\u89C1\u7684\u6210\u5458"),ruleType:10},{type:"refuseUserRules",title:_l("\u9650\u5236\u67E5\u770B\u6240\u6709\u4EBA"),description:_l("\u88AB\u9690\u85CF\u7684\u6210\u5458 \u88AB\u9650\u5236\u540E\uFF0C\u4E0D\u80FD\u770B\u5230\u4F01\u4E1A\u6240\u6709\u901A\u8BAF\u5F55"),editDescription:"",limitTxt:_l("\u4E0D\u80FD\u770B\u5230\u7EC4\u7EC7\u6240\u6709\u901A\u8BAF\u5F55"),extraTxt:_l("\u989D\u5916\u53EF\u89C1\u7684\u6210\u5458"),ruleType:15}],Ae=function(s){(0,D.default)(e,s);function e(o){(0,C.default)(this,e);var t=(0,A.default)(this,(e.__proto__||N()(e)).call(this,o));return t.renderList=function(a,l){var i=t.props,d=i.data,c=d===void 0?[]:d,r=i.dispatch,p=i.projectId,h=y().filter(c,function(m){return m.ruleType===l});return y().map(h,function(m,x){return n.createElement("div",{className:"rulesBox",key:m.ruleId},n.createElement("span",{className:"nameTop"},_l("\u89C4\u5219 %0",x+1)),n.createElement("div",{className:"userBox"},y().map(m.items,function(I){return n.createElement("div",{className:"userItem"},I.targetType===20||I.targetType===30?n.createElement(n.Fragment,null,n.createElement("span",{className:T()("depIcon",{orgRoleIcon:I.targetType===30})},n.createElement(E.Z,{className:"department Hand",icon:"department"})),n.createElement("span",{className:"fullname"},I.targetName)):n.createElement(n.Fragment,null,n.createElement(Y,{user:I}),n.createElement("span",{className:"fullname"},I.targetName)))})),n.createElement("span",{className:"editRule",onClick:function(){r(U(!0,a,m.ruleId))}},_l("\u7F16\u8F91")),n.createElement("span",{className:"deleteRule",onClick:function(){(0,b.Z)({className:"",title:_l("\u786E\u5B9A\u5220\u9664\u8FD9\u6761\u89C4\u5219\u4E48\uFF1F"),okText:_l("\u786E\u8BA4"),buttonType:"primary",cancelText:_l("\u53D6\u6D88"),onOk:function(){r(ne(p,m.ruleId))}})}},_l("\u5220\u9664")))})},t.renderCon=function(){var a=t.props,l=a.data,i=l===void 0?[]:l,d=a.dispatch;return M.map(function(c){if(c.type!=="hiddeRules")return n.createElement("div",{className:"ruleItem"},n.createElement("h6",{className:"Gray Font15"},c.title),n.createElement("p",{className:T()("Gray_9e Font13 mTop12",{mBottom10:i.length>0})},c.description),t.renderList(c.type,c.ruleType),n.createElement("span",{className:"addBtn Font13 Hand mTop24",onClick:function(p){d(U(!0,c.type))}},n.createElement(E.Z,{className:"Font16 mRight5",icon:"add"}),_l("\u65B0\u5EFA\u89C4\u5219")))})},t.refreshFn=function(){var a=t.props,l=a.dispatch,i=a.isEdit,d=a.projectId;i?(0,b.Z)({className:"",title:_l("\u4F60\u4FEE\u6539\u7684\u8BBE\u7F6E\u5C1A\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u8981\u79BB\u5F00\u5417\uFF1F"),okText:_l("\u786E\u8BA4"),buttonType:"primary",cancelText:_l("\u53D6\u6D88"),onOk:function(){t.setState({errorIds:[]}),l(w(d)),l(U(!1))}}):(t.setState({errorIds:[]}),l(U(!1)))},t.errorCallback=function(a){t.setState({errorIds:a})},t.state={},t}return(0,S.default)(e,[{key:"componentDidMount",value:function(){var t=this.props,a=t.projectId,l=t.dispatch;l(w(a))}},{key:"render",value:function(){var t=this,a=this.props,l=a.showEdit,i=l===void 0?!1:l,d=a.editType,c=a.dispatch,r=a.loading,p=a.isEdit,h=a.dataByRuleId,m=h===void 0?[]:h,x=a.projectId,I=a.ruleId,X=a.isSaveing;if(r)return n.createElement(G.Z,{className:"mTop10"});var Be=(0,V.XH)(x,B.UU.contactsHide);if(Be==="2")return n.createElement("div",{className:"orgManagementWrap"},(0,V.j0)(x,B.UU.contactsHide,{dialogType:"content"}));if(this.state.pageLoading)return n.createElement(G.Z,{className:"mTop80"});var P=y().find(M,function(k){return k.type===d})||{};return n.createElement("div",{className:"contactsHiddenBox orgManagementWrap"},i?n.createElement("div",{className:"editCon flexColumn"},p&&n.createElement("div",null,n.createElement(pe,{when:!0,message:_l("\u4F60\u4FEE\u6539\u7684\u8BBE\u7F6E\u5C1A\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u8981\u79BB\u5F00\u5417\uFF1F")})),n.createElement("div",{className:"headerCon orgManagementHeader"},n.createElement("h5",{className:"Font17"},n.createElement(E.Z,{className:"Font20 mRight5 Gray Hand",icon:"backspace",onClick:function(){t.refreshFn()}}),P.title),n.createElement("span",{className:"Right Gray_75 Font13"},P.editDescription)),n.createElement("div",{className:"orgManagementContent"},n.createElement(Se,{rules:M,editType:d,currentEditRule:P,errorIds:this.state.errorIds||[]}),n.createElement("span",{className:T()("saveBtn",{disable:!p||m.length<=0}),onClick:function(){if(p&&!X&&m.length>0){var K=[];m.map(function(H){K.push({ruleItemType:H.ruleItemType,targetType:H.targetType,targetId:H.targetId})}),c(oe(x,K,I,P.ruleType,t.errorCallback))}else return}},_l("\u4FDD\u5B58")))):n.createElement("div",{className:"con flexColumn"},n.createElement("div",{className:"headerCon orgManagementHeader"},n.createElement("div",null,n.createElement("i",{className:"icon-backspace Font22 ThemeHoverColor3 Hand",onClick:this.props.onClose}),n.createElement("h5",{className:"Font17 bold mLeft10"},_l("\u901A\u8BAF\u5F55\u53EF\u89C1\u8303\u56F4"))),n.createElement(ee.Z,{className:"forHelp",type:2,href:"https://help.mingdao.com/org/security",text:_l("\u5E2E\u52A9")})),n.createElement("div",{className:"orgManagementContent"},n.createElement("div",{className:"conBox"},this.renderCon(2)))))}}]),e}(n.Component),De=function(e){var o=e.contact;return(0,v.default)({},o)};const je=(0,O.$j)(De)(Ae);var Ue={loading:!0,isEdit:!1,projectId:"",showEdit:!1,editType:"",data:[],dataByRuleId:[],ruleId:""};const xe=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ue,e=arguments[1],o=e.showEdit,t=e.type,a=e.editType,l=a===void 0?"":a,i=e.projectId,d=e.data,c=e.ruleId,r=e.isSaveing;switch(t){case"ACTION_ING":return(0,v.default)({},s,{loading:!0});case"ACTION_END":return(0,v.default)({},s,{loading:!1});case"ISLOADING":return(0,v.default)({},s,{isSaveing:r});case"UPDATE_PROJECT_ID":return(0,v.default)({},s,{projectId:i});case"UPDATE_EDITTYPW":return(0,v.default)({},s,{showEdit:o,editType:o?l:""});case"RULES_ALL":return(0,v.default)({},s,{data:d,dataByRuleId:[],showEdit:!1,isEdit:!1,ruleId:""});case"RULES_BY_RULEID":return(0,v.default)({},s,{ruleId:c,dataByRuleId:d,isEdit:!1});case"UPDATE_RULES_BY_RULEID":return(0,v.default)({},s,{dataByRuleId:d,isEdit:!0});default:return s}},Le=(0,L.UY)({contact:xe});var J=(0,L.MT)(Le,(0,L.qC)((0,L.md)(_.Z))),we=function(s){(0,D.default)(e,s);function e(){return(0,C.default)(this,e),(0,A.default)(this,(e.__proto__||N()(e)).call(this))}return(0,S.default)(e,[{key:"componentDidMount",value:function(){$("html").addClass("AppAdminContactsHidden")}},{key:"componentWillUnmount",value:function(){$("html").removeClass("AppAdminContactsHidden")}},{key:"render",value:function(){return J.dispatch(te(this.props.projectId)),n.createElement(O.zt,{store:J},n.createElement(je,this.props))}}]),e}(n.Component),Fe=u(15216),Pe=function(s){(0,D.default)(e,s);function e(o){(0,C.default)(this,e);var t=(0,A.default)(this,(e.__proto__||N()(e)).call(this,o));return t.state={showDialogSettingInviteRules:!1},t}return(0,S.default)(e,[{key:"render",value:function(){var t=this,a=this.state,l=a.showDialogSettingInviteRules,i=a.showAddressRange,d=W.Z.projectId;return i?n.createElement(we,{onClose:function(){return t.setState({showAddressRange:!1})},projectId:W.Z.projectId}):n.createElement("div",{className:"orgManagementWrap"},n.createElement("div",{className:"orgManagementHeader Font17"},_l("\u5E10\u53F7")),n.createElement(q.Z,{projectId:d,configs:[{key:"customIcon",title:_l("\u7528\u6237\u52A0\u5165\u89C4\u5219"),description:_l("\u8BBE\u7F6E\u7528\u6237\u52A0\u5165\u7EC4\u7EC7\u65F6\u7684\u89C4\u5219\u548C\u9700\u8981\u586B\u5199\u7684\u4FE1\u606F"),showSlideIcon:!0,onClick:function(){return t.setState({showDialogSettingInviteRules:!0})}},{key:"addressVisibleRange",title:_l("\u901A\u8BAF\u5F55\u53EF\u89C1\u8303\u56F4"),description:_l("\u8BBE\u7F6E\u6210\u5458\u5728\u53EF\u4EE5\u770B\u5230\u7684\u7EC4\u7EC7\u67B6\u6784\u8303\u56F4"),showSlideIcon:!0,featureId:B.UU.contactsHide,onClick:function(){return t.setState({showAddressRange:!0})}}]}),l&&n.createElement(Fe.Z,{showDialogSettingInviteRules:l,setValue:function(r){var p=r.showDialogSettingInviteRules;return t.setState({showDialogSettingInviteRules:p})},projectId:d}))}}]),e}(n.Component)}}]);
