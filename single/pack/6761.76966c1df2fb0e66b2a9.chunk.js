(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[6761],{96761:(H,j,z)=>{(function(B,k){H.exports=k(z(67294))})(window,function(B){return function(k){var D={};function i(n){if(D[n])return D[n].exports;var r=D[n]={i:n,l:!1,exports:{}};return k[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=k,i.c=D,i.d=function(n,r,l){i.o(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:l})},i.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},i.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(r,"a",r),r},i.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},i.p="",i(i.s=22)}([function(k,D){k.exports=B},function(k,D,i){k.exports=i(21),i(19),i(18),i(17),i(16),i(15),i(14),i(13),i(12),i(11),i(10),i(9),i(8)},function(k,D){(function(){"use strict";Konva.DD={anim:new Konva.Animation(function(){var n=this.dirty;return this.dirty=!1,n}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(n){var r=Konva.DD,l=r.node;if(l){if(!r.isDragging){var e=l.getStage().getPointerPosition();e||(l.getStage()._setPointerPosition(n),e=l.getStage().getPointerPosition());var t=l.dragDistance();if(Math.max(Math.abs(e.x-r.startPointerPos.x),Math.abs(e.y-r.startPointerPos.y))<t)return}if(l.getStage()._setPointerPosition(n),!r.isDragging&&(r.isDragging=!0,l.fire("dragstart",{type:"dragstart",target:l,evt:n},!0),!l.isDragging()))return;l._setDragPosition(n),l.fire("dragmove",{type:"dragmove",target:l,evt:n},!0)}},_endDragBefore:function(n){var r,l=Konva.DD,e=l.node;e&&(r=e.getLayer(),l.anim.stop(),l.isDragging&&(l.isDragging=!1,l.justDragged=!0,Konva.listenClickTap=!1,n&&(n.dragEndNode=e)),delete l.node,(e.getLayer()||r||e instanceof Konva.Stage)&&(r||e).draw())},_endDragAfter:function(n){var r=(n=n||{}).dragEndNode;n&&r&&r.fire("dragend",{type:"dragend",target:r,evt:n},!0)}},Konva.Node.prototype.startDrag=function(){var n=Konva.DD,r=this.getStage(),l=this.getLayer(),e=r.getPointerPosition(),t=this.getAbsolutePosition();e&&(n.node&&n.node.stopDrag(),n.node=this,n.startPointerPos=e,n.offset.x=e.x-t.x,n.offset.y=e.y-t.y,n.anim.setLayers(l||this.getLayers()),n.anim.start(),this._setDragPosition())},Konva.Node.prototype._setDragPosition=function(n){var r=Konva.DD,l=this.getStage().getPointerPosition(),e=this.getDragBoundFunc();if(l){var t={x:l.x-r.offset.x,y:l.y-r.offset.y};e!==void 0&&(t=e.call(this,t,n)),this.setAbsolutePosition(t),this._lastPos&&this._lastPos.x===t.x&&this._lastPos.y===t.y||(r.anim.dirty=!0),this._lastPos=t}},Konva.Node.prototype.stopDrag=function(){var n=Konva.DD,r={};n._endDragBefore(r),n._endDragAfter(r)},Konva.Node.prototype.setDraggable=function(n){this._setAttr("draggable",n),this._dragChange()};var i=Konva.Node.prototype.remove;Konva.Node.prototype.__originalRemove=i,Konva.Node.prototype.remove=function(){var n=Konva.DD;n.node&&n.node._id===this._id&&this.stopDrag(),i.call(this)},Konva.Node.prototype.isDragging=function(){var n=Konva.DD;return!(!n.node||n.node._id!==this._id||!n.isDragging)},Konva.Node.prototype._listenDrag=function(){var n=this;this._dragCleanup(),this.getClassName()==="Stage"?this.on("contentMousedown.konva contentTouchstart.konva",function(r){Konva.DD.node||n.startDrag(r)}):this.on("mousedown.konva touchstart.konva",function(r){r.evt.button!==1&&r.evt.button!==2&&(Konva.DD.node||n.startDrag(r))})},Konva.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var n=this.getStage(),r=Konva.DD;n&&r.node&&r.node._id===this._id&&r.node.stopDrag()}},Konva.Node.prototype._dragCleanup=function(){this.getClassName()==="Stage"?(this.off("contentMousedown.konva"),this.off("contentTouchstart.konva")):(this.off("mousedown.konva"),this.off("touchstart.konva"))},Konva.Factory.addGetterSetter(Konva.Node,"dragBoundFunc"),Konva.Factory.addGetter(Konva.Node,"draggable",!1),Konva.Factory.addOverloadedGetterSetter(Konva.Node,"draggable"),Konva.isBrowser&&(window.addEventListener("mouseup",Konva.DD._endDragBefore,!0),window.addEventListener("touchend",Konva.DD._endDragBefore,!0),window.addEventListener("mousemove",Konva.DD._drag),window.addEventListener("touchmove",Konva.DD._drag),window.addEventListener("mouseup",Konva.DD._endDragAfter,!1),window.addEventListener("touchend",Konva.DD._endDragAfter,!1))})()},function(k,D){(function(i){"use strict";var n=i.global.performance&&i.global.performance.now?function(){return i.global.performance.now()}:function(){return new Date().getTime()},r=i.global.requestAnimationFrame||i.global.webkitRequestAnimationFrame||i.global.mozRequestAnimationFrame||i.global.oRequestAnimationFrame||i.global.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)};function l(){return r.apply(i.global,arguments)}i.Animation=function(e,t){var a=i.Animation;this.func=e,this.setLayers(t),this.id=a.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n()}},i.Animation.prototype={setLayers:function(e){var t;return t=e?e.length>0?e:[e]:[],this.layers=t,this},getLayers:function(){return this.layers},addLayer:function(e){var t,a=this.layers,o=a.length;for(t=0;t<o;t++)if(a[t]._id===e._id)return!1;return this.layers.push(e),!0},isRunning:function(){var e,t=i.Animation.animations,a=t.length;for(e=0;e<a;e++)if(t[e].id===this.id)return!0;return!1},start:function(){var e=i.Animation;return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),e._addAnimation(this),this},stop:function(){return i.Animation._removeAnimation(this),this},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},i.Animation.animations=[],i.Animation.animIdCounter=0,i.Animation.animRunning=!1,i.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},i.Animation._removeAnimation=function(e){var t,a=e.id,o=this.animations,s=o.length;for(t=0;t<s;t++)if(o[t].id===a){this.animations.splice(t,1);break}},i.Animation._runFrames=function(){var e,t,a,o,s,h,d,u,v={},c=this.animations;for(o=0;o<c.length;o++)if(t=(e=c[o]).layers,a=e.func,e._updateFrameObject(n()),h=t.length,!a||a.call(e,e.frame)!==!1)for(s=0;s<h;s++)(d=t[s])._id!==void 0&&(v[d._id]=d);for(u in v)v.hasOwnProperty(u)&&v[u].draw()},i.Animation._animationLoop=function(){var e=i.Animation;e.animations.length?(e._runFrames(),l(e._animationLoop)):e.animRunning=!1},i.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,l(this._animationLoop))},i.BaseLayer.prototype.batchDraw=function(){var e=this,t=i.Animation;return this.batchAnim||(this.batchAnim=new t(function(){e.batchAnim.stop()},this)),this.batchAnim.isRunning()||this.batchAnim.start(),this},i.Stage.prototype.batchDraw=function(){return this.getChildren().each(function(e){e.batchDraw()}),this}})(Konva)},function(k,D){(function(){"use strict";Konva.Path=function(i){this.___init(i)},Konva.Path.prototype={___init:function(i){this.dataArray=[];var n=this;Konva.Shape.call(this,i),this.className="Path",this.dataArray=Konva.Path.parsePathData(this.getData()),this.pathLength=0;for(var r=0;r<this.dataArray.length;++r)this.pathLength+=this.dataArray[r].pathLength;this.on("dataChange.konva",function(){n.dataArray=Konva.Path.parsePathData(this.getData()),this.pathLength=0;for(var l=0;l<this.dataArray.length;++l)this.pathLength+=this.dataArray[l].pathLength}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(i){var n=this.dataArray;i.beginPath();for(var r=0;r<n.length;r++){var l=n[r].command,e=n[r].points;switch(l){case"L":i.lineTo(e[0],e[1]);break;case"M":i.moveTo(e[0],e[1]);break;case"C":i.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"Q":i.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case"A":var t=e[0],a=e[1],o=e[2],s=e[3],h=e[4],d=e[5],u=e[6],v=e[7],c=o>s?o:s,g=o>s?1:o/s,y=o>s?s/o:1;i.translate(t,a),i.rotate(u),i.scale(g,y),i.arc(0,0,c,h,h+d,1-v),i.scale(1/g,1/y),i.rotate(-u),i.translate(-t,-a);break;case"z":i.closePath()}}i.fillStrokeShape(this)},getSelfRect:function(){var i=[];this.dataArray.forEach(function(s){i=i.concat(s.points)});for(var n,r,l=i[0],e=i[0],t=i[1],a=i[1],o=0;o<i.length/2;o++)n=i[2*o],r=i[2*o+1],isNaN(n)||(l=Math.min(l,n),e=Math.max(e,n)),isNaN(r)||(t=Math.min(t,r),a=Math.max(a,r));return{x:Math.round(l),y:Math.round(t),width:Math.round(e-l),height:Math.round(a-t)}},getLength:function(){return this.pathLength},getPointAtLength:function(i){var n,r=0,l=this.dataArray.length;if(!l)return null;for(;r<l&&i>this.dataArray[r].pathLength;)i-=this.dataArray[r].pathLength,++r;if(r===l)return{x:(n=this.dataArray[r-1].points.slice(-2))[0],y:n[1]};if(i<.01)return{x:(n=this.dataArray[r].points.slice(0,2))[0],y:n[1]};var e=this.dataArray[r],t=e.points;switch(e.command){case"L":return Konva.Path.getPointOnLine(i,e.start.x,e.start.y,t[0],t[1]);case"C":return Konva.Path.getPointOnCubicBezier(i/e.pathLength,e.start.x,e.start.y,t[0],t[1],t[2],t[3],t[4],t[5]);case"Q":return Konva.Path.getPointOnQuadraticBezier(i/e.pathLength,e.start.x,e.start.y,t[0],t[1],t[2],t[3]);case"A":var a=t[0],o=t[1],s=t[2],h=t[3],d=t[4],u=t[5],v=t[6];return d+=u*i/e.pathLength,Konva.Path.getPointOnEllipticalArc(a,o,s,h,d,v)}return null}},Konva.Util.extend(Konva.Path,Konva.Shape),Konva.Path.getLineLength=function(i,n,r,l){return Math.sqrt((r-i)*(r-i)+(l-n)*(l-n))},Konva.Path.getPointOnLine=function(i,n,r,l,e,t,a){t===void 0&&(t=n),a===void 0&&(a=r);var o=(e-r)/(l-n+1e-8),s=Math.sqrt(i*i/(1+o*o));l<n&&(s*=-1);var h,d=o*s;if(l===n)h={x:t,y:a+d};else if((a-r)/(t-n+1e-8)===o)h={x:t+s,y:a+d};else{var u,v,c=this.getLineLength(n,r,l,e);if(c<1e-8)return;var g=(t-n)*(l-n)+(a-r)*(e-r);u=n+(g/=c*c)*(l-n),v=r+g*(e-r);var y=this.getLineLength(t,a,u,v),b=Math.sqrt(i*i-y*y);s=Math.sqrt(b*b/(1+o*o)),l<n&&(s*=-1),h={x:u+s,y:v+(d=o*s)}}return h},Konva.Path.getPointOnCubicBezier=function(i,n,r,l,e,t,a,o,s){function h(c){return c*c*c}function d(c){return 3*c*c*(1-c)}function u(c){return 3*c*(1-c)*(1-c)}function v(c){return(1-c)*(1-c)*(1-c)}return{x:o*h(i)+t*d(i)+l*u(i)+n*v(i),y:s*h(i)+a*d(i)+e*u(i)+r*v(i)}},Konva.Path.getPointOnQuadraticBezier=function(i,n,r,l,e,t,a){function o(d){return d*d}function s(d){return 2*d*(1-d)}function h(d){return(1-d)*(1-d)}return{x:t*o(i)+l*s(i)+n*h(i),y:a*o(i)+e*s(i)+r*h(i)}},Konva.Path.getPointOnEllipticalArc=function(i,n,r,l,e,t){var a=Math.cos(t),o=Math.sin(t),s=r*Math.cos(e),h=l*Math.sin(e);return{x:i+(s*a-h*o),y:n+(s*o+h*a)}},Konva.Path.parsePathData=function(i){if(!i)return[];var n=i,r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];n=n.replace(new RegExp(" ","g"),",");for(var l=0;l<r.length;l++)n=n.replace(new RegExp(r[l],"g"),"|"+r[l]);var e,t=n.split("|"),a=[],o=[],s=0,h=0,d=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(l=1;l<t.length;l++){var u=t[l],v=u.charAt(0);for(u=u.slice(1),o.length=0;e=d.exec(u);)o.push(e[0]);for(var c=[],g=0,y=o.length;g<y;g++){var b=parseFloat(o[g]);isNaN(b)?c.push(0):c.push(b)}for(;c.length>0&&!isNaN(c[0]);){var f,p,_,P,m,A,S,w,x,F,L=null,K=[],O=s,N=h;switch(v){case"l":s+=c.shift(),h+=c.shift(),L="L",K.push(s,h);break;case"L":s=c.shift(),h=c.shift(),K.push(s,h);break;case"m":var I=c.shift(),M=c.shift();if(s+=I,h+=M,L="M",a.length>2&&a[a.length-1].command==="z"){for(var G=a.length-2;G>=0;G--)if(a[G].command==="M"){s=a[G].points[0]+I,h=a[G].points[1]+M;break}}K.push(s,h),v="l";break;case"M":s=c.shift(),h=c.shift(),L="M",K.push(s,h),v="L";break;case"h":s+=c.shift(),L="L",K.push(s,h);break;case"H":s=c.shift(),L="L",K.push(s,h);break;case"v":h+=c.shift(),L="L",K.push(s,h);break;case"V":h=c.shift(),L="L",K.push(s,h);break;case"C":K.push(c.shift(),c.shift(),c.shift(),c.shift()),s=c.shift(),h=c.shift(),K.push(s,h);break;case"c":K.push(s+c.shift(),h+c.shift(),s+c.shift(),h+c.shift()),s+=c.shift(),h+=c.shift(),L="C",K.push(s,h);break;case"S":p=s,_=h,(f=a[a.length-1]).command==="C"&&(p=s+(s-f.points[2]),_=h+(h-f.points[3])),K.push(p,_,c.shift(),c.shift()),s=c.shift(),h=c.shift(),L="C",K.push(s,h);break;case"s":p=s,_=h,(f=a[a.length-1]).command==="C"&&(p=s+(s-f.points[2]),_=h+(h-f.points[3])),K.push(p,_,s+c.shift(),h+c.shift()),s+=c.shift(),h+=c.shift(),L="C",K.push(s,h);break;case"Q":K.push(c.shift(),c.shift()),s=c.shift(),h=c.shift(),K.push(s,h);break;case"q":K.push(s+c.shift(),h+c.shift()),s+=c.shift(),h+=c.shift(),L="Q",K.push(s,h);break;case"T":p=s,_=h,(f=a[a.length-1]).command==="Q"&&(p=s+(s-f.points[0]),_=h+(h-f.points[1])),s=c.shift(),h=c.shift(),L="Q",K.push(p,_,s,h);break;case"t":p=s,_=h,(f=a[a.length-1]).command==="Q"&&(p=s+(s-f.points[0]),_=h+(h-f.points[1])),s+=c.shift(),h+=c.shift(),L="Q",K.push(p,_,s,h);break;case"A":P=c.shift(),m=c.shift(),A=c.shift(),S=c.shift(),w=c.shift(),x=s,F=h,s=c.shift(),h=c.shift(),L="A",K=this.convertEndpointToCenterParameterization(x,F,s,h,S,w,P,m,A);break;case"a":P=c.shift(),m=c.shift(),A=c.shift(),S=c.shift(),w=c.shift(),x=s,F=h,s+=c.shift(),h+=c.shift(),L="A",K=this.convertEndpointToCenterParameterization(x,F,s,h,S,w,P,m,A)}a.push({command:L||v,points:K,start:{x:O,y:N},pathLength:this.calcLength(O,N,L||v,K)})}v!=="z"&&v!=="Z"||a.push({command:"z",points:[],start:void 0,pathLength:0})}return a},Konva.Path.calcLength=function(i,n,r,l){var e,t,a,o,s=Konva.Path;switch(r){case"L":return s.getLineLength(i,n,l[0],l[1]);case"C":for(e=0,t=s.getPointOnCubicBezier(0,i,n,l[0],l[1],l[2],l[3],l[4],l[5]),o=.01;o<=1;o+=.01)a=s.getPointOnCubicBezier(o,i,n,l[0],l[1],l[2],l[3],l[4],l[5]),e+=s.getLineLength(t.x,t.y,a.x,a.y),t=a;return e;case"Q":for(e=0,t=s.getPointOnQuadraticBezier(0,i,n,l[0],l[1],l[2],l[3]),o=.01;o<=1;o+=.01)a=s.getPointOnQuadraticBezier(o,i,n,l[0],l[1],l[2],l[3]),e+=s.getLineLength(t.x,t.y,a.x,a.y),t=a;return e;case"A":e=0;var h=l[4],d=l[5],u=l[4]+d,v=Math.PI/180;if(Math.abs(h-u)<v&&(v=Math.abs(h-u)),t=s.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],h,0),d<0)for(o=h-v;o>u;o-=v)a=s.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],o,0),e+=s.getLineLength(t.x,t.y,a.x,a.y),t=a;else for(o=h+v;o<u;o+=v)a=s.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],o,0),e+=s.getLineLength(t.x,t.y,a.x,a.y),t=a;return a=s.getPointOnEllipticalArc(l[0],l[1],l[2],l[3],u,0),e+s.getLineLength(t.x,t.y,a.x,a.y)}return 0},Konva.Path.convertEndpointToCenterParameterization=function(i,n,r,l,e,t,a,o,s){var h=s*(Math.PI/180),d=Math.cos(h)*(i-r)/2+Math.sin(h)*(n-l)/2,u=-1*Math.sin(h)*(i-r)/2+Math.cos(h)*(n-l)/2,v=d*d/(a*a)+u*u/(o*o);v>1&&(a*=Math.sqrt(v),o*=Math.sqrt(v));var c=Math.sqrt((a*a*(o*o)-a*a*(u*u)-o*o*(d*d))/(a*a*(u*u)+o*o*(d*d)));e===t&&(c*=-1),isNaN(c)&&(c=0);var g=c*a*u/o,y=c*-o*d/a,b=(i+r)/2+Math.cos(h)*g-Math.sin(h)*y,f=(n+l)/2+Math.sin(h)*g+Math.cos(h)*y,p=function(x){return Math.sqrt(x[0]*x[0]+x[1]*x[1])},_=function(x,F){return(x[0]*F[0]+x[1]*F[1])/(p(x)*p(F))},P=function(x,F){return(x[0]*F[1]<x[1]*F[0]?-1:1)*Math.acos(_(x,F))},m=P([1,0],[(d-g)/a,(u-y)/o]),A=[(d-g)/a,(u-y)/o],S=[(-1*d-g)/a,(-1*u-y)/o],w=P(A,S);return _(A,S)<=-1&&(w=Math.PI),_(A,S)>=1&&(w=0),t===0&&w>0&&(w-=2*Math.PI),t===1&&w<0&&(w+=2*Math.PI),[b,f,a,o,m,w,h,t]},Konva.Factory.addGetterSetter(Konva.Path,"data"),Konva.Collection.mapMethods(Konva.Path)})()},function(k,D){(function(){"use strict";Konva.Rect=function(i){this.___init(i)},Konva.Rect.prototype={___init:function(i){Konva.Shape.call(this,i),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(i){var n=this.getCornerRadius(),r=this.getWidth(),l=this.getHeight();i.beginPath(),n?(n=Math.min(n,r/2,l/2),i.moveTo(n,0),i.lineTo(r-n,0),i.arc(r-n,n,n,3*Math.PI/2,0,!1),i.lineTo(r,l-n),i.arc(r-n,l-n,n,0,Math.PI/2,!1),i.lineTo(n,l),i.arc(n,l-n,n,Math.PI/2,Math.PI,!1),i.lineTo(0,n),i.arc(n,n,n,Math.PI,3*Math.PI/2,!1)):i.rect(0,0,r,l),i.closePath(),i.fillStrokeShape(this)}},Konva.Util.extend(Konva.Rect,Konva.Shape),Konva.Factory.addGetterSetter(Konva.Rect,"cornerRadius",0,Konva.Validators.getNumberValidator()),Konva.Collection.mapMethods(Konva.Rect)})()},function(k,D){(function(i){"use strict";var n=2*Math.PI-1e-4;i.Circle=function(r){this.___init(r)},i.Circle.prototype={_centroid:!0,___init:function(r){i.Shape.call(this,r),this.className="Circle",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){r.beginPath(),r.arc(0,0,this.getRadius(),0,n,!1),r.closePath(),r.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(r){i.Node.prototype.setWidth.call(this,r),this.radius()!==r/2&&this.setRadius(r/2)},setHeight:function(r){i.Node.prototype.setHeight.call(this,r),this.radius()!==r/2&&this.setRadius(r/2)}},i.Util.extend(i.Circle,i.Shape),i.Factory.addGetterSetter(i.Circle,"radius",0,i.Validators.getNumberValidator()),i.Factory.addOverloadedGetterSetter(i.Circle,"radius"),i.Collection.mapMethods(i.Circle)})(Konva)},function(k,D){(function(){"use strict";Konva.Image=function(i){this.___init(i)},Konva.Image.prototype={___init:function(i){Konva.Shape.call(this,i),this.className="Image",this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()&&this.getStage()},_sceneFunc:function(i){var n,r,l,e=this.getWidth(),t=this.getHeight(),a=this.getImage();a&&(n=this.getCropWidth(),r=this.getCropHeight(),l=n&&r?[a,this.getCropX(),this.getCropY(),n,r,0,0,e,t]:[a,0,0,e,t]),(this.hasFill()||this.hasStroke())&&(i.beginPath(),i.rect(0,0,e,t),i.closePath(),i.fillStrokeShape(this)),a&&i.drawImage.apply(i,l)},_hitFunc:function(i){var n=this.getWidth(),r=this.getHeight();i.beginPath(),i.rect(0,0,n,r),i.closePath(),i.fillStrokeShape(this)},getWidth:function(){var i=this.getImage();return this.attrs.width||(i?i.width:0)},getHeight:function(){var i=this.getImage();return this.attrs.height||(i?i.height:0)}},Konva.Util.extend(Konva.Image,Konva.Shape),Konva.Factory.addGetterSetter(Konva.Image,"image"),Konva.Factory.addComponentsGetterSetter(Konva.Image,"crop",["x","y","width","height"]),Konva.Factory.addGetterSetter(Konva.Image,"cropX",0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Image,"cropY",0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Image,"cropWidth",0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Image,"cropHeight",0,Konva.Validators.getNumberValidator()),Konva.Collection.mapMethods(Konva.Image),Konva.Image.fromURL=function(i,n){var r=new Image;r.onload=function(){var l=new Konva.Image({image:r});n(l)},r.crossOrigin="Anonymous",r.src=i}})()},function(k,D){(function(){"use strict";Konva.Group=function(i){this.___init(i)},Konva.Util.addMethods(Konva.Group,{___init:function(i){this.nodeType="Group",Konva.Container.call(this,i)},_validateAdd:function(i){var n=i.getType();n!=="Group"&&n!=="Shape"&&Konva.Util.throw("You may only add groups and shapes to groups.")}}),Konva.Util.extend(Konva.Group,Konva.Container),Konva.Collection.mapMethods(Konva.Group)})()},function(k,D){(function(){"use strict";Konva.FastLayer=function(i){this.____init(i)},Konva.Util.addMethods(Konva.FastLayer,{____init:function(i){this.nodeType="Layer",this.canvas=new Konva.SceneCanvas,Konva.BaseLayer.call(this,i)},_validateAdd:function(i){i.getType()!=="Shape"&&Konva.Util.throw("You may only add shapes to a fast layer.")},_setCanvasSize:function(i,n){this.canvas.setSize(i,n)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(i){var n=this.getLayer(),r=i||n&&n.getCanvas();return this.getClearBeforeDraw()&&r.getContext().clear(),Konva.Container.prototype.drawScene.call(this,r),this},draw:function(){return this.drawScene(),this},setVisible:function(i){return Konva.Node.prototype.setVisible.call(this,i),this.getCanvas()._canvas.style.display=i?"block":"none",this}}),Konva.Util.extend(Konva.FastLayer,Konva.BaseLayer),Konva.Collection.mapMethods(Konva.FastLayer)})()},function(k,D){(function(){"use strict";var i=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],n=i.length;Konva.Layer=function(r){this.____init(r)},Konva.Util.addMethods(Konva.Layer,{____init:function(r){this.nodeType="Layer",this.canvas=new Konva.SceneCanvas,this.hitCanvas=new Konva.HitCanvas({pixelRatio:1}),Konva.BaseLayer.call(this,r)},_setCanvasSize:function(r,l){this.canvas.setSize(r,l),this.hitCanvas.setSize(r,l)},_validateAdd:function(r){var l=r.getType();l!=="Group"&&l!=="Shape"&&Konva.Util.throw("You may only add groups and shapes to a layer.")},getIntersection:function(r,l){var e,t,a,o;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var s=1,h=!1;;){for(t=0;t<n;t++){if(a=i[t],(o=(e=this._getIntersection({x:r.x+a.x*s,y:r.y+a.y*s})).shape)&&l)return o.findAncestor(l,!0);if(o)return o;if(h=!!e.antialiased,!e.antialiased)break}if(!h)return null;s+=1}},_getImageData:function(r,l){var e=this.hitCanvas.width||1,t=this.hitCanvas.height||1,a=Math.round(l)*e+Math.round(r);return this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,e,t)),[this._hitImageData.data[4*a+0],this._hitImageData.data[4*a+1],this._hitImageData.data[4*a+2],this._hitImageData.data[4*a+3]]},_getIntersection:function(r){var l,e,t=this.hitCanvas.pixelRatio,a=this.hitCanvas.context.getImageData(Math.round(r.x*t),Math.round(r.y*t),1,1).data,o=a[3];return o===255?(l=Konva.Util._rgbToHex(a[0],a[1],a[2]),(e=Konva.shapes["#"+l])?{shape:e}:{antialiased:!0}):o>0?{antialiased:!0}:{}},drawScene:function(r,l){var e=this.getLayer(),t=r||e&&e.getCanvas();return this._fire("beforeDraw",{node:this}),this.getClearBeforeDraw()&&t.getContext().clear(),Konva.Container.prototype.drawScene.call(this,t,l),this._fire("draw",{node:this}),this},drawHit:function(r,l){var e=this.getLayer(),t=r||e&&e.hitCanvas;return e&&e.getClearBeforeDraw()&&e.getHitCanvas().getContext().clear(),Konva.Container.prototype.drawHit.call(this,t,l),this.imageData=null,this},clear:function(r){return Konva.BaseLayer.prototype.clear.call(this,r),this.getHitCanvas().getContext().clear(r),this.imageData=null,this},setVisible:function(r){return Konva.Node.prototype.setVisible.call(this,r),r?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(r,l){return Konva.BaseLayer.prototype.setSize.call(this,r,l),this.hitCanvas.setSize(r,l),this}}),Konva.Util.extend(Konva.Layer,Konva.BaseLayer),Konva.Factory.addGetterSetter(Konva.Layer,"hitGraphEnabled",!0),Konva.Collection.mapMethods(Konva.Layer)})()},function(k,D){(function(i){"use strict";i.BaseLayer=function(n){this.___init(n)},i.Util.addMethods(i.BaseLayer,{___init:function(n){this.nodeType="Layer",i.Container.call(this,n)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(n){return this.getContext().clear(n),this},clearHitCache:function(){this._hitImageData=void 0},setZIndex:function(n){i.Node.prototype.setZIndex.call(this,n);var r=this.getStage();return r&&(r.content.removeChild(this.getCanvas()._canvas),n<r.getChildren().length-1?r.content.insertBefore(this.getCanvas()._canvas,r.getChildren()[n+1].getCanvas()._canvas):r.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){i.Node.prototype.moveToTop.call(this);var n=this.getStage();return n&&(n.content.removeChild(this.getCanvas()._canvas),n.content.appendChild(this.getCanvas()._canvas)),this},moveUp:function(){if(!i.Node.prototype.moveUp.call(this))return this;var n=this.getStage();return n?(n.content.removeChild(this.getCanvas()._canvas),this.index<n.getChildren().length-1?n.content.insertBefore(this.getCanvas()._canvas,n.getChildren()[this.index+1].getCanvas()._canvas):n.content.appendChild(this.getCanvas()._canvas),this):this},moveDown:function(){if(i.Node.prototype.moveDown.call(this)){var n=this.getStage();if(n){var r=n.getChildren();n.content.removeChild(this.getCanvas()._canvas),n.content.insertBefore(this.getCanvas()._canvas,r[this.index+1].getCanvas()._canvas)}}return this},moveToBottom:function(){if(i.Node.prototype.moveToBottom.call(this)){var n=this.getStage();if(n){var r=n.getChildren();n.content.removeChild(this.getCanvas()._canvas),n.content.insertBefore(this.getCanvas()._canvas,r[1].getCanvas()._canvas)}}return this},getLayer:function(){return this},remove:function(){var n=this.getCanvas()._canvas;return i.Node.prototype.remove.call(this),n&&n.parentNode&&i.Util._isInDocument(n)&&n.parentNode.removeChild(n),this},getStage:function(){return this.parent},setSize:function(n,r){return this.canvas.setSize(n,r),this},_toKonvaCanvas:function(n){return(n=n||{}).width=n.width||this.getWidth(),n.height=n.height||this.getHeight(),n.x=n.x!==void 0?n.x:this.getX(),n.y=n.y!==void 0?n.y:this.getY(),i.Node.prototype._toKonvaCanvas.call(this,n)},getWidth:function(){if(this.parent)return this.parent.getWidth()},setWidth:function(){i.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},getHeight:function(){if(this.parent)return this.parent.getHeight()},setHeight:function(){i.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},_applyTransform:function(n,r,l){var e=n.getAbsoluteTransform(l).getMatrix();r.transform(e[0],e[1],e[2],e[3],e[4],e[5])}}),i.Util.extend(i.BaseLayer,i.Container),i.Factory.addGetterSetter(i.BaseLayer,"clearBeforeDraw",!0),i.Collection.mapMethods(i.BaseLayer)})(Konva)},function(k,D){(function(){"use strict";var i="_",n=["mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend","mouseover","wheel","contextmenu"],r=n.length;function l(e,t){e.content.addEventListener(t,function(a){e[i+t](a)},!1)}Konva.Stage=function(e){this.___init(e)},Konva.Util.addMethods(Konva.Stage,{___init:function(e){this.nodeType="Stage",Konva.Container.call(this,e),this._id=Konva.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Konva.stages.push(this)},_validateAdd:function(e){e.getType()!=="Layer"&&Konva.Util.throw("You may only add layers to the stage.")},setContainer:function(e){if(typeof e=="string"){if(e.charAt(0)==="."){var t=e.slice(1);e=Konva.document.getElementsByClassName(t)[0]}else{var a;a=e.charAt(0)!=="#"?e:e.slice(1),e=Konva.document.getElementById(a)}if(!e)throw"Can not find container in document with id "+a}return this._setAttr("container",e),this},shouldDrawHit:function(){return!0},draw:function(){return Konva.Node.prototype.draw.call(this),this},setHeight:function(e){return Konva.Node.prototype.setHeight.call(this,e),this._resizeDOM(),this},setWidth:function(e){return Konva.Node.prototype.setWidth.call(this,e),this._resizeDOM(),this},clear:function(){var e,t=this.children,a=t.length;for(e=0;e<a;e++)t[e].clear();return this},clone:function(e){return e||(e={}),e.container=Konva.document.createElement("div"),Konva.Container.prototype.clone.call(this,e)},destroy:function(){var e=this.content;Konva.Container.prototype.destroy.call(this),e&&Konva.Util._isInDocument(e)&&this.getContainer().removeChild(e);var t=Konva.stages.indexOf(this);return t>-1&&Konva.stages.splice(t,1),this},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},_toKonvaCanvas:function(e){var t=(e=e||{}).x||0,a=e.y||0,o=new Konva.SceneCanvas({width:e.width||this.getWidth(),height:e.height||this.getHeight(),pixelRatio:e.pixelRatio||1}),s=o.getContext()._context,h=this.children;return(t||a)&&s.translate(-1*t,-1*a),h.each(function(d){if(d.isVisible()){var u=d._toKonvaCanvas(e);s.drawImage(u._canvas,t,a,u.getWidth()/u.getPixelRatio(),u.getHeight()/u.getPixelRatio())}}),o},toImage:function(e){var t=e.callback;e.callback=function(a){Konva.Util._getImage(a,function(o){t(o)})},this.toDataURL(e)},getIntersection:function(e,t){var a,o,s=this.getChildren();for(a=s.length-1;a>=0;a--)if(o=s[a].getIntersection(e,t))return o;return null},_resizeDOM:function(){if(this.content){var e,t,a=this.getWidth(),o=this.getHeight(),s=this.getChildren(),h=s.length;for(this.content.style.width=a+"px",this.content.style.height=o+"px",this.bufferCanvas.setSize(a,o),this.bufferHitCanvas.setSize(a,o),e=0;e<h;e++)(t=s[e]).setSize(a,o),t.draw()}},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return Konva.Container.prototype.add.call(this,e),e._setCanvasSize(this.width(),this.height()),e.draw(),Konva.isBrowser&&this.content.appendChild(e.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){if(Konva.isBrowser)for(var e=0;e<r;e++)l(this,n[e])},_mouseover:function(e){Konva.UA.mobile||(this._setPointerPosition(e),this._fire("contentMouseover",{evt:e}))},_mouseout:function(e){if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.targetShape;t&&!Konva.isDragging()&&(t._fireAndBubble("mouseout",{evt:e}),t._fireAndBubble("mouseleave",{evt:e}),this.targetShape=null),this.pointerPos=void 0,this._fire("contentMouseout",{evt:e})}},_mousemove:function(e){return Konva.UA.ieMobile?this._touchmove(e):e.movementX===void 0&&e.movementY===void 0||e.movementY!==0||e.movementX!==0?Konva.UA.mobile?null:(this._setPointerPosition(e),Konva.isDragging()||((t=this.getIntersection(this.getPointerPosition()))&&t.isListening()?Konva.isDragging()||this.targetShape&&this.targetShape._id===t._id?t._fireAndBubble("mousemove",{evt:e}):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",{evt:e},t),this.targetShape._fireAndBubble("mouseleave",{evt:e},t)),t._fireAndBubble("mouseover",{evt:e},this.targetShape),t._fireAndBubble("mouseenter",{evt:e},this.targetShape),this.targetShape=t):(this.targetShape&&!Konva.isDragging()&&(this.targetShape._fireAndBubble("mouseout",{evt:e}),this.targetShape._fireAndBubble("mouseleave",{evt:e}),this.targetShape=null),this._fire("mousemove",{evt:e,target:this,currentTarget:this})),this._fire("contentMousemove",{evt:e})),void(e.cancelable&&e.preventDefault())):null;var t},_mousedown:function(e){if(Konva.UA.ieMobile)return this._touchstart(e);if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Konva.listenClickTap=!0,t&&t.isListening()?(this.clickStartShape=t,t._fireAndBubble("mousedown",{evt:e})):this._fire("mousedown",{evt:e,target:this,currentTarget:this}),this._fire("contentMousedown",{evt:e})}},_mouseup:function(e){if(Konva.UA.ieMobile)return this._touchend(e);if(!Konva.UA.mobile){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),a=this.clickStartShape,o=this.clickEndShape,s=!1,h=Konva.DD;Konva.inDblClickWindow?(s=!0,clearTimeout(this.dblTimeout)):h&&h.justDragged?h&&(h.justDragged=!1):(Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){Konva.inDblClickWindow=!1},Konva.dblClickWindow),t&&t.isListening()?(this.clickEndShape=t,t._fireAndBubble("mouseup",{evt:e}),Konva.listenClickTap&&a&&a._id===t._id&&(t._fireAndBubble("click",{evt:e}),s&&o&&o._id===t._id&&t._fireAndBubble("dblclick",{evt:e}))):(this._fire("mouseup",{evt:e,target:this,currentTarget:this}),Konva.listenClickTap&&this._fire("click",{evt:e,target:this,currentTarget:this}),s&&this._fire("dblclick",{evt:e,target:this,currentTarget:this})),this._fire("contentMouseup",{evt:e}),Konva.listenClickTap&&(this._fire("contentClick",{evt:e}),s&&this._fire("contentDblclick",{evt:e})),Konva.listenClickTap=!1}e.cancelable&&e.preventDefault()},_contextmenu:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble("contextmenu",{evt:e}):this._fire("contextmenu",{evt:e,target:this,currentTarget:this}),this._fire("contentContextmenu",{evt:e})},_touchstart:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());Konva.listenClickTap=!0,t&&t.isListening()?(this.tapStartShape=t,t._fireAndBubble("touchstart",{evt:e}),t.isListening()&&t.preventDefault()&&e.cancelable&&e.preventDefault()):this._fire("touchstart",{evt:e,target:this,currentTarget:this}),this._fire("contentTouchstart",{evt:e})},_touchend:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition()),a=!1;Konva.inDblClickWindow?(a=!0,clearTimeout(this.dblTimeout)):(Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){Konva.inDblClickWindow=!1},Konva.dblClickWindow),t&&t.isListening()?(t._fireAndBubble("touchend",{evt:e}),Konva.listenClickTap&&this.tapStartShape&&t._id===this.tapStartShape._id&&(t._fireAndBubble("tap",{evt:e}),a&&t._fireAndBubble("dbltap",{evt:e})),t.isListening()&&t.preventDefault()&&e.cancelable&&e.preventDefault()):(this._fire("touchend",{evt:e,target:this,currentTarget:this}),Konva.listenClickTap&&this._fire("tap",{evt:e,target:this,currentTarget:this}),a&&this._fire("dbltap",{evt:e,target:this,currentTarget:this})),this._fire("contentTouchend",{evt:e}),Konva.listenClickTap&&(this._fire("contentTap",{evt:e}),a&&this._fire("contentDbltap",{evt:e})),Konva.listenClickTap=!1},_touchmove:function(e){this._setPointerPosition(e);var t,a=Konva.DD;Konva.isDragging()||((t=this.getIntersection(this.getPointerPosition()))&&t.isListening()?(t._fireAndBubble("touchmove",{evt:e}),t.isListening()&&t.preventDefault()&&e.cancelable&&e.preventDefault()):this._fire("touchmove",{evt:e,target:this,currentTarget:this}),this._fire("contentTouchmove",{evt:e})),a&&Konva.isDragging()&&Konva.DD.node.preventDefault()&&e.cancelable&&e.preventDefault()},_wheel:function(e){this._setPointerPosition(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble("wheel",{evt:e}):this._fire("wheel",{evt:e,target:this,currentTarget:this}),this._fire("contentWheel",{evt:e})},_setPointerPosition:function(e){var t=this._getContentPosition(),a=null,o=null;if((e=e||window.event).touches!==void 0){if(e.touches.length>0){var s=e.touches[0];a=s.clientX-t.left,o=s.clientY-t.top}}else a=e.clientX-t.left,o=e.clientY-t.top;a!==null&&o!==null&&(this.pointerPos={x:a,y:o})},_getContentPosition:function(){var e=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:e.top,left:e.left}},_buildDOM:function(){if(this.bufferCanvas=new Konva.SceneCanvas,this.bufferHitCanvas=new Konva.HitCanvas({pixelRatio:1}),Konva.isBrowser){var e=this.getContainer();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=Konva.document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}},_onContent:function(e,t){var a,o,s=e.split(" "),h=s.length;for(a=0;a<h;a++)o=s[a],this.content.addEventListener(o,t,!1)},cache:function(){Konva.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),Konva.Util.extend(Konva.Stage,Konva.Container),Konva.Factory.addGetter(Konva.Stage,"container"),Konva.Factory.addOverloadedGetterSetter(Konva.Stage,"container")})()},function(k,D){(function(i){"use strict";var n="hasShadow",r="shadowRGBA";function l(h){h.fill()}function e(h){h.stroke()}function t(h){h.fill()}function a(h){h.stroke()}function o(){this._clearCache(n)}function s(){this._clearCache(r)}i.Shape=function(h){this.__init(h)},i.Util.addMethods(i.Shape,{__init:function(h){this.nodeType="Shape",this._fillFunc=l,this._strokeFunc=e,this._fillFuncHit=t,this._strokeFuncHit=a;for(var d,u=i.shapes;!(d=i.Util.getRandomColor())||d in u;);this.colorKey=d,u[d]=this,i.Node.call(this,h),this.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",o),this.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",s)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(n,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&this.getShadowOpacity()!==0&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},getShadowRGBA:function(){return this._getCache(r,this._getShadowRGBA)},_getShadowRGBA:function(){if(this.hasShadow()){var h=i.Util.colorToRGBA(this.shadowColor());return"rgba("+h.r+","+h.g+","+h.b+","+h.a*(this.getShadowOpacity()||1)+")"}},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return this.strokeEnabled()&&!(!this.stroke()&&!this.getStrokeLinearGradientColorStops())},intersects:function(h){var d=this.getStage().bufferHitCanvas;return d.getContext().clear(),this.drawHit(d),d.context.getImageData(Math.round(h.x),Math.round(h.y),1,1).data[3]>0},destroy:function(){return i.Node.prototype.destroy.call(this),delete i.shapes[this.colorKey],this},_useBufferCanvas:function(h){return!h&&this.perfectDrawEnabled()&&this.getAbsoluteOpacity()!==1&&this.hasFill()&&this.hasStroke()&&this.getStage()||this.perfectDrawEnabled()&&this.hasShadow()&&this.getAbsoluteOpacity()!==1&&this.hasFill()&&this.hasStroke()&&this.getStage()},getSelfRect:function(){var h=this.getSize();return{x:this._centroid?Math.round(-h.width/2):0,y:this._centroid?Math.round(-h.height/2):0,width:h.width,height:h.height}},getClientRect:function(h){var d=(h=h||{}).skipTransform,u=h.relativeTo,v=this.getSelfRect(),c=this.hasStroke()&&this.strokeWidth()||0,g=v.width+c,y=v.height+c,b=!h.skipShadow&&this.hasShadow(),f=b?this.shadowOffsetX():0,p=b?this.shadowOffsetY():0,_=g+Math.abs(f),P=y+Math.abs(p),m=b&&this.shadowBlur()||0,A=_+2*m,S=P+2*m,w=0;Math.round(c/2)!==c/2&&(w=1);var x={width:A+w,height:S+w,x:-Math.round(c/2+m)+Math.min(f,0)+v.x,y:-Math.round(c/2+m)+Math.min(p,0)+v.y};return d?x:this._transformedRect(x,u)},drawScene:function(h,d,u,v){var c,g,y=this.getLayer(),b=h||y.getCanvas(),f=b.getContext(),p=this._cache.canvas,_=this.sceneFunc(),P=this.hasShadow(),m=this.hasStroke();if(!this.isVisible()&&!u)return this;if(p)return f.save(),y._applyTransform(this,f,d),this._drawCachedSceneCanvas(f),f.restore(),this;if(!_)return this;if(f.save(),this._useBufferCanvas(u)&&!v){if((g=(c=this.getStage().bufferCanvas).getContext()).clear(),g.save(),g._applyLineJoin(this),!u)if(y)y._applyTransform(this,g,d);else{var A=this.getAbsoluteTransform(d).getMatrix();f.transform(A[0],A[1],A[2],A[3],A[4],A[5])}_.call(this,g,this),g.restore();var S=c.pixelRatio;P&&!b.hitCanvas?(f.save(),f._applyShadow(this),f._applyOpacity(this),f._applyGlobalCompositeOperation(this),f.drawImage(c._canvas,0,0,c.width/S,c.height/S),f.restore()):(f._applyOpacity(this),f._applyGlobalCompositeOperation(this),f.drawImage(c._canvas,0,0,c.width/S,c.height/S))}else{if(f._applyLineJoin(this),!u)if(y)y._applyTransform(this,f,d);else{var w=this.getAbsoluteTransform(d).getMatrix();f.transform(w[0],w[1],w[2],w[3],w[4],w[5])}P&&m&&!b.hitCanvas?(f.save(),u||(f._applyOpacity(this),f._applyGlobalCompositeOperation(this)),f._applyShadow(this),_.call(this,f,this),f.restore(),this.hasFill()&&this.getShadowForStrokeEnabled()&&_.call(this,f,this)):P&&!b.hitCanvas?(f.save(),u||(f._applyOpacity(this),f._applyGlobalCompositeOperation(this)),f._applyShadow(this),_.call(this,f,this),f.restore()):(u||(f._applyOpacity(this),f._applyGlobalCompositeOperation(this)),_.call(this,f,this))}return f.restore(),this},drawHit:function(h,d,u){var v=this.getLayer(),c=h||v.hitCanvas,g=c.getContext(),y=this.hitFunc()||this.sceneFunc(),b=this._cache.canvas,f=b&&b.hit;if(!this.shouldDrawHit(c)&&!u)return this;if(v&&v.clearHitCache(),f)return g.save(),v._applyTransform(this,g,d),this._drawCachedHitCanvas(g),g.restore(),this;if(!y)return this;if(g.save(),g._applyLineJoin(this),!u)if(v)v._applyTransform(this,g,d);else{var p=this.getAbsoluteTransform(d).getMatrix();g.transform(p[0],p[1],p[2],p[3],p[4],p[5])}return y.call(this,g,this),g.restore(),this},drawHitFromCache:function(h){var d,u,v,c,g,y=h||0,b=this._cache.canvas,f=this._getCachedSceneCanvas(),p=b.hit,_=p.getContext(),P=p.getWidth(),m=p.getHeight();_.clear(),_.drawImage(f._canvas,0,0,P,m);try{for(v=(u=(d=_.getImageData(0,0,P,m)).data).length,c=i.Util._hexToRgb(this.colorKey),g=0;g<v;g+=4)u[g+3]>y?(u[g]=c.r,u[g+1]=c.g,u[g+2]=c.b,u[g+3]=255):u[g+3]=0;_.putImageData(d,0,0)}catch(A){i.Util.error("Unable to draw hit graph from cached scene canvas. "+A.message)}return this}}),i.Util.extend(i.Shape,i.Node),i.Factory.addGetterSetter(i.Shape,"stroke",void 0,i.Validators.getStringValidator()),i.Factory.addGetterSetter(i.Shape,"strokeWidth",2,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"strokeHitEnabled",!0,i.Validators.getBooleanValidator()),i.Factory.addGetterSetter(i.Shape,"perfectDrawEnabled",!0,i.Validators.getBooleanValidator()),i.Factory.addGetterSetter(i.Shape,"shadowForStrokeEnabled",!0,i.Validators.getBooleanValidator()),i.Factory.addGetterSetter(i.Shape,"lineJoin"),i.Factory.addGetterSetter(i.Shape,"lineCap"),i.Factory.addGetterSetter(i.Shape,"sceneFunc"),i.Factory.addGetterSetter(i.Shape,"hitFunc"),i.Factory.addGetterSetter(i.Shape,"dash"),i.Factory.addGetterSetter(i.Shape,"dashOffset",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"shadowColor",void 0,i.Validators.getStringValidator()),i.Factory.addGetterSetter(i.Shape,"shadowBlur",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"shadowOpacity",1,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Shape,"shadowOffset",["x","y"]),i.Factory.addGetterSetter(i.Shape,"shadowOffsetX",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"shadowOffsetY",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"fillPatternImage"),i.Factory.addGetterSetter(i.Shape,"fill",void 0,i.Validators.getStringValidator()),i.Factory.addGetterSetter(i.Shape,"fillPatternX",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"fillPatternY",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"fillLinearGradientColorStops"),i.Factory.addGetterSetter(i.Shape,"strokeLinearGradientColorStops"),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientStartRadius",0),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientEndRadius",0),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientColorStops"),i.Factory.addGetterSetter(i.Shape,"fillPatternRepeat","repeat"),i.Factory.addGetterSetter(i.Shape,"fillEnabled",!0),i.Factory.addGetterSetter(i.Shape,"strokeEnabled",!0),i.Factory.addGetterSetter(i.Shape,"shadowEnabled",!0),i.Factory.addGetterSetter(i.Shape,"dashEnabled",!0),i.Factory.addGetterSetter(i.Shape,"strokeScaleEnabled",!0),i.Factory.addGetterSetter(i.Shape,"fillPriority","color"),i.Factory.addComponentsGetterSetter(i.Shape,"fillPatternOffset",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillPatternOffsetX",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"fillPatternOffsetY",0,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Shape,"fillPatternScale",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillPatternScaleX",1,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Shape,"fillPatternScaleY",1,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Shape,"fillLinearGradientStartPoint",["x","y"]),i.Factory.addComponentsGetterSetter(i.Shape,"strokeLinearGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillLinearGradientStartPointX",0),i.Factory.addGetterSetter(i.Shape,"strokeLinearGradientStartPointX",0),i.Factory.addGetterSetter(i.Shape,"fillLinearGradientStartPointY",0),i.Factory.addGetterSetter(i.Shape,"strokeLinearGradientStartPointY",0),i.Factory.addComponentsGetterSetter(i.Shape,"fillLinearGradientEndPoint",["x","y"]),i.Factory.addComponentsGetterSetter(i.Shape,"strokeLinearGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillLinearGradientEndPointX",0),i.Factory.addGetterSetter(i.Shape,"strokeLinearGradientEndPointX",0),i.Factory.addGetterSetter(i.Shape,"fillLinearGradientEndPointY",0),i.Factory.addGetterSetter(i.Shape,"strokeLinearGradientEndPointY",0),i.Factory.addComponentsGetterSetter(i.Shape,"fillRadialGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientStartPointX",0),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientStartPointY",0),i.Factory.addComponentsGetterSetter(i.Shape,"fillRadialGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientEndPointX",0),i.Factory.addGetterSetter(i.Shape,"fillRadialGradientEndPointY",0),i.Factory.addGetterSetter(i.Shape,"fillPatternRotation",0),i.Factory.backCompat(i.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),i.Collection.mapMethods(i.Shape)})(Konva)},function(k,D){(function(){"use strict";Konva.Container=function(i){this.__init(i)},Konva.Util.addMethods(Konva.Container,{__init:function(i){this.children=new Konva.Collection,Konva.Node.call(this,i)},getChildren:function(i){if(!i)return this.children;var n=new Konva.Collection;return this.children.each(function(r){i(r)&&n.push(r)}),n},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var i,n=Konva.Collection.toCollection(this.children),r=0;r<n.length;r++)delete(i=n[r]).parent,i.index=0,i.remove();return n=null,this.children=new Konva.Collection,this},destroyChildren:function(){for(var i,n=Konva.Collection.toCollection(this.children),r=0;r<n.length;r++)delete(i=n[r]).parent,i.index=0,i.destroy();return n=null,this.children=new Konva.Collection,this},add:function(i){if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}if(i.getParent())return i.moveTo(this),this;var r=this.children;return this._validateAdd(i),i.index=r.length,i.parent=this,r.push(i),this._fire("add",{child:i}),Konva.DD&&i.isDragging()&&Konva.DD.anim.setLayers(i.getLayer()),this},destroy:function(){return this.hasChildren()&&this.destroyChildren(),Konva.Node.prototype.destroy.call(this),this},find:function(i){return this._generalFind(i,!1)},findOne:function(i){var n=this._generalFind(i,!0);return n.length>0?n[0]:void 0},_generalFind:function(i,n){var r=[];return typeof i=="string"?r=this._findByString(i,n):typeof i=="function"&&(r=this._findByFunction(i,n)),Konva.Collection.toCollection(r)},_findByString:function(i){var n,r,l,e,t,a,o,s=[],h=i.replace(/ /g,"").split(","),d=h.length;for(n=0;n<d;n++){if(l=h[n],!Konva.Util.isValidSelector(l)){var u='Selector "'+l+`" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".
If you have a custom shape with such className, please change it to start with upper letter like "Triangle".
Konva is awesome, right?`;Konva.Util.warn(u)}if(l.charAt(0)==="#")(t=this._getNodeById(l.slice(1)))&&s.push(t);else if(l.charAt(0)===".")e=this._getNodesByName(l.slice(1)),s=s.concat(e);else for(o=(a=this.getChildren()).length,r=0;r<o;r++)s=s.concat(a[r]._get(l))}return s},_findByFunction:function(i,n){var r=[],l=function(e){if(!(n&&r.length>0)){var t=e.getChildren(),a=t.length;i(e)&&(r=r.concat(e));for(var o=0;o<a;o++)l(t[o])}};return l(this),r},_getNodeById:function(i){var n=Konva.ids[i];return n!==void 0&&this.isAncestorOf(n)?n:null},_getNodesByName:function(i){var n=Konva.names[i]||[];return this._getDescendants(n)},_get:function(i){for(var n=Konva.Node.prototype._get.call(this,i),r=this.getChildren(),l=r.length,e=0;e<l;e++)n=n.concat(r[e]._get(i));return n},toObject:function(){var i=Konva.Node.prototype.toObject.call(this);i.children=[];for(var n=this.getChildren(),r=n.length,l=0;l<r;l++){var e=n[l];i.children.push(e.toObject())}return i},_getDescendants:function(i){for(var n=[],r=i.length,l=0;l<r;l++){var e=i[l];this.isAncestorOf(e)&&n.push(e)}return n},isAncestorOf:function(i){for(var n=i.getParent();n;){if(n._id===this._id)return!0;n=n.getParent()}return!1},clone:function(i){var n=Konva.Node.prototype.clone.call(this,i);return this.getChildren().each(function(r){n.add(r.clone())}),n},getAllIntersections:function(i){var n=[];return this.find("Shape").each(function(r){r.isVisible()&&r.intersects(i)&&n.push(r)}),n},_setChildrenIndices:function(){this.children.each(function(i,n){i.index=n})},drawScene:function(i,n,r){var l=this.getLayer(),e=i||l&&l.getCanvas(),t=e&&e.getContext(),a=this._cache.canvas,o=a&&a.scene;return(this.isVisible()||r)&&(!r&&o?(t.save(),l._applyTransform(this,t,n),this._drawCachedSceneCanvas(t),t.restore()):this._drawChildren(e,"drawScene",n,!1,r)),this},drawHit:function(i,n,r){var l=this.getLayer(),e=i||l&&l.hitCanvas,t=e&&e.getContext(),a=this._cache.canvas,o=a&&a.hit;return(this.shouldDrawHit(e)||r)&&(l&&l.clearHitCache(),!r&&o?(t.save(),l._applyTransform(this,t,n),this._drawCachedHitCanvas(t),t.restore()):this._drawChildren(e,"drawHit",n)),this},_drawChildren:function(i,n,r,l,e){var t,a,o=this.getLayer(),s=i&&i.getContext(),h=this.getClipWidth(),d=this.getClipHeight(),u=this.getClipFunc(),v=h&&d||u;if(v&&o){s.save();var c=this.getAbsoluteTransform(r),g=c.getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),s.beginPath(),u?u.call(this,s,this):(t=this.getClipX(),a=this.getClipY(),s.rect(t,a,h,d)),s.clip(),g=c.copy().invert().getMatrix(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}this.children.each(function(y){y[n](i,r,l,e)}),v&&s.restore()},shouldDrawHit:function(i){var n=this.getLayer(),r=Konva.DD&&Konva.isDragging()&&Konva.DD.anim.getLayers().indexOf(n)!==-1;return i&&i.isCache||n&&n.hitGraphEnabled()&&this.isVisible()&&!r},getClientRect:function(i){var n,r,l,e,t,a=(i=i||{}).skipTransform,o=i.relativeTo,s=this;this.children.each(function(v){if(v.getVisible()){var c=v.getClientRect({relativeTo:s,skipShadow:i.skipShadow});c.width===0&&c.height===0||(n===void 0?(n=c.x,r=c.y,l=c.x+c.width,e=c.y+c.height):(n=Math.min(n,c.x),r=Math.min(r,c.y),l=Math.max(l,c.x+c.width),e=Math.max(e,c.y+c.height)))}});for(var h=this.find("Shape"),d=!1,u=0;u<h.length;u++)if(h[u]._isVisible(this)){d=!0;break}return t=d?{x:n,y:r,width:l-n,height:e-r}:{x:0,y:0,width:0,height:0},a?t:this._transformedRect(t,o)}}),Konva.Util.extend(Konva.Container,Konva.Node),Konva.Container.prototype.get=Konva.Container.prototype.find,Konva.Factory.addComponentsGetterSetter(Konva.Container,"clip",["x","y","width","height"]),Konva.Factory.addGetterSetter(Konva.Container,"clipX",void 0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Container,"clipY",void 0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Container,"clipWidth",void 0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Container,"clipHeight",void 0,Konva.Validators.getNumberValidator()),Konva.Factory.addGetterSetter(Konva.Container,"clipFunc"),Konva.Collection.mapMethods(Konva.Container)})()},function(k,D){(function(i){"use strict";var n="Shape",r=["id"],l=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(" "),e=["scaleXChange.konva","scaleYChange.konva"].join(" ");i.Node=function(t){this._init(t)},i.Util.addMethods(i.Node,{_init:function(t){this._id=i.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this._isUnderCache=!1,this.setAttrs(t),this.on(l,function(){this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}),this.on(e,function(){this._clearSelfAndDescendantCache("absoluteScale")}),this.on("visibleChange.konva",function(){this._clearSelfAndDescendantCache("visible")}),this.on("listeningChange.konva",function(){this._clearSelfAndDescendantCache("listening")}),this.on("opacityChange.konva",function(){this._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(t){t?delete this._cache[t]:this._cache={}},_getCache:function(t,a){return this._cache[t]===void 0&&(this._cache[t]=a.call(this)),this._cache[t]},_clearSelfAndDescendantCache:function(t){this._clearCache(t),this.children&&this.getChildren().each(function(a){a._clearSelfAndDescendantCache(t)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(t){var a=t||{},o={};a.x!==void 0&&a.y!==void 0&&a.width!==void 0&&a.height!==void 0||(o=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var s=a.width||o.width,h=a.height||o.height,d=a.pixelRatio,u=a.x===void 0?o.x:a.x,v=a.y===void 0?o.y:a.y,c=a.offset||0,g=a.drawBorder||!1;if(s&&h){s+=2*c,h+=2*c,u-=c,v-=c;var y=new i.SceneCanvas({pixelRatio:d,width:s,height:h}),b=new i.SceneCanvas({pixelRatio:d,width:s,height:h}),f=new i.HitCanvas({pixelRatio:1,width:s,height:h}),p=y.getContext(),_=f.getContext();return f.isCache=!0,this.clearCache(),p.save(),_.save(),p.translate(-u,-v),_.translate(-u,-v),this._isUnderCache=!0,this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this.drawScene(y,this,!0),this.drawHit(f,this,!0),this._isUnderCache=!1,p.restore(),_.restore(),g&&(p.save(),p.beginPath(),p.rect(0,0,s,h),p.closePath(),p.setAttr("strokeStyle","red"),p.setAttr("lineWidth",5),p.stroke(),p.restore()),this._cache.canvas={scene:y,filter:b,hit:f,x:u,y:v},this}i.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")},getClientRect:function(){throw new Error('abstract "getClientRect" method call')},_transformedRect:function(t,a){var o,s,h,d,u=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],v=this.getAbsoluteTransform(a);return u.forEach(function(c){var g=v.point(c);o===void 0&&(o=h=g.x,s=d=g.y),o=Math.min(o,g.x),s=Math.min(s,g.y),h=Math.max(h,g.x),d=Math.max(d,g.y)}),{x:o,y:s,width:h-o,height:d-s}},_drawCachedSceneCanvas:function(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this),t.translate(this._cache.canvas.x,this._cache.canvas.y);var a=this._getCachedSceneCanvas(),o=a.pixelRatio;t.drawImage(a._canvas,0,0,a.width/o,a.height/o),t.restore()},_drawCachedHitCanvas:function(t){var a=this._cache.canvas.hit;t.save(),t.translate(this._cache.canvas.x,this._cache.canvas.y),t.drawImage(a._canvas,0,0),t.restore()},_getCachedSceneCanvas:function(){var t,a,o,s,h=this.filters(),d=this._cache.canvas,u=d.scene,v=d.filter,c=v.getContext();if(h){if(!this._filterUpToDate){var g=u.pixelRatio;try{for(t=h.length,c.clear(),c.drawImage(u._canvas,0,0,u.getWidth()/g,u.getHeight()/g),a=c.getImageData(0,0,v.getWidth(),v.getHeight()),o=0;o<t;o++)typeof(s=h[o])=="function"?(s.call(this,a),c.putImageData(a,0,0)):i.Util.error("Filter should be type of function, but got "+typeof s+" insted. Please check correct filters")}catch(y){i.Util.error("Unable to apply filter. "+y.message)}this._filterUpToDate=!0}return v}return u},on:function(t,a){if(arguments.length===3)return this._delegate.apply(this,arguments);var o,s,h,d,u=t.split(" "),v=u.length;for(o=0;o<v;o++)h=(s=u[o].split("."))[0],d=s[1]||"",this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:d,handler:a});return this},off:function(t,a){var o,s,h,d,u,v=(t||"").split(" "),c=v.length;if(!t)for(s in this.eventListeners)this._off(s);for(o=0;o<c;o++)if(d=(h=v[o].split("."))[0],u=h[1],d)this.eventListeners[d]&&this._off(d,u,a);else for(s in this.eventListeners)this._off(s,u,a);return this},dispatchEvent:function(t){var a={target:this,type:t.type,evt:t};return this.fire(t.type,a),this},addEventListener:function(t,a){return this.on(t,function(o){a.call(this,o.evt)}),this},removeEventListener:function(t){return this.off(t),this},_delegate:function(t,a,o){var s=this;this.on(t,function(h){for(var d=h.target.findAncestors(a,!0,s),u=0;u<d.length;u++)(h=i.Util.cloneObject(h)).currentTarget=d[u],o.call(d[u],h)})},remove:function(){var t=this.getParent();return t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening"),this._clearSelfAndDescendantCache("absoluteOpacity"),this},destroy:function(){i._removeId(this.getId());for(var t=(this.getName()||"").split(/\s/g),a=0;a<t.length;a++){var o=t[a];i._removeName(o,this._id)}return this.remove(),this},getAttr:function(t){var a="get"+i.Util._capitalize(t);return i.Util._isFunction(this[a])?this[a]():this.attrs[t]},getAncestors:function(){for(var t=this.getParent(),a=new i.Collection;t;)a.push(t),t=t.getParent();return a},getAttrs:function(){return this.attrs||{}},setAttrs:function(t){var a,o;if(!t)return this;for(a in t)a!=="children"&&(o="set"+i.Util._capitalize(a),i.Util._isFunction(this[o])?this[o](t[a]):this._setAttr(a,t[a]));return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var t=this.getListening(),a=this.getParent();return t==="inherit"?!a||a.isListening():t},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(t){var a=this.getVisible(),o=this.getParent();return t===o&&a==="inherit"||(t===o?a:a==="inherit"?!o||o._isVisible(t):a)},shouldDrawHit:function(){var t=this.getLayer();return!t&&this.isListening()&&this.isVisible()||t&&t.hitGraphEnabled()&&this.isListening()&&this.isVisible()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){var t,a,o,s,h=this.getDepth(),d=this,u=0;return d.nodeType!=="Stage"&&function v(c){for(t=[],a=c.length,o=0;o<a;o++)s=c[o],u++,s.nodeType!==n&&(t=t.concat(s.getChildren().toArray())),s._id===d._id&&(o=a);t.length>0&&t[0].getDepth()<=h&&v(t)}(d.getStage().getChildren()),u},getDepth:function(){for(var t=0,a=this.parent;a;)t++,a=a.parent;return t},setPosition:function(t){return this.setX(t.x),this.setY(t.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(t){var a=this.getAbsoluteTransform(t).getMatrix(),o=new i.Transform,s=this.offset();return o.m=a.slice(),o.translate(s.x,s.y),o.getTranslation()},setAbsolutePosition:function(t){var a,o=this._clearTransform();return this.attrs.x=o.x,this.attrs.y=o.y,delete o.x,delete o.y,(a=this.getAbsoluteTransform()).invert(),a.translate(t.x,t.y),t={x:this.attrs.x+a.getTranslation().x,y:this.attrs.y+a.getTranslation().y},this.setPosition({x:t.x,y:t.y}),this._setTransform(o),this},_setTransform:function(t){var a;for(a in t)this.attrs[a]=t[a];this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")},_clearTransform:function(){var t={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),t},move:function(t){var a=t.x,o=t.y,s=this.getX(),h=this.getY();return a!==void 0&&(s+=a),o!==void 0&&(h+=o),this.setPosition({x:s,y:h}),this},_eachAncestorReverse:function(t,a){var o,s,h=[],d=this.getParent();if(a&&a._id===this._id)t(this);else{for(h.unshift(this);d&&(!a||d._id!==a._id);)h.unshift(d),d=d.parent;for(o=h.length,s=0;s<o;s++)t(h[s])}},rotate:function(t){return this.setRotation(this.getRotation()+t),this},moveToTop:function(){if(!this.parent)return i.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent)return i.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)},moveDown:function(){if(!this.parent)return i.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)},moveToBottom:function(){if(!this.parent)return i.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},setZIndex:function(t){if(!this.parent)return i.Util.warn("Node has no parent. zIndex parameter is ignored."),!1;var a=this.index;return this.parent.children.splice(a,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var t=this.getOpacity(),a=this.getParent();return a&&!a._isUnderCache&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){return this.getParent()!==t&&((this.__originalRemove||this.remove).call(this),t.add(this)),this},toObject:function(){var t,a,o,s,h={},d=this.getAttrs();for(t in h.attrs={},d)a=d[t],o=typeof this[t]=="function"&&this[t],delete d[t],s=o?o.call(this):null,d[t]=a,s!==a&&(h.attrs[t]=a);return h.className=this.getClassName(),i.Util._prepareToStringify(h)},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},findAncestors:function(t,a,o){var s=[];a&&this._isMatch(t)&&s.push(this);for(var h=this.parent;h;){if(h===o)return s;h._isMatch(t)&&s.push(h),h=h.parent}return s},findAncestor:function(t,a,o){return this.findAncestors(t,a,o)[0]},_isMatch:function(t){if(!t)return!1;var a,o,s=t.replace(/ /g,"").split(","),h=s.length;for(a=0;a<h;a++)if(o=s[a],i.Util.isValidSelector(o)||(i.Util.warn('Selector "'+o+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),i.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),i.Util.warn("Konva is awesome, right?")),o.charAt(0)==="#"){if(this.id()===o.slice(1))return!0}else if(o.charAt(0)==="."){if(this.hasName(o.slice(1)))return!0}else if(this._get(o).length!==0)return!0;return!1},getLayer:function(){var t=this.getParent();return t?t.getLayer():null},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var t=this.getParent();return t?t.getStage():void 0},fire:function(t,a,o){return(a=a||{}).target=a.target||this,o?this._fireAndBubble(t,a):this._fire(t,a),this},getAbsoluteTransform:function(t){return t?this._getAbsoluteTransform(t):this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(t){var a=new i.Transform;return this._eachAncestorReverse(function(o){var s=o.transformsEnabled();s==="all"?a.multiply(o.getTransform()):s==="position"&&a.translate(o.getX()-o.getOffsetX(),o.getY()-o.getOffsetY())},t),a},getAbsoluteScale:function(t){return t?this._getAbsoluteScale(t):this._getCache("absoluteScale",this._getAbsoluteScale)},_getAbsoluteScale:function(t){for(var a=this;a;)a._isUnderCache&&(t=a),a=a.getParent();var o=1,s=1;return this._eachAncestorReverse(function(h){o*=h.scaleX(),s*=h.scaleY()},t),{x:o,y:s}},getTransform:function(){return this._getCache("transform",this._getTransform)},_getTransform:function(){var t=new i.Transform,a=this.getX(),o=this.getY(),s=i.getAngle(this.getRotation()),h=this.getScaleX(),d=this.getScaleY(),u=this.getSkewX(),v=this.getSkewY(),c=this.getOffsetX(),g=this.getOffsetY();return a===0&&o===0||t.translate(a,o),s!==0&&t.rotate(s),u===0&&v===0||t.skew(u,v),h===1&&d===1||t.scale(h,d),c===0&&g===0||t.translate(-1*c,-1*g),t},clone:function(t){var a,o,s,h,d,u=i.Util.cloneObject(this.attrs);for(var v in r)delete u[r[v]];for(a in t)u[a]=t[a];var c=new this.constructor(u);for(a in this.eventListeners)for(s=(o=this.eventListeners[a]).length,h=0;h<s;h++)(d=o[h]).name.indexOf("konva")<0&&(c.eventListeners[a]||(c.eventListeners[a]=[]),c.eventListeners[a].push(d));return c},_toKonvaCanvas:function(t){t=t||{};var a=this.getClientRect(),o=this.getStage(),s=t.x!==void 0?t.x:a.x,h=t.y!==void 0?t.y:a.y,d=t.pixelRatio||1,u=new i.SceneCanvas({width:t.width||a.width||(o?o.getWidth():0),height:t.height||a.height||(o?o.getHeight():0),pixelRatio:d}),v=u.getContext();return v.save(),(s||h)&&v.translate(-1*s,-1*h),this.drawScene(u),v.restore(),u},toCanvas:function(t){return this._toKonvaCanvas(t)._canvas},toDataURL:function(t){var a=(t=t||{}).mimeType||null,o=t.quality||null,s=this._toKonvaCanvas(t).toDataURL(a,o);return t.callback&&t.callback(s),s},toImage:function(t){if(!t||!t.callback)throw"callback required for toImage method config argument";var a=t.callback;delete t.callback,i.Util._getImage(this.toDataURL(t),function(o){a(o)})},setSize:function(t){return this.setWidth(t.width),this.setHeight(t.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():i.dragDistance},_get:function(t){return this.className===t||this.nodeType===t?[this]:[]},_off:function(t,a,o){var s,h,d,u=this.eventListeners[t];for(s=0;s<u.length;s++)if(h=u[s].name,d=u[s].handler,!(h==="konva"&&a!=="konva"||a&&h!==a||o&&o!==d)){if(u.splice(s,1),u.length===0){delete this.eventListeners[t];break}s--}},_fireChangeEvent:function(t,a,o){this._fire(t+"Change",{oldVal:a,newVal:o})},setId:function(t){var a=this.getId();return i._removeId(a),i._addId(this,t),this._setAttr("id",t),this},setName:function(t){var a,o,s=(this.getName()||"").split(/\s/g),h=(t||"").split(/\s/g);for(o=0;o<s.length;o++)a=s[o],h.indexOf(a)===-1&&a&&i._removeName(a,this._id);for(o=0;o<h.length;o++)a=h[o],s.indexOf(a)===-1&&a&&i._addName(this,a);return this._setAttr("name",t),this},addName:function(t){if(!this.hasName(t)){var a=this.name(),o=a?a+" "+t:t;this.setName(o)}return this},hasName:function(t){return(this.name()||"").split(/\s/g).indexOf(t)!==-1},removeName:function(t){var a=(this.name()||"").split(/\s/g),o=a.indexOf(t);return o!==-1&&(a.splice(o,1),this.setName(a.join(" "))),this},setAttr:function(t,a){var o=this["set"+i.Util._capitalize(t)];return i.Util._isFunction(o)?o.call(this,a):this._setAttr(t,a),this},_setAttr:function(t,a){var o;(o=this.attrs[t])===a&&!i.Util.isObject(a)||(a==null?delete this.attrs[t]:this.attrs[t]=a,this._fireChangeEvent(t,o,a))},_setComponentAttr:function(t,a,o){var s;o!==void 0&&((s=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][a]=o,this._fireChangeEvent(t,s,o))},_fireAndBubble:function(t,a,o){var s=!0;if(a&&this.nodeType===n&&(a.target=this),(t==="mouseenter"&&o&&(this._id===o._id||this.isAncestorOf&&this.isAncestorOf(o))||t==="mouseleave"&&o&&(this._id===o._id||this.isAncestorOf&&this.isAncestorOf(o)))&&(s=!1),s){this._fire(t,a);var h=(t==="mouseenter"||t==="mouseleave")&&o&&o.isAncestorOf&&o.isAncestorOf(this)&&!o.isAncestorOf(this.parent);(a&&!a.cancelBubble||!a)&&this.parent&&this.parent.isListening()&&!h&&(o&&o.parent?this._fireAndBubble.call(this.parent,t,a,o.parent):this._fireAndBubble.call(this.parent,t,a))}},_fire:function(t,a){var o,s=this.eventListeners[t];if((a=a||{}).currentTarget=this,a.type=t,s)for(o=0;o<s.length;o++)s[o].handler.call(this,a)},draw:function(){return this.drawScene(),this.drawHit(),this}}),i.Node.create=function(t,a){return i.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,a)},i.Node._createNode=function(t,a){var o,s,h,d=i.Node.prototype.getClassName.call(t),u=t.children;if(a&&(t.attrs.container=a),o=new i[d](t.attrs),u)for(s=u.length,h=0;h<s;h++)o.add(this._createNode(u[h]));return o},i.Factory.addOverloadedGetterSetter(i.Node,"position"),i.Factory.addGetterSetter(i.Node,"x",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Node,"y",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Node,"globalCompositeOperation","source-over",i.Validators.getStringValidator()),i.Factory.addGetterSetter(i.Node,"opacity",1,i.Validators.getNumberValidator()),i.Factory.addGetter(i.Node,"name"),i.Factory.addOverloadedGetterSetter(i.Node,"name"),i.Factory.addGetter(i.Node,"id"),i.Factory.addOverloadedGetterSetter(i.Node,"id"),i.Factory.addGetterSetter(i.Node,"rotation",0,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Node,"scale",["x","y"]),i.Factory.addGetterSetter(i.Node,"scaleX",1,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Node,"scaleY",1,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Node,"skew",["x","y"]),i.Factory.addGetterSetter(i.Node,"skewX",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Node,"skewY",0,i.Validators.getNumberValidator()),i.Factory.addComponentsGetterSetter(i.Node,"offset",["x","y"]),i.Factory.addGetterSetter(i.Node,"offsetX",0,i.Validators.getNumberValidator()),i.Factory.addGetterSetter(i.Node,"offsetY",0,i.Validators.getNumberValidator()),i.Factory.addSetter(i.Node,"dragDistance",i.Validators.getNumberValidator()),i.Factory.addOverloadedGetterSetter(i.Node,"dragDistance"),i.Factory.addSetter(i.Node,"width",i.Validators.getNumberValidator()),i.Factory.addOverloadedGetterSetter(i.Node,"width"),i.Factory.addSetter(i.Node,"height",i.Validators.getNumberValidator()),i.Factory.addOverloadedGetterSetter(i.Node,"height"),i.Factory.addGetterSetter(i.Node,"listening","inherit",function(t){return t===!0||t===!1||t==="inherit"||i.Util.warn(t+' is a not valid value for "listening" attribute. The value may be true, false or "inherit".'),t}),i.Factory.addGetterSetter(i.Node,"preventDefault",!0,i.Validators.getBooleanValidator()),i.Factory.addGetterSetter(i.Node,"filters",null,function(t){return this._filterUpToDate=!1,t}),i.Factory.addGetterSetter(i.Node,"visible","inherit",function(t){return t===!0||t===!1||t==="inherit"||i.Util.warn(t+' is a not valid value for "visible" attribute. The value may be true, false or "inherit".'),t}),i.Factory.addGetterSetter(i.Node,"transformsEnabled","all",i.Validators.getStringValidator()),i.Factory.addOverloadedGetterSetter(i.Node,"size"),i.Factory.backCompat(i.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),i.Collection.mapMethods(i.Node)})(Konva)},function(k,D){(function(){"use strict";Konva.Factory={addGetterSetter:function(i,n,r,l,e){this.addGetter(i,n,r),this.addSetter(i,n,l,e),this.addOverloadedGetterSetter(i,n)},addGetter:function(i,n,r){var l="get"+Konva.Util._capitalize(n);i.prototype[l]=function(){var e=this.attrs[n];return e===void 0?r:e}},addSetter:function(i,n,r,l){var e="set"+Konva.Util._capitalize(n);i.prototype[e]=function(t){return r&&t!==void 0&&t!==null&&(t=r.call(this,t,n)),this._setAttr(n,t),l&&l.call(this),this}},addComponentsGetterSetter:function(i,n,r,l,e){var t,a,o=r.length,s=Konva.Util._capitalize,h="get"+s(n),d="set"+s(n);i.prototype[h]=function(){var u={};for(t=0;t<o;t++)u[a=r[t]]=this.getAttr(n+s(a));return u},i.prototype[d]=function(u){var v,c=this.attrs[n];for(v in l&&(u=l.call(this,u)),u)u.hasOwnProperty(v)&&this._setAttr(n+s(v),u[v]);return this._fireChangeEvent(n,c,u),e&&e.call(this),this},this.addOverloadedGetterSetter(i,n)},addOverloadedGetterSetter:function(i,n){var r=Konva.Util._capitalize(n),l="set"+r,e="get"+r;i.prototype[n]=function(){return arguments.length?(this[l](arguments[0]),this):this[e]()}},addDeprecatedGetterSetter:function(i,n,r,l){Konva.Util.error("Adding deprecated "+n);var e="get"+Konva.Util._capitalize(n),t=n+" property is deprecated and will be removed soon. Look at Konva change log for more information.";i.prototype[e]=function(){Konva.Util.error(t);var a=this.attrs[n];return a===void 0?r:a},this.addSetter(i,n,l,function(){Konva.Util.error(t)}),this.addOverloadedGetterSetter(i,n)},backCompat:function(i,n){Konva.Util.each(n,function(r,l){var e=i.prototype[l],t="get"+Konva.Util._capitalize(r),a="set"+Konva.Util._capitalize(r);function o(){e.apply(this,arguments),Konva.Util.error('"'+r+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}i.prototype[r]=o,i.prototype[t]=o,i.prototype[a]=o})},afterSetFilter:function(){this._filterUpToDate=!1}},Konva.Validators={RGBComponent:function(i){return i>255?255:i<0?0:Math.round(i)},alphaComponent:function(i){return i>1?1:i<1e-4?1e-4:i},_formatValue:function(i){return Konva.Util._isString(i)?'"'+i+'"':Object.prototype.toString.call(i)==="[object Number]"||Konva.Util._isBoolean(i)?i:Object.prototype.toString.call(i)},getNumberValidator:function(){if(Konva.isUnminified)return function(i,n){return Konva.Util._isNumber(i)||Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a number.'),i}},getNumberOrAutoValidator:function(){if(Konva.isUnminified)return function(i,n){return Konva.Util._isNumber(i)||i==="auto"||Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a number or "auto".'),i}},getStringValidator:function(){if(Konva.isUnminified)return function(i,n){return Konva.Util._isString(i)||Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a string.'),i}},getFunctionValidator:function(){if(Konva.isUnminified)return function(i,n){return Konva.Util._isFunction(i)||Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a function.'),i}},getNumberArrayValidator:function(){if(Konva.isUnminified)return function(i,n){return Konva.Util._isArray(i)?i.forEach(function(r){Konva.Util._isNumber(r)||Konva.Util.warn('"'+n+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a array of numbers.'),i}},getBooleanValidator:function(){if(Konva.isUnminified)return function(i,n){return i===!0||i===!1||Konva.Util.warn(Konva.Validators._formatValue(i)+' is a not valid value for "'+n+'" attribute. The value should be a boolean.'),i}}}})()},function(k,D){(function(){"use strict";var i=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Konva.Context=function(n){this.init(n)},Konva.Context.prototype={init:function(n){this.canvas=n,this._context=n._canvas.getContext("2d"),Konva.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(n){n.getFillEnabled()&&this._fill(n)},strokeShape:function(n){n.getStrokeEnabled()&&this._stroke(n)},fillStrokeShape:function(n){n.getFillEnabled()&&this._fill(n),n.getStrokeEnabled()&&this._stroke(n)},getTrace:function(n){var r,l,e,t,a=this.traceArr,o=a.length,s="";for(r=0;r<o;r++)(e=(l=a[r]).method)?(t=l.args,s+=e,n?s+="()":Konva.Util._isArray(t[0])?s+="(["+t.join(",")+"])":s+="("+t.join(",")+")"):(s+=l.property,n||(s+="="+l.val)),s+=";";return s},clearTrace:function(){this.traceArr=[]},_trace:function(n){var r=this.traceArr;r.push(n),r.length>=Konva.traceArrMax&&r.shift()},reset:function(){var n=this.getCanvas().getPixelRatio();this.setTransform(1*n,0,0,1*n,0,0)},getCanvas:function(){return this.canvas},clear:function(n){var r=this.getCanvas();n?this.clearRect(n.x||0,n.y||0,n.width||0,n.height||0):this.clearRect(0,0,r.getWidth()/r.pixelRatio,r.getHeight()/r.pixelRatio)},_applyLineCap:function(n){var r=n.getLineCap();r&&this.setAttr("lineCap",r)},_applyOpacity:function(n){var r=n.getAbsoluteOpacity();r!==1&&this.setAttr("globalAlpha",r)},_applyLineJoin:function(n){var r=n.getLineJoin();r&&this.setAttr("lineJoin",r)},setAttr:function(n,r){this._context[n]=r},arc:function(){var n=arguments;this._context.arc(n[0],n[1],n[2],n[3],n[4],n[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var n=arguments;this._context.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])},clearRect:function(){var n=arguments;this._context.clearRect(n[0],n[1],n[2],n[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var n=arguments;return n.length===2?this._context.createImageData(n[0],n[1]):n.length===1?this._context.createImageData(n[0]):void 0},createLinearGradient:function(){var n=arguments;return this._context.createLinearGradient(n[0],n[1],n[2],n[3])},createPattern:function(){var n=arguments;return this._context.createPattern(n[0],n[1])},createRadialGradient:function(){var n=arguments;return this._context.createRadialGradient(n[0],n[1],n[2],n[3],n[4],n[5])},drawImage:function(){var n=arguments,r=this._context;n.length===3?r.drawImage(n[0],n[1],n[2]):n.length===5?r.drawImage(n[0],n[1],n[2],n[3],n[4]):n.length===9&&r.drawImage(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},isPointInPath:function(n,r){return this._context.isPointInPath(n,r)},fill:function(){this._context.fill()},fillRect:function(n,r,l,e){this._context.fillRect(n,r,l,e)},strokeRect:function(n,r,l,e){this._context.strokeRect(n,r,l,e)},fillText:function(){var n=arguments;this._context.fillText(n[0],n[1],n[2])},measureText:function(n){return this._context.measureText(n)},getImageData:function(){var n=arguments;return this._context.getImageData(n[0],n[1],n[2],n[3])},lineTo:function(){var n=arguments;this._context.lineTo(n[0],n[1])},moveTo:function(){var n=arguments;this._context.moveTo(n[0],n[1])},rect:function(){var n=arguments;this._context.rect(n[0],n[1],n[2],n[3])},putImageData:function(){var n=arguments;this._context.putImageData(n[0],n[1],n[2])},quadraticCurveTo:function(){var n=arguments;this._context.quadraticCurveTo(n[0],n[1],n[2],n[3])},restore:function(){this._context.restore()},rotate:function(){var n=arguments;this._context.rotate(n[0])},save:function(){this._context.save()},scale:function(){var n=arguments;this._context.scale(n[0],n[1])},setLineDash:function(){var n=arguments,r=this._context;this._context.setLineDash?r.setLineDash(n[0]):"mozDash"in r?r.mozDash=n[0]:"webkitLineDash"in r&&(r.webkitLineDash=n[0])},getLineDash:function(){return this._context.getLineDash()},setTransform:function(){var n=arguments;this._context.setTransform(n[0],n[1],n[2],n[3],n[4],n[5])},stroke:function(){this._context.stroke()},strokeText:function(){var n=arguments;this._context.strokeText(n[0],n[1],n[2])},transform:function(){var n=arguments;this._context.transform(n[0],n[1],n[2],n[3],n[4],n[5])},translate:function(){var n=arguments;this._context.translate(n[0],n[1])},_enableTrace:function(){var n,r,l=this,e=i.length,t=Konva.Util._simplifyArray,a=this.setAttr,o=function(s){var h,d=l[s];l[s]=function(){return r=t(Array.prototype.slice.call(arguments,0)),h=d.apply(l,arguments),l._trace({method:s,args:r}),h}};for(n=0;n<e;n++)o(i[n]);l.setAttr=function(){a.apply(l,arguments);var s=arguments[0],h=arguments[1];s!=="shadowOffsetX"&&s!=="shadowOffsetY"&&s!=="shadowBlur"||(h/=this.canvas.getPixelRatio()),l._trace({property:s,val:h})}}},["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation"].forEach(function(n){Object.defineProperty(Konva.Context.prototype,n,{get:function(){return this._context[n]},set:function(r){this._context[n]=r}})}),Konva.SceneContext=function(n){Konva.Context.call(this,n)},Konva.SceneContext.prototype={_fillColor:function(n){var r=n.fill();this.setAttr("fillStyle",r),n._fillFunc(this)},_fillPattern:function(n){var r=n.getFillPatternX(),l=n.getFillPatternY(),e=n.getFillPatternScale(),t=Konva.getAngle(n.getFillPatternRotation()),a=n.getFillPatternOffset();(r||l)&&this.translate(r||0,l||0),t&&this.rotate(t),e&&this.scale(e.x,e.y),a&&this.translate(-1*a.x,-1*a.y),this.setAttr("fillStyle",this.createPattern(n.getFillPatternImage(),n.getFillPatternRepeat()||"repeat")),this.fill()},_fillLinearGradient:function(n){var r=n.getFillLinearGradientStartPoint(),l=n.getFillLinearGradientEndPoint(),e=n.getFillLinearGradientColorStops(),t=this.createLinearGradient(r.x,r.y,l.x,l.y);if(e){for(var a=0;a<e.length;a+=2)t.addColorStop(e[a],e[a+1]);this.setAttr("fillStyle",t),n._fillFunc(this)}},_fillRadialGradient:function(n){for(var r=n.getFillRadialGradientStartPoint(),l=n.getFillRadialGradientEndPoint(),e=n.getFillRadialGradientStartRadius(),t=n.getFillRadialGradientEndRadius(),a=n.getFillRadialGradientColorStops(),o=this.createRadialGradient(r.x,r.y,e,l.x,l.y,t),s=0;s<a.length;s+=2)o.addColorStop(a[s],a[s+1]);this.setAttr("fillStyle",o),this.fill()},_fill:function(n){var r=n.fill(),l=n.getFillPriority();if(r&&l==="color")this._fillColor(n);else{var e=n.getFillPatternImage();if(e&&l==="pattern")this._fillPattern(n);else{var t=n.getFillLinearGradientColorStops();if(t&&l==="linear-gradient")this._fillLinearGradient(n);else{var a=n.getFillRadialGradientColorStops();a&&l==="radial-gradient"?this._fillRadialGradient(n):r?this._fillColor(n):e?this._fillPattern(n):t?this._fillLinearGradient(n):a&&this._fillRadialGradient(n)}}}},_strokeLinearGradient:function(n){var r=n.getStrokeLinearGradientStartPoint(),l=n.getStrokeLinearGradientEndPoint(),e=n.getStrokeLinearGradientColorStops(),t=this.createLinearGradient(r.x,r.y,l.x,l.y);if(e){for(var a=0;a<e.length;a+=2)t.addColorStop(e[a],e[a+1]);this.setAttr("strokeStyle",t)}},_stroke:function(n){var r=n.dash(),l=n.getStrokeScaleEnabled()||n instanceof Konva.Text;n.hasStroke()&&(l||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(n),r&&n.dashEnabled()&&(this.setLineDash(r),this.setAttr("lineDashOffset",n.dashOffset())),this.setAttr("lineWidth",n.strokeWidth()),n.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),n.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(n):this.setAttr("strokeStyle",n.stroke()),n._strokeFunc(this),l||this.restore())},_applyShadow:function(n){var r=Konva.Util,l=r.get(n.getShadowRGBA(),"black"),e=r.get(n.getShadowBlur(),5),t=r.get(n.getShadowOffset(),{x:0,y:0}),a=n.getAbsoluteScale(),o=this.canvas.getPixelRatio(),s=a.x*o,h=a.y*o;this.setAttr("shadowColor",l),this.setAttr("shadowBlur",e*Math.min(Math.abs(s),Math.abs(h))),this.setAttr("shadowOffsetX",t.x*s),this.setAttr("shadowOffsetY",t.y*h)},_applyGlobalCompositeOperation:function(n){var r=n.getGlobalCompositeOperation();r!=="source-over"&&this.setAttr("globalCompositeOperation",r)}},Konva.Util.extend(Konva.SceneContext,Konva.Context),Konva.HitContext=function(n){Konva.Context.call(this,n)},Konva.HitContext.prototype={_fill:function(n){this.save(),this.setAttr("fillStyle",n.colorKey),n._fillFuncHit(this),this.restore()},_stroke:function(n){if(n.hasStroke()&&n.strokeHitEnabled()){var r=n.getStrokeScaleEnabled()||n instanceof Konva.Text;r||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(n),this.setAttr("lineWidth",n.strokeWidth()),this.setAttr("strokeStyle",n.colorKey),n._strokeFuncHit(this),r||this.restore()}}},Konva.Util.extend(Konva.HitContext,Konva.Context)})()},function(k,D){(function(){"use strict";var i;Konva.Canvas=function(n){this.init(n)},Konva.Canvas.prototype={init:function(n){var r=(n||{}).pixelRatio||Konva.pixelRatio||function(){if(i)return i;var l=Konva.Util.createCanvasElement().getContext("2d");return i=(Konva.window.devicePixelRatio||1)/(l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1)}();this.pixelRatio=r,this._canvas=Konva.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(n){var r=this.pixelRatio;this.pixelRatio=n,this.setSize(this.getWidth()/r,this.getHeight()/r)},setWidth:function(n){this.width=this._canvas.width=n*this.pixelRatio,this._canvas.style.width=n+"px";var r=this.pixelRatio;this.getContext()._context.scale(r,r)},setHeight:function(n){this.height=this._canvas.height=n*this.pixelRatio,this._canvas.style.height=n+"px";var r=this.pixelRatio;this.getContext()._context.scale(r,r)},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(n,r){this.setWidth(n),this.setHeight(r)},toDataURL:function(n,r){try{return this._canvas.toDataURL(n,r)}catch(l){try{return this._canvas.toDataURL()}catch(e){return Konva.Util.warn("Unable to get data URL. "+e.message),""}}}},Konva.SceneCanvas=function(n){var r=n||{},l=r.width||0,e=r.height||0;Konva.Canvas.call(this,r),this.context=new Konva.SceneContext(this),this.setSize(l,e)},Konva.Util.extend(Konva.SceneCanvas,Konva.Canvas),Konva.HitCanvas=function(n){var r=n||{},l=r.width||0,e=r.height||0;Konva.Canvas.call(this,r),this.context=new Konva.HitContext(this),this.setSize(l,e),this.hitCanvas=!0},Konva.Util.extend(Konva.HitCanvas,Konva.Canvas)})()},function(k,D){(function(){"use strict";Konva.Collection=function(){var e=[].slice.call(arguments),t=e.length,a=0;for(this.length=t;a<t;a++)this[a]=e[a];return this},Konva.Collection.prototype=[],Konva.Collection.prototype.each=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},Konva.Collection.prototype.toArray=function(){var e,t=[],a=this.length;for(e=0;e<a;e++)t.push(this[e]);return t},Konva.Collection.toCollection=function(e){var t,a=new Konva.Collection,o=e.length;for(t=0;t<o;t++)a.push(e[t]);return a},Konva.Collection._mapMethod=function(e){Konva.Collection.prototype[e]=function(){var t,a=this.length,o=[].slice.call(arguments);for(t=0;t<a;t++)this[t][e].apply(this[t],o);return this}},Konva.Collection.mapMethods=function(e){var t=e.prototype;for(var a in t)Konva.Collection._mapMethod(a)},Konva.Transform=function(e){this.m=e&&e.slice()||[1,0,0,1,0,0]},Konva.Transform.prototype={copy:function(){return new Konva.Transform(this.m)},point:function(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}},translate:function(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this},scale:function(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this},rotate:function(e){var t=Math.cos(e),a=Math.sin(e),o=this.m[0]*t+this.m[2]*a,s=this.m[1]*t+this.m[3]*a,h=this.m[0]*-a+this.m[2]*t,d=this.m[1]*-a+this.m[3]*t;return this.m[0]=o,this.m[1]=s,this.m[2]=h,this.m[3]=d,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(e,t){var a=this.m[0]+this.m[2]*t,o=this.m[1]+this.m[3]*t,s=this.m[2]+this.m[0]*e,h=this.m[3]+this.m[1]*e;return this.m[0]=a,this.m[1]=o,this.m[2]=s,this.m[3]=h,this},multiply:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],a=this.m[1]*e.m[0]+this.m[3]*e.m[1],o=this.m[0]*e.m[2]+this.m[2]*e.m[3],s=this.m[1]*e.m[2]+this.m[3]*e.m[3],h=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],d=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=a,this.m[2]=o,this.m[3]=s,this.m[4]=h,this.m[5]=d,this},invert:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,a=-this.m[1]*e,o=-this.m[2]*e,s=this.m[0]*e,h=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),d=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=a,this.m[2]=o,this.m[3]=s,this.m[4]=h,this.m[5]=d,this},getMatrix:function(){return this.m},setAbsolutePosition:function(e,t){var a=this.m[0],o=this.m[1],s=this.m[2],h=this.m[3],d=this.m[4],u=(a*(t-this.m[5])-o*(e-d))/(a*h-o*s),v=(e-d-s*u)/a;return this.translate(v,u)}};var i=Math.PI/180,n=180/Math.PI,r={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},l=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Konva.Util={_isElement:function(e){return!(!e||e.nodeType!=1)},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isObject:function(e){return!!e&&e.constructor===Object},_isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},_isNumber:function(e){return Object.prototype.toString.call(e)==="[object Number]"&&!isNaN(e)&&isFinite(e)},_isString:function(e){return Object.prototype.toString.call(e)==="[object String]"},_isBoolean:function(e){return Object.prototype.toString.call(e)==="[object Boolean]"},isObject:function(e){return e instanceof Object},isValidSelector:function(e){if(typeof e!="string")return!1;var t=e[0];return t==="#"||t==="."||t===t.toUpperCase()},_sign:function(e){return e===0?0:e>0?1:-1},createCanvasElement:function(){var e=Konva.isBrowser?Konva.document.createElement("canvas"):new Konva._nodeCanvas;try{e.style=e.style||{}}catch(t){}return e},_isInDocument:function(e){for(;e=e.parentNode;)if(e==Konva.document)return!0;return!1},_simplifyArray:function(e){var t,a,o=[],s=e.length,h=Konva.Util;for(t=0;t<s;t++)a=e[t],h._isNumber(a)?a=Math.round(1e3*a)/1e3:h._isString(a)||(a=a.toString()),o.push(a);return o},_getImage:function(e,t){var a,o;e?this._isElement(e)?t(e):this._isString(e)?((a=new Konva.window.Image).onload=function(){t(a)},a.src=e):e.data?((o=Konva.Util.createCanvasElement()).width=e.width,o.height=e.height,o.getContext("2d").putImageData(e,0,0),this._getImage(o.toDataURL(),t)):t(null):t(null)},_getRGBAString:function(e){return["rgba(",e.red||0,",",e.green||0,",",e.blue||0,",",e.alpha||1,")"].join("")},_rgbToHex:function(e,t,a){return((1<<24)+(e<<16)+(t<<8)+a).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace("#","");var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},getRandomColor:function(){for(var e=(16777215*Math.random()<<0).toString(16);e.length<6;)e="0"+e;return"#"+e},get:function(e,t){return e===void 0?t:e},getRGB:function(e){var t;return e in r?{r:(t=r[e])[0],g:t[1],b:t[2]}:e[0]==="#"?this._hexToRgb(e.substring(1)):e.substr(0,4)==="rgb("?(t=l.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(e){return e=e||"black",Konva.Util._namedColorToRBA(e)||Konva.Util._hex3ColorToRGBA(e)||Konva.Util._hex6ColorToRGBA(e)||Konva.Util._rgbColorToRGBA(e)||Konva.Util._rgbaColorToRGBA(e)},_namedColorToRBA:function(e){var t=r[e.toLowerCase()];return t?{r:t[0],g:t[1],b:t[2],a:1}:null},_rgbColorToRGBA:function(e){if(e.indexOf("rgb(")===0){var t=(e=e.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:1}}},_rgbaColorToRGBA:function(e){if(e.indexOf("rgba(")===0){var t=(e=e.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:t[3]}}},_hex6ColorToRGBA:function(e){if(e[0]==="#"&&e.length===7)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(e){if(e[0]==="#"&&e.length===4)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:1}},_merge:function(e,t){var a=this._clone(t);for(var o in e)this._isObject(e[o])?a[o]=this._merge(e[o],a[o]):a[o]=e[o];return a},trimRight:function(e){return e.replace(/\s+$/,"")},trimLeft:function(e){return e.replace(/^\s+/,"")},haveIntersection:function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},cloneObject:function(e){var t={};for(var a in e)this._isObject(e[a])?t[a]=this.cloneObject(e[a]):this._isArray(e[a])?t[a]=this.cloneArray(e[a]):t[a]=e[a];return t},cloneArray:function(e){return e.slice(0)},_degToRad:function(e){return e*i},_radToDeg:function(e){return e*n},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},throw:function(e){throw new Error("Konva error: "+e)},error:function(e){console.error("Konva error: "+e)},warn:function(e){Konva.global.console&&console.warn&&Konva.showWarnings&&console.warn("Konva warning: "+e)},extend:function(e,t){function a(){this.constructor=e}a.prototype=t.prototype;var o=e.prototype;for(var s in e.prototype=new a,o)o.hasOwnProperty(s)&&(e.prototype[s]=o[s]);e.__super__=t.prototype,e.super=t},addMethods:function(e,t){var a;for(a in t)e.prototype[a]=t[a]},_getControlPoints:function(e,t,a,o,s,h,d){var u=Math.sqrt(Math.pow(a-e,2)+Math.pow(o-t,2)),v=Math.sqrt(Math.pow(s-a,2)+Math.pow(h-o,2)),c=d*u/(u+v),g=d*v/(u+v);return[a-c*(s-e),o-c*(h-t),a+g*(s-e),o+g*(h-t)]},_expandPoints:function(e,t){var a,o,s=e.length,h=[];for(a=2;a<s-2;a+=2)o=Konva.Util._getControlPoints(e[a-2],e[a-1],e[a],e[a+1],e[a+2],e[a+3],t),h.push(o[0]),h.push(o[1]),h.push(e[a]),h.push(e[a+1]),h.push(o[2]),h.push(o[3]);return h},_removeLastLetter:function(e){return e.substring(0,e.length-1)},each:function(e,t){for(var a in e)t(a,e[a])},_inRange:function(e,t,a){return t<=e&&e<a},_getProjectionToSegment:function(e,t,a,o,s,h){var d,u,v,c=(e-a)*(e-a)+(t-o)*(t-o);if(c==0)d=e,u=t,v=(s-a)*(s-a)+(h-o)*(h-o);else{var g=((s-e)*(a-e)+(h-t)*(o-t))/c;g<0?(d=e,u=t,v=(e-s)*(e-s)+(t-h)*(t-h)):g>1?(d=a,u=o,v=(a-s)*(a-s)+(o-h)*(o-h)):v=((d=e+g*(a-e))-s)*(d-s)+((u=t+g*(o-t))-h)*(u-h)}return[d,u,v]},_getProjectionToLine:function(e,t,a){var o=Konva.Util.cloneObject(e),s=Number.MAX_VALUE;return t.forEach(function(h,d){if(a||d!==t.length-1){var u=t[(d+1)%t.length],v=Konva.Util._getProjectionToSegment(h.x,h.y,u.x,u.y,e.x,e.y),c=v[0],g=v[1],y=v[2];y<s&&(o.x=c,o.y=g,s=y)}}),o},_prepareArrayForTween:function(e,t,a){var o,s=[],h=[];if(e.length>t.length){var d=t;t=e,e=d}for(o=0;o<e.length;o+=2)s.push({x:e[o],y:e[o+1]});for(o=0;o<t.length;o+=2)h.push({x:t[o],y:t[o+1]});var u=[];return h.forEach(function(v){var c=Konva.Util._getProjectionToLine(v,s,a);u.push(c.x),u.push(c.y)}),u},_prepareToStringify:function(e){var t;for(var a in e.visitedByCircularReferenceRemoval=!0,e)if(e.hasOwnProperty(a)&&e[a]&&typeof e[a]=="object"){if(t=Object.getOwnPropertyDescriptor(e,a),e[a].visitedByCircularReferenceRemoval||Konva.Util._isElement(e[a])){if(!t.configurable)return null;delete e[a]}else if(Konva.Util._prepareToStringify(e[a])===null){if(!t.configurable)return null;delete e[a]}}return delete e.visitedByCircularReferenceRemoval,e}}})()},function(k,D){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(n){typeof window=="object"&&(i=window)}k.exports=i},function(k,D,i){(function(n){(function(){"use strict";var r=Math.PI/180,l={version:"@@version",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,isBrowser:typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]"),isUnminified:/comment/.test(function(){}),enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,Filters:{},isDragging:function(){var t=l.DD;return!!t&&t.isDragging},isDragReady:function(){var t=l.DD;return!!t&&!!t.node},_addId:function(t,a){a&&(this.ids[a]=t)},_removeId:function(t){t!==void 0&&delete this.ids[t]},_addName:function(t,a){a&&(this.names[a]||(this.names[a]=[]),this.names[a].push(t))},_removeName:function(t,a){if(t){var o=this.names[t];if(o){for(var s=0;s<o.length;s++)o[s]._id===a&&o.splice(s,1);o.length===0&&delete this.names[t]}}},getAngle:function(t){return this.angleDeg?t*r:t},_detectIE:function(t){var a=t.indexOf("msie ");if(a>0)return parseInt(t.substring(a+5,t.indexOf(".",a)),10);if(t.indexOf("trident/")>0){var o=t.indexOf("rv:");return parseInt(t.substring(o+3,t.indexOf(".",o)),10)}var s=t.indexOf("edge/");return s>0&&parseInt(t.substring(s+5,t.indexOf(".",s)),10)},_parseUA:function(t){var a=t.toLowerCase(),o=/(chrome)[ /]([\w.]+)/.exec(a)||/(webkit)[ /]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],s=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),h=!!t.match(/IEMobile/i);return{browser:o[1]||"",version:o[2]||"0",isIE:l._detectIE(a),mobile:s,ieMobile:h}},UA:void 0},e=n!==void 0?n:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{};l.UA=l._parseUA(e.navigator&&e.navigator.userAgent||""),e.Konva&&console.error("Konva instance is already exist in current eviroment. Please use only one instance."),e.Konva=l,l.global=e,l.window=e,l.document=e.document,k.exports=l})()}).call(this,i(20))},function(k,D,i){"use strict";i.r(D);var n=i(0),r=i.n(n),l=i(1),e=i.n(l);function t(c){return(t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g})(c)}function a(c){for(var g=1;g<arguments.length;g++){var y=arguments[g]!=null?arguments[g]:{},b=Object.keys(y);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(y).filter(function(f){return Object.getOwnPropertyDescriptor(y,f).enumerable}))),b.forEach(function(f){u(c,f,y[f])})}return c}function o(c,g){for(var y=0;y<g.length;y++){var b=g[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(c,b.key,b)}}function s(c){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)})(c)}function h(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function d(c,g){return(d=Object.setPrototypeOf||function(y,b){return y.__proto__=b,y})(c,g)}function u(c,g,y){return g in c?Object.defineProperty(c,g,{value:y,enumerable:!0,configurable:!0,writable:!0}):c[g]=y,c}i(7),i(6),i(5),i(4),i(3),i(2);var v=function(c){function g(f){var p,_;(function(A,S){if(!(A instanceof S))throw new TypeError("Cannot call a class as a function")})(this,g);var P=(p=!(_=s(g).call(this,f))||t(_)!=="object"&&typeof _!="function"?h(this):_).generateHash("avatar_container"),m=p.generateHash("avatar_loader");return p.onFileLoad=p.onFileLoad.bind(h(p)),p.onCloseClick=p.onCloseClick.bind(h(p)),p.state={imgWidth:0,imgHeight:0,scale:1,containerId:P,loaderId:m,lastMouseY:0,showLoader:!(p.props.src||p.props.img)},p}var y,b;return function(f,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(p&&p.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),p&&d(f,p)}(g,r.a.Component),y=g,(b=[{key:"generateHash",value:function(f){var p=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return f+"-"+p()+"-"+p()+"-"+p()}},{key:"onCloseCallback",value:function(){this.props.onClose()}},{key:"onCropCallback",value:function(f){this.props.onCrop(f)}},{key:"onFileLoadCallback",value:function(f){this.props.onFileLoad(f)}},{key:"onBeforeFileLoadCallback",value:function(f){this.props.onBeforeFileLoad(f)}},{key:"onImageLoadCallback",value:function(f){this.props.onImageLoad(f)}},{key:"componentDidMount",value:function(){var f=this;if(!this.state.showLoader){var p=this.props.img||new Image;!this.props.img&&this.props.src&&(p.src=this.props.src),this.setState({image:p},function(){if(f.image.complete)return f.init();f.image.onload=function(){f.onImageLoadCallback(f.image),f.init()}})}}},{key:"onFileLoad",value:function(f){if(f.preventDefault(),this.onBeforeFileLoadCallback(f),f.target.value){var p=new FileReader,_=f.target.files[0];this.onFileLoadCallback(_);var P=new Image,m=this;p.onloadend=function(){P.src=p.result,m.setState({image:P,file:_,showLoader:!1},function(){if(m.image.complete)return m.init();m.image.onload=function(){return m.init()}})},p.readAsDataURL(_)}}},{key:"onCloseClick",value:function(){var f=this;this.setState({showLoader:!0},function(){return f.onCloseCallback()})}},{key:"init",value:function(){var f,p,_=this.props,P=_.height,m=_.minCropRadius,A=_.cropRadius,S=this.image.width,w=this.image.height,x=w/S,F=this.props,L=F.imageWidth,K=F.imageHeight;K&&L&&console.warn("The imageWidth and imageHeight properties can not be set together, using only imageWidth."),K&&!L?p=(f=K||w)/x:L?f=(p=L)*x||w:p=(f=P||w)/x;var O=f/w,N=Math.max(m,A||Math.min(p,f)/3);this.setState({imgWidth:p,imgHeight:f,scale:O,cropRadius:N},this.initCanvas)}},{key:"initCanvas",value:function(){var f=this,p=this.initStage(),_=this.initBackground(),P=this.initShading(),m=this.initCrop(),A=this.initCropStroke(),S=this.initResize(),w=this.initResizeIcon(),x=new e.a.Layer;x.add(_),x.add(P),x.add(A),x.add(m),x.add(S),x.add(w),p.add(x);var F=function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return m.radius()-C},L=function(C){return m.x()-F(C)<0},K=function(C){return m.y()-F(C)<0},O=function(C){return m.x()+F(C)>p.width()},N=function(C){return m.y()+F(C)>p.height()},I=function(C){return F(C)>=f.minCropRadius?C:m.radius()-f.minCropRadius},M=function(C){return C+.86*m.radius()},G=function(C){return C-.5*m.radius()},V=function(C,T){S.x(M(C)-8),S.y(G(T)-8),w.x(M(C)-8),w.y(G(T)-10)},U=function(){return m.toDataURL({x:m.x()-m.radius(),y:m.y()-m.radius(),width:2*m.radius(),height:2*m.radius()})},E=function(C){var T=C>0||function(R){return!(L(R)||O(R)||N(R)||K(R))}(C)?C:0;A.radius(A.radius()-I(T)),m.radius(m.radius()-I(T)),S.fire("resize")};this.onCropCallback(U()),m.on("dragmove",function(){return m.fire("resize")}),m.on("dragend",function(){return f.onCropCallback(U())}),m.on("resize",function(){var C=L()?m.radius()+1:O()?p.width()-m.radius()-1:m.x(),T=K()?m.radius()+1:N()?p.height()-m.radius()-1:m.y();V(C,T),m.setFillPatternOffset({x:C/f.scale,y:T/f.scale}),m.x(C),A.x(C),m.y(T),A.y(T)}),m.on("mouseenter",function(){return p.container().style.cursor="move"}),m.on("mouseleave",function(){return p.container().style.cursor="default"}),m.on("dragstart",function(){return p.container().style.cursor="move"}),m.on("dragend",function(){return p.container().style.cursor="default"}),S.on("touchstart",function(C){S.on("dragmove",function(T){if(T.evt.type==="touchmove"){var R=T.evt.changedTouches[0].pageY-C.evt.changedTouches[0].pageY||0;E(R*f.mobileScaleSpeed)}})}),S.on("dragmove",function(C){if(C.evt.type!=="touchmove"){var T=C.evt.y,R=T?T-f.state.lastMouseY:void 0,W=C.evt.movementY||R||0;f.setState({lastMouseY:T}),E(W)}}),S.on("dragend",function(){return f.onCropCallback(U())}),S.on("resize",function(){return V(m.x(),m.y())}),S.on("mouseenter",function(){return p.container().style.cursor="nesw-resize"}),S.on("mouseleave",function(){return p.container().style.cursor="default"}),S.on("dragstart",function(C){f.setState({lastMouseY:C.evt.y}),p.container().style.cursor="nesw-resize"}),S.on("dragend",function(){return p.container().style.cursor="default"})}},{key:"initStage",value:function(){return new e.a.Stage({container:this.containerId,width:this.width,height:this.height})}},{key:"initBackground",value:function(){return new e.a.Image({x:0,y:0,width:this.width,height:this.height,image:this.image})}},{key:"initShading",value:function(){return new e.a.Rect({x:0,y:0,width:this.width,height:this.height,fill:this.shadingColor,strokeWidth:4,opacity:this.shadingOpacity})}},{key:"initCrop",value:function(){return new e.a.Circle({x:this.halfWidth,y:this.halfHeight,radius:this.cropRadius,fillPatternImage:this.image,fillPatternOffset:{x:this.halfWidth/this.scale,y:this.halfHeight/this.scale},fillPatternScale:{x:this.scale,y:this.scale},opacity:1,draggable:!0,dashEnabled:!0,dash:[10,5]})}},{key:"initCropStroke",value:function(){return new e.a.Circle({x:this.halfWidth,y:this.halfHeight,radius:this.cropRadius,stroke:this.cropColor,strokeWidth:this.lineWidth,strokeScaleEnabled:!0,dashEnabled:!0,dash:[10,5]})}},{key:"initResize",value:function(){return new e.a.Rect({x:this.halfWidth+.86*this.cropRadius-8,y:this.halfHeight+-.5*this.cropRadius-8,width:16,height:16,draggable:!0,dragBoundFunc:function(f){return{x:this.getAbsolutePosition().x,y:f.y}}})}},{key:"initResizeIcon",value:function(){return new e.a.Path({x:this.halfWidth+.86*this.cropRadius-8,y:this.halfHeight+-.5*this.cropRadius-10,data:"M47.624,0.124l12.021,9.73L44.5,24.5l10,10l14.661-15.161l9.963,12.285v-31.5H47.624z M24.5,44.5   L9.847,59.653L0,47.5V79h31.5l-12.153-9.847L34.5,54.5L24.5,44.5z",fill:this.cropColor,scale:{x:.2,y:.2}})}},{key:"render",value:function(){var f=this,p=this.props,_=p.width,P=p.height,m={display:"flex",justifyContent:"center",backgroundColor:this.backgroundColor,width:_||this.width,position:"relative"},A=this.props.label,S=a({},this.props.labelStyle,{lineHeight:(P||200)+"px"}),w=a({},this.props.borderStyle,{width:_||200,height:P||200});return r.a.createElement("div",null,this.state.showLoader?r.a.createElement("div",{style:w},r.a.createElement("input",{onChange:function(x){return f.onFileLoad(x)},name:this.loaderId,type:"file",id:this.loaderId,style:{width:.1,height:.1,opacity:0,overflow:"hidden",position:"absolute",zIndex:-1},accept:this.mimeTypes}),r.a.createElement("label",{htmlFor:this.loaderId,style:S},A)):r.a.createElement("div",{style:m},r.a.createElement("svg",{onClick:this.onCloseClick,style:{position:"absolute",zIndex:999,cursor:"pointer",left:"10px",top:"10px"},viewBox:"0 0 475.2 475.2",width:"20px",height:"20px"},r.a.createElement("g",null,r.a.createElement("path",{d:"M405.6,69.6C360.7,24.7,301.1,0,237.6,0s-123.1,24.7-168,69.6S0,174.1,0,237.6s24.7,123.1,69.6,168s104.5,69.6,168,69.6    s123.1-24.7,168-69.6s69.6-104.5,69.6-168S450.5,114.5,405.6,69.6z M386.5,386.5c-39.8,39.8-92.7,61.7-148.9,61.7    s-109.1-21.9-148.9-61.7c-82.1-82.1-82.1-215.7,0-297.8C128.5,48.9,181.4,27,237.6,27s109.1,21.9,148.9,61.7    C468.6,170.8,468.6,304.4,386.5,386.5z",fill:this.closeIconColor}),r.a.createElement("path",{d:"M342.3,132.9c-5.3-5.3-13.8-5.3-19.1,0l-85.6,85.6L152,132.9c-5.3-5.3-13.8-5.3-19.1,0c-5.3,5.3-5.3,13.8,0,19.1    l85.6,85.6l-85.6,85.6c-5.3,5.3-5.3,13.8,0,19.1c2.6,2.6,6.1,4,9.5,4s6.9-1.3,9.5-4l85.6-85.6l85.6,85.6c2.6,2.6,6.1,4,9.5,4    c3.5,0,6.9-1.3,9.5-4c5.3-5.3,5.3-13.8,0-19.1l-85.4-85.6l85.6-85.6C347.6,146.7,347.6,138.2,342.3,132.9z",fill:this.closeIconColor}))),r.a.createElement("div",{id:this.containerId})))}},{key:"lineWidth",get:function(){return this.props.lineWidth}},{key:"containerId",get:function(){return this.state.containerId}},{key:"closeIconColor",get:function(){return this.props.closeIconColor}},{key:"cropColor",get:function(){return this.props.cropColor}},{key:"loaderId",get:function(){return this.state.loaderId}},{key:"mimeTypes",get:function(){return this.props.mimeTypes}},{key:"backgroundColor",get:function(){return this.props.backgroundColor}},{key:"shadingColor",get:function(){return this.props.shadingColor}},{key:"shadingOpacity",get:function(){return this.props.shadingOpacity}},{key:"mobileScaleSpeed",get:function(){return this.props.mobileScaleSpeed}},{key:"cropRadius",get:function(){return this.state.cropRadius}},{key:"minCropRadius",get:function(){return this.props.minCropRadius}},{key:"scale",get:function(){return this.state.scale}},{key:"width",get:function(){return this.state.imgWidth}},{key:"halfWidth",get:function(){return this.state.imgWidth/2}},{key:"height",get:function(){return this.state.imgHeight}},{key:"halfHeight",get:function(){return this.state.imgHeight/2}},{key:"image",get:function(){return this.state.image}}])&&o(y.prototype,b),g}();u(v,"defaultProps",{shadingColor:"grey",shadingOpacity:.6,cropColor:"white",closeIconColor:"white",lineWidth:4,minCropRadius:30,backgroundColor:"grey",mimeTypes:"image/jpeg,image/png",mobileScaleSpeed:.5,onClose:function(){},onCrop:function(){},onFileLoad:function(){},onImageLoad:function(){},onBeforeFileLoad:function(){},label:"Choose a file",labelStyle:{fontSize:"1.25em",fontWeight:"700",color:"black",display:"inline-block",fontFamily:"sans-serif",cursor:"pointer"},borderStyle:{border:"2px solid #979797",borderStyle:"dashed",borderRadius:"8px",textAlign:"center"}}),D.default=v}])})}}]);
