"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[9229],{49229:($o,Je,N)=>{N.r(Je),N.d(Je,{default:()=>Ko});var qt=N(85105),q=N.n(qt),ee=N(99663),te=N(22600),Q=N(49135),ne=N(93196),n=N(67294),en=N(21),Ce=N(17563),tn=N(8177),M=N.n(tn),qe=N(25273),nn=N(84805),on=N(3540),an=N(88106),et=N(88239),tt=N(62048),Te=N(89158),ye=N(86853),A=N(56171),w=N(33867),ln=N(26581),nt=N(70801),ot=N(96841),U=N(74127),le=N(43393),oe=N.n(le),rn=N(30381),be=N.n(rn),O=N(44894),ie=N(96486),B=N.n(ie),sn=N(93967),y=N.n(sn),cn=N(45697),p=N.n(cn),G=N(36021),dn=N(74108),I=N(51474),Y=N(72444),un=N(12424),mn=N(46593),ae=N.n(mn),d=N(44388),D=N(19771),pn=N(63239),Ke=N.n(pn),x=N(15577),fn=N(78499),hn=N(42506),vn=N(68085);function En(l,a){if(!((typeof currentRoot>"u"?"undefined":(0,Y.default)(currentRoot))!=="object"&&l!==1)){var s=void 0;(typeof currentRoot>"u"?"undefined":(0,Y.default)(currentRoot))==="object"?s={id:l.id,projectId:l.project?l.project.projectId:"",name:l.name}:s={id:null,parentId:null,name:_l("\u6211\u7684\u6587\u4EF6")};var e={rootFolder:s,node:a?{id:a.id,parendId:a.parendId,name:a.name,projectId:a.projectId,position:a.position}:s};console.log("uploadedPos -> ",e),safeLocalStorageSetItem("last_select_folder_pos_"+md.global.Account.accountId,Ke()(e)),safeLocalStorageSetItem("last_select_pos_"+md.global.Account.accountId,Ke()(e))}}function yn(l){var a=l.currentFolder,s=l.currentRoot,e=l.kcUsage,t=l.isRecycle,o=l.addUsage,r=l.reloadList;if(e&&e.used>=e.total){alert(_l("\u5DF2\u8FBE\u5230\u672C\u6708\u4E0A\u4F20\u6D41\u91CF\u4E0A\u9650"),3);return}var c=a&&!_.isEmpty(a)?a.id:void 0,i=(typeof s>"u"?"undefined":(0,Y.default)(s))==="object"?s.id:void 0;i&&!c&&(c=i);var m={parentId:c,rootId:i};if(a&&!_.isEmpty(a)?m.position=a.position:(typeof s>"u"?"undefined":(0,Y.default)(s))==="object"&&(m.position="/"+s.id),!window.uploadAssistantWindow||window.uploadAssistantWindow.closed){var u="/apps/kcupload";(window.isMDClient||window.isEdge)&&(u=u+"?uploadLocation="+encodeURIComponent(Ke()(m))),window.isMDClient&&(u=u+"&isMDClient=true");var v="uploadAssistant",h=(window.screen.availHeight-660)/2,f=(window.screen.availWidth-930)/2,E="width=930,height=598,toolbar=no,menubar=no,location=no,status=no,top="+h+",left="+f;window.uploadAssistantWindow=window.open(u,v,E)}else window.uploadAssistantWindow.focus();window.uploadAssistantWindow&&(window.uploadAssistantWindow.setUploadLocation?window.uploadAssistantWindow.setUploadLocation(m):window.uploadAssistantWindow.uploadLocation=m),window.reloadNodeList=(0,ie.debounce)(function(C,L,g){En(s,a),!t&&(c===L&&i===C&&r(),o(g))},1e3)}function Nn(l){var a=l.isEdit,s=l.item,e=l.folder,t=l.root,o=l.performUpdateItem,r=l.reloadList,c=_.isEmpty(e)?(typeof t>"u"?"undefined":(0,Y.default)(t))==="object"?{id:t.id,rootId:t.id}:{}:e,i=c.id,m=c.rootId,u={parentId:i,rootId:m};(0,fn.Z)({callback:function(h){var f=h.linkName,E=h.linkContent,C=a?_l("\u4FDD\u5B58"):_l("\u521B\u5EFA"),L=void 0;a?L=I.Z.updateNode({id:s.id,name:f+".url",newLinkUrl:E}):L=I.Z.addFile({name:f+".url",originLinkUrl:E,size:0,parentId:u.parentId,rootId:u.rootId}),L.then(function(g){if(alert(C+_l("\u6210\u529F")),a&&(typeof g>"u"?"undefined":(0,Y.default)(g))==="object"){o(g);return}r()}).catch(function(){alert(C+_l("\u5931\u8D25"),3)})},location:u,isEdit:a,data:a?{id:s.id,name:s.name,originLinkUrl:s.originLinkUrl}:void 0})}function gn(l){var a=l.list,s=l.selectedItems,e=l.root,t=l.folder,o=l.selectAll,r=(0,D.u5)(t,e),c=t?t.id:void 0;if(o){var i=a.size!==s.size?a.filter(function(u){return!s.some(function(v){return v.id===u.id})}).map(function(u){return u.id}).toArray():null;_.isEmpty(t)?kn(e,i):at(c,i)}else{var m=s.map(function(u){return u.id}).toArray().join(",");Sn(m,c,r)}}function Cn(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){};N.e(1050).then(N.bind(N,51050)).then(function(s){window.shareDialogObject=s.default({attachmentType:2,id:l.id,name:l.name,ext:l.ext?"."+l.ext:"",size:l.size,imgSrc:File.isPicture("."+l.ext)?l.previewUrl.indexOf("imageView2")>-1?l.previewUrl.replace(/imageView2\/\d\/w\/\d+\/h\/\d+(\/q\/\d+)?/,"imageView2/2/w/490"):l.previewUrl+"&imageView2/2/w/490":void 0,node:l,isKcFolder:l.type===d.QZ.FOLDER},{performUpdateItem:function(t){t&&(l.visibleType=t,l.isOpenShare=t===d.lo.PUBLIC,a(l))}})})}function at(l,a){var s=a&&a.length?a.join(","):"",e=md.global.Config.AjaxApiUrl+"file/downKcFile?"+Ce.stringify({id:l,excludeNodeIds:s});window.open((0,x.Sv)(e))}function kn(l,a){var s=a&&a.length?a.join(","):"",e=void 0,t=void 0,o=void 0;if((typeof l>"u"?"undefined":(0,Y.default)(l))==="object")e=d.yR.ROOT,t=l.id,o=l.name;else switch(e=l,e){case d.yR.MY:o=_l("\u6211\u7684\u6587\u4EF6");break;case d.yR.RECENT:o=_l("\u6700\u8FD1\u4F7F\u7528");break;case d.yR.STARED:o=_l("\u661F\u6807\u6587\u4EF6");break}var r=md.global.Config.AjaxApiUrl+"file/downKcFile?"+Ce.stringify({rootType:e,rootId:t,fileName:o,excludeNodeIds:s});window.open((0,x.Sv)(r))}function Sn(l,a,s){var e=md.global.Config.AjaxApiUrl+"file/downKcFile?"+Ce.stringify({ids:l,folderId:a,fileName:s});window.open((0,x.Sv)(e))}function lt(l,a){if(l.viewType===d.Pi.LINK){window.open((0,x.Sv)(l.downloadUrl));return}l&&l.id&&at(l.id,a,l.versionId)}function it(l){$(".nodeItem[data-id="+l.id+"]").find(".listNameEdit").val(l.name).show().select().siblings(".listName,.itemExt,.thumbnailName").hide()}function An(l){var a=l.list,s=l.nodeStatus,e=l.selectedItems,t=l.selectAll,o=l.totalCount,r=l.keywords,c=l.clearSelect,i=l.root,m=l.reloadList,u=l.folder,v=l.performRemoveItems;if(a.size===0)return!1;if(e.size===1){var h=e.toArray()[0],f=(0,D.Yj)(i),E=h.owner.accountId===md.global.Account.accountId;if(!f&&!E)return alert("\u6CA1\u6709\u64CD\u4F5C\u6743\u9650",3),!1}var C=s===d.P7.RECYCLED?_l("\u5220\u9664"):_l("\u5F7B\u5E95\u5220\u9664"),L=s===d.P7.RECYCLED?'<span class="Font16"><span class="Bold">'+_l("\u5220\u9664\u6587\u4EF6")+'</span><div class="Font14 mTop10">'+_l("\u6587\u4EF6\u7684\u5F15\u7528\u548C\u5206\u4EAB\u94FE\u63A5\u4E5F\u5C06\u5931\u6548\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F")+'</div><div class="Font14 mTop10 Gray_9">'+_l("\u60A8\u53EF\u4EE5\u5728\u8BE5\u6587\u4EF6\u5939\u5BF9\u5E94\u7684\u56DE\u6536\u7AD9\u5185\u627E\u56DE")+"</div></span>":'<span class="Font16"><span class="Bold">'+_l("\u5F7B\u5E95\u5220\u9664\u6587\u4EF6")+'</span><div class="Font14 mTop10">'+_l("\u6587\u4EF6\u7684\u5F15\u7528\u548C\u5206\u4EAB\u94FE\u63A5\u4E5F\u5C06\u5931\u6548\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F")+"</div></span>";(0,D.iG)("",L,!1,"","",C).then(function(){var g="",S=e.map(function(j){return j.id}).toArray(),b=t?o:S.length,K=void 0;switch(s){case d.P7.RECYCLED:g={success:_l("\u5220\u9664\u6210\u529F")};break;case d.P7.DELETED:g={success:"\u5F7B\u5E95\u5220\u9664\u6210\u529F"};break}t?K=I.Z.removeNodeByParentId({parentId:(0,D.rZ)(u,i),locationType:(0,D.kw)(u,i),isPermanent:s!==d.P7.RECYCLED,keywords:r,excludeNodeIds:a.size!==e.size?a.filter(function(j){return!e.some(function(W){return W.id===j.id})}).map(function(j){return j.id}).toArray():null}):K=I.Z.removeNode({ids:S,isPermanent:s!==d.P7.RECYCLED}),K.then(function(j){var W=j[d.Lk.SUCCESS],de=j[d.Lk.NO_RIGHT];S.length===de.length?alert("\u65E0\u6743\u64CD\u4F5C"):alert(je(j,g).text),m(),v(W),c()}).catch(function(){return alert("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")},3)})}function In(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},s=l.type,e=l.rootId,t=l.folder,o=l.fromRoot,r=l.selectedItems,c=r.map(function(v){return v.id}).toArray(),i=r.find(function(v){return v.owner.accountId!==md.global.Account.accountId}),m=s===d.oJ.MOVE&&(e&&i||(typeof o>"u"?"undefined":(0,Y.default)(o))==="object"&&o.permission!==d.aj.OWNER&&o.permission!==d.aj.ADMIN&&i),u=void 0;m?e?u=I.Z.getRootDetail(e):u=ae().resolve(o):u=ae().resolve(),u.then(function(v){var h=(typeof o>"u"?"undefined":(0,Y.default)(o))==="object"?{id:o.id,projectId:o.project?o.project.projectId:"",name:o.name}:{id:null,parentId:null,name:_l("\u6211\u7684\u6587\u4EF6")},f=(typeof o>"u"?"undefined":(0,Y.default)(o))==="object"||o===1?{rootFolder:h,node:t?{id:t.id,parendId:t.parendId,name:t.name,projectId:t.projectId,position:t.position}:h}:void 0;(0,hn.default)({dialogTitle:s===d.oJ.MOVE?_l("\u79FB\u52A8\u5230"):_l("\u590D\u5236\u5230"),isFolderNode:1,selectedItems:c,appointRoot:v,appointFolder:f}).then(function(E){a(E,s)})})}function Dn(l){var a=l.result,s=l.type,e=l.baseUrl,t=l.selectedItems,o=l.selectAll,r=l.list,c=l.keywords,i=l.folder,m=l.root,u=l.reloadList,v=l.clearSelect,h="",f=t.map(function(S){return S.id}).toArray(),E="";switch(s){case d.oJ.MOVE:h={success:_l("\u79FB\u52A8\u6210\u529F")};break;case d.oJ.COPY:h={success:_l("\u590D\u5236\u6210\u529F")};break}if(o){var C={toId:a.node.id,toType:a.type,parentId:(0,D.rZ)(i,m),fromType:(0,D.kw)(i,m),keywords:c||"",excludeNodeIds:r.size!==t.size?r.filter(function(S){return!t.some(function(b){return b.id===S.id})}).map(function(S){return S.id}).toArray():null};s===d.oJ.MOVE?E=I.Z.moveNodeByParentId(C):E=I.Z.copyNodeByParentId(C)}else{var L={ids:f,toId:a.node.id,toType:a.type};s===d.oJ.MOVE?E=I.Z.moveNode(L):E=I.Z.copyNode(L)}var g=Math.random().toString();alert({key:g,msg:_l("\u64CD\u4F5C\u4E2D\u2026"),type:3,timeout:0}),E.then(function(S){var b=S[d.Lk.SUCCESS],K=S[d.Lk.NO_RIGHT];window.destroyAlert(g);var j=je(S,h);window.destroyAlert(g),f.length===K.length?alert(_l("\u64CD\u4F5C\u6210\u529F\uFF08\u90E8\u5206\u6587\u4EF6\u60A8\u65E0\u6743\u64CD\u4F5C\uFF09"),3):j.type===d.Lk.SUCCESS||j.type===d.Lk.NO_RIGHT?(setTimeout(function(){console.log($(".mdAlertDialog .mdClose")),$(".mdAlertDialog .mdClose").click()},1e3),(0,vn.Z)({linkURL:md.global.Config.WebUrl+e.replace(/^\//,"")+"/"+(a.type===1?"my":a.type===2?a.node.id:a.node.rootId?a.node.position.slice(1):a.node.position.replace(/\/.{8}(-.{4}){3}-.{12}/,"my")),content:j.text})):alert(j.text,3),(s===d.oJ.MOVE||a.type===m||a.node.id===m.id||i&&a.node.id===i.id)&&u(),v()}).catch(function(){return alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"),3)})}function je(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s={},e=$.extend(d.wB,a),t=l[d.Lk.FAIL],o=l[d.Lk.SUCCESS],r=l[d.Lk.NO_RIGHT],c=l[d.Lk.EXIST_NAME],i=l[d.Lk.NO_EXIST_PATH],m=l[d.Lk.NO_EXIST_NODE],u=t?t.length:0,v=o?o.length:0,h=r?r.length:0,f=c?c.length:0,E=i?i.length:0,C=m?m.length:0;return u?(s.text=e.fail,s.type=d.Lk.FAIL):h&&(f||E||C)||f&&(E||C)||E&&C?(s.text=e.error,s.type=d.Lk.FAIL):h?(s.text=e.noRight,s.type=d.Lk.NO_RIGHT):f?(s.text=e.existName,s.type=d.Lk.EXIST_NAME):E?(s.text=e.noExistPath,s.type=d.Lk.NO_EXIST_PATH):C?(s.text=e.noExistNode,s.type=d.Lk.NO_EXIST_NODE):v?(s.text=e.success,s.type=d.Lk.SUCCESS):(s.text=e.fail,s.type=d.Lk.FAIL),s}function wn(l){var a=l.list,s=l.folder,e=l.root,t=l.selectedItems,o=l.selectAll,r=l.keywords,c=l.performRemoveItems,i=l.reloadList,m=l.clearSelect,u='<span class="Font16">'+_l("\u786E\u8BA4\u8FD8\u539F\u9009\u4E2D\u7684\u6587\u4EF6\uFF1F")+"</span>";(0,D.iG)("",u,!1,"","",_l("\u8FD8\u539F")).then(function(){var v={success:_l("\u8FD8\u539F\u6210\u529F"),noExistPath:_l("\u539F\u5B58\u50A8\u4F4D\u7F6E\u5DF2\u4E0D\u5B58\u5728\uFF0C\u8FD8\u539F\u5230\u5BF9\u5E94\u6839\u76EE\u5F55\u4E0B")},h="";o?h=I.Z.restoreNodeByParentId({parentId:(0,D.rZ)(s,e),locationType:(0,D.kw)(s,e),keywords:r,excludeNodeIds:a.size!==t.size?a.filter(function(f){return!t.some(function(E){return E.id===f.id})}).map(function(f){return f.id}).toArray():null}):h=I.Z.restoreNode({ids:t.map(function(f){return f.id}).toArray()}),h.then(function(f){var E=f[d.Lk.SUCCESS],C=f[d.Lk.NO_EXIST_PATH];alert(je(f,v).text),i(),c(E),c(C),m()}).catch(function(){return alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"),3)})})}function Rn(l,a){return function(s,e){var t=e().kc,o=t.selectAll,r=t.list,c=t.selectedItems;o=l||!(o&&r.size===c.size);var i=o?(0,le.Set)(r.filter(function(m){return m})):(0,le.Set)();s({type:"KC_SELECT_ALL_ITEMS",value:o,selectedItems:i}),typeof a=="function"&&a()}}function Ae(){return function(l){l({type:"KC_SELECT_ALL_ITEMS",value:!1,selectedItems:(0,le.Set)()})}}function Ln(l){return function(a,s){var e=s().kc,t=e.selectedItems;a({type:"KC_UPDATE_SELECTED_ITEMS",value:t.contains(l)?t.remove(l):t.add(l)})}}function Tn(l){return function(a,s){var e=s().kc,t=e.list;l=(0,le.Set)(l),a({type:"KC_UPDATE_SELECTED_ITEMS",value:l}),a({type:"KC_CHANGE_SELECT_ALL",value:l.equals((0,le.Set)(t.filter(function(o){return o})))})}}function bn(l,a){return function(s,e){var t=e().kc,o=t.list,r=(0,le.Set)(l?[l]:[]);s({type:"KC_UPDATE_SELECTED_ITEMS",value:r}),s({type:"KC_CHANGE_SELECT_ALL",value:r.equals((0,le.Set)(o.filter(function(c){return c})))})}}function Fn(l){return{type:"KC_UPDATE_LIST_ELEMENT",value:l}}function Pn(l){return function(a,s){var e=s().kc,t=(0,D.v7)(l);if(t.type===-9999){(0,G.T8)(e.baseUrl+"/my");return}a({type:"KC_CLEAR_KC"}),a({type:"KC_UPDATE_PATH",value:l}),a(Ae()),a(On(l)),t.isSearch?a(Ze(t.keywords)):a(ke(l,void 0,function(){a(Ne())}))}}function Mn(l){return function(a,s){a({type:"KC_CLEAR_KC"}),a(Ae()),a(ke(void 0,l,function(){a(Ne())}))}}function ke(l,a,s){return function(e,t){var o=void 0,r=t().kc;l=decodeURIComponent(l||r.path||"");var c=r.params.toObject(),i=c.keywords,m=c.skip,u=c.limit,v=c.sortBy,h=c.sortType,f={},E=d.P7.NORMAL;if(e({type:"KC_FETCH_NODES_START"}),a)f={id:a},location.pathname.indexOf("recycled")>-1&&(E=d.P7.RECYCLED),location.pathname.indexOf("my")>-1?o=d.yR.MY:o=d.yR.ROOT;else{var C=(0,D.v7)(l),L=C.queryPath;o=C.type,C.isRecycle&&(E=d.P7.RECYCLED),o===d.yR.MY?f=L?I.Z.getNodeByPath("/"+md.global.Account.accountId+L):{}:o===d.yR.ROOT&&(f=L.indexOf("/")>0?I.Z.getNodeByPath("/"+l):{id:L})}ae().all([f]).then(function(g){var S=(0,un.Z)(g,1),b=S[0];b&&(e({type:"KC_UPDATE_FOLDER",value:b&&b.id&&b.name&&b.owner?b:{}}),I.Z.getNodes({parentId:b.id,rootType:o,keywords:i,skip:m,limit:u,sortBy:v,sortType:h,status:E}).then(function(K){e({type:"KC_FETCH_NODES_SUCCESS",value:K.list}),e({type:"KC_UPDATE_TOTALCOUNT",value:K.totalCount}),typeof s=="function"&&s(K)}))})}}function Fe(){return function(l){l({type:"KC_CLEAR_KC"}),l(ke(void 0,void 0,function(){l(Ne())}))}}function rt(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){};return function(a,s){var e=s().kc,t=e.params,o=e.isGlobalSearch,r=t.toObject(),c=r.keywords,i=r.skip,m=r.limit;a({type:"KC_UPDATE_PARAMS",value:{skip:i+m}}),a(o?st(c):ke(void 0,void 0,l))}}function Ne(){return function(l,a){var s=a().kc,e=s.kcListElement,t=s.list,o=s.totalCount;if(e){var r=e.getElementsByClassName("kclistScrollContent")[0];t.size<o&&r&&r.scrollTop+$(r).height()+40>r.scrollHeight&&l(rt())}}}function Ze(l){return function(a,s){a({type:"KC_CLEAR_KC"}),a({type:"KC_UPDATE_PARAMS",value:{keywords:l}}),a(ke(void 0,void 0,function(){a(Ne())}))}}function Un(l){return function(a,s){a({type:"KC_CLEAR_KC"}),a({type:"KC_UPDATE_PARAMS",value:{keywords:l}}),a({type:"KC_UPDATE_IS_GLOBAL_SEARCH",value:!0}),a(st(l))}}function st(l){return function(a,s){var e=s().kc,t=e.params.toObject(),o=t.skip,r=t.limit,c=t.sortBy,i=t.sortType;a({type:"KC_FETCH_NODES_START"}),I.Z.globalSearch({keywords:l,sortBy:c,sortType:i,skip:o,limit:r}).then(function(m){a({type:"KC_FETCH_NODES_SUCCESS",value:m.list}),a({type:"KC_UPDATE_TOTALCOUNT",value:m.totalCount}),a(Ne())})}}function On(l){return function(a,s){var e=s().kc,t=(0,D.v7)(l),o=t.type,r=t.isRecycle,c=t.queryPath;if(a({type:"KC_UPDATE_LIST_STATE",value:{isRecycle:r,isReadOnly:!0}}),o!==d.yR.ROOT)a({type:"KC_UPDATE_ROOT",value:o});else{if(e.currentRoot&&e.currentRoot.id===c.slice(0,24)){a({type:"KC_UPDATE_LIST_STATE",value:{isRecycle:r,isReadOnly:e.currentRoot.permission&&e.currentRoot.permission===d.aj.READONLY}});return}I.Z.getRootDetail(c.slice(0,24)).then(function(i){a({type:"KC_UPDATE_ROOT",value:i}),a({type:"KC_UPDATE_LIST_STATE",value:{isRecycle:r,isReadOnly:i.permission&&i.permission===d.aj.READONLY}})})}}}function Kn(l){return function(a,s){var e=void 0,t=s().kc,o=t.params.toObject(),r=o.sortBy,c=o.sortType;l===r?e=c===d.U$.ASC?d.U$.DESC:d.U$.ASC:e=(0,D.e9)(l),a({type:"KC_CLEAR_KC"}),a({type:"KC_UPDATE_PARAMS",value:{sortBy:l,sortType:e}}),a(ke(void 0,void 0,function(){a(Ne())}))}}function Go(){return{type:"KC_CLEAR_KC"}}function jn(){return function(l){I.Z.getUsage().then(function(a){l({type:"KC_FETCH_USAGE_SUCCESS",value:a})})}}function Zn(l){return function(a,s){var e=s().kc,t=e.kcUsage,o=e.currentRoot,r=o===d.yR.MY||(typeof o>"u"?"undefined":(0,Y.default)(o))==="object"&&(!o.projectId||!md.global.Account.projects.filter(function(c){return c.projectId===o.projectId}).length);t&&r&&(t.used+=l,a({type:"KC_FETCH_USAGE_SUCCESS",value:t}))}}function _n(){return function(l,a){var s=a().kc,e=s.currentRoot,t=s.currentFolder,o=s.kcUsage,r=s.isRecycle;yn({currentRoot:e,currentFolder:t,kcUsage:o,isRecycle:r,addUsage:function(i){l(Zn(i))},reloadList:function(){l(Fe())}})}}function xn(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(s,e){var t=e().kc,o=t.currentRoot,r=t.currentFolder,c={isEdit:l,item:a,folder:r,root:o,performUpdateItem:function(m){s(Pe(m))},reloadList:function(){s(Fe())}};Nn(c)}}function Bn(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){};return function(s,e){var t=e().kc,o=t.currentRoot,r=t.currentFolder,c={};(0,D.z1)(l,!0,c)?I.Z.addFolder({name:l,rootId:(0,D.nJ)(o),parentId:(0,D.rZ)(r,o)}).then(function(i){if(!i)return ae().reject();alert(_l("\u65B0\u5EFA\u6210\u529F")),s({type:"KC_ADD_NEWFOLDER_SUCCESS",value:i}),a(null)}).catch(function(){alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"),2)}):a({validName:c.validName})}}function Pe(l){return function(a,s){l=new D.I(l);var e=s().kc,t=e.list,o=e.selectedItems,r=o.find(function(i){return i.id===l.id}),c=t.findIndex(function(i){return i.id===l.id});r&&a({type:"KC_UPDATE_SELECTED_ITEMS",value:o.remove(r).add(l)}),c>-1&&a({type:"KC_REPLACE_NODES",value:t.update(c,function(){return l})})}}function _e(l){return function(a,s){l=B().isArray(l)?l:[l];for(var e=s().kc,t=e.list,o=e.selectedItems,r=function(m){return function(u){return u&&u.id===m}},c=0;c<l.length;c++)t=t.remove(t.findIndex(r(l[c]))),o=o.remove(t.find(r(l[c])));a({type:"KC_UPDATE_SELECTED_ITEMS",value:o}),a({type:"KC_REPLACE_NODES",value:t})}}function zn(l){return function(a,s){var e=s().kc,t=e.list,o=e.totalCount,r=e.currentFolder,c=e.currentRoot,i=e.selectAll,m=e.selectedItems,u=e.params,v=u.keywords;An({list:t,nodeStatus:l,selectedItems:m,selectAll:i,totalCount:o,keywords:v||"",root:c,folder:r,reloadList:function(){},clearSelect:function(){a(Ae())},performRemoveItems:function(f){a(_e(f))}})}}function Hn(l){return function(a,s){Cn(l,function(e){a(Pe(e))})}}function Yn(l){return function(a,s){var e=!l.isStared;I.Z.starNode({id:l.id,star:e}).then(function(t){if(!t)return ae().reject();alert(e?"\u6807\u661F\u6210\u529F":"\u53D6\u6D88\u6807\u661F\u6210\u529F"),l.isStared=e,a(Pe(l))}).catch(function(){return alert("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")},3)}}function $n(l,a){return function(s,e){var t=e().kc,o=t.list,r=t.baseUrl,c=t.currentFolder,i=t.currentRoot,m=t.selectAll,u=t.selectedItems,v=t.params,h=v.keywords;In({type:l,rootId:a,folder:c,fromRoot:i,selectAll:m,baseUrl:r,selectedItems:u},function(f){Dn({baseUrl:r,result:f,type:l,selectedItems:u,selectAll:m,list:o,keywords:h,folder:c,root:i,fromRoot:i,clearSelect:function(){s(Ae())},reloadList:function(){s(Fe())}})})}}function Gn(){return function(l,a){var s=a().kc,e=s.list,t=s.selectedItems,o=s.selectAll,r=s.currentFolder,c=s.currentRoot,i=s.params.keywords;wn({list:e,folder:r,root:c,selectedItems:t,selectAll:o,keywords:i||"",reloadList:function(){},clearSelect:function(){l(Ae())},performRemoveItems:function(u){l(_e(u))}})}}function Vn(){return function(l,a){var s=a().kc,e=s.list,t=s.selectedItems,o=s.currentFolder,r=s.currentRoot,c=s.selectAll;gn({list:e,selectAll:c,selectedItems:t,root:r,folder:o})}}function Wn(l){return{type:"KC_UPDATE_KC_BASE_URL",value:l}}function Xn(l){return{type:"KC_UPDATE_KC_LEFT_ROOT_FN",value:l}}var Ie=N(6307);function ct(l,a){return l?n.createElement(Ie.Z,{sourceId:l.accountId,disabled:!l.accountId},n.createElement("span",null,n.createElement("a",{className:"memberName",href:l.accountId?"/user_"+l.accountId:"javascript:void(0);",target:"_blank",onClick:function(e){return!l.accountId&&e.preventDefault()}},"@",(0,x.u1)(l.fullname)),a.exterUserIds&&a.exterUserIds.indexOf(l.accountId)!==-1?"(\u5916\u90E8\u7528\u6237)":"")):""}function Qn(l){var a=l.content.childType===2?"\u6587\u4EF6 ":"\u6587\u4EF6\u5939 ";switch(l.type){case d.s1.CREATE:return"\u521B\u5EFA\u4E86"+(0,x.u1)(l.content.name);case d.s1.RECYCLED:return"\u5C06\u6B64\u5171\u4EAB\u6587\u4EF6\u5939\u653E\u5165\u4E86\u56DE\u6536\u7AD9";case d.s1.DELETED:return"\u5F7B\u5E95\u5220\u9664\u4E86\u6B64\u5171\u4EAB\u6587\u4EF6\u5939";case d.s1.RECOVERY:return"\u8FD8\u539F\u4E86\u6B64\u5171\u4EAB\u6587\u4EF6\u5939";case d.s1.ADDMEMBER:return n.createElement(n.Fragment,null,n.createElement("span",{className:"mRight5"},_l("\u6DFB\u52A0\u4E86\u6210\u5458")),l.content.memberArr.map(function(s){return n.createElement(Ie.Z,{sourceId:s.accountId,disabled:!s.accountId},n.createElement("span",null,n.createElement("a",{className:"memberName",href:s.accountId?"/user_"+s.accountId:"javascript:void(0);",target:"_blank",onClick:function(t){return!s.accountId&&t.preventDefault()}},"@",(0,x.u1)(s.fullname)),l.content.exterUserIds&&l.content.exterUserIds.indexOf(s.accountId)!==-1?"(\u5916\u90E8\u7528\u6237)":""))}));case d.s1.INVITEMEMBER:return n.createElement(n.Fragment,null,n.createElement("span",{className:"mRight5"},_l("\u9080\u8BF7\u4E86\u6210\u5458")),l.content.memberArr.map(function(s){return n.createElement(Ie.Z,{sourceId:s.accountId,disabled:!s.accountId},n.createElement("span",null,n.createElement("a",{className:"memberName",href:s.accountId?"/user_"+s.accountId:"javascript:void(0);",target:"_blank",onClick:function(t){return!s.accountId&&t.preventDefault()}},"@",(0,x.u1)(s.fullname)),s.isExterUser&&s.isExterUser===1?"(\u5916\u90E8\u7528\u6237)":""))}));case d.s1.DELETEMEMBER:return n.createElement(n.Fragment,null,n.createElement("span",{className:"mRight5"},_l("\u5220\u9664\u4E86\u6210\u5458")),l.content.memberArr.map(function(s){return n.createElement(Ie.Z,{sourceId:s.accountId,disabled:!s.accountId},n.createElement("a",{className:"memberName",href:s.accountId?"/user_"+s.accountId:"javascript:void(0);",target:"_blank",onClick:function(t){return!s.accountId&&t.preventDefault()}},"@",(0,x.u1)(s.fullname)))}));case d.s1.SHARE:return n.createElement(n.Fragment,null,l.content.changeMemberArr.map(function(s){return s.permission===d.aj.OWNER?n.createElement(n.Fragment,null,n.createElement("span",{className:"mRight5"},"\u5C06"),s.memberArr.map(function(e){return ct(e,l.content)}),n.createElement("span",{className:"mLeft5"},"\u8BBE\u4E3A\u5171\u4EAB\u6587\u4EF6\u5939"),n.createElement("span",{className:"mLeft5 mRight5"},l.content.rootName),"\u7684\u62E5\u6709\u8005",n.createElement("br",null)):n.createElement(n.Fragment,null,n.createElement("span",{className:"mRight5"},"\u5C06"),s.memberArr.map(function(e){return ct(e,l.content)})," \u7684\u6743\u9650",s.originPermission&&"\u4ECE "+d.IS[s.originPermission]+" ","\u8C03\u6574\u4E3A "+d.IS[s.permission])}));case d.s1.RENAME:return"\u91CD\u547D\u540D\u4E86\u5171\u4EAB\u6587\u4EF6\u5939 "+(0,x.u1)(l.content.oldName)+" \u4E3A "+(0,x.u1)(l.content.newName);case d.s1.EXITMEMBER:return"\u9000\u51FA\u4E86\u6B64\u5171\u4EAB\u6587\u4EF6\u5939";case d.s1.CHILDADD:return"\u6DFB\u52A0\u4E86"+a+(0,x.u1)(l.content.childName);case d.s1.CHILDMOVE:return"\u79FB\u52A8\u4E86"+a+(0,x.u1)(l.content.childName);case d.s1.CHILDRECYCLED:return"\u5C06"+a+(0,x.u1)(l.content.childName)+"\u653E\u5165\u56DE\u6536\u7AD9";case d.s1.CHILDDELETED:return"\u5F7B\u5E95\u5220\u9664\u4E86"+a+(0,x.u1)(l.content.childName);case d.s1.CHILDRESTORE:return"\u6062\u590D\u4E86"+a+(0,x.u1)(l.content.childName);default:return""}}function dt(l,a){var s=a===d.yR.MY?I.Z.getMyLogDetail():I.Z.getRootLogDetail({id:a});s.then(function(e){nt.Z.confirm({title:_l("%0\u7684\u65E5\u5FD7",(0,x.u1)(l)),width:410,noFooter:!0,dialogBoxID:"rootLogs",className:"kcDialogBox",description:n.createElement("ul",{class:"rootLog"},e.logCount?n.createElement(n.Fragment,null,e.logContent.map(function(t){var o=void 0;return t.type===d.s1.CREATE||t.type===d.s1.CHILDADD?o="icon-plus":t.type===d.s1.RECYCLED||t.type===d.s1.DELETED||t.type===d.s1.CHILDRECYCLED||t.type===d.s1.CHILDDELETED?o="icon-task-new-delete":o="icon-edit",n.createElement("li",null,n.createElement("i",{className:"rootLogType "+o}),n.createElement("div",{className:"rootLogTitle"},n.createElement(Ie.Z,{sourceId:t.handleUser.accountId},n.createElement("span",{className:"ThemeColor3 bold handler"},(0,x.u1)(t.handleUser.fullname)," ")),Qn(t)),n.createElement("div",{className:"rootLogTime"},(0,D.Mx)(t.time)))})):n.createElement(n.Fragment,null,n.createElement("li",{className:"rootNoLog"},n.createElement("div",{clasName:"rootLogTitle"},_l("\u6682\u65E0\u65E5\u5FD7")))))})})}var xe=N(33853),Vo,Wo,k,ut,mt;function V(l,a,s,e,t){var o={};return Object.keys(e).forEach(function(r){o[r]=e[r]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=s.slice().reverse().reduce(function(r,c){return c(l,a,r)||r},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(l,a,o),o=null),o}var Jn=(k=(mt=ut=function(l){(0,ne.default)(a,l);function a(s){(0,ee.default)(this,a);var e=(0,Q.default)(this,(a.__proto__||q()(a)).call(this,s)),t=B()(md.global.Account.projects).map(function(m){return m.projectId}).unshift(""),o=void 0,r=window.localStorage.getItem("foldedProjects_"+md.global.Account.accountId+"_kc");r?o=oe().Set(r.split(",")):r===""?o=oe().Set():o=oe().Set(t.value());var c=oe().Set(t.reject(function(m){return o.includes(m)}).value()),i=!1;return md.global.Account.projects.length||(o=oe().Set([]),c=oe().Set([""]),i=!0),e.state={keywords:s.keywords||"",projectRootKeywords:{},noneProjects:i,foldedProjects:o,loadingProjects:c,searchName:"",roots:oe().List(),selectOptions:!1,folderSetting:"",settingsOption:"",offset:oe().Map({}),upgradeOffset:null,upgradeHint:!1,filterType:d.eP.ALL,isCreator:!1,isHover:!1,isClick:!1},e.searchNodes=e.searchNodes.bind(e),e}return(0,te.default)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props,o=t.getUsage,r=t.initkcLeftEditRootFn;if(o(),r(this.handleEditRoot),this._isMounted=!0,I.Z.getRoots({accountId:md.global.Account.accountId,excludeProjectIds:this.state.foldedProjects.toArray()}).then(function(u){e.setState({roots:oe().List(u),loadingProjects:oe().Set()})}),location.search){var c=decodeURIComponent(location.search),i=c.split("?")[1],m=Ce.parse(i);m.set&&this.handleEditRoot(m.set)}}},{key:"componentWillReceiveProps",value:function(e){e.keywords!==this.state.keywords&&this.setState({keywords:e.keywords})}},{key:"shouldComponentUpdate",value:function(e,t){return!((0,D.wU)(e,this.props)&&(0,D.wU)(e.usage,this.props.usage)&&(0,D.wU)(t,this.state)&&t.roots===this.state.roots)}},{key:"componentDidUpdate",value:function(e,t){safeLocalStorageSetItem("foldedProjects_"+md.global.Account.accountId+"_kc",this.state.foldedProjects.join(",")),this.updateSearchName()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"getType",value:function(){var e=this.props.path;return(0,D.v7)(e).type}},{key:"checkRootIsActive",value:function(e){var t=this.props.path;if(!t)return!1;var o=t.match(/[a-z0-9]{24}/),r=o&&o[0];return e===r}},{key:"fetchRootsByProjectId",value:function(e,t){var o=this;if(!this.state.loadingProjects.includes(e)){var r=this.state.loadingProjects.add(e),c=this.state.foldedProjects;t&&(c=c.delete(e)),this.setState({loadingProjects:r,foldedProjects:c})}var i={accountId:md.global.Account.accountId};return e?i.projectId=e:i.excludeProjectIds=B()(md.global.Account.projects).map(function(m){return m.projectId}).unshift("").reject(function(m){return m===e}).value(),I.Z.getRoots(i).then(function(m){var u=o.state.roots;e?u=u.filter(function(v){return!v.project||v.project.projectId!==e}).concat(m):u=u.filter(function(v){return v.project}).filter(function(v){return!B().some(m,function(h){return h.id===v.id})}).concat(m),o.setState({roots:u,loadingProjects:o.state.loadingProjects.delete(e)},o.updateSearchName)})}},{key:"handleSelectFile",value:function(){this.setState({selectOptions:!this.state.selectOptions})}},{key:"filterRoots",value:function(e){var t=this;e===this.state.filterType&&e!==d.eP.ALL||this.setState({loading:!0},function(){e===d.eP.ALL?I.Z.getRoots({accountId:md.global.Account.accountId}).then(function(o){return t.setState({filterType:e,roots:oe().Set(o),loading:!1})}):t.setState({filterType:e,loading:!1})})}},{key:"searchNodes",value:function(e){var t=this.props,o=t.baseUrl,r=t.path;e.keyCode===13&&((0,G.T8)(encodeURI(o+"/"+r+"?q="+e.target.value)),e.preventDefault(),e.stopPropagation())}},{key:"updateSearchName",value:function(){var e=this.props,t=e.currentFolder,o=e.currentRoot,r=this.getType(),c="";switch(r){case d.yR.MY:c=t&&!B().isEmpty(t)?t.name:_l("\u6211\u7684\u6587\u4EF6");break;case d.yR.RECENT:c=_l("\u6700\u8FD1\u4F7F\u7528");break;case d.yR.STARED:c=_l("\u661F\u6807\u6587\u4EF6");break;default:c=t&&!B().isEmpty(t)?t.name:o.name;break}this.setState({searchName:c?_l("\u5728\u201C%0\u201D\u4E2D\u641C\u7D22",c.length<10?c:c.substr(0,9)+".."):"\u5728\u77E5\u8BC6\u4E2D\u5FC3\u4E2D\u641C\u7D22"})}},{key:"handleAddNewRoot",value:function(){var e=this;(0,xe.wF)(function(t){e._isMounted&&(e.setState({roots:e.state.roots.unshift(t),settingsOption:"",folderSetting:""}),(0,G.T8)("/apps/kc/"+t.id))})}},{key:"handleEditRoot",value:function(e){var t=this;this.setState({settingsOption:null,folderSetting:null}),(0,xe.sB)(e,function(o){if(o)alert(_l("\u7F16\u8F91\u6210\u529F")),t.performUpdateItem(o);else{var r=t.state.roots;t._isMounted&&t.setState({roots:r.remove(r.findIndex(function(c){return c.id===e}))},t.returnAllFolder),(0,G.T8)("/apps/kc/my"),alert(_l("\u9000\u51FA\u6210\u529F"))}},function(o){o&&t.performUpdateItem(o)})}},{key:"handleRemoveRoot",value:function(e,t,o){var r=this;this.setState({settingsOption:null}),(0,xe.bp)(e,t,o,function(c){var i=r.state.roots;r.setState({roots:i.remove(i.findIndex(function(m){return m.id===c}))},r.returnAllFolder),(0,G.T8)("/apps/kc/my")})}},{key:"handleStarRoot",value:function(e){var t=this;this.setState({settingsOption:null}),I.Z.updateRootStar(e.id,!e.isStared).then(function(o){o&&(t.setState({isStared:!e.isStared,settingsOption:"",folderSetting:""}),e.isStared=!e.isStared,e.staredTime=e.isStared?be()().format():null,t.performUpdateItem(e))})}},{key:"handleRootSettings",value:function(e,t){var o=this,r=!1,c=$(t.target);if(e)for(var i=0;i<e.members.length;i++){var m=e.members[i];if(m.permission===1&&m.accountId===md.global.Account.accountId){r=!0;break}}this.setState({settingsOption:e.id,offset:this.state.offset.merge(c.offset()),isCreator:r},function(){if(c.offset().top+20+c.find(".settingsLayer").height()>$(window).height()){var u=o.state.offset,v=u.set("top",c.offset().top-20-c.find(".settingsLayer").height());o.setState({offset:v})}}),t.stopPropagation()}},{key:"performUpdateItem",value:function(e){var t=this.state.roots;this.setState({roots:t.update(t.findIndex(function(o){return o.id===e.id}),function(){return B().clone(e)})})}},{key:"usageDialog",value:function(e){var t=e.used/e.total*100;nt.Z.confirm({width:410,className:"kcDialogBox",title:_l("\u4F7F\u7528\u8BE6\u60C5"),children:n.createElement("div",{class:"usageList"},n.createElement("span",null,_l("\u672C\u6708\u4E0A\u4F20\u6D41\u91CF\u5DF2\u7528"),n.createElement(ln.Z,{text:n.createElement("span",null,_l("\u5728\u5404\u6A21\u5757\u4E0A\u4F20\u6587\u4EF6\u65F6\uFF0C\u4F1A\u8BA1\u5165\u6BCF\u6708\u4E0A\u4F20\u91CF\u3002\u514D\u8D39\u7528\u6237\u4E0A\u4F20\u6D41\u91CF\u4E3A300M/\u6708\uFF0C\u4ED8\u8D39\u7248\u7528\u623710G/\u6708\uFF0C\u591A\u4E2A\u7EC4\u7EC7\u53EF\u53E0\u52A0\u3002")),action:["hover"],popupPlacement:"bottom"},n.createElement("i",{class:"icon-help ThemeColor4"}))),n.createElement("span",{class:"usageSize"},(0,D.gB)(e.used)+" ("+(t>100?100:t).toFixed(2)+"%)/"+(0,D.gB)(e.total))),noFooter:!0})}},{key:"toggleFoldProject",value:function(e){if(this.state.foldedProjects.includes(e))this.fetchRootsByProjectId(e,!0);else{var t=this.state.foldedProjects.add(e);this.setState({foldedProjects:t})}}},{key:"renderProjectRoots",value:function(e,t,o){var r=this;e=e||"";var c=this.state.projectRootKeywords,i=c===void 0?{}:c,m=this.state.foldedProjects.includes(e),u=this.state.loadingProjects.includes(e),v=B().find(md.global.Account.projects,function(g){return g.projectId===e}),h=i[e||"my"],f=void 0;if(e)f=o.filter(function(g){return(g.project&&g.project.projectId||"")===e});else{var E=B().map(md.global.Account.projects,function(g){return g.projectId});f=o.filter(function(g){return E.indexOf(g.project&&g.project.projectId||"")===-1})}h&&(f=f.filter(function(g){return g.name.toLowerCase().indexOf(h.toLowerCase())>-1})),f=f.toArray().filter(function(g){return g.isStared}).concat(f.toArray().filter(function(g){return!g.isStared}));var C=n.createElement("div",{className:y()("folderProjectTitle ThemeColor10",{folded:m,isLoading:u,hide:this.state.noneProjects}),onClick:function(){return r.toggleFoldProject(e)}},n.createElement("span",{className:v&&v.licenseType===0?"contentName ThemeColor8":"contentName ThemeColor9",title:v?v.companyName:_l("\u4E2A\u4EBA")},n.createElement("span",{className:"companyName ellipsis"},v?v.companyName:_l("\u4E2A\u4EBA")),v&&v.licenseType===0&&_l("\uFF08\u5230\u671F\uFF09")),u?n.createElement("span",{className:"clipLoader ThemeColor8"}):n.createElement("span",{className:"slide ThemeColor8"},(m?_l("\u5C55\u5F00"):u)||(f.length?_l("\u9690\u85CF"):_l("\u65E0")))),L=!m&&(this.state.loadingProjects.includes(e)?void 0:n.createElement(tt.Z,{className:y()("folderListOfProject",{noneProjects:this.state.noneProjects,expire:v&&v.licenseType===0})},f.length?B().map(f,function(g){return n.createElement(Te.Z,{key:g.id,className:y()("folderItem ani500 fadeIn ThemeHoverBGColor7",{ThemeBGColor8:r.checkRootIsActive(g.id),folded:m}),onClick:function(){(0,G.T8)("/apps/kc/"+g.id)},"data-rootid":g.id,onMouseEnter:function(){r.setState({folderSetting:g.id})},onMouseLeave:function(){r.setState({folderSetting:""})}},n.createElement("span",{className:y()("ThemeColor8 folderListIcon",r.checkRootIsActive(g.id)?"icon-folder-open":"icon-task-folder-solid")}),n.createElement("span",null,n.createElement("span",{className:"folderListName ellipsis ThemeColor10"},g.name),(r.state.folderSetting===g.id||r.state.settingsOption===g.id)&&n.createElement("span",{className:"folderSetting icon-settings ThemeColor8 ThemeHoverColor9",onClick:function(b){return r.handleRootSettings(g,b)}},r.state.settingsOption===g.id?n.createElement(ye.Z,{className:y()("settingsLayer"),onClickAway:function(){r.setState({settingsOption:""})},onClick:function(b){return b.stopPropagation()},style:{left:r.state.offset.get("left")-16,top:r.state.offset.get("top")+24}},n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-star"}),className:"settingItem ThemeHoverColor3",onClick:function(){return r.handleStarRoot(g)}},g.isStared?_l("\u53D6\u6D88\u6807\u661F"):_l("\u6807\u661F")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"group"}),className:"settingItem ThemeHoverColor3",onClick:function(){return r.handleEditRoot(g.id)}},_l("\u5171\u4EAB\u8BBE\u7F6E")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-log"}),className:"settingItem ThemeHoverColor3",onClick:function(){dt(g.name,g.id),r.setState({settingsOption:"",isClick:!1})}},_l("\u6587\u4EF6\u5939\u65E5\u5FD7")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-recycle"}),className:"settingItem ThemeHoverColor3",onClick:function(){(0,G.T8)("/apps/kc/recycled/"+g.id),r.setState({settingsOption:""})}},_l("\u56DE\u6536\u7AD9")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:y()(r.state.isCreator?"task-new-delete":"task-new-exit")}),className:"settingItem ThemeHoverColor3",onClick:function(){return r.handleRemoveRoot(g,r.state.isCreator,!1)}},r.state.isCreator?_l("\u5220\u9664\u6587\u4EF6\u5939"):_l("\u9000\u51FA\u6587\u4EF6\u5939"))):void 0),g.isStared&&r.state.settingsOption!==g.id&&r.state.folderSetting!==g.id?n.createElement("span",{className:"isStared icon-task-star"}):void 0))}):this.state.noneProjects&&n.createElement("li",{className:"nullData ThemeColor9"},n.createElement("span",null,_l('\u70B9\u51FB " + " \u53F7\uFF0C\u521B\u5EFA\u5171\u4EAB\u6587\u4EF6\u5939'),n.createElement("i",{className:"icon-restart arrow ThemeColor8"})))));return n.createElement("div",{className:"folderProjectItem",key:e},C,!m&&(f.length>10||h)&&n.createElement("div",{className:"rootSearch"},n.createElement("i",{className:"icon-search"}),n.createElement(on.Z,{placeholder:_l("\u641C\u7D22\u6587\u4EF6\u5939\u540D\u79F0"),value:h,onChange:function(S){r.setState({projectRootKeywords:(0,et.default)({},i,(0,an.default)({},e||"my",S.trim()))})}})),!m&&h&&!f.length&&n.createElement("div",{className:"Gray_9e TxtCenter mTop20 mBottom10"},_l("\u6CA1\u6709\u641C\u7D22\u7ED3\u679C")),L)}},{key:"render",value:function(){var e=this,t=this.props.usage,o=this.state,r=o.searchName,c=o.keywords,i=t?t.used/t.total*100:"",m=this.state.selectOptions&&n.createElement(ye.Z,{className:"optionsLayer",onClickAway:function(){return e.setState({selectOptions:!1})}},n.createElement(A.Z,{className:"allFolder ellipsis ThemeHoverColor3",onClick:function(){return e.filterRoots(d.eP.ALL)}},_l("\u5168\u90E8\u5171\u4EAB\u6587\u4EF6\u5939")),n.createElement(A.Z,{className:"myCreateRoot ThemeHoverColor3",onClick:function(){return e.filterRoots(d.eP.OWN)}},_l("\u6211\u62E5\u6709\u7684")),n.createElement(A.Z,{className:"myAddFolder ThemeHoverColor3",onClick:function(){return e.filterRoots(d.eP.JOIN)}},_l("\u6211\u52A0\u5165\u7684"))),u=void 0,v=void 0;switch(this.state.filterType){case d.eP.ALL:u=this.state.roots,v=_l("\u5168\u90E8\u5171\u4EAB\u6587\u4EF6\u5939");break;case d.eP.JOIN:u=this.state.roots.filter(function(h){return h.permission!==d.aj.OWNER}),v=_l("\u6211\u52A0\u5165\u7684");break;case d.eP.OWN:u=this.state.roots.filter(function(h){return h.permission===d.aj.OWNER}),v=_l("\u6211\u62E5\u6709\u7684");break;default:break}return n.createElement("div",{className:"kcLeft"},n.createElement("div",{className:"leftNavHairGlass ThemeBG Fixed"}),n.createElement(dn.Z,{className:"yunFileNav ThemeBGColor9 snowFixedContainer"},n.createElement("div",{className:"flexColumn"},n.createElement("div",{className:"fileMenuTop"},n.createElement("div",{className:y()("fileSearch Relative boderRadAll_5",this.state.focusSearch?"ThemeBorderColor3":"ThemeBorderColor8")},n.createElement("span",{className:"icon-search btnFileSearch ThemeColor9",title:_l("\u641C\u7D22")}),n.createElement("input",{type:"text",id:"smartSearchFile",className:"fileSearchBox boxSizing ThemeColor9",value:c,placeholder:r,onKeyDown:this.searchNodes,onChange:function(f){return e.setState({keywords:f.target.value})},onFocus:function(){return e.setState({focusSearch:!0})},onBlur:function(){return e.setState({focusSearch:!1})}})),n.createElement(tt.Z,{className:"typeList"},n.createElement(Te.Z,{icon:n.createElement(w.Z,{icon:"attachment",className:"ThemeColor9 ThemeHoverColor3 LineHeight40"}),onClick:function(){return(0,G.T8)("/apps/kc/my")},className:y()("ThemeHoverBGColor7 myFileNav",{ThemeBGColor8:this.getType()===d.yR.MY}),onMouseOver:function(){return e.setState({isHover:!0})},onMouseLeave:function(){return e.setState({isHover:!1})}},n.createElement("span",{className:"ThemeColor10 Font13"},_l("\u6211\u7684\u6587\u4EF6")),this.state.isHover||this.state.isClick?n.createElement("span",{className:"myFolderSetting icon-settings ThemeColor8 ThemeHoverColor9",onClick:function(f){e.setState({isClick:!0}),f.stopPropagation()}},this.state.isClick?n.createElement(ye.Z,{className:"settingsLayer",onClickAway:function(){return e.setState({isClick:!1})},onClick:function(f){return f.stopPropagation()}},n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-log"}),className:"settingItem ThemeHoverColor3",onClick:function(){dt(_l("\u6211\u7684\u6587\u4EF6"),d.yR.MY),e.setState({settingsOption:"",isClick:!1})}},_l("\u6587\u4EF6\u5939\u65E5\u5FD7")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-recycle"}),className:"settingItem ThemeHoverColor3",onClick:function(){(0,G.T8)("/apps/kc/recycled/my"),e.setState({isClick:!1,isHover:!1})}},_l("\u56DE\u6536\u7AD9"))):""):""),n.createElement(Te.Z,{icon:n.createElement(w.Z,{icon:"clock",className:"ThemeColor9 ThemeHoverColor3 LineHeight40"}),onClick:function(){return(0,G.T8)("/apps/kc/recent")},className:y()("ThemeHoverBGColor7",{ThemeBGColor8:this.getType()===d.yR.RECENT})},n.createElement("span",{className:"ThemeColor10 Font13"},_l("\u6700\u8FD1\u4F7F\u7528"))),n.createElement(Te.Z,{icon:n.createElement(w.Z,{icon:"task-star",className:"ThemeColor9 ThemeHoverColor3 LineHeight40"}),onClick:function(){return(0,G.T8)("/apps/kc/stared")},className:y()("ThemeHoverBGColor7",{ThemeBGColor8:this.getType()===d.yR.STARED})},n.createElement("span",{className:"ThemeColor10 Font13"},_l("\u661F\u6807\u6587\u4EF6"))))),n.createElement(nn.Z,{className:"fileHr ThemeBorderColor7"}),n.createElement("div",{className:"folderHeader"},n.createElement("span",{className:"folderCheckedType left",onClick:this.handleSelectFile},n.createElement("span",{className:"selectOptions ThemeColor8"},v),n.createElement("i",{className:"icon-arrow-down font10 iconArrowDown ThemeColor9"}),m),n.createElement("span",{className:"addNewFolder right"},n.createElement("span",{className:"ThemeColor9 ThemeHoverColor10",onClick:this.handleAddNewRoot},"+"))),n.createElement("div",{className:"folderList flex"},n.createElement(qe.Z,{scrollEvent:function(){e.setState({settingsOption:""})}},B()(md.global.Account.projects).filter(function(h){return h.licenseType!==0}).concat(md.global.Account.projects.filter(function(h){return h.licenseType===0})).map(function(h){return h.projectId}).push("").map(function(h,f){return e.renderProjectRoots(h,f,u)}).value())))))}}]),a}(n.Component),ut.propTypes={path:p().string,keywords:p().string,usage:p().shape({}),searchNodes:p().func,currentFolder:p().shape({}),getUsage:p().func,initkcLeftEditRootFn:p().func,currentRoot:p().oneOfType([p().number,p().shape({})])},mt),V(k.prototype,"getType",[O.Nj],M()(k.prototype,"getType"),k.prototype),V(k.prototype,"checkRootIsActive",[O.Nj],M()(k.prototype,"checkRootIsActive"),k.prototype),V(k.prototype,"fetchRootsByProjectId",[O.Nj],M()(k.prototype,"fetchRootsByProjectId"),k.prototype),V(k.prototype,"handleSelectFile",[O.Nj],M()(k.prototype,"handleSelectFile"),k.prototype),V(k.prototype,"filterRoots",[O.Nj],M()(k.prototype,"filterRoots"),k.prototype),V(k.prototype,"searchNodes",[O.Nj],M()(k.prototype,"searchNodes"),k.prototype),V(k.prototype,"updateSearchName",[O.Nj],M()(k.prototype,"updateSearchName"),k.prototype),V(k.prototype,"handleAddNewRoot",[O.Nj],M()(k.prototype,"handleAddNewRoot"),k.prototype),V(k.prototype,"handleEditRoot",[O.Nj],M()(k.prototype,"handleEditRoot"),k.prototype),V(k.prototype,"handleRemoveRoot",[O.Nj],M()(k.prototype,"handleRemoveRoot"),k.prototype),V(k.prototype,"handleStarRoot",[O.Nj],M()(k.prototype,"handleStarRoot"),k.prototype),V(k.prototype,"handleRootSettings",[O.Nj],M()(k.prototype,"handleRootSettings"),k.prototype),V(k.prototype,"performUpdateItem",[O.Nj],M()(k.prototype,"performUpdateItem"),k.prototype),V(k.prototype,"usageDialog",[O.Nj],M()(k.prototype,"usageDialog"),k.prototype),V(k.prototype,"toggleFoldProject",[O.Nj],M()(k.prototype,"toggleFoldProject"),k.prototype),V(k.prototype,"renderProjectRoots",[O.Nj],M()(k.prototype,"renderProjectRoots"),k.prototype),k),qn=function(a){return{usage:a.kc.kcUsage,keywords:a.kc.params.get("keywords"),currentRoot:a.kc.currentRoot,currentFolder:a.kc.currentFolder,baseUrl:a.kc.baseUrl}},eo=function(a){return{getUsage:(0,U.DE)(jn,a),searchNodes:(0,U.DE)(Ze,a),initkcLeftEditRootFn:(0,U.DE)(Xn,a)}};const to=(0,ot.$j)(qn,eo)(Jn);var no=N(52945),Me=N.n(no),Be=N(33126),pt=N(54208),oo=N(90142),ao=N(42723),me=N(73935);function Se(l){if(typeof l=="function"){for(var a=arguments.length,s=Array(a>1?a-1:0),e=1;e<a;e++)s[e-1]=arguments[e];return l.call.apply(l,[this].concat(s))}}function lo(l,a,s,e,t,o,r,c,i){return typeof i>"u"&&(i=0),!(l+o-i<s||l+i>s+c||a+t-i<e||a+i>e+r)}function ft(l){var a=l.getBoundingClientRect();return{top:a.top+document.body.scrollTop,left:a.left+document.body.scrollLeft,offsetWidth:l.offsetWidth,offsetHeight:l.offsetHeight}}function io(l,a,s){var e=l instanceof HTMLElement?ft(l):l,t=a instanceof HTMLElement?ft(a):a;return lo(e.top,e.left,t.top,t.left,e.offsetWidth,e.offsetHeight,t.offsetWidth,t.offsetHeight,s)}function ro(l){var a,s,e=(s=a=function(t){(0,ne.default)(o,t);function o(){var r,c,i,m;(0,ee.default)(this,o);for(var u=arguments.length,v=Array(u),h=0;h<u;h++)v[h]=arguments[h];return m=(c=(i=(0,Q.default)(this,(r=o.__proto__||q()(o)).call.apply(r,[this].concat(v))),i),i.getContainer=function(){var f=void 0;return i.props.containerSelector&&(f=$(i.props.containerSelector)[0]),f||(f=me.findDOMNode(i)),f},i.handleMouseMove=function(f){if(i.started){var E=me.findDOMNode(i).getBoundingClientRect();i.endPos={x:f.clientX-E.left,y:f.clientY-E.top};var C=i.props.clickOnlyDistance||0;if(!i.dragging&&Math.abs(i.startPos.x-i.endPos.x)<=C&&Math.abs(i.startPos.y-i.endPos.y)<=C)i.dragging=!1;else{i.dragging=!0,i.selectionEl||(i.selectionEl=document.createElement("div"),me.findDOMNode(i).appendChild(i.selectionEl));var L=(0,ie.assign)({display:"block"},i.calcRect(i.startPos,i.endPos),i.props.selectionStyle||{position:"absolute",zIndex:4500,cursor:"default",boxSizing:"border-box",border:"1px solid #3a96dd",backgroundColor:"rgba(58,150,221,.1)"});(0,ie.assign)(i.selectionEl.style,L);var g=[];n.Children.forEach(i.props.children,function(S,b){if(n.isValidElement(S)){var K=me.findDOMNode(i["dragSelectItem$"+b]);K&&io(K,i.selectionEl,i.props.tolerance)&&g.push(S)}}),Se(i.props.onDragSelect,g,f)}}},i.clear=function(){i.dragging=!1,i.started=!1,i.selectionEl&&(document.removeEventListener("mousemove",i.handleMouseMove),document.removeEventListener("mouseup",i.finishDragSelect),document.removeEventListener("keyup",i.cancelDragSelect),$(i.selectionEl).remove(),i.selectionEl=null),Se(i.props.onDragSelectEnd)},i.cancelDragSelect=function(f){f.which===27&&i.clear()},i.finishDragSelect=function(f){f.button===0&&(i.started&&!i.dragging&&n.Children.forEach(i.props.children,function(E,C){if(n.isValidElement(E)){var L=me.findDOMNode(i["dragSelectItem$"+C]),g=L.getBoundingClientRect(),S=f.clientX,b=f.clientY;S>g.left&&S<g.right&&b>g.top&&b<g.bottom&&Se(i.props.onClickOnly,E,f)}}),i.clear())},i.startDragSelect=function(f){if(i.started=!0,f.button===0){var E=me.findDOMNode(i).getBoundingClientRect(),C={x:f.clientX-E.left,y:f.clientY-E.top};i.startPos=C,i.endPos=C,document.addEventListener("mousemove",i.handleMouseMove),document.addEventListener("mouseup",i.finishDragSelect),document.addEventListener("keyup",i.cancelDragSelect),Se(i.props.onDragSelectStart,f)}},c),(0,Q.default)(i,m)}return(0,te.default)(o,[{key:"componentDidMount",value:function(){var c=this.handleMouseDown.bind(this),i=this.getContainer();i.addEventListener("mousedown",c),this.removeMouseDownHandler=function(){return i.removeEventListener("mousedown",c)}}},{key:"componentWillUnmount",value:function(){this.removeMouseDownHandler()}},{key:"calcRect",value:function(c,i,m){var u=me.findDOMNode(this),v=c.x<i.x?c.x:i.x,h=u.clientWidth-(c.x>i.x?c.x:i.x),f=c.y<i.y?c.y:i.y,E=u.clientHeight-(c.y>i.y?c.y:i.y);return m=(0,ie.assign)({left:0,right:0,top:0,bottom:0},m),v=v<m.left?m.left:v+"px",h=h<m.right?m.right:h+"px",f=f<m.top?m.top:f+"px",E=E<m.bottom?m.bottom:E+"px",{left:v,right:h,top:f,bottom:E}}},{key:"handleMouseDown",value:function(){for(var c=arguments.length,i=Array(c),m=0;m<c;m++)i[m]=arguments[m];Se.apply(void 0,[!this.props.manuallyStart&&!this.selectionEl&&this.startDragSelect].concat(i)),Se.apply(void 0,[this.props.onMouseDown].concat(i))}},{key:"render",value:function(){var c=this,i=this.props,m=i.selectionStyle,u=i.manuallyStart,v=i.onDragSelectStart,h=i.onDragSelect,f=i.onClickOnly,E=i.onDragSelectEnd,C=i.onMouseDown,L=i.clickOnlyDistance,g=i.tolerance,S=i.containerSelector,b=i.children,K=(0,ao.Z)(i,["selectionStyle","manuallyStart","onDragSelectStart","onDragSelect","onClickOnly","onDragSelectEnd","onMouseDown","clickOnlyDistance","tolerance","containerSelector","children"]);return n.createElement(l,K,n.Children.map(b,function(j,W){return n.isValidElement(j)?n.cloneElement(j,{ref:function(re){return c["dragSelectItem$"+W]=re}}):j}))}}]),o}(n.Component),a.propTypes={selectionStyle:p().object,manuallyStart:p().bool,onDragSelectStart:p().func,onDragSelect:p().func,onClickOnly:p().func,onDragSelectEnd:p().func,onMouseDown:p().func,clickOnlyDistance:p().number,tolerance:p().number,containerSelector:p().any,children:p().any},s);return e}const so=ro;var ht=N(6073),co=N(49611),uo=N.n(co),vt=N(3430),mo=N(31261),Qo,Jo,De,Et,yt;function po(l,a,s,e,t){var o={};return Object.keys(e).forEach(function(r){o[r]=e[r]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=s.slice().reverse().reduce(function(r,c){return c(l,a,r)||r},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(l,a,o),o=null),o}var fo=(0,Be.Z)(vt.Z),ho=(De=(yt=Et=function(l){(0,ne.default)(a,l);function a(s){(0,ee.default)(this,a);var e=(0,Q.default)(this,(a.__proto__||q()(a)).call(this,s));return e.state={showAddNodeBtnMenu:!1},e}return(0,te.default)(a,[{key:"getUrlByPosition",value:function(e){var t=this.props.baseUrl;return t+e.replace(new RegExp("^/"+md.global.Account.accountId),"/my")}},{key:"handleAddNodeBtn",value:function(){var e=this,t=this.props.currentRoot;(typeof t>"u"?"undefined":(0,Y.default)(t))==="object"&&t.project?(0,x.pF)(t.project.projectId).then(function(){e.setState({showAddNodeBtnMenu:!0})}).catch(function(){return e.setState({showAddNodeBtnMenu:!1})}):this.setState({showAddNodeBtnMenu:!0})}},{key:"addNewFolder",value:function(){}},{key:"selectAll",value:function(){}},{key:"removeNode",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,o=t.currentRoot,r=t.isGlobalSearch,c=t.isList,i=t.isReadOnly,m=t.isRecycle,u=t.isPinDetail,v=t.currentFolder,h=t.keywords,f=t.rootNameAndLink,E=t.startGlobalSearch,C=t.loadRecycleBin,L=t.editRoot,g=t.changeKcView,S=t.toggleDetailAndTogglePin,b=t.openUploadAssistant,K=t.addLinkFile,j=t.onShowAddNewFolder,W=t.onSelectAllItems,de=t.onRemoveNode,re=this.state,se=re.showAddNodeBtnMenu,ue=re.hoverAddNodeBtn;return n.createElement("div",{className:"kcRightHead Relative boxSizing"},n.createElement(uo(),{title:_l("%0-\u77E5\u8BC6",B().isEmpty(v)?f.name:v.name)}),h&&r?n.createElement("div",{className:"searchHead boxSizing"},_l("\u77E5\u8BC6\u4E2D\u5FC3 \u4E2D\u7684\u641C\u7D22\u7ED3\u679C")):n.createElement("div",{className:"kcRightHeadPosition flexRow boxSizing"},n.createElement("span",{className:y()({kcPositionFirst:!v})},n.createElement("a",{className:"kcPosition firstPosition ThemeHoverColor3 ellipsis",href:encodeURI(f.link),title:f.name},f.name)),n.createElement("span",{className:y()({hide:!m})}," ",">"," ",n.createElement("a",{className:"kcPosition ellipsis ThemeHoverColor3",onClick:function(){return C(!0)}},_l("\u56DE\u6536\u7AD9"))),v&&v.position&&v.position.split("/").map(function(T,H){if(!(H==0||H==1||!T)){if(H>v.position.split("/").length-(h&&!r?2:4)){var he=e.getUrlByPosition(v.position.split("/").slice(0,H+1).join("/"));return H===v.position.split("/").length-1?n.createElement("span",{key:H,className:h&&!r?"positionSpan":"flex relative"},"\xA0>"," ",n.createElement("span",{className:y()({lastPosition:!h||r})},n.createElement("a",{className:"kcPosition ellipsis ThemeHoverColor3",href:encodeURI(he),title:T},T))):n.createElement("span",{className:"positionSpan",key:H},"\xA0>"," ",n.createElement("a",{className:"kcPosition ellipsis ThemeHoverColor3",href:encodeURI(he),title:T},T))}else if(H===2)return n.createElement("span",{className:"positionSpan"},"\xA0> ...");return""}}),h&&!r&&n.createElement("span",{className:"globalSearch ellipsis Font16"},"\xA0\xA0",_l("\u4E2D\u7684\u641C\u7D22\u7ED3\u679C")," ",n.createElement("a",{className:"globalSearch",onClick:function(){E(h)}},"\xA0\xA0",_l("\u641C\u7D22\u6574\u4E2A\u77E5\u8BC6\u4E2D\u5FC3")))),n.createElement("div",{className:"kcRightHeadOperate boxSizing"},n.createElement("span",{className:"tip-con","data-tip":"\u5171\u4EAB\u8BBE\u7F6E"},n.createElement("i",{className:y()("icon-group-members ThemeHoverColor3",{hide:!o.id||m}),onClick:function(){L(o.id)}})),n.createElement("span",{className:"tip-con","data-tip":_l("\u6587\u4EF6\u8BE6\u60C5")},n.createElement("i",{className:y()("icon-knowledge-message showDetail ThemeHoverColor3",{ThemeColor3:u},{hide:m}),ref:"toggleDetailAndTogglePinBtn",onClick:S})),n.createElement("span",{className:"tip-con","data-tip":c?_l("\u5207\u6362\u4E3A\u7F29\u7565\u56FE"):_l("\u5207\u6362\u4E3A\u5217\u8868")},n.createElement("i",{className:y()("ThemeHoverColor3",{hide:m},c?"icon-home-navigation":"icon-task-list"),onClick:g})),n.createElement(mo.Z,{popupVisible:se,onPopupVisibleChange:function(H){e.setState({showAddNodeBtnMenu:H})},popupClassName:"DropdownPanelTrigger",action:["click"],popupPlacement:"bottom",builtinPlacements:{bottom:{points:["tl","bl"]}},popup:n.createElement(ye.Z,{className:y()("kcAddNodeBtnMenu",{hide:!se||m})},n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"attachment",className:"Gray_9e"}),onClick:function(){b(),e.setState({showAddNodeBtnMenu:!1})}},_l("\u4E0A\u4F20\u672C\u5730\u6587\u4EF6")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"link",className:"Gray_9e"}),onClick:function(){K(),e.setState({showAddNodeBtnMenu:!1})}},_l("\u6DFB\u52A0\u94FE\u63A5\u6587\u4EF6")),n.createElement(A.Z,{className:"uploadFileForGuide",icon:n.createElement(w.Z,{icon:"task-folder-solid",className:"Gray_9e"}),onClick:function(){j(),e.setState({showAddNodeBtnMenu:!1})}},_l("\u65B0\u5EFA\u6587\u4EF6\u5939"))),popupAlign:{offset:[-70,2],overflow:{adjustX:2,adjustY:1}}},n.createElement("span",{className:y()("kcRightAdd ThemeBGColor3 ThemeHoverBGColor2",{hide:m||(m||o===d.yR.STARED||o===d.yR.RECENT||i)&&o!==d.yR.MY})},n.createElement("i",{className:"icon-plus"}),_l("\u6DFB\u52A0"))),n.createElement(fo,{component:"span",thisArg:this,hoverStateName:"hoverAddNodeBtn",className:y()("kcRightDel boderRadAll_3",ue?"ThemeBGColor2":"ThemeBGColor3",{hide:!m}),onClick:function(){return W(!0,function(){return de(d.P7.DELETED)})}},_l("\u6E05\u7A7A\u56DE\u6536\u7AD9"))))}}]),a}(n.Component),Et.propTypes={currentRoot:p().oneOfType([p().number,p().shape({})]),baseUrl:p().string,currentFolder:p().shape({}),isGlobalSearch:p().bool,isList:p().bool,isPinDetail:p().bool,isReadOnly:p().bool,isRecycle:p().bool,keywords:p().string,rootNameAndLink:p().shape({}),startGlobalSearch:p().func,loadRecycleBin:p().func,editRoot:p().func,changeKcView:p().func,toggleDetailAndTogglePin:p().func,openUploadAssistant:p().func,addLinkFile:p().func,onShowAddNewFolder:p().func,onSelectAllItems:p().func,onRemoveNode:p().func},yt),po(De.prototype,"handleAddNodeBtn",[O.Nj],M()(De.prototype,"handleAddNodeBtn"),De.prototype),De);function Nt(l){var a=l.isReadOnly,s=l.isRecycle,e=l.root,t=l.keywords,o=l.openUploadAssistant,r=void 0,c=void 0;return e===d.yR.RECENT?r="recently":e===d.yR.STARED?r="starFile":r="noFile",t?c=_l("\u641C\u7D22\u65E0\u7ED3\u679C"):e===d.yR.RECENT?c=_l("\u60A8\u6CA1\u6709\u6700\u8FD1\u4F7F\u7528\u7684\u6587\u4EF6"):e===d.yR.STARED?c=_l("\u60A8\u6CA1\u6709\u661F\u6807\u6587\u4EF6"):c=_l("\u60A8\u5F53\u524D\u6CA1\u6709\u6587\u4EF6"),n.createElement("ul",{className:"clearPadding"},n.createElement("div",{className:"clearStyle"},n.createElement("span",{className:"noListMessage Relative"},n.createElement("span",{className:y()(r,{noUpload:s},{isReadOnly:a},{noSearchFile:t}),onClick:!t&&!a&&e!==d.yR.RECENT&&e!==d.yR.STARED&&!s?o:void 0}),n.createElement("span",{className:"Font17"},c),!t&&!s&&e!==d.yR.RECENT&&e!==d.yR.STARED&&!a&&n.createElement("div",{className:"Font14"},_l("\u70B9"),n.createElement("span",{className:"pointer",onClick:o},_l("[\u6DFB\u52A0]")),_l("\u5728\u6B64\u76EE\u5F55\u6DFB\u52A0\u5185\u5BB9")),!s&&e===d.yR.STARED&&n.createElement("div",{className:"Font14"},_l("\u4F7F\u7528\u53F3\u952E\u83DC\u5355\uFF0C\u4E3A\u91CD\u8981\u7684\u6587\u4EF6\u6DFB\u52A0\u661F\u6807")))),n.createElement("div",{className:"noListBG ThemeBG"}))}Nt.propTypes={isReadOnly:p().bool,isRecycle:p().bool,root:p().oneOfType([p().number,p().shape({})]),keywords:p().string,openUploadAssistant:p().func};var qo,ea,pe,gt,Ct;function kt(l,a,s,e,t){var o={};return Object.keys(e).forEach(function(r){o[r]=e[r]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=s.slice().reverse().reduce(function(r,c){return c(l,a,r)||r},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(l,a,o),o=null),o}var vo=(pe=(Ct=gt=function(l){(0,ne.default)(a,l);function a(s){(0,ee.default)(this,a);var e=(0,Q.default)(this,(a.__proto__||q()(a)).call(this,s));return e.state={folderName:""},e}return(0,te.default)(a,[{key:"componentDidMount",value:function(){this.input&&this.input.focus()}},{key:"handleNewFolder",value:function(){var e=this,t=this.props,o=t.addNewFolder,r=t.onHideAddNewFolder,c=this.state.folderName;o(c,function(i){i&&i.validName?e.setState({folderName:i.validName},function(){e.input&&e.input.focus()}):r()})}},{key:"handleKeyDownInFolder",value:function(e){e.keyCode==13&&(this.handleNewFolder(),e.preventDefault(),e.stopPropagation())}},{key:"render",value:function(){var e=this,t=this.props.isList,o=this.state.folderName;return t?n.createElement("li",{key:"new",className:"flexRow addNewFolder"},n.createElement("span",{className:"noSelectPoint"}),n.createElement("span",{className:"type fileIcon-folder"}),n.createElement("input",{ref:function(c){return e.input=c},type:"text",className:"addFolderName flex",value:o,placeholder:_l("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0"),onChange:function(c){e.setState({folderName:c.target.value})},onBlur:this.handleNewFolder,onKeyDown:this.handleKeyDownInFolder})):n.createElement("li",{key:"new",className:"thumbnailItem addNewFolder"},n.createElement("div",{className:"thumbnailImg"},n.createElement("span",{className:"type fileIcon-folder"})),n.createElement("input",{ref:function(c){return e.input=c},type:"text",className:"addFolderName thumbnailName",value:o,placeholder:_l("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0"),onChange:function(c){e.setState({folderName:c.target.value})},onBlur:this.handleNewFolder,onKeyDown:this.handleKeyDownInFolder}))}}]),a}(n.Component),gt.propTypes={isList:p().bool,addNewFolder:p().func,onHideAddNewFolder:p().func},Ct),kt(pe.prototype,"handleNewFolder",[O.Nj],M()(pe.prototype,"handleNewFolder"),pe.prototype),kt(pe.prototype,"handleKeyDownInFolder",[O.Nj],M()(pe.prototype,"handleKeyDownInFolder"),pe.prototype),pe),St=N(53825),At=N(15405),It=N(57916),Dt,wt,Rt,Eo=(0,At.Z)(Dt=(Rt=wt=function(l){(0,ne.default)(a,l);function a(){return(0,ee.default)(this,a),(0,Q.default)(this,(a.__proto__||q()(a)).apply(this,arguments))}return(0,te.default)(a,[{key:"render",value:function(){var e=this,t=this.props.item,o=t.type===d.QZ.FOLDER,r=t.viewType===d.Pi.LINK,c=t.isStared,i=t.canDownload,m=t.canEdit,u=t.isAdmin,v=this.props.isCreateUser,h=this.props.isList||!1,f=!1;return n.createElement(ye.Z,{onClick:this.props.onClickAway,con:this.props.con},!o&&!f&&r&&m&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"edit"}),onClick:function(C){return e.props.onAddLinkFile(!0,t)}},"\u7F16\u8F91"),!h&&(u||m&&t.canDownload||t.canDownload||f)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"kc-hover-download"}),onClick:function(){return e.props.download(t)}},_l("\u4E0B\u8F7D")),n.createElement(A.Z,{className:y()("menuLine",{hide:h})}),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-star"}),className:y()({hide:o||f}),onClick:function(){return e.props.onStarNode(t)}},c?_l("\u53D6\u6D88\u6807\u661F"):_l("\u6807\u661F")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"calendar-task"}),className:y()({hide:f||h}),onClick:function(){return e.props.onShareNode(t)}},_l("\u5206\u4EAB")),n.createElement(A.Z,{className:y()("menuLine",{hide:o||f})}),(u||m)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"edit"}),className:y()({hide:f}),onClick:function(){return e.props.updateNodeName(t)}},_l("\u91CD\u547D\u540D")),!r&&(u||m)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"attachment"}),className:y()({hide:o||f})},n.createElement("span",null,_l("\u4E0A\u4F20\u65B0\u7248\u672C"),n.createElement(It.Z,{item:this.props.item,callback:this.props.updateNodeItem}))),m&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-replace"}),onClick:function(){return e.props.moveOrCopyClick(d.oJ.MOVE,u?null:t.rootId)}},_l("\u79FB\u52A8\u5230\u2026")),(u||m&&t.canDownload||t.canDownload||f)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-more-folder"}),onClick:function(){return e.props.moveOrCopyClick(d.oJ.COPY)}},_l("\u590D\u5236\u5230\u2026")),(u||v&&m||f)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-new-delete"}),onClick:function(){return e.props.removeNode(d.P7.RECYCLED)}},_l("\u5220\u9664")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-message"}),onClick:this.props.showDetail},_l("\u5C5E\u6027")))}}]),a}(n.Component),wt.propTypes={item:p().object,removeNode:p().func,moveOrCopyClick:p().func,updateNodeName:p().func,updateNodeItem:p().func,onShareNode:p().func,onStarNode:p().func,download:p().func,permission:p().number,onAddLinkFile:p().func},Rt))||Dt,Lt=N(92316),Tt,bt,Ft=(0,Be.Z)(vt.Z),Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAQSURBVHgBAQUA+v8A/////wn7A/2j0UkKAAAAAElFTkSuQmCC",yo=(bt=Tt=function(l){(0,ne.default)(a,l);function a(){var s,e,t,o;(0,ee.default)(this,a);for(var r=arguments.length,c=Array(r),i=0;i<r;i++)c[i]=arguments[i];return o=(e=(t=(0,Q.default)(this,(s=a.__proto__||q()(a)).call.apply(s,[this].concat(c))),t),t.state={clickMoreActionsBtn:!1,hoverMoreActionsBtn:!1},e),(0,Q.default)(t,o)}return(0,te.default)(a,[{key:"componentWillReceiveProps",value:function(e){e.selectedItems.size>1&&this.setState({clickMoreActionsBtn:!1})}},{key:"render",value:function(){var e=this,t=this.props,o=t.className,r=t.path,c=t.baseUrl,i=t.item,m=t.selected,u=t.isList,v=t.isRecycle,h=t.animation,f=t.permission,E=t.removeNode,C=t.restoreNode,L=t.onStarNode,g=t.updateNodeName,S=t.updateNodeItem,b=t.showDetail,K=t.handlePreview,j=t.handleAddLinkFile,W=t.onShareNode,de=t.moveOrCopyClick,re=t.download,se=t.loadListById,ue=t.onAddLinkFile,T=i.owner.accountId===md.global.Account.accountId,H=i.viewType===d.Pi.LINK,he=this.state.clickMoreActionsBtn&&n.createElement(Eo,{item:i,permission:f,onClickAway:function(){return e.setState({clickMoreActionsBtn:!1})},onClickAwayExceptions:[this.moreActions],removeNode:E,moveOrCopyClick:de,updateNodeName:g,updateNodeItem:S,handleAddLinkFile:j,onShareNode:W,onStarNode:L,download:re,isList:u,showDetail:b,isCreateUser:T,onAddLinkFile:ue,con:"#kclistContainer"}),J=(0,x.kQ)(i.type!==d.QZ.FOLDER&&i.ext),we=i.type===d.QZ.FOLDER&&i.isOpenShare;return we&&(J="fileIcon-folderShared"),u||v?n.createElement("li",{"data-id":i.id,className:y()("nodeItem noSelect flexRow",h,o,{active:m})},n.createElement("span",{className:"noSelectPoint"}),n.createElement("span",{className:"selectBox"},n.createElement("span",{className:"select boderRadAll_3"},n.createElement("i",{className:y()("icon-ok",{hide:!m})}))),i.viewType===d.Pi.PICTURE&&i.previewUrl?n.createElement("img",{alt:"",className:y()("listViewImg",J),src:i.previewUrl.indexOf("imageView2")>-1?i.previewUrl.replace(/imageView2\/\d\/w\/\d+\/h\/\d+(\/q\/\d+)?/,"imageView2/1/w/21/h/24"):i.previewUrl+"&imageView2/1/w/21/h/24",onDragStart:function(P){return P.preventDefault()},onLoad:function(P){P.target.src!=Ue&&$(P.target).removeClass(J)},onError:function(P){return $(P.target).attr("src",Ue)}}):i.type!==d.QZ.FOLDER&&(0,x.Jw)(i.ext)==="doc"?n.createElement(Lt.Z,{className:y()("listViewImg",J),ext:i.ext,onDragStart:function(P){return P.preventDefault()}}):we?n.createElement("span",{className:"folderSharedItem","data-tip":_l("\u5DF2\u5F00\u542F\u6587\u4EF6\u5206\u4EAB")},n.createElement("span",{className:y()("type",J)})):n.createElement("span",{className:y()("type",J)}),H?n.createElement("a",{rel:"noopener noreferrer",href:i.shortLinkUrl,target:"_blank",className:"linkFileName listName ellipsis"},i.name):i.type===d.QZ.FOLDER?v?n.createElement("span",{className:"listName ellipsis",title:i.name,onClick:function(){se(i.id)}},i.name):n.createElement(St.Z,{className:"listName ellipsis",title:i.name,to:encodeURI((c+"/"+r+"/"+i.name).replace(/#/g,"%23"))},i.name):n.createElement("span",{className:"listName ellipsis",title:i.name,onClick:function(P){return K(i,P)}},i.name),n.createElement("span",{className:"itemExt ellipsis",title:i.ext+" \u6587\u4EF6"},i.ext?"."+i.ext:""),n.createElement("input",{type:"text",className:"listNameEdit",defaultValue:i.name}),n.createElement("span",{className:"flex"}),n.createElement("span",{className:y()("nodeActionIcons Relative",{hide:!this.state.clickMoreActionsBtn})},n.createElement("span",{className:y()("mLeft15",{hide:v}),"data-tip":_l("\u5206\u4EAB")},n.createElement("i",{className:y()("preview icon-share pointer ThemeColor3"),onClick:function(){return W(i)}})),(i.isAdmin||i.canEdit&&i.canDownload||i.canDownload)&&n.createElement("span",{"data-tip":_l("\u4E0B\u8F7D")},n.createElement("i",{className:y()("download icon-kc-hover-download pointer ThemeColor3",{hide:v}),onClick:re})),n.createElement("span",{"data-tip":_l("\u66F4\u591A\u64CD\u4F5C")},n.createElement(Ft,{component:"span",ref:function(P){return e.moreActions=P},className:y()("actions pointer",{ThemeColor3:this.state.hoverMoreActionsBtn||this.state.clickMoreActionsBtn},v?"hide":"icon-task-point-more"),thisArg:this,hoverStateName:"hoverMoreActionsBtn",onClick:function(){return e.setState({clickMoreActionsBtn:!0})}})),he,(i.isAdmin||T)&&n.createElement("span",{"data-tip":_l("\u5F7B\u5E95\u5220\u9664")},n.createElement("i",{className:y()("download icon-task-new-delete pointer ThemeColor3",{hide:!v}),onClick:function(){return E(d.P7.DELETED)}})),(i.isAdmin||T)&&n.createElement("span",{"data-tip":_l("\u8FD8\u539F")},n.createElement("i",{className:y()("icon-rotate pointer ThemeColor3",{hide:!v}),onClick:C}))),n.createElement("span",{className:y()("createName ellipsis cursorDefault",{hide:v}),title:i.owner.fullname},i.owner.fullname),n.createElement("span",{className:"createTime ellipsis cursorDefault",title:be()(i.updateTime||i.createTime).format("llll")},(0,D.Mx)(i.updateTime||i.createTime),"\xA0",n.createElement("span",{className:"grey"},i.updater?i.updater.accountId===md.global.Account.accountId?_l("\u6211"):i.updater.fullname:"\u65E0\u4FEE\u6539")),n.createElement("span",{className:"size",title:i.size?(0,D.gB)(i.size,2):void 0},i.size?(0,D.gB)(i.size):"-")):n.createElement("li",{"data-id":i.id,className:y()("nodeItem noSelect thumbnailItem Relative",{active:m})},n.createElement("div",{className:"thumbnailImg"},i.previewUrl||i.type!==d.QZ.FOLDER&&(0,x.Jw)(i.ext)==="doc"?i.previewUrl?n.createElement("img",{alt:"",className:y()("type antiIcon",J),src:i.previewUrl,onDragStart:function(P){return P.preventDefault()},onLoad:function(P){P.target.src!=Ue&&$(P.target).removeClass(y()("type antiIcon",J))},onError:function(P){return $(P.target).attr("src",Ue)}}):n.createElement(Lt.Z,{className:y()("type antiIcon",J),ext:i.ext,onDragStart:function(P){return P.preventDefault()}}):n.createElement("span",{className:y()("type antiIcon",J)})),n.createElement("div",{className:"thumbnailName ellipsis"},H?n.createElement("a",{rel:"noopener noreferrer",href:i.shortLinkUrl,target:"_blank",className:"linkFileName listName ellipsis"},i.name):i.type===d.QZ.FOLDER?v?n.createElement("span",{className:"listName ellipsis",title:i.name,onClick:function(){se(i.id)}},i.name):n.createElement(St.Z,{className:"listName ellipsis",title:i.name,to:encodeURI(c+"/"+r+"/"+i.name)},i.name):n.createElement("span",{className:"listName ellipsis",title:i.name,onClick:function(P){return K(i,P)}},i.name),i.ext?"."+i.ext:""),n.createElement("input",{type:"text",className:"listNameEdit",defaultValue:i.name}),n.createElement("span",{className:y()("nodeActionIcons",{hide:!this.state.clickMoreActionsBtn})},n.createElement("span",{"data-tip":_l("\u66F4\u591A\u64CD\u4F5C")},n.createElement(Ft,{ref:function(P){return e.moreActions=P},component:"span",className:y()("actions pointer icon-task-point-more",{ThemeColor3:this.state.hoverMoreActionsBtn||this.state.clickMoreActionsBtn}),thisArg:this,hoverStateName:"hoverMoreActionsBtn",onClick:function(){return e.setState({clickMoreActionsBtn:!0})}})),he),n.createElement("div",{className:"selectBox"},n.createElement("span",{className:"select hide"},n.createElement("i",{className:y()("icon-ok",{hide:!m})}))))}}]),a}(n.Component),Tt.propTypes={path:p().string,baseUrl:p().string,item:p().object,isList:p().bool,isRecycle:p().bool,selected:p().bool,handlePreview:p().func,updateNodeName:p().func,updateNodeItem:p().func,onShareNode:p().func,removeNode:p().func,moveOrCopyClick:p().func,restoreNode:p().func,showDetail:p().func,download:p().func,handleAddLinkFile:p().func,loadListById:p().func,onAddLinkFile:p().func},bt),No=N(88902),go=N.n(No),Pt,Mt,Ut,Co=(0,At.Z)(Pt=(Ut=Mt=function(l){(0,ne.default)(a,l);function a(){var s,e,t,o;(0,ee.default)(this,a);for(var r=arguments.length,c=Array(r),i=0;i<r;i++)c[i]=arguments[i];return o=(e=(t=(0,Q.default)(this,(s=a.__proto__||q()(a)).call.apply(s,[this].concat(c))),t),t.state={clientX:0,clientY:0},e),(0,Q.default)(t,o)}return(0,te.default)(a,[{key:"componentDidMount",value:function(){this.resetPosition()}},{key:"componentDidUpdate",value:function(){this.resetPosition()}},{key:"resetPosition",value:function(){var e=this.props.kcApp.getBoundingClientRect(),t=e.left,o=e.top,r=this.props.clientX,c=this.props.clientY,i=$(me.findDOMNode(this.rightMenu)),m=$(window).width(),u=$(window).height(),v=i.width(),h=i.height(),f=v+r>m?r-v:r,E=h+c>u?c-h<55?55:c-h:c,C={clientX:f-t+1,clientY:E-o};B().isEqual(B().pick(C,["clientX","clientY"]),B().pick(this.state,["clientX","clientY"]))||this.setState(C)}},{key:"addHideMenu",value:function(e){var t=this,o=(0,et.default)({},e);return go()(o).forEach(function(r){if(typeof o[r]=="function"){var c=o[r];o[r]=function(){t.props.hideRightMenu(),c.apply(void 0,arguments)}}}),o}},{key:"render",value:function(){var e=this,t=this.addHideMenu(this.props),o=t.item,r=t.isRecycle,c=t.isMulti,i=o.type===d.QZ.FOLDER,m=o.viewType===d.Pi.LINK,u=o.isStared,v=o.isAdmin,h=o.canEdit,f=o.owner.accountId===md.global.Account.accountId;return r?n.createElement(ye.Z,{className:"rightMenu",ref:function(C){return e.rightMenu=C},style:{left:this.state.clientX,top:this.state.clientY},onClick:t.onClickAway},n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-new-delete"}),onClick:function(){return t.removeNode(d.P7.DELETED)}},_l("\u5F7B\u5E95\u5220\u9664")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"rotate"}),onClick:t.restoreNode},_l("\u8FD8\u539F"))):n.createElement(ye.Z,{className:"rightMenu",ref:function(C){return e.rightMenu=C},style:{left:this.state.clientX,top:this.state.clientY},onClick:t.onClickAway},n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"kc-view"}),className:y()({hide:i||c}),onClick:function(C){return t.handlePreview(o,C)}},_l("\u9884\u89C8")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-open"}),className:y()({hide:!i||c}),onClick:function(C){return t.changeFolder(o,C)}},"\u6253\u5F00"),!i&&!c&&m&&h&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"edit"}),onClick:function(C){return t.onAddLinkFile(!0,o)}},"\u7F16\u8F91"),(v||h&&o.canDownload||o.canDownload||c)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"kc-hover-download"}),onClick:function(){return t.download(o)}},_l("\u4E0B\u8F7D")),n.createElement(A.Z,{className:"menuLine"}),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-star"}),className:y()({hide:i||c}),onClick:function(){return t.onStarNode(o)}},u?_l("\u53D6\u6D88\u6807\u661F"):_l("\u6807\u661F")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"calendar-task"}),className:y()({hide:c}),onClick:function(){return t.onShareNode(o)}},_l("\u5206\u4EAB")),n.createElement(A.Z,{className:y()("menuLine",{hide:i||c})}),(v||h)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"edit"}),className:y()({hide:c}),onClick:function(){return t.updateNodeName(o)}},_l("\u91CD\u547D\u540D")),!m&&(v||h)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"attachment"}),className:y()({hide:i||c})},n.createElement("span",null,_l("\u4E0A\u4F20\u65B0\u7248\u672C"),n.createElement(It.Z,{item:t.item,callback:t.performUpdateItem}))),h&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-replace"}),onClick:function(){return t.moveOrCopyClick(d.oJ.MOVE,v?null:o.rootId)}},_l("\u79FB\u52A8\u5230\u2026")),(v||h&&o.canDownload||o.canDownload||c)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-more-folder"}),onClick:function(){return t.moveOrCopyClick(d.oJ.COPY)}},_l("\u590D\u5236\u5230\u2026")),(v||f&&h||c)&&n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"task-new-delete"}),onClick:function(){return t.removeNode(d.P7.RECYCLED)}},_l("\u5220\u9664")),n.createElement(A.Z,{icon:n.createElement(w.Z,{icon:"knowledge-message"}),onClick:t.showDetail},_l("\u5C5E\u6027")))}}]),a}(n.Component),Mt.propTypes={item:p().object,kcApp:p().object,permission:p().number,isRecycle:p().bool,isMulti:p().bool,hideRightMenu:p().func,removeNode:p().func,moveOrCopyClick:p().func,restoreNode:p().func,updateNodeName:p().func,onShareNode:p().func,changeFolder:p().func,handlePreview:p().func,download:p().func,onStarNode:p().func,handleAddLinkFile:p().func,onAddLinkFile:p().func},Ut))||Pt,Ot=N(20845),Kt=N(66215),ko=N(57853),jt=N(22507),Zt,_t,xt,Bt,So=(_t=Zt=function(l){(0,ne.default)(a,l);function a(s){(0,ee.default)(this,a);var e=(0,Q.default)(this,(a.__proto__||q()(a)).call(this,s));return e.getShareUrl=function(){e.props.data.id&&I.Z.getNodeById(e.props.data.id).then(function(t){return e._isMounted&&e.setState({shareUrl:t.shareUrl})}).catch(function(t){alert("\u83B7\u53D6\u5206\u4EAB\u94FE\u63A5\u5931\u8D25")})},e.getNodesTotalFolderCountAndFileSize=function(t){if(t.selectAllSize){var o=e.state,r=o.totalFolderCount,c=o.totalFileSize,i=e.state,m=i.folderCount,u=i.fileSize;if(typeof c=="number"&&t.selectAllUnchecked){m=r-t.selectAllUnchecked.filter(function(f){return f.type==d.QZ.FOLDER}).size,u=c-t.selectAllUnchecked.filter(function(f){return f.type==d.QZ.FILE}).reduce(function(f,E){return f+E.size},0),e.setState({folderCount:m,fileSize:u});return}I.Z.getNodesTotalFolderCountAndFileSize({rootType:e.props.rootType,keywords:$.trim($("#smartSearchFile").val()),parentId:e.props.parentId||e.props.rootId,status:e.props.status}).then(function(f){e._isMounted&&e.setState({folderCount:f.totalFolderCount,fileSize:f.totalFileSize,totalFolderCount:f.totalFolderCount,totalFileSize:f.totalFileSize})}).catch(function(){return alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF01"),2)})}else{var v=0,h=0;!t.data.id&&t.data.size>1&&(t.data.map(function(f){return f.type===d.QZ.FOLDER?v++:h+=f.size}),e.setState({folderCount:v,fileSize:h}))}},e.editDownloadable=function(t){var o=t.target.checked,r=e.props.data;o!==r.isDownloadable&&!e.editDownloadablePromise&&(e.editDownloadablePromise=I.Z.updateNode({id:r.id,isDownloadable:o}).then(function(c){if(!c)return ae().reject();alert(_l("\u4FEE\u6539\u6210\u529F")),r=B().assign({},r,{isDownloadable:o}),e.props.performUpdateItem(r),e.editDownloadablePromise=""}).catch(function(){e.editDownloadablePromise="",alert(_l("\u4FEE\u6539\u5931\u8D25"),2)}))},e.editEditable=function(t){var o=t.target.checked,r=e.props.data;o!==r.isEditable&&!e.editEditablePromise&&(e.editEditablePromise=I.Z.updateNode({id:r.id,isEditable:o}).then(function(c){if(!c)return ae().reject();alert(_l("\u4FEE\u6539\u6210\u529F")),r=B().assign({},r,{isEditable:o}),e.props.performUpdateItem(r),e.editEditablePromise=""}).catch(function(){e.editEditablePromise="",alert(_l("\u4FEE\u6539\u5931\u8D25"),2)}))},e.editNodeAttribute=function(t){var o=e.props.data;B().some(t,function(r){return t[r]===o[r]})&&(e.editNodePrimise||(e.editNodePrimise=I.Z.updateNode(B().assign({id:o.id},t)).then(function(r){return r?(alert(_l("\u4FEE\u6539\u6210\u529F")),o=B().extend({},o,t),e.props.performUpdateItem(o),I.Z.getNodeById(o.id).then(function(c){e.editNodePrimise="",e.props.performUpdateItem(c)})):ae().reject()}).catch(function(){e.editNodePrimise="",alert(_l("\u4FEE\u6539\u5931\u8D25"),2)})))},e.getNodeLogDetail=function(){I.Z.getNodeLogDetail({id:e.props.data.id}).then(function(t){var o=t.logCount>0?t.logContent.map(function(r,c){return n.createElement("li",{key:c,className:"notHover"},n.createElement("i",{className:y()("detailLogType",r.type===d.kK.CREATE||r.type===d.kK.CHILDADD?"icon-plus":r.type===d.kK.RECYCLED||r.type===d.kK.DELETED||r.type===d.kK.CHILDRECYCLED||r.type===d.kK.CHILDDELETED?"icon-task-new-delete":"icon-edit")}),n.createElement("div",{className:"detailLogTitle"},n.createElement(jt.Z,{user:{userName:r.handleUser.fullname,accountId:r.handleUser.accountId},className:"bold"}),"\xA0",e.logDesc(r)),n.createElement("div",{className:"detailLogTime"},(0,D.Mx)(r.time)))}):void 0;e._isMounted&&e.setState({detailLog:o})})},e.editVisibleType=function(t){var o=e.props.data;t!==o.visibleType&&I.Z.updateNode({id:o.id,visibleType:t}).then(function(r){if(!r)return ae().reject();alert(_l("\u4FEE\u6539\u6210\u529F")),o=B().assign({},o,{visibleType:t}),e.props.performUpdateItem(o)}).catch(function(){return alert(_l("\u4FEE\u6539\u5931\u8D25"),2)})},e.logDesc=function(t){var o=e.props.data.type===d.QZ.FILE?_l("\u6587\u4EF6"):_l("\u6587\u4EF6\u5939"),r=t.content.childType===2?_l("\u6587\u4EF6"):_l("\u6587\u4EF6\u5939"),c=t.content.name?" "+t.content.name+" ":"",i=t.content.childName?" "+t.content.childName+" ":"",m=t.content.targetName?" "+t.content.targetName+" ":!t.content.targetRootId&&!t.content.targetId?" "+_l("\u6211\u7684\u6587\u4EF6\u6839\u76EE\u5F55")+" ":"",u=function(h){switch(h){case d.lo.CLOSE:return _l("\u5173\u95ED\u8BE5\u6587\u4EF6\u7684\u5206\u4EAB");case d.lo.PROJECT:return _l("\u5141\u8BB8\u672C\u7F51\u6210\u5458\u67E5\u770B");case d.lo.MDUSER:return _l("\u5141\u8BB8\u6709\u7CFB\u7EDF\u8D26\u53F7\u7684\u7528\u6237\u67E5\u770B");case d.lo.PUBLIC:return _l("\u4EFB\u4F55\u4EBA\u90FD\u53EF\u4EE5\u67E5\u770B")}};switch(t.type){case d.kK.CREATE:return n.createElement("span",null,_l("\u521B\u5EFA\u4E86 %0",o),e.props.data.type===d.QZ.FILE?e.genPreviewLink(c,"oldest",e.props.data.id):c,t.content.des?" "+_l("\u8BF4\u660E\uFF1A")+t.content.des:"");case d.kK.RECYCLED:return _l("\u5C06\u6B64%0\u653E\u5165\u56DE\u6536\u7AD9",o);case d.kK.DELETED:return _l("\u5F7B\u5E95\u5220\u9664\u4E86\u6B64%0",o);case d.kK.RECOVERY:return _l("\u8FD8\u539F\u4E86\u6B64%0",o);case d.kK.RENAME:return _l("\u91CD\u547D\u540D\u4E86%0\u4E3A%1",o+t.content.oldName,t.content.newName);case d.kK.SHARE:return _l("\u4FEE\u6539\u4E86%0\u7684\u94FE\u63A5\u6D4F\u89C8\u9650\u5236\u4E3A\uFF1A%1",o+c,u(t.content.visibleType));case d.kK.MOVE:return _l("\u79FB\u52A8\u6B64%0\u5230%1",o,m);case d.kK.COPY:return _l("\u590D\u5236%0\u5230%1",o+c,m);case d.kK.DOWNLOAD:return t.content.isDownloadable?_l("\u4FEE\u6539\u4E86%0\u7684\u4E0B\u8F7D\u8BBE\u7F6E\u4E3A\uFF1A\u53EF\u4E0B\u8F7D",o+c):_l("\u4FEE\u6539\u4E86%0\u7684\u4E0B\u8F7D\u8BBE\u7F6E\u4E3A\uFF1A\u4E0D\u53EF\u4E0B\u8F7D",o+c);case d.kK.EDIT:return t.content.isEditable?_l("\u4FEE\u6539\u4E86%0\u7684\u7F16\u8F91\u8BBE\u7F6E\u4E3A\uFF1A\u53EF\u7F16\u8F91",o+c):_l("\u4FEE\u6539\u4E86%0\u7684\u7F16\u8F91\u8BBE\u7F6E\u4E3A\uFF1A\u4E0D\u53EF\u7F16\u8F91",o+c);case d.kK.CHILDADD:return _l("\u6DFB\u52A0\u4E86%0",r+i);case d.kK.CHILDMOVE:return t.content.isInside?_l("\u79FB\u52A8%0\u5230%1",r+i,m):_l("\u79FB\u52A8%0\u5230\u5176\u4ED6\u4F4D\u7F6E",r+i);case d.kK.CHILDRECYCLED:return _l("\u5C06%0\u653E\u5165\u56DE\u6536\u7AD9",r+i);case d.kK.CHILDDELETED:return _l("\u5F7B\u5E95\u5220\u9664\u4E86%0",r+i);case d.kK.CHILDRESTORE:return _l("\u6062\u590D\u4E86%0",r+i);case d.kK.EDITLINK:return _l("\u5BF9\u6587\u4EF6%0\u91CD\u65B0\u7F16\u8F91",c);case d.kK.OFFICEEDIT:return _l("\u7F16\u8F91\u4E86\u6587\u4EF6%0",c);case d.kK.NEWVERSION:return n.createElement("span",null,_l("\u4E0A\u4F20\u4E86\u65B0\u7248\u672C"),e.genPreviewLink(" "+t.content.newName+" ",t.content.versionId,e.props.data.id),t.content.versionDes?" "+_l("\u7248\u672C\u8BF4\u660E\uFF1A")+t.content.versionDes:"")}},e.genPreviewLink=function(t,o,r){var c=e,i=void 0;return o==="oldest"&&(i=!0,o=void 0),n.createElement("a",{className:"ThemeColor3",onClick:function(){I.Z.getNodeByVersionId({id:r,versionId:o,isOldest:i}).then(function(u){u?e.preview(u):alert(_l("\u8BE5\u6587\u4EF6\u4E0D\u5B58\u5728\u6216\u5DF2\u5220\u9664"),3)})}},t)},e.preview=function(t){e.setState({previewFile:t}),e.props.updateDetailAttachmentsPreviewState(!!t)},e.state={isAttribute:!0,readablePosition:"",folderCount:0,fileSize:0,totalFolderCount:0,totalFileSize:null,shareUrl:"-",previewFile:null},e._isMounted=!1,e}return(0,te.default)(a,[{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,this.getNodesTotalFolderCountAndFileSize(this.props),I.Z.getReadablePosition(this.props.data.position).then(function(t){return e._isMounted&&e.setState({readablePosition:t})}).catch(function(t){t.errorMessage==="\u65E0\u6CD5\u83B7\u53D6\u5171\u4EAB\u6587\u4EF6\u5939\u4FE1\u606F\uFF0C\u53EF\u80FD\u5DF2\u88AB\u5220\u9664\u6216\u6CA1\u6709\u6743\u9650"&&e._isMounted&&e.setState({readablePosition:"\u4F4D\u7F6E\u4E0D\u53EF\u89C1"})}),this.getShareUrl(),$(".slideDetail").on("click",".copyLink",function(){$(this).select()}),$(".slideDetail").on({mouseover:function(){$(this).removeClass("notHover")},mouseout:function(){$(this).addClass("notHover")}},"#detailLog li")}},{key:"componentWillReceiveProps",value:function(e){(0,D.wU)(this.props,e)||this.getNodesTotalFolderCountAndFileSize(e)}},{key:"shouldComponentUpdate",value:function(e,t){return!(0,D.wU)(this.props,e)||!(0,D.wU)(this.state,t)||!(0,D.wU)(this.props.data,e.data)}},{key:"componentDidUpdate",value:function(e){var t=this,o=void 0;(0,D.wU)(this.props.data,e.data)||(o={isAttribute:!0,detailLog:null}),this.props.data&&this.props.data.position!==e.data.position&&B().assign(o,{readablePosition:""}),o&&(this.setState(o),o.hasOwnProperty("readablePosition")&&I.Z.getReadablePosition(this.props.data.position).then(function(r){return t._isMounted&&t.setState({readablePosition:r})}).catch(function(r){r.errorMessage==="\u65E0\u6CD5\u83B7\u53D6\u5171\u4EAB\u6587\u4EF6\u5939\u4FE1\u606F\uFF0C\u53EF\u80FD\u5DF2\u88AB\u5220\u9664\u6216\u6CA1\u6709\u6743\u9650"&&t._isMounted&&t.setState({readablePosition:"\u4F4D\u7F6E\u4E0D\u53EF\u89C1"})})),e.data.id!==this.props.data.id&&this.getShareUrl()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this,t=this.state.previewFile,o=!!this.props.data.id,r=o?this.props.data:"",c=r?r.type===d.QZ.FOLDER:"";return o?n.createElement("div",{style:{height:"100%"}},n.createElement("div",{className:"previewFileMain"},t&&n.createElement(ht.Z,{options:{attachments:[t],callFrom:"kc",hideFunctions:["showKcVersionPanel","saveToKnowlege","share","rename"],fromType:7,index:0},onClose:function(){e.preview(void 0)}})),n.createElement("div",{className:"slideDetail flexColumn"},n.createElement("div",{className:"slideDetailTitle boxSizing"},n.createElement("i",{className:y()("attributeType",(0,x.kQ)(r.ext?r.ext:!1))}),n.createElement("span",{className:"attributeName ellipsis"},r.name,r.ext?"."+r.ext:"")),n.createElement("div",{className:"detailType"},n.createElement("ul",null,n.createElement("li",{className:y()("transitions",{"ThemeBorderColor3 ThemeColor3":this.state.isAttribute}),onClick:function(){return e.setState({isAttribute:!0})}},_l("\u5C5E\u6027")),n.createElement("li",{className:y()("transitions",{"ThemeBorderColor3 ThemeColor3":!this.state.isAttribute}),onClick:function(){return e.setState({isAttribute:!1},e.getNodeLogDetail)}},_l("\u65E5\u5FD7")))),n.createElement("div",{className:"detailContent flex"},n.createElement("div",{className:y()("detailAttribute boxSizing",{hide:!this.state.isAttribute})},n.createElement("ul",{className:y()("attributeList",{removeBorder:c})},n.createElement(fe,{name:_l("\u521B\u5EFA\u4EBA"),value:n.createElement("span",null,n.createElement(ko.Z,{className:"createHeadImg",user:{userHead:r.owner.avatar,accountId:r.owner.accountId},size:24}),n.createElement(jt.Z,{user:{userName:r.owner.fullname,accountId:r.owner.accountId,isDelete:r.owner.isDelete}}))}),n.createElement(fe,{name:_l("\u7C7B\u578B"),value:r.ext?r.ext:"\u6587\u4EF6\u5939"}),n.createElement(fe,{name:_l("\u5B58\u50A8\u4F4D\u7F6E"),value:n.createElement("span",{title:this.state.readablePosition},this.state.readablePosition)}),n.createElement(fe,{name:_l("\u521B\u5EFA\u65F6\u95F4"),value:be()(r.createTime).format("YYYY-MM-DD HH:mm:ss")}),n.createElement(fe,{name:_l("\u6700\u8FD1\u4FEE\u6539"),value:be()(r.updateTime).format("YYYY-MM-DD HH:mm:ss")}),n.createElement(fe,{name:_l("\u6D4F\u89C8\u6570"),value:r.viewCount,hide:c}),n.createElement(fe,{name:_l("\u4E0B\u8F7D\u6570"),value:r.downloadCount,hide:c}),n.createElement(fe,{name:_l("\u5206\u4EAB\u94FE\u63A5"),value:n.createElement("input",{type:"text",readOnly:!0,className:"copyLink boderRadAll_3 boxSizing",value:this.state.shareUrl})})),n.createElement("div",null,n.createElement("div",{className:y()("attributeDownload",{hide:c})},n.createElement("span",{className:"greyColor"},_l("\u5141\u8BB8\u4E0B\u8F7D")),r.canChangeDownloadable?n.createElement("div",{className:"switchCon"},n.createElement(Kt.Z,{checked:r.isDownloadable,onClick:function(){r.canChangeDownloadable&&e.editNodeAttribute({isDownloadable:!r.isDownloadable})}})):n.createElement("span",{className:"right greyColor"},r.isDownloadable?_l("\u5141\u8BB8"):_l("\u4E0D\u5141\u8BB8"))),n.createElement("div",{className:"attributeDownload attributeEditBtn"},n.createElement("span",{className:"greyColor"},_l("\u5141\u8BB8\u7F16\u8F91")),r.canChangeEditable?n.createElement("div",{className:"switchCon"},n.createElement(Kt.Z,{checked:r.isEditable,onClick:function(){r.canChangeEditable&&e.editNodeAttribute({isEditable:!r.isEditable})}})):n.createElement("span",{className:"right greyColor"},r.isEditable?_l("\u5141\u8BB8"):_l("\u4E0D\u5141\u8BB8"))),n.createElement("div",{className:"detailAuth"},n.createElement("span",{className:"greyColor"},_l("\u5206\u4EAB\u94FE\u63A5\u6D4F\u89C8\u6743\u9650")),n.createElement("label",{className:"detailAuthM"},n.createElement("input",{type:"radio",name:"shareAuth",disabled:!r.canChangeSharable,className:y()({checked:r.visibleType===d.lo.CLOSE}),checked:r.visibleType==d.lo.CLOSE,onChange:function(){e.editNodeAttribute({visibleType:d.lo.CLOSE})}}),_l("\u5173\u95ED\u8BE5\u6587\u4EF6\u7684\u5206\u4EAB")),n.createElement("label",{className:y()("detailAuthM",{hide:c})},n.createElement("input",{type:"radio",name:"shareAuth",disabled:!r.canChangeSharable,className:y()({checked:r.visibleType===d.lo.PROJECT}),checked:r.visibleType==d.lo.PROJECT,onChange:function(){e.editNodeAttribute({visibleType:d.lo.PROJECT})}}),this.props.rootProjectId?_l("\u5141\u8BB8\u672C\u7EC4\u7EC7\u7684\u6210\u5458\u67E5\u770B"):_l("\u5141\u8BB8\u6240\u6709\u8054\u7CFB\u4EBA\u67E5\u770B")),n.createElement("label",{className:"detailAuthM"},n.createElement("input",{type:"radio",name:"shareAuth",disabled:!r.canChangeSharable,className:y()({checked:r.visibleType===d.lo.PUBLIC||r.visibleType===d.lo.MDUSER}),checked:r.visibleType==d.lo.PUBLIC||r.visibleType==d.lo.MDUSER,onChange:function(){e.editNodeAttribute({visibleType:d.lo.PUBLIC})}}),_l("\u5141\u8BB8\u4EFB\u4F55\u4EBA\u67E5\u770B"))))),!this.state.isAttribute&&n.createElement("ul",{className:y()("detailLog"),id:"detailLog"},this.state.detailLog)),n.createElement("span",{className:"pinDetailCon"},n.createElement(Ot.Z,{text:_l("\u4FDD\u6301\u5C55\u5F00"),size:"middle",checked:this.props.isPinned,onClick:this.props.togglePinned})))):n.createElement("div",{className:"slideDetail flexColumn"},n.createElement("span",{className:"pinDetailCon abs"},n.createElement(Ot.Z,{text:_l("\u4FDD\u6301\u5C55\u5F00"),size:"middle",checked:this.props.isPinned,onClick:this.props.togglePinned})),this.props.data.size?n.createElement("div",{className:"slideDetailItem Font14"},n.createElement("div",{className:"slideDetailItemPic"}),_l("\u5F53\u524D\u9009\u4E2D\u4E86 %0 \u4E2A\u6587\u4EF6\u5939",this.state.folderCount),"\uFF0C",_l("%0\u4E2A\u6587\u4EF6",(this.props.selectAllSize||this.props.data.size)-this.state.folderCount),n.createElement("br",null),n.createElement("span",null,_l("\u6587\u4EF6\u5171 %0",(0,D.gB)(this.state.fileSize)))):n.createElement("div",{className:"slideDetailNoItem Font14"},n.createElement("div",{className:"slideDetailNoItemPic"}),_l("\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6\u6216\u6587\u4EF6\u5939"),"\uFF0C",n.createElement("br",null),_l("\u53EF\u67E5\u770B\u5176\u5C5E\u6027\u548C\u65E5\u5FD7"),"\u3002"))}}]),a}(n.Component),Zt.propTypes={data:p().oneOfType([p().array,p().object])},_t),fe=(Bt=xt=function(l){(0,ne.default)(a,l);function a(){return(0,ee.default)(this,a),(0,Q.default)(this,(a.__proto__||q()(a)).apply(this,arguments))}return(0,te.default)(a,[{key:"render",value:function(){return n.createElement("li",{className:y()("boxSizing ellipsis",{hide:this.props.hide})},n.createElement("span",{className:"attributeLeft"},this.props.name.split("").map(function(e,t){return n.createElement("span",{key:t},e)})),this.props.value)}}]),a}(n.Component),xt.propTypes={name:p().string.isRequired,value:p().any,hide:p().bool},Bt);const Ao=So;function Io(l,a,s){$(document).on("keydown."+l,function(e){return Do(e,a,s)})}function Do(l,a,s){var e=a.selectAllItems,t=a.selectAll,o=a.list,r=a.showDetail,c=a.moveOrCopyClick,i=a.changeFolder,m=a.handlePreview,u=a.removeNode,v=a.getRootNameAndLink,h=s(),f=h.selectedItems,E=h.isRecycle,C=h.currentRoot,L=h.currentFolder,g=h.previewFile,S=h.baseUrl,b=$(l.target);if(!(b.is("input")||b.is("textarea")||b.is("[contenteditable]"))){if(l.ctrlKey||l.metaKey)l.which===65&&(e(!0),l.preventDefault()),l.which===67&&!window.getSelection().toString()&&f.size!==0&&(c(d.oJ.COPY),l.preventDefault()),l.which===88&&f.size!==0&&(c(d.oJ.MOVE,(typeof C>"u"?"undefined":(0,Y.default)(C))==="object"?C.id:null),l.preventDefault());else if(l.altKey)l.which===13&&g&&r(),l.which===38&&!_.isEmpty(L)&&(L.parentId===L.rootId?(0,G.T8)(v(S,C)):I.Z.getNodeById({id:L.parentId}).then(function(W){W&&W.type===d.QZ.FOLDER&&i(W)}));else if(!l.shiftKey&&!l.metaKey&&!l.altKey){if(l.which===46&&u(E?d.P7.DELETED:d.P7.RECYCLED),l.which===13&&ze(t,f,o)&&!g){var K=f.first();K.type!==d.QZ.FOLDER?m(K):i(K)}if(l.which===113&&!g&&ze(t,f,o)){var j=f.first();j.canEdit}}}}function wo(l,a){var s=$(l),e=a.findItemById,t=a.handlePreview,o=a.selectItem,r=a.updateNodeItem,c=a.baseUrl,i=!1;s.on({mousedown:function(u){Ro((0,ie.assign)({},{item:e($(this).attr("data-id")),evt:u},a))},dblclick:function(u){if($(u.target).hasClass("actions"))return!1;var v=e($(this).attr("data-id"));v.type===d.QZ.FOLDER?(0,G.T8)(""+c+v.position.replace(md.global.Account.accountId,"my")):t(v,u)}},".nodeItem"),s.on({click:function(u){var v=e($(this).closest(".nodeItem").attr("data-id"));o(v),u.stopPropagation()},mousedown:function(u){u.stopPropagation()},dblclick:function(u){u.stopPropagation()}},".nodeItem .selectBox"),s.on({blur:function(u){if(!i){i=!0;var v=$(this),h=e(v.closest(".nodeItem").attr("data-id"));if(h){var f=h.name,E=(0,ie.trim)(v.val()),C=function(){v.hide().siblings(".listName,.itemExt,.thumbnailName").show()};if(E&&E!==f){var L={};if(!(0,D.z1)(E,!0,L,{extLength:h.ext.length}))return setTimeout(function(){v.val(L.validName||f).select()},0),u.preventDefault(),i=!1,!1;var g=E+(h.ext?"."+h.ext:"");r(Me()({},h,{name:E})),I.Z.updateNode({id:h.id,name:g}).then(function(S){if(!S)return ae().reject();alert(_l("\u4FEE\u6539\u6210\u529F")),I.Z.getNodeById(h.id).then(function(b){r(b)})}).catch(function(){r(h),alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u6838\u5B9E\u60A8\u7684\u6743\u9650\u7A0D\u540E\u91CD\u8BD5"),3)}).finally(function(){C(),i=!1})}else $(".nodeItem[data-id="+h.id+"]").find(".listNameEdit").val(f),C(),i=!1}}},keydown:function(u){if(u.keyCode===13)$(u.target).blur(),u.preventDefault(),u.stopPropagation();else if(u.keyCode===27){$(u.target).val("").blur();var v=$(this);u.preventDefault(),u.stopPropagation()}}},".nodeItem .listNameEdit"),s.on({click:function(u){var v=e($(this).closest(".nodeItem").attr("data-id"));!(u.ctrlKey||u.metaKey)&&!u.shiftKey&&(v.type===d.QZ.FOLDER?(0,G.T8)(""+c+v.position.replace(md.global.Account.accountId,"my")):t(v,u),u.stopPropagation())}},".nodeItem .thumbnailImg"),document.oncontextmenu=function(m){var u=$(m.target);if(u.is(".rightMenu,.noContextMenu")||u.closest(".rightMenu,.noContextMenu").length)return!1}}function ze(l,a,s){return a.size===1||l&&s.size===1}function Ro(l){var a=l.item,s=l.evt,e=l.selectSingleItem,t=l.startDragItems,o=l.getLatestData,r=l.changeRightMenuOption,c=o(),i=c.isRecycle,m=c.list,u=c.selectAll,v=c.dragSelectEle,h=c.selectedItems,f=u&&m.size===h.size||h.contains(a),E=$(s.target);if(E.closest(".flexRow")||E.hasClass("flexRow")||E.closest(".thumbnailItem")||E.hasClass("thumbnailItem"))if(s.button===0&&!E.hasClass("selectBox")&&(!f||s.ctrlKey||s.metaKey||s.shiftKey?zt(s,v):i?e(a):t(s)),s.button===2){var C={clientX:s.clientX,clientY:s.clientY,item:a};!f||ze(u,h,m)?(C.isMulti=!1,e(a),r(C)):(C.isMulti=!0,r(C))}else r(null)}function Lo(l){var a=l.child,s=l.evt,e=l.selectedItems,t=l.list,o=l.selectItem,r=l.selectItems,c=l.selectSingleItem,i=a.props.item;if(s.ctrlKey||s.metaKey)o(i);else if(s.shiftKey)if(e.size){var m=e.map(function(f){return t.indexOf(f)}).toArray(),u=[(0,ie.min)(m),(0,ie.max)(m)],v=t.indexOf(i);v<u[0]?u=[v,u[0]]:v>u[1]?u=[u[1],v]:u=[u[0],v];var h=t.slice(u[0],u[1]+1);r(h)}else c(i);else c(i)}function To(l){var a=l.children,s=l.evt,e=l.selectItems,t=l.selectedItems,o=l.selectedItemsBeforeDragSelect,r=(0,le.Set)(a).filter(function(c){return c.props&&c.props.item}).map(function(c){return c.props.item});s&&(s.ctrlKey||s.metaKey)?(o=o||t,t=o.union(r).subtract(o.intersect(r))):t=r,e(t)}function bo(l,a){$(l.target).is("ul")&&l.button===0&&zt(l,a)}function zt(l,a){a&&a.startDragSelect(l)}var na,oa,F,Ht,Yt;function ce(l,a,s,e,t){var o={};return Object.keys(e).forEach(function(r){o[r]=e[r]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=s.slice().reverse().reduce(function(r,c){return c(l,a,r)||r},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(l,a,o),o=null),o}var Fo=(0,Be.Z)(so),Po=(F=(Yt=Ht=function(l){(0,ne.default)(a,l);function a(s){(0,ee.default)(this,a);var e=(0,Q.default)(this,(a.__proto__||q()(a)).call(this,s));return e.state={selectedItems:(0,le.List)(),isList:!0,isShowDetail:!1,isPinDetail:!1,newFolderVisible:!1,isPreviewFile:!1,previewIndex:0,rightMenuOption:void 0,detailAttamentsPreviewActive:!1},e}return(0,te.default)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.path,o=e.appBaseUrl,r=e.updateKcListElement,c=e.changeFolder,i=e.updateKcBaseUrl;this.jqns=Math.floor(Math.random()*1e5),i(o||"/apps/kc"),r(this.kclist),t?c(t):(0,G.T8)(o+"/my"),Io(this.jqns,Me()({},this.props,{showDetail:this.showDetail,handlePreview:this.handlePreview,getRootNameAndLink:D.fD}),this.getEventLatestData),this.handleRegisterNodeItemEvent()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,o=t.path,r=t.query,c=t.changeFolder;(e.path!==o||e.query.q!==r.q)&&c(e.path)}},{key:"componentWillUnmount",value:function(){$(document).off("."+this.jqns)}},{key:"handleRegisterNodeItemEvent",value:function(){var e=this,t=this.props,o=t.selectItem,r=t.selectSingleItem,c=t.updateNodeItem,i=t.baseUrl;wo(this.kcApp,{findItemById:function(u){var v=e.props.list;return v.filter(_.identity).find(function(h){return h.id===u})},changeRightMenuOption:function(u){return e.setState({rightMenuOption:u})},baseUrl:i,handlePreview:this.handlePreview,selectSingleItem:r,selectItem:o,updateNodeItem:c,startDragItems:function(u){e.setState({draggingItemsStartPos:{left:u.clientX,top:u.clientY}})},getLatestData:this.getEventLatestData})}},{key:"getEventLatestData",value:function(){return Me()({},this.props,{dragSelectEle:this.dragSelect,previewFile:this.state.previewFile})}},{key:"showDetail",value:function(){this.setState({isShowDetail:!0})}},{key:"togglePinDetail",value:function(){var e=this.state.isPinDetail;this.setState({isPinDetail:!e})}},{key:"toggleDetailAndTogglePin",value:function(){var e=this.state,t=e.isPinDetail,o=e.isShowDetail;t===o?t=o=!o:t=o=!0,this.setState({isShowDetail:o,isPinDetail:t})}},{key:"changeKcView",value:function(){var e=this.state.isList;this.setState({isList:!e})}},{key:"handleAddNewFolder",value:function(e){this.setState({newFolderVisible:e})}},{key:"handlePreview",value:function(e){var t=this.props.list,o=t.filter(function(r){return r&&r.type!==1}).findIndex(function(r){return r.id===e.id});this.setState({isPreviewFile:!0,previewIndex:o})}},{key:"hasMultipleSelectedItems",value:function(){var e=this.props,t=e.selectAll,o=e.selectedItems,r=e.list;return o.size>1||t&&r.size>1}},{key:"render",value:function(){var e=this,t=this.props,o=t.path,r=t.list,c=t.totalCount,i=t.baseUrl,m=t.listLoading,u=t.currentRoot,v=t.currentFolder,h=t.params,f=t.searchNodes,E=t.startGlobalSearch,C=t.isGlobalSearch,L=t.triggerLoadMoreNodes,g=t.openUploadAssistant,S=t.addLinkFile,b=t.addNewFolder,K=t.updateNodeItem,j=t.removeNodeItem,W=t.loadMoreKcNodes,de=t.shareNode,re=t.starNode,se=t.moveOrCopyClick,ue=t.removeNode,T=t.selectedItems,H=t.selectAll,he=t.selectAllItems,J=t.selectItem,we=t.selectItems,z=t.selectSingleItem,P=t.changeSortBy,la=t.changeFolder,He=t.restoreNode,X=t.isRecycle,Oe=t.isReadOnly,jo=t.reloadList,Zo=t.kcLeftEditRootFn,_o=t.loadListById,Gt=t.batchDownload,Ye=h.toObject(),Vt=Ye.keywords,$e=Ye.sortBy,Ge=Ye.sortType,Ve=void 0,ve=this.state,Wt=ve.isShowDetail,Re=ve.isList,We=ve.isPinDetail,xo=ve.newFolderVisible,Bo=ve.isPreviewFile,zo=ve.previewIndex,Le=ve.rightMenuOption,Ho=ve.detailAttamentsPreviewActive,ge=r.filter(function(R){return R}),Xt=H&&r.size!==T.size?r.filter(function(R){return!T.some(function(Z){return Z.id===R.id})}):null,Qt=H?r.size===T.size?c-r.size+ge.size:c-Xt.size:T.size,Xe=xo&&n.createElement(vo,{isList:Re,addNewFolder:b,onHideAddNewFolder:function(){return e.handleAddNewFolder(!1)}}),Jt={id:"kclistContainer",className:y()("noContextMenu noSelect cursorDefault",{noMultiItemsSelected:!this.hasMultipleSelectedItems()},Re||X?"kclist":"thumbnail",{relative:!ge.size&&!Xe&&!m},{noListItem:!ge.size}),ref:function(Z){return e.kclist=Z}};if(!ge.size&&!Xe)Ve=n.createElement("div",Jt,m?n.createElement(pt.Z,{size:"big"}):n.createElement(Nt,{isReadOnly:Oe,isRecycle:X,root:u,keywords:Vt,openUploadAssistant:g}));else{var Yo=ge.count()-1;Ve=n.createElement("div",Jt,n.createElement(qe.Z,{scrollContentClassName:"kclistScrollContent",scrollEvent:L},n.createElement(Fo,{key:"nodeList",containerSelector:"#kclistContainer",component:"ul",ref:function(Z){return e.dragSelect=Z},className:"clearfix",style:{position:"relative"},onDragSelectStart:function(){return e.selectedItemsBeforeDragSelect=T},onDragSelectEnd:function(){return e.selectedItemsBeforeDragSelect=null},manuallyStart:!0,clickOnlyDistance:3,onClickOnly:function(Z,Ee){Lo({child:Z,evt:Ee,selectedItems:T,list:r,selectItem:J,selectItems:we,selectSingleItem:z})},onDragSelect:function(Z,Ee){To({children:Z,evt:Ee,selectItems:we,selectedItems:T,selectedItemsBeforeDragSelect:e.selectedItemsBeforeDragSelect})},onMouseDown:function(Z){bo(Z,e.dragSelect)}},Xe,ge.map(function(R,Z){return!!R&&n.createElement(yo,{key:R.id,path:o,baseUrl:i,item:R,permission:u.permission,isList:Re,className:y()({"first-child":Z===0,"last-child":Z===Yo}),animation:Z<20?"fadeInUp ani"+(0,ie.min)([Z*100,900]):"",isRecycle:X,selected:T.contains(R)||H&&r.size===T.size,handlePreview:e.handlePreview,selectedItems:T,removeNode:ue,moveOrCopyClick:se,restoreNode:He,updateNodeName:it,updateNodeItem:K,onShareNode:de,loadListById:_o,handleAddLinkFile:e.handleAddLinkFile,showDetail:e.showDetail,download:function(){return lt(R)},onStarNode:re,onAddLinkFile:S})}).toArray()),m&&n.createElement(pt.Z,{size:"big",className:"mTop10 mBottom10",key:"nodeListLoading"})))}return n.createElement("div",{className:"kcMain kcMain flex",ref:function(Z){return e.kcApp=Z}},n.createElement("div",{className:"previewFileMain"},Bo&&n.createElement(ht.Z,{options:{attachments:r.filter(function(R){return R&&R.type!==1}).toArray(),hideFunctions:X?["share"]:[],callFrom:"kc",fromType:7,index:zo||0},extra:{performUpdateItem:K,performRemoveItems:j,loadMoreAttachments:r.size<c?function(){return new(ae())(function(R,Z){W(function(Ee){(!Ee.list||(0,Y.default)(Ee.list)!=="object")&&Z(),R(Ee.list.filter(function(Qe){return Qe.type!==1}).map(function(Qe){return Me()({},Qe,{previewAttachmentType:"KC"})}))})})}:void 0},onClose:function(){e.setState({isPreviewFile:!1})}})),n.createElement("div",{className:"kcRightContent borderContainer boxSizing flexColumn Relative"},n.createElement(ho,{currentRoot:u,currentFolder:v,baseUrl:i,isList:Re,isReadOnly:Oe,isRecycle:X,keywords:Vt,rootNameAndLink:(0,D.fD)(i,u),searchNodes:f,openUploadAssistant:g,startGlobalSearch:E,isGlobalSearch:C,isPinDetail:We,onRemoveNode:ue,onSelectAllItems:he,onShowAddNewFolder:function(){return e.handleAddNewFolder(!0)},changeKcView:this.changeKcView,addLinkFile:S,loadRecycleBin:jo,editRoot:Zo,toggleDetailAndTogglePin:this.toggleDetailAndTogglePin}),n.createElement("div",{className:y()("flex kcMainContent Relative transitions boxSizing",Wt?"showDetail":"removeDetail")},n.createElement("div",{className:y()("kcToolbar boxSizing",{hide:!ge.size})},n.createElement("span",{className:"selectAll boderRadAll_3","data-tip":_l("\u5168\u9009"),onClick:function(){return he(!1)}},n.createElement("i",{className:y()("icon-ok",{hide:!(H&&r.size===T.size)})})),n.createElement("span",{className:y()("kcToolbarSingle",{hide:T.size>=2||!Re})},n.createElement("span",{className:y()("kcToolbarLabel",{disabledSort:u===d.yR.RECENT}),onClick:function(){return P(d.RY.NAME)}},_l("\u6587\u4EF6\u540D"),n.createElement("i",{className:y()("ThemeColor3",{hide:$e!==d.RY.NAME||u===d.yR.RECENT},Ge===d.U$.ASC?"icon-goprev":"icon-gonext")})),n.createElement("div",{className:"kcToolbarRight transitions"},n.createElement("span",{className:y()("createUser ellipsis",{hide:X})},_l("\u521B\u5EFA\u4EBA")),X?n.createElement("span",{className:"deleteTime ellipsis ThemeColor3",onClick:function(){return P(d.RY.UPDATE_TIME)}},"\u5220\u9664\u65F6\u95F4",n.createElement("i",{className:y()("ThemeColor3",{hide:$e!==d.RY.UPDATE_TIME},Ge===d.U$.ASC?"icon-goprev":"icon-gonext")})):n.createElement("span",{className:y()("editTime ellipsis",{disabledSort:u===d.yR.RECENT}),onClick:function(){return P(d.RY.UPDATE_TIME)}},_l("\u4FEE\u6539\u65F6\u95F4"),n.createElement("i",{className:y()("ThemeColor3",{hide:$e!==d.RY.UPDATE_TIME||u===d.yR.RECENT},Ge===d.U$.ASC?"icon-goprev":"icon-gonext")})),n.createElement("span",{className:"size ellipsis"},_l("\u5927\u5C0F")))),n.createElement("span",{className:y()("kcToolbarMultiple",{hide:T.size<2})},_l("\u5DF2\u9009\u4E2D")+Qt+_l("\u9879"),n.createElement("span",{className:y()({hide:X}),"data-tip":_l("\u6279\u91CF\u4E0B\u8F7D")},n.createElement("i",{className:"icon-kc-hover-download ThemeColor3 pointer",onClick:Gt})),n.createElement("span",{className:y()({hide:X||Oe}),"data-tip":_l("\u6279\u91CF\u79FB\u52A8")},n.createElement("i",{className:"icon-task-replace ThemeColor3 pointer",onClick:function(){return se(d.oJ.MOVE,(typeof u>"u"?"undefined":(0,Y.default)(u))==="object"&&u.permission!=d.aj.OWNER&&u.permission!=d.aj.ADMIN?u.id:null)}})),n.createElement("span",{className:y()({hide:X}),"data-tip":_l("\u6279\u91CF\u590D\u5236")},n.createElement("i",{className:"icon-knowledge-more-folder ThemeColor3 pointer",onClick:function(){return se(d.oJ.COPY)}})),n.createElement("span",{className:y()({hide:X||Oe}),"data-tip":_l("\u6279\u91CF\u5220\u9664")},n.createElement("i",{className:"icon-task-new-delete ThemeColor3 pointer",onClick:function(){return ue(d.P7.RECYCLED)}})),n.createElement("span",{className:y()({hide:!X}),"data-tip":"\u6279\u91CF\u5F7B\u5E95\u5220\u9664"},n.createElement("i",{className:"icon-task-new-delete ThemeColor3 pointer",onClick:function(){return ue(d.P7.DELETED)}})),n.createElement("span",{className:y()({hide:!X}),"data-tip":_l("\u6279\u91CF\u8FD8\u539F")},n.createElement("i",{className:"icon-rotate ThemeColor3 pointer",onClick:He})))),Ve),Le&&n.createElement(Co,{item:Le.item,kcApp:this.kcApp,permission:u.permission,hideRightMenu:function(){return e.setState({rightMenuOption:null})},onClickAway:function(){return e.setState({rightMenuOption:null})},onClickAwayExceptions:[this.dragSelect],clientX:Le.clientX,clientY:Le.clientY,isRecycle:X,isMulti:Le.isMulti,removeNode:ue,moveOrCopyClick:se,restoreNode:He,updateNodeName:it,performUpdateItem:K,onShareNode:de,changeFolder:function(Z){(0,G.T8)("/apps/kc"+Z.position.replace(md.global.Account.accountId,"my"))},handlePreview:this.handlePreview,handleAddLinkFile:this.handleAddLinkFile,download:T.size===1?lt:Gt,showDetail:this.showDetail,onStarNode:re,onAddLinkFile:S})),n.createElement(oo.Z,{open:Wt,onRequestClose:We?null:function(){return e.setState({isShowDetail:!1})},style:{zIndex:Ho?16:6}},n.createElement(Ao,{data:T.size===1?T.toArray()[0]:T,togglePinned:this.togglePinDetail,isPinned:We,performUpdateItem:K,selectAllSize:H?Qt:0,selectAllUnchecked:Xt,rootType:(typeof u>"u"?"undefined":(0,Y.default)(u))==="object"?d.yR.ROOT:u,parentId:v?v.id:null,rootId:(typeof u>"u"?"undefined":(0,Y.default)(u))==="object"?u.id:null,rootProjectId:(typeof u>"u"?"undefined":(0,Y.default)(u))==="object"?u.project&&u.project.projectId||"":null,status:X?d.P7.RECYCLED:d.P7.NORMAL,updateDetailAttachmentsPreviewState:function(Z){e.setState({detailAttamentsPreviewActive:Z})}})))}}]),a}(n.Component),Ht.propTypes={path:p().string,baseUrl:p().string,appBaseUrl:p().string,query:p().shape({q:p().string}),list:p().shape({}),totalCount:p().number,currentRoot:p().oneOfType([p().number,p().shape({})]),selectedItems:p().shape({}),currentFolder:p().shape({}),isGlobalSearch:p().bool,isRecycle:p().bool,isReadOnly:p().bool,selectAll:p().bool,listLoading:p().bool,params:p().shape({}),updateKcListElement:p().func,searchNodes:p().func,startGlobalSearch:p().func,loadMoreKcNodes:p().func,triggerLoadMoreNodes:p().func,changeFolder:p().func,openUploadAssistant:p().func,addLinkFile:p().func,addNewFolder:p().func,updateNodeItem:p().func,removeNodeItem:p().func,shareNode:p().func,starNode:p().func,moveOrCopyClick:p().func,removeNode:p().func,selectItem:p().func,selectSingleItem:p().func,selectItems:p().func,selectAllItems:p().func,changeSortBy:p().func,restoreNode:p().func,reloadList:p().func,kcLeftEditRootFn:p().func,updateKcBaseUrl:p().func,loadListById:p().func,batchDownload:p().func},Yt),ce(F.prototype,"handleRegisterNodeItemEvent",[O.Nj],M()(F.prototype,"handleRegisterNodeItemEvent"),F.prototype),ce(F.prototype,"getEventLatestData",[O.Nj],M()(F.prototype,"getEventLatestData"),F.prototype),ce(F.prototype,"showDetail",[O.Nj],M()(F.prototype,"showDetail"),F.prototype),ce(F.prototype,"togglePinDetail",[O.Nj],M()(F.prototype,"togglePinDetail"),F.prototype),ce(F.prototype,"toggleDetailAndTogglePin",[O.Nj],M()(F.prototype,"toggleDetailAndTogglePin"),F.prototype),ce(F.prototype,"changeKcView",[O.Nj],M()(F.prototype,"changeKcView"),F.prototype),ce(F.prototype,"handleAddNewFolder",[O.Nj],M()(F.prototype,"handleAddNewFolder"),F.prototype),ce(F.prototype,"handlePreview",[O.Nj],M()(F.prototype,"handlePreview"),F.prototype),ce(F.prototype,"hasMultipleSelectedItems",[O.Nj],M()(F.prototype,"hasMultipleSelectedItems"),F.prototype),F),Mo=function(a){return{listLoading:a.kc.listLoading,totalCount:a.kc.totalCount,params:a.kc.params,baseUrl:a.kc.baseUrl,list:a.kc.list,selectAll:a.kc.selectAll,currentRoot:a.kc.currentRoot,currentFolder:a.kc.currentFolder,isGlobalSearch:a.kc.isGlobalSearch,isRecycle:a.kc.isRecycle,isReadOnly:a.kc.isReadOnly,selectedItems:a.kc.selectedItems,kcLeftEditRootFn:a.kc.kcLeftEditRootFn}},Uo=function(a){return{updateKcListElement:(0,U.DE)(Fn,a),changeFolder:(0,U.DE)(Pn,a),changeSortBy:(0,U.DE)(Kn,a),searchNodes:(0,U.DE)(Ze,a),startGlobalSearch:(0,U.DE)(Un,a),loadMoreKcNodes:(0,U.DE)(rt,a),triggerLoadMoreNodes:(0,U.DE)(Ne,a),openUploadAssistant:(0,U.DE)(_n,a),addLinkFile:(0,U.DE)(xn,a),addNewFolder:(0,U.DE)(Bn,a),updateNodeItem:(0,U.DE)(Pe,a),updateKcBaseUrl:(0,U.DE)(Wn,a),removeNodeItem:(0,U.DE)(_e,a),removeNode:(0,U.DE)(zn,a),shareNode:(0,U.DE)(Hn,a),starNode:(0,U.DE)(Yn,a),restoreNode:(0,U.DE)(Gn,a),moveOrCopyClick:(0,U.DE)($n,a),selectItem:(0,U.DE)(Ln,a),selectItems:(0,U.DE)(Tn,a),selectAllItems:(0,U.DE)(Rn,a),selectSingleItem:(0,U.DE)(bn,a),reloadList:(0,U.DE)(Fe,a),loadListById:(0,U.DE)(Mn,a),batchDownload:(0,U.DE)(Vn,a)}};const Oo=(0,ot.$j)(Mo,Uo)(Po);var $t,Ko=(0,en.Z)($t=function(l){(0,ne.default)(a,l);function a(){return(0,ee.default)(this,a),(0,Q.default)(this,(a.__proto__||q()(a)).apply(this,arguments))}return(0,te.default)(a,[{key:"componentDidMount",value:function(){$("html").addClass("AppKc")}},{key:"componentWillUnmount",value:function(){$("html").removeClass("AppKc")}},{key:"render",value:function(){var e=this.props.match.params.path;return n.createElement("div",{className:"kc flexRow"},n.createElement(to,{path:e,query:Ce.parse((location.search||"").slice(1))}),n.createElement(Oo,{appBaseUrl:"/apps/kc",path:e,query:Ce.parse((location.search||"").slice(1))}))}}]),a}(n.Component))||$t}}]);
