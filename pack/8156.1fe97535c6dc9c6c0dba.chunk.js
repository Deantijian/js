"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[8156],{88156:(de,w,n)=>{n.r(w),n.d(w,{default:()=>ie});var H=n(85105),P=n.n(H),C=n(99663),A=n(22600),T=n(49135),R=n(93196),t=n(67294),x=n(12424),K=n(46593),I=n.n(K),Q=n(73935),W=n(45697),N=n.n(W),B=n(17563),V=n(93967),D=n.n(V),Y=n(96486),M=n.n(Y),j=n(43393),J=n.n(j),O=n(33867),X=n(14440),q=n(33126),_=n(3430),ee=n(42506),te=n(97238),ae=n(19771),i=n(44388),U=n(51474),F=n(15577),k,z,Z,b,G=(0,q.Z)(_.Z),ne=(z=k=function(E){(0,R.default)(l,E);function l(){return(0,C.default)(this,l),(0,T.default)(this,(l.__proto__||P()(l)).apply(this,arguments))}return(0,A.default)(l,[{key:"render",value:function(){var c=(parseInt(this.props.percentage*100,10)||0)+"%",e=void 0,d=void 0,p=void 0;switch(this.props.status){case i.TE.COMPLETE:c="100%",e="bgSuccess",d=_l("\u4E0A\u4F20\u6210\u529F"),p=t.createElement(O.Z,{className:"uploadPercentageText fgSuccess",icon:"ok"});break;case i.TE.ERROR:e="bgError",d=this.props.errorText||"\u4E0A\u4F20\u5931\u8D25",p=t.createElement(O.Z,{className:"uploadPercentageText fgError",icon:"delete"});break;case i.TE.UPLOADING:e="ThemeBGColor3",d=c==="100%"?_l("\u5373\u5C06\u5B8C\u6210"):_l("\u4E0A\u4F20\u4E2D"),p=t.createElement("span",{className:"uploadPercentageText"},c);break;case i.TE.QUEUE:default:e="ThemeBGColor3",d=_l("\u6392\u961F\u4E2D"),p=t.createElement("span",{className:"uploadPercentageText"},c);break}return t.createElement("div",{className:"uploadPercentage",title:d},t.createElement("div",{className:"progressContainer"},t.createElement("div",{className:D()("progressBar",e),style:{height:"100%",width:this.props.status===i.TE.ERROR?"100%":c}})),p,t.createElement("div",{className:"progressTitle"},d))}}]),l}(t.Component),k.propTypes={status:N().number,percentage:N().number,errorText:N().string},z),oe=(b=Z=function(E){(0,R.default)(l,E);function l(){return(0,C.default)(this,l),(0,T.default)(this,(l.__proto__||P()(l)).apply(this,arguments))}return(0,A.default)(l,[{key:"render",value:function(){var c=!0,e=void 0,d=void 0,p=void 0;switch(this.props.status){case i.TE.ERROR:e=t.createElement(O.Z,{icon:"turnLeft"}),p=_l("\u91CD\u8BD5"),d=this.props.retryUpload;break;case i.TE.QUEUE:case i.TE.UPLOADING:e=t.createElement("span",{className:"textIcon"},"\xD7"),p="\u53D6\u6D88",d=this.props.cancelUpload;break;case i.TE.COMPLETE:default:c=!1;break}return c&&t.createElement("div",{className:"fileListActionBtn Hand",title:p,icon:e,onClick:d},e)}}]),l}(t.Component),Z.propTypes={status:N().number,cancelUpload:N().func,retryUpload:N().func},b),re=function(E){(0,R.default)(l,E);function l(){var h,c,e,d;(0,C.default)(this,l);for(var p=arguments.length,m=Array(p),u=0;u<p;u++)m[u]=arguments[u];return d=(c=(e=(0,T.default)(this,(h=l.__proto__||P()(l)).call.apply(h,[this].concat(m))),e),e.state={uploadPath:_l("\u6211\u7684\u6587\u4EF6"),parentId:"",rootId:"",fileList:J().OrderedMap(),supportDirectory:!1},e._isMounted=!1,e.updateMarginRight=function(){var a=$(".uploadAssistant .fileListBody").height(),o=$(".uploadAssistant .fileListBody").children("ul").height(),r=0;a<o&&(r=window.isChrome?5:17),$(".fileListHeader .fileListAction").css("marginRight",r)},e.cancelUpload=function(a){if(e.uploader.removeFile(a)){var o=e.state.fileList.remove(a);e.setState({fileList:o})}else alert(_l("\u53D6\u6D88\u5931\u8D25"),2)},e.retryUpload=function(a){var o=e.uploader,r=o.getFile(a);o.trigger("Retry",r)},e.changeUploadPath=function(){(0,ee.default)({dialogTitle:_l("\u4E0A\u4F20\u5230"),isFolderNode:1}).then(function(a){var o=void 0,r=void 0,s=void 0;switch(a.type){case i.yR.NODE:o=U.Z.getReadablePosition(a.node.position),r=a.node.rootId,s=a.node.id;break;case i.yR.ROOT:o=U.Z.getReadablePosition("/"+a.node.id),r=s=a.node.id;break;case i.yR.MY:default:o=_l("\u6211\u7684\u6587\u4EF6"),r=s="";break}I().all([o]).then(function(v){var g=(0,x.Z)(v,1),f=g[0];e._isMounted&&e.setState({uploadPath:f,rootId:r,parentId:s})})})},e.isSupportDirectory=function(){var a=document.createElement("input");return"webkitdirectory"in a&&!("nwdirectory"in a)},e.selectFile=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;a&&a.stopPropagation(),$("#selectFileTrigger").click(),e.setState({hoverChooseBtn:!1})},e.selectDirectory=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;a&&a.stopPropagation(),e.isSupportDirectory()?$("#selectDirectoryTrigger").click():alert(_l("\u4EC5\u652F\u6301 Chrome \u5185\u6838\u6D4F\u89C8\u5668"),3),e.setState({hoverChooseBtn:!1})},c),(0,T.default)(e,d)}return(0,A.default)(l,[{key:"componentDidMount",value:function(){var c=this;this._isMounted=!0;var e=this;if(this.uploader=(0,te.Z)({runtimes:"html5",max_file_count:i.fA,browse_button:"selectFileTrigger",drop_element:"uploadAssistant",error_callback:function(u,a){switch(u){case i.PU.TOO_MANY_FILES:alert(_l("\u652F\u6301\u6BCF\u6B21\u9009\u62E9%0\u4E2A\u6587\u4EF6\uFF0C\u8D85\u8FC7\u7684\u8BF7\u60A8\u5206\u6279\u6B21\u9009\u62E9",i.fA));break;case i.PU.INVALID_FILES:X.Z.error({title:_l("\u4E0A\u4F20\u53D1\u751F\u9519\u8BEF"),description:_l("%0\u4E2A\u6587\u4EF6\u4E0D\u88AB\u652F\u6301\uFF0C\u6CA1\u6709\u52A0\u5165\u4E0A\u4F20\u961F\u5217",a.length),duration:3});break;default:break}},before_upload_check:function(u,a){return U.Z.getUsage().then(function(o){if(o.used+a.reduce(function(r,s){return r+(s.size||0)},0)>o.total)return I().reject(_l("\u9009\u62E9\u7684\u6587\u4EF6\u8D85\u8FC7\u672C\u6708\u4E0A\u4F20\u6D41\u91CF\u4E0A\u9650"))})},init:{PostInit:function(){e._isMounted&&$(Q.findDOMNode(e)).on("change","#selectDirectoryTrigger",function(u){if(u.target.files.length>i.fA){alert(_l("\u652F\u6301\u6BCF\u6B21\u9009\u62E9%0\u4E2A\u6587\u4EF6\uFF0C\u8D85\u8FC7\u7684\u8BF7\u60A8\u5206\u6279\u6B21\u9009\u62E9",i.fA)),u.target.value=null;return}e.uploader.addFile(Array.prototype.map.call(u.target.files,function(a){var o=new moxie.file.File(null,a);return a.webkitRelativePath&&(o.relativePath="/"+a.webkitRelativePath.replace(/^\//,"")),o})),u.target.value=null})},FilesAdded:function(u,a){function o(s){return new(I())(function(v,g){if(s&&s.size%4096==0&&s.size<=102400){var f=new FileReader;f.onload=function(){v()},f.onerror=function(){g()},f.readAsText(s)}else v()})}var r=e.state.fileList;M().forEach(a,function(s){var v=void 0;switch(s.mdUploadErrorType){case i.PU.INVALID_FILES:v=_l("\u6587\u4EF6\u683C\u5F0F\u4E0D\u652F\u6301");break;default:break}var g=s.getNative();o(g).catch(function(){alert(_l("\u6B64\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u4E0A\u4F20\u6587\u4EF6\u5939"),3),u.removeFile(s)}),r=r.set(s.id,{name:s.name,relativePath:s.getSource().relativePath,loaded:s.loaded,size:s.size,status:s.mdUploadErrorType?i.TE.ERROR:i.TE.QUEUE,errorText:v,path:e.state.uploadPath,parentId:e.state.parentId,rootId:e.state.rootId})}),e._isMounted&&e.setState({fileList:r})},FilesRemoved:function(u,a){var o=e.state.fileList;M().forEach(a,function(r){o=o.delete(r.id)}),e._isMounted&&e.setState({fileList:o})},Error:function(u,a,o){o&&alert(o);var r=e.state.fileList.update(a.file.id,function(s){return s||(s={}),s.errorText=o,s.status=i.TE.ERROR,s});e._isMounted&&e.setState({fileList:r})},UploadProgress:function(u,a){var o=e.state.fileList.update(a.id,function(r){return r||(r={}),r.loaded=a&&a.loaded,r.status=i.TE.UPLOADING,r});e._isMounted&&e.setState({fileList:o})},FileUploaded:function(u,a,o){var r=o.response,s=r.bucket,v=r.key,g=r.fsize,f=e.state.fileList.get(a.id);U.Z.addFile({name:f.relativePath?M().trimStart(f.relativePath,"/"):f.name,size:g,filePath:(0,F.tN)(s)+v,parentId:f.parentId,rootId:f.rootId}).then(function(L){var S=e.state.fileList.update(a.id,function(y){return y||(y={}),L?(y.status=i.TE.COMPLETE,y.name=L.name+(L.ext?".":"")+L.ext,y.ext=L.ext):y.status=i.TE.ERROR,y});if(e._isMounted&&e.setState({fileList:S}),location.search&&B.parse(location.search.slice(1)).isMDClient&&typeof window.require<"u"){var le=window.require("electron").ipcRenderer;le.send("kc",{rootId:f.rootId,parentId:f.parentId,fsize:parseInt(g,10)})}else window.opener&&window.opener.reloadNodeList&&window.opener.reloadNodeList(f.rootId,f.parentId,parseInt(g,10))}).catch(function(){var L=e.state.fileList.update(a.id,function(S){return S.status=i.TE.ERROR,S});e._isMounted&&e.setState({fileList:L})})}}}),window.setUploadLocation=function(m){var u=m.position,a=m.parentId,o=m.rootId,r=u?U.Z.getReadablePosition(u):_l("\u6211\u7684\u6587\u4EF6");return I().all([r]).then(function(s){var v=(0,x.Z)(s,1),g=v[0];c._isMounted&&c.setState({uploadPath:g,parentId:a,rootId:o})}),!0},!window.uploadLocation&&window.location.search){var d=B.parse(window.location.search.substr(1)).uploadLocation;d&&(window.uploadLocation=JSON.parse(decodeURIComponent(d)))}if(window.uploadLocation){var p=window.uploadLocation;window.setUploadLocation(p),window.uploadLocation=""}window.onbeforeunload=function(){if(e.state.fileList.find(function(m){return m.status===i.TE.UPLOADING}))return"\u6709\u6587\u4EF6\u6B63\u5728\u4E0A\u4F20\u4E2D\uFF0C\u786E\u5B9A\u8981\u653E\u5F03\u4E0A\u4F20\uFF1F"},window.onresize=function(){e.updateMarginRight()},this.selectFile()}},{key:"componentDidUpdate",value:function(){this.updateMarginRight()}},{key:"componentWillUnmount",value:function(){this.uploader&&this.uploader.destroy(),delete window.setUploadLocation,this._isMounted=!1}},{key:"render",value:function(){var c=this;return t.createElement("div",{id:"uploadAssistant",className:"uploadAssistant flexColumn",onDragOver:function(){return c.setState({dragOver:!0})},onDragLeave:function(){return c.setState({dragOver:!1})},onDrop:function(){return c.setState({dragOver:!1})}},t.createElement("div",{className:"optionContent"},t.createElement("div",{className:D()("dropContainer ThemeBorderColor4",this.state.dragOver?"ThemeBGColor5":"ThemeBGColor6")},t.createElement("div",{className:D()("uploadIcon icon-knowledge-cloud",this.state.dragOver?"ThemeColor3":"ThemeColor4")}),t.createElement("div",{className:"dropDesc"},this.state.dragOver?_l("\u677E\u5F00\u9F20\u6807\u5F00\u59CB\u4E0A\u4F20"):_l("\u62D6\u62FD\u6587\u4EF6\u5230\u8FD9\u91CC\u4E0A\u4F20"))),t.createElement("div",{className:"chooseBtnContainer"},t.createElement(G,{id:"selectFileTrigger",thisArg:this,hoverStateName:"hoverChooseBtn",className:"chooseBtn ThemeHoverBGColor2 ThemeBGColor3"},t.createElement("span",{className:"chooseBtnText"},_l("\u9009\u62E9\u6587\u4EF6"))),!window.isMDClient&&t.createElement(G,{thisArg:this,onClick:this.selectDirectory,hoverStateName:"hoverChooseBtn",className:"chooseBtn ThemeHoverBGColor2 ThemeBGColor3 mLeft20"},t.createElement("span",{className:"chooseBtnText"},_l("\u9009\u62E9\u6587\u4EF6\u5939"))),t.createElement("div",{className:"hide",dangerouslySetInnerHTML:{__html:'<input id="selectDirectoryTrigger" type="file" webkitdirectory="" directory="" />'}})),t.createElement("div",{className:"uploadPathBlock"},t.createElement("span",null,_l("\u6587\u4EF6\u4E0A\u4F20\u5230:")),this.state.uploadPath.split("/").map(function(e,d){return d===0||d>c.state.uploadPath.split("/").length-4?t.createElement("span",{key:d},t.createElement("span",{className:"uploadPath"},e),d===c.state.uploadPath.split("/").length-1?"":"/"):d===1?t.createElement("span",{key:d,className:"uploadPath"},".../"):null}),t.createElement("span",{className:"changeUploadPath ThemeColor3 Hand",onClick:this.changeUploadPath},_l("\u66F4\u6539")))),!!this.state.fileList.size&&t.createElement("div",null,t.createElement("div",{className:"fileList fileListHeader"},t.createElement("div",{className:"fileListItem"},t.createElement("div",{className:"fileListName"},_l("\u6587\u4EF6")),t.createElement("div",{className:"fileListSize"},_l("\u5927\u5C0F")),t.createElement("div",{className:"fileListProgress"},_l("\u72B6\u6001")),t.createElement("div",{className:"fileListPosition"},_l("\u4F4D\u7F6E")),t.createElement("div",{className:"fileListAction"},_l("\u64CD\u4F5C"))))),!!this.state.fileList.size&&t.createElement("div",{className:"fileList fileListBody flex"},t.createElement("ul",null,this.state.fileList.map(function(e,d){return t.createElement("li",{key:d,className:"fileListItem"},t.createElement("div",{className:"fileListName",title:e.name},t.createElement("span",{className:D()("type",(0,F.kQ)(e.ext))}),e.name),t.createElement("div",{className:"fileListSize"},(0,ae.gB)(e.size)),t.createElement("div",{className:"fileListProgress"},t.createElement(ne,{percentage:e.loaded/e.size,status:e.status,errorText:e.errorText})),t.createElement("div",{className:"fileListPosition",title:e.path},e.path),t.createElement("div",{className:"fileListAction"},t.createElement(oe,{status:e.status,cancelUpload:function(){return c.cancelUpload(d)},retryUpload:function(){return c.retryUpload(d)}})))}).toArray())))}}]),l}(t.Component);const se=re;var ue=n(15041),ie=function(E){(0,R.default)(l,E);function l(){return(0,C.default)(this,l),(0,T.default)(this,(l.__proto__||P()(l)).apply(this,arguments))}return(0,A.default)(l,[{key:"componentDidMount",value:function(){$("html").addClass("AppKc AppKcUpload")}},{key:"componentWillUnmount",value:function(){$("html").removeClass("AppKc AppKcUpload")}},{key:"render",value:function(){return t.createElement(se,null)}}]),l}(t.Component)}}]);
