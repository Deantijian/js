"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[2334],{92334:(bt,ue,u)=>{u.r(ue),u.d(ue,{default:()=>kt});var q=u(70801),Lt=u(34279),G=u(64749),ee=u(26581),Le=u(66215),me=u(57853),fe=u(25273),U=u(54208),E=u(33867),Se=u(52945),pe=u.n(Se),W=u(88239),Te=u(85105),M=u.n(Te),H=u(99663),F=u(22600),R=u(49135),A=u(93196),t=u(67294),he=u(36021),St=u(15256),Ze=u(46891),k=u(81912),ve=u(62023),We=u(53825),Me=u(93967),b=u.n(Me),ge=u(20845),ye=u(85315),j=u(45697),re,Ee,He={0:{id:"pending",text:_l("\u5BA1\u6838\u4E2D..."),icon:"start_time",size:18},1:{id:"pass",text:_l("\u5BA1\u6838\u901A\u8FC7"),icon:"check_circle",color:"#01ca83"},2:{id:"fail",text:_l("\u5BA1\u6838\u5931\u8D25"),icon:"workflow_failure",color:"#f44336"}},Fe=(Ee=re=function(y){(0,A.default)(i,y);function i(){return(0,H.default)(this,i),(0,R.default)(this,(i.__proto__||M()(i)).apply(this,arguments))}return(0,F.default)(i,[{key:"render",value:function(){var e=this.props,a=e.config,n=e.status,l=e.className,r=a[n],s=r.text,f=r.icon,o=r.size,p=o===void 0?16:o,c=r.color,m=c===void 0?"#757575":c;return t.createElement("div",{className:b()("workflowStatusIconWrap",l)},t.createElement(E.Z,{style:{fontSize:p,color:m},icon:f}),t.createElement("div",{className:"explainText"},s))}}]),i}(t.Component),re.propTypes={config:(0,j.shape)({icon:j.string,text:j.string,size:j.number,color:j.string}),status:j.number,className:j.string},re.defaultProps={config:He,status:0},Ee);const Re=function(y){var i=y.icon,v=y.explain,e=y.className,a=y.children;return t.createElement("div",{className:b()("workflowEmptyWrap flexColumn",e)},t.createElement("div",{className:"iconWrap"},t.createElement(E.Z,{icon:i})),t.createElement("div",{className:"emptyExplain"},v),a)};var Ae=u(96486),D=u.n(Ae),oe,Ie,Pe=(Ie=oe=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.getData=function(){var a=e.props,n=a.companyId,l=a.api,r=e.state,s=r.data,f=r.pageIndex,o=r.pageSize,p=r.haveMoreData,c=r.isAsc,m=r.sortId,h={companyId:n,pageIndex:f,pageSize:o,isAsc:c,sortId:m};p&&!e.pending&&l(h).then(function(d){e.pending=!1,s=f===1?d:s.concat(d),e.setState({data:s,pageIndex:f+1}),d.length<o&&e.setState({haveMoreData:!1})})},e.handleScroll=function(a,n){var l=e.state.haveMoreData;n.maximum-n.position<=30&&l&&(e.getData(),e.pending=!0)},e.handleSorter=function(a){var n=a.pageIndex,l=a.isAsc,r=a.sortId;e.setState({pageIndex:n,isAsc:l,sortId:r},function(){e.getData(),e.pending=!1})},e.handleDelete=function(a){var n=e.props.deleteSMSTemplate,l=e.state.data,r=l===void 0?[]:l;n({messageTemplateIds:a}).then(function(s){if(s){var f=r.filter(function(o){return!D().includes(a,o.id)});e.setState({data:f}),alert(_l("\u5220\u9664\u6210\u529F"))}else alert(_l("\u5220\u9664\u5931\u8D25"),2)})},e.delTemplate=function(){var a=e,n=e.state.messageTemplateIds,l=n===void 0?[]:n;q.Z.confirm({width:550,title:_l("\u60A8\u786E\u8BA4\u5220\u9664\u6A21\u677F?"),description:t.createElement("span",{className:"Gray"},_l("\u5220\u9664\u540E\uFF0C\u5DE5\u4F5C\u6D41\u4E2D\u65B0\u6DFB\u52A0\u7684\u77ED\u4FE1\u8282\u70B9\u5C06\u4E0D\u80FD\u5728\u9009\u5230\u6B64\u6A21\u677F\uFF0C\u4E4B\u524D\u5DF2\u4F7F\u7528\u6B64\u6A21\u677F\u7684\u8282\u70B9\u4E0D\u53D7\u5F71\u54CD")),onOk:function(){a.handleDelete(l),e.setState({messageTemplateIds:[]})}})},e.state={messageTemplateIds:[],data:[],pageIndex:1,pageSize:20,haveMoreData:!0},e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){this.getData(),this.pending=!0}},{key:"render",value:function(){var e=this,a=this.props.closeLayer,n=this.state,l=n.messageTemplateIds,r=l===void 0?[]:l,s=n.isAsc,f=n.data;return t.createElement("div",{className:"workflowMsgTemplateDialogWrap"},t.createElement(q.Z,{title:t.createElement("div",{className:"flexRow templateTitle"},t.createElement("div",null,_l("\u77ED\u4FE1\u6A21\u7248")),!D().isEmpty(r)&&t.createElement("div",{className:"actBox Font13"},t.createElement("span",{className:"mRight10"},_l("\u5DF2\u9009\u62E9%0\u4E2A\u6A21\u677F",r.length)),t.createElement("span",{className:"del Hand",onClick:this.delTemplate},_l("\u5220\u9664")))),className:"workflowMsgTemplateDialog",visible:!0,footer:null,onCancel:a},f.length?t.createElement("ul",null,t.createElement("li",{className:"header"},t.createElement("div",{className:"content flex"},_l("\u77ED\u4FE1\u5185\u5BB9")),t.createElement("div",{className:"type"},_l("\u7C7B\u578B")),t.createElement("div",{className:"status"},_l("\u5BA1\u6838\u72B6\u6001")),t.createElement("div",{className:b()("msgTemplateCreateTime",{theneColor:!D().isUndefined(s)}),onClick:function(){var p=D().isUndefined(s)?!0:s===!0?!1:void 0;e.setState({isAsc:p},function(){e.handleSorter({isAsc:p,sortId:D().isUndefined(p)?void 0:"createDate",pageIndex:1})})}},_l("\u521B\u5EFA\u65F6\u95F4"),(s===!0||s===!1)&&t.createElement(E.Z,{icon:s?"score-up":"score-down",className:"Gray_75"}))),t.createElement(fe.Z,{className:"workflowMsgTemplateScrollView",updateEvent:this.handleScroll},f.map(function(o,p){var c=o.companySignature,m=o.messageContent,h=o.status,d=o.createDate,I=o.type;return t.createElement("li",{key:p,className:"templates"},t.createElement(ge.Z,{disabled:o.status===0,checked:D().includes(r,o.id),onClick:function(C){var w=[].concat((0,ye.Z)(r));C?w=w.filter(function(T){return T!==o.id}):w.push(o.id),e.setState({messageTemplateIds:w})}}),t.createElement("div",{className:"content flex"},"[",c,"] ",m),t.createElement("div",{className:"type"},I===2?_l("\u8425\u9500\u63A8\u5E7F"):I===3?_l("\u91D1\u878D\u4EA4\u6613"):_l("\u884C\u4E1A\u901A\u77E5")),t.createElement("div",{className:"status"},t.createElement(Fe,{status:h})),t.createElement("div",{className:"msgTemplateCreateTime"},d))}))):t.createElement(Re,{icon:"workflow_sms",explain:_l("\u8FD8\u6CA1\u6709\u77ED\u4FE1\u6A21\u7248"),className:"workflowMsgTemplateEmpty"},t.createElement("div",{className:"moreTips Gray_9e mTop12"},_l("\u77ED\u4FE1\u6A21\u7248\u53EF\u5728\u7F16\u8F91\u77ED\u4FE1\u8282\u70B9\u65F6\u521B\u5EFA")))))}}]),i}(t.Component),oe.propTypes={closeLayer:j.func},oe.defaultProps={closeLayer:function(){}},Ie),$e=u(63025),je=u(90305),Q=u(83534),Oe=u(49365),Ce=u(99924),se=u(12424),Be=u(46593),Ve=u.n(Be),Ye=u(88106),J=u(86735),ze=u(43727),Ge=u(63239),_e=u.n(Ge),Ue=[{value:0,label:_l("\u76F4\u5230\u624B\u52A8\u6062\u590D")},{value:1,label:_l("\u6682\u505C1\u5C0F\u65F6")},{value:2,label:_l("\u6682\u505C2\u5C0F\u65F6")},{value:3,label:_l("\u6682\u505C3\u5C0F\u65F6")},{value:4,label:_l("\u6682\u505C4\u5C0F\u65F6")},{value:5,label:_l("\u6682\u505C5\u5C0F\u65F6")},{value:6,label:_l("\u6682\u505C6\u5C0F\u65F6")}],Tt=[{value:1,label:_l("\u6700\u8FD11\u5C0F\u65F6")},{value:3,label:_l("\u6700\u8FD13\u5C0F\u65F6")},{value:12,label:_l("\u6700\u8FD112\u5C0F\u65F6")},{value:24,label:_l("\u6700\u8FD124\u5C0F\u65F6")}],xe=[{type:"producer",name:_l("\u672C\u6708\u65B0\u589E"),tableHeaderName:_l("\u672C\u6708\u65B0\u589E")},{type:"consumer",name:_l("\u672C\u6708\u6D88\u8D39"),tableHeaderName:_l("\u672C\u6708\u6D88\u8D39")},{type:"difference",name:_l("\u6392\u961F"),tableHeaderName:_l("\u5F53\u524D\u6392\u961F")},{type:"routerIndex",name:"",tableHeaderName:_l("\u901A\u9053")},{type:"waiting",name:"",tableHeaderName:_l("\u72B6\u6001")}],Y=function(i){return String(i).replace(/\B(?=(\d{3})+(?!\d))/g,",")},Qe=u(30381),g=u.n(Qe),Je=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.getChartData=function(){var a=e.props.projectId;k.Z.getHistoryDifferenceByCompanyId({companyId:a,startDate:g()().subtract(24,"h").format("YYYY-MM-DD HH:mm:ss"),endDate:g()().format("YYYY-MM-DD HH:mm:ss")}).then(function(n){n&&_.isArray(n)?(e.setState({historyChartData:n},e.getHistoryAccumulateData),e.dealChartData(n)):e.setState({loadingChart:!1})})},e.renderChart=function(){for(var a=e,n=[],l=Math.floor(g()().subtract(5,"m").format("mm")%5),r=g()().minute(g()().add(5,"m").format("mm")-l),s=e.g2plotComponent.Line,f=12;f>0;f--){var o=g()(r).subtract(f*5,"m").format("YYYY-MM-DD HH:mm");n.push({category:_l("\u6392\u961F"),value:0,date:o},{category:_l("\u65B0\u589E"),value:0,date:o},{category:_l("\u6D88\u8D39"),value:0,date:o})}n.push({value:50}),e.lineChart=new s(e.chantRef,{data:n,xField:"date",yField:"value",seriesField:"category",appendPadding:[20,0],smooth:!0,color:["#F51744","#2196F3","#61DDAA"],xAxis:{label:{style:{fill:"#2C3542",opacity:.45},formatter:function(c){return g()(c).format("HH:mm")}},line:{style:{stroke:"#416180",opacity:.45,lineWidth:.5}},tickLine:{style:{fill:"#BDBDBD",opacity:1}}},yAxis:{label:{type:"inner",offsetY:-3,formatter:function(c){return(""+c).replace(/\d{1,3}(?=(\d{3})+$)/g,function(m){return m+","})},style:{fill:"#2C3542",opacity:.45},grid:{line:{style:{stroke:"rgba(65, 97, 128, 0.15)",lineWidth:.5}}}}},legend:{position:"top-right",offsetY:5},tooltip:{enterable:!0,fields:["category","value"],formatter:function(c){return{name:c.category,value:c.value}},showTitle:!0,title:function(c){return""+g()(c).format("MMMDo HH:mm")},showContent:!0,offset:-40,offsetY:-20,domStyles:{"g2-tooltip-list-item":{textAlign:"left",color:"#333"},"g2-tooltip-title":{color:"#757575"}},customContent:function(c,m){var h=(0,se.Z)(m,3),d=h[0],I=d===void 0?{}:d,x=h[1],C=x===void 0?{}:x,w=h[2],T=w===void 0?{}:w,Z=_.get(I,"data.date");return`<div class="g2TooltipWrap">
            <div class="g2-tooltip-title">`+c+`</div>
            <ul class="g2-tooltip-list">
            `+function(){return m.map(function(L){return L?`<li class="g2-tooltip-list-item">
                <span class="g2-tooltip-marker" style="background-color: `+L.color+`;"></span>
                <span class="g2-tooltip-name">`+L.name+`</span>:
                <span class="g2-tooltip-value">`+L.value+`</span>
                </li>`:""}).join("")}()+`
            </ul>
            <li class="g2-tooltip-list-item TxtCenter">
              <span class="g2-tooltip-name ThemeColor Hand customContent" data-date=`+_e()(Z)+" date1="+Z+`>\u67E5\u770B\u8BE6\u60C5</span>
            </li>
          </div>`}},slider:{height:16,start:23/24,end:1,foregroundStyle:{fill:"#2196F3",opacity:.11},TrendCfg:{backgroundStyle:{fill:"#F5F7F9",opacity:1},lineStyle:{fill:"#DBDBDB",opacity:1}}}}),e.lineChart.on("slider:click",function(p){e.setState({showDate:void 0})}),e.lineChart.render(),$(e.chantRef).on("click",".customContent",function(){var p=$(".customContent"),c=p.data("date"),m=a.state.historyChartData.filter(function(d){return g()(new Date(c))<=g()(d.lastModifiedDate)&&g()(d.lastModifiedDate)<g()(new Date(c)).add(5,"m")}),h=m.map(function(d){return d.id});e.props.updateHistoryDetail({showHistoryDetail:!0,dateStr:c,historyIds:h})})},e.dealChartData=function(a){for(var n=Math.floor(g()().subtract(5,"m").format("mm")%5),l=g()().minute(g()().add(5,"m").format("mm")-n),r=[],s=[],f=function(c){var m=g()(l).subtract(c*5,"m"),h=g()(l).subtract((c-1)*5,"m"),d=h.format("YYYY-MM-DD HH:mm"),I=a.filter(function(x){return m<=g()(x.lastModifiedDate)&&g()(x.lastModifiedDate)<h});_.isEmpty(a)?s.push({category:_l("\u65B0\u589E"),value:0,date:d},{category:_l("\u6D88\u8D39"),value:0,date:d},{category:_l("\u6392\u961F"),value:0,date:d}):r.push({category:_l("\u6392\u961F"),date:d,value:I.reduce(function(x,C){return x+C.difference},0)},{category:_l("\u65B0\u589E"),date:d,value:I.reduce(function(x,C){return x+C.producer},0)},{category:_l("\u6D88\u8D39"),date:d,value:I.reduce(function(x,C){return x+C.consumer},0)})},o=24*60/5;o>0;o--)f(o);_.isEmpty(s)||s.push({value:50}),e.setState({loadingChart:!1}),e.lineChart&&(_.isEmpty(r)?e.lineChart.changeData(s):e.lineChart.changeData(r))},e.getHistoryAccumulateData=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,n=e.state.historyChartData,l=g()().subtract(a,"h"),r=_.filter(n,function(o){return g()(o.lastModifiedDate)>=l}),s=r.reduce(function(o,p){return o+p.producer},0),f=r.reduce(function(o,p){return o+p.consumer},0);e.setState({accumulateAdd:s,accumulateConsumer:f})},e.state={showDate:1,accumulateAdd:0,accumulateConsumer:0,loadingChart:!0},e.lineChart=null,e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){var e=this;Promise.all([u.e(9704),u.e(2122),u.e(1119)]).then(u.bind(u,1119)).then(function(a){e.g2plotComponent=a,e.renderChart()}),this.getChartData()}},{key:"render",value:function(){var e=this,a=this.state,n=a.showDate,l=a.loadingChart,r=a.accumulateAdd,s=a.accumulateConsumer;return t.createElement(t.Fragment,null,t.createElement("div",{className:"pBottom25"},t.createElement("div",{className:"subTitle"},_l("\u5386\u53F2"))),t.createElement("div",{className:"Relative"},t.createElement("div",{className:"historyStatistics"},t.createElement(ze.Z,{className:"selectDate mRight35",placeholder:_l("\u81EA\u5B9A\u4E49"),value:n,border:!0,menuStyle:{width:220},data:[{value:1,text:_l("\u6700\u8FD11\u5C0F\u65F6")},{value:3,text:_l("\u6700\u8FD13\u5C0F\u65F6")},{value:12,text:_l("\u6700\u8FD112\u5C0F\u65F6")},{value:24,text:_l("\u6700\u8FD124\u5C0F\u65F6")}],onChange:function(o){e.setState({showDate:o}),e.getHistoryAccumulateData(o),e.lineChart.update({slider:{start:(24-o)/24}})}}),n&&t.createElement(t.Fragment,null,t.createElement("span",{className:"mRight30 Font12"},t.createElement("span",{className:"Gray_9e"},_l("\u7D2F\u8BA1\u65B0\u589E")," "),t.createElement("span",{className:"Font14 bold"},Y(r))),t.createElement("span",{className:"mRight30 Font12"},t.createElement("span",{className:"Gray_9e"},_l("\u7D2F\u8BA1\u6D88\u8D39")," "),t.createElement("span",{className:"Font14 bold"},Y(s))))),t.createElement("div",{className:"chartBox",ref:function(o){return e.chantRef=o}}),l&&t.createElement("div",{className:"loadingWrap"},t.createElement(U.Z,null))))}}]),i}(t.PureComponent),Zt=u(67272),Xe=u(51024),Wt=u(59768),Ke=u(82891),Mt=u(52262),te=u(65400),qe=u(88902),ie=u.n(qe),et=u(72444),ce=null,tt=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.getMillsecond=function(a){return g()(a).valueOf()},e.func=function(){var a=e.state.endDate,n=a===void 0?new Date:a,l=new Date,r=e.getMillsecond(n)-e.getMillsecond(l);r<0&&clearInterval(ce);var s=Math.floor(r/1e3%60),f=Math.floor(r/1e3/60%60),o=Math.floor(r/1e3/60/60%60),p=Math.floor(o/24);e.setState({timeStr:e.formatValue(p,o,f,s)})},e.formatValue=function(a,n,l,r){return a>0?_l("%0\u5929%1\u65F6%2\u5206",a,n,l):n>0&&!l?_l("%0\u5C0F\u65F6",n):n>0&&l>0?_l("%0\u5C0F\u65F6%1\u5206\u949F",n,l):l>0?_l("%0\u5206\u949F",l):r<0?void 0:_l("1\u5206\u949F")},e.state={endDate:v.endDate||new Date},e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){var e=this;this.func(),ce=setInterval(function(){e.func()},6e4)}},{key:"componentWillReceiveProps",value:function(e){var a=this;this.props.endDate!==e.endDate&&this.setState({endDate:e.endDate},function(){a.func(),ce=setInterval(function(){a.func()},6e4)})}},{key:"render",value:function(){var e=this.state.timeStr;return t.createElement("span",null,e,_l("\u540E\u6062\u590D"))}}]),i}(t.Component),at=u(31261),X=u(5017),nt=(0,J.Z)([`
  background: #fff;
  box-shadow: 0 3px 9px rgba(0, 0, 0, 0.16);
  width: 240px;
  padding: 6px 0;
  .runDateItem {
    line-height: 32px;
    color: #333;
    padding: 0 24px;
    .pause {
      color: #f44336;
    }
    .recover {
      color: #4caf50;
    }
    &:hover {
      .pause {
        color: #fff;
      }
      .recover {
        color: #fff;
      }
    }
  }
  .runDateItem:hover {
    background-color: #2196f3;
    color: #fff;
  }
`],[`
  background: #fff;
  box-shadow: 0 3px 9px rgba(0, 0, 0, 0.16);
  width: 240px;
  padding: 6px 0;
  .runDateItem {
    line-height: 32px;
    color: #333;
    padding: 0 24px;
    .pause {
      color: #f44336;
    }
    .recover {
      color: #4caf50;
    }
    &:hover {
      .pause {
        color: #fff;
      }
      .recover {
        color: #fff;
      }
    }
  }
  .runDateItem:hover {
    background-color: #2196f3;
    color: #fff;
  }
`]),lt=X.ZP.div(nt),rt=[{value:0,label:_l("\u76F4\u5230\u624B\u52A8\u6062\u590D")},{value:1,label:_l("\u6682\u505C1\u5C0F\u65F6")},{value:2,label:_l("\u6682\u505C2\u5C0F\u65F6")},{value:3,label:_l("\u6682\u505C3\u5C0F\u65F6")},{value:4,label:_l("\u6682\u505C4\u5C0F\u65F6")},{value:5,label:_l("\u6682\u505C5\u5C0F\u65F6")},{value:6,label:_l("\u6682\u505C6\u5C0F\u65F6")}];function Ne(y){var i=y.changeOperation,v=i===void 0?function(){}:i,e=y.clickRecover,a=e===void 0?function(){}:e,n=y.item,l=n===void 0?{}:n,r=l.waiting,s=(0,t.useState)(!1),f=(0,se.Z)(s,2),o=f[0],p=f[1];return t.createElement(at.Z,{getPopupContainer:y.getPopupContainer,popupVisible:o,onPopupVisibleChange:function(m){p(m)},popup:function(){return t.createElement(lt,{className:"pauseTimeListCon"},rt.map(function(m){return t.createElement("div",{className:"runDateItem Font13 Hand",key:m.value,onClick:function(){if(p(!1),m.value===0&&r){a(l);return}v(l,m.value)}},m.value===0?r?t.createElement("span",{className:"recover"},_l("\u6062\u590D\u6D88\u8D39")):t.createElement("span",null,t.createElement("span",{className:"pause"},_l("\u6682\u505C"))," \uFF08"+m.label+"\uFF09"):r?_l("\u7EE7\u7EED")+m.label:m.label)}))},action:["click"],popupAlign:{points:["tc","bc"],offset:[5,5],overflow:{adjustX:!0,adjustY:!0}}},t.createElement("span",{onClick:function(){return p(!0)}},y.children))}var De=u(10929),ot=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.batchPauseRecover=function(a,n){var l=e.state.checkedIds,r=l===void 0?[]:l,s=e.props,f=s.detailList,o=s.projectId;k.Z.batch({hours:n,processIds:r,waiting:!!a,companyId:o}).then(function(p){if(p){var c=[];a?c=f.map(function(m){return D().includes(r,m.id)?(0,W.default)({},m,{hours:n,waiting:!0,dueDate:g()().add(n*60+1,"m").format("YYYY-MM-DD HH:mm:ss")}):m}):c=f.map(function(m){return D().includes(r,m.id)?(0,W.default)({},m,{waiting:!1}):m}),alert(_l("\u64CD\u4F5C\u6210\u529F")),e.setState({checkedIds:[],detailList:c})}else alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})},e.resetQueue=function(){var a=e.state.checkedIds,n=a===void 0?[]:a,l=e.props.projectId;k.Z.reset({processIds:n,companyId:l}).then(function(r){r?(alert(_l("\u64CD\u4F5C\u6210\u529F")),e.setState({checkedIds:[]}),e.props.getFlowList(!0)):alert(_l("\u64CD\u4F5C\u5931\u8D25"))})},e.clickRecover=function(a){k.Z.updateWaiting({processId:a.id,hours:a.waiting?void 0:1,waiting:!a.waiting}).then(function(n){if(n){var l=e.props.detailList.map(function(r,s){return a.id===r.id?(0,W.default)({},r,{waiting:!1}):r});e.props.updateDetailList(l)}else alert(_l("\u8BF7\u5148\u5F00\u542F\u5DE5\u4F5C\u6D41"),3)})},e.updateRouterIndex=function(a){var n=e.state,l=n.routerList,r=l===void 0?{}:l,s=n.checkedIds,f=(typeof a>"u"?"undefined":(0,et.default)(a))==="object",o={},p=ie()(r).map(function(m){return Number(m)}).filter(function(m){return m!==a.routerIndex}),c=f?p.length?Number(p[0]):a.routerIndex:Number(a);f?o={hours:a.hours,processIds:[a.id],routerIndex:c,waiting:a.waiting}:o={processIds:e.state.checkedIds,routerIndex:c},k.Z.updateRouterIndex(o).then(function(m){if(m){var h=e.props.detailList.map(function(d,I){return f&&a.id===d.id||!f&&D().includes(s,d.id)?(0,W.default)({},d,{routerIndex:c,routerName:r[c]}):d});e.props.updateDetailList(h)}else alert(_l("\u4FEE\u6539\u5931\u8D25"),2)})},e.changeOperation=function(a,n){k.Z.updateWaiting({processId:a.id,hours:n,waiting:!0}).then(function(l){if(l){var r=e.props.detailList.map(function(s,f){return a.id===s.id?(0,W.default)({},s,{hours:n,waiting:!0,dueDate:g()().add(n*60+1,"m").format("YYYY-MM-DD HH:mm:ss")}):s});e.props.updateDetailList(r)}else alert(_l("\u8BF7\u5148\u5F00\u542F\u5DE5\u4F5C\u6D41"),3)})},e.getRouterList=function(){var a=e.props.projectId;k.Z.getRouterList({companyId:a}).then(function(n){e.setState({routerList:n})})},e.renderTableSorterHeader=function(a){var n=a.type,l=a.tableHeaderName,r=a.name,s=e.props,f=s.sorter,o=f===void 0?{}:f,p=s.showHistoryDetail,c=o.fields,m=o.isDesc;return t.createElement("div",{className:b()("headerItem columnWidth170 flexRow Hand orderTitleHover flexDirection",{pRight16:n==="waiting"}),onClick:function(){return e.props.changeSorter(n)}},n!=="waiting"&&t.createElement("div",{className:"flexColumn manageListOrder"},t.createElement(E.Z,{icon:"arrow-up",className:b()({ThemeColor3:c===n&&!m})}),t.createElement(E.Z,{icon:"arrow-down",className:b()({ThemeColor3:c===n&&m})})),n==="routerIndex"&&t.createElement(ee.Z,{popupClassName:"passageTooltip Tooltip-black",popupAlign:{points:["tc","bc"],offset:[0,-20]},text:t.createElement("div",null,t.createElement("div",null,_l("\u4E3B\u8981\uFF1A\u7528\u4E8E\u5904\u7406\u9700\u8981\u53CA\u65F6\u54CD\u5E94\u7684\u6D41\u7A0B\u3002")),t.createElement("div",null,_l("\u5907\u7528\uFF1A\u9650\u6D41\u901A\u9053\u3002\u7528\u4E8E\u4E34\u65F6\u5904\u7406\u4E3B\u8981\u901A\u9053\u4E2D\u53D1\u751F\u5806\u79EF\u7684\u6D41\u7A0B\u6267\u884C\u3002\u6216\u5904\u7406\u54CD\u5E94\u65F6\u6548\u8981\u6C42\u4F4E\u7684\u6D41\u7A0B\uFF0C\u4F7F\u7528\u6B64\u901A\u9053\u66F4\u7A33\u5B9A\u3002")),t.createElement("div",null,_l("\u8BF4\u660E\uFF1A\u5F53\u4E3B\u8981\u901A\u9053\u7684\u6D41\u7A0B\u6392\u961F\u6570\u8D85\u51FA\u9608\u503C\u65F6\uFF0C\u6B64\u6D41\u7A0B\u7684\u8D85\u51FA\u90E8\u5206\u548C\u7EE7\u7EED\u65B0\u589E\u7684\u6267\u884C\u4F1A\u8FDB\u5165\u5907\u7528\u901A\u9053\u5E76\u4F18\u5148\u4E8E\u5907\u7528\u901A\u9053\u6D41\u7A0B\u5F00\u59CB\u6D88\u8D39\u3002")))},t.createElement(E.Z,{icon:"info_outline",className:"Gray_9e mLeft6 LineHeight54 "})),p?r:l)},e.renderListContent=function(){var a=e.state,n=a.checkedIds,l=n===void 0?[]:n,r=a.routerList,s=r===void 0?{}:r,f=a.queueTime,o=e.props,p=o.detailList,c=o.loading,m=o.pageIndex,h=o.showHistoryDetail;return c&&m===1&&D().isEmpty(p)?t.createElement(U.Z,{className:"mTop15",size:"small"}):D().isEmpty(p)?t.createElement("div",{className:"flexColumn emptyBox"},t.createElement("div",{className:"emptyIcon"},t.createElement(E.Z,{icon:"verify",className:"Font40"})),_l("\u65E0\u6570\u636E")):t.createElement(t.Fragment,null,p.map(function(d,I){var x=d.id,C=d.name,w=d.difference,T=d.producer,Z=d.consumer,L=d.hours,z=d.waiting,de=d.child,ae=d.startAppType,N=d.enabled,S=d.dueDate,ne=d.app,K=d.routerIndex,wt=d.routerName;return t.createElement("div",{className:b()("row flexRow",{checked:D().includes(l,d.id)}),key:x+"-"+I},t.createElement("div",{className:"cloumnItem flex flexRow pLeft10"},t.createElement("div",{className:b()("iconWrap",{unable:!N}),style:{backgroundColor:(Q.EV[de?"subprocess":ae]||{}).iconColor}},t.createElement(E.Z,{icon:(Q.EV[d.child?"subprocess":ae]||{}).iconName})),t.createElement(ge.Z,{className:"checkFlow",checked:D().includes(l,d.id),onClick:function(P){if(P)e.setState({checkedIds:l.filter(function(B){return B!==d.id})});else{var O=[].concat((0,ye.Z)(l));O.push(d.id),e.setState({checkedIds:O})}}}),t.createElement("div",{className:"flexColumn flowInfo"},t.createElement("div",{className:"flowName Hand ellipsis",onClick:function(){return e.props.checkIsAppAdmin(ne.id,d.id,d.name)}},C),t.createElement("div",{className:"Gray_9e Font12 ellipsis"},ne.name))),t.createElement("div",{className:"cloumnItem columnWidth170 textalignR pRight20"},Y(T)),t.createElement("div",{className:"cloumnItem columnWidth170 textalignR pRight20"},z?t.createElement("span",{className:"waitText textalignR"},_l("\u6682\u505C")):t.createElement("span",{className:"waitText textalignR"},Y(Z))),t.createElement("div",{className:"cloumnItem columnWidth170 textalignR"},t.createElement("span",null,Y(w)),t.createElement("span",{className:"queueTimeInfo"},Number(Y(w))?t.createElement(ee.Z,{action:["click"],text:t.createElement("span",null,f),popupPlacement:"right",offset:[0,-2]},t.createElement(E.Z,{onClick:function(){var P=0,O=_l("\u6392\u961F\u65F6\u957F\uFF1A\u5C0F\u4E8E10\u5206\u949F");k.Z.getHistoryDifferenceByProcessId({processId:x}).then(function(B){for(var V=0;V<B.length-1;V++)g()(B[V+1].lastModifiedDate).isAfter(g()(B[V].lastModifiedDate).subtract(10,"minute"))&&g()(B[V+1].lastModifiedDate).isBefore(g()(B[V].lastModifiedDate))&&(P=g()(arr[0].lastModifiedDate).diff(g()(arr[V+1].lastModifiedDate),"minute"),P>60*24?O=_l("\u6392\u961F\u65F6\u957F\uFF1A24\u5C0F\u65F6\u4EE5\u4E0A"):P>60?O=_l("\u6392\u961F\u65F6\u957F\uFF1A%0\u65F6%1\u5206\u949F",parseInt(P/60),P-parseInt(P/60)*60):O=_l("\u6392\u961F\u65F6\u957F\uFF1A%0\u5206\u949F",P));e.setState({queueTime:O})})},icon:"history_toggle_off",className:"Gray_9e Hover_21 Hand"})):"")),md.global.Config.IsLocal&&!h&&t.createElement("div",{className:"cloumnItem columnWidth170 textalignR"},t.createElement("span",{className:"Hand Hover_1f",onClick:function(){return e.updateRouterIndex(d)}},t.createElement("span",{className:"dot",style:D().isUndefined(K)?{}:{background:K===-1?"#2196F3":"#FFC37C"}}),t.createElement("span",{className:"mLeft5"},wt||""),!D().isUndefined(K)&&ie()(s).length>1?t.createElement("div",{className:"flexColumn manageListOrder Right mLeft6"},t.createElement(E.Z,{icon:"arrow-up"}),t.createElement(E.Z,{icon:"arrow-down"})):"")),!h&&t.createElement("div",{className:"cloumnItem columnWidth170 textalignR"},t.createElement(Ne,{item:d,changeOperation:e.changeOperation,clickRecover:e.clickRecover,getPopupContainer:function(){return e.props.monitorContainer}},t.createElement("span",{className:"Hand Hover_1f"},t.createElement("span",{style:{color:z?"#F44336":"#333"}},z?_l("\u6682\u505C"):_l("\u6B63\u5E38")),t.createElement(E.Z,{icon:"arrow-down",className:"Gray_9e mLeft5"})))),t.createElement("div",{className:"cloumnItem columnWidth150 textalignR"},z&&!h&&t.createElement("div",null,L?t.createElement(Ne,{item:d,changeOperation:e.changeOperation,clickRecover:e.clickRecover},t.createElement(E.Z,{icon:"access_time",className:"timeIcon"})):"",L?t.createElement("span",{className:"runWaitInfo"},t.createElement(tt,{endDate:S})):"")))}),c&&m>1&&t.createElement(U.Z,{className:"mTop15",size:"small"}))},e.renderHistoryDateInfo=function(){var a=e.props.dateStr,n=_l("\u6628\u5929"),l=g()(a).format("HH:mm");return g()(a).get("date")===g()().get("date")&&(n=_l("\u4ECA\u5929")),t.createElement("span",null,_l("\u6B63\u5728\u67E5\u770B\u5386\u53F2\u6267\u884C\u8BE6\u60C5\uFF08"+n+" "+l+"\uFF09\uFF0C\u672C\u6708\u65B0\u589E\u3001\u672C\u6708\u6392\u961F\u6307\u622A\u6B62\u5230 "+n+" "+l+" \u7684\u503C"))},e.state={sorter:{},routerList:{}},e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){this.getRouterList()}},{key:"render",value:function(){var e=this,a=this.state,n=a.checkedIds,l=n===void 0?[]:n,r=a.routerList,s=r===void 0?{}:r,f=this.props,o=f.showHistoryDetail,p=f.pageIndex,c=f.count,m=c===void 0?0:c;return t.createElement(t.Fragment,null,t.createElement("div",{className:"flexRow spaceBetween"},D().isEmpty(l)?t.createElement("div",{className:"subTitle"},_l("\u6267\u884C\u8BE6\u60C5")):t.createElement("div",null,t.createElement("span",{className:"Gray Bold mRight16"},_l("\u5DF2\u9009\u62E9%0\u6761\u6D41\u7A0B",l.length)),t.createElement(Ke.default,{trigger:["click"],placement:"bottomLeft",getPopupContainer:function(){return e.props.monitorContainer},overlay:t.createElement("div",{className:"runoOperateBox"},Ue.map(function(h){return t.createElement("div",{className:"runDateItem Font13",key:h.value,onClick:function(){return e.batchPauseRecover(!0,h.value)}},h.label)}))},t.createElement(te.default,{type:"ghostgray",className:"mRight10"},_l("\u6682\u505C"))),t.createElement(te.default,{type:"ghostgray",className:"mRight10",onClick:function(){return e.batchPauseRecover(!1)}},_l("\u6062\u590D")),t.createElement(te.default,{type:"ghostgray",className:"mRight10",onClick:this.resetQueue},_l("\u91CD\u7F6E\u6392\u961F\u8BA1\u6570"),t.createElement(ee.Z,{text:t.createElement("span",null,_l("\u5C06\u6240\u9009\u6D41\u7A0B\u7684\u6392\u961F\u8BA1\u6570\u91CD\u7F6E\u4E3A0\u3002\u957F\u671F\u8FD0\u884C\u76D1\u63A7\u65F6\u53EF\u80FD\u5076\u53D1\u8BA1\u6570\u4E0D\u51C6\u7684\u95EE\u9898\uFF0C\u53EF\u901A\u8FC7\u6B64\u64CD\u4F5C\u5C06\u8BA1\u6570\u5F520"))},t.createElement(E.Z,{icon:"info_outline",className:"mLeft8 Gray_9d"}))),md.global.Config.IsLocal&&ie()(s).map(function(h){return t.createElement(te.default,{type:"ghostgray",className:"mRight10",onClick:function(){return e.updateRouterIndex(h)}},_l("\u901A\u9053\uFF1A"+s[h]))})),t.createElement("div",null,t.createElement(Xe.default,{allowClear:!0,placeholder:_l("\u6D41\u7A0B\u540D\u79F0"),className:"searchFlow",prefix:t.createElement(E.Z,{icon:"search",className:"searchIcon"}),onPressEnter:this.props.changeFlowName,onChange:this.props.changeFlowName}))),o&&t.createElement("div",{className:"checkHistoryWrap"},t.createElement("span",null,this.renderHistoryDateInfo()),t.createElement("span",{className:"mLeft20 ThemeColor Hand",onClick:function(){return e.props.updateHistoryDetail({showHistoryDetail:!1})}},_l("\u53D6\u6D88"))),t.createElement("div",{className:"listContent flex"},t.createElement("div",{className:"detailListHeader flexRow"},t.createElement("div",{className:"headerItem flex"},_l("\u6D41\u7A0B")),xe.filter(function(h){return o?!D().includes(["routerIndex","waiting"],h.type):md.global.Config.IsLocal?!0:h.type!=="routerIndex"}).map(function(h){return e.renderTableSorterHeader(h)}),t.createElement("div",{className:"headerItem columnWidth150"})),t.createElement("div",{className:"detailListBody"},this.renderListContent()),!o&&t.createElement(De.Z,{total:m,pageIndex:p,pageSize:50,onChange:this.props.changePage})))}}]),i}(t.Component),ke=u(97553),st=u(1952),it=u(75809),ct=(0,J.Z)([`
  display: flex;
  min-width: 0;
  flex-wrap: wrap;
`],[`
  display: flex;
  min-width: 0;
  flex-wrap: wrap;
`]),dt=(0,J.Z)([`
  display: flex;
  align-items: center;
  background: #f7f7f7;
  margin-right: 20px;
  margin-bottom: 10px;
  padding-right: 10px;
  border-radius: 24px;
`],[`
  display: flex;
  align-items: center;
  background: #f7f7f7;
  margin-right: 20px;
  margin-bottom: 10px;
  padding-right: 10px;
  border-radius: 24px;
`]),ut=(0,J.Z)([`
  width: 28px;
  height: 28px;
  text-align: center;
  line-height: 28px;
  background: #ffffff;
  border: 1px solid #e0e0e0;
  border-radius: 50%;
  color: #9e9e9e;
  &:hover {
    border: 1px solid #2196f3;
    color: #2196f3;
  }
`],[`
  width: 28px;
  height: 28px;
  text-align: center;
  line-height: 28px;
  background: #ffffff;
  border: 1px solid #e0e0e0;
  border-radius: 50%;
  color: #9e9e9e;
  &:hover {
    border: 1px solid #2196f3;
    color: #2196f3;
  }
`]),mt=X.ZP.div(ct),ft=X.ZP.div(dt),pt=X.ZP.div(ut),ht=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.addNotifier=function(){var a=e.props.projectId,n=e.state.notifiers;(0,it.Z)({SelectUserSettings:{filterAccountIds:n.map(function(l){return l.accountId}),projectId:a,filterOtherProject:!0,unique:!1,callback:function(r){e.setState({notifiers:n.concat(r)})}}})},e.deleteNotifier=function(a){var n=e.state.notifiers;e.setState({notifiers:n.filter(function(l){return l.accountId!==a})})},e.setWarningValue=function(a,n){var l=e.props.projectId;k.Z.updateWarning({accountIds:n.map(function(r){return r.accountId}),companyId:l,value:a}).then(function(r){r?(alert(_l("\u64CD\u4F5C\u6210\u529F")),e.props.onOk(a,n),e.props.onCancel()):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})},e.state={notifiers:v.accountIds||[],warningValue:v.warningValue||100},e}return(0,F.default)(i,[{key:"render",value:function(){var e=this,a=this.props,n=a.isWarning,l=a.onCancel,r=l===void 0?function(){}:l,s=this.state,f=s.notifiers,o=f===void 0?[]:f,p=s.warningValue;return t.createElement(q.Z,{title:_l("\u9884\u8B66\u8BBE\u7F6E"),visible:!0,onCancel:r,overlayClosable:!1,footer:t.createElement("div",null,t.createElement(ke.ZP,{type:"link",onClick:function(){n?e.setState({warningValue:0,notifiers:[]},function(){return e.setWarningValue(0,[])}):r()}},n?_l("\u5173\u95ED\u9884\u8B66"):_l("\u53D6\u6D88")),t.createElement(ke.ZP,{onClick:function(){if(_.isEmpty(o))return alert(_l("\u8BF7\u9009\u62E9\u901A\u77E5\u4EBA"),3);e.setWarningValue(p,o)}},_l("\u786E\u5B9A")))},t.createElement("div",{className:"mBottom16"},t.createElement("span",null,_l("\u5F53\u7D2F\u79EF\u6392\u961F\u8D85\u8FC7 / \u964D\u4F4E\u5230")),t.createElement(G.default,{className:"mdAntSelect mLeft20 mRight10",style:{width:160},value:p,onChange:function(m){return e.setState({warningValue:m})}},[{value:1,label:1},{value:10,label:10},{value:20,label:20},{value:50,label:50},{value:100,label:100},{value:200,label:200},{value:500,label:500},{value:1e3,label:1e3}].map(function(c){return t.createElement(G.default.Option,{key:c.value,value:c.value},c.label)})),t.createElement("span",null,_l("\u6761\u65F6"))),t.createElement(mt,null,t.createElement("span",{className:"txtMiddle mRight20 pTop5"},_l("\u901A\u77E5")),o.map(function(c){return t.createElement(ft,null,t.createElement(me.Z,{className:"circle",user:{userHead:c.avatar,accountId:c.accountId},size:28}),t.createElement("div",{className:"userName flexRow pLeft5"},t.createElement("span",{className:"ellipsis flex"},c.fullname),t.createElement("i",{className:"ming Icon icon-default icon icon-close Font16 mLeft8 Gray_9e Hand",onClick:function(){return e.deleteNotifier(c.accountId)}})))}),t.createElement(pt,{className:"Hand",onClick:this.addNotifier},t.createElement("i",{className:"ming Icon icon-default icon icon-plus Font16"}))))}}]),i}(t.Component),vt=function(i){return(0,st.Z)(ht,i)},gt=function(i){return String(i).replace(/\B(?=(\d{3})+(?!\d))/g,",")},yt=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.getRealTimeData=function(){var a=e.props.projectId;k.Z.getDifferenceByCompanyId({companyId:a}).then(function(n){e.setState({realTimeData:n})})},e.getWarningSetting=function(){var a=e.props.projectId;k.Z.getWarning({companyId:a}).then(function(n){e.setState({warningValue:n.value,accountIds:(n.accountIds||[]).map(function(l){return(0,W.default)({},l,{fullname:l.fullName})})})})},e.renderJustifyInfo=function(a){var n=a.type,l=a.name,r=e.props.projectId,s=e.state,f=s.realTimeData,o=f===void 0?{}:f,p=s.warningValue,c=s.accountIds,m=c===void 0?[]:c,h=m.length;return t.createElement("div",{className:"infoBox flex",key:n},t.createElement("div",{className:"description"},l),t.createElement("div",{className:"countValue"},gt(o[n])||"-"),n==="difference"?t.createElement("div",null,h?t.createElement("span",{className:"Gray_75"},_l("\u9884\u8B66\uFF08%0\uFF09",p)):"",t.createElement("span",{className:"ThemeColor Hand",onClick:function(){vt({projectId:r,warningValue:p,isWarning:h,accountIds:m,onOk:function(x,C){e.setState({warningValue:x,accountIds:C})}})}},h?_l("\u8BBE\u7F6E"):_l("\u9884\u8B66"))):t.createElement("div",{className:"inTime"},_l("5\u5206\u949F\u5185")))},e.state={realTimeData:{consumer:"",difference:"",producer:""}},e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){this.getRealTimeData(),this.getWarningSetting()}},{key:"render",value:function(){var e=this;return t.createElement(t.Fragment,null,t.createElement("div",{className:"subTitle"},_l("\u5B9E\u65F6")),t.createElement("div",{className:"justifyInfo flexRow mBottom32"},xe.filter(function(a){return!_.includes(["routerIndex","waiting"],a.type)}).map(function(a){return e.renderJustifyInfo(a)})))}}]),i}(t.PureComponent),we=u(44897),Et=(0,J.Z)([`
  border-radius: 4px;
  background: #fff;
  padding: 20px 16px 16px;
  box-sizing: border-box;
  overflow-y: auto;
  flex: 1;
  position: relative;
`],[`
  border-radius: 4px;
  background: #fff;
  padding: 20px 16px 16px;
  box-sizing: border-box;
  overflow-y: auto;
  flex: 1;
  position: relative;
`]),It=X.ZP.div(Et),Ct=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.refreshWorkflowMonitor=function(){e.setState({pageIndex:1,sorter:{}},function(){e.getFlowList(),e.realTimeDataRef&&e.realTimeDataRef.getRealTimeData(),e.historyChartRef&&e.historyChartRef.getChartData()})},e.getFlowList=function(a){e.setState({loading:!0});var n=e.state,l=n.pageIndex,r=n.keyword,s=r===void 0?void 0:r,f=n.sorter,o=n.showHistoryDetail,p=n.historyIds,c=p===void 0?[]:p,m=e.props.match.params.projectId,h=f.fields,d=f.isDesc,I=h&&{sorter:(0,Ye.default)({},h,d?"descend":"ascend")}||{};if(o){k.Z.getDifferenceProcessListByIds((0,W.default)({companyId:m,ids:c,pageIndex:1,pageSize:1e3,keyword:s},I)).then(function(C){e.setState({loading:!1,historyDetailList:C})});return}var x=(0,W.default)({companyId:m,pageIndex:a?1:l,pageSize:50,keyword:s},I);l===1?Ve().all([k.Z.getDifferenceProcessCount(x),k.Z.getDifferenceProcessList(x)]).then(function(C){var w=(0,se.Z)(C,2),T=w[0],Z=w[1];e.setState({loading:!1,detailList:Z||e.state.detailList,count:T||0})}):k.Z.getDifferenceProcessList((0,W.default)({companyId:m,pageIndex:a?1:l,pageSize:50,keyword:s},I)).then(function(C){e.setState({loading:!1,detailList:C})})},e.changeSorter=function(a){var n=e.state.sorter.isDesc;e.setState({sorter:{fields:a,isDesc:!n},pageIndex:1},e.getFlowList)},e.changeFlowName=function(a){var n=a.target.value.trim();(!n||a.keyCode&&a.keyCode===13)&&e.setState({keyword:n,pageIndex:1},e.getFlowList)},e.updateHistoryDetail=function(a){var n=a.showHistoryDetail,l=a.dateStr,r=l===void 0?"":l,s=a.historyIds,f=s===void 0?[]:s;e.setState({showHistoryDetail:n,dateStr:r,historyIds:f},function(){e.getFlowList(!0)})},e.changePage=function(a){e.setState({pageIndex:a},e.getFlowList)},e.updateDetailList=function(a){e.setState({detailList:a})},e.state={detailList:[],historyDetailList:[],sorter:{},pageIndex:1,count:0,loading:!1,showHistoryDetail:!1,historyIds:[]},e.lineChart=null,e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){this.getFlowList()}},{key:"render",value:function(){var e=this,a=this.state,n=a.pageIndex,l=a.count,r=a.loading,s=a.detailList,f=s===void 0?[]:s,o=a.showHistoryDetail,p=a.dateStr,c=a.historyDetailList,m=this.props.match.params.projectId;return t.createElement(It,{className:"monitorContainer flex Relative",ref:function(d){return e.monitorContainer=d}},t.createElement(yt,{projectId:m,ref:function(d){return e.realTimeDataRef=d}}),t.createElement(Je,{projectId:m,updateHistoryDetail:this.updateHistoryDetail,ref:function(d){return e.historyChartRef=d}}),t.createElement(ot,{loading:r,pageIndex:n,detailList:o?c:f,projectId:m,sorter:this.state.sorter,showHistoryDetail:o,dateStr:p,count:l,monitorContainer:this.monitorContainer,changeSorter:this.changeSorter,updateDetailList:this.updateDetailList,checkIsAppAdmin:function(d,I,x){return(0,we.Z)({appId:d,title:_l("\u7BA1\u7406\u5DE5\u4F5C\u6D41\u201C%0\u201D",x),description:_l("\u5982\u679C\u4F60\u4E0D\u662F\u5DE5\u4F5C\u6D41\u6240\u5728\u5E94\u7528\u7684\u7BA1\u7406\u5458\uFF0C\u9700\u8981\u5C06\u81EA\u5DF1\u52A0\u4E3A\u7BA1\u7406\u5458\u4EE5\u83B7\u5F97\u6743\u9650"),callback:function(){(0,he.T8)("/workflowedit/"+I)}})},changeFlowName:this.changeFlowName,updateHistoryDetail:this.updateHistoryDetail,getFlowList:this.getFlowList,changePage:this.changePage}))}}]),i}(t.Component),xt=u(64712),be,Nt=[{tab:"workflowList",tabName:_l("\u5DE5\u4F5C\u6D41")},{tab:"monitorTab",tabName:_l("\u76D1\u63A7")}],Dt=[{label:_l("\u5168\u90E8\u7C7B\u578B"),value:""},{label:_l("\u5DE5\u4F5C\u8868\u4E8B\u4EF6"),value:1},{label:_l("\u65F6\u95F4"),value:2},{label:_l("\u4EBA\u5458\u4E8B\u4EF6"),value:9},{label:_l("Webhook"),value:6},{label:_l("\u5B50\u6D41\u7A0B"),value:8},{label:_l("\u81EA\u5B9A\u4E49\u52A8\u4F5C"),value:7},{label:_l("\u5BA1\u6279\u6D41\u7A0B"),value:11},{label:_l("\u5C01\u88C5\u4E1A\u52A1\u6D41\u7A0B"),value:10},{label:_l("\u4E8B\u4EF6\u63A8\u9001"),value:12}],kt=(0,Ze.Z)(be=function(y){(0,A.default)(i,y);function i(v){(0,H.default)(this,i);var e=(0,R.default)(this,(i.__proto__||M()(i)).call(this,v));return e.postList=null,e.updateState=function(a){e.setState((0,W.default)({list:null,pageIndex:1},a),e.searchDataList)},e.searchDataList=D().throttle(function(){e.getList()},200),e.changeTab=function(a){safeLocalStorageSetItem("workflowTab",a),e.setState({activeTab:a})},e.refresh=function(){var a=e.props.match.params.projectId,n=e.state,l=n.apkId,r=n.enabled,s=n.processListType,f=n.isAsc,o=n.keyWords,p=n.pageIndex,c=n.sortId,m=n.activeTab;m!=="workflowList"?e.workflowMonotor&&e.workflowMonotor.refreshWorkflowMonitor():(e.setState({loading:!0}),k.Z.init({companyId:a,keyword:o,pageIndex:p,pageSize:30}).then(function(h){h?k.Z.getProcessByCompanyId({companyId:a,apkId:l,enabled:r,processListType:s,isAsc:f,keyWords:o,pageIndex:1,pageSize:30,sortId:c}).then(function(d){e.setState({list:d.processes,count:d.count,loading:!1})}):e.setState({loading:!1})}))},e.state=pe()({list:null,useCount:"",count:0,appList:[{label:_l("\u5168\u90E8\u5E94\u7528"),value:""}],apkId:"",enabled:0,processListType:"",isAsc:!1,keyWords:"",pageIndex:1,sortId:"createdDate",msgVisible:!1,loading:!1,balance:0,autoPurchaseWorkflowExtPack:!1,autoOrderVisible:!1,activeTab:location.href.includes("monitor")?"monitorTab":localStorage.getItem("workflowTab")?localStorage.getItem("workflowTab"):"workflowList"}),xt.Z.setPageTitle(_l("\u5DE5\u4F5C\u6D41")),e}return(0,F.default)(i,[{key:"componentDidMount",value:function(){var e=this.props.match.params.projectId;this.getList(),this.getWorkflowCount(e),this.getAutoOrderStatus(e)}},{key:"componentWillReceiveProps",value:function(e,a){if(!D().isEqual(e,this.props)){this.setState(pe()({list:null,appList:[{label:_l("\u5168\u90E8\u5E94\u7528"),value:""}],apkId:"",enabled:0,processListType:"",isAsc:!1,keyWords:"",pageIndex:1,sortId:"createdDate",loading:!1}));var n=e.match.params.projectId;this.getList(),this.getWorkflowCount(n)}}},{key:"componentWillUnmount",value:function(){localStorage.removeItem("workflowTab")}},{key:"getList",value:function(){var e=this,a=this.state,n=a.list,l=a.apkId,r=a.enabled,s=a.processListType,f=a.isAsc,o=a.keyWords,p=a.pageIndex,c=a.sortId,m=this.props.match.params.projectId;this.setState({loading:!0}),this.postList&&this.postList.abort(),this.postList=k.Z.getProcessByCompanyId({companyId:m,apkId:l,enabled:r,processListType:s,isAsc:f,keyWords:o,pageIndex:p,pageSize:50,sortId:c}),this.postList.then(function(h){e.setState({list:h.processes,count:h.count,loading:!1})})}},{key:"getWorkflowCount",value:function(e){var a=this;k.Z.getProcessUseCount({companyId:e}).then(function(n){a.setState({useCount:n})})}},{key:"getAppList",value:function(e){var a=this,n=this.state.appList;Oe.Z.getAppsForProject({projectId:e,status:"",order:3,pageIndex:1,pageSize:1e5,keyword:""}).then(function(l){var r=l.apps,s=r.map(function(f){return{label:f.appName,value:f.appId}});a.setState({appList:n.concat(s)})})}},{key:"getAutoOrderStatus",value:function(e){var a=this;Ce.Z.getAutoPurchaseWorkflowExtPack({projectId:e}).then(function(n){a.setState({autoPurchaseWorkflowExtPack:n.autoPurchaseWorkflowExtPack,balance:n.balance})})}},{key:"setAutoOrderStatus",value:function(){var e=this,a=this.props.match.params.projectId;Ce.Z.setAutoPurchaseWorkflowExtPack({projectId:a,autoPurchaseWorkflowExtPack:!this.state.autoPurchaseWorkflowExtPack}).then(function(n){n?e.setState({autoPurchaseWorkflowExtPack:!e.state.autoPurchaseWorkflowExtPack,autoOrderVisible:!1},function(){e.state.autoPurchaseWorkflowExtPack&&e.state.balance<100&&alert("\u5F53\u524D\u8D26\u6237\u4F59\u989D\u4E0D\u8DB3100\u5143\uFF0C\u8BE5\u529F\u80FD\u53EF\u80FD\u65E0\u6CD5\u6B63\u5E38\u8FD0\u884C",3)}):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}},{key:"renderList",value:function(){var e=this,a=this.state,n=a.list,l=a.pageIndex,r=a.loading;if(n!==null)return!n||!n.length?t.createElement("div",{className:"manageListNull flex flexColumn"},t.createElement("div",{className:"iconWrap"},t.createElement(E.Z,{icon:"workflow"})),t.createElement("div",{className:"emptyExplain"},_l("\u6682\u65E0\u5DE5\u4F5C\u6D41"))):t.createElement(fe.Z,{className:"flex"},r?t.createElement(U.Z,{className:"mTop15",size:"small"}):n.map(function(s){return e.renderListItem(s)}))}},{key:"renderListItem",value:function(e){var a=this,n=this.props.match.params.projectId,l=this.state,r=l.list,s=l.loading;return t.createElement("div",{className:"flexRow manageList",key:e.id},t.createElement("div",{className:b()("iconWrap mLeft10",{unable:!e.enabled}),style:{backgroundColor:(Q.EV[e.child?"subprocess":e.startAppType]||{}).iconColor}},t.createElement(E.Z,{icon:(Q.EV[e.child?"subprocess":e.startAppType]||{}).iconName})),t.createElement("div",{className:"flex name mLeft10 mRight40"},t.createElement("div",{className:b()("flexColumn nameBox ThemeColor3 pointer",{unable:!e.enabled}),onClick:function(){return(0,we.Z)({appId:e.apkId,title:_l("\u7BA1\u7406\u5DE5\u4F5C\u6D41\u201C%0\u201D",e.processName),description:_l("\u5982\u679C\u4F60\u4E0D\u662F\u5DE5\u4F5C\u6D41\u6240\u5728\u5E94\u7528\u7684\u7BA1\u7406\u5458\uFF0C\u9700\u8981\u5C06\u81EA\u5DF1\u52A0\u4E3A\u7BA1\u7406\u5458\u4EE5\u83B7\u5F97\u6743\u9650"),callback:function(){(0,he.T8)("/workflowedit/"+e.id)}})}},t.createElement("div",{className:"ellipsis Font14",title:e.processName},e.processName),t.createElement("div",{className:"ellipsis Font12 Gray_bd",title:e.apkName},e.apkName))),t.createElement("div",{className:"columnWidth"},s?"-":e.count.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")),t.createElement("div",{className:"columnWidth"},t.createElement(je.Z,{disabled:e.startAppType===9,list:r,item:e,updateSource:function(o){return a.setState({list:o})}})),t.createElement("div",{className:"columnWidth Gray_9e"},(Q.EV[e.child?"subprocess":e.startAppType]||{}).text),t.createElement("div",{className:"columnWidth Gray_9e"},g()(e.createdDate).format("YYYY-MM-DD")),t.createElement("div",{className:"columnWidth Gray_75 flexRow"},t.createElement(me.Z,{projectId:n,size:28,user:{userHead:e.createdBy.avatar,accountId:e.createdBy.accountId}}),t.createElement("div",{className:"mLeft12 ellipsis flex mRight20"},e.createdBy.fullName)),t.createElement(We.Z,{to:"/workflowedit/"+e.id+"/2",className:"w20 mRight20 TxtCenter"},t.createElement("span",{"data-tip":_l("\u5386\u53F2")},t.createElement(E.Z,{icon:"restore2",className:"listBtn ThemeHoverColor3 Gray_9e"}))))}},{key:"render",value:function(){var e=this,a=this.props.match.params,n=this.state,l=n.loading,r=n.pageIndex,s=n.enabled,f=n.processListType,o=n.msgVisible,p=n.count,c=n.useCount,m=n.appList,h=n.apkId,d=n.sortId,I=n.isAsc,x=n.autoOrderVisible,C=n.autoPurchaseWorkflowExtPack,w=n.activeTab,T=c.limitExecCount,Z=c.useExecCount,L=c.quantity,z=Z/T<.01&&Z/T>0?99.99:(T-Z)/T*100,de=[{label:_l("\u5168\u90E8\u72B6\u6001"),value:0},{label:_l("\u5F00\u542F"),value:1},{label:_l("\u5173\u95ED"),value:2}],ae=md.global.Account.projects.find(function(N){return N.projectId===a.projectId}).licenseType;return t.createElement("div",{className:"adminWorkflowList flex flexColumn orgManagementWrap"},t.createElement("div",{className:"flexRow orgManagementHeader"},t.createElement("div",{className:"tabBox flexRow"},Nt.map(function(N){return t.createElement("div",{key:N.tab,className:b()("tabItem",{active:N.tab===w}),onClick:function(){return e.changeTab(N.tab)}},N.tabName,N.tab==="workflowList"&&p?"\uFF08"+p+"\uFF09":"")})),t.createElement("div",{className:"pre"},t.createElement("div",{className:b()("refresh Hand Font20 Normal",{mRight24:w==="workflowList"}),onClick:this.refresh},t.createElement(E.Z,{icon:"task-later"})),w==="workflowList"&&t.createElement("div",{className:"pointer ThemeHoverColor3 Gray_9e Font13 Normal",onClick:function(){return e.setState({msgVisible:!0})}},t.createElement(E.Z,{icon:"workflow_sms"}),t.createElement("span",{className:"mLeft5"},_l("\u77ED\u4FE1\u6A21\u7248"))))),w==="workflowList"?t.createElement(t.Fragment,null,t.createElement("div",{className:"adminWorkflowCount flexRow"},c?t.createElement(t.Fragment,null,t.createElement("span",{className:"Gray_9e mRight5"},_l("\u672C\u6708\u6267\u884C\u6570")),t.createElement("span",{className:"bold mRight5"},Z.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")+" / "+T.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")),!!(L.quantityLicense||L.quantityMonthly)&&t.createElement("span",{className:"Gray_75"},"\uFF08",_l("\u5305\u542B"),!!L.quantityLicense&&_l(" %0 \u6708\u989D\u5EA6",L.quantityLicense.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")),!!L.quantityLicense&&!!L.quantityMonthly&&t.createElement("span",null,"\uFF0C"),!!L.quantityMonthly&&_l(" %0 \u672C\u6708\u989D\u5EA6",L.quantityMonthly.toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")),"\uFF09"),t.createElement("span",{className:"Gray_9e mLeft15 mRight5"},_l("\u5269\u4F59")),t.createElement("span",{className:"bold",style:{color:(T-Z)/T>.1?"#333":"#f44336"}},(z||0).toFixed(2),"%")):_l("\u52A0\u8F7D\u4E2D..."),!md.global.Config.IsLocal&&!D().includes([0,2],ae)&&t.createElement("div",{className:"workflowAutoOrder"},t.createElement(Le.Z,{checked:C,onClick:function(){return e.setState({autoOrderVisible:!0})}}),t.createElement(ee.Z,{popupPlacement:"bottom",text:t.createElement("span",null,_l("\u672C\u6708\u5269\u4F59\u6267\u884C\u989D\u5EA6\u5230\u8FBE2%\u65F6\uFF0C\u81EA\u52A8\u8D2D\u4E70100\u5143/1\u4E07\u6B21\u7684\u5355\u6708\u5305\uFF0C\u4ECE\u8D26\u6237\u4F59\u989D\u4E2D\u6263\u6B3E"))},t.createElement("span",{className:"Gray_9e Hand"},_l("\u81EA\u52A8\u8BA2\u8D2D"))))),t.createElement("div",{className:"manageListSearch flexRow"},t.createElement(G.default,{className:"w180 mdAntSelect",showSearch:!0,defaultValue:h,options:m,onFocus:function(){return m.length===1&&e.getAppList(a.projectId)},filterOption:function(S,ne){return m.find(function(K){return K.value===ne.value}).label.toLowerCase().indexOf(S.toLowerCase())>-1},suffixIcon:t.createElement(E.Z,{icon:"arrow-down-border Font14"}),notFoundContent:t.createElement("span",{className:"Gray_9e"},_l("\u65E0\u641C\u7D22\u7ED3\u679C")),onChange:function(S){return e.updateState({apkId:S})}}),t.createElement(G.default,{className:"w180 mdAntSelect mLeft15",defaultValue:s,options:de,suffixIcon:t.createElement(E.Z,{icon:"arrow-down-border Font14"}),onChange:function(S){return e.updateState({enabled:S})}}),t.createElement(G.default,{className:"w180 mdAntSelect mLeft15",defaultValue:f,options:Dt,suffixIcon:t.createElement(E.Z,{icon:"arrow-down-border Font14"}),onChange:function(S){return e.updateState({processListType:S})}}),t.createElement("div",{className:"flex"}),t.createElement($e.Z,{placeholder:_l("\u6D41\u7A0B\u540D\u79F0 / \u521B\u5EFA\u4EBA"),handleChange:function(S){return e.updateState({keyWords:S.trim()})}})),t.createElement("div",{className:"flexRow manageList manageListHeader bold mTop16"},t.createElement("div",{className:"flex mLeft10"},_l("\u6D41\u7A0B\u540D\u79F0")),t.createElement("div",{className:"columnWidth flexRow"},t.createElement("div",{className:"pointer ThemeHoverColor3 pRight12",style:{zIndex:1},onClick:function(){return e.updateState({isAsc:d==="count"?!I:!1,sortId:"count"})}},_l("\u672C\u6708\u6267\u884C\u6570")),t.createElement("div",{className:"flexColumn manageListOrder"},t.createElement(E.Z,{icon:"arrow-up",className:b()({ThemeColor3:I&&d==="count"})}),t.createElement(E.Z,{icon:"arrow-down",className:b()({ThemeColor3:!I&&d==="count"})}))),t.createElement("div",{className:"columnWidth"},_l("\u72B6\u6001")),t.createElement("div",{className:"columnWidth"},_l("\u7C7B\u578B")),t.createElement("div",{className:"columnWidth flexRow"},t.createElement("div",{className:"pointer ThemeHoverColor3 pRight12",style:{zIndex:1},onClick:function(){return e.updateState({isAsc:d==="createdDate"?!I:!1,sortId:"createdDate"})}},_l("\u521B\u5EFA\u65F6\u95F4")),t.createElement("div",{className:"flexColumn manageListOrder"},t.createElement(E.Z,{icon:"arrow-up",className:b()({ThemeColor3:I&&d==="createdDate"})}),t.createElement(E.Z,{icon:"arrow-down",className:b()({ThemeColor3:!I&&d==="createdDate"})}))),t.createElement("div",{className:"columnWidth"},_l("\u521B\u5EFA\u4EBA")),t.createElement("div",{className:"w20 mRight20"})),l&&r===1&&t.createElement(U.Z,{className:"mTop15"}),t.createElement("div",{className:"flex flexColumn mTop16"},this.renderList()),t.createElement(De.Z,{total:p,pageIndex:r,pageSize:50,onChange:function(S){return e.setState({pageIndex:S},e.getList)}})):t.createElement(t.Fragment,null,t.createElement(Ct,{match:this.props.match,ref:function(S){return e.workflowMonotor=S}})),o&&t.createElement(Pe,{companyId:a.projectId,api:ve.Z.getAllSMSTemplateList,deleteSMSTemplate:ve.Z.deleteSMSTemplate,closeLayer:function(){return e.setState({msgVisible:!1})}}),t.createElement(q.Z,{visible:x,className:"publishErrorDialog",buttonType:C?"danger":"primary",title:C?_l("\u786E\u8BA4\u5173\u95ED\u81EA\u52A8\u8BA2\u8D2D\uFF1F"):_l("\u662F\u5426\u5F00\u542F\u81EA\u52A8\u8BA2\u8D2D\uFF1F"),description:C?"":t.createElement("span",{dangerouslySetInnerHTML:{__html:_l("\u5F00\u542F\u540E\uFF0C\u5F53\u6708\u5269\u4F59\u6267\u884C\u989D\u5EA6\u4E3A2%\u65F6\uFF0C\u81EA\u52A8\u8D2D\u4E70 %0 100\u5143/1\u4E07\u6B21 %1 \u7684\u5355\u6708\u5305\uFF0C\u4ECE\u8D26\u6237\u4F59\u989D\u4E2D\u6263\u6B3E",'<span class="Bold Gray">',"</span>")}}),okText:C?_l("\u5173\u95ED"):_l("\u786E\u5B9A"),onOk:function(){return e.setAutoOrderStatus()},onCancel:function(){return e.setState({autoOrderVisible:!1})}}))}}]),i}(t.Component))||be}}]);
