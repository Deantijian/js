(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4059],{15580:(Xt,K,e)=>{"use strict";e.d(K,{OB:()=>E,zi:()=>S,bt:()=>T,MP:()=>M,FB:()=>R,GI:()=>ft,R$:()=>j,wb:()=>g,Wf:()=>o,X9:()=>b,ED:()=>D,f$:()=>C,YV:()=>X,Kd:()=>I,v2:()=>Q,Ab:()=>rn,Kz:()=>Z,Fp:()=>L,j8:()=>ts,zo:()=>Xa,LJ:()=>lo,PU:()=>Qr,RH:()=>$e,Id:()=>Ki,F3:()=>Ni,oX:()=>Dt,yA:()=>Ii,zC:()=>uo});function u(t){return t==null}function i(t){return typeof t=="number"}var a=function(t,n,v){return t<n?n:t>v?v:t};const c=a;var d=e(97582),m=e(90857);const l=m;var r;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.ALWAYS=519]="ALWAYS",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.GEQUAL=518]="GEQUAL",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.RGB32F_EXT=34837]="RGB32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",t[t.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",t[t.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",t[t.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",t[t.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",t[t.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",t[t.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",t[t.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",t[t.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",t[t.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",t[t.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",t[t.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",t[t.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",t[t.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",t[t.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",t[t.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",t[t.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",t[t.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",t[t.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",t[t.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",t[t.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",t[t.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",t[t.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",t[t.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",t[t.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",t[t.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",t[t.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",t[t.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",t[t.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",t[t.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",t[t.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",t[t.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",t[t.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",t[t.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",t[t.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",t[t.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(r||(r={}));var h;(function(t){t[t.Buffer=0]="Buffer",t[t.Texture=1]="Texture",t[t.RenderTarget=2]="RenderTarget",t[t.Sampler=3]="Sampler",t[t.Program=4]="Program",t[t.Bindings=5]="Bindings",t[t.InputLayout=6]="InputLayout",t[t.RenderPipeline=7]="RenderPipeline",t[t.ComputePipeline=8]="ComputePipeline",t[t.Readback=9]="Readback",t[t.QueryPool=10]="QueryPool",t[t.RenderBundle=11]="RenderBundle"})(h||(h={}));var g;(function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"})(g||(g={}));var A;(function(t){t[t.CCW=2305]="CCW",t[t.CW=2304]="CW"})(A||(A={}));var o;(function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(o||(o={}));var S;(function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC=768]="SRC",t[t.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",t[t.DST=774]="DST",t[t.ONE_MINUS_DST=775]="ONE_MINUS_DST",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.CONST=32769]="CONST",t[t.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(S||(S={}));var T;(function(t){t[t.ADD=32774]="ADD",t[t.SUBSTRACT=32778]="SUBSTRACT",t[t.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"})(T||(T={}));var E;(function(t){t[t.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",t[t.REPEAT=1]="REPEAT",t[t.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(E||(E={}));var b;(function(t){t[t.POINT=0]="POINT",t[t.BILINEAR=1]="BILINEAR"})(b||(b={}));var C;(function(t){t[t.NO_MIP=0]="NO_MIP",t[t.NEAREST=1]="NEAREST",t[t.LINEAR=2]="LINEAR"})(C||(C={}));var X;(function(t){t[t.POINTS=0]="POINTS",t[t.TRIANGLES=1]="TRIANGLES",t[t.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",t[t.LINES=3]="LINES",t[t.LINE_STRIP=4]="LINE_STRIP"})(X||(X={}));var R;(function(t){t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(R||(R={}));var M;(function(t){t[t.STATIC=1]="STATIC",t[t.DYNAMIC=2]="DYNAMIC"})(M||(M={}));var Z;(function(t){t[t.VERTEX=1]="VERTEX",t[t.INSTANCE=2]="INSTANCE"})(Z||(Z={}));var rt;(function(t){t.LOADED="loaded"})(rt||(rt={}));var N;(function(t){t[t.TEXTURE_2D=0]="TEXTURE_2D",t[t.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",t[t.TEXTURE_3D=2]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(N||(N={}));var Q;(function(t){t[t.SAMPLED=1]="SAMPLED",t[t.RENDER_TARGET=2]="RENDER_TARGET",t[t.STORAGE=4]="STORAGE"})(Q||(Q={}));var ft;(function(t){t[t.NONE=0]="NONE",t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t[t.RGB=7]="RGB",t[t.ALL=15]="ALL"})(ft||(ft={}));var I;(function(t){t[t.KEEP=7680]="KEEP",t[t.ZERO=0]="ZERO",t[t.REPLACE=7681]="REPLACE",t[t.INVERT=5386]="INVERT",t[t.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",t[t.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",t[t.INCREMENT_WRAP=34055]="INCREMENT_WRAP",t[t.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(I||(I={}));function G(t,n,v,x){var $=N.TEXTURE_2D,z=1,et=Q.SAMPLED;return{dimension:$,format:t,width:n,height:v,depthOrArrayLayers:z,mipLevelCount:x,usage:et}}var ut;(function(t){t[t.Float=0]="Float",t[t.UnfilterableFloat=1]="UnfilterableFloat",t[t.Uint=2]="Uint",t[t.Sint=3]="Sint",t[t.Depth=4]="Depth"})(ut||(ut={}));var L;(function(t){t[t.LOWER_LEFT=0]="LOWER_LEFT",t[t.UPPER_LEFT=1]="UPPER_LEFT"})(L||(L={}));var j;(function(t){t[t.NEGATIVE_ONE=0]="NEGATIVE_ONE",t[t.ZERO=1]="ZERO"})(j||(j={}));var O;(function(t){t[t.OcclusionConservative=0]="OcclusionConservative"})(O||(O={}));var B;(function(t){t[t.U8=1]="U8",t[t.U16=2]="U16",t[t.U32=3]="U32",t[t.S8=4]="S8",t[t.S16=5]="S16",t[t.S32=6]="S32",t[t.F16=7]="F16",t[t.F32=8]="F32",t[t.BC1=65]="BC1",t[t.BC2=66]="BC2",t[t.BC3=67]="BC3",t[t.BC4_UNORM=68]="BC4_UNORM",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5_UNORM=70]="BC5_UNORM",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.U16_PACKED_5551=97]="U16_PACKED_5551",t[t.U16_PACKED_565=98]="U16_PACKED_565",t[t.D24=129]="D24",t[t.D32F=130]="D32F",t[t.D24S8=131]="D24S8",t[t.D32FS8=132]="D32FS8"})(B||(B={}));var _;(function(t){t[t.R=1]="R",t[t.RG=2]="RG",t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA",t[t.A=5]="A"})(_||(_={}));function H(t){return t}var U;(function(t){t[t.None=0]="None",t[t.Normalized=1]="Normalized",t[t.sRGB=2]="sRGB",t[t.Depth=4]="Depth",t[t.Stencil=8]="Stencil",t[t.RenderTarget=16]="RenderTarget",t[t.Luminance=32]="Luminance"})(U||(U={}));function V(t,n,v){return t<<16|n<<8|v}var D;(function(t){t[t.ALPHA=V(B.U8,_.A,U.None)]="ALPHA",t[t.U8_LUMINANCE=V(B.U8,_.A,U.Luminance)]="U8_LUMINANCE",t[t.F16_LUMINANCE=V(B.F16,_.A,U.Luminance)]="F16_LUMINANCE",t[t.F32_LUMINANCE=V(B.F32,_.A,U.Luminance)]="F32_LUMINANCE",t[t.F16_R=V(B.F16,_.R,U.None)]="F16_R",t[t.F16_RG=V(B.F16,_.RG,U.None)]="F16_RG",t[t.F16_RGB=V(B.F16,_.RGB,U.None)]="F16_RGB",t[t.F16_RGBA=V(B.F16,_.RGBA,U.None)]="F16_RGBA",t[t.F32_R=V(B.F32,_.R,U.None)]="F32_R",t[t.F32_RG=V(B.F32,_.RG,U.None)]="F32_RG",t[t.F32_RGB=V(B.F32,_.RGB,U.None)]="F32_RGB",t[t.F32_RGBA=V(B.F32,_.RGBA,U.None)]="F32_RGBA",t[t.U8_R=V(B.U8,_.R,U.None)]="U8_R",t[t.U8_R_NORM=V(B.U8,_.R,U.Normalized)]="U8_R_NORM",t[t.U8_RG=V(B.U8,_.RG,U.None)]="U8_RG",t[t.U8_RG_NORM=V(B.U8,_.RG,U.Normalized)]="U8_RG_NORM",t[t.U8_RGB=V(B.U8,_.RGB,U.None)]="U8_RGB",t[t.U8_RGB_NORM=V(B.U8,_.RGB,U.Normalized)]="U8_RGB_NORM",t[t.U8_RGB_SRGB=V(B.U8,_.RGB,U.sRGB|U.Normalized)]="U8_RGB_SRGB",t[t.U8_RGBA=V(B.U8,_.RGBA,U.None)]="U8_RGBA",t[t.U8_RGBA_NORM=V(B.U8,_.RGBA,U.Normalized)]="U8_RGBA_NORM",t[t.U8_RGBA_SRGB=V(B.U8,_.RGBA,U.sRGB|U.Normalized)]="U8_RGBA_SRGB",t[t.U16_R=V(B.U16,_.R,U.None)]="U16_R",t[t.U16_R_NORM=V(B.U16,_.R,U.Normalized)]="U16_R_NORM",t[t.U16_RG_NORM=V(B.U16,_.RG,U.Normalized)]="U16_RG_NORM",t[t.U16_RGBA_NORM=V(B.U16,_.RGBA,U.Normalized)]="U16_RGBA_NORM",t[t.U16_RGBA=V(B.U16,_.RGBA,U.None)]="U16_RGBA",t[t.U16_RGB=V(B.U16,_.RGB,U.None)]="U16_RGB",t[t.U16_RG=V(B.U16,_.RG,U.None)]="U16_RG",t[t.U32_R=V(B.U32,_.R,U.None)]="U32_R",t[t.U32_RG=V(B.U32,_.RG,U.None)]="U32_RG",t[t.U32_RGB=V(B.U32,_.RGB,U.None)]="U32_RGB",t[t.U32_RGBA=V(B.U32,_.RGBA,U.None)]="U32_RGBA",t[t.S8_R=V(B.S8,_.R,U.None)]="S8_R",t[t.S8_R_NORM=V(B.S8,_.R,U.Normalized)]="S8_R_NORM",t[t.S8_RG_NORM=V(B.S8,_.RG,U.Normalized)]="S8_RG_NORM",t[t.S8_RGB_NORM=V(B.S8,_.RGB,U.Normalized)]="S8_RGB_NORM",t[t.S8_RGBA_NORM=V(B.S8,_.RGBA,U.Normalized)]="S8_RGBA_NORM",t[t.S16_R=V(B.S16,_.R,U.None)]="S16_R",t[t.S16_RG=V(B.S16,_.RG,U.None)]="S16_RG",t[t.S16_RG_NORM=V(B.S16,_.RG,U.Normalized)]="S16_RG_NORM",t[t.S16_RGB_NORM=V(B.S16,_.RGB,U.Normalized)]="S16_RGB_NORM",t[t.S16_RGBA=V(B.S16,_.RGBA,U.None)]="S16_RGBA",t[t.S16_RGBA_NORM=V(B.S16,_.RGBA,U.Normalized)]="S16_RGBA_NORM",t[t.S32_R=V(B.S32,_.R,U.None)]="S32_R",t[t.S32_RG=V(B.S32,_.RG,U.None)]="S32_RG",t[t.S32_RGB=V(B.S32,_.RGB,U.None)]="S32_RGB",t[t.S32_RGBA=V(B.S32,_.RGBA,U.None)]="S32_RGBA",t[t.U16_RGBA_5551=V(B.U16_PACKED_5551,_.RGBA,U.Normalized)]="U16_RGBA_5551",t[t.U16_RGB_565=V(B.U16_PACKED_565,_.RGB,U.Normalized)]="U16_RGB_565",t[t.BC1=V(B.BC1,_.RGBA,U.Normalized)]="BC1",t[t.BC1_SRGB=V(B.BC1,_.RGBA,U.Normalized|U.sRGB)]="BC1_SRGB",t[t.BC2=V(B.BC2,_.RGBA,U.Normalized)]="BC2",t[t.BC2_SRGB=V(B.BC2,_.RGBA,U.Normalized|U.sRGB)]="BC2_SRGB",t[t.BC3=V(B.BC3,_.RGBA,U.Normalized)]="BC3",t[t.BC3_SRGB=V(B.BC3,_.RGBA,U.Normalized|U.sRGB)]="BC3_SRGB",t[t.BC4_UNORM=V(B.BC4_UNORM,_.R,U.Normalized)]="BC4_UNORM",t[t.BC4_SNORM=V(B.BC4_SNORM,_.R,U.Normalized)]="BC4_SNORM",t[t.BC5_UNORM=V(B.BC5_UNORM,_.RG,U.Normalized)]="BC5_UNORM",t[t.BC5_SNORM=V(B.BC5_SNORM,_.RG,U.Normalized)]="BC5_SNORM",t[t.D24=V(B.D24,_.R,U.Depth)]="D24",t[t.D24_S8=V(B.D24S8,_.RG,U.Depth|U.Stencil)]="D24_S8",t[t.D32F=V(B.D32F,_.R,U.Depth)]="D32F",t[t.D32F_S8=V(B.D32FS8,_.RG,U.Depth|U.Stencil)]="D32F_S8",t[t.U8_RGB_RT=V(B.U8,_.RGB,U.RenderTarget|U.Normalized)]="U8_RGB_RT",t[t.U8_RGBA_RT=V(B.U8,_.RGBA,U.RenderTarget|U.Normalized)]="U8_RGBA_RT",t[t.U8_RGBA_RT_SRGB=V(B.U8,_.RGBA,U.RenderTarget|U.Normalized|U.sRGB)]="U8_RGBA_RT_SRGB"})(D||(D={}));function lt(t){return t>>>8&255}function J(t){return t>>>16&255}function Rt(t){return t&255}function kt(t){switch(t){case B.F32:case B.U32:case B.S32:return 4;case B.U16:case B.S16:case B.F16:return 2;case B.U8:case B.S8:return 1;default:throw new Error("whoops")}}function ne(t){return kt(J(t))}function re(t){return lt(t)}function It(t){var n=kt(J(t)),v=lt(t);return n*v}function Nt(t,n){return t&4294967040|n}function p(t,n){return t&4294902015|n<<8}function w(t){var n=Rt(t);if(n&U.Depth)return ut.Depth;if(n&U.Normalized)return ut.Float;var v=J(t);if(v===B.F16||v===B.F32)return ut.Float;if(v===B.U8||v===B.U16||v===B.U32)return ut.Uint;if(v===B.S8||v===B.S16||v===B.S32)return ut.Sint;throw new Error("whoops")}function W(t,n){if(n===void 0&&(n=""),!t)throw new Error("Assert fail: ".concat(n))}function st(t){if(t!=null)return t;throw new Error("Missing object")}function Tt(t,n){return t.r===n.r&&t.g===n.g&&t.b===n.b&&t.a===n.a}function Gt(t,n){t.r=n.r,t.g=n.g,t.b=n.b,t.a=n.a}function ze(t){var n=t.r,v=t.g,x=t.b,$=t.a;return{r:n,g:v,b:x,a:$}}function $e(t,n,v,x){return x===void 0&&(x=1),{r:t,g:n,b:v,a:x}}var rn=$e(0,0,0,0),gn=$e(0,0,0,1),nt=$e(1,1,1,0),Ln=$e(1,1,1,1),rr=!0;function tr(t,n){n===void 0&&(n=rr),n&&(t[10]=-t[10],t[14]=-t[14])}function sr(t,n){n===void 0&&(n=rr),n&&(t[10]=-t[10],t[14]=-t[14]+1)}function Br(t,n){if(n===void 0&&(n=rr),n)switch(t){case g.LESS:return g.GREATER;case g.LEQUAL:return g.GEQUAL;case g.GEQUAL:return g.LEQUAL;case g.GREATER:return g.LESS;default:return t}else return t}function fi(t,n){return n===void 0&&(n=rr),n?1-t:t}function Yn(t,n){return n===void 0&&(n=rr),n?-t:t}function Ui(t,n,v,x){if(x===void 0&&(x=rr),v=Br(v,x),v===g.LESS)return t<n;if(v===g.LEQUAL)return t<=n;if(v===g.GREATER)return t>n;if(v===g.GEQUAL)return t>=n;throw new Error("whoops")}function Wr(t){return!!(t&&!(t&t-1))}function Zt(t,n){return t!=null?t:n}function P(t){return t===void 0?null:t}function Y(t,n,v){t.length=n,t.fill(v)}function pt(t,n){var v=n-1;return t+v&~v}function Ct(t,n){return((t+n-1)/n|0)*n}function Et(t,n,v){for(var x=0,$=t.length;x<$;){var z=x+($-x>>>1),et=v(n,t[z]);et<0?$=z:x=z+1}return x}function pe(t,n,v){var x=Et(t,n,v);t.splice(x,0,n)}function ae(t,n,v){return v?t|=n:t&=~n,t}function xe(t,n){for(var v=new Array(t),x=0;x<t;x++)v[x]=n();return v}function me(t,n){n===void 0&&(n=1);var v=t.split(`
`);return v.map(function(x,$){return"".concat(en(""+(n+$),4," "),"  ").concat(x)}).join(`
`)}function en(t,n,v){for(v===void 0&&(v="0");t.length<n;)t="".concat(v).concat(t);return t}function se(t,n){for(var v=[],x=t;x<t+n;x++)v.push(x);return v}function ye(t,n){t.blendDstFactor=n.blendDstFactor,t.blendSrcFactor=n.blendSrcFactor,t.blendMode=n.blendMode}function ke(t,n){return t===void 0&&(t={}),t.compare=n.compare,t.depthFailOp=n.depthFailOp,t.passOp=n.passOp,t.failOp=n.failOp,t.mask=n.mask,t}function Rn(t,n){return t===void 0&&(t={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),ye(t.rgbBlendState,n.rgbBlendState),ye(t.alphaBlendState,n.alphaBlendState),t.channelWriteMask=n.channelWriteMask,t}function yn(t,n){t.length!==n.length&&(t.length=n.length);for(var v=0;v<n.length;v++)t[v]=Rn(t[v],n[v])}function _n(t,n){n.attachmentsState!==void 0&&yn(t.attachmentsState,n.attachmentsState),t.blendConstant&&n.blendConstant&&Gt(t.blendConstant,n.blendConstant),t.depthCompare=Zt(n.depthCompare,t.depthCompare),t.depthWrite=Zt(n.depthWrite,t.depthWrite),t.stencilWrite=Zt(n.stencilWrite,t.stencilWrite),t.stencilFront&&n.stencilFront&&ke(t.stencilFront,n.stencilFront),t.stencilBack&&n.stencilBack&&ke(t.stencilBack,n.stencilBack),t.cullMode=Zt(n.cullMode,t.cullMode),t.frontFace=Zt(n.frontFace,t.frontFace),t.polygonOffset=Zt(n.polygonOffset,t.polygonOffset),t.polygonOffsetFactor=Zt(n.polygonOffsetFactor,t.polygonOffsetFactor),t.polygonOffsetUnits=Zt(n.polygonOffsetUnits,t.polygonOffsetUnits)}function Cn(t){var n=Object.assign({},t);return n.attachmentsState=[],yn(n.attachmentsState,t.attachmentsState),n.blendConstant=n.blendConstant&&ze(n.blendConstant),n.stencilFront=ke(void 0,t.stencilFront),n.stencilBack=ke(void 0,t.stencilBack),n}function or(t,n){n.channelWriteMask!==void 0&&(t.channelWriteMask=n.channelWriteMask),n.rgbBlendMode!==void 0&&(t.rgbBlendState.blendMode=n.rgbBlendMode),n.alphaBlendMode!==void 0&&(t.alphaBlendState.blendMode=n.alphaBlendMode),n.rgbBlendSrcFactor!==void 0&&(t.rgbBlendState.blendSrcFactor=n.rgbBlendSrcFactor),n.alphaBlendSrcFactor!==void 0&&(t.alphaBlendState.blendSrcFactor=n.alphaBlendSrcFactor),n.rgbBlendDstFactor!==void 0&&(t.rgbBlendState.blendDstFactor=n.rgbBlendDstFactor),n.alphaBlendDstFactor!==void 0&&(t.alphaBlendState.blendDstFactor=n.alphaBlendDstFactor)}var Tr={blendMode:T.ADD,blendSrcFactor:S.ONE,blendDstFactor:S.ZERO},Qn={attachmentsState:[{channelWriteMask:ft.ALL,rgbBlendState:Tr,alphaBlendState:Tr}],blendConstant:ze(rn),depthWrite:!0,depthCompare:g.LEQUAL,stencilWrite:!1,stencilFront:{compare:g.ALWAYS,passOp:I.KEEP,depthFailOp:I.KEEP,failOp:I.KEEP},stencilBack:{compare:g.ALWAYS,passOp:I.KEEP,depthFailOp:I.KEEP,failOp:I.KEEP},cullMode:o.NONE,frontFace:A.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function Sr(t,n){t===void 0&&(t=null),n===void 0&&(n=Qn);var v=Cn(n);return t!==null&&_n(v,t),v}var Lt=Sr({depthCompare:g.ALWAYS,depthWrite:!1},Qn);function Wt(t,n){return t.attachmentsState===void 0&&(t.attachmentsState=[],yn(t.attachmentsState,Qn.attachmentsState)),or(t.attachmentsState[0],n),t}var Re={texture:null,sampler:null,formatKind:ut.Float,dimension:N.TEXTURE_2D};function Ie(t,n,v){if(t.length!==n.length)return!1;for(var x=0;x<t.length;x++)if(!v(t[x],n[x]))return!1;return!0}function ar(t,n){for(var v=Array(t.length),x=0;x<t.length;x++)v[x]=n(t[x]);return v}function gr(t,n){return t.texture===n.texture&&t.binding===n.binding}function xr(t,n){return t.buffer===n.buffer&&t.size===n.size&&t.binding===n.binding&&t.offset===n.offset}function Dr(t,n){return t===null?n===null:n===null?!1:t.sampler===n.sampler&&t.texture===n.texture&&t.dimension===n.dimension&&t.formatKind===n.formatKind&&t.comparison===n.comparison}function Qr(t,n){return t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],n.samplerBindings=n.samplerBindings||[],n.uniformBufferBindings=n.uniformBufferBindings||[],n.storageBufferBindings=n.storageBufferBindings||[],n.storageTextureBindings=n.storageTextureBindings||[],!(t.samplerBindings.length!==n.samplerBindings.length||!Ie(t.samplerBindings,n.samplerBindings,Dr)||!Ie(t.uniformBufferBindings,n.uniformBufferBindings,xr)||!Ie(t.storageBufferBindings,n.storageBufferBindings,xr)||!Ie(t.storageTextureBindings,n.storageTextureBindings,gr))}function Hi(t,n){return t.blendMode==n.blendMode&&t.blendSrcFactor===n.blendSrcFactor&&t.blendDstFactor===n.blendDstFactor}function Oi(t,n){return!(!Hi(t.rgbBlendState,n.rgbBlendState)||!Hi(t.alphaBlendState,n.alphaBlendState)||t.channelWriteMask!==n.channelWriteMask)}function Ei(t,n){return t.compare==n.compare&&t.depthFailOp===n.depthFailOp&&t.failOp===n.failOp&&t.passOp===n.passOp&&t.mask===n.mask}function Ji(t,n){return!Ie(t.attachmentsState,n.attachmentsState,Oi)||t.blendConstant&&n.blendConstant&&!Tt(t.blendConstant,n.blendConstant)||t.stencilFront&&n.stencilFront&&!Ei(t.stencilFront,n.stencilFront)||t.stencilBack&&n.stencilBack&&!Ei(t.stencilBack,n.stencilBack)?!1:t.depthCompare===n.depthCompare&&t.depthWrite===n.depthWrite&&t.stencilWrite===n.stencilWrite&&t.cullMode===n.cullMode&&t.frontFace===n.frontFace&&t.polygonOffset===n.polygonOffset&&t.polygonOffsetFactor===n.polygonOffsetFactor&&t.polygonOffsetUnits===n.polygonOffsetUnits}function Gi(t,n){return t.id===n.id}function so(t,n){return t===n}function uo(t,n){return!(t.topology!==n.topology||t.inputLayout!==n.inputLayout||t.sampleCount!==n.sampleCount||t.megaStateDescriptor&&n.megaStateDescriptor&&!Ji(t.megaStateDescriptor,n.megaStateDescriptor)||!Gi(t.program,n.program)||!Ie(t.colorAttachmentFormats,n.colorAttachmentFormats,so)||t.depthStencilAttachmentFormat!==n.depthStencilAttachmentFormat)}function kr(t,n){return t.offset===n.offset&&t.shaderLocation===n.shaderLocation&&t.format===n.format&&t.divisor===n.divisor}function Zi(t,n){return u(t)?u(n):u(n)?!1:t.arrayStride===n.arrayStride&&t.stepMode===n.stepMode&&Ie(t.attributes,n.attributes,kr)}function Ni(t,n){return!(t.indexBufferFormat!==n.indexBufferFormat||!Ie(t.vertexBufferDescriptors,n.vertexBufferDescriptors,Zi)||!Gi(t.program,n.program))}function Jr(t,n){return t.addressModeU===n.addressModeU&&t.addressModeV===n.addressModeV&&t.minFilter===n.minFilter&&t.magFilter===n.magFilter&&t.mipmapFilter===n.mipmapFilter&&t.lodMinClamp===n.lodMinClamp&&t.lodMaxClamp===n.lodMaxClamp&&t.maxAnisotropy===n.maxAnisotropy&&t.compareFunction===n.compareFunction}function di(t){var n=t.sampler,v=t.texture,x=t.dimension,$=t.formatKind,z=t.comparison;return{sampler:n,texture:v,dimension:x,formatKind:$,comparison:z}}function Yi(t){var n=t.buffer,v=t.size,x=t.binding,$=t.offset;return{binding:x,buffer:n,offset:$,size:v}}function si(t){var n=t.binding,v=t.texture;return{binding:n,texture:v}}function lo(t){var n=t.samplerBindings&&ar(t.samplerBindings,di),v=t.uniformBufferBindings&&ar(t.uniformBufferBindings,Yi),x=t.storageBufferBindings&&ar(t.storageBufferBindings,Yi),$=t.storageTextureBindings&&ar(t.storageTextureBindings,si);return{samplerBindings:n,uniformBufferBindings:v,storageBufferBindings:x,storageTextureBindings:$,pipeline:t.pipeline}}function Ii(t){var n=t.inputLayout,v=t.program,x=t.topology,$=t.megaStateDescriptor&&Cn(t.megaStateDescriptor),z=t.colorAttachmentFormats.slice(),et=t.depthStencilAttachmentFormat,ht=t.sampleCount;return{inputLayout:n,megaStateDescriptor:$,program:v,topology:x,colorAttachmentFormats:z,depthStencilAttachmentFormat:et,sampleCount:ht}}function co(t){var n=t.shaderLocation,v=t.format,x=t.offset,$=t.divisor;return{shaderLocation:n,format:v,offset:x,divisor:$}}function Oo(t){if(u(t))return t;var n=t.arrayStride,v=t.stepMode,x=ar(t.attributes,co);return{arrayStride:n,stepMode:v,attributes:x}}function Ki(t){var n=ar(t.vertexBufferDescriptors,Oo),v=t.indexBufferFormat,x=t.program;return{vertexBufferDescriptors:n,indexBufferFormat:v,program:x}}var bn,hi=/([^[]*)(\[[0-9]+\])?/;function Ti(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};var n=t.match(hi);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:Number(n[2])||1,isArray:!!n[2]}}function Lr(){var t=null;return function(n,v,x){var $=t!==x;return $&&(n.uniform1i(v,x),t=x),$}}function ur(t,n,v,x){var $=null,z=null;return function(et,ht,mt){var wt=n(mt,v),zt=wt.length,Vt=!1;if($===null)$=new Float32Array(zt),z=zt,Vt=!0;else{W(z===zt,"Uniform length cannot change.");for(var de=0;de<zt;++de)if(wt[de]!==$[de]){Vt=!0;break}}return Vt&&(x(et,t,ht,wt),$.set(wt)),Vt}}function pr(t,n,v,x){t[n](v,x)}function ti(t,n,v,x){t[n](v,!1,x)}var fo={},Fi={},qi={},zi=[0];function to(t,n,v,x){n===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(zi[0]=t,t=zi);var $=t.length;if(t instanceof v)return t;var z=x[$];z||(z=new v($),x[$]=z);for(var et=0;et<$;et++)z[et]=t[et];return z}function Pr(t,n){return to(t,n,Float32Array,fo)}function br(t,n){return to(t,n,Int32Array,Fi)}function Or(t,n){return to(t,n,Uint32Array,qi)}var Bi=(bn={},bn[r.FLOAT]=ur.bind(null,"uniform1fv",Pr,1,pr),bn[r.FLOAT_VEC2]=ur.bind(null,"uniform2fv",Pr,2,pr),bn[r.FLOAT_VEC3]=ur.bind(null,"uniform3fv",Pr,3,pr),bn[r.FLOAT_VEC4]=ur.bind(null,"uniform4fv",Pr,4,pr),bn[r.INT]=ur.bind(null,"uniform1iv",br,1,pr),bn[r.INT_VEC2]=ur.bind(null,"uniform2iv",br,2,pr),bn[r.INT_VEC3]=ur.bind(null,"uniform3iv",br,3,pr),bn[r.INT_VEC4]=ur.bind(null,"uniform4iv",br,4,pr),bn[r.BOOL]=ur.bind(null,"uniform1iv",br,1,pr),bn[r.BOOL_VEC2]=ur.bind(null,"uniform2iv",br,2,pr),bn[r.BOOL_VEC3]=ur.bind(null,"uniform3iv",br,3,pr),bn[r.BOOL_VEC4]=ur.bind(null,"uniform4iv",br,4,pr),bn[r.FLOAT_MAT2]=ur.bind(null,"uniformMatrix2fv",Pr,4,ti),bn[r.FLOAT_MAT3]=ur.bind(null,"uniformMatrix3fv",Pr,9,ti),bn[r.FLOAT_MAT4]=ur.bind(null,"uniformMatrix4fv",Pr,16,ti),bn[r.UNSIGNED_INT]=ur.bind(null,"uniform1uiv",Or,1,pr),bn[r.UNSIGNED_INT_VEC2]=ur.bind(null,"uniform2uiv",Or,2,pr),bn[r.UNSIGNED_INT_VEC3]=ur.bind(null,"uniform3uiv",Or,3,pr),bn[r.UNSIGNED_INT_VEC4]=ur.bind(null,"uniform4uiv",Or,4,pr),bn[r.FLOAT_MAT2x3]=ur.bind(null,"uniformMatrix2x3fv",Pr,6,ti),bn[r.FLOAT_MAT2x4]=ur.bind(null,"uniformMatrix2x4fv",Pr,8,ti),bn[r.FLOAT_MAT3x2]=ur.bind(null,"uniformMatrix3x2fv",Pr,6,ti),bn[r.FLOAT_MAT3x4]=ur.bind(null,"uniformMatrix3x4fv",Pr,12,ti),bn[r.FLOAT_MAT4x2]=ur.bind(null,"uniformMatrix4x2fv",Pr,8,ti),bn[r.FLOAT_MAT4x3]=ur.bind(null,"uniformMatrix4x3fv",Pr,12,ti),bn[r.SAMPLER_2D]=Lr,bn[r.SAMPLER_CUBE]=Lr,bn[r.SAMPLER_3D]=Lr,bn[r.SAMPLER_2D_SHADOW]=Lr,bn[r.SAMPLER_2D_ARRAY]=Lr,bn[r.SAMPLER_2D_ARRAY_SHADOW]=Lr,bn[r.SAMPLER_CUBE_SHADOW]=Lr,bn[r.INT_SAMPLER_2D]=Lr,bn[r.INT_SAMPLER_3D]=Lr,bn[r.INT_SAMPLER_CUBE]=Lr,bn[r.INT_SAMPLER_2D_ARRAY]=Lr,bn[r.UNSIGNED_INT_SAMPLER_2D]=Lr,bn[r.UNSIGNED_INT_SAMPLER_3D]=Lr,bn[r.UNSIGNED_INT_SAMPLER_CUBE]=Lr,bn[r.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Lr,bn);function ho(t,n,v){var x=Bi[v.type];if(!x)throw new Error("Unknown GLSL uniform type ".concat(v.type));return x().bind(null,t,n)}var hn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function zn(t){return Object.prototype.toString.call(t)in hn}function jn(t,n){return"#define ".concat(t," ").concat(n)}function Xe(t){var n={};return t.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(v,x,$){var z=Number($);return n[x]=isNaN(z)?$:z,""}),n}function q(t,n){var v=[];return t.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(x,$,z){var et=Number($);return v.push({location:isNaN(et)?n[$]:et,name:z}),""}),v}function At(t){var n=[],v=[];return t.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(x,$,z){var et=[];return z.trim().replace(`\r
`,`
`).split(`
`).forEach(function(ht){var mt=__read(ht.trim().split(/\s+/),2),wt=mt[0],zt=mt[1];et.push({type:wt.trim(),name:zt.replace(";","").trim()})}),v.push({type:$.trim(),uniforms:et}),""}),t.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(x,$){return $.trim().replace(`\r
`,`
`).split(`
`).forEach(function(z){var et=z.trim().split(" "),ht=et[0]||"",mt=et[1]||"",wt=mt.indexOf("[")>-1;if(mt=mt.replace(";","").replace("[","").trim(),!ht.startsWith("#")){if(ht){var zt=v.find(function(Pe){return ht===Pe.type});if(zt)if(wt)for(var Vt=function(Pe){zt.uniforms.forEach(function(Qe){n.push("".concat(mt,"[").concat(Pe,"].").concat(Qe.name))})},de=0;de<5;de++)Vt(de);else zt.uniforms.forEach(function(Pe){n.push("".concat(mt,".").concat(Pe.name))})}mt&&n.push(mt)}}),""}),n}function Yt(t){if(t===void 0)return null;var n=/binding\s*=\s*(\d+)/.exec(t);if(n!==null){var v=parseInt(n[1],10);if(!Number.isNaN(v))return v}return null}function Mt(t){var n="",v=t;return[v,n]}function Dt(t,n,v,x,$){var z;x===void 0&&(x=null),$===void 0&&($=!0);var et=t.glslVersion==="#version 100",ht=n==="frag"&&((z=v.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||z===void 0?void 0:z.length)>1,mt=v.replace(`\r
`,`
`).split(`
`).map(function(pn){return pn.replace(/[/][/].*$/,"")}).filter(function(pn){var Je=!pn||/^\s+$/.test(pn);return!Je}),wt="";x!==null&&(wt=Object.keys(x).map(function(pn){return jn(pn,x[pn])}).join(`
`));var zt=mt.find(function(pn){return pn.startsWith("precision")})||"precision mediump float;",Vt=$?mt.filter(function(pn){return!pn.startsWith("precision")}).join(`
`):mt.join(`
`),de="";if(t.viewportOrigin===L.UPPER_LEFT&&(de+="".concat(jn("VIEWPORT_ORIGIN_TL","1"),`
`)),t.clipSpaceNearZ===j.ZERO&&(de+="".concat(jn("CLIPSPACE_NEAR_ZERO","1"),`
`)),t.explicitBindingLocations){var Pe=0,Qe=0,un=0;Vt=Vt.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(pn,Je,vn,Jn){var Rr=vn?"".concat(vn,", "):"";return"layout(".concat(Rr,"set = ").concat(Pe,", binding = ").concat(Qe++,") uniform ").concat(Jn)}),Pe++,Qe=0,W(t.separateSamplerTextures),Vt=Vt.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(pn,Je,vn,Jn,Rr){var Ir=Yt(vn);Ir===null&&(Ir=Qe++);var oi=(0,d.CR)(Mt(Jn),2),bi=oi[0],Xr=oi[1];return n==="frag"?`
layout(set = `.concat(Pe,", binding = ").concat(Ir*2+0,") uniform texture").concat(bi," T_").concat(Rr,`;
layout(set = `).concat(Pe,", binding = ").concat(Ir*2+1,") uniform sampler").concat(Xr," S_").concat(Rr,";").trim():""}),Vt=Vt.replace(n==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(pn,Je){return"layout(location = ".concat(un++,") ").concat(Je)}),de+="".concat(jn("gl_VertexID","gl_VertexIndex"),`
`),de+="".concat(jn("gl_InstanceID","gl_InstanceIndex"),`
`),zt=zt.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var fn=0;Vt=Vt.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(pn,Je,vn,Jn,Rr){var Ir=Yt(vn);return Ir===null&&(Ir=fn++),"uniform sampler".concat(Jn," ").concat(Rr,"; // BINDING=").concat(Ir)})}if(Vt=Vt.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return"SAMPLER_".concat(Je,"(P_").concat(vn,")")}),Vt=Vt.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return"PP_SAMPLER_".concat(Je,"(P_").concat(vn,")")}),Vt=Vt.replace(/\bPU_TEXTURE\((.*?)\)/g,function(pn,Je){return"TEXTURE(P_".concat(Je,")")}),t.separateSamplerTextures)Vt=Vt.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){var Jn=(0,d.CR)(Mt(Je),2),Rr=Jn[0],Ir=Jn[1];return"texture".concat(Rr," T_P_").concat(vn,", sampler").concat(Ir," S_P_").concat(vn)}),Vt=Vt.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return"T_".concat(vn,", S_").concat(vn)}),Vt=Vt.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return"sampler".concat(Je,"(T_").concat(vn,", S_").concat(vn,")")}),Vt=Vt.replace(/\bTEXTURE\((.*?)\)/g,function(pn,Je){return"T_".concat(Je)});else{var xn=[];Vt=Vt.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return"sampler".concat(Je," P_").concat(vn)}),Vt=Vt.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return vn}),Vt=Vt.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(pn,Je,vn){return xn.push([vn,Je]),vn}),et&&xn.forEach(function(pn){var Je=(0,d.CR)(pn,2),vn=Je[0],Jn=Je[1];Vt=Vt.replace(new RegExp("texture\\(".concat(vn),"g"),function(){return"texture".concat(Jn,"(").concat(vn)})}),Vt=Vt.replace(/\bTEXTURE\((.*?)\)/g,function(pn,Je){return Je})}var on="".concat(et?"":t.glslVersion,`
`).concat(et&&ht?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(et&&n==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat($?zt:"",`
`).concat(de||"").concat(wt?wt+`
`:"",`
`).concat(Vt,`
`).trim();if(t.explicitBindingLocations&&n==="frag"&&(on=on.replace(/^\b(out)\b/g,function(pn,Je){return"layout(location = 0) ".concat(Je)})),et){if(n==="frag"&&(on=on.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(pn,Je,vn){return"varying ".concat(Je," ").concat(vn,`;
`)})),n==="vert"&&(on=on.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(pn,Je,vn){return"varying ".concat(Je," ").concat(vn,`;
`)}),on=on.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(pn,Je,vn){return"attribute ".concat(Je," ").concat(vn,`;
`)})),on=on.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(pn,Je){return Je.trim().replace(/^.*$/gm,function(vn){var Jn=vn.trim();return Jn.startsWith("#")?Jn:vn?"uniform ".concat(Jn):""})}),n==="frag")if(ht){var Vn=[];on=on.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(pn,Je){return Vn.push(Je),"vec4 ".concat(Je,`;
`)});var Hn=on.lastIndexOf("}");on=on.substring(0,Hn)+`
    `.concat(Vn.map(function(pn,Je){return"gl_FragData[".concat(Je,"] = ").concat(pn,`;
    `)}).join(`
`))+on.substring(Hn)}else{var cr;if(on=on.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(pn,Je,vn){return cr=vn,"".concat(Je," ").concat(vn,`;
`)}),cr){var Hn=on.lastIndexOf("}");on=on.substring(0,Hn)+`
  gl_FragColor = vec4(`.concat(cr,`);
`)+on.substring(Hn)}}on=on.replace(/^\s*layout\((.*)\)/gm,"")}return on}function $t(t,n,v,x){x===void 0&&(x=null);var $=Dt(t,"vert",n,x),z=Dt(t,"frag",v,x);return{vert:n,frag:v,preprocessedVert:$,preprocessedFrag:z}}var te=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=t.call(this)||this;return z.id=x,z.device=$,z.device.resourceCreationTracker!==null&&z.device.resourceCreationTracker.trackResourceCreated(z),z}return n.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},n}(l),Qt=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.Bindings;var ht=z.uniformBufferBindings,mt=z.samplerBindings;return et.uniformBufferBindings=ht||[],et.samplerBindings=mt||[],et.bindingLayouts=et.createBindingLayouts(),et}return n.prototype.createBindingLayouts=function(){var v=0,x=0,$=[],z=this.uniformBufferBindings.length,et=this.samplerBindings.length;return $.push({firstUniformBuffer:v,numUniformBuffers:z,firstSampler:x,numSamplers:et}),v+=z,x+=et,{numUniformBuffers:v,numSamplers:x,bindingLayoutTables:$}},n}(te),ve;function le(t){return ve!==void 0?ve:typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?(ve=!0,!0):(ve=!!(t&&t._version===2),ve)}function Ke(t){var n=J(t);switch(n){case B.BC1:case B.BC2:case B.BC3:case B.BC4_UNORM:case B.BC4_SNORM:case B.BC5_UNORM:case B.BC5_SNORM:return!0;default:return!1}}function ln(t){var n=Rt(t);if(n&U.Normalized)return!1;var v=J(t);return v===B.S8||v===B.S16||v===B.S32||v===B.U8||v===B.U16||v===B.U32}function an(t){switch(t){case M.STATIC:return r.STATIC_DRAW;case M.DYNAMIC:return r.DYNAMIC_DRAW}}function Tn(t){if(t&R.INDEX)return r.ELEMENT_ARRAY_BUFFER;if(t&R.VERTEX)return r.ARRAY_BUFFER;if(t&R.UNIFORM)return r.UNIFORM_BUFFER}function Nr(t){switch(t){case X.TRIANGLES:return r.TRIANGLES;case X.POINTS:return r.POINTS;case X.TRIANGLE_STRIP:return r.TRIANGLE_STRIP;case X.LINES:return r.LINES;case X.LINE_STRIP:return r.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function yr(t){switch(t){case B.U8:return r.UNSIGNED_BYTE;case B.U16:return r.UNSIGNED_SHORT;case B.U32:return r.UNSIGNED_INT;case B.S8:return r.BYTE;case B.S16:return r.SHORT;case B.S32:return r.INT;case B.F16:return r.HALF_FLOAT;case B.F32:return r.FLOAT;default:throw new Error("whoops")}}function Mr(t){switch(t){case _.R:return 1;case _.RG:return 2;case _.RGB:return 3;case _.RGBA:return 4;default:return 1}}function Li(t){var n=J(t),v=lt(t),x=Rt(t),$=yr(n),z=Mr(v),et=!!(x&U.Normalized);return{size:z,type:$,normalized:et}}function ei(t){switch(t){case D.U8_R:return r.UNSIGNED_BYTE;case D.U16_R:return r.UNSIGNED_SHORT;case D.U32_R:return r.UNSIGNED_INT;default:throw new Error("whoops")}}function pi(t){switch(t){case E.CLAMP_TO_EDGE:return r.CLAMP_TO_EDGE;case E.REPEAT:return r.REPEAT;case E.MIRRORED_REPEAT:return r.MIRRORED_REPEAT;default:throw new Error("whoops")}}function wr(t,n){if(n===C.LINEAR&&t===b.BILINEAR)return r.LINEAR_MIPMAP_LINEAR;if(n===C.LINEAR&&t===b.POINT)return r.NEAREST_MIPMAP_LINEAR;if(n===C.NEAREST&&t===b.BILINEAR)return r.LINEAR_MIPMAP_NEAREST;if(n===C.NEAREST&&t===b.POINT)return r.NEAREST_MIPMAP_NEAREST;if(n===C.NO_MIP&&t===b.BILINEAR)return r.LINEAR;if(n===C.NO_MIP&&t===b.POINT)return r.NEAREST;throw new Error("Unknown texture filter mode")}function Si(t,n){n===void 0&&(n=0);var v=t;return v.gl_buffer_pages[n/v.pageByteSize|0]}function Mi(t){var n=t;return n.gl_texture}function Pn(t){var n=t;return n.gl_sampler}function Kr(t,n){t.name=n,t.__SPECTOR_Metadata={name:n}}function ni(t,n){for(var v=[];;){var x=n.exec(t);if(!x)break;v.push(x)}return v}function Fr(t){return t.blendMode==T.ADD&&t.blendSrcFactor==S.ONE&&t.blendDstFactor===S.ZERO}function xi(t){switch(t){case O.OcclusionConservative:return r.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function ui(t){if(t===N.TEXTURE_2D)return r.TEXTURE_2D;if(t===N.TEXTURE_2D_ARRAY)return r.TEXTURE_2D_ARRAY;if(t===N.TEXTURE_CUBE_MAP)return r.TEXTURE_CUBE_MAP;if(t===N.TEXTURE_3D)return r.TEXTURE_3D;throw new Error("whoops")}function ri(t,n,v,x){return!(t%v!==0||n%x!==0)}var Ka=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.Buffer;var ht=z.viewOrSize,mt=z.usage,wt=z.hint,zt=wt===void 0?M.STATIC:wt,Vt=$.uniformBufferMaxPageByteSize,de=$.gl,Pe=mt&R.UNIFORM;Pe||(le(de)?de.bindVertexArray(null):$.OES_vertex_array_object.bindVertexArrayOES(null));var Qe=i(ht)?pt(ht,4):pt(ht.byteLength,4);et.gl_buffer_pages=[];var un;if(Pe){for(var fn=Qe;fn>0;)et.gl_buffer_pages.push(et.createBufferPage(Math.min(fn,Vt),mt,zt)),fn-=Vt;un=Vt}else et.gl_buffer_pages.push(et.createBufferPage(Qe,mt,zt)),un=Qe;return et.pageByteSize=un,et.byteSize=Qe,et.usage=mt,et.gl_target=Tn(mt),i(ht)||et.setSubData(0,new Uint8Array(ht.buffer)),Pe||(le(de)?de.bindVertexArray(et.device.currentBoundVAO):$.OES_vertex_array_object.bindVertexArrayOES(et.device.currentBoundVAO)),et}return n.prototype.setSubData=function(v,x,$,z){$===void 0&&($=0),z===void 0&&(z=x.byteLength-$);for(var et=this.device.gl,ht=this.pageByteSize,mt=v+z,wt=v,zt=v%ht;wt<mt;){var Vt=le(et)?et.COPY_WRITE_BUFFER:this.gl_target,de=Si(this,wt);if(de.ubo)return;et.bindBuffer(Vt,de),le(et)?et.bufferSubData(Vt,zt,x,$,Math.min(mt-wt,ht)):et.bufferSubData(Vt,zt,x),wt+=ht,zt=0,$+=ht,this.device.debugGroupStatisticsBufferUpload()}},n.prototype.destroy=function(){t.prototype.destroy.call(this);for(var v=0;v<this.gl_buffer_pages.length;v++)this.gl_buffer_pages[v].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[v]);this.gl_buffer_pages=[]},n.prototype.createBufferPage=function(v,x,$){var z=this.device.gl,et=x&R.UNIFORM;if(!le(z)&&et)return{ubo:!0};var ht=this.device.ensureResourceExists(z.createBuffer()),mt=Tn(x),wt=an($);return z.bindBuffer(mt,ht),z.bufferData(mt,v,wt),ht},n}(te),po=function(t){(0,d.ZT)(n,t);function n(v){var x,$,z,et,ht=v.id,mt=v.device,wt=v.descriptor,zt,Vt=t.call(this,{id:ht,device:mt})||this;Vt.type=h.InputLayout;var de=wt.vertexBufferDescriptors,Pe=wt.indexBufferFormat,Qe=wt.program;W(Pe===D.U16_R||Pe===D.U32_R||Pe===null);var un=Pe!==null?ei(Pe):null,fn=Pe!==null?ne(Pe):null,xn=Vt.device.gl,on=Vt.device.ensureResourceExists(le(xn)?xn.createVertexArray():mt.OES_vertex_array_object.createVertexArrayOES());le(xn)?xn.bindVertexArray(on):mt.OES_vertex_array_object.bindVertexArrayOES(on),xn.bindBuffer(xn.ARRAY_BUFFER,Si(Vt.device.fallbackVertexBuffer));try{for(var Vn=(0,d.XA)(wt.vertexBufferDescriptors),Hn=Vn.next();!Hn.done;Hn=Vn.next()){var cr=Hn.value,pn=cr.stepMode,Je=cr.attributes;try{for(var vn=(z=void 0,(0,d.XA)(Je)),Jn=vn.next();!Jn.done;Jn=vn.next()){var Rr=Jn.value,Ir=Rr.shaderLocation,oi=Rr.format,bi=Rr.divisor,Xr=bi===void 0?1:bi,_i=le(xn)?Ir:(zt=Qe.attributes[Ir])===null||zt===void 0?void 0:zt.location,io=Li(oi);if(Rr.vertexFormat=io,!u(_i)){ln(oi);var Di=io.size,qo=io.type,oo=io.normalized;xn.vertexAttribPointer(_i,Di,qo,oo,0,0),pn===Z.INSTANCE&&(le(xn)?xn.vertexAttribDivisor(_i,Xr):mt.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(_i,Xr)),xn.enableVertexAttribArray(_i)}}}catch(Ro){z={error:Ro}}finally{try{Jn&&!Jn.done&&(et=vn.return)&&et.call(vn)}finally{if(z)throw z.error}}}}catch(Ro){x={error:Ro}}finally{try{Hn&&!Hn.done&&($=Vn.return)&&$.call(Vn)}finally{if(x)throw x.error}}return le(xn)?xn.bindVertexArray(null):mt.OES_vertex_array_object.bindVertexArrayOES(null),Vt.vertexBufferDescriptors=de,Vt.vao=on,Vt.indexBufferFormat=Pe,Vt.indexBufferType=un,Vt.indexBufferCompByteSize=fn,Vt.program=Qe,Vt}return n.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(le(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},n}(te),Vo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=v.fake,ht=t.call(this,{id:x,device:$})||this;ht.type=h.Texture,z=(0,d.pi)({dimension:N.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},z);var mt=ht.device.gl,wt,zt,Vt=ht.clampmipLevelCount(z);if(ht.immutable=z.usage===Q.RENDER_TARGET,ht.pixelStore=z.pixelStore,ht.format=z.format,ht.dimension=z.dimension,ht.formatKind=w(z.format),ht.width=z.width,ht.height=z.height,ht.depthOrArrayLayers=z.depthOrArrayLayers,ht.mipmaps=Vt>=1,!et){zt=ht.device.ensureResourceExists(mt.createTexture());var de=ht.device.translateTextureType(z.format),Pe=ht.device.translateTextureInternalFormat(z.format);if(ht.device.setActiveTexture(mt.TEXTURE0),ht.device.currentTextures[0]=null,ht.preprocessImage(),z.dimension===N.TEXTURE_2D){if(wt=r.TEXTURE_2D,mt.bindTexture(wt,zt),ht.immutable)if(le(mt))mt.texStorage2D(wt,Vt,Pe,z.width,z.height);else{var Qe=(Pe===r.DEPTH_COMPONENT||ht.isNPOT(),0);(ht.format===D.D32F||ht.format===D.D24_S8)&&!le(mt)&&!$.WEBGL_depth_texture||(mt.texImage2D(wt,Qe,Pe,z.width,z.height,0,Pe,de,null),ht.mipmaps&&(ht.mipmaps=!1,mt.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),mt.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),mt.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)))}W(z.depthOrArrayLayers===1)}else if(z.dimension===N.TEXTURE_2D_ARRAY)wt=r.TEXTURE_2D_ARRAY,mt.bindTexture(wt,zt),ht.immutable&&le(mt)&&mt.texStorage3D(wt,Vt,Pe,z.width,z.height,z.depthOrArrayLayers);else if(z.dimension===N.TEXTURE_3D)wt=r.TEXTURE_3D,mt.bindTexture(wt,zt),ht.immutable&&le(mt)&&mt.texStorage3D(wt,Vt,Pe,z.width,z.height,z.depthOrArrayLayers);else if(z.dimension===N.TEXTURE_CUBE_MAP)wt=r.TEXTURE_CUBE_MAP,mt.bindTexture(wt,zt),ht.immutable&&le(mt)&&mt.texStorage2D(wt,Vt,Pe,z.width,z.height),W(z.depthOrArrayLayers===6);else throw new Error("whoops")}return ht.gl_texture=zt,ht.gl_target=wt,ht.mipLevelCount=Vt,ht}return n.prototype.setImageData=function(v,x){x===void 0&&(x=0);var $=this.device.gl;Ke(this.format);var z=this.gl_target===r.TEXTURE_3D||this.gl_target===r.TEXTURE_2D_ARRAY,et=this.gl_target===r.TEXTURE_CUBE_MAP,ht=zn(v[0]);this.device.setActiveTexture($.TEXTURE0),this.device.currentTextures[0]=null;var mt=v[0],wt,zt;ht?(wt=this.width,zt=this.height):(wt=mt.width,zt=mt.height,this.width=wt,this.height=zt),$.bindTexture(this.gl_target,this.gl_texture);var Vt=this.device.translateTextureFormat(this.format),de=le($)?this.device.translateInternalTextureFormat(this.format):Vt,Pe=this.device.translateTextureType(this.format);this.preprocessImage();for(var Qe=0;Qe<this.depthOrArrayLayers;Qe++){var un=v[Qe],fn=this.gl_target;et&&(fn=r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe%6),this.immutable?$.texSubImage2D(fn,x,0,0,wt,zt,Vt,Pe,un):le($)?z?$.texImage3D(fn,x,de,wt,zt,this.depthOrArrayLayers,0,Vt,Pe,un):$.texImage2D(fn,x,de,wt,zt,0,Vt,Pe,un):ht?$.texImage2D(fn,x,Vt,wt,zt,0,Vt,Pe,un):$.texImage2D(fn,x,Vt,Vt,Pe,un)}this.mipmaps&&this.generateMipmap(z)},n.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteTexture(Mi(this))},n.prototype.clampmipLevelCount=function(v){if(v.dimension===N.TEXTURE_2D_ARRAY&&v.depthOrArrayLayers>1){var x=J(v.format);if(x===B.BC1)for(var $=v.width,z=v.height,et=0;et<v.mipLevelCount;et++){if($<=2||z<=2)return et-1;$=Math.max($/2|0,1),z=Math.max(z/2|0,1)}}return v.mipLevelCount},n.prototype.preprocessImage=function(){var v=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&v.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&v.pixelStorei(r.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&v.pixelStorei(r.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},n.prototype.generateMipmap=function(v){v===void 0&&(v=!1);var x=this.device.gl;return!le(x)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(x.bindTexture(this.gl_target,this.gl_texture),v?(x.texParameteri(this.gl_target,r.TEXTURE_BASE_LEVEL,0),x.texParameteri(this.gl_target,r.TEXTURE_MAX_LEVEL,Math.log2(this.width)),x.texParameteri(this.gl_target,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),x.texParameteri(this.gl_target,r.TEXTURE_MAG_FILTER,r.LINEAR)):x.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),x.generateMipmap(this.gl_target),x.bindTexture(this.gl_target,null)),this)},n.prototype.isNPOT=function(){var v=this.device.gl;return le(v)?!1:!Wr(this.width)||!Wr(this.height)},n}(te),ba=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.RenderTarget,et.gl_renderbuffer=null,et.texture=null;var ht=et.device.gl,mt=z.format,wt=z.width,zt=z.height,Vt=z.sampleCount,de=Vt===void 0?1:Vt,Pe=z.texture,Qe=!1;if((mt===D.D32F||mt===D.D24_S8)&&Pe&&!le(ht)&&!$.WEBGL_depth_texture&&(Pe.destroy(),et.texture=null,Qe=!0),!Qe&&Pe)et.texture=Pe;else{et.gl_renderbuffer=et.device.ensureResourceExists(ht.createRenderbuffer()),ht.bindRenderbuffer(ht.RENDERBUFFER,et.gl_renderbuffer);var un=et.device.translateTextureInternalFormat(mt,!0);le(ht)&&de>1?ht.renderbufferStorageMultisample(r.RENDERBUFFER,de,un,wt,zt):ht.renderbufferStorage(r.RENDERBUFFER,un,wt,zt)}return et.format=mt,et.width=wt,et.height=zt,et.sampleCount=de,et}return n.prototype.destroy=function(){t.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},n}(te),Ur;(function(t){t[t.NeedsCompile=0]="NeedsCompile",t[t.Compiling=1]="Compiling",t[t.NeedsBind=2]="NeedsBind",t[t.ReadyToUse=3]="ReadyToUse"})(Ur||(Ur={}));var Oa=function(t){(0,d.ZT)(n,t);function n(v,x){var $=v.id,z=v.device,et=v.descriptor,ht=t.call(this,{id:$,device:z})||this;ht.rawVertexGLSL=x,ht.type=h.Program,ht.uniformSetters={},ht.attributes=[];var mt=ht.device.gl;return ht.descriptor=et,ht.gl_program=ht.device.ensureResourceExists(mt.createProgram()),ht.gl_shader_vert=null,ht.gl_shader_frag=null,ht.compileState=Ur.NeedsCompile,ht.tryCompileProgram(),ht}return n.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},n.prototype.tryCompileProgram=function(){W(this.compileState===Ur.NeedsCompile);var v=this.descriptor,x=v.vertex,$=v.fragment,z=this.device.gl;x!=null&&x.glsl&&($!=null&&$.glsl)&&(this.gl_shader_vert=this.compileShader(x.postprocess?x.postprocess(x.glsl):x.glsl,z.VERTEX_SHADER),this.gl_shader_frag=this.compileShader($.postprocess?$.postprocess($.glsl):$.glsl,z.FRAGMENT_SHADER),z.attachShader(this.gl_program,this.gl_shader_vert),z.attachShader(this.gl_program,this.gl_shader_frag),z.linkProgram(this.gl_program),this.compileState=Ur.Compiling,le(z)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},n.prototype.readAttributesFromLinkedProgram=function(){for(var v,x=this.device.gl,$=x.getProgramParameter(this.gl_program,x.ACTIVE_ATTRIBUTES),z=Xe(this.descriptor.vertex.glsl),et=q(this.rawVertexGLSL,z),ht=function(zt){var Vt=x.getActiveAttrib(mt.gl_program,zt),de=Vt.name,Pe=Vt.type,Qe=Vt.size,un=x.getAttribLocation(mt.gl_program,de),fn=(v=et.find(function(xn){return xn.name===de}))===null||v===void 0?void 0:v.location;un>=0&&!u(fn)&&(mt.attributes[fn]={name:de,location:un,type:Pe,size:Qe})},mt=this,wt=0;wt<$;wt++)ht(wt)},n.prototype.readUniformLocationsFromLinkedProgram=function(){for(var v=this.device.gl,x=v.getProgramParameter(this.gl_program,v.ACTIVE_UNIFORMS),$=0;$<x;$++){var z=v.getActiveUniform(this.gl_program,$),et=Ti(z.name).name,ht=v.getUniformLocation(this.gl_program,et);if(this.uniformSetters[et]=ho(v,ht,z),z&&z.size>1)for(var mt=0;mt<z.size;mt++)ht=v.getUniformLocation(this.gl_program,"".concat(et,"[").concat(mt,"]")),this.uniformSetters["".concat(et,"[").concat(mt,"]")]=ho(v,ht,z)}},n.prototype.compileShader=function(v,x){var $=this.device.gl,z=this.device.ensureResourceExists($.createShader(x));return $.shaderSource(z,v),$.compileShader(z),z},n.prototype.setUniformsLegacy=function(v){v===void 0&&(v={});var x=this.device.gl;if(!le(x)){var $=!1;for(var z in v){$||(x.useProgram(this.gl_program),$=!0);var et=v[z],ht=this.uniformSetters[z];if(ht){var mt=et;mt instanceof Vo&&(mt=mt.textureIndex),ht(mt)}}}return this},n}(te),vo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.QueryPool;var ht=et.device.gl;if(le(ht)){var mt=z.elemCount,wt=z.type;et.gl_query=xe(mt,function(){return et.device.ensureResourceExists(ht.createQuery())}),et.gl_query_type=xi(wt)}return et}return n.prototype.queryResultOcclusion=function(v){var x=this.device.gl;if(le(x)){var $=this.gl_query[v];return x.getQueryParameter($,x.QUERY_RESULT_AVAILABLE)?!!x.getQueryParameter($,x.QUERY_RESULT):null}return null},n.prototype.destroy=function(){t.prototype.destroy.call(this);var v=this.device.gl;if(le(v))for(var x=0;x<this.gl_query.length;x++)v.deleteQuery(this.gl_query[x])},n}(te),Na=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=t.call(this,{id:x,device:$})||this;return z.type=h.Readback,z.gl_pbo=null,z.gl_sync=null,z}return n.prototype.clientWaitAsync=function(v,x,$){x===void 0&&(x=0),$===void 0&&($=10);var z=this.device.gl;return new Promise(function(et,ht){function mt(){var wt=z.clientWaitSync(v,x,0);if(wt==z.WAIT_FAILED){ht();return}if(wt==z.TIMEOUT_EXPIRED){setTimeout(mt,c($,0,z.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}et()}mt()})},n.prototype.getBufferSubDataAsync=function(v,x,$,z,et,ht){return(0,d.mG)(this,void 0,void 0,function(){var mt;return(0,d.Jh)(this,function(wt){switch(wt.label){case 0:return mt=this.device.gl,le(mt)?(this.gl_sync=mt.fenceSync(mt.SYNC_GPU_COMMANDS_COMPLETE,0),mt.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return wt.sent(),mt.bindBuffer(v,x),mt.getBufferSubData(v,$,z,et,ht),mt.bindBuffer(v,null),[2,z];case 2:return[2]}})})},n.prototype.readTexture=function(v,x,$,z,et,ht,mt,wt){return mt===void 0&&(mt=0),wt===void 0&&(wt=ht.byteLength||0),(0,d.mG)(this,void 0,void 0,function(){var zt,Vt,de,Pe,Qe;return(0,d.Jh)(this,function(un){return zt=this.device.gl,Vt=v,de=this.device.translateTextureFormat(Vt.format),Pe=this.device.translateTextureType(Vt.format),Qe=It(Vt.format),le(zt)?(this.gl_pbo=this.device.ensureResourceExists(zt.createBuffer()),zt.bindBuffer(zt.PIXEL_PACK_BUFFER,this.gl_pbo),zt.bufferData(zt.PIXEL_PACK_BUFFER,wt,zt.STREAM_READ),zt.bindBuffer(zt.PIXEL_PACK_BUFFER,null),zt.bindFramebuffer(r.READ_FRAMEBUFFER,this.device.readbackFramebuffer),zt.framebufferTexture2D(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Vt.gl_texture,0),zt.bindBuffer(zt.PIXEL_PACK_BUFFER,this.gl_pbo),zt.readPixels(x,$,z,et,de,Pe,mt*Qe),zt.bindBuffer(zt.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(zt.PIXEL_PACK_BUFFER,this.gl_pbo,0,ht,mt,0)]):[2,this.readTextureSync(v,x,$,z,et,ht,mt,wt)]})})},n.prototype.readTextureSync=function(v,x,$,z,et,ht,mt,wt){wt===void 0&&(wt=ht.byteLength||0);var zt=this.device.gl,Vt=v,de=this.device.translateTextureType(Vt.format);return zt.bindFramebuffer(r.FRAMEBUFFER,this.device.readbackFramebuffer),zt.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Vt.gl_texture,0),zt.pixelStorei(zt.PACK_ALIGNMENT,4),zt.readPixels(x,$,z,et,zt.RGBA,de,ht),ht},n.prototype.readBuffer=function(v,x,$,z,et){return(0,d.mG)(this,void 0,void 0,function(){var ht;return(0,d.Jh)(this,function(mt){return ht=this.device.gl,le(ht)?[2,this.getBufferSubDataAsync(ht.ARRAY_BUFFER,Si(v,x),x,$,z,et)]:[2,Promise.reject()]})})},n.prototype.destroy=function(){t.prototype.destroy.call(this),le(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},n}(te),mo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et,ht,mt=t.call(this,{id:x,device:$})||this;return mt.type=h.RenderPipeline,mt.drawMode=Nr((et=z.topology)!==null&&et!==void 0?et:X.TRIANGLES),mt.program=z.program,mt.inputLayout=z.inputLayout,mt.megaState=(0,d.pi)((0,d.pi)({},Cn(Qn)),z.megaStateDescriptor),mt.colorAttachmentFormats=z.colorAttachmentFormats.slice(),mt.depthStencilAttachmentFormat=z.depthStencilAttachmentFormat,mt.sampleCount=(ht=z.sampleCount)!==null&&ht!==void 0?ht:1,mt}return n}(te),la=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;return et.type=h.ComputePipeline,et.descriptor=z,et}return n}(te),eo=function(){function t(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return t.prototype.trackResourceCreated=function(n){this.creationStacks.set(n,new Error().stack),this.liveObjects.add(n)},t.prototype.trackResourceDestroyed=function(n){this.deletionStacks.has(n)&&console.warn("Object double freed:",n,`

Creation stack: `,this.creationStacks.get(n),`

Deletion stack: `,this.deletionStacks.get(n),`

This stack: `,new Error().stack),this.deletionStacks.set(n,new Error().stack),this.liveObjects.delete(n)},t.prototype.checkForLeaks=function(){var n,v;try{for(var x=(0,d.XA)(this.liveObjects.values()),$=x.next();!$.done;$=x.next()){var z=$.value;console.warn("Object leaked:",z,"Creation stack:",this.creationStacks.get(z))}}catch(et){n={error:et}}finally{try{$&&!$.done&&(v=x.return)&&v.call(x)}finally{if(n)throw n.error}}},t.prototype.setResourceLeakCheck=function(n,v){v?this.liveObjects.add(n):this.liveObjects.delete(n)},t}(),ca=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et,ht,mt=t.call(this,{id:x,device:$})||this;mt.type=h.Sampler;var wt=mt.device.gl;if(le(wt)){var zt=mt.device.ensureResourceExists(wt.createSampler());wt.samplerParameteri(zt,r.TEXTURE_WRAP_S,pi(z.addressModeU)),wt.samplerParameteri(zt,r.TEXTURE_WRAP_T,pi(z.addressModeV)),wt.samplerParameteri(zt,r.TEXTURE_WRAP_R,pi((et=z.addressModeW)!==null&&et!==void 0?et:z.addressModeU)),wt.samplerParameteri(zt,r.TEXTURE_MIN_FILTER,wr(z.minFilter,z.mipmapFilter)),wt.samplerParameteri(zt,r.TEXTURE_MAG_FILTER,wr(z.magFilter,C.NO_MIP)),z.lodMinClamp!==void 0&&wt.samplerParameterf(zt,r.TEXTURE_MIN_LOD,z.lodMinClamp),z.lodMaxClamp!==void 0&&wt.samplerParameterf(zt,r.TEXTURE_MAX_LOD,z.lodMaxClamp),z.compareFunction!==void 0&&(wt.samplerParameteri(zt,wt.TEXTURE_COMPARE_MODE,wt.COMPARE_REF_TO_TEXTURE),wt.samplerParameteri(zt,wt.TEXTURE_COMPARE_FUNC,z.compareFunction));var Vt=(ht=z.maxAnisotropy)!==null&&ht!==void 0?ht:1;Vt>1&&mt.device.EXT_texture_filter_anisotropic!==null&&(W(z.minFilter===b.BILINEAR&&z.magFilter===b.BILINEAR&&z.mipmapFilter===C.LINEAR),wt.samplerParameterf(zt,mt.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Vt)),mt.gl_sampler=zt}else mt.descriptor=z;return mt}return n.prototype.setTextureParameters=function(v,x,$){var z,et=this.device.gl,ht=this.descriptor;this.isNPOT(x,$)?et.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR):et.texParameteri(v,r.TEXTURE_MIN_FILTER,wr(ht.minFilter,ht.mipmapFilter)),et.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,pi(ht.addressModeU)),et.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,pi(ht.addressModeV)),et.texParameteri(v,r.TEXTURE_MAG_FILTER,wr(ht.magFilter,C.NO_MIP));var mt=(z=ht.maxAnisotropy)!==null&&z!==void 0?z:1;mt>1&&this.device.EXT_texture_filter_anisotropic!==null&&(W(ht.minFilter===b.BILINEAR&&ht.magFilter===b.BILINEAR&&ht.mipmapFilter===C.LINEAR),et.texParameteri(v,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,mt))},n.prototype.destroy=function(){t.prototype.destroy.call(this),le(this.device.gl)&&this.device.gl.deleteSampler(Pn(this))},n.prototype.isNPOT=function(v,x){return!Wr(v)||!Wr(x)},n}(te),Ia=function(){function t(){}return t.prototype.dispatchWorkgroups=function(n,v,x){},t.prototype.dispatchWorkgroupsIndirect=function(n,v){},t.prototype.setPipeline=function(n){},t.prototype.setBindings=function(n){},t.prototype.pushDebugGroup=function(n){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(n){},t}(),fa=function(t){(0,d.ZT)(n,t);function n(){var v=t!==null&&t.apply(this,arguments)||this;return v.type=h.RenderBundle,v.commands=[],v}return n.prototype.push=function(v){this.commands.push(v)},n.prototype.replay=function(){this.commands.forEach(function(v){return v()})},n}(te),da=65536,Fa=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,qa=function(){function t(n,v){v===void 0&&(v={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Cn(Qn),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=L.LOWER_LEFT,this.clipSpaceNearZ=j.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=n,this.contextAttributes=st(n.getContextAttributes()),le(n)?(this.EXT_texture_norm16=n.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=n.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=n.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=n.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=n.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=n.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=n.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=n.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=n.getExtension("EXT_color_buffer_half_float"),n.getExtension("EXT_frag_depth"),n.getExtension("OES_element_index_uint"),n.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=n.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=n.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=n.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=n.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=n.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=n.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=n.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=n.getExtension("KHR_parallel_shader_compile"),le(n)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Vo({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:N.TEXTURE_2D,mipLevelCount:1,usage:Q.RENDER_TARGET,format:this.contextAttributes.alpha===!1?D.U8_RGB_RT:D.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=ut.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(n.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(N.TEXTURE_2D,ut.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(N.TEXTURE_2D,ut.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:R.VERTEX,hint:M.STATIC}),le(n)&&(this.fallbackTexture2DArray=this.createFallbackTexture(N.TEXTURE_2D_ARRAY,ut.Float),this.fallbackTexture3D=this.createFallbackTexture(N.TEXTURE_3D,ut.Float),this.fallbackTextureCube=this.createFallbackTexture(N.TEXTURE_CUBE_MAP,ut.Float)),this.currentMegaState.depthCompare=g.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=ft.ALL,n.enable(n.DEPTH_TEST),n.enable(n.STENCIL_TEST),this.checkLimits(),v.shaderDebug&&(this.shaderDebug=!0),v.trackResources&&(this.resourceCreationTracker=new eo)}return t.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},t.prototype.createFallbackTexture=function(n,v){var x=n===N.TEXTURE_CUBE_MAP?6:1,$=v===ut.Depth?D.D32F:D.U8_RGBA_NORM,z=this.createTexture({dimension:n,format:$,usage:Q.SAMPLED,width:1,height:1,depthOrArrayLayers:x,mipLevelCount:1});return v===ut.Float&&z.setImageData([new Uint8Array(4*x)]),Mi(z)},t.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},t.prototype.checkLimits=function(){var n=this.gl;if(this.maxVertexAttribs=n.getParameter(r.MAX_VERTEX_ATTRIBS),le(n)){this.uniformBufferMaxPageByteSize=Math.min(n.getParameter(r.MAX_UNIFORM_BLOCK_SIZE),da),this.uniformBufferWordAlignment=n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var v=n.getInternalformatParameter(n.RENDERBUFFER,n.DEPTH32F_STENCIL8,n.SAMPLES);this.supportedSampleCounts=v?(0,d.ev)([],(0,d.CR)(v),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=da;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(x,$){return x-$})},t.prototype.configureSwapChain=function(n,v,x){var $=this.scTexture;$.width=n,$.height=v,this.scPlatformFramebuffer=P(x)},t.prototype.getDevice=function(){return this},t.prototype.getCanvas=function(){return this.gl.canvas},t.prototype.getOnscreenTexture=function(){return this.scTexture},t.prototype.beginFrame=function(){},t.prototype.endFrame=function(){},t.prototype.translateTextureInternalFormat=function(n,v){switch(v===void 0&&(v=!1),n){case D.ALPHA:return r.ALPHA;case D.U8_LUMINANCE:case D.F16_LUMINANCE:case D.F32_LUMINANCE:return r.LUMINANCE;case D.F16_R:return r.R16F;case D.F16_RG:return r.RG16F;case D.F16_RGB:return r.RGB16F;case D.F16_RGBA:return r.RGBA16F;case D.F32_R:return r.R32F;case D.F32_RG:return r.RG32F;case D.F32_RGB:return r.RGB32F;case D.F32_RGBA:return le(this.gl)?r.RGBA32F:v?this.WEBGL_color_buffer_float.RGBA32F_EXT:r.RGBA;case D.U8_R_NORM:return r.R8;case D.U8_RG_NORM:return r.RG8;case D.U8_RGB_NORM:case D.U8_RGB_RT:return r.RGB8;case D.U8_RGB_SRGB:return r.SRGB8;case D.U8_RGBA_NORM:case D.U8_RGBA_RT:return le(this.gl)?r.RGBA8:v?r.RGBA4:r.RGBA;case D.U8_RGBA:return r.RGBA;case D.U8_RGBA_SRGB:case D.U8_RGBA_RT_SRGB:return r.SRGB8_ALPHA8;case D.U16_R:return r.R16UI;case D.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case D.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case D.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case D.U16_RGBA_5551:return r.RGB5_A1;case D.U16_RGB_565:return r.RGB565;case D.U32_R:return r.R32UI;case D.S8_RGBA_NORM:return r.RGBA8_SNORM;case D.S8_RG_NORM:return r.RG8_SNORM;case D.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case D.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case D.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case D.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case D.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case D.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case D.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case D.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case D.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case D.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case D.D32F_S8:return le(this.gl)?r.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?r.DEPTH_STENCIL:r.DEPTH_COMPONENT16;case D.D24_S8:return le(this.gl)?r.DEPTH24_STENCIL8:this.WEBGL_depth_texture?r.DEPTH_STENCIL:r.DEPTH_COMPONENT16;case D.D32F:return le(this.gl)?r.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?r.DEPTH_COMPONENT:r.DEPTH_COMPONENT16;case D.D24:return le(this.gl)?r.DEPTH_COMPONENT24:this.WEBGL_depth_texture?r.DEPTH_COMPONENT:r.DEPTH_COMPONENT16;default:throw new Error("whoops")}},t.prototype.translateTextureType=function(n){var v=J(n);switch(v){case B.U8:return r.UNSIGNED_BYTE;case B.U16:return r.UNSIGNED_SHORT;case B.U32:return r.UNSIGNED_INT;case B.S8:return r.BYTE;case B.F16:return r.HALF_FLOAT;case B.F32:return r.FLOAT;case B.U16_PACKED_5551:return r.UNSIGNED_SHORT_5_5_5_1;case B.D32F:return le(this.gl)?r.FLOAT:this.WEBGL_depth_texture?r.UNSIGNED_INT:r.UNSIGNED_BYTE;case B.D24:return le(this.gl)?r.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?r.UNSIGNED_SHORT:r.UNSIGNED_BYTE;case B.D24S8:return le(this.gl)?r.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?r.UNSIGNED_INT_24_8_WEBGL:r.UNSIGNED_BYTE;case B.D32FS8:return r.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},t.prototype.translateInternalTextureFormat=function(n){switch(n){case D.F32_R:return r.R32F;case D.F32_RG:return r.RG32F;case D.F32_RGB:return r.RGB32F;case D.F32_RGBA:return r.RGBA32F;case D.F16_R:return r.R16F;case D.F16_RG:return r.RG16F;case D.F16_RGB:return r.RGB16F;case D.F16_RGBA:return r.RGBA16F}return this.translateTextureFormat(n)},t.prototype.translateTextureFormat=function(n){if(Ke(n)||n===D.F32_LUMINANCE||n===D.U8_LUMINANCE)return this.translateTextureInternalFormat(n);var v=le(this.gl)||!le(this.gl)&&!!this.WEBGL_depth_texture;switch(n){case D.D24_S8:case D.D32F_S8:return v?r.DEPTH_STENCIL:r.RGBA;case D.D24:case D.D32F:return v?r.DEPTH_COMPONENT:r.RGBA}var x=ln(n),$=lt(n);switch($){case _.A:return r.ALPHA;case _.R:return x?r.RED_INTEGER:r.RED;case _.RG:return x?r.RG_INTEGER:r.RG;case _.RGB:return x?r.RGB_INTEGER:r.RGB;case _.RGBA:return r.RGBA}},t.prototype.setActiveTexture=function(n){this.currentActiveTexture!==n&&(this.gl.activeTexture(n),this.currentActiveTexture=n)},t.prototype.bindVAO=function(n){this.currentBoundVAO!==n&&(le(this.gl)?this.gl.bindVertexArray(n):this.OES_vertex_array_object.bindVertexArrayOES(n),this.currentBoundVAO=n)},t.prototype.programCompiled=function(n){W(n.compileState!==Ur.NeedsCompile),n.compileState===Ur.Compiling&&(n.compileState=Ur.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(n))},t.prototype.useProgram=function(n){this.currentProgram!==n&&(this.programCompiled(n),this.gl.useProgram(n.gl_program),this.currentProgram=n)},t.prototype.ensureResourceExists=function(n){if(n===null){var v=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(v))}else return n},t.prototype.createBuffer=function(n){return new Ka({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createTexture=function(n){return new Vo({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createSampler=function(n){return new ca({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createRenderTarget=function(n){return new ba({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createRenderTargetFromTexture=function(n){var v=n,x=v.format,$=v.width,z=v.height,et=v.mipLevelCount;return W(et===1),this.createRenderTarget({format:x,width:$,height:z,sampleCount:1,texture:n})},t.prototype.createProgram=function(n){var v,x,$,z=(v=n.vertex)===null||v===void 0?void 0:v.glsl;return!((x=n.vertex)===null||x===void 0)&&x.glsl&&(n.vertex.glsl=Dt(this.queryVendorInfo(),"vert",n.vertex.glsl)),!(($=n.fragment)===null||$===void 0)&&$.glsl&&(n.fragment.glsl=Dt(this.queryVendorInfo(),"frag",n.fragment.glsl)),this.createProgramSimple(n,z)},t.prototype.createProgramSimple=function(n,v){var x=new Oa({id:this.getNextUniqueId(),device:this,descriptor:n},v);return x},t.prototype.createBindings=function(n){return new Qt({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createInputLayout=function(n){return new po({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createRenderPipeline=function(n){return new mo({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createComputePass=function(){return new Ia},t.prototype.createComputePipeline=function(n){return new la({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createReadback=function(){return new Na({id:this.getNextUniqueId(),device:this})},t.prototype.createQueryPool=function(n,v){return new vo({id:this.getNextUniqueId(),device:this,descriptor:{type:n,elemCount:v}})},t.prototype.formatRenderPassDescriptor=function(n){var v,x,$,z,et,ht,mt=n.colorAttachment;n.depthClearValue=(v=n.depthClearValue)!==null&&v!==void 0?v:"load",n.stencilClearValue=(x=n.stencilClearValue)!==null&&x!==void 0?x:"load";for(var wt=0;wt<mt.length;wt++)n.colorAttachmentLevel||(n.colorAttachmentLevel=[]),n.colorAttachmentLevel[wt]=($=n.colorAttachmentLevel[wt])!==null&&$!==void 0?$:0,n.colorResolveToLevel||(n.colorResolveToLevel=[]),n.colorResolveToLevel[wt]=(z=n.colorResolveToLevel[wt])!==null&&z!==void 0?z:0,n.colorClearColor||(n.colorClearColor=[]),n.colorClearColor[wt]=(et=n.colorClearColor[wt])!==null&&et!==void 0?et:"load",n.colorStore||(n.colorStore=[]),n.colorStore[wt]=(ht=n.colorStore[wt])!==null&&ht!==void 0?ht:!1},t.prototype.createRenderBundle=function(){return new fa({id:this.getNextUniqueId(),device:this})},t.prototype.beginBundle=function(n){this.renderBundle=n},t.prototype.endBundle=function(){this.renderBundle=void 0},t.prototype.executeBundles=function(n){n.forEach(function(v){v.replay()})},t.prototype.createRenderPass=function(n){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=n,this.formatRenderPassDescriptor(n);var v=n.colorAttachment,x=n.colorAttachmentLevel,$=n.colorClearColor,z=n.colorResolveTo,et=n.colorResolveToLevel,ht=n.depthStencilAttachment,mt=n.depthClearValue,wt=n.stencilClearValue,zt=n.depthStencilResolveTo,Vt=z&&z.length===1&&z[0]===this.scTexture;this.setRenderPassParametersBegin(v.length,Vt);for(var de=0;de<v.length;de++)this.setRenderPassParametersColor(de,v[de],x[de],z[de],et[de],Vt);this.setRenderPassParametersDepthStencil(ht,zt,Vt),this.validateCurrentAttachments();for(var de=0;de<v.length;de++){var Pe=$[de];Pe!=="load"&&this.setRenderPassParametersClearColor(de,Pe.r,Pe.g,Pe.b,Pe.a)}return this.setRenderPassParametersClearDepthStencil(mt,wt),this},t.prototype.submitPass=function(n){W(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},t.prototype.copySubTexture2D=function(n,v,x,$,z,et){var ht=this.gl,mt=n,wt=$;if(W(wt.mipLevelCount===1),W(mt.mipLevelCount===1),le(ht))mt===this.scTexture?ht.bindFramebuffer(ht.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(ht.bindFramebuffer(ht.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(ht.DRAW_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,mt,0)),ht.bindFramebuffer(ht.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(ht.READ_FRAMEBUFFER,ht.COLOR_ATTACHMENT0,wt,0),ht.blitFramebuffer(z,et,z+wt.width,et+wt.height,v,x,v+wt.width,x+wt.height,ht.COLOR_BUFFER_BIT,ht.LINEAR),ht.bindFramebuffer(ht.READ_FRAMEBUFFER,null),ht.bindFramebuffer(ht.DRAW_FRAMEBUFFER,null);else if(mt===this.scTexture){var zt=this.createRenderTargetFromTexture($);this.submitBlitRenderPass(zt,mt)}},t.prototype.queryLimits=function(){return this},t.prototype.queryTextureFormatSupported=function(n,v,x){switch(n){case D.BC1_SRGB:case D.BC2_SRGB:case D.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?ri(v,x,4,4):!1;case D.BC1:case D.BC2:case D.BC3:return this.WEBGL_compressed_texture_s3tc!==null?ri(v,x,4,4):!1;case D.BC4_UNORM:case D.BC4_SNORM:case D.BC5_UNORM:case D.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?ri(v,x,4,4):!1;case D.U16_R_NORM:case D.U16_RG_NORM:case D.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case D.F32_R:case D.F32_RG:case D.F32_RGB:case D.F32_RGBA:return this.OES_texture_float_linear!==null;case D.F16_R:case D.F16_RG:case D.F16_RGB:case D.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},t.prototype.queryProgramReady=function(n){var v=this.gl;if(n.compileState===Ur.NeedsCompile)throw new Error("whoops");if(n.compileState===Ur.Compiling){var x=void 0;return this.KHR_parallel_shader_compile!==null?x=v.getProgramParameter(n.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):x=!0,x&&this.programCompiled(n),x}return n.compileState===Ur.NeedsBind||n.compileState===Ur.ReadyToUse},t.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},t.prototype.queryVendorInfo=function(){return this},t.prototype.queryRenderPass=function(n){return this.currentRenderPassDescriptor},t.prototype.queryRenderTarget=function(n){var v=n;return v},t.prototype.setResourceName=function(n,v){if(n.name=v,n.type===h.Buffer)for(var x=n.gl_buffer_pages,$=0;$<x.length;$++)Kr(x[$],"".concat(v," Page ").concat($));else if(n.type===h.Texture)Kr(Mi(n),v);else if(n.type===h.Sampler)Kr(Pn(n),v);else if(n.type===h.RenderTarget){var z=n.gl_renderbuffer;z!==null&&Kr(z,v)}else n.type===h.InputLayout&&Kr(n.vao,v)},t.prototype.setResourceLeakCheck=function(n,v){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(n,v)},t.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},t.prototype.pushDebugGroup=function(n){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(n){},t.prototype.programPatched=function(n,v){W(this.shaderDebug)},t.prototype.getBufferData=function(n,v,x){x===void 0&&(x=0);var $=this.gl;le($)&&($.bindBuffer($.COPY_READ_BUFFER,Si(n,x*4)),$.getBufferSubData($.COPY_READ_BUFFER,x*4,v))},t.prototype.debugGroupStatisticsDrawCall=function(n){n===void 0&&(n=1);for(var v=this.debugGroupStack.length-1;v>=0;v--)this.debugGroupStack[v].drawCallCount+=n},t.prototype.debugGroupStatisticsBufferUpload=function(n){n===void 0&&(n=1);for(var v=this.debugGroupStack.length-1;v>=0;v--)this.debugGroupStack[v].bufferUploadCount+=n},t.prototype.debugGroupStatisticsTextureBind=function(n){n===void 0&&(n=1);for(var v=this.debugGroupStack.length-1;v>=0;v--)this.debugGroupStack[v].textureBindCount+=n},t.prototype.debugGroupStatisticsTriangles=function(n){for(var v=this.debugGroupStack.length-1;v>=0;v--)this.debugGroupStack[v].triangleCount+=n},t.prototype.reportShaderError=function(n,v){var x=this.gl,$=x.getShaderParameter(n,x.COMPILE_STATUS);if(!$){console.error(me(v));var z=x.getExtension("WEBGL_debug_shaders");z&&console.error(z.getTranslatedShaderSource(n)),console.error(x.getShaderInfoLog(n))}return $},t.prototype.checkProgramCompilationForErrors=function(n){var v=this.gl,x=n.gl_program;if(!v.getProgramParameter(x,v.LINK_STATUS)){var $=n.descriptor;if(!this.reportShaderError(n.gl_shader_vert,$.vertex.glsl)||!this.reportShaderError(n.gl_shader_frag,$.fragment.glsl))return;console.error(v.getProgramInfoLog(n.gl_program))}},t.prototype.bindFramebufferAttachment=function(n,v,x,$){var z=this.gl;if(u(x))z.framebufferRenderbuffer(n,v,z.RENDERBUFFER,null);else if(x.type===h.RenderTarget)x.gl_renderbuffer!==null?z.framebufferRenderbuffer(n,v,z.RENDERBUFFER,x.gl_renderbuffer):x.texture!==null&&z.framebufferTexture2D(n,v,r.TEXTURE_2D,Mi(x.texture),$);else if(x.type===h.Texture){var et=Mi(x);x.dimension===N.TEXTURE_2D?z.framebufferTexture2D(n,v,r.TEXTURE_2D,et,$):le(z)&&(x.dimension,N.TEXTURE_2D_ARRAY)}},t.prototype.bindFramebufferDepthStencilAttachment=function(n,v){var x=this.gl,$=u(v)?U.Depth|U.Stencil:Rt(v.format),z=!!($&U.Depth),et=!!($&U.Stencil);if(z&&et){var ht=le(this.gl)||!le(this.gl)&&!!this.WEBGL_depth_texture;ht?this.bindFramebufferAttachment(n,x.DEPTH_STENCIL_ATTACHMENT,v,0):this.bindFramebufferAttachment(n,x.DEPTH_ATTACHMENT,v,0)}else z?(this.bindFramebufferAttachment(n,x.DEPTH_ATTACHMENT,v,0),this.bindFramebufferAttachment(n,x.STENCIL_ATTACHMENT,null,0)):et&&(this.bindFramebufferAttachment(n,x.STENCIL_ATTACHMENT,v,0),this.bindFramebufferAttachment(n,x.DEPTH_ATTACHMENT,null,0))},t.prototype.validateCurrentAttachments=function(){for(var n=-1,v=-1,x=-1,$=0;$<this.currentColorAttachments.length;$++){var z=this.currentColorAttachments[$];z!==null&&(n===-1?(n=z.sampleCount,v=z.width,x=z.height):(W(n===z.sampleCount),W(v===z.width),W(x===z.height)))}this.currentDepthStencilAttachment&&(n===-1?n=this.currentDepthStencilAttachment.sampleCount:(W(n===this.currentDepthStencilAttachment.sampleCount),W(v===this.currentDepthStencilAttachment.width),W(x===this.currentDepthStencilAttachment.height))),this.currentSampleCount=n},t.prototype.setRenderPassParametersBegin=function(n,v){v===void 0&&(v=!1);var x=this.gl;if(v)x.bindFramebuffer(r.FRAMEBUFFER,null);else if(le(x)?x.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||x.bindFramebuffer(r.FRAMEBUFFER,this.renderPassDrawFramebuffer),le(x)?x.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1,r.COLOR_ATTACHMENT2,r.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([r.COLOR_ATTACHMENT0_WEBGL,r.COLOR_ATTACHMENT1_WEBGL,r.COLOR_ATTACHMENT2_WEBGL,r.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var $=n;$<this.currentColorAttachments.length;$++){var z=le(x)?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,et=le(x)?r.COLOR_ATTACHMENT0:r.COLOR_ATTACHMENT0_WEBGL;x.framebufferRenderbuffer(z,et+$,r.RENDERBUFFER,null),x.framebufferTexture2D(z,et+$,r.TEXTURE_2D,null,0)}this.currentColorAttachments.length=n},t.prototype.setRenderPassParametersColor=function(n,v,x,$,z,et){et===void 0&&(et=!1);var ht=this.gl,mt=le(ht);(this.currentColorAttachments[n]!==v||this.currentColorAttachmentLevels[n]!==x)&&(this.currentColorAttachments[n]=v,this.currentColorAttachmentLevels[n]=x,!et&&(mt||!mt&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(mt?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,(mt?r.COLOR_ATTACHMENT0:r.COLOR_ATTACHMENT0_WEBGL)+n,v,x),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[n]!==$||this.currentColorResolveToLevels[n]!==z)&&(this.currentColorResolveTos[n]=$,this.currentColorResolveToLevels[n]=z,$!==null&&(this.resolveColorAttachmentsChanged=!0))},t.prototype.setRenderPassParametersDepthStencil=function(n,v,x){x===void 0&&(x=!1);var $=this.gl;this.currentDepthStencilAttachment!==n&&(this.currentDepthStencilAttachment=n,!x&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(le($)?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==v&&(this.currentDepthStencilResolveTo=v,v&&(this.resolveDepthStencilAttachmentsChanged=!0))},t.prototype.setRenderPassParametersClearColor=function(n,v,x,$,z){var et=this.gl;if(this.OES_draw_buffers_indexed!==null){var ht=this.currentMegaState.attachmentsState[n];ht&&ht.channelWriteMask!==ft.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(n,!0,!0,!0,!0),ht.channelWriteMask=ft.ALL)}else{var ht=this.currentMegaState.attachmentsState[0];ht&&ht.channelWriteMask!==ft.ALL&&(et.colorMask(!0,!0,!0,!0),ht.channelWriteMask=ft.ALL)}this.setScissorRectEnabled(!1),le(et)?et.clearBufferfv(et.COLOR,n,[v,x,$,z]):(et.clearColor(v,x,$,z),et.clear(et.COLOR_BUFFER_BIT))},t.prototype.setRenderPassParametersClearDepthStencil=function(n,v){n===void 0&&(n="load"),v===void 0&&(v="load");var x=this.gl;n!=="load"&&(W(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(x.depthMask(!0),this.currentMegaState.depthWrite=!0),le(x)?x.clearBufferfv(x.DEPTH,0,[n]):(x.clearDepth(n),x.clear(x.DEPTH_BUFFER_BIT))),v!=="load"&&(W(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(x.enable(x.STENCIL_TEST),x.stencilMask(255),this.currentMegaState.stencilWrite=!0),le(x)?x.clearBufferiv(x.STENCIL,0,[v]):(x.clearStencil(v),x.clear(x.STENCIL_BUFFER_BIT)))},t.prototype.setBindings=function(n){var v=this,x;if(this.renderBundle){this.renderBundle.push(function(){return v.setBindings(n)});return}var $=this.gl,z=n,et=z.uniformBufferBindings,ht=z.samplerBindings,mt=z.bindingLayouts;W(0<mt.bindingLayoutTables.length);var wt=mt.bindingLayoutTables[0];W(et.length>=wt.numUniformBuffers),W(ht.length>=wt.numSamplers);for(var zt=0;zt<et.length;zt++){var Vt=et[zt];if(Vt.size!==0){var de=wt.firstUniformBuffer+zt,Pe=Vt.buffer,Qe=Vt.offset||0,un=Vt.size||Pe.byteSize;if(Pe!==this.currentUniformBuffers[de]||Qe!==this.currentUniformBufferByteOffsets[de]||un!==this.currentUniformBufferByteSizes[de]){var fn=Qe%Pe.pageByteSize,xn=Pe.gl_buffer_pages[Qe/Pe.pageByteSize|0];W(fn+un<=Pe.pageByteSize),le($)&&$.bindBufferRange($.UNIFORM_BUFFER,de,xn,fn,un),this.currentUniformBuffers[de]=Pe,this.currentUniformBufferByteOffsets[de]=Qe,this.currentUniformBufferByteSizes[de]=un}}}for(var zt=0;zt<wt.numSamplers;zt++){var Vt=ht[zt],on=wt.firstSampler+zt,Vn=Vt!==null&&Vt.sampler!==null?Pn(Vt.sampler):null,Hn=Vt!==null&&Vt.texture!==null?Mi(Vt.texture):null;if(this.currentSamplers[on]!==Vn&&(le($)&&$.bindSampler(on,Vn),this.currentSamplers[on]=Vn),this.currentTextures[on]!==Hn){if(this.setActiveTexture($.TEXTURE0+on),Hn!==null){var cr=st(Vt).texture,pn=cr.gl_target,Je=cr.width,vn=cr.height;Vt.texture.textureIndex=on,$.bindTexture(pn,Hn),le($)||(x=Vt.sampler)===null||x===void 0||x.setTextureParameters(pn,Je,vn),this.debugGroupStatisticsTextureBind()}else{var Jn=(0,d.pi)((0,d.pi)({},Vt),Re),Rr=Jn.dimension,Ir=Jn.formatKind,pn=ui(Rr);$.bindTexture(pn,this.getFallbackTexture((0,d.pi)({gl_target:pn,formatKind:Ir},Jn)))}this.currentTextures[on]=Hn}}},t.prototype.setViewport=function(n,v,x,$){var z=this.gl;z.viewport(n,v,x,$)},t.prototype.setScissorRect=function(n,v,x,$){var z=this.gl;this.setScissorRectEnabled(!0),z.scissor(n,v,x,$)},t.prototype.applyAttachmentStateIndexed=function(n,v,x){var $=this.gl,z=this.OES_draw_buffers_indexed;v.channelWriteMask!==x.channelWriteMask&&(z.colorMaskiOES(n,!!(x.channelWriteMask&ft.RED),!!(x.channelWriteMask&ft.GREEN),!!(x.channelWriteMask&ft.BLUE),!!(x.channelWriteMask&ft.ALPHA)),v.channelWriteMask=x.channelWriteMask);var et=v.rgbBlendState.blendMode!==x.rgbBlendState.blendMode||v.alphaBlendState.blendMode!==x.alphaBlendState.blendMode,ht=v.rgbBlendState.blendSrcFactor!==x.rgbBlendState.blendSrcFactor||v.alphaBlendState.blendSrcFactor!==x.alphaBlendState.blendSrcFactor||v.rgbBlendState.blendDstFactor!==x.rgbBlendState.blendDstFactor||v.alphaBlendState.blendDstFactor!==x.alphaBlendState.blendDstFactor;(ht||et)&&(Fr(v.rgbBlendState)&&Fr(v.alphaBlendState)?z.enableiOES(n,$.BLEND):Fr(x.rgbBlendState)&&Fr(x.alphaBlendState)&&z.disableiOES(n,$.BLEND)),et&&(z.blendEquationSeparateiOES(n,x.rgbBlendState.blendMode,x.alphaBlendState.blendMode),v.rgbBlendState.blendMode=x.rgbBlendState.blendMode,v.alphaBlendState.blendMode=x.alphaBlendState.blendMode),ht&&(z.blendFuncSeparateiOES(n,x.rgbBlendState.blendSrcFactor,x.rgbBlendState.blendDstFactor,x.alphaBlendState.blendSrcFactor,x.alphaBlendState.blendDstFactor),v.rgbBlendState.blendSrcFactor=x.rgbBlendState.blendSrcFactor,v.alphaBlendState.blendSrcFactor=x.alphaBlendState.blendSrcFactor,v.rgbBlendState.blendDstFactor=x.rgbBlendState.blendDstFactor,v.alphaBlendState.blendDstFactor=x.alphaBlendState.blendDstFactor)},t.prototype.applyAttachmentState=function(n,v){var x=this.gl;n.channelWriteMask!==v.channelWriteMask&&(x.colorMask(!!(v.channelWriteMask&ft.RED),!!(v.channelWriteMask&ft.GREEN),!!(v.channelWriteMask&ft.BLUE),!!(v.channelWriteMask&ft.ALPHA)),n.channelWriteMask=v.channelWriteMask);var $=n.rgbBlendState.blendMode!==v.rgbBlendState.blendMode||n.alphaBlendState.blendMode!==v.alphaBlendState.blendMode,z=n.rgbBlendState.blendSrcFactor!==v.rgbBlendState.blendSrcFactor||n.alphaBlendState.blendSrcFactor!==v.alphaBlendState.blendSrcFactor||n.rgbBlendState.blendDstFactor!==v.rgbBlendState.blendDstFactor||n.alphaBlendState.blendDstFactor!==v.alphaBlendState.blendDstFactor;(z||$)&&(Fr(n.rgbBlendState)&&Fr(n.alphaBlendState)?x.enable(x.BLEND):Fr(v.rgbBlendState)&&Fr(v.alphaBlendState)&&x.disable(x.BLEND)),$&&(x.blendEquationSeparate(v.rgbBlendState.blendMode,v.alphaBlendState.blendMode),n.rgbBlendState.blendMode=v.rgbBlendState.blendMode,n.alphaBlendState.blendMode=v.alphaBlendState.blendMode),z&&(x.blendFuncSeparate(v.rgbBlendState.blendSrcFactor,v.rgbBlendState.blendDstFactor,v.alphaBlendState.blendSrcFactor,v.alphaBlendState.blendDstFactor),n.rgbBlendState.blendSrcFactor=v.rgbBlendState.blendSrcFactor,n.alphaBlendState.blendSrcFactor=v.alphaBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor=v.rgbBlendState.blendDstFactor,n.alphaBlendState.blendDstFactor=v.alphaBlendState.blendDstFactor)},t.prototype.setMegaState=function(n){var v=this.gl,x=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var $=0;$<n.attachmentsState.length;$++)this.applyAttachmentStateIndexed($,x.attachmentsState[0],n.attachmentsState[0]);else W(n.attachmentsState.length===1),this.applyAttachmentState(x.attachmentsState[0],n.attachmentsState[0]);Tt(x.blendConstant,n.blendConstant)||(v.blendColor(n.blendConstant.r,n.blendConstant.g,n.blendConstant.b,n.blendConstant.a),Gt(x.blendConstant,n.blendConstant)),x.depthCompare!==n.depthCompare&&(v.depthFunc(n.depthCompare),x.depthCompare=n.depthCompare),!!x.depthWrite!=!!n.depthWrite&&(v.depthMask(n.depthWrite),x.depthWrite=n.depthWrite),!!x.stencilWrite!=!!n.stencilWrite&&(v.stencilMask(n.stencilWrite?255:0),x.stencilWrite=n.stencilWrite);var z=!1;if(!Ei(x.stencilFront,n.stencilFront)){z=!0;var et=n.stencilFront,ht=et.passOp,mt=et.failOp,wt=et.depthFailOp,zt=et.compare;(x.stencilFront.passOp!==ht||x.stencilFront.failOp!==mt||x.stencilFront.depthFailOp!==wt)&&(v.stencilOpSeparate(v.FRONT,mt,wt,ht),x.stencilFront.passOp=ht,x.stencilFront.failOp=mt,x.stencilFront.depthFailOp=wt),x.stencilFront.compare!==zt&&(this.setStencilReference(0),x.stencilFront.compare=zt)}if(!Ei(x.stencilBack,n.stencilBack)){z=!0;var Vt=n.stencilBack,ht=Vt.passOp,mt=Vt.failOp,wt=Vt.depthFailOp,zt=Vt.compare;(x.stencilBack.passOp!==ht||x.stencilBack.failOp!==mt||x.stencilBack.depthFailOp!==wt)&&(v.stencilOpSeparate(v.BACK,mt,wt,ht),x.stencilBack.passOp=ht,x.stencilBack.failOp=mt,x.stencilBack.depthFailOp=wt),x.stencilBack.compare!==zt&&(this.setStencilReference(0),x.stencilBack.compare=zt)}(x.stencilFront.mask!==n.stencilFront.mask||x.stencilBack.mask!==n.stencilBack.mask)&&(z=!0,x.stencilFront.mask=n.stencilFront.mask,x.stencilBack.mask=n.stencilBack.mask),z&&this.applyStencil(),x.cullMode!==n.cullMode&&(x.cullMode===o.NONE?v.enable(v.CULL_FACE):n.cullMode===o.NONE&&v.disable(v.CULL_FACE),n.cullMode===o.BACK?v.cullFace(v.BACK):n.cullMode===o.FRONT?v.cullFace(v.FRONT):n.cullMode===o.FRONT_AND_BACK&&v.cullFace(v.FRONT_AND_BACK),x.cullMode=n.cullMode),x.frontFace!==n.frontFace&&(v.frontFace(n.frontFace),x.frontFace=n.frontFace),x.polygonOffset!==n.polygonOffset&&(n.polygonOffset?v.enable(v.POLYGON_OFFSET_FILL):v.disable(v.POLYGON_OFFSET_FILL),x.polygonOffset=n.polygonOffset),(x.polygonOffsetFactor!==n.polygonOffsetFactor||x.polygonOffsetUnits!==n.polygonOffsetUnits)&&(v.polygonOffset(n.polygonOffsetFactor,n.polygonOffsetUnits),x.polygonOffsetFactor=n.polygonOffsetFactor,x.polygonOffsetUnits=n.polygonOffsetUnits)},t.prototype.validatePipelineFormats=function(n){for(var v=0;v<this.currentColorAttachments.length;v++)var x=this.currentColorAttachments[v];this.currentDepthStencilAttachment&&W(this.currentDepthStencilAttachment.format===n.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&W(this.currentSampleCount===n.sampleCount)},t.prototype.setPipeline=function(n){var v=this;if(this.renderBundle){this.renderBundle.push(function(){return v.setPipeline(n)});return}this.currentPipeline=n,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var x=this.currentPipeline.program;if(this.useProgram(x),x.compileState===Ur.NeedsBind){var $=this.gl,z=x.gl_program,et=x.descriptor,ht=ni(et.vertex.glsl,Fa);if(le($))for(var mt=0;mt<ht.length;mt++){var wt=(0,d.CR)(ht[mt],2),zt=wt[1],Vt=$.getUniformBlockIndex(z,zt);Vt!==-1&&Vt!==4294967295&&$.uniformBlockBinding(z,Vt,mt)}for(var de=ni(et.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),mt=0;mt<de.length;mt++){var Pe=(0,d.CR)(de[mt],3),Qe=Pe[1],un=Pe[2],fn=$.getUniformLocation(z,Qe);$.uniform1i(fn,parseInt(un))}x.compileState=Ur.ReadyToUse}},t.prototype.setVertexInput=function(n,v,x){var $,z,et=this,ht;if(this.renderBundle){this.renderBundle.push(function(){return et.setVertexInput(n,v,x)});return}if(n!==null){W(this.currentPipeline.inputLayout===n);var mt=n;this.bindVAO(mt.vao);for(var wt=this.gl,zt=0;zt<mt.vertexBufferDescriptors.length;zt++){var Vt=mt.vertexBufferDescriptors[zt],de=Vt.arrayStride,Pe=Vt.attributes;try{for(var Qe=($=void 0,(0,d.XA)(Pe)),un=Qe.next();!un.done;un=Qe.next()){var fn=un.value,xn=fn.shaderLocation,on=fn.offset,Vn=le(wt)?xn:(ht=mt.program.attributes[xn])===null||ht===void 0?void 0:ht.location;if(!u(Vn)){var Hn=v[zt];if(Hn===null)continue;var cr=fn.vertexFormat;wt.bindBuffer(wt.ARRAY_BUFFER,Si(Hn.buffer));var pn=(Hn.offset||0)+on;wt.vertexAttribPointer(Vn,cr.size,cr.type,cr.normalized,de,pn)}}}catch(vn){$={error:vn}}finally{try{un&&!un.done&&(z=Qe.return)&&z.call(Qe)}finally{if($)throw $.error}}}if(W(x!==null==(mt.indexBufferFormat!==null)),x!==null){var Je=x.buffer;W(Je.usage===R.INDEX),wt.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,Si(Je)),this.currentIndexBufferByteOffset=x.offset||0}else this.currentIndexBufferByteOffset=null}else W(this.currentPipeline.inputLayout===null),W(x===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},t.prototype.setStencilReference=function(n){this.currentStencilRef!==n&&(this.currentStencilRef=n,this.applyStencil())},t.prototype.draw=function(n,v,x,$){var z,et=this;if(this.renderBundle){this.renderBundle.push(function(){return et.draw(n,v,x,$)});return}var ht=this.gl,mt=this.currentPipeline;if(v){var wt=[mt.drawMode,x||0,n,v];le(ht)?ht.drawArraysInstanced.apply(ht,(0,d.ev)([],(0,d.CR)(wt),!1)):(z=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(z,(0,d.ev)([],(0,d.CR)(wt),!1))}else ht.drawArrays(mt.drawMode,x,n);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(n/3*Math.max(v,1))},t.prototype.drawIndexed=function(n,v,x,$,z){var et,ht=this;if(this.renderBundle){this.renderBundle.push(function(){return ht.drawIndexed(n,v,x,$,z)});return}var mt=this.gl,wt=this.currentPipeline,zt=st(wt.inputLayout),Vt=st(this.currentIndexBufferByteOffset)+x*zt.indexBufferCompByteSize;if(v){var de=[wt.drawMode,n,zt.indexBufferType,Vt,v];le(mt)?mt.drawElementsInstanced.apply(mt,(0,d.ev)([],(0,d.CR)(de),!1)):(et=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(et,(0,d.ev)([],(0,d.CR)(de),!1))}else mt.drawElements(wt.drawMode,n,zt.indexBufferType,Vt);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(n/3*Math.max(v,1))},t.prototype.drawIndirect=function(n,v){},t.prototype.drawIndexedIndirect=function(n,v){},t.prototype.beginOcclusionQuery=function(n){var v=this.gl;if(le(v)){var x=this.currentRenderPassDescriptor.occlusionQueryPool;v.beginQuery(x.gl_query_type,x.gl_query[n])}},t.prototype.endOcclusionQuery=function(){var n=this.gl;if(le(n)){var v=this.currentRenderPassDescriptor.occlusionQueryPool;n.endQuery(v.gl_query_type)}},t.prototype.pipelineQueryReady=function(n){var v=n;return this.queryProgramReady(v.program)},t.prototype.pipelineForceReady=function(n){},t.prototype.endPass=function(){for(var n=this.gl,v=le(n),x=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,$=!1,z=0;z<this.currentColorAttachments.length;z++){var et=this.currentColorAttachments[z];if(et!==null){var ht=this.currentColorResolveTos[z],mt=!1;ht!==null&&(W(et.width===ht.width&&et.height===ht.height),this.setScissorRectEnabled(!1),x||(v&&n.bindFramebuffer(n.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&v&&this.bindFramebufferAttachment(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,et,this.currentColorAttachmentLevels[z])),mt=!0,x||(ht===this.scTexture?n.bindFramebuffer(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,this.scPlatformFramebuffer):(n.bindFramebuffer(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&n.framebufferTexture2D(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ht.gl_texture,this.currentColorResolveToLevels[z]))),x||(v?(n.blitFramebuffer(0,0,et.width,et.height,0,0,ht.width,ht.height,n.COLOR_BUFFER_BIT,n.LINEAR),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(et,ht)),$=!0),this.currentRenderPassDescriptor.colorStore[z]||!x&&!mt&&(n.bindFramebuffer(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,n.COLOR_ATTACHMENT0,et,this.currentColorAttachmentLevels[z])),x||n.bindFramebuffer(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var wt=this.currentDepthStencilAttachment;if(wt){var zt=this.currentDepthStencilResolveTo,mt=!1;zt&&(W(wt.width===zt.width&&wt.height===zt.height),this.setScissorRectEnabled(!1),x||(n.bindFramebuffer(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),n.bindFramebuffer(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,wt),this.bindFramebufferDepthStencilAttachment(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,zt))),mt=!0,x||(v&&n.blitFramebuffer(0,0,wt.width,wt.height,0,0,zt.width,zt.height,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null)),$=!0),!x&&!this.currentRenderPassDescriptor.depthStencilStore&&(mt||(n.bindFramebuffer(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,wt),mt=!0),v&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[n.DEPTH_STENCIL_ATTACHMENT])),!x&&mt&&n.bindFramebuffer(v?r.READ_FRAMEBUFFER:r.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!x&&!$&&n.bindFramebuffer(v?r.DRAW_FRAMEBUFFER:r.FRAMEBUFFER,null)},t.prototype.setScissorRectEnabled=function(n){if(this.currentScissorEnabled!==n){var v=this.gl;n?v.enable(v.SCISSOR_TEST):v.disable(v.SCISSOR_TEST),this.currentScissorEnabled=n}},t.prototype.applyStencil=function(){u(this.currentStencilRef)||(this.gl.stencilFuncSeparate(r.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(r.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},t.prototype.getFallbackTexture=function(n){var v=n.gl_target,x=n.formatKind;if(v===r.TEXTURE_2D)return x===ut.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(v===r.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(v===r.TEXTURE_3D)return this.fallbackTexture3D;if(v===r.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},t.prototype.submitBlitRenderPass=function(n,v){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:R.VERTEX|R.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Z.VERTEX,attributes:[{format:D.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:X.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[D.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Cn(Qn)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:n.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:n}));var x=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var $=this.createRenderPass({colorAttachment:[n],colorResolveTo:[v],colorClearColor:[nt]}),z=this.getCanvas(),et=z.width,ht=z.height;$.setPipeline(this.blitRenderPipeline),$.setBindings(this.blitBindings),$.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),$.setViewport(0,0,et,ht),this.gl.disable(this.gl.BLEND),$.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=x,this.inBlitRenderPass=!1},t}(),ts=function(){function t(n){this.pluginOptions=n}return t.prototype.createSwapChain=function(n){return(0,d.mG)(this,void 0,void 0,function(){var v,x,$,z,et,ht,mt,wt,zt,Vt,de,Pe,Qe;return(0,d.Jh)(this,function(un){return v=this.pluginOptions,x=v.targets,$=v.xrCompatible,z=v.antialias,et=z===void 0?!1:z,ht=v.preserveDrawingBuffer,mt=ht===void 0?!1:ht,wt=v.premultipliedAlpha,zt=wt===void 0?!0:wt,Vt=v.shaderDebug,de=v.trackResources,Pe={antialias:et,preserveDrawingBuffer:mt,stencil:!0,premultipliedAlpha:zt,xrCompatible:$},this.handleContextEvents(n),x.includes("webgl2")&&(Qe=n.getContext("webgl2",Pe)||n.getContext("experimental-webgl2",Pe)),!Qe&&x.includes("webgl1")&&(Qe=n.getContext("webgl",Pe)||n.getContext("experimental-webgl",Pe)),[2,new qa(Qe,{shaderDebug:Vt,trackResources:de})]})})},t.prototype.handleContextEvents=function(n){var v=this.pluginOptions,x=v.onContextLost,$=v.onContextRestored,z=v.onContextCreationError;z&&n.addEventListener("webglcontextcreationerror",z,!1),x&&n.addEventListener("webglcontextlost",x,!1),$&&n.addEventListener("webglcontextrestored",$,!1)},t}();let dr;const Ar=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ar.decode();let wi=null;function No(){return(wi===null||wi.byteLength===0)&&(wi=new Uint8Array(dr.memory.buffer)),wi}function vi(t,n){return t=t>>>0,Ar.decode(No().subarray(t,t+n))}const mi=new Array(128).fill(void 0);mi.push(void 0,null,!0,!1);let $i=mi.length;function no(t){$i===mi.length&&mi.push(mi.length+1);const n=$i;return $i=mi[n],mi[n]=t,n}function Ri(t){return mi[t]}function ko(t){t<132||(mi[t]=$i,$i=t)}function Io(t){const n=Ri(t);return ko(t),n}let ji=0;const go=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ha=typeof go.encodeInto=="function"?function(t,n){return go.encodeInto(t,n)}:function(t,n){const v=go.encode(t);return n.set(v),{read:t.length,written:v.length}};function Fo(t,n,v){if(v===void 0){const ht=go.encode(t),mt=n(ht.length,1)>>>0;return No().subarray(mt,mt+ht.length).set(ht),ji=ht.length,mt}let x=t.length,$=n(x,1)>>>0;const z=No();let et=0;for(;et<x;et++){const ht=t.charCodeAt(et);if(ht>127)break;z[$+et]=ht}if(et!==x){et!==0&&(t=t.slice(et)),$=v($,x,x=et+t.length*3,1)>>>0;const ht=No().subarray($+et,$+x),mt=ha(t,ht);et+=mt.written}return ji=et,$}let yo=null;function Xo(){return(yo===null||yo.byteLength===0)&&(yo=new Int32Array(dr.memory.buffer)),yo}function es(t,n,v){let x,$;try{const ht=dr.__wbindgen_add_to_stack_pointer(-16),mt=Fo(t,dr.__wbindgen_malloc,dr.__wbindgen_realloc),wt=ji,zt=Fo(n,dr.__wbindgen_malloc,dr.__wbindgen_realloc),Vt=ji;dr.glsl_compile(ht,mt,wt,zt,Vt,v);var z=Xo()[ht/4+0],et=Xo()[ht/4+1];return x=z,$=et,vi(z,et)}finally{dr.__wbindgen_add_to_stack_pointer(16),dr.__wbindgen_free(x,$,1)}}class Ao{static __wrap(n){n=n>>>0;const v=Object.create(Ao.prototype);return v.__wbg_ptr=n,v}__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,n}free(){const n=this.__destroy_into_raw();dr.__wbg_wgslcomposer_free(n)}constructor(){const n=dr.wgslcomposer_new();return Ao.__wrap(n)}load_composable(n){const v=Fo(n,dr.__wbindgen_malloc,dr.__wbindgen_realloc),x=ji;dr.wgslcomposer_load_composable(this.__wbg_ptr,v,x)}wgsl_compile(n){let v,x;try{const et=dr.__wbindgen_add_to_stack_pointer(-16),ht=Fo(n,dr.__wbindgen_malloc,dr.__wbindgen_realloc),mt=ji;dr.wgslcomposer_wgsl_compile(et,this.__wbg_ptr,ht,mt);var $=Xo()[et/4+0],z=Xo()[et/4+1];return v=$,x=z,vi($,z)}finally{dr.__wbindgen_add_to_stack_pointer(16),dr.__wbindgen_free(v,x,1)}}}async function Bo(t,n){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,n)}catch(x){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",x);else throw x}const v=await t.arrayBuffer();return await WebAssembly.instantiate(v,n)}else{const v=await WebAssembly.instantiate(t,n);return v instanceof WebAssembly.Instance?{instance:v,module:t}:v}}function Ho(){const t={};return t.wbg={},t.wbg.__wbindgen_string_new=function(n,v){const x=vi(n,v);return no(x)},t.wbg.__wbindgen_object_drop_ref=function(n){Io(n)},t.wbg.__wbg_log_1d3ae0273d8f4f8a=function(n){console.log(Ri(n))},t.wbg.__wbg_log_576ca876af0d4a77=function(n,v){console.log(Ri(n),Ri(v))},t.wbg.__wbindgen_throw=function(n,v){throw new Error(vi(n,v))},t}function pa(t,n){return dr=t.exports,Eo.__wbindgen_wasm_module=n,yo=null,wi=null,dr}async function Eo(t){if(dr!==void 0)return dr;const n=Ho();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:v,module:x}=await Bo(await t,n);return pa(v,x)}var vr;(function(t){t[t.COPY_SRC=1]="COPY_SRC",t[t.COPY_DST=2]="COPY_DST",t[t.TEXTURE_BINDING=4]="TEXTURE_BINDING",t[t.STORAGE_BINDING=8]="STORAGE_BINDING",t[t.STORAGE=8]="STORAGE",t[t.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(vr||(vr={}));var ii;(function(t){t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"})(ii||(ii={}));function Go(t){var n=0;return t&Q.SAMPLED&&(n|=vr.TEXTURE_BINDING|vr.COPY_DST|vr.COPY_SRC),t&Q.STORAGE&&(n|=vr.TEXTURE_BINDING|vr.STORAGE_BINDING|vr.COPY_SRC|vr.COPY_DST),t&Q.RENDER_TARGET&&(n|=vr.RENDER_ATTACHMENT|vr.TEXTURE_BINDING|vr.COPY_SRC|vr.COPY_DST),n}function Lo(t){if(t===D.U8_R_NORM)return"r8unorm";if(t===D.S8_R_NORM)return"r8snorm";if(t===D.U8_RG_NORM)return"rg8unorm";if(t===D.S8_RG_NORM)return"rg8snorm";if(t===D.U32_R)return"r32uint";if(t===D.S32_R)return"r32sint";if(t===D.F32_R)return"r32float";if(t===D.U16_RG)return"rg16uint";if(t===D.S16_RG)return"rg16sint";if(t===D.F16_RG)return"rg16float";if(t===D.U8_RGBA_RT)return"bgra8unorm";if(t===D.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(t===D.U8_RGBA_NORM)return"rgba8unorm";if(t===D.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(t===D.S8_RGBA_NORM)return"rgba8snorm";if(t===D.U32_RG)return"rg32uint";if(t===D.S32_RG)return"rg32sint";if(t===D.F32_RG)return"rg32float";if(t===D.U16_RGBA)return"rgba16uint";if(t===D.S16_RGBA)return"rgba16sint";if(t===D.F16_RGBA)return"rgba16float";if(t===D.F32_RGBA)return"rgba32float";if(t===D.U32_RGBA)return"rgba32uint";if(t===D.S32_RGBA)return"rgba32sint";if(t===D.D24)return"depth24plus";if(t===D.D24_S8)return"depth24plus-stencil8";if(t===D.D32F)return"depth32float";if(t===D.D32F_S8)return"depth32float-stencil8";if(t===D.BC1)return"bc1-rgba-unorm";if(t===D.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(t===D.BC2)return"bc2-rgba-unorm";if(t===D.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(t===D.BC3)return"bc3-rgba-unorm";if(t===D.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(t===D.BC4_SNORM)return"bc4-r-snorm";if(t===D.BC4_UNORM)return"bc4-r-unorm";if(t===D.BC5_SNORM)return"bc5-rg-snorm";if(t===D.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function va(t){if(t===N.TEXTURE_2D)return"2d";if(t===N.TEXTURE_CUBE_MAP)return"2d";if(t===N.TEXTURE_2D_ARRAY)return"2d";if(t===N.TEXTURE_3D)return"3d";throw new Error("whoops")}function Ba(t){if(t===N.TEXTURE_2D)return"2d";if(t===N.TEXTURE_CUBE_MAP)return"cube";if(t===N.TEXTURE_2D_ARRAY)return"2d-array";if(t===N.TEXTURE_3D)return"3d";throw new Error("whoops")}function La(t){var n=0;return t&R.INDEX&&(n|=GPUBufferUsage.INDEX),t&R.VERTEX&&(n|=GPUBufferUsage.VERTEX),t&R.UNIFORM&&(n|=GPUBufferUsage.UNIFORM),t&R.STORAGE&&(n|=GPUBufferUsage.STORAGE),t&R.COPY_SRC&&(n|=GPUBufferUsage.COPY_SRC),t&R.INDIRECT&&(n|=GPUBufferUsage.INDIRECT),n|=GPUBufferUsage.COPY_DST,n}function Mo(t){if(t===E.CLAMP_TO_EDGE)return"clamp-to-edge";if(t===E.REPEAT)return"repeat";if(t===E.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function ma(t){if(t===b.BILINEAR)return"linear";if(t===b.POINT)return"nearest";throw new Error("whoops")}function Ma(t){if(t===C.LINEAR)return"linear";if(t===C.NEAREST)return"nearest";if(t===C.NO_MIP)return"nearest";throw new Error("whoops")}function ro(t){var n=t;return n.gpuBuffer}function ga(t){var n=t;return n.gpuSampler}function wa(t){var n=t;return n.querySet}function To(t){if(t===O.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Yo(t){switch(t){case X.TRIANGLES:return"triangle-list";case X.POINTS:return"point-list";case X.TRIANGLE_STRIP:return"triangle-strip";case X.LINES:return"line-list";case X.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function $o(t){if(t===o.NONE)return"none";if(t===o.FRONT)return"front";if(t===o.BACK)return"back";throw new Error("whoops")}function So(t){if(t===A.CCW)return"ccw";if(t===A.CW)return"cw";throw new Error("whoops")}function _a(t,n){return{topology:Yo(t),cullMode:$o(n.cullMode),frontFace:So(n.frontFace)}}function Da(t){if(t===S.ZERO)return"zero";if(t===S.ONE)return"one";if(t===S.SRC)return"src";if(t===S.ONE_MINUS_SRC)return"one-minus-src";if(t===S.DST)return"dst";if(t===S.ONE_MINUS_DST)return"one-minus-dst";if(t===S.SRC_ALPHA)return"src-alpha";if(t===S.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(t===S.DST_ALPHA)return"dst-alpha";if(t===S.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(t===S.CONST)return"constant";if(t===S.ONE_MINUS_CONSTANT)return"one-minus-constant";if(t===S.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function ns(t){if(t===T.ADD)return"add";if(t===T.SUBSTRACT)return"subtract";if(t===T.REVERSE_SUBSTRACT)return"reverse-subtract";if(t===T.MIN)return"min";if(t===T.MAX)return"max";throw new Error("whoops")}function Wo(t){return{operation:ns(t.blendMode),srcFactor:Da(t.blendSrcFactor),dstFactor:Da(t.blendDstFactor)}}function Pa(t){return t.blendMode===T.ADD&&t.blendSrcFactor===S.ONE&&t.blendDstFactor===S.ZERO}function rs(t){if(!(Pa(t.rgbBlendState)&&Pa(t.alphaBlendState)))return{color:Wo(t.rgbBlendState),alpha:Wo(t.alphaBlendState)}}function Ua(t,n){return{format:Lo(n),blend:rs(t),writeMask:t.channelWriteMask}}function ya(t,n){return n.attachmentsState.map(function(v,x){return Ua(v,t[x])})}function Qo(t){if(t===g.NEVER)return"never";if(t===g.LESS)return"less";if(t===g.EQUAL)return"equal";if(t===g.LEQUAL)return"less-equal";if(t===g.GREATER)return"greater";if(t===g.NOTEQUAL)return"not-equal";if(t===g.GEQUAL)return"greater-equal";if(t===g.ALWAYS)return"always";throw new Error("whoops")}function Vi(t){if(t===I.KEEP)return"keep";if(t===I.REPLACE)return"replace";if(t===I.ZERO)return"zero";if(t===I.DECREMENT_CLAMP)return"decrement-clamp";if(t===I.DECREMENT_WRAP)return"decrement-wrap";if(t===I.INCREMENT_CLAMP)return"increment-clamp";if(t===I.INCREMENT_WRAP)return"increment-wrap";if(t===I.INVERT)return"invert";throw new Error("whoops")}function wo(t,n){if(!u(t))return{format:Lo(t),depthWriteEnabled:!!n.depthWrite,depthCompare:Qo(n.depthCompare),depthBias:n.polygonOffset?n.polygonOffsetUnits:0,depthBiasSlopeScale:n.polygonOffset?n.polygonOffsetFactor:0,stencilFront:{compare:Qo(n.stencilFront.compare),passOp:Vi(n.stencilFront.passOp),failOp:Vi(n.stencilFront.failOp),depthFailOp:Vi(n.stencilFront.depthFailOp)},stencilBack:{compare:Qo(n.stencilBack.compare),passOp:Vi(n.stencilBack.passOp),failOp:Vi(n.stencilBack.failOp),depthFailOp:Vi(n.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function Aa(t){if(t!==null){if(t===D.U16_R)return"uint16";if(t===D.U32_R)return"uint32";throw new Error("whoops")}}function Jo(t){if(t===Z.VERTEX)return"vertex";if(t===Z.INSTANCE)return"instance";throw new Error("whoops")}function is(t){if(t===D.U8_R)return"uint8x2";if(t===D.U8_RG)return"uint8x2";if(t===D.U8_RGB)return"uint8x4";if(t===D.U8_RGBA)return"uint8x4";if(t===D.U8_RG_NORM)return"unorm8x2";if(t===D.U8_RGBA_NORM)return"unorm8x4";if(t===D.S8_RGB_NORM)return"snorm8x4";if(t===D.S8_RGBA_NORM)return"snorm8x4";if(t===D.U16_RG_NORM)return"unorm16x2";if(t===D.U16_RGBA_NORM)return"unorm16x4";if(t===D.S16_RG_NORM)return"snorm16x2";if(t===D.S16_RGBA_NORM)return"snorm16x4";if(t===D.S16_RG)return"uint16x2";if(t===D.F16_RG)return"float16x2";if(t===D.F16_RGBA)return"float16x4";if(t===D.F32_R)return"float32";if(t===D.F32_RG)return"float32x2";if(t===D.F32_RGB)return"float32x3";if(t===D.F32_RGBA)return"float32x4";throw"whoops"}function _o(t){var n=J(t);switch(n){case B.BC1:case B.BC2:case B.BC3:case B.BC4_SNORM:case B.BC4_UNORM:case B.BC5_SNORM:case B.BC5_UNORM:return!0;default:return!1}}function Za(t){var n=J(t);switch(n){case B.BC1:case B.BC2:case B.BC3:case B.BC4_SNORM:case B.BC4_UNORM:case B.BC5_SNORM:case B.BC5_UNORM:return 4;default:return 1}}function za(t,n,v,x){switch(v===void 0&&(v=!1),t){case D.S8_R:case D.S8_R_NORM:case D.S8_RG_NORM:case D.S8_RGB_NORM:case D.S8_RGBA_NORM:{var $=n instanceof ArrayBuffer?new Int8Array(n):new Int8Array(n);return x&&$.set(new Int8Array(x)),$}case D.U8_R:case D.U8_R_NORM:case D.U8_RG:case D.U8_RG_NORM:case D.U8_RGB:case D.U8_RGB_NORM:case D.U8_RGB_SRGB:case D.U8_RGBA:case D.U8_RGBA_NORM:case D.U8_RGBA_SRGB:{var z=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n);return x&&z.set(new Uint8Array(x)),z}case D.S16_R:case D.S16_RG:case D.S16_RG_NORM:case D.S16_RGB_NORM:case D.S16_RGBA:case D.S16_RGBA_NORM:{var et=n instanceof ArrayBuffer?new Int16Array(n):new Int16Array(v?n/2:n);return x&&et.set(new Int16Array(x)),et}case D.U16_R:case D.U16_RGB:case D.U16_RGBA_5551:case D.U16_RGBA_NORM:case D.U16_RG_NORM:case D.U16_R_NORM:{var ht=n instanceof ArrayBuffer?new Uint16Array(n):new Uint16Array(v?n/2:n);return x&&ht.set(new Uint16Array(x)),ht}case D.S32_R:{var mt=n instanceof ArrayBuffer?new Int32Array(n):new Int32Array(v?n/4:n);return x&&mt.set(new Int32Array(x)),mt}case D.U32_R:case D.U32_RG:{var wt=n instanceof ArrayBuffer?new Uint32Array(n):new Uint32Array(v?n/4:n);return x&&wt.set(new Uint32Array(x)),wt}case D.F32_R:case D.F32_RG:case D.F32_RGB:case D.F32_RGBA:{var zt=n instanceof ArrayBuffer?new Float32Array(n):new Float32Array(v?n/4:n);return x&&zt.set(new Float32Array(x)),zt}}var Vt=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n);return x&&Vt.set(new Uint8Array(x)),Vt}function os(t){var n=(t&32768)>>15,v=(t&31744)>>10,x=t&1023;return v===0?(n?-1:1)*Math.pow(2,-14)*(x/Math.pow(2,10)):v==31?x?NaN:(n?-1:1)*(1/0):(n?-1:1)*Math.pow(2,v-15)*(1+x/Math.pow(2,10))}function ja(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var gi=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=t.call(this)||this;return z.id=x,z.device=$,z}return n.prototype.destroy=function(){},n}(l),as=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et,ht,mt=t.call(this,{id:x,device:$})||this;mt.type=h.Bindings;var wt=z.pipeline;W(!!wt);var zt=z.uniformBufferBindings,Vt=z.storageBufferBindings,de=z.samplerBindings,Pe=z.storageTextureBindings;mt.numUniformBuffers=(zt==null?void 0:zt.length)||0;var Qe=[[],[],[],[]],un=0;if(zt&&zt.length)for(var fn=0;fn<zt.length;fn++){var xn=z.uniformBufferBindings[fn],on=xn.binding,Vn=xn.size,Hn=xn.offset,cr=xn.buffer,pn={buffer:ro(cr),offset:Hn!=null?Hn:0,size:Vn};Qe[0].push({binding:on!=null?on:un++,resource:pn})}if(de&&de.length){un=0;for(var fn=0;fn<de.length;fn++){var Je=(0,d.pi)((0,d.pi)({},de[fn]),Re),on=z.samplerBindings[fn],vn=on.texture!==null?on.texture:mt.device.getFallbackTexture(Je);Je.dimension=vn.dimension,Je.formatKind=w(vn.format);var Jn=vn.gpuTextureView;if(Qe[1].push({binding:(et=on.textureBinding)!==null&&et!==void 0?et:un++,resource:Jn}),on.samplerBinding!==-1){var Rr=on.sampler!==null?on.sampler:mt.device.getFallbackSampler(Je),Ir=ga(Rr);Qe[1].push({binding:(ht=on.samplerBinding)!==null&&ht!==void 0?ht:un++,resource:Ir})}}}if(Vt&&Vt.length){un=0;for(var fn=0;fn<Vt.length;fn++){var oi=z.storageBufferBindings[fn],on=oi.binding,Vn=oi.size,Hn=oi.offset,cr=oi.buffer,pn={buffer:ro(cr),offset:Hn!=null?Hn:0,size:Vn};Qe[2].push({binding:on!=null?on:un++,resource:pn})}}if(Pe&&Pe.length){un=0;for(var fn=0;fn<Pe.length;fn++){var bi=z.storageTextureBindings[fn],on=bi.binding,vn=bi.texture,Jn=vn.gpuTextureView;Qe[3].push({binding:on!=null?on:un++,resource:Jn})}}var Xr=Qe.findLastIndex(function(_i){return!!_i.length});return mt.gpuBindGroup=Qe.map(function(_i,io){return io<=Xr&&mt.device.device.createBindGroup({layout:wt.getBindGroupLayout(io),entries:_i})}),mt}return n}(gi),ss=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.Buffer;var ht=z.usage,mt=z.viewOrSize,wt=!!(ht&R.MAP_READ);et.usage=La(ht),wt&&(et.usage=R.MAP_READ|R.COPY_DST);var zt=!i(mt);if(et.view=i(mt)?null:mt,et.size=i(mt)?pt(mt,4):pt(mt.byteLength,4),i(mt))et.gpuBuffer=et.device.device.createBuffer({usage:et.usage,size:et.size,mappedAtCreation:wt?zt:!1});else{et.gpuBuffer=et.device.device.createBuffer({usage:et.usage,size:et.size,mappedAtCreation:!0});var Vt=mt&&mt.constructor||Float32Array;new Vt(et.gpuBuffer.getMappedRange()).set(mt),et.gpuBuffer.unmap()}return et}return n.prototype.setSubData=function(v,x,$,z){$===void 0&&($=0),z===void 0&&(z=0);var et=this.gpuBuffer;z=z||x.byteLength,z=Math.min(z,this.size-v);var ht=x.byteOffset+$,mt=ht+z,wt=z+3&-4;if(wt!==z){var zt=new Uint8Array(x.buffer.slice(ht,mt));x=new Uint8Array(wt),x.set(zt),$=0,ht=0,mt=wt,z=wt}for(var Vt=1024*1024*15,de=0;mt-(ht+de)>Vt;)this.device.device.queue.writeBuffer(et,v+de,x.buffer,ht+de,Vt),de+=Vt;this.device.device.queue.writeBuffer(et,v+de,x.buffer,ht+de,z-de)},n.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuBuffer.destroy()},n}(gi),Ko=function(){function t(){this.gpuComputePassEncoder=null}return t.prototype.dispatchWorkgroups=function(n,v,x){this.gpuComputePassEncoder.dispatchWorkgroups(n,v,x)},t.prototype.dispatchWorkgroupsIndirect=function(n,v){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(n.gpuBuffer,v)},t.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},t.prototype.beginComputePass=function(n){W(this.gpuComputePassEncoder===null),this.frameCommandEncoder=n,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},t.prototype.setPipeline=function(n){var v=n,x=st(v.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(x)},t.prototype.setBindings=function(n){var v=this,x=n;x.gpuBindGroup.forEach(function($,z){$&&v.gpuComputePassEncoder.setBindGroup(z,x.gpuBindGroup[z])})},t.prototype.pushDebugGroup=function(n){this.gpuComputePassEncoder.pushDebugGroup(n)},t.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},t.prototype.insertDebugMarker=function(n){this.gpuComputePassEncoder.insertDebugMarker(n)},t}(),Do=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.ComputePipeline,et.gpuComputePipeline=null,et.descriptor=z;var ht=z.program,mt=ht.computeStage;if(mt===null)return et;var wt={layout:"auto",compute:(0,d.pi)({},mt)};return et.gpuComputePipeline=et.device.device.createComputePipeline(wt),et.name!==void 0&&(et.gpuComputePipeline.label=et.name),et}return n.prototype.getBindGroupLayout=function(v){return this.gpuComputePipeline.getBindGroupLayout(v)},n}(gi),us=function(t){(0,d.ZT)(n,t);function n(v){var x,$,z,et,ht=v.id,mt=v.device,wt=v.descriptor,zt=t.call(this,{id:ht,device:mt})||this;zt.type=h.InputLayout;var Vt=[];try{for(var de=(0,d.XA)(wt.vertexBufferDescriptors),Pe=de.next();!Pe.done;Pe=de.next()){var Qe=Pe.value,un=Qe.arrayStride,fn=Qe.stepMode,xn=Qe.attributes;Vt.push({arrayStride:un,stepMode:Jo(fn),attributes:[]});try{for(var on=(z=void 0,(0,d.XA)(xn)),Vn=on.next();!Vn.done;Vn=on.next()){var Hn=Vn.value,cr=Hn.shaderLocation,pn=Hn.format,Je=Hn.offset;Vt[Vt.length-1].attributes.push({shaderLocation:cr,format:is(pn),offset:Je})}}catch(vn){z={error:vn}}finally{try{Vn&&!Vn.done&&(et=on.return)&&et.call(on)}finally{if(z)throw z.error}}}}catch(vn){x={error:vn}}finally{try{Pe&&!Pe.done&&($=de.return)&&$.call(de)}finally{if(x)throw x.error}}return zt.indexFormat=Aa(wt.indexBufferFormat),zt.buffers=Vt,zt}return n}(gi),Po=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;return et.type=h.Program,et.vertexStage=null,et.fragmentStage=null,et.computeStage=null,et.descriptor=z,z.vertex&&(et.vertexStage=et.createShaderStage(z.vertex,"vertex")),z.fragment&&(et.fragmentStage=et.createShaderStage(z.fragment,"fragment")),z.compute&&(et.computeStage=et.createShaderStage(z.compute,"compute")),et}return n.prototype.setUniformsLegacy=function(v){},n.prototype.createShaderStage=function(v,x){var $,z,et=v.glsl,ht=v.wgsl,mt=v.entryPoint,wt=v.postprocess,zt=!1,Vt=ht;if(!Vt)try{Vt=this.device.glsl_compile(et,x,zt)}catch(xn){throw console.error(xn,et),new Error("whoops")}var de=function(xn){if(!Vt.includes(xn))return"continue";Vt=Vt.replace("var T_".concat(xn,": texture_2d<f32>;"),"var T_".concat(xn,": texture_depth_2d;")),Vt=Vt.replace(new RegExp("textureSample\\(T_".concat(xn,"(.*)\\);$"),"gm"),function(on,Vn){return"vec4<f32>(textureSample(T_".concat(xn).concat(Vn,"), 0.0, 0.0, 0.0);")})};try{for(var Pe=(0,d.XA)(["u_TextureFramebufferDepth"]),Qe=Pe.next();!Qe.done;Qe=Pe.next()){var un=Qe.value;de(un)}}catch(xn){$={error:xn}}finally{try{Qe&&!Qe.done&&(z=Pe.return)&&z.call(Pe)}finally{if($)throw $.error}}wt&&(Vt=wt(Vt));var fn=this.device.device.createShaderModule({code:Vt});return{module:fn,entryPoint:mt||"main"}},n}(gi),Ci=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;et.type=h.QueryPool;var ht=z.elemCount,mt=z.type;return et.querySet=et.device.device.createQuerySet({type:To(mt),count:ht}),et.resolveBuffer=et.device.device.createBuffer({size:ht*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),et.cpuBuffer=et.device.device.createBuffer({size:ht*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),et.results=null,et}return n.prototype.queryResultOcclusion=function(v){return this.results===null?null:this.results[v]!==BigInt(0)},n.prototype.destroy=function(){t.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},n}(gi),xo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=t.call(this,{id:x,device:$})||this;return z.type=h.Readback,z}return n.prototype.readTexture=function(v,x,$,z,et,ht,mt,wt){return mt===void 0&&(mt=0),(0,d.mG)(this,void 0,void 0,function(){var zt,Vt,de,Pe,Qe,un,fn,xn;return(0,d.Jh)(this,function(on){return zt=v,Vt=0,de=ja(zt.gpuTextureformat),Pe=Math.ceil(z/de.width)*de.length,Qe=Math.ceil(Pe/256)*256,un=Qe*et,fn=this.device.createBuffer({usage:R.STORAGE|R.MAP_READ|R.COPY_DST,hint:M.STATIC,viewOrSize:un}),xn=this.device.device.createCommandEncoder(),xn.copyTextureToBuffer({texture:zt.gpuTexture,mipLevel:0,origin:{x,y:$,z:Math.max(Vt,0)}},{buffer:fn.gpuBuffer,offset:0,bytesPerRow:Qe},{width:z,height:et,depthOrArrayLayers:1}),this.device.device.queue.submit([xn.finish()]),[2,this.readBuffer(fn,0,ht.byteLength===un?ht:null,mt,un,zt.format,!0,!1,Pe,Qe,et)]})})},n.prototype.readTextureSync=function(v,x,$,z,et,ht,mt,wt){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},n.prototype.readBuffer=function(v,x,$,z,et,ht,mt,wt,zt,Vt,de){var Pe=this;x===void 0&&(x=0),$===void 0&&($=null),et===void 0&&(et=0),ht===void 0&&(ht=D.U8_RGB),mt===void 0&&(mt=!1),zt===void 0&&(zt=0),Vt===void 0&&(Vt=0),de===void 0&&(de=0);var Qe=v,un=et||Qe.size,fn=$||Qe.view,xn=fn&&fn.constructor&&fn.constructor.BYTES_PER_ELEMENT||ne(ht),on=Qe;if(!(Qe.usage&R.MAP_READ&&Qe.usage&R.COPY_DST)){var Vn=this.device.device.createCommandEncoder();on=this.device.createBuffer({usage:R.STORAGE|R.MAP_READ|R.COPY_DST,hint:M.STATIC,viewOrSize:un}),Vn.copyBufferToBuffer(Qe.gpuBuffer,x,on.gpuBuffer,0,un),this.device.device.queue.submit([Vn.finish()])}return new Promise(function(Hn,cr){on.gpuBuffer.mapAsync(ii.READ,x,un).then(function(){var pn=on.gpuBuffer.getMappedRange(x,un),Je=fn;if(mt)Je===null?Je=za(ht,un,!0,pn):Je=za(ht,Je.buffer,void 0,pn);else if(Je===null)switch(xn){case 1:Je=new Uint8Array(un),Je.set(new Uint8Array(pn));break;case 2:Je=Pe.getHalfFloatAsFloatRGBAArrayBuffer(un/2,pn);break;case 4:Je=new Float32Array(un/4),Je.set(new Float32Array(pn));break}else switch(xn){case 1:Je=new Uint8Array(Je.buffer),Je.set(new Uint8Array(pn));break;case 2:Je=Pe.getHalfFloatAsFloatRGBAArrayBuffer(un/2,pn,fn);break;case 4:var vn=fn&&fn.constructor||Float32Array;Je=new vn(Je.buffer),Je.set(new vn(pn));break}if(zt!==Vt){xn===1&&!mt&&(zt*=2,Vt*=2);for(var Jn=new Uint8Array(Je.buffer),Rr=zt,Ir=0,oi=1;oi<de;++oi){Ir=oi*Vt;for(var bi=0;bi<zt;++bi)Jn[Rr++]=Jn[Ir++]}xn!==0&&!mt?Je=new Float32Array(Jn.buffer,0,Rr/4):Je=new Uint8Array(Jn.buffer,0,Rr)}on.gpuBuffer.unmap(),Hn(Je)},function(pn){return cr(pn)})})},n.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(v,x,$){$||($=new Float32Array(v));for(var z=new Uint16Array(x);v--;)$[v]=os(z[v]);return $},n}(gi),Ea=function(){function t(n){this.device=n,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return t.prototype.getEncoder=function(){var n;return((n=this.renderBundle)===null||n===void 0?void 0:n.renderBundleEncoder)||this.gpuRenderPassEncoder},t.prototype.getTextureView=function(n,v){return W(v<n.mipLevelCount),n.mipLevelCount===1?n.gpuTextureView:n.gpuTexture.createView({baseMipLevel:v,mipLevelCount:1})},t.prototype.setRenderPassDescriptor=function(n){var v,x,$,z,et,ht;this.descriptor=n,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var mt=n.colorAttachment.length;this.gfxColorAttachment.length=mt,this.gfxColorResolveTo.length=mt;for(var wt=0;wt<n.colorAttachment.length;wt++){var zt=n.colorAttachment[wt],Vt=n.colorResolveTo[wt];if(zt===null&&Vt!==null&&(zt=Vt,Vt=null),this.gfxColorAttachment[wt]=zt,this.gfxColorResolveTo[wt]=Vt,this.gfxColorAttachmentLevel[wt]=((v=n.colorAttachmentLevel)===null||v===void 0?void 0:v[wt])||0,this.gfxColorResolveToLevel[wt]=((x=n.colorResolveToLevel)===null||x===void 0?void 0:x[wt])||0,zt!==null){this.gpuColorAttachments[wt]===void 0&&(this.gpuColorAttachments[wt]={});var de=this.gpuColorAttachments[wt];de.view=this.getTextureView(zt,(($=this.gfxColorAttachmentLevel)===null||$===void 0?void 0:$[wt])||0);var Pe=(et=(z=n.colorClearColor)===null||z===void 0?void 0:z[wt])!==null&&et!==void 0?et:"load";Pe==="load"?de.loadOp="load":(de.loadOp="clear",de.clearValue=Pe),de.storeOp=!((ht=n.colorStore)===null||ht===void 0)&&ht[wt]?"store":"discard",de.resolveTarget=void 0,Vt!==null&&(zt.sampleCount>1?de.resolveTarget=this.getTextureView(Vt,this.gfxColorResolveToLevel[wt]):de.storeOp="store")}else{this.gpuColorAttachments.length=wt,this.gfxColorAttachment.length=wt,this.gfxColorResolveTo.length=wt;break}}if(this.gfxDepthStencilAttachment=n.depthStencilAttachment,this.gfxDepthStencilResolveTo=n.depthStencilResolveTo,n.depthStencilAttachment){var Qe=n.depthStencilAttachment,de=this.gpuDepthStencilAttachment;de.view=Qe.gpuTextureView;var un=!!(Rt(Qe.format)&U.Depth);un?(n.depthClearValue==="load"?de.depthLoadOp="load":(de.depthLoadOp="clear",de.depthClearValue=n.depthClearValue),n.depthStencilStore||this.gfxDepthStencilResolveTo!==null?de.depthStoreOp="store":de.depthStoreOp="discard"):(de.depthLoadOp=void 0,de.depthStoreOp=void 0);var fn=!!(Rt(Qe.format)&U.Stencil);fn?(n.stencilClearValue==="load"?de.stencilLoadOp="load":(de.stencilLoadOp="clear",de.stencilClearValue=n.stencilClearValue),n.depthStencilStore||this.gfxDepthStencilResolveTo!==null?de.stencilStoreOp="store":de.stencilStoreOp="discard"):(de.stencilLoadOp=void 0,de.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=u(n.occlusionQueryPool)?void 0:wa(n.occlusionQueryPool)},t.prototype.beginRenderPass=function(n,v){W(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(v),this.frameCommandEncoder=n,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},t.prototype.flipY=function(n,v){var x=this.device.swapChainHeight;return x-n-v},t.prototype.setViewport=function(n,v,x,$,z,et){z===void 0&&(z=0),et===void 0&&(et=1),this.gpuRenderPassEncoder.setViewport(n,this.flipY(v,$),x,$,z,et)},t.prototype.setScissorRect=function(n,v,x,$){this.gpuRenderPassEncoder.setScissorRect(n,this.flipY(v,$),x,$)},t.prototype.setPipeline=function(n){var v=n,x=st(v.gpuRenderPipeline);this.getEncoder().setPipeline(x)},t.prototype.setVertexInput=function(n,v,x){if(n!==null){var $=this.getEncoder(),z=n;x!==null&&$.setIndexBuffer(ro(x.buffer),st(z.indexFormat),x.offset);for(var et=0;et<v.length;et++){var ht=v[et];ht!==null&&$.setVertexBuffer(et,ro(ht.buffer),ht.offset)}}},t.prototype.setBindings=function(n){var v=n,x=this.getEncoder();v.gpuBindGroup.forEach(function($,z){$&&x.setBindGroup(z,v.gpuBindGroup[z])})},t.prototype.setStencilReference=function(n){this.gpuRenderPassEncoder.setStencilReference(n)},t.prototype.draw=function(n,v,x,$){this.getEncoder().draw(n,v,x,$)},t.prototype.drawIndexed=function(n,v,x,$,z){this.getEncoder().drawIndexed(n,v,x,$,z)},t.prototype.drawIndirect=function(n,v){this.getEncoder().drawIndirect(ro(n),v)},t.prototype.drawIndexedIndirect=function(n,v){this.getEncoder().drawIndexedIndirect(ro(n),v)},t.prototype.beginOcclusionQuery=function(n){this.gpuRenderPassEncoder.beginOcclusionQuery(n)},t.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},t.prototype.pushDebugGroup=function(n){this.gpuRenderPassEncoder.pushDebugGroup(n)},t.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},t.prototype.insertDebugMarker=function(n){this.gpuRenderPassEncoder.insertDebugMarker(n)},t.prototype.beginBundle=function(n){this.renderBundle=n},t.prototype.endBundle=function(){this.renderBundle.finish()},t.prototype.executeBundles=function(n){this.gpuRenderPassEncoder.executeBundles(n.map(function(v){return v.renderBundle}))},t.prototype.finish=function(){var n;(n=this.gpuRenderPassEncoder)===null||n===void 0||n.end(),this.gpuRenderPassEncoder=null;for(var v=0;v<this.gfxColorAttachment.length;v++){var x=this.gfxColorAttachment[v],$=this.gfxColorResolveTo[v];x!==null&&$!==null&&x.sampleCount===1&&this.copyAttachment($,this.gfxColorAttachmentLevel[v],x,this.gfxColorResolveToLevel[v])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},t.prototype.copyAttachment=function(n,v,x,$){W(x.sampleCount===1);var z={texture:x.gpuTexture,mipLevel:$},et={texture:n.gpuTexture,mipLevel:v};W(x.width>>>$===n.width>>>v),W(x.height>>>$===n.height>>>v),W(!!(x.usage&vr.COPY_SRC)),W(!!(n.usage&vr.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(z,et,[n.width,n.height,1])},t}(),Va=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=t.call(this,{id:x,device:$})||this;return et.type=h.RenderPipeline,et.isCreatingAsync=!1,et.gpuRenderPipeline=null,et.descriptor=z,et.device.createRenderPipelineInternal(et,!1),et}return n.prototype.getBindGroupLayout=function(v){return this.gpuRenderPipeline.getBindGroupLayout(v)},n}(gi),ka=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et,ht,mt=t.call(this,{id:x,device:$})||this;mt.type=h.Sampler;var wt=z.lodMinClamp,zt=z.mipmapFilter===C.NO_MIP?z.lodMinClamp:z.lodMaxClamp,Vt=(et=z.maxAnisotropy)!==null&&et!==void 0?et:1;return Vt>1&&W(z.minFilter===b.BILINEAR&&z.magFilter===b.BILINEAR&&z.mipmapFilter===C.LINEAR),mt.gpuSampler=mt.device.device.createSampler({addressModeU:Mo(z.addressModeU),addressModeV:Mo(z.addressModeV),addressModeW:Mo((ht=z.addressModeW)!==null&&ht!==void 0?ht:z.addressModeU),lodMinClamp:wt,lodMaxClamp:zt,minFilter:ma(z.minFilter),magFilter:ma(z.magFilter),mipmapFilter:Ma(z.mipmapFilter),compare:z.compareFunction!==void 0?Qo(z.compareFunction):void 0,maxAnisotropy:Vt}),mt}return n}(gi),Uo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=v.descriptor,et=v.skipCreate,ht=v.sampleCount,mt=t.call(this,{id:x,device:$})||this;mt.type=h.Texture,mt.flipY=!1;var wt=z.format,zt=z.dimension,Vt=z.width,de=z.height,Pe=z.depthOrArrayLayers,Qe=z.mipLevelCount,un=z.usage,fn=z.pixelStore;return mt.flipY=!!(fn!=null&&fn.unpackFlipY),mt.device.createTextureShared({format:wt,dimension:zt!=null?zt:N.TEXTURE_2D,width:Vt,height:de,depthOrArrayLayers:Pe!=null?Pe:1,mipLevelCount:Qe!=null?Qe:1,usage:un,sampleCount:ht!=null?ht:1},mt,et),mt}return n.prototype.textureFromImageBitmapOrCanvas=function(v,x,$){for(var z=x[0].width,et=x[0].height,ht={size:{width:z,height:et,depthOrArrayLayers:$},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},mt=v.createTexture(ht),wt=0;wt<x.length;wt++)v.queue.copyExternalImageToTexture({source:x[wt],flipY:this.flipY},{texture:mt,origin:[0,0,wt]},[z,et]);return[mt,z,et]},n.prototype.isImageBitmapOrCanvases=function(v){var x=v[0];return x instanceof ImageBitmap||x instanceof HTMLCanvasElement||x instanceof OffscreenCanvas},n.prototype.isVideo=function(v){var x=v[0];return x instanceof HTMLVideoElement},n.prototype.setImageData=function(v,x){var $,z=this,et=this.device.device,ht,mt,wt;if(this.isImageBitmapOrCanvases(v))$=(0,d.CR)(this.textureFromImageBitmapOrCanvas(et,v,this.depthOrArrayLayers),3),ht=$[0],mt=$[1],wt=$[2];else if(this.isVideo(v))ht=et.importExternalTexture({source:v[0]});else{var zt=ja(this.gpuTextureformat),Vt=Math.ceil(this.width/zt.width)*zt.length;v.forEach(function(de){et.queue.writeTexture({texture:z.gpuTexture},de,{bytesPerRow:Vt},{width:z.width,height:z.height})})}this.width=mt,this.height=wt,ht&&(this.gpuTexture=ht),this.gpuTextureView=this.gpuTexture.createView({dimension:Ba(this.dimension)})},n.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuTexture.destroy()},n}(gi),Zo=function(t){(0,d.ZT)(n,t);function n(v){var x=v.id,$=v.device,z=t.call(this,{id:x,device:$})||this;return z.type=h.RenderBundle,z.renderBundleEncoder=z.device.device.createRenderBundleEncoder({colorFormats:[z.device.swapChainFormat]}),z}return n.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},n}(gi),Ta=function(){function t(n,v,x,$,z,et){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=vr.RENDER_ATTACHMENT|vr.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=L.UPPER_LEFT,this.clipSpaceNearZ=j.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=v,this.canvas=x,this.canvasContext=$,this.glsl_compile=z,this.WGSLComposer=et,this.fallbackTexture2D=this.createFallbackTexture(N.TEXTURE_2D,ut.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(N.TEXTURE_2D,ut.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(N.TEXTURE_2D_ARRAY,ut.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(N.TEXTURE_3D,ut.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(N.TEXTURE_CUBE_MAP,ut.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:E.REPEAT,addressModeV:E.REPEAT,minFilter:b.POINT,magFilter:b.POINT,mipmapFilter:C.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:E.REPEAT,addressModeV:E.REPEAT,minFilter:b.POINT,magFilter:b.POINT,mipmapFilter:C.NEAREST,compareFunction:g.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(ht){console.error(ht.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return t.prototype.destroy=function(){},t.prototype.configureSwapChain=function(n,v){this.swapChainWidth===n&&this.swapChainHeight===v||(this.swapChainWidth=n,this.swapChainHeight=v)},t.prototype.getOnscreenTexture=function(){var n=this.canvasContext.getCurrentTexture(),v=n.createView(),x=new Uo({id:0,device:this,descriptor:{format:D.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:N.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return x.depthOrArrayLayers=1,x.sampleCount=1,x.gpuTexture=n,x.gpuTextureView=v,x.name="Onscreen",this.setResourceName(x,"Onscreen Texture"),x},t.prototype.getDevice=function(){return this},t.prototype.getCanvas=function(){return this.canvas},t.prototype.beginFrame=function(){W(this.frameCommandEncoderPool.length===0)},t.prototype.endFrame=function(){W(this.frameCommandEncoderPool.every(function(n){return n!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(n){return n.finish()})),this.frameCommandEncoderPool=[]},t.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},t.prototype.createBuffer=function(n){return new ss({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createTexture=function(n){return new Uo({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createSampler=function(n){return new ka({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createRenderTarget=function(n){var v=new Uo({id:this.getNextUniqueId(),device:this,descriptor:(0,d.pi)((0,d.pi)({},n),{dimension:N.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Q.RENDER_TARGET}),sampleCount:n.sampleCount});return v.depthOrArrayLayers=1,v.type=h.RenderTarget,v},t.prototype.createRenderTargetFromTexture=function(n){var v=n,x=v.format,$=v.width,z=v.height,et=v.depthOrArrayLayers,ht=v.sampleCount,mt=v.mipLevelCount,wt=v.gpuTexture,zt=v.gpuTextureView,Vt=v.usage;W(!!(Vt&vr.RENDER_ATTACHMENT));var de=new Uo({id:this.getNextUniqueId(),device:this,descriptor:{format:x,width:$,height:z,depthOrArrayLayers:et,dimension:N.TEXTURE_2D,mipLevelCount:mt,usage:Vt},skipCreate:!0});return de.depthOrArrayLayers=et,de.sampleCount=ht,de.gpuTexture=wt,de.gpuTextureView=zt,de},t.prototype.createProgram=function(n){var v,x;return!((v=n.vertex)===null||v===void 0)&&v.glsl&&(n.vertex.glsl=Dt(this.queryVendorInfo(),"vert",n.vertex.glsl)),!((x=n.fragment)===null||x===void 0)&&x.glsl&&(n.fragment.glsl=Dt(this.queryVendorInfo(),"frag",n.fragment.glsl)),new Po({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createProgramSimple=function(n){return new Po({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createTextureShared=function(n,v,x){var $={width:n.width,height:n.height,depthOrArrayLayers:n.depthOrArrayLayers},z=n.mipLevelCount,et=Lo(n.format),ht=va(n.dimension),mt=Go(n.usage);if(v.gpuTextureformat=et,v.dimension=n.dimension,v.format=n.format,v.width=n.width,v.height=n.height,v.depthOrArrayLayers=n.depthOrArrayLayers,v.mipLevelCount=z,v.usage=mt,v.sampleCount=n.sampleCount,!x){var wt=this.device.createTexture({size:$,mipLevelCount:z,format:et,dimension:ht,sampleCount:n.sampleCount,usage:mt}),zt=wt.createView();v.gpuTexture=wt,v.gpuTextureView=zt}},t.prototype.getFallbackSampler=function(n){var v=n.formatKind;return v===ut.Depth&&n.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},t.prototype.getFallbackTexture=function(n){var v=n.dimension,x=n.formatKind;if(v===N.TEXTURE_2D)return x===ut.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(v===N.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(v===N.TEXTURE_3D)return this.fallbackTexture3D;if(v===N.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},t.prototype.createFallbackTexture=function(n,v){var x=n===N.TEXTURE_CUBE_MAP?6:1,$=v===ut.Float?D.U8_RGBA_NORM:D.D24;return this.createTexture({dimension:n,format:$,usage:Q.SAMPLED,width:1,height:1,depthOrArrayLayers:x,mipLevelCount:1})},t.prototype.createBindings=function(n){return new as({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createInputLayout=function(n){return new us({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createComputePipeline=function(n){return new Do({id:this.getNextUniqueId(),device:this,descriptor:n})},t.prototype.createRenderPipeline=function(n){return new Va({id:this.getNextUniqueId(),device:this,descriptor:(0,d.pi)({},n)})},t.prototype.createQueryPool=function(n,v){return new Ci({id:this.getNextUniqueId(),device:this,descriptor:{type:n,elemCount:v}})},t.prototype.createRenderPipelineInternal=function(n,v){var x;if(n.gpuRenderPipeline===null){var $=n.descriptor,z=$.program,et=z.vertexStage,ht=z.fragmentStage;if(!(et===null||ht===null)){var mt=$.megaStateDescriptor||{},wt=mt.stencilBack,zt=mt.stencilFront,Vt=(0,d._T)(mt,["stencilBack","stencilFront"]),de=Cn(Qn);$.megaStateDescriptor=(0,d.pi)((0,d.pi)((0,d.pi)({},de),{stencilBack:(0,d.pi)((0,d.pi)({},de.stencilBack),wt),stencilFront:(0,d.pi)((0,d.pi)({},de.stencilFront),zt)}),Vt);var Pe=$.megaStateDescriptor.attachmentsState[0];$.colorAttachmentFormats.forEach(function(Hn,cr){$.megaStateDescriptor.attachmentsState[cr]||($.megaStateDescriptor.attachmentsState[cr]=Rn(void 0,Pe))});var Qe=_a((x=$.topology)!==null&&x!==void 0?x:X.TRIANGLES,$.megaStateDescriptor),un=ya($.colorAttachmentFormats,$.megaStateDescriptor),fn=wo($.depthStencilAttachmentFormat,$.megaStateDescriptor),xn=void 0;$.inputLayout!==null&&(xn=$.inputLayout.buffers);var on=$.sampleCount,Vn={layout:"auto",vertex:(0,d.pi)((0,d.pi)({},et),{buffers:xn}),primitive:Qe,depthStencil:fn,multisample:{count:on},fragment:(0,d.pi)((0,d.pi)({},ht),{targets:un})};n.gpuRenderPipeline=this.device.createRenderPipeline(Vn)}}},t.prototype.createReadback=function(){return new xo({id:this.getNextUniqueId(),device:this})},t.prototype.createRenderBundle=function(){return new Zo({id:this.getNextUniqueId(),device:this})},t.prototype.createRenderPass=function(n){var v=this.renderPassPool.pop();v===void 0&&(v=new Ea(this));var x=this.frameCommandEncoderPool.pop();return x===void 0&&(x=this.device.createCommandEncoder()),v.beginRenderPass(x,n),v},t.prototype.createComputePass=function(){var n=this.computePassPool.pop();n===void 0&&(n=new Ko);var v=this.frameCommandEncoderPool.pop();return v===void 0&&(v=this.device.createCommandEncoder()),n.beginComputePass(v),n},t.prototype.submitPass=function(n){var v=n;v instanceof Ea?(this.frameCommandEncoderPool.push(v.frameCommandEncoder),v.finish(),this.renderPassPool.push(v)):v instanceof Ko&&(this.frameCommandEncoderPool.push(v.frameCommandEncoder),v.finish(),this.computePassPool.push(v))},t.prototype.copySubTexture2D=function(n,v,x,$,z,et,ht){var mt=this.device.createCommandEncoder(),wt=n,zt=$,Vt={texture:zt.gpuTexture,origin:[z,et,0],mipLevel:0,aspect:"all"},de={texture:wt.gpuTexture,origin:[v,x,0],mipLevel:0,aspect:"all"};W(!!(zt.usage&vr.COPY_SRC)),W(!!(wt.usage&vr.COPY_DST)),mt.copyTextureToTexture(Vt,de,[zt.width,zt.height,ht||1]),this.device.queue.submit([mt.finish()])},t.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},t.prototype.queryTextureFormatSupported=function(n,v,x){if(_o(n)){if(!this.featureTextureCompressionBC)return!1;var $=Za(n);return v%$!==0||x%$!==0?!1:this.featureTextureCompressionBC}switch(n){case D.U16_RGBA_NORM:return!1;case D.F32_RGBA:return!1}return!0},t.prototype.queryPlatformAvailable=function(){return!0},t.prototype.queryVendorInfo=function(){return this},t.prototype.queryRenderPass=function(n){var v=n;return v.descriptor},t.prototype.queryRenderTarget=function(n){var v=n;return v},t.prototype.setResourceName=function(n,v){if(n.name=v,n.type===h.Buffer){var x=n;x.gpuBuffer.label=v}else if(n.type===h.Texture){var x=n;x.gpuTexture.label=v,x.gpuTextureView.label=v}else if(n.type===h.RenderTarget){var x=n;x.gpuTexture.label=v,x.gpuTextureView.label=v}else if(n.type===h.Sampler){var x=n;x.gpuSampler.label=v}else if(n.type===h.RenderPipeline){var x=n;x.gpuRenderPipeline!==null&&(x.gpuRenderPipeline.label=v)}},t.prototype.setResourceLeakCheck=function(n,v){},t.prototype.checkForLeaks=function(){},t.prototype.programPatched=function(n){},t.prototype.pipelineQueryReady=function(n){var v=n;return v.gpuRenderPipeline!==null},t.prototype.pipelineForceReady=function(n){var v=n;this.createRenderPipelineInternal(v,!1)},t}(),Xa=function(){function t(n){this.pluginOptions=n}return t.prototype.createSwapChain=function(n){return(0,d.mG)(this,void 0,void 0,function(){var v,x,$,z,et,ht,mt,wt;return(0,d.Jh)(this,function(zt){switch(zt.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];v=null,zt.label=1;case 1:return zt.trys.push([1,3,,4]),x=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:x})];case 2:return v=zt.sent(),[3,4];case 3:return $=zt.sent(),console.log($),[3,4];case 4:return v===null?[2,null]:(z=["depth32float-stencil8","texture-compression-bc","float32-filterable"],et=z.filter(function(Vt){return v.features.has(Vt)}),[4,v.requestDevice({requiredFeatures:et})]);case 5:if(ht=zt.sent(),ht&&(mt=this.pluginOptions.onContextLost,ht.lost.then(function(){mt&&mt()})),ht===null)return[2,null];if(wt=n.getContext("webgpu"),!wt)return[2,null];zt.label=6;case 6:return zt.trys.push([6,8,,9]),[4,Eo(this.pluginOptions.shaderCompilerPath)];case 7:return zt.sent(),[3,9];case 8:return zt.sent(),[3,9];case 9:return[2,new Ta(v,ht,n,wt,es,Ao&&new Ao)]}})})},t}()},90857:Xt=>{"use strict";var K=Object.prototype.hasOwnProperty,e="~";function u(){}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(e=!1));function i(m,l,r){this.fn=m,this.context=l,this.once=r||!1}function a(m,l,r,h,g){if(typeof r!="function")throw new TypeError("The listener must be a function");var A=new i(r,h||m,g),o=e?e+l:l;return m._events[o]?m._events[o].fn?m._events[o]=[m._events[o],A]:m._events[o].push(A):(m._events[o]=A,m._eventsCount++),m}function c(m,l){--m._eventsCount===0?m._events=new u:delete m._events[l]}function d(){this._events=new u,this._eventsCount=0}d.prototype.eventNames=function(){var l=[],r,h;if(this._eventsCount===0)return l;for(h in r=this._events)K.call(r,h)&&l.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(r)):l},d.prototype.listeners=function(l){var r=e?e+l:l,h=this._events[r];if(!h)return[];if(h.fn)return[h.fn];for(var g=0,A=h.length,o=new Array(A);g<A;g++)o[g]=h[g].fn;return o},d.prototype.listenerCount=function(l){var r=e?e+l:l,h=this._events[r];return h?h.fn?1:h.length:0},d.prototype.emit=function(l,r,h,g,A,o){var S=e?e+l:l;if(!this._events[S])return!1;var T=this._events[S],E=arguments.length,b,C;if(T.fn){switch(T.once&&this.removeListener(l,T.fn,void 0,!0),E){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,r),!0;case 3:return T.fn.call(T.context,r,h),!0;case 4:return T.fn.call(T.context,r,h,g),!0;case 5:return T.fn.call(T.context,r,h,g,A),!0;case 6:return T.fn.call(T.context,r,h,g,A,o),!0}for(C=1,b=new Array(E-1);C<E;C++)b[C-1]=arguments[C];T.fn.apply(T.context,b)}else{var X=T.length,R;for(C=0;C<X;C++)switch(T[C].once&&this.removeListener(l,T[C].fn,void 0,!0),E){case 1:T[C].fn.call(T[C].context);break;case 2:T[C].fn.call(T[C].context,r);break;case 3:T[C].fn.call(T[C].context,r,h);break;case 4:T[C].fn.call(T[C].context,r,h,g);break;default:if(!b)for(R=1,b=new Array(E-1);R<E;R++)b[R-1]=arguments[R];T[C].fn.apply(T[C].context,b)}}return!0},d.prototype.on=function(l,r,h){return a(this,l,r,h,!1)},d.prototype.once=function(l,r,h){return a(this,l,r,h,!0)},d.prototype.removeListener=function(l,r,h,g){var A=e?e+l:l;if(!this._events[A])return this;if(!r)return c(this,A),this;var o=this._events[A];if(o.fn)o.fn===r&&(!g||o.once)&&(!h||o.context===h)&&c(this,A);else{for(var S=0,T=[],E=o.length;S<E;S++)(o[S].fn!==r||g&&!o[S].once||h&&o[S].context!==h)&&T.push(o[S]);T.length?this._events[A]=T.length===1?T[0]:T:c(this,A)}return this},d.prototype.removeAllListeners=function(l){var r;return l?(r=e?e+l:l,this._events[r]&&c(this,r)):(this._events=new u,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,Xt.exports=d},4157:()=>{window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Xt){try{let h=function(){d||(d=!0,a())},g=function(){try{c.documentElement.doScroll("left")}catch(A){return void setTimeout(g,50)}h()};var l=h,r=g,e=(e=document.getElementsByTagName("script"))[e.length-1],K=e.getAttribute("data-injectcss"),e=e.getAttribute("data-disable-injectsvg");if(!e){var u,i,a,c,d,m=function(A,o){o.parentNode.insertBefore(A,o)};if(K&&!Xt.__iconfont__svg__cssinject__){Xt.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(A){console&&console.log(A)}}u=function(){var A,o=document.createElement("div");o.innerHTML=Xt._iconfont_svg_string_3580659,(o=o.getElementsByTagName("svg")[0])&&(o.setAttribute("aria-hidden","true"),o.style.position="absolute",o.style.width=0,o.style.height=0,o.style.overflow="hidden",o=o,(A=document.body).firstChild?m(o,A.firstChild):A.appendChild(o))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(u,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),u()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(a=u,c=Xt.document,d=!1,g(),c.onreadystatechange=function(){c.readyState=="complete"&&(c.onreadystatechange=null,h())})}}catch(h){}}(window)},92078:(Xt,K,e)=>{"use strict";e.d(K,{NA:()=>T,oT:()=>S,dk:()=>rt,iT:()=>ut,v3:()=>L,Kh:()=>re,F9:()=>O,TR:()=>B,Yq:()=>U,Jx:()=>m,u7:()=>g,A8:()=>V,p4:()=>C,GI:()=>kt,d:()=>o.d,Ci:()=>D,Yw:()=>R,oF:()=>J,LG:()=>Rt});var u=e(1413),i=e(4942),a=e(64939),c=e(26729),d=e.n(c);class m extends c.EventEmitter{getMarkerLayerContainerSize(){}constructor(p){super(),(0,i.Z)(this,"markerOption",void 0),(0,i.Z)(this,"popup",void 0),(0,i.Z)(this,"mapsService",void 0),(0,i.Z)(this,"lngLat",void 0),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"added",!1),(0,i.Z)(this,"preLngLat",{lng:0,lat:0}),(0,i.Z)(this,"onMarkerDragStart",w=>{const W=this.mapsService.getContainer();if(!W)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:st,top:Tt}=W.getClientRects()[0],{x:Gt,y:ze}=w;this.preLngLat=this.mapsService.containerToLngLat([Gt-st,ze-Tt]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),(0,i.Z)(this,"onMarkerDragMove",w=>{const W=w.lngLat||w.lnglat,{lng:st,lat:Tt}=this.preLngLat,{lng:Gt,lat:ze}=W,$e={lng:this.lngLat.lng+Gt-st,lat:this.lngLat.lat+ze-Tt};this.setLnglat($e),this.preLngLat=W,this.emit("dragging",$e)}),(0,i.Z)(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),(0,i.Z)(this,"eventHandle",w=>{this.polyfillEvent(w),this.emit(w.type,{target:w,data:this.markerOption.extData,lngLat:this.lngLat})}),(0,i.Z)(this,"touchStartTime",void 0),this.markerOption=(0,u.Z)((0,u.Z)({},this.getDefault()),p),(0,a.Ev)(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:a.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}addTo(p){this.scene=p,this.mapsService=p.mapService;const{element:w}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(w),this.registerMarkerEvent(w),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:p}=this.markerOption;return p&&a.SO.remove(p),this.popup&&this.popup.remove(),this}setLnglat(p){return this.lngLat=p,Array.isArray(p)&&(this.lngLat={lng:p[0],lat:p[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(p){if(!this.added)return this.once("added",()=>{this.setElement(p)}),this;const{element:w}=this.markerOption;return w&&a.SO.remove(w),this.markerOption.element=p,this.init(),this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const p=this.popup;return p?(p.isOpen()||p.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const p=this.popup;return p&&p.remove(),this}setPopup(p){return this.popup=p,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const p=this.popup;if(p)p.isOpen()?p.remove():p.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(p){this.markerOption.draggable=p,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(p){this.markerOption.extData=p}update(){if(!this.mapsService)return;const{element:p,anchor:w}=this.markerOption;this.updatePosition(),a.SO.setTransform(p,`${a.rQ[w]}`)}updatePositionWhenZoom(p){if(!this.mapsService)return;const{element:w,offsets:W}=this.markerOption,{lng:st,lat:Tt}=this.lngLat;if(w){w.style.display="block",w.style.whiteSpace="nowrap";const{containerHeight:Gt,containerWidth:ze,bounds:$e}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!$e)return;const rn=p.map,gn=p.center,nt=p.zoom,Ln=rn.DE(this.lngLat,nt,gn);if(Ln.x=Math.round(Ln.x+W[0]),Ln.y=Math.round(Ln.y-W[1]),Math.abs($e[0][0])>180||Math.abs($e[1][0])>180){if(Ln.x>ze){const rr=this.mapsService.lngLatToContainer([st-360,Tt]);Ln.x=rr.x}if(Ln.x<0){const rr=this.mapsService.lngLatToContainer([st+360,Tt]);Ln.x=rr.x}}(Ln.x>ze||Ln.x<0||Ln.y>Gt||Ln.y<0)&&(w.style.display="none"),w.style.left=Ln.x+"px",w.style.top=Ln.y+"px",w.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(p){const{element:w}=this.markerOption;this.popup&&w&&this.togglePopup()}getCurrentContainerSize(){const p=this.mapsService.getContainer();return{containerHeight:(p==null?void 0:p.scrollHeight)||0,containerWidth:(p==null?void 0:p.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:p}=this.markerOption;p==null||p.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(p==null||p.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:p,offsets:w}=this.markerOption,{lng:W,lat:st}=this.lngLat,Tt=this.mapsService.lngLatToContainer([W,st]);if(p){p.style.display="block",p.style.whiteSpace="nowrap";const{containerHeight:Gt,containerWidth:ze,bounds:$e}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!$e)return;if(Math.abs($e[0][0])>180||Math.abs($e[1][0])>180){if(Tt.x>ze){const rn=this.mapsService.lngLatToContainer([W-360,st]);Tt.x=rn.x}if(Tt.x<0){const rn=this.mapsService.lngLatToContainer([W+360,st]);Tt.x=rn.x}}this.markerOption.overflowHide&&(Tt.x>ze||Tt.x<0||Tt.y>Gt||Tt.y<0)&&(p.style.display="none"),p.style.left=Tt.x+w[0]+"px",p.style.top=Tt.y-w[1]+"px"}}init(){let{element:p}=this.markerOption;const{color:w,anchor:W}=this.markerOption;if(!p){p=a.SO.create("div"),this.markerOption.element=p;const st=document.createElementNS("http://www.w3.org/2000/svg","svg");st.setAttributeNS(null,"display","block"),st.setAttributeNS(null,"height","48px"),st.setAttributeNS(null,"width","48px"),st.setAttributeNS(null,"viewBox","0 0 1024 1024");const Tt=document.createElementNS("http://www.w3.org/2000/svg","path");Tt.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),Tt.setAttributeNS(null,"fill",w),st.appendChild(Tt),p.appendChild(st)}a.SO.addClass(p,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(st=>{var Tt,Gt;const ze=((Tt=this.markerOption)===null||Tt===void 0?void 0:Tt.style)&&((Gt=this.markerOption)===null||Gt===void 0?void 0:Gt.style[st]);p&&(p.style[st]=ze)}),(0,a.zi)(p,W,"marker")}registerMarkerEvent(p){p.addEventListener("click",this.onMapClick),p.addEventListener("mousemove",this.eventHandle),p.addEventListener("click",this.eventHandle),p.addEventListener("mousedown",this.eventHandle),p.addEventListener("mouseup",this.eventHandle),p.addEventListener("dblclick",this.eventHandle),p.addEventListener("contextmenu",this.eventHandle),p.addEventListener("mouseover",this.eventHandle),p.addEventListener("mouseout",this.eventHandle),p.addEventListener("touchstart",this.eventHandle),p.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const p=this.getElement();p.removeEventListener("click",this.onMapClick),p.removeEventListener("mousemove",this.eventHandle),p.removeEventListener("click",this.eventHandle),p.removeEventListener("mousedown",this.eventHandle),p.removeEventListener("mouseup",this.eventHandle),p.removeEventListener("dblclick",this.eventHandle),p.removeEventListener("contextmenu",this.eventHandle),p.removeEventListener("mouseover",this.eventHandle),p.removeEventListener("mouseout",this.eventHandle),p.removeEventListener("touchstart",this.eventHandle),p.removeEventListener("touchend",this.eventHandle)}polyfillEvent(p){!this.mapsService||this.mapsService.getType()!=="amap"||(0,a.Ro)()||(p.type==="touchstart"&&(this.touchStartTime=Date.now()),p.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:p,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(p){return null}onUp(p){throw new Error("Method not implemented.")}}var l=e(69848),r=e.n(l);const{merge:h}=a.lodashUtil;class g extends c.EventEmitter{constructor(p){var w;super(),(0,i.Z)(this,"markers",[]),(0,i.Z)(this,"markerLayerOption",void 0),(0,i.Z)(this,"clusterIndex",void 0),(0,i.Z)(this,"points",[]),(0,i.Z)(this,"clusterMarkers",[]),(0,i.Z)(this,"mapsService",void 0),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"zoom",void 0),(0,i.Z)(this,"bbox",void 0),(0,i.Z)(this,"inited",void 0),(0,i.Z)(this,"containerSize",void 0),this.markerLayerOption=h(this.getDefault(),p),(0,a.Ev)(["update"],this),this.zoom=((w=this.markerLayerOption.clusterOption)===null||w===void 0?void 0:w.zoom)||-99}getDefault(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}addTo(p){return this.scene=p,this.mapsService=p.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}setContainerSize(){if(!this.mapsService)return;const p=this.mapsService.getContainer();this.containerSize={containerWidth:(p==null?void 0:p.scrollWidth)||0,containerHeight:(p==null?void 0:p.scrollHeight)||0,bounds:this.mapsService.getBounds()}}getContainerSize(){return this.containerSize}addMarker(p){const w=this.markerLayerOption.cluster;if(p.getMarkerLayerContainerSize=this.getContainerSize.bind(this),w&&(this.addPoint(p,this.markers.length),this.mapsService)){const W=this.mapsService.getZoom(),st=this.mapsService.getBounds();this.bbox=(0,a.yA)(st,.5),this.zoom=Math.floor(W),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(p)}removeMarker(p){this.markers.indexOf(p);const w=this.markers.indexOf(p);w>-1&&(this.markers.splice(w,1),this.markerLayerOption.cluster&&(this.removePoint(w),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}hide(){this.markers.map(p=>{p.getElement().style.opacity="0"}),this.clusterMarkers.map(p=>{p.getElement().style.opacity="0"})}show(){this.markers.map(p=>{p.getElement().style.opacity="1"}),this.clusterMarkers.map(p=>{p.getElement().style.opacity="1"})}getMarkers(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}getOriginMarkers(){return this.markers}addMarkers(){this.getMarkers().forEach(p=>{p.addTo(this.scene)})}clear(){this.markers.forEach(p=>{p.remove()}),this.clusterMarkers.forEach(p=>{p.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}destroy(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}addPoint(p,w){const{lng:W,lat:st}=p.getLnglat(),Tt={geometry:{type:"Point",coordinates:[W,st]},properties:(0,u.Z)((0,u.Z)({},p.getExtData()),{},{marker_id:w})};this.points.push(Tt),this.clusterIndex&&this.clusterIndex.load(this.points)}removePoint(p){const w=this.points.findIndex(W=>W.properties.marker_id===p);w>-1&&this.points.splice(w,1),this.clusterIndex&&this.clusterIndex.load(this.points)}initCluster(){if(!this.markerLayerOption.cluster)return;const{radius:p,minZoom:w=0,maxZoom:W}=this.markerLayerOption.clusterOption;this.clusterIndex=new(r())({radius:p,minZoom:w,maxZoom:W}),this.clusterIndex.load(this.points)}getClusterMarker(p,w){const W=p[0].concat(p[1]),st=this.clusterIndex.getClusters(W,w);this.clusterMarkers.forEach(Tt=>{Tt.remove()}),this.clusterMarkers=[],st.forEach(Tt=>{var Gt;const{field:ze,method:$e}=this.markerLayerOption.clusterOption;if((Gt=Tt.properties)!==null&&Gt!==void 0&&Gt.cluster_id){var rn;const nt=this.getLeaves((rn=Tt.properties)===null||rn===void 0?void 0:rn.cluster_id);if(Tt.properties.clusterData=nt,ze&&$e){const Ln=nt==null?void 0:nt.map(Br=>({[ze]:Br.properties[ze]})),rr=a.a5.getColumn(Ln,ze),tr=a.a5.getSatByColumn($e,rr),sr="point_"+$e;Tt.properties[sr]=tr.toFixed(2)}}const gn=this.clusterMarker(Tt);this.clusterMarkers.push(gn),gn.addTo(this.scene)})}getLeaves(p,w=1/0,W=0){return p?this.clusterIndex.getLeaves(p,w,W):null}clusterMarker(p){const w=this.markerLayerOption.clusterOption,{element:W=this.generateElement.bind(this)}=w;return new m({element:W(p)}).setLnglat({lng:p.geometry.coordinates[0],lat:p.geometry.coordinates[1]})}normalMarker(p){const w=p.properties.marker_id;return this.markers[w]}update(){if(!this.mapsService||this.markers.length===0)return;const p=this.mapsService.getZoom(),w=this.mapsService.getBounds();(!this.bbox||Math.abs(p-this.zoom)>=1||!(0,a.oO)(this.bbox,w))&&(this.bbox=(0,a.yA)(w,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom))}generateElement(p){const w=a.SO.create("div","l7-marker-cluster"),W=a.SO.create("div","",w),st=a.SO.create("span","",W),{field:Tt,method:Gt}=this.markerLayerOption.clusterOption;p.properties.point_count=p.properties.point_count||1;const ze=Tt&&Gt?p.properties["point_"+Gt]||p.properties[Tt]:p.properties.point_count;return st.textContent=ze,w}}var A=e(4157),o=e(71590);class S extends d(){constructor(p){super(),(0,i.Z)(this,"controlOption",void 0),(0,i.Z)(this,"container",void 0),(0,i.Z)(this,"isShow",void 0),(0,i.Z)(this,"sceneContainer",void 0),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"mapsService",void 0),(0,i.Z)(this,"renderService",void 0),(0,i.Z)(this,"layerService",void 0),(0,i.Z)(this,"controlService",void 0),(0,i.Z)(this,"configService",void 0),S.controlCount++,this.controlOption=(0,u.Z)((0,u.Z)({},this.getDefault(p)),p||{})}getOptions(){return this.controlOption}setOptions(p){const w=this.getDefault(p);Object.entries(p).forEach(([W,st])=>{st===void 0&&(p[W]=w[W])}),"position"in p&&this.setPosition(p.position),"className"in p&&this.setClassName(p.className),"style"in p&&this.setStyle(p.style),this.controlOption=(0,u.Z)((0,u.Z)({},this.controlOption),p)}addTo(p){this.mapsService=p.mapService,this.renderService=p.rendererService,this.layerService=p.layerService,this.controlService=p.controlService,this.configService=p.globalConfigService,this.scene=p.sceneService,this.sceneContainer=p,this.isShow=!0,this.container=this.onAdd(),a.SO.addClass(this.container,"l7-control");const{className:w,style:W}=this.controlOption;return w&&this.setClassName(w),W&&this.setStyle(W),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;a.SO.remove(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return a.SO.create("div")}onRemove(){}show(){const p=this.container;a.SO.removeClass(p,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const p=this.container;a.SO.addClass(p,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(p){return{position:o.d.TOPRIGHT,name:`${S.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(p){if(this.mapsService&&p&&p.screenX>0&&p.screenY>0){const w=this.mapsService.getContainer();w!==null&&w.focus()}}setPosition(p=o.d.TOPLEFT){const w=this.controlService;return w&&w.removeControl(this),this.controlOption.position=p,w&&w.addControl(this,this.sceneContainer),this}setClassName(p){const w=this.container,{className:W}=this.controlOption;W&&a.SO.removeClass(w,W),p&&a.SO.addClass(w,p)}setStyle(p){const w=this.container;p?w.setAttribute("style",p):w.removeAttribute("style")}insertContainer(){const p=this.controlOption.position,w=this.container;if(p instanceof Element)p.appendChild(w);else{const W=this.controlService.controlCorners[p];["bottomleft","bottomright","righttop","rightbottom"].includes(p)?W.insertBefore(w,W.firstChild):W.appendChild(w)}}checkUpdateOption(p,w){return w.some(W=>W in p)}}(0,i.Z)(S,"controlCount",0);class T extends S{constructor(...p){super(...p),(0,i.Z)(this,"isDisable",!1),(0,i.Z)(this,"button",void 0),(0,i.Z)(this,"buttonText",void 0),(0,i.Z)(this,"buttonIcon",void 0)}setIsDisable(p){if(this.isDisable=p,p){var w;(w=this.button)===null||w===void 0||w.setAttribute("disabled","true")}else{var W;(W=this.button)===null||W===void 0||W.removeAttribute("disabled")}}createButton(p=""){return a.SO.create("button",`l7-button-control ${p}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:p,btnText:w,btnIcon:W}=this.controlOption;return this.setBtnTitle(p),this.setBtnText(w),this.setBtnIcon(W),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(p){const{title:w,btnText:W,btnIcon:st}=p;this.checkUpdateOption(p,["title"])&&this.setBtnTitle(w),this.checkUpdateOption(p,["btnIcon"])&&this.setBtnIcon(st),this.checkUpdateOption(p,["btnText"])&&this.setBtnText(W),super.setOptions(p)}setBtnTitle(p){var w;(w=this.button)===null||w===void 0||w.setAttribute("title",p!=null?p:"")}setBtnIcon(p){if(this.buttonIcon&&a.SO.remove(this.buttonIcon),p){var w;const Tt=(w=this.button)===null||w===void 0?void 0:w.firstChild;if(Tt){var W;(W=this.button)===null||W===void 0||W.insertBefore(p,Tt)}else{var st;(st=this.button)===null||st===void 0||st.appendChild(p)}this.buttonIcon=p}}setBtnText(p){if(this.button)if(a.SO.removeClass(this.button,"l7-button-control--row"),a.SO.removeClass(this.button,"l7-button-control--column"),p){let W=this.buttonText;if(!W){var w;W=a.SO.create("div","l7-button-control__text"),(w=this.button)===null||w===void 0||w.appendChild(W),this.buttonText=W}W.innerText=p,a.SO.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!p&&this.buttonText&&(a.SO.remove(this.buttonText),this.buttonText=void 0)}}class E extends c.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(p,w){super(),(0,i.Z)(this,"popperDOM",void 0),(0,i.Z)(this,"contentDOM",void 0),(0,i.Z)(this,"button",void 0),(0,i.Z)(this,"option",void 0),(0,i.Z)(this,"isShow",!1),(0,i.Z)(this,"content",void 0),(0,i.Z)(this,"timeout",null),(0,i.Z)(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),a.SO.removeClass(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&E.conflictPopperList.forEach(W=>{W!==this&&W.isShow&&W.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),(0,i.Z)(this,"hide",()=>this.isShow?(a.SO.addClass(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),(0,i.Z)(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),(0,i.Z)(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),(0,i.Z)(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),(0,i.Z)(this,"onPopperUnClick",W=>{a.SO.findParentElement(W.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),(0,i.Z)(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),(0,i.Z)(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=p,this.option=w,this.init(),w.unique&&E.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(p){typeof p=="string"?this.contentDOM.innerHTML=p:p instanceof HTMLElement&&(a.SO.clearChildren(this.contentDOM),this.contentDOM.appendChild(p)),this.content=p}init(){const{trigger:p}=this.option;this.popperDOM=this.createPopper(),p==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),a.SO.remove(this.popperDOM)}resetPopperPosition(){const p={},{container:w,offset:W=[0,0],placement:st}=this.option,[Tt,Gt]=W,ze=this.button.getBoundingClientRect(),$e=w.getBoundingClientRect(),{left:rn,right:gn,top:nt,bottom:Ln}=a.SO.getDiffRect(ze,$e);let rr=!1,tr=!1;/^(left|right)/.test(st)?(st.includes("left")?p.right=`${ze.width+gn}px`:st.includes("right")&&(p.left=`${ze.width+rn}px`),st.includes("start")?p.top=`${nt}px`:st.includes("end")?p.bottom=`${Ln}px`:(p.top=`${nt+ze.height/2}px`,tr=!0,p.transform=`translate(${Tt}px, calc(${Gt}px - 50%))`)):/^(top|bottom)/.test(st)&&(st.includes("top")?p.bottom=`${ze.height+Ln}px`:st.includes("bottom")&&(p.top=`${ze.height+nt}px`),st.includes("start")?p.left=`${rn}px`:st.includes("end")?p.right=`${gn}px`:(p.left=`${rn+ze.width/2}px`,rr=!0,p.transform=`translate(calc(${Tt}px - 50%), ${Gt}px)`)),p.transform=`translate(calc(${Tt}px - ${rr?"50%":"0%"}), calc(${Gt}px - ${tr?"50%":"0%"})`;const sr=st.split("-");sr.length&&a.SO.addClass(this.popperDOM,sr.map(Br=>`l7-popper-${Br}`).join(" ")),a.SO.addStyle(this.popperDOM,a.SO.css2Style(p))}createPopper(){const{container:p,className:w="",content:W}=this.option,st=a.SO.create("div",`l7-popper l7-popper-hide ${w}`),Tt=a.SO.create("div","l7-popper-content"),Gt=a.SO.create("div","l7-popper-arrow");return st.appendChild(Tt),st.appendChild(Gt),p.appendChild(st),this.popperDOM=st,this.contentDOM=Tt,W&&this.setContent(W),st}}(0,i.Z)(E,"conflictPopperList",[]);const b={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"};class C extends T{constructor(...p){super(...p),(0,i.Z)(this,"popper",void 0)}getPopper(){return this.popper}hide(){this.popper.hide(),super.hide()}getDefault(p){var w;const W=super.getDefault(p),st=(w=p==null?void 0:p.position)!==null&&w!==void 0?w:W.position;return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{popperPlacement:st instanceof Element?"bottom":b[st],popperTrigger:"click"})}onAdd(){const p=super.onAdd();return this.initPopper(),p}onRemove(){this.popper.destroy()}initPopper(){const{popperClassName:p,popperPlacement:w,popperTrigger:W}=this.controlOption,st=this.mapsService.getMapContainer();return this.popper=new E(this.button,{className:p,placement:w,trigger:W,container:st,unique:!0}),this.popper.on("show",()=>{this.emit("popperShow",this)}).on("hide",()=>{this.emit("popperHide",this)}),this.popper}setOptions(p){if(super.setOptions(p),this.checkUpdateOption(p,["popperPlacement","popperTrigger","popperClassName"])){const w=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(w)}}}var X=function(Nt){return Nt.ActiveOptionClassName="l7-select-control-item-active",Nt.OptionValueAttrKey="data-option-value",Nt.OptionIndexAttrKey="data-option-index",Nt}(X||{});class R extends C{constructor(...p){super(...p),(0,i.Z)(this,"selectValue",[]),(0,i.Z)(this,"optionDOMList",void 0),(0,i.Z)(this,"createNormalOption",w=>{const W=this.selectValue.includes(w.value),st=a.SO.create("div",`l7-select-control-item ${W?X.ActiveOptionClassName:""}`);this.getIsMultiple()?st.appendChild(this.createCheckbox(W)):st.appendChild(this.createRadio(W)),w.icon&&st.appendChild(w.icon);const Tt=a.SO.create("span");return Tt.innerText=w.text,st.appendChild(Tt),st}),(0,i.Z)(this,"onItemClick",w=>{if(this.getIsMultiple()){const W=this.selectValue.findIndex(st=>st===w.value);W>-1?this.selectValue.splice(W,1):this.selectValue=[...this.selectValue,w.value]}else this.selectValue=[w.value];this.setSelectValue(this.selectValue)})}setOptions(p){super.setOptions(p);const{options:w}=p;w&&this.popper.setContent(this.getPopperContent(w))}onAdd(){const p=super.onAdd(),{defaultValue:w}=this.controlOption;return w&&(this.selectValue=this.transSelectValue(w)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),p}getSelectValue(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}setSelectValue(p,w=!0){const W=this.transSelectValue(p);this.optionDOMList.forEach(st=>{const Tt=st.getAttribute(X.OptionValueAttrKey),Gt=st.querySelector("input[type=checkbox]"),ze=st.querySelector("input[type=radio]"),$e=W.includes(Tt),rn=(gn,nt)=>{a.SO.toggleClass(st,X.ActiveOptionClassName,nt),gn&&a.SO.setChecked(gn,nt)};rn(Gt,$e),rn(ze,$e)}),this.selectValue=W,w&&this.emit("selectChange",this.getIsMultiple()?W:W[0])}getIsMultiple(){return!1}getPopperContent(p){const w=this.isImageOptions(),W=a.SO.create("div",w?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&a.SO.addClass(W,"l7-select-control--multiple");const st=p.map((Tt,Gt)=>{const ze=w?this.createImageOption(Tt):this.createNormalOption(Tt);return ze.setAttribute(X.OptionValueAttrKey,Tt.value),ze.setAttribute(X.OptionIndexAttrKey,window.String(Gt)),ze.addEventListener("click",this.onItemClick.bind(this,Tt)),ze});return W.append(...st),this.optionDOMList=st,W}createImageOption(p){const w=this.selectValue.includes(p.value),W=a.SO.create("div",`l7-select-control-item ${w?X.ActiveOptionClassName:""}`),st=a.SO.create("img");st.setAttribute("src",p.img),a.SO.setUnDraggable(st),W.appendChild(st);const Tt=a.SO.create("div","l7-select-control-item-row");this.getIsMultiple()&&W.appendChild(this.createCheckbox(w));const Gt=a.SO.create("span");return Gt.innerText=p.text,Tt.appendChild(Gt),W.appendChild(Tt),W}createCheckbox(p){const w=a.SO.create("input");return w.setAttribute("type","checkbox"),p&&a.SO.setChecked(w,!0),w}createRadio(p){const w=a.SO.create("input");return w.setAttribute("type","radio"),p&&a.SO.setChecked(w,!0),w}isImageOptions(){return!!this.controlOption.options.find(p=>p.img)}transSelectValue(p){return Array.isArray(p)?p:[p]}}var M=e(15861);const Z=Nt=>{const p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.classList.add("l7-iconfont"),p.setAttribute("aria-hidden","true");const w=document.createElementNS("http://www.w3.org/2000/svg","use");return w.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${Nt}`),p.appendChild(w),p};class rt extends T{constructor(...p){var w;super(...p),w=this,(0,i.Z)(this,"onClick",(0,M.Z)(function*(){const{onExport:W}=w.controlOption;W==null||W(yield w.getImage())})),(0,i.Z)(this,"mergeImage",(0,M.Z)(function*(...W){var st,Tt;const{imageType:Gt}=w.controlOption,{width:ze=0,height:$e=0}=(st=(Tt=w.mapsService.getContainer())===null||Tt===void 0?void 0:Tt.getBoundingClientRect())!==null&&st!==void 0?st:{},rn=document.createElement("canvas");rn.width=ze,rn.height=$e;const gn=rn.getContext("2d");return(yield Promise.all(W.map(Ln=>new Promise(rr=>{const tr=new Image;tr.onload=()=>{rr(tr)},tr.src=Ln})))).forEach(Ln=>{gn==null||gn.drawImage(Ln,0,0,ze,$e)}),rn.toDataURL(`image/${Gt}`)}))}onAdd(){const p=super.onAdd();return p.addEventListener("click",this.onClick),p}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Z("l7-icon-export-picture"),imageType:"png"})}getImage(){var p=this;return(0,M.Z)(function*(){const w=yield p.mapsService.exportMap("png"),W=yield p.scene.exportPng("png");return p.mergeImage(...[w,W].filter(st=>st))})()}}const N=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Q=(()=>{if(typeof document>"u")return!1;const Nt=N[0],p={};for(const w of N)if((w==null?void 0:w[1])in document){for(const[st,Tt]of w.entries())p[Nt[st]]=Tt;return p}return!1})(),ft={change:Q.fullscreenchange,error:Q.fullscreenerror};let I={request(Nt=document.documentElement,p){return new Promise((w,W)=>{const st=()=>{I.off("change",st),w()};I.on("change",st);const Tt=Nt[Q.requestFullscreen](p);Tt instanceof Promise&&Tt.then(st).catch(W)})},exit(){return new Promise((Nt,p)=>{if(!I.isFullscreen){Nt();return}const w=()=>{I.off("change",w),Nt()};I.on("change",w);const W=document[Q.exitFullscreen]();W instanceof Promise&&W.then(w).catch(p)})},toggle(Nt,p){return I.isFullscreen?I.exit():I.request(Nt,p)},onchange(Nt){I.on("change",Nt)},onerror(Nt){I.on("error",Nt)},on(Nt,p){const w=ft[Nt];w&&document.addEventListener(w,p,!1)},off(Nt,p){const w=ft[Nt];w&&document.removeEventListener(w,p,!1)},raw:Q};Object.defineProperties(I,{isFullscreen:{get:()=>!!document[Q.fullscreenElement]},element:{enumerable:!0,get:()=>{var Nt;return(Nt=document[Q.fullscreenElement])!==null&&Nt!==void 0?Nt:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[Q.fullscreenEnabled]}}),Q||(I={isEnabled:!1});const G=I;class ut extends T{constructor(p){var w;super(p),w=this,(0,i.Z)(this,"isFullscreen",!1),(0,i.Z)(this,"mapContainer",void 0),(0,i.Z)(this,"toggleFullscreen",(0,M.Z)(function*(){G.isEnabled&&(yield G.toggle(w.mapContainer))})),(0,i.Z)(this,"onClick",()=>{this.toggleFullscreen()}),(0,i.Z)(this,"onFullscreenChange",()=>{this.isFullscreen=!!document.fullscreenElement;const{btnText:W,btnIcon:st,title:Tt,exitBtnText:Gt,exitBtnIcon:ze,exitTitle:$e}=this.controlOption;this.isFullscreen?(this.setBtnTitle($e),this.setBtnText(Gt),this.setBtnIcon(ze)):(this.setBtnTitle(Tt),this.setBtnText(W),this.setBtnIcon(st)),this.emit("fullscreenChange",this.isFullscreen)}),G.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316")}setOptions(p){const{exitBtnText:w,exitBtnIcon:W,exitTitle:st}=p;this.isFullscreen&&(this.checkUpdateOption(p,["exitBtnIcon"])&&this.setBtnIcon(W),this.checkUpdateOption(p,["exitBtnText"])&&this.setBtnText(w),this.checkUpdateOption(p,["exitTitle"])&&this.setBtnTitle(st)),super.setOptions(p)}onAdd(){const p=super.onAdd();return p.addEventListener("click",this.onClick),this.mapContainer=a.SO.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),p}onRemove(){super.onRemove(),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{title:"\u5168\u5C4F",btnIcon:Z("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Z("l7-icon-exit-fullscreen")})}}class L extends T{constructor(p){var w;super(p),w=this,(0,i.Z)(this,"getGeoLocation",()=>new Promise((W,st)=>{window.navigator.geolocation.getCurrentPosition(({coords:Tt})=>{const{longitude:Gt,latitude:ze}=Tt!=null?Tt:{};!isNaN(Gt)&&!isNaN(ze)?W([Gt,ze]):st()},Tt=>{st(Tt)})})),(0,i.Z)(this,"onClick",(0,M.Z)(function*(){if(!window.navigator.geolocation)return;const{transform:W}=w.controlOption,st=yield w.getGeoLocation(),Tt=w.mapsService.getZoom();w.mapsService.setZoomAndCenter(Tt>15?Tt:15,W?yield W(st):st)})),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D")}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{title:"\u5B9A\u4F4D",btnIcon:Z("l7-icon-reposition")})}onAdd(){const p=super.onAdd();return p.addEventListener("click",this.onClick),p}}function j(Nt){return Object.keys(Nt!=null?Nt:{}).every(p=>["layer","name","img"].includes(p))}class O extends R{constructor(...p){super(...p),(0,i.Z)(this,"onLayerChange",()=>{var w;(w=this.controlOption.layers)!==null&&w!==void 0&&w.length||(this.selectValue=this.getLayerVisible(),this.setOptions({options:this.getLayerOptions()}))}),(0,i.Z)(this,"onLayerVisibleChane",()=>{this.setSelectValue(this.getLayerVisible())}),(0,i.Z)(this,"onSelectChange",()=>{this.layers.forEach(w=>{const W=this.selectValue.includes(w.name),st=w.isVisible();W&&!st&&w.show(),!W&&st&&w.hide()})})}get layers(){const p=this.layerService,{layers:w}=this.controlOption;if(Array.isArray(w)&&w.length){const W=[];return w.forEach(st=>{if(st instanceof Object&&(j(st)?W.push(st.layer):W.push(st)),typeof st=="string"){const Tt=p.getLayer(st)||p.getLayerByName(st);Tt&&W.push(Tt)}}),W}return p.getLayers()||[]}getDefault(p){var w;return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Z("l7-icon-layer"),options:[],multiple:(w=p==null?void 0:p.multiple)!==null&&w!==void 0?w:!0})}getLayerVisible(){return this.layers.filter(p=>p.isVisible()).map(p=>p.name)}getLayerOptions(){const{layers:p}=this.controlOption,w=p==null?void 0:p.every(W=>W.img);return p?p==null?void 0:p.map(W=>{if(j(W))return{text:W.name||W.layer.name,value:W.layer.name,img:w?W.img:void 0};if(typeof W=="string"){const st=this.layerService.getLayer(W)||this.layerService.getLayerByName(W);return{text:st==null?void 0:st.name,value:st==null?void 0:st.name}}return{text:W.name,value:W.name}}):this.layers.map(W=>({text:W.name,value:W.name}))}setOptions(p){const w=this.checkUpdateOption(p,["layers","multiple"]);super.setOptions(p),w&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}handleSingleSelection(){this.layers.forEach((p,w)=>{w===0?p.show():p.hide()})}onAdd(){var p;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(p=this.controlOption.options)!==null&&p!==void 0&&p.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),super.onAdd()}onRemove(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}getIsMultiple(){return this.controlOption.multiple}}class B extends S{getDefault(){return{position:o.d.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const p=a.SO.create("div","l7-control-logo");return this.setLogoContent(p),p}onRemove(){return null}setOptions(p){super.setOptions(p),this.checkUpdateOption(p,["img","href"])&&(a.SO.clearChildren(this.container),this.setLogoContent(this.container))}setLogoContent(p){const{href:w,img:W}=this.controlOption,st=a.SO.create("img");if(st.setAttribute("src",W),st.setAttribute("aria-label","AntV logo"),a.SO.setUnDraggable(st),w){const Tt=a.SO.create("a","l7-control-logo-link");Tt.target="_blank",Tt.href=w,Tt.rel="noopener nofollow",Tt.setAttribute("rel","noopener nofollow"),Tt.appendChild(st),p.appendChild(Tt)}else p.appendChild(st)}}const _={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},H={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};class U extends R{constructor(...p){super(...p),(0,i.Z)(this,"onMapThemeChange",()=>{this.mapsService.setMapStyle(this.selectValue[0])})}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Z("l7-icon-color"),options:[]})}getStyleOptions(){const p=this.mapsService.getType()==="mapbox"?H:_;return Object.entries(this.mapsService.getMapStyleConfig()).filter(([w,W])=>typeof W=="string"&&w!=="blank").map(([w,W])=>{var st;const{text:Tt,img:Gt}=(st=p[w])!==null&&st!==void 0?st:{};return{text:Tt!=null?Tt:w,value:W,img:Gt,key:w}})}getMapStyle(){return this.mapsService.getMapStyle()}onAdd(){var p;if((p=this.controlOption.options)!==null&&p!==void 0&&p.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var w,W;const st=this.controlOption.defaultValue;this.controlOption.defaultValue=(w=(W=this.controlOption.options.find(Tt=>Tt.key===st))===null||W===void 0?void 0:W.value)!==null&&w!==void 0?w:st}else{const st=this.getMapStyle();st?this.controlOption.defaultValue=st:this.mapsService.map.once("styledata",()=>{const Tt=this.mapsService.getMapStyle();this.controlOption.defaultValue=Tt,this.setSelectValue(Tt,!1)})}return this.on("selectChange",this.onMapThemeChange),super.onAdd()}getIsMultiple(){return!1}}class V extends S{constructor(...p){super(...p),(0,i.Z)(this,"location",[0,0]),(0,i.Z)(this,"onMouseMove",w=>{let W=this.location;const st=w.lngLat||w.lnglat,{transform:Tt}=this.controlOption;st&&(W=[st.lng,st.lat]),this.location=W,Tt&&(W=Tt(W)),this.insertLocation2HTML(W),this.emit("locationChange",W)})}getLocation(){return this.location}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{position:o.d.BOTTOMLEFT,transform:([w,W])=>[+(+w).toFixed(6),+(+W).toFixed(6)]})}onAdd(){const p=a.SO.create("div","l7-control-mouse-location");return p.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),p}onRemove(){this.mapsService.off("mousemove",this.onMouseMove)}insertLocation2HTML(p){this.container.innerText=p.join(", ")}}class D extends S{constructor(...p){super(...p),(0,i.Z)(this,"mScale",void 0),(0,i.Z)(this,"iScale",void 0),(0,i.Z)(this,"update",()=>{const w=this.mapsService,{maxWidth:W}=this.controlOption,st=w.getSize()[1]/2,Tt=w.containerToLngLat([0,st]),Gt=w.containerToLngLat([W,st]),ze=(0,a.yM)([Tt.lng,Tt.lat],[Gt.lng,Gt.lat]);this.updateScales(ze)})}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{name:"scale",position:o.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const w=a.SO.create("div","l7-control-scale");this.resetScaleLines(w);const{updateWhenIdle:W}=this.controlOption;return this.mapsService.on(W?"moveend":"mapmove",this.update),this.mapsService.on(W?"zoomend":"zoomchange",this.update),w}onRemove(){const{updateWhenIdle:p}=this.controlOption;this.mapsService.off(p?"zoomend":"zoomchange",this.update),this.mapsService.off(p?"moveend":"mapmove",this.update)}setOptions(p){super.setOptions(p),this.checkUpdateOption(p,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(p){const{metric:w,imperial:W}=this.controlOption;w&&p&&this.updateMetric(p),W&&p&&this.updateImperial(p)}resetScaleLines(p){a.SO.clearChildren(p);const{metric:w,imperial:W,maxWidth:st,lockWidth:Tt}=this.controlOption;Tt&&a.SO.addStyle(p,`width: ${st}px`),w&&(this.mScale=a.SO.create("div","l7-control-scale-line",p)),W&&(this.iScale=a.SO.create("div","l7-control-scale-line",p)),this.update()}updateScale(p,w,W){const{maxWidth:st}=this.controlOption;p.style.width=Math.round(st*W)+"px",p.innerHTML=w}getRoundNum(p){const w=Math.pow(10,(Math.floor(p)+"").length-1);let W=p/w;return W=W>=10?10:W>=5?5:W>=3?3:W>=2?2:1,w*W}updateMetric(p){const w=this.getRoundNum(p),W=w<1e3?w+" m":w/1e3+" km";this.updateScale(this.mScale,W,w/p)}updateImperial(p){const w=p*3.2808399;let W,st,Tt;w>5280?(W=w/5280,st=this.getRoundNum(W),this.updateScale(this.iScale,st+" mi",st/W)):(Tt=this.getRoundNum(w),this.updateScale(this.iScale,Tt+" ft",Tt/w))}}var lt=e(29283);class J extends S{constructor(...p){super(...p),(0,i.Z)(this,"isMoving",!1),(0,i.Z)(this,"maskLayer",void 0),(0,i.Z)(this,"move",w=>{switch(w.stopPropagation(),w.type){case"touchcancel":case"touchend":case"mouseup":{var W;this.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(st=>{document.removeEventListener(st,this.move)}),(W=this.scene)===null||W===void 0||W.render();break}case"mousedown":case"touchstart":this.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(st=>{document.addEventListener(st,this.move)});case"mousemove":case"touchmove":{if(this.isMoving)if(this.controlOption.orientation==="vertical"){let st;if("pageX"in w?st=w.pageX:w.touches&&w.touches.length&&w.touches[0].pageX?st=w.touches[0].pageX:w.changedTouches&&w.changedTouches.length&&(st=w.changedTouches[0].pageX),!st)break;const Tt=this.getContainerDOMRect(),Gt=this.getContainerSize(),ze=Gt[0],$e=(Tt==null?void 0:Tt.left)||0,rn=st-$e+window.scrollX-document.documentElement.clientLeft,gn=ze-Math.min(Math.max(0,ze-rn),ze),nt=gn/ze;this.setOptions({ratio:nt}),this.emit("moving",{size:[gn,Gt[1]],ratio:[nt,0]})}else{let st;if("pageY"in w?st=w.pageY:w.touches&&w.touches.length&&w.touches[0].pageY?st=w.touches[0].pageY:w.changedTouches&&w.changedTouches.length&&(st=w.changedTouches[0].pageY),!st)break;const Tt=this.getContainerDOMRect(),Gt=this.getContainerSize(),ze=Gt[1],$e=(Tt==null?void 0:Tt.top)||0,rn=st-$e+window.scrollY-document.documentElement.clientTop,gn=ze-Math.min(Math.max(0,ze-rn),ze),nt=gn/ze;this.setOptions({ratio:nt}),this.emit("moving",{size:[Gt[0],gn],ratio:[0,nt]})}break}default:break}}),(0,i.Z)(this,"getMaskLayer",()=>(console.log(this.getMaskGeoData()),new lt.dW({visible:!1}).source(this.getMaskGeoData()).shape("fill").color("red").style({opacity:.1}))),(0,i.Z)(this,"updateMask",()=>{var w;if(!this.mapsService)return;const W=this.getMaskGeoData();(w=this.maskLayer)===null||w===void 0||w.setData(W)})}getDefault(){return(0,u.Z)((0,u.Z)({},super.getDefault()),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}onAdd(){const p=a.SO.create("div","l7-control-swipe");a.SO.create("button","l7-control-swipe__button",p);const{orientation:w="vertical",ratio:W=.5}=this.controlOption;return w==="horizontal"?(p.style.top=W*100+"%",p.style.left=""):(p.style.left=W*100+"%",p.style.top=""),p.classList.add(w),p}addTo(p){this.mapsService=p.mapService,this.renderService=p.rendererService,this.layerService=p.layerService,this.controlService=p.controlService,this.configService=p.globalConfigService,this.scene=p.sceneService,this.sceneContainer=p,this.isShow=!0,this.container=this.onAdd();const{className:w,style:W,layers:st,rightLayers:Tt}=this.controlOption;w&&this.setClassName(w),W&&this.setStyle(W),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();const Gt=(0,o.e7)(p);return this.maskLayer.setContainer(Gt),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(st,!1),this.addMaskToLayers(Tt,!0),this.emit("add",this),this}onRemove(){if(this.maskLayer){var p;const{layers:w,rightLayers:W}=this.controlOption;this.removeMaskFromLayers(w),this.removeMaskFromLayers(W),(p=this.layerService)===null||p===void 0||p.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}show(){var p;const w=this.container;a.SO.removeClass(w,"l7-control-swipe_hide");const{layers:W,rightLayers:st}=this.controlOption;W.forEach(Tt=>Tt.enableMask()),st.forEach(Tt=>Tt.enableMask()),(p=this.scene)===null||p===void 0||p.render(),this.isShow=!0,this.emit("show",this)}hide(){var p;const w=this.container;a.SO.addClass(w,"l7-control-swipe_hide");const{layers:W,rightLayers:st}=this.controlOption;W.forEach(Tt=>Tt.disableMask()),st.forEach(Tt=>Tt.disableMask()),(p=this.scene)===null||p===void 0||p.render(),this.isShow=!1,this.emit("hide",this)}setOptions(p){const w=(0,u.Z)((0,u.Z)({},this.controlOption),p);if(p.className&&this.setClassName(p.className),p.style&&this.setStyle(p.style),(p.orientation||p.ratio!==void 0)&&this.setOrientationAndRatio(w.orientation,w.ratio),p.layers){const W=p.layers,st=this.controlOption.layers;this.setLayers(W,st,!1)}if(p.rightLayers){const W=p.rightLayers,st=this.controlOption.rightLayers;this.setLayers(W,st,!0)}this.controlOption=w,this.updateMask()}registerEvent(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}unRegisterEvent(){var p;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),(p=this.mapsService)===null||p===void 0||p.off("camerachange",this.updateMask)}setOrientationAndRatio(p="vertical",w=.5){this.container.classList.remove("horizontal","vertical"),this.container.classList.add(p),p==="horizontal"?(this.container.style.top=w*100+"%",this.container.style.left=""):(this.container.style.left=w*100+"%",this.container.style.top="")}setLayers(p,w,W=!1){const st=p.filter(Gt=>w.includes(Gt)===!1),Tt=w.filter(Gt=>p.includes(Gt)===!1);this.addMaskToLayers(st,W),this.removeMaskFromLayers(Tt)}addMaskToLayers(p,w){p.forEach(W=>{W.updateLayerConfig({maskInside:!w}),W.addMask(this.maskLayer)})}removeMaskFromLayers(p){p.forEach(w=>{w.updateLayerConfig({maskInside:!0}),w.removeMask(this.maskLayer)})}getMaskGeoData(){const{ratio:p=.5,orientation:w="vertical"}=this.controlOption,W=w==="vertical",[st,Tt]=this.getBounds(),[Gt,ze]=st,[$e,rn]=Tt;let gn;if(W){const Ln=Gt+($e-Gt)*p;gn=[[Gt,rn],[Ln,rn],[Ln,ze],st,[Gt,rn]]}else{const Ln=this.getContainerSize(),tr=this.mapsService.containerToLngLat([Ln[0],Ln[1]*p]).lat;gn=[[Gt,rn],Tt,[$e,tr],[Gt,tr],[Gt,rn]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[gn]}}]}}getContainerDOMRect(){var p;return(p=this.mapsService.getContainer())===null||p===void 0?void 0:p.getBoundingClientRect()}getContainerSize(){return this.mapsService.getSize()}getBounds(){return this.mapsService.getBounds()}addLayer(p,w=!1){const W=Array.isArray(p)?p:[p];if(w){const st=this.controlOption.rightLayers.concat(...W);this.setOptions({rightLayers:st})}else{const st=this.controlOption.layers.concat(...W);this.setOptions({layers:st})}}removeLayer(p){const w=Array.isArray(p)?p:[p],W=this.controlOption.layers.filter(Tt=>w.includes(Tt)),st=this.controlOption.rightLayers.filter(Tt=>w.includes(Tt));this.setOptions({layers:W,rightLayers:st})}removeLayers(){this.setOptions({layers:[],rightLayers:[]})}}class Rt extends S{constructor(...p){super(...p),(0,i.Z)(this,"disabled",void 0),(0,i.Z)(this,"zoomInButton",void 0),(0,i.Z)(this,"zoomOutButton",void 0),(0,i.Z)(this,"zoomNumDiv",void 0),(0,i.Z)(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),(0,i.Z)(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),(0,i.Z)(this,"updateDisabled",()=>{const w=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||w.getZoom()<=w.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(w.getZoom()))),(this.disabled||w.getZoom()>=w.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(p){return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{position:o.d.BOTTOMRIGHT,name:"zoom",zoomInText:Z("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Z("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(p){super.setOptions(p),this.checkUpdateOption(p,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const p=a.SO.create("div","l7-control-zoom");return this.resetButtonGroup(p),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),p}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(p){a.SO.clearChildren(p),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",p,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",p)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",p,this.zoomOut),this.updateDisabled()}createButton(p,w,W,st,Tt){const Gt=a.SO.create("button",W,st);return typeof p=="string"?Gt.innerHTML=p:Gt.append(p),Gt.title=w,Tt&&Gt.addEventListener("click",Tt),Gt}}class kt extends c.EventEmitter{get lngLat(){var p;return(p=this.popupOption.lngLat)!==null&&p!==void 0?p:{lng:0,lat:0}}set lngLat(p){this.popupOption.lngLat=p}constructor(p){super(),(0,i.Z)(this,"popupOption",void 0),(0,i.Z)(this,"mapsService",void 0),(0,i.Z)(this,"sceneService",void 0),(0,i.Z)(this,"layerService",void 0),(0,i.Z)(this,"scene",void 0),(0,i.Z)(this,"closeButton",void 0),(0,i.Z)(this,"container",void 0),(0,i.Z)(this,"content",void 0),(0,i.Z)(this,"contentTitle",void 0),(0,i.Z)(this,"contentPanel",void 0),(0,i.Z)(this,"tip",void 0),(0,i.Z)(this,"isShow",!0),(0,i.Z)(this,"onMouseMove",W=>{var st;const Tt=this.mapsService.getMapContainer(),{left:Gt=0,top:ze=0}=(st=Tt==null?void 0:Tt.getBoundingClientRect())!==null&&st!==void 0?st:{};this.setPopupPosition(W.clientX-Gt,W.clientY-ze)}),(0,i.Z)(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:W,lat:st}=this.lngLat,{x:Tt,y:Gt}=this.mapsService.lngLatToContainer([W,st]);this.setPopupPosition(Tt,Gt)}),(0,i.Z)(this,"updateLngLatPositionWhenZoom",W=>{if(!this.mapsService||this.popupOption.followCursor)return;const st=W.map,Tt=st.getSize();Tt.x=Tt.x/2,Tt.y=Tt.y/2;const Gt=W.center,ze=W.zoom,$e=st.DE(this.lngLat,ze,Gt);$e.x=Math.round($e.x),$e.y=Math.round($e.y),this.setPopupPosition($e.x,$e.y,!0)}),(0,i.Z)(this,"onKeyDown",W=>{W.keyCode===27&&this.remove()}),(0,i.Z)(this,"onCloseButtonClick",W=>{W.stopPropagation&&W.stopPropagation(),this.hide()}),(0,i.Z)(this,"updatePosition",(W,st=!0)=>{const Tt=!!this.lngLat,{className:Gt,style:ze,maxWidth:$e,anchor:rn,stopPropagation:gn}=this.popupOption;if(!this.mapsService||!Tt||!this.content)return;const nt=this.mapsService.getMarkerContainer();if(!this.container&&nt&&(this.container=a.SO.create("div",`l7-popup ${Gt!=null?Gt:""} ${this.isShow?"":"l7-popup-hide"}`,nt),ze&&this.container.setAttribute("style",ze),this.tip=a.SO.create("div","l7-popup-tip",this.container),this.container.appendChild(this.content),gn&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(Ln=>{this.container.addEventListener(Ln,rr=>{rr.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),st?this.updateLngLatPositionWhenZoom(W):this.updateLngLatPosition(),a.SO.setTransform(this.container,`${a.rQ[rn]}`),(0,a.zi)(this.container,rn,"popup"),$e){const{width:Ln}=this.container.getBoundingClientRect();Ln>parseFloat($e)&&(this.container.style.width=$e)}else this.container.style.removeProperty("width")}),(0,i.Z)(this,"updateWhenZoom",W=>{this.updatePosition(W,!0)}),(0,i.Z)(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=(0,u.Z)((0,u.Z)({},this.getDefault(p!=null?p:{})),p);const{lngLat:w}=this.popupOption;w&&(this.lngLat=w)}getIsShow(){return this.isShow}addTo(p){this.mapsService=p.mapService,this.sceneService=p.sceneService,this.layerService=p.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=p,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:w,text:W,title:st}=this.popupOption;return w?this.setHTML(w):W&&this.setText(W),st&&this.setTitle(st),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&a.SO.remove(this.content),this.container&&(a.SO.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(p){this.show();const{className:w}=this.popupOption;if(this.popupOption=(0,u.Z)((0,u.Z)({},this.popupOption),p),this.checkUpdateOption(p,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(a.SO.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(p,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(p,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(p,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(p,["html"])&&p.html?this.setHTML(p.html):this.checkUpdateOption(p,["text"])&&p.text&&this.setText(p.text),this.checkUpdateOption(p,["className"])){var W;w&&this.container.classList.remove(w!=null?w:""),this.container.classList.add((W=p.className)!==null&&W!==void 0?W:"")}if(this.checkUpdateOption(p,["style"])){var st;a.SO.addStyle(this.container,(st=p.style)!==null&&st!==void 0?st:"")}return this.checkUpdateOption(p,["lngLat"])&&p.lngLat&&this.setLnglat(p.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&a.SO.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&a.SO.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(p){return this.popupOption.html=p,this.setDOMContent(p)}setText(p){return this.popupOption.text=p,this.setDOMContent(window.document.createTextNode(p))}setTitle(p){this.show(),this.popupOption.title=p,p?(this.contentTitle||(this.contentTitle=a.SO.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),a.SO.clearChildren(this.contentTitle),a.SO.appendElementType(this.contentTitle,p)):this.contentTitle&&(a.SO.remove(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:p,lat:w}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([p,w]),this}setLngLat(p){return this.setLnglat(p)}setLnglat(p){return this.show(),this.lngLat=p,Array.isArray(p)&&(this.lngLat={lng:p[0],lat:p[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(p){return this.popupOption.maxWidth=p,this.update(),this}isOpen(){return!!this.mapsService}getDefault(p){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:a.bV.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(p){return this.show(),this.createContent(),a.SO.appendElementType(this.contentPanel,p),this.update(),this}updateCloseOnClick(p){const w=this.mapsService;w&&(w==null||w.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!p&&requestAnimationFrame(()=>{w==null||w.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(p){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!p&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(p){var w;const W=(w=this.mapsService)===null||w===void 0?void 0:w.getContainer();W&&(W==null||W.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!p&&(W==null||W.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&a.SO.remove(this.content),this.contentTitle=void 0,this.content=a.SO.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const p=Z("l7-icon-guanbi");a.SO.addClass(p,"l7-popup-close-button"),this.content.appendChild(p),this.popupOption.closeButtonOffsets&&(p.style.right=this.popupOption.closeButtonOffsets[0]+"px",p.style.top=this.popupOption.closeButtonOffsets[1]+"px"),p.setAttribute("aria-label","Close popup"),p.addEventListener("click",()=>{this.hide()}),p.addEventListener("pointerup",w=>{w.stopPropagation()}),p.addEventListener("pointerdown",w=>{w.stopPropagation()}),this.closeButton=p}else this.closeButton=void 0;this.contentPanel=a.SO.create("div","l7-popup-content__panel",this.content)}setPopupPosition(p,w,W=!1){if(this.container){const{offsets:st}=this.popupOption;this.container.style.left=p+st[0]+"px",this.container.style.top=w-st[1]+"px",W?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(p,w){return w.some(W=>W in p)}}const{get:ne}=a.lodashUtil;class re extends kt{constructor(...p){super(...p),(0,i.Z)(this,"layerClickCountByFrame",0),(0,i.Z)(this,"layerConfigMap",new WeakMap),(0,i.Z)(this,"displayFeatureInfo",void 0),(0,i.Z)(this,"onLayerClick",(w,W)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(w,W.featureId))this.hide();else{const{title:st,content:Tt}=this.getLayerInfoFrag(w,W);this.setDOMContent(Tt),this.setLnglat(W.lngLat),this.setTitle(st),this.setDisplayFeatureInfo({layer:w,featureId:W.featureId}),this.show()}})}),(0,i.Z)(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),(0,i.Z)(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),(0,i.Z)(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var p;const{config:w,items:W}=this.popupOption;return(p=w!=null?w:W)!==null&&p!==void 0?p:[]}addTo(p){return super.addTo(p),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(p){this.unbindLayerEvent();const w=(0,u.Z)({},p),W=w.trigger||this.popupOption.trigger,st=w.items||this.popupOption.items,Tt=(st==null?void 0:st.length)===0;w.followCursor=W==="hover"&&!Tt;const Gt=this.isShow;return super.setOptions(w),this.bindLayerEvent(),(Tt||!Gt)&&this.hide(),this}getDefault(p){const w=p.trigger!=="click";return(0,u.Z)((0,u.Z)({},super.getDefault(p)),{},{trigger:"hover",followCursor:w,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:p,closeOnClick:w}=this.popupOption;this.layerConfigItems.forEach(W=>{var st;const Tt=this.getLayerByConfig(W);if(!Tt)return;const Gt=(0,u.Z)({},W);if(p==="hover"){const gn=this.onLayerMouseMove.bind(this,Tt),nt=this.onLayerMouseOut.bind(this,Tt);Gt.onMouseMove=gn,Gt.onMouseOut=nt,Tt==null||Tt.on("mousemove",gn),Tt==null||Tt.on("mouseout",nt)}else{var ze;const gn=this.onLayerClick.bind(this,Tt);Gt.onClick=gn,Tt==null||Tt.on("click",gn);const nt=(ze=this.mapsService)===null||ze===void 0?void 0:ze.getMapContainer();nt&&w&&nt.addEventListener("click",this.onSceneClick)}const $e=Tt==null||(st=Tt.getSource)===null||st===void 0?void 0:st.call(Tt),rn=this.onSourceUpdate.bind(this);$e==null||$e.on("update",rn),Gt.onSourceUpdate=rn,this.layerConfigMap.set(Tt,Gt)})}unbindLayerEvent(){this.layerConfigItems.forEach(p=>{var w;const W=this.getLayerByConfig(p),st=W&&this.layerConfigMap.get(W);if(!st)return;const{onMouseMove:Tt,onMouseOut:Gt,onClick:ze,onSourceUpdate:$e}=st;if(Tt&&W.off("mousemove",Tt),Gt&&W.off("mouseout",Gt),ze&&W.off("click",ze),$e){var rn;W==null||(rn=W.getSource())===null||rn===void 0||rn.off("update",$e)}const gn=(w=this.mapsService)===null||w===void 0?void 0:w.getMapContainer();gn&&gn.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(p,w){if(!this.isSameFeature(p,w.featureId)){const{title:W,content:st}=this.getLayerInfoFrag(p,w);this.setDOMContent(st),this.setTitle(W),this.setDisplayFeatureInfo({layer:p,featureId:w.featureId}),this.show()}}onLayerMouseOut(p,w){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(p,w){const W=this.layerConfigMap.get(p);let st;const Tt=document.createDocumentFragment();if(W){let Gt=w.feature;Gt.type==="Feature"&&"properties"in Gt&&"geometry"in Gt&&(Gt=Gt.properties);const{title:ze,fields:$e,customContent:rn}=W;if(ze){st=document.createDocumentFragment();const gn=ze instanceof Function?ze(Gt):ze;a.SO.appendElementType(st,gn)}if(rn){const gn=rn instanceof Function?rn(Gt):rn;a.SO.appendElementType(Tt,gn)}else $e!=null&&$e.length&&($e==null||$e.forEach(gn=>{var nt,Ln;const{field:rr,formatField:tr,formatValue:sr,getValue:Br}=typeof gn=="string"?{field:gn}:gn,fi=a.SO.create("div","l7-layer-popup__row"),Yn=Br?Br(w.feature):ne(Gt,rr),Ui=(nt=tr instanceof Function?tr(rr,Gt):tr)!==null&&nt!==void 0?nt:rr;let Wr=(Ln=sr instanceof Function?sr(Yn,Gt):sr)!==null&&Ln!==void 0?Ln:Yn;const Zt=a.SO.create("span","l7-layer-popup__key",fi);a.SO.appendElementType(Zt,Ui),a.SO.appendElementType(Zt,document.createTextNode("\uFF1A"));const P=a.SO.create("span","l7-layer-popup__value",fi);Array.isArray(Wr)&&Wr.every(Y=>!(Y instanceof Object))&&(Wr=Wr.map(Y=>String(Y)).join(",")),a.SO.appendElementType(P,Wr),Tt.appendChild(fi)}))}return{title:st,content:Tt}}getLayerByConfig(p){const w=p.layer;if(w instanceof Object)return w;if(typeof w=="string")return this.layerService.getLayer(w)||this.layerService.getLayerByName(w)}isSameFeature(p,w){const W=this.displayFeatureInfo;return W&&p===W.layer&&w===W.featureId}setDisplayFeatureInfo(p){const w=this.displayFeatureInfo;w&&w.layer.off("hide",this.onLayerHide),p&&p.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=p}}function It(Nt,p){var w=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,W=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(w||W)&&(p||(p=document),!!p)){var st=p.head||p.getElementsByTagName("head")[0];if(!st){st=p.createElement("head");var Tt=p.body||p.getElementsByTagName("body")[0];Tt?Tt.parentNode.insertBefore(st,Tt):p.documentElement.appendChild(st)}var Gt=p.createElement("style");return Gt.type="text/css",Gt.styleSheet?Gt.styleSheet.cssText=Nt:Gt.appendChild(p.createTextNode(Nt)),st.appendChild(Gt),Gt}}It(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`)},86939:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);if(!/^(1887|7596)$/.test(e.j))var c=e(54674);if(!/^(1887|7596)$/.test(e.j))var d=e(13438);class m extends(/^(1887|7596)$/.test(e.j)?null:c.Z){constructor(...r){super(...r),(0,a.Z)(this,"type","CanvasLayer")}getDefaultConfig(){return{zIndex:3,contextType:"canvas2d",trigger:"change"}}buildModels(){var r=this;return(0,i.Z)(function*(){r.layerModel=new d.N(r),yield r.initLayerModels()})()}getModelType(){return this.getLayerConfig().contextType||"canvas2d"}draw(r){return this.updateLayerConfig({draw:r}),this.render(),this}getLayerConfig(){const r=(0,u.Z)((0,u.Z)({},this.getDefaultConfig()),super.getLayerConfig());return r.zIndex<3&&(r.zIndex=3),r}render(){var r;return(r=this.layerModel)===null||r===void 0||r.renderCanvas(),this}getCanvas(){var r;return(r=this.layerModel)===null||r===void 0?void 0:r.canvas}show(){const r=this.getCanvas();return r&&(r.style.display="unset"),this}hide(){const r=this.getCanvas();return r&&(r.style.display="none"),this}destroy(){this.layerModel.removeCanvas(),super.destroy()}}},13438:(Xt,K,e)=>{"use strict";if(e.d(K,{N:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(98422);if(!/^(1887|7596)$/.test(e.j))var c=e(76514);if(!/^(1887|7596)$/.test(e.j))var d=e(2175);class m extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...r){super(...r),(0,i.Z)(this,"canvas",null),(0,i.Z)(this,"ctx",void 0),(0,i.Z)(this,"ctxType",void 0),(0,i.Z)(this,"viewportSize",void 0),(0,i.Z)(this,"initCanvas",()=>{var h,g,A,o,S;const{zIndex:T,getContext:E}=this.layerConfig,b=document.createElement("canvas"),C=this.layer.getModelType();this.canvas=b,b.classList.add("l7-canvas-layer"),b.style.position="absolute",b.style.top="0",b.style.left="0",b.style.zIndex=String(T),this.resetCanvasSize();const X=(h=(g=(A=this.mapService).getCanvasOverlays)===null||g===void 0?void 0:g.call(A))!==null&&h!==void 0?h:(o=(S=this.mapService).getMapCanvasContainer)===null||o===void 0?void 0:o.call(S);X==null||X.appendChild(b),this.ctx=E?E(b):b.getContext(d.q[C]),this.ctx||console.error("Failed to get rendering context for canvas"),this.bindListeners()}),(0,i.Z)(this,"resetViewportSize",()=>{const{width:h,height:g}=this.rendererService.getViewportSize();this.viewportSize=[h,g]}),(0,i.Z)(this,"resetCanvasSize",()=>{const h=this.canvas;if(!h)return;this.resetViewportSize();const[g,A]=this.mapService.getSize(),[o,S]=this.viewportSize;h.width=o,h.height=S,h.style.width=g+"px",h.style.height=A+"px"}),(0,i.Z)(this,"renderCanvas",()=>{var h;this.canvas||this.initCanvas();const{draw:g,drawingOnCanvas:A}=this.layerConfig,[o,S]=this.viewportSize,T=this.mapService.getBounds();(h=g!=null?g:A)===null||h===void 0||h({canvas:this.canvas,ctx:this.ctx,container:{width:o,height:S,bounds:T},size:[o,S],utils:{lngLatToContainer:this.lngLatToContainer},mapService:this.mapService})}),(0,i.Z)(this,"removeCanvas",()=>{if(this.canvas){var h;(h=this.canvas.parentElement)===null||h===void 0||h.removeChild(this.canvas),this.canvas=null}this.unbindListeners()}),(0,i.Z)(this,"onMapResize",()=>{requestAnimationFrame(()=>{this.resetCanvasSize(),this.renderCanvas()})}),(0,i.Z)(this,"lngLatToContainer",h=>{const{x:g,y:A}=this.mapService.lngLatToContainer(h);return{x:g*window.devicePixelRatio,y:A*window.devicePixelRatio}})}get layerConfig(){return this.layer.getLayerConfig()}initModels(){var r=this;return(0,u.Z)(function*(){return r.renderCanvas(),[]})()}bindListeners(){this.mapService.on("resize",this.onMapResize);const{trigger:r,update:h}=this.layerConfig;h===c.Fy.ALWAYS||r==="change"?this.mapService.on("mapchange",this.renderCanvas):(this.mapService.on("zoomstart",this.removeCanvas),this.mapService.on("zoomend",this.renderCanvas),this.mapService.on("movestart",this.removeCanvas),this.mapService.on("moveend",this.renderCanvas))}unbindListeners(){this.mapService.off("resize",this.onMapResize),this.mapService.off("mapchange",this.renderCanvas),this.mapService.off("zoomstart",this.removeCanvas),this.mapService.off("zoomend",this.renderCanvas),this.mapService.off("movestart",this.removeCanvas),this.mapService.off("moveend",this.renderCanvas)}registerBuiltinAttributes(){}}},2175:(Xt,K,e)=>{"use strict";e.d(K,{q:()=>u});const u={canvas2d:"2d",webgl:"webgl",webgl2:"webgl2",webgpu:"webgpu"}},97617:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(75182);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","CityBuildingLayer")}buildModels(){var l=this;return(0,u.Z)(function*(){l.layerModel=new c.Z(l),yield l.initLayerModels()})()}setLight(l){this.updateLayerConfig({time:l})}getModelType(){return"citybuilding"}}},75182:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(71590),c=e(64939);if(!/^(1887|7596)$/.test(e.j))var d=e(98422);if(!/^(1887|7596)$/.test(e.j))var m=e(42659);const l=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near: 0;
  float u_far: 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }

  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,r=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`;class h extends(/^(1887|7596)$/.test(e.j)?null:d.Z){constructor(...A){super(...A),(0,i.Z)(this,"cityCenter",void 0),(0,i.Z)(this,"cityMinSize",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getCommonUniformsInfo(){const{opacity:A=1,baseColor:o="rgb(16,16,16)",brightColor:S="rgb(255,176,38)",windowColor:T="rgb(30,60,89)",time:E=0,sweep:b={enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}}=this.layer.getLayerConfig(),C={u_baseColor:(0,c.CI)(o),u_brightColor:(0,c.CI)(S),u_windowColor:(0,c.CI)(T),u_circleSweepColor:[...(0,c.CI)(b.sweepColor).slice(0,3),1],u_cityCenter:b.sweepCenter||this.cityCenter,u_circleSweep:b.enable?1:0,u_cityMinSize:this.cityMinSize*b.sweepRadius,u_circleSweepSpeed:b.sweepSpeed,u_opacity:A,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||E};return this.getUniformsBufferInfo(C)}calCityGeo(){const[A,o,S,T]=this.layer.getSource().extent,E=S-A,b=T-o;this.cityCenter=[(S+A)/2,(T+o)/2],this.cityMinSize=Math.sqrt(Math.pow(E,2)+Math.pow(b,2))/4}initModels(){var A=this;return(0,u.Z)(function*(){return A.calCityGeo(),A.initUniformsBuffer(),A.startModelAnimate(),A.buildModels()})()}buildModels(){var A=this;return(0,u.Z)(function*(){return[yield A.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:r,fragmentShader:l,triangulation:m.Xz,depth:{enable:!0},defines:A.getDefines(),inject:A.getInject(),cull:{enable:!0,face:a.gl.BACK}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:a.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(A,o,S,T,E)=>E}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:A=>{const{size:o=10}=A;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:(A,o,S)=>[S[3],S[4]]}})}}},54674:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>Q}),!/^(1887|7596)$/.test(e.j))var u=e(45987);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(1413);if(!/^(1887|7596)$/.test(e.j))var c=e(4942);var d=e(46343),m=e(71590),l=e(64939),r=e(26729),h=e.n(r);if(!/^(1887|7596)$/.test(e.j))var g=e(88212);if(!/^(1887|7596)$/.test(e.j))var A=e(9868);if(!/^(1887|7596)$/.test(e.j))var o=e(32271);if(!/^(1887|7596)$/.test(e.j))var S=e(65748);if(!/^(1887|7596)$/.test(e.j))var T=e(53368);const E=/^(1887|7596)$/.test(e.j)?null:["passes"],b=/^(1887|7596)$/.test(e.j)?null:["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:C,isFunction:X,isNumber:R,isObject:M,isPlainObject:Z,isUndefined:rt}=l.lodashUtil;let N=0;class Q extends(/^(1887|7596)$/.test(e.j)?null:r.EventEmitter){get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var I;return(I=this.container)===null||I===void 0?void 0:I.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(I={}){super(),(0,c.Z)(this,"id",`${N++}`),(0,c.Z)(this,"name",`${N}`),(0,c.Z)(this,"parent",void 0),(0,c.Z)(this,"coordCenter",void 0),(0,c.Z)(this,"type",void 0),(0,c.Z)(this,"visible",!0),(0,c.Z)(this,"zIndex",0),(0,c.Z)(this,"minZoom",void 0),(0,c.Z)(this,"maxZoom",void 0),(0,c.Z)(this,"inited",!1),(0,c.Z)(this,"layerModelNeedUpdate",!1),(0,c.Z)(this,"pickedFeatureID",null),(0,c.Z)(this,"selectedFeatureID",null),(0,c.Z)(this,"styleNeedUpdate",!1),(0,c.Z)(this,"rendering",void 0),(0,c.Z)(this,"forceRender",!1),(0,c.Z)(this,"clusterZoom",0),(0,c.Z)(this,"layerType",void 0),(0,c.Z)(this,"triangulation",void 0),(0,c.Z)(this,"layerPickService",void 0),(0,c.Z)(this,"textureService",void 0),(0,c.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,c.Z)(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,c.Z)(this,"hooks",{init:new d.S$,afterInit:new d.oI,beforeRender:new d.oI,beforeRenderData:new d.bf,afterRender:new d.ni,beforePickingEncode:new d.ni,afterPickingEncode:new d.ni,beforeHighlight:new d.ni(["pickedColor"]),afterHighlight:new d.ni,beforeSelect:new d.ni(["pickedColor"]),afterSelect:new d.ni,beforeDestroy:new d.ni,afterDestroy:new d.ni}),(0,c.Z)(this,"models",[]),(0,c.Z)(this,"multiPassRenderer",void 0),(0,c.Z)(this,"plugins",void 0),(0,c.Z)(this,"startInit",!1),(0,c.Z)(this,"sourceOption",void 0),(0,c.Z)(this,"layerModel",void 0),(0,c.Z)(this,"shapeOption",void 0),(0,c.Z)(this,"tileLayer",void 0),(0,c.Z)(this,"layerChildren",[]),(0,c.Z)(this,"masks",[]),(0,c.Z)(this,"configService",m.cO),(0,c.Z)(this,"styleAttributeService",void 0),(0,c.Z)(this,"layerSource",void 0),(0,c.Z)(this,"postProcessingPassFactory",void 0),(0,c.Z)(this,"animateOptions",{enable:!1}),(0,c.Z)(this,"container",void 0),(0,c.Z)(this,"encodedData",void 0),(0,c.Z)(this,"currentPickId",null),(0,c.Z)(this,"rawConfig",void 0),(0,c.Z)(this,"needUpdateConfig",void 0),(0,c.Z)(this,"encodeStyleAttribute",{}),(0,c.Z)(this,"enableShaderEncodeStyles",[]),(0,c.Z)(this,"enableDataEncodeStyles",[]),(0,c.Z)(this,"pendingStyleAttributes",[]),(0,c.Z)(this,"scaleOptions",{}),(0,c.Z)(this,"animateStartTime",void 0),(0,c.Z)(this,"animateStatus",!1),(0,c.Z)(this,"isDestroyed",!1),(0,c.Z)(this,"uniformBuffers",[]),(0,c.Z)(this,"encodeDataLength",0),(0,c.Z)(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0;const G=this.getLayerConfig();G&&G.autoFit&&this.fitBounds(G.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=I.name||this.id,this.zIndex=I.zIndex||0,this.rawConfig=I,this.masks=I.maskLayers||[]}addMask(I){this.masks.push(I),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(I){const G=this.masks.indexOf(I);G>-1&&this.masks.splice(G,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(I){this.masks.push(I)}removeMaskLayer(I){const G=this.masks.indexOf(I);G>-1&&this.masks.splice(G,1),I.destroy()}getAttribute(I){return this.styleAttributeService.getLayerStyleAttribute(I)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(I){if(Object.keys(I).map(G=>{G in this.rawConfig&&(this.rawConfig[G]=I[G])}),!this.startInit)this.needUpdateConfig=(0,a.Z)((0,a.Z)({},this.needUpdateConfig),I);else{const G=this.container.id;this.configService.setLayerConfig(G,this.id,(0,a.Z)((0,a.Z)((0,a.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),I)),this.needUpdateConfig={}}}setContainer(I){this.container=I}getContainer(){return this.container}addPlugin(I){return this.plugins.push(I),this}init(){var I=this;return(0,i.Z)(function*(){const G=I.container.id;I.startInit=!0,I.configService.setLayerConfig(G,I.id,I.rawConfig),I.layerType=I.rawConfig.layerType;const{enableMultiPassRenderer:ut,passes:L}=I.getLayerConfig();ut&&L!==null&&L!==void 0&&L.length&&L.length>0&&I.mapService.on("mapAfterFrameChange",()=>{I.renderLayers()}),I.postProcessingPassFactory=I.container.postProcessingPassFactory,I.styleAttributeService=I.container.styleAttributeService,ut&&(I.multiPassRenderer=I.container.multiPassRenderer,I.multiPassRenderer.setLayer(I)),I.pendingStyleAttributes.forEach(({attributeName:j,attributeField:O,attributeValues:B,updateOptions:_})=>{I.styleAttributeService.updateStyleAttribute(j,{scale:(0,a.Z)({field:O},I.splitValuesAndCallbackInAttribute(B,O?void 0:I.getLayerConfig()[j]))},_)}),I.pendingStyleAttributes=[],I.plugins=(0,g.Z)();for(const j of I.plugins)j.apply(I,I.container);I.layerPickService=new S.Z(I),I.textureService=new T.Z(I),I.log(m.Or.LayerInitStart),yield I.hooks.init.promise(),I.log(m.Or.LayerInitEnd),I.inited=!0,I.emit("inited",{target:I,type:"inited"}),I.emit("add",{target:I,type:"add"}),I.hooks.afterInit.call()})()}log(I,G="init"){var ut;if(this.tileLayer||this.isTileLayer)return;const L=`${this.id}.${G}.${I}`,j={id:this.id,type:this.type};(ut=this.debugService)===null||ut===void 0||ut.log(L,j)}updateModelData(I){I.attributes&&I.elements?this.models.map(G=>{G.updateAttributesAndElements(I.attributes,I.elements)}):console.warn("data error")}setLayerPickService(I){this.layerPickService=I}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:I}=this.getLayerConfig();I!=null&&I.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(I,G,ut){return this.updateStyleAttribute("color",I,G,ut),this}texture(I,G,ut){return this.updateStyleAttribute("texture",I,G,ut),this}rotate(I,G,ut){return this.updateStyleAttribute("rotate",I,G,ut),this}size(I,G,ut){return this.updateStyleAttribute("size",I,G,ut),this}filter(I,G,ut){const L=this.updateStyleAttribute("filter",I,G,ut);return this.dataState.dataSourceNeedUpdate=L&&this.inited,this}shape(I,G,ut){this.shapeOption={field:I,values:G};const L=this.updateStyleAttribute("shape",I,G,ut);return this.dataState.dataSourceNeedUpdate=L&&this.inited,this}label(I,G,ut){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:I,attributeValues:G,updateOptions:ut}),this}animate(I){let G={};return M(I)?(G.enable=!0,G=(0,a.Z)((0,a.Z)({},G),I)):G.enable=I,this.updateLayerConfig({animateOption:G}),this}source(I,G){return(I==null?void 0:I.type)==="source"?(this.setSource(I),this):(this.sourceOption={data:I,options:G},this.clusterZoom=0,this)}setData(I,G){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(I,G)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(I,G)}),this}dataUpdatelog(){this.log(m.Or.SourceInitStart,m.KD.UPDATE),this.layerSource.once("update",()=>{this.log(m.Or.SourceInitEnd,m.KD.UPDATE)})}style(I){const{passes:G}=I,ut=(0,u.Z)(I,E);G&&(0,o.E)(G).forEach(j=>{const O=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(j[0]);O&&O.updateOptions(j[1])}),ut.borderColor&&(ut.stroke=ut.borderColor),ut.borderWidth&&(ut.strokeWidth=ut.borderWidth);const L=ut;return Object.keys(ut).forEach(j=>{const O=ut[j];Array.isArray(O)&&O.length===2&&!R(O[0])&&!R(O[1])&&(L[j]={field:O[0],value:O[1]})}),this.encodeStyle(L),this.updateLayerConfig(L),this}encodeStyle(I){Object.keys(I).forEach(G=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(G)&&Z(I[G])&&(I[G].field||I[G].value)&&!C(this.encodeStyleAttribute[G],I[G])?(this.encodeStyleAttribute[G]=I[G],this.updateStyleAttribute(G,I[G].field,I[G].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[G]&&(delete this.encodeStyleAttribute[G],this.dataState.dataSourceNeedUpdate=!0)})}scale(I,G){const ut=(0,a.Z)({},this.scaleOptions);if(M(I)?this.scaleOptions=(0,a.Z)((0,a.Z)({},this.scaleOptions),I):this.scaleOptions[I]=G,this.styleAttributeService&&!C(ut,this.scaleOptions)){const L=M(I)?I:{[I]:G};this.styleAttributeService.updateScaleAttribute(L)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(I={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(I),this))}renderMultiPass(){var I=this;return(0,i.Z)(function*(){I.encodeDataLength<=0&&!I.forceRender||(I.multiPassRenderer&&I.multiPassRenderer.getRenderFlag()?yield I.multiPassRenderer.render():I.renderModels())})()}active(I){const G={};return G.enableHighlight=M(I)?!0:I,M(I)?(G.enableHighlight=!0,I.color&&(G.highlightColor=I.color),I.mix&&(G.activeMix=I.mix)):G.enableHighlight=!!I,this.updateLayerConfig(G),this}setActive(I,G){if(M(I)){const{x:ut=0,y:L=0}=I;this.updateLayerConfig({highlightColor:M(G)?G.color:this.getLayerConfig().highlightColor,activeMix:M(G)?G.mix:this.getLayerConfig().activeMix}),this.pick({x:ut,y:L})}else this.updateLayerConfig({pickedFeatureID:I,highlightColor:M(G)?G.color:this.getLayerConfig().highlightColor,activeMix:M(G)?G.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call((0,l.Z6)(I)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(I){const G={};return G.enableSelect=M(I)?!0:I,M(I)?(G.enableSelect=!0,I.color&&(G.selectColor=I.color),I.mix&&(G.selectMix=I.mix)):G.enableSelect=!!I,this.updateLayerConfig(G),this}setSelect(I,G){if(M(I)){const{x:ut=0,y:L=0}=I;this.updateLayerConfig({selectColor:M(G)?G.color:this.getLayerConfig().selectColor,selectMix:M(G)?G.mix:this.getLayerConfig().selectMix}),this.pick({x:ut,y:L})}else this.updateLayerConfig({pickedFeatureID:I,selectColor:M(G)?G.color:this.getLayerConfig().selectColor,selectMix:M(G)?G.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,l.Z6)(I)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(I){return this.updateLayerConfig({blend:I}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(I){return this.zIndex=I,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(I){this.currentPickId=I}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(I){this.selectedFeatureID=I}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const I=this.mapService.getZoom(),{visible:G,minZoom:ut=-1/0,maxZoom:L=1/0}=this.getLayerConfig();return!!G&&I>=ut&&I<L}setMultiPass(I,G){if(this.updateLayerConfig({enableMultiPassRenderer:I}),G&&this.updateLayerConfig({passes:G}),I){const{passes:ut=[]}=this.getLayerConfig();this.multiPassRenderer=(0,o.N)(this,ut,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:L,height:j}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(L,j)}return this}setMinZoom(I){return this.updateLayerConfig({minZoom:I}),this}getMinZoom(){const{minZoom:I}=this.getLayerConfig();return I}getMaxZoom(){const{maxZoom:I}=this.getLayerConfig();return I}get(I){return this.getLayerConfig()[I]}setMaxZoom(I){return this.updateLayerConfig({maxZoom:I}),this}setAutoFit(I){return this.updateLayerConfig({autoFit:I}),this}fitBounds(I){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const ut=this.getSource().extent;return ut.some(j=>Math.abs(j)===1/0)?this:(this.mapService.fitBounds([[ut[0],ut[1]],[ut[2],ut[3]]],I),this)}destroy(I=!0){var G,ut,L,j,O;if(this.isDestroyed)return;(G=this.layerModel)===null||G===void 0||G.uniformBuffers.forEach(_=>{_.destroy()}),this.layerChildren.map(_=>_.destroy(!1)),this.layerChildren=[];const{maskfence:B}=this.getLayerConfig();B&&(this.masks.map(_=>_.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(ut=this.multiPassRenderer)===null||ut===void 0||ut.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(L=this.layerModel)===null||L===void 0||L.clearModels(I),(j=this.tileLayer)===null||j===void 0||j.destroy(),this.models=[],(O=this.debugService)===null||O===void 0||O.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var I;this.models.forEach(G=>G.destroy()),(I=this.layerModel)===null||I===void 0||I.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(I=>I.needRescale||I.needRemapping||I.needRegenerateVertices).length}setSource(I){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=I,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const G=this.mapService.getZoom();this.layerSource.updateClusterData(G)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:G})=>{if(this.coordCenter===void 0){const ut=this.layerSource.center;this.coordCenter=ut}if(G==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(I){this.encodedData=I,this.encodeDataLength=I.length}getEncodedData(){return this.encodedData}getScale(I){return this.styleAttributeService.getLayerAttributeScale(I)}getLegend(I){var G,ut,L;const j=this.styleAttributeService.getLayerStyleAttribute(I);return{type:(ut=((j==null||(G=j.scale)===null||G===void 0?void 0:G.scalers)||[])[0])===null||ut===void 0||(ut=ut.option)===null||ut===void 0?void 0:ut.type,field:j==null||(L=j.scale)===null||L===void 0?void 0:L.field,items:this.getLegendItems(I)}}getLegendItems(I){const G=this.styleAttributeService.getLayerAttributeScale(I);return G?G.invertExtent?G.range().map(L=>({value:G.invertExtent(L),[I]:L})):G.ticks?G.ticks().map(L=>({value:L,[I]:G(L)})):G!=null&&G.domain?G.domain().filter(L=>!rt(L)).map(L=>({value:L,[I]:G(L)})):[]:[]}pick({x:I,y:G}){this.interactionService.triggerHover({x:I,y:G})}boxSelect(I,G){this.pickingService.boxPickLayer(this,I,G)}buildLayerModel(I){var G=this;return(0,i.Z)(function*(){const{moduleName:ut,vertexShader:L,fragmentShader:j,defines:O,inject:B,triangulation:_,styleOption:H,pickingEnabled:U=!0}=I,V=(0,u.Z)(I,b);G.shaderModuleService.registerModule(ut,{vs:L,fs:j,defines:O,inject:B});const{vs:D,fs:lt,uniforms:J}=G.shaderModuleService.getModule(ut),{createModel:Rt}=G.rendererService;return new Promise(kt=>{const{attributes:ne,elements:re,count:It}=G.styleAttributeService.createAttributesAndIndices(G.encodedData,_,H,G),Nt=[...G.layerModel.uniformBuffers,...G.rendererService.uniformBuffers];U&&Nt.push(G.getPickingUniformBuffer());const p=(0,a.Z)({attributes:ne,uniforms:J,fs:lt,vs:D,elements:re,blend:A.y[m.h0.normal],uniformBuffers:Nt,textures:G.layerModel.textures},V);It&&(p.count=It);const w=Rt(p);kt(w)})})()}createAttributes(I){const{triangulation:G}=I,{attributes:ut}=this.styleAttributeService.createAttributes(this.encodedData,G);return ut}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(I){const{enableHighlight:G=!0,enableSelect:ut=!0}=this.getLayerConfig();let L=this.eventNames().indexOf(I)!==-1||this.eventNames().indexOf("un"+I)!==-1;return(I==="click"||I==="dblclick")&&ut&&(L=!0),I==="mousemove"&&(G||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(L=!0),this.isVisible()&&L}buildModels(){return(0,i.Z)(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var I=this;return(0,i.Z)(function*(){yield I.buildModels()})()}renderMulPass(I){return(0,i.Z)(function*(){yield I.render()})()}renderModels(I={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(G=>{G.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(I),textures:this.layerModel.textures},(I==null?void 0:I.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(I,G,ut,L){const j=this.configService.getAttributeConfig(this.id)||{};return C(j[I],{field:G,values:ut})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(I)!==-1&&this.configService.setAttributeConfig(this.id,{[I]:{field:G,values:ut}}),this.startInit?this.styleAttributeService.updateStyleAttribute(I,{scale:(0,a.Z)({field:G},this.splitValuesAndCallbackInAttribute(ut,this.getLayerConfig()[G]))},L):this.pendingStyleAttributes.push({attributeName:I,attributeField:G,attributeValues:ut,updateOptions:L}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(I){console.warn("empty fn")}processData(I){return I}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var I=this;return(0,i.Z)(function*(){I.models.forEach(ut=>ut.destroy()),I.models=[],I.uniformBuffers.forEach(ut=>{ut.destroy()}),I.uniformBuffers=[];const G=I.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});I.uniformBuffers.push(G),I.models=yield I.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(I){return{values:X(I)?void 0:I,callback:X(I)?I:void 0}}}},98422:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>o}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(71590),d=e(64939);if(!/^(1887|7596)$/.test(e.j))var m=e(9868);if(!/^(1887|7596)$/.test(e.j))var l=e(32449);if(!/^(1887|7596)$/.test(e.j))var r=e(36307);if(!/^(1887|7596)$/.test(e.j))var h=e(92445);if(!/^(1887|7596)$/.test(e.j))var g=e(36554);const A="ATTRIBUTE_LOCATION_";class o{get attributeLocation(){return(0,i.Z)({},r.F)}constructor(E){(0,a.Z)(this,"triangulation",void 0),(0,a.Z)(this,"uniformBuffers",[]),(0,a.Z)(this,"textures",[]),(0,a.Z)(this,"createTexture2D",void 0),(0,a.Z)(this,"preStyleAttribute",{}),(0,a.Z)(this,"encodeStyleAttribute",{}),(0,a.Z)(this,"layer",void 0),(0,a.Z)(this,"dataTexture",void 0),(0,a.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,a.Z)(this,"dataTextureTest",void 0),(0,a.Z)(this,"configService",void 0),(0,a.Z)(this,"shaderModuleService",void 0),(0,a.Z)(this,"rendererService",void 0),(0,a.Z)(this,"iconService",void 0),(0,a.Z)(this,"fontService",void 0),(0,a.Z)(this,"styleAttributeService",void 0),(0,a.Z)(this,"mapService",void 0),(0,a.Z)(this,"cameraService",void 0),(0,a.Z)(this,"layerService",void 0),(0,a.Z)(this,"pickingService",void 0),(0,a.Z)(this,"attributeUnifoms",void 0),(0,a.Z)(this,"commonUnifoms",void 0),this.layer=E,this.configService=E.getContainer().globalConfigService,this.rendererService=E.getContainer().rendererService,this.pickingService=E.getContainer().pickingService,this.shaderModuleService=E.getContainer().shaderModuleService,this.styleAttributeService=E.getContainer().styleAttributeService,this.mapService=E.getContainer().mapService,this.iconService=E.getContainer().iconService,this.fontService=E.getContainer().fontService,this.cameraService=E.getContainer().cameraService,this.layerService=E.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:b}=this.rendererService;this.createTexture2D=b}getBlend(){const{blend:E="normal"}=this.layer.getLayerConfig();return m.y[c.h0[E]]}getStencil(E){const{mask:b=!1,maskInside:C=!0,enableMask:X,maskOperation:R=c.lE.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return(0,l.o)({isStencil:!0,stencilType:c.yn.SINGLE});if(E.isStencil)return(0,l.o)((0,i.Z)((0,i.Z)({},E),{},{maskOperation:R}));const M=b||X&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return(0,l.F)(M,C)}getDefaultStyle(){return{}}getUninforms(){const E=this.getCommonUniformsInfo(),b=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const C=(0,i.Z)((0,i.Z)({},b.uniformsOption),E.uniformsOption);return Object.keys(C).forEach(X=>{typeof C[X]=="boolean"&&(C[X]=C[X]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(C.u_texture=this.textures[0]),C}getAnimateUniforms(){return{}}needUpdate(){return(0,u.Z)(function*(){return!1})()}buildModels(){return(0,u.Z)(function*(){throw new Error("Method not implemented.")})()}initModels(){return(0,u.Z)(function*(){throw new Error("Method not implemented.")})()}clearModels(E=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(E){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(E){return[E.enable?0:1,E.duration||4,E.interval||.2,E.trailLength||.1]}startModelAnimate(){const{animateOption:E}=this.layer.getLayerConfig();E.enable&&this.layer.setAnimateStartTime()}getInject(){return S(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){const E=Object.keys(this.attributeLocation).reduce((b,C)=>{const X=A+C;return b[X]=this.attributeLocation[C],b},{});return(0,i.Z)({},E)}getStyleAttribute(){const E={};return this.layer.enableShaderEncodeStyles.forEach(b=>{if(!this.layer.encodeStyleAttribute[b]){const C=this.layer.getLayerConfig()[b];let X=typeof C>"u"?h.O[b]:C;b==="stroke"&&(X=(0,d.CI)(X)),E["u_"+b]=X}}),E}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(E=>{const b=(0,r.C)(E);b&&this.styleAttributeService.registerStyleAttribute(b)})}registerPosition64LowAttribute(E=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:c.GC.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:c.gl.FLOAT},size:2,update:(b,C,X)=>E?[(0,d.Ks)(X[0]),(0,d.Ks)(X[1])]:[0,0]}})}updateEncodeAttribute(E,b){this.encodeStyleAttribute[E]=b}initUniformsBuffer(){const E=this.getUniformsBufferInfo(this.getStyleAttribute()),b=this.getCommonUniformsInfo();E.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array((0,g.I)(E.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),b.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array((0,g.I)(b.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(E){let b=0;const C=[];return Object.values(E).forEach(X=>{Array.isArray(X)?(C.push(...X),b+=X.length):typeof X=="number"?(C.push(X),b+=1):typeof X=="boolean"&&(C.push(Number(X)),b+=1)}),{uniformsOption:E,uniformsLength:b,uniformsArray:C}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var E,b;const{uniformsArray:C}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:X}=this.getCommonUniformsInfo();(E=this.attributeUnifoms)===null||E===void 0||E.subData({offset:0,data:new Uint8Array(new Float32Array(C).buffer)}),(b=this.commonUnifoms)===null||b===void 0||b.subData({offset:0,data:new Uint8Array(new Float32Array(X).buffer)})}}function S(T,E){const b=[];let C="";T.forEach(M=>{const Z=M.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),rt=A+Z;E[M]?C+=`#define USE_ATTRIBUTE_${Z} 0.0 
`:b.push(`  ${h.a[M]} u_${M};`),C+=`
#ifdef USE_ATTRIBUTE_${Z}
layout(location = ${rt}) in ${h.a[M]} a_${M.charAt(0).toUpperCase()+M.slice(1)};
#endif 
`});const X=b.length?`
layout(std140) uniform AttributeUniforms {
  ${b.join(`
`)}
};
`:"";C+=X;let R="";return T.forEach(M=>{const Z=M.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();R+=`
  #ifdef USE_ATTRIBUTE_${Z}
    ${h.a[M]} ${M} = a_${M.charAt(0).toUpperCase()+M.slice(1)};
  #else
    ${h.a[M]} ${M} = u_${M};
  #endif
  `}),{"vs:#decl":C,"fs:#decl":X,"vs:#main-start":R}}},36307:(Xt,K,e)=>{"use strict";e.d(K,{C:()=>a,F:()=>i});var u=e(71590);const i={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function a(c){switch(c){case"rotation":return{name:"Rotation",type:u.GC.Attribute,descriptor:{name:"a_Rotation",shaderLocation:i.ROTATION,buffer:{usage:u.gl.DYNAMIC_DRAW,data:[],type:u.gl.FLOAT},size:1,update:d=>{const{rotation:m=0}=d;return Array.isArray(m)?[m[0]]:[m]}}};case"stroke":return{name:"stroke",type:u.GC.Attribute,descriptor:{name:"a_Stroke",shaderLocation:i.STROKE,buffer:{usage:u.gl.DYNAMIC_DRAW,data:[],type:u.gl.FLOAT},size:4,update:d=>{const{stroke:m=[1,1,1,1]}=d;return m}}};case"opacity":return{name:"opacity",type:u.GC.Attribute,descriptor:{name:"a_Opacity",shaderLocation:i.OPACITY,buffer:{usage:u.gl.STATIC_DRAW,data:[],type:u.gl.FLOAT},size:1,update:d=>{const{opacity:m=1}=d;return[m]}}};case"offsets":return{name:"offsets",type:u.GC.Attribute,descriptor:{name:"a_Offsets",shaderLocation:i.OFFSETS,buffer:{usage:u.gl.STATIC_DRAW,data:[],type:u.gl.FLOAT},size:2,update:d=>{const{offsets:m}=d;return m}}};default:return}}},65748:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(64939);class d{constructor(l){(0,a.Z)(this,"layer",void 0),this.layer=l}pickRender(l){const h=this.layer.getContainer().layerService,g=this.layer;if(g.tileLayer)return g.tileLayer.pickRender(l);g.hooks.beforePickingEncode.call(),h.renderTileLayerMask(g),g.renderModels({ispick:!0}),g.hooks.afterPickingEncode.call()}pick(l,r){var h=this;return(0,i.Z)(function*(){const A=h.layer.getContainer().pickingService;return l.type==="RasterLayer"?h.pickRasterLayer(l,r):(h.pickRender(r),A.pickFromPickingFBO(l,r))})()}pickRasterLayer(l,r,h){const g=this.layer.getContainer(),A=g.pickingService,o=g.mapService,S=this.layer.getSource().extent,T=(0,c.if)(r.lngLat,S),E={x:r.x,y:r.y,type:r.type,lngLat:r.lngLat,target:r,rasterValue:null},b=h||l;if(T){const C=this.readRasterValue(l,S,o,r.x,r.y);return E.rasterValue=C,A.triggerHoverOnLayer(b,E),!0}else return E.type=r.type==="mousemove"?"mouseout":"un"+r.type,A.triggerHoverOnLayer(b,(0,u.Z)((0,u.Z)({},E),{},{type:"unpick"})),A.triggerHoverOnLayer(b,E),!1}readRasterValue(l,r,h,g,A){const o=l.getSource().data.dataArray[0],[S=0,T=0,E=10,b=-10]=r,C=h.lngLatToContainer([S,T]),X=h.lngLatToContainer([E,b]),R=X.x-C.x,M=C.y-X.y,Z=[(g-C.x)/R,(A-X.y)/M],rt=o.width||1,N=o.height||1,Q=Math.floor(Z[0]*rt),ft=Math.floor(Z[1]*N),I=Math.max(0,ft-1)*rt+Q;return o.data[I]}selectFeature(l){const r=this.layer,[h,g,A]=l;r.hooks.beforeSelect.call([h,g,A])}highlightPickedFeature(l){const[r,h,g]=l;this.layer.hooks.beforeHighlight.call([r,h,g])}getFeatureById(l){return this.layer.getSource().getFeatureById(l)}}},53368:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(4942);var i=e(64939);class a{constructor(d){(0,u.Z)(this,"layer",void 0),(0,u.Z)(this,"rendererService",void 0),(0,u.Z)(this,"colorTexture",void 0),(0,u.Z)(this,"key",void 0),this.layer=d;const m=this.layer.getContainer();this.rendererService=m.rendererService}getColorTexture(d,m){const l=this.getTextureKey(d,m);return this.key===l?this.colorTexture:(this.createColorTexture(d,m),this.key=l,this.colorTexture)}createColorTexture(d,m){const{createTexture2D:l}=this.rendererService,r=this.getColorRampBar(d,m),h=l({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1,unorm:!0});return this.colorTexture=h,h}setColorTexture(d,m,l){this.key=this.getTextureKey(m,l),this.colorTexture=d}destroy(){var d;(d=this.colorTexture)===null||d===void 0||d.destroy()}getColorRampBar(d,m){switch(d.type){case"cat":return(0,i.hj)(d);case"quantize":return(0,i.NJ)(d);case"custom":return(0,i.Oc)(d,m);case"linear":return(0,i.M4)(d,m);default:return(0,i.Cl)(d)}}getTextureKey(d,m){var l;return`${d.colors.join("_")}_${d==null||(l=d.positions)===null||l===void 0?void 0:l.join("_")}_${d.type}_${m==null?void 0:m.join("_")}`}}},92445:(Xt,K,e)=>{"use strict";e.d(K,{O:()=>u,a:()=>i});const u={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},i={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"}},76514:(Xt,K,e)=>{"use strict";e.d(K,{Fy:()=>d,cA:()=>i,qy:()=>a,xg:()=>c,zW:()=>u});let u=function(m){return m[m.solid=0]="solid",m[m.dash=1]="dash",m}({}),i=function(m){return m.VERTICAL="vertical",m.HORIZONTAL="horizontal",m}({}),a=function(m){return m.NORMAL="normal",m.REPLACE="replace",m}({}),c=function(m){return m[m.pixel=0]="pixel",m[m.meter=1]="meter",m}({}),d=function(m){return m.ALWAYS="always",m.DRAGEND="dragend",m}({})},80003:(Xt,K,e)=>{"use strict";if(e.d(K,{nW:()=>c}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(11863);function a(l){const r=l.coordinates.flat(),h=1,g=1;return{vertices:[1,0,0,...r,1,2,-3,...r,1,1,-3,...r,0,1,0,...r,0,0,0,...r,1,0,0,...r,1,2,-3,...r,1,1,-3,...r,0,1,0,...r,0,0,0,...r],normals:[-h,2*g,1,2*g,-g,1,g,-g,1,g,-g,1,-h,-g,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function c(l,r){return r?d(l,r):a(l)}function d(l,r){const h=l.coordinates.flat(),{target:g="classic",source:A="circle"}=r,o=m((0,i.sS)(A,"source"),h,0,0),S=(0,i.s3)(h,o.vertices.length/7,r),T=m((0,i.sS)(g,"target"),h,1,o.vertices.length/7+S.vertices.length/7);return{vertices:[...o.vertices,...S.vertices,...T.vertices],indices:[...o.outLineIndices,...S.outLineIndices,...T.outLineIndices,...o.indices,...S.indices,...T.indices],normals:[...o.normals,...S.normals,...T.normals],size:7}}function m(l,r,h=1,g=0){const A=[],{vertices:o,indices:S,dimensions:T,outLineIndices:E}=l;for(let b=0;b<o.length;b+=T)A.push(h,o[b+1],o[b],...r);return(0,u.Z)((0,u.Z)({},l),{},{vertices:A,indices:S.map(b=>b+g),outLineIndices:E.map(b=>b+g)})}},64753:(Xt,K,e)=>{"use strict";e.d(K,{SE:()=>h,Xw:()=>c});let u=function(g){return g.CYLINDER="cylinder",g.SQUARECOLUMN="squareColumn",g.TRIANGLECOLUMN="triangleColumn",g.HEXAGONCOLUMN="hexagonColumn",g.PENTAGONCOLUMN="pentagonColumn",g}({}),i=function(g){return g.CIRCLE="circle",g.SQUARE="square",g.TRIANGLE="triangle",g.HEXAGON="hexagon",g.PENTAGON="pentagon",g}({});function a(g,A=0){const o=Math.PI*2/g,S=[];for(let E=0;E<g;E++)S.push(o*E+A*Math.PI/12);return S.map(E=>{const b=Math.sin(E+Math.PI/4),C=Math.cos(E+Math.PI/4);return[b,C,0]})}function c(){return a(30)}function d(){return a(4)}function m(){return a(3)}function l(){return a(6,1)}function r(){return a(5)}const h={[i.CIRCLE]:c,[i.HEXAGON]:l,[i.TRIANGLE]:m,[i.SQUARE]:d,[i.PENTAGON]:r,[u.CYLINDER]:c,[u.HEXAGONCOLUMN]:l,[u.TRIANGLECOLUMN]:m,[u.SQUARECOLUMN]:d,[u.PENTAGONCOLUMN]:r}},11863:(Xt,K,e)=>{"use strict";e.d(K,{s3:()=>o,sS:()=>S});var u=e(9187),i=e.n(u);if(!/^(1887|7596)$/.test(e.j))var a=e(64753);const c={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},d=/^(1887|7596)$/.test(e.j)?null:1/2;function m(T,E){const{width:b=2,height:C=1}=E;return{vertices:[0,d*T,1*T*b,-(C+d)*T,1*T*b,(C-d)*T,0,d*T,1*T*b,-(C+d)*T,1*T*b,(C-d)*T],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*T,-2*T,1,-2*T,1.5*T,1,1*T,1.5*T,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function l(T,E){const{width:b=2,height:C=3}=E;return{vertices:[0,0,1*T*b,1*C,1*T*b,-1*C,0,0,1*T*b,1*C,1*T*b,-1*C],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*T,1,2,1*T,1,-2,1*T,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function r(T,E){const{width:b=2,height:C=2}=E;return{vertices:[0,C/2,T*b*1,C/2,T*b*1,-C/2,0,-C/2,0,C/2,T*b*1,C/2,T*b*1,-C/2,0,-C/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-T,1,1,0,1,0,-T,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function h(T,E){const{width:b=2,height:C=3}=E;return{vertices:[0,0,1*b*T,.5*C,2*b*T,0,1*b*T,-.5*C,0,0,1*b*T,.5*C,2*b*T,0,1*b*T,-.5*C],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-T,1,1,0,1,0,-T,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function g(T,E){const{width:b=2,height:C=3}=E;return{vertices:[0,0,2*T*b,1*C,1.5*T*b,0,2*T*b,-1*C,0,0,2*T*b,1*C,1.5*T*b,0,2*T*b,-1*C],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-T,1,1,0,1,0,-T,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function A(T,E){const{width:b=2,height:C=2}=E,X=(0,a.Xw)(),R=i().flatten([X]),M=i()(R.vertices,R.holes,R.dimensions),Z=X.map(rt=>[rt[0]*b*T,rt[1]*C]).flat();return{vertices:[...Z,...Z],dimensions:2,indices:M.map(rt=>rt+X.length),outLineIndices:M,normals:[...X.map(rt=>[rt[1]*C,rt[0]*b*T,1]).flat(),...new Array(X.length*3).fill(0)]}}function o(T,E=0,b){const C=typeof b.source=="object"?b.source.type:b.source,X=typeof b.target=="object"?b.target.type:b.target,{width:R=C?c[C]:0}=typeof b.source=="object"?b.source:{},{width:M=X?c[X]:0}=typeof b.target=="object"?b.target:{};return{vertices:[0,d,1*R,...T,1,d,-1*M,...T,1,-d,-1*M,...T,0,-d,1*R,...T,0,d,1*R,...T,1,d,-1*M,...T,1,-d,-1*M,...T,0,-d,1*R,...T],outLineIndices:[0,1,2,0,2,3].map(Z=>Z+E),indices:[4,5,6,4,6,7].map(Z=>Z+E),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function S(T,E){const b=typeof T=="object"?T.type:T,C=E==="source"?1:-1,X=typeof T=="object"?T:{};switch(b){case"circle":return A(C,X);case"triangle":return l(C,X);case"diamond":return h(C,X);case"rect":return r(C,X);case"classic":return g(C,X);case"halfTriangle":return m(C,X);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}},34785:(Xt,K,e)=>{"use strict";e.d(K,{Fx:()=>l,Hd:()=>r,ZP:()=>m});var u=e(64939),i=e(9187),a=e.n(i);if(!/^(1887|7596)$/.test(e.j))var c=e(77160);if(!/^(1887|7596)$/.test(e.j))var d=e(36554);function m(g){const A=g[0][0],o=g[0][g[0].length-1];A[0]===o[0]&&A[1]===o[1]&&(g[0]=g[0].slice(0,g[0].length-1));const S=g[0].length,T=a().flatten(g),{vertices:E,dimensions:b}=T,C=[],X=[];for(let M=0;M<E.length/b;M++)b===2?C.push(E[M*2],E[M*2+1],1):C.push(E[M*3],E[M*3+1],1);const R=a()(T.vertices,T.holes,T.dimensions);X.push(...R);for(let M=0;M<S;M++){const Z=T.vertices.slice(M*b,(M+1)*b);let rt=T.vertices.slice((M+1)*b,(M+2)*b);rt.length===0&&(rt=T.vertices.slice(0,b));const N=C.length/3;C.push(Z[0],Z[1],1,rt[0],rt[1],1,Z[0],Z[1],0,rt[0],rt[1],0),X.push(...[0,2,1,2,3,1].map(Q=>Q+N))}return{positions:C,index:X}}function l(g){const A=a().flatten(g),o=a()(A.vertices,A.holes,A.dimensions);return{positions:A.vertices,index:o}}function r(g,A=!1){const o=g[0][0],S=g[0][g[0].length-1];o[0]===S[0]&&o[1]===S[1]&&(g[0]=g[0].slice(0,g[0].length-1));const T=g[0].length,E=a().flatten(g),{vertices:b,dimensions:C,holes:X}=E,R=[],M=[],Z=[];for(let N=0;N<b.length/C;N++)R.push(b[N*C],b[N*C+1],1,-1,-1),Z.push(0,0,1);const rt=(0,d.c)(b,X,C,A);M.push(...rt);for(let N=0;N<T;N++){const Q=E.vertices.slice(N*C,(N+1)*C);let ft=E.vertices.slice((N+1)*C,(N+2)*C);ft.length===0&&(ft=E.vertices.slice(0,C));const I=R.length/5;R.push(Q[0],Q[1],1,0,0,ft[0],ft[1],1,.1,0,Q[0],Q[1],0,0,.8,ft[0],ft[1],0,.1,.8);const G=h([ft[0],ft[1],1],[Q[0],Q[1],0],[Q[0],Q[1],1],A);Z.push(...G,...G,...G,...G),M.push(...[1,2,0,3,2,1].map(ut=>ut+I))}return{positions:R,index:M,normals:Z}}function h(g,A,o,S=!1){const T=c.Ue(),E=c.Ue(),b=c.Ue();S&&(g=(0,u.vP)(g),A=(0,u.vP)(A),o=(0,u.vP)(o));const C=c.al(...g),X=c.al(...A),R=c.al(...o);c.lu(T,R,X),c.lu(E,C,X),c.kC(b,T,E);const M=c.Ue();return c.Fv(M,b),M}},42659:(Xt,K,e)=>{"use strict";e.d(K,{$4:()=>ut,NM:()=>o,NW:()=>V,Qr:()=>rt,Rs:()=>I,S:()=>A,T3:()=>N,Xz:()=>ft,iC:()=>G,oX:()=>g,qZ:()=>D,sN:()=>T,us:()=>b,xH:()=>S,zO:()=>L});var u=e(64939),i=e(9187),a=e.n(i);if(!/^(1887|7596)$/.test(e.j))var c=e(90440);if(!/^(1887|7596)$/.test(e.j))var d=e(50181);if(!/^(1887|7596)$/.test(e.j))var m=e(64753);if(!/^(1887|7596)$/.test(e.j))var l=e(34785);if(!/^(1887|7596)$/.test(e.j))var r=e(36554);const h={};function g(lt){const J=(0,u.SI)(lt.coordinates);return{vertices:[...J,...J,...J,...J],indices:[0,1,2,2,3,0],size:J.length}}function A(lt){const J=(0,u.SI)(lt.coordinates),Rt=(0,c.rq)(J);return{vertices:[...Rt,...Rt,...Rt,...Rt],indices:[0,1,2,2,3,0],size:Rt.length}}function o(lt){const{shape:J}=lt,{positions:Rt,index:kt,normals:ne}=j(J,!1);return{vertices:Rt,indices:kt,normals:ne,size:5}}function S(lt){const J=(0,u.SI)(lt.coordinates);return{vertices:[...J],indices:[0],size:J.length}}function T(lt){const{coordinates:J}=lt,Rt=new d.ZP({dash:!0,join:"bevel"});let kt=J;kt[0]&&!Array.isArray(kt[0][0])&&(kt=[J]),kt.forEach(re=>{Rt.extrude(re)});const ne=Rt.complex;return{vertices:ne.positions,indices:ne.indices,normals:ne.normals,indexes:ne.indexes,size:6}}function E(lt){const J=lt.coordinates.flat(),Rt=1,kt=1;return{vertices:[1,0,0,...J,1,2,-3,...J,1,1,-3,...J,0,1,0,...J,0,0,0,...J,1,0,0,...J,1,2,-3,...J,1,1,-3,...J,0,1,0,...J,0,0,0,...J],normals:[-Rt,2*kt,1,2*kt,-kt,1,kt,-kt,1,kt,-kt,1,-Rt,-kt,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function b(lt){const{coordinates:J}=lt,Rt=[];if(!Array.isArray(J[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:kt,totalDistance:ne}=M(J);return kt.map(re=>{Rt.push(re[0],re[1],re[2],re[3],0,ne)}),{vertices:Rt,indices:[],normals:[],size:6,count:kt.length}}function C(lt){const{coordinates:J}=lt,Rt=[];if(!Array.isArray(J[0]))return{vertices:[],indices:[],size:4,count:0};const{results:kt}=Z(J);return kt.map(ne=>{Rt.push(ne[0],ne[1],ne[2],ne[3])}),{vertices:Rt,indices:[],size:4,count:kt.length}}function X(lt,J){const Rt=J[0]-lt[0],kt=J[1]-lt[1];return Math.sqrt(Rt*Rt+kt*kt)}function R(lt,J){return lt.length<3&&lt.push(0),J!==void 0&&lt.push(J),lt}function M(lt){let J=lt;Array.isArray(J)&&Array.isArray(J[0])&&Array.isArray(J[0][0])&&(J=lt.flat());let Rt=0;if(J.length<2)return{results:J,totalDistance:0};{const kt=[],ne=R(J[0],Rt);kt.push(ne);for(let It=1;It<J.length-1;It++){const Nt=X((0,u.Z)(J[It-1]),(0,u.Z)(J[It]));Rt+=Nt;const p=R(J[It],Rt);kt.push(p),kt.push(p)}const re=X((0,u.Z)(J[J.length-2]),(0,u.Z)(J[J.length-1]));return Rt+=re,kt.push(R(J[J.length-1],Rt)),{results:kt,totalDistance:Rt}}}function Z(lt){if(lt.length<2)return{results:lt};{const J=[],Rt=R(lt[0]);J.push(Rt);for(let kt=1;kt<lt.length-1;kt++){const ne=R(lt[kt]);J.push(ne),J.push(ne)}return J.push(R(lt[lt.length-1])),{results:J}}}function rt(lt){const{coordinates:J}=lt,Rt=a().flatten(J),{vertices:kt,dimensions:ne,holes:re}=Rt;return{indices:(0,r.c)(kt,re,ne),vertices:kt,size:ne}}function N(lt){const{indices:J,vertices:Rt,size:kt}=rt(lt);return{indices:J,vertices:Q(Rt),size:kt+4}}function Q(lt){const J=[],{center:Rt,radius:kt}=(0,u.Rx)(lt);for(let ne=0;ne<lt.length;ne+=2){const re=lt[ne],It=lt[ne+1];J.push(re,It,0,...Rt,kt)}return J}function ft(lt){const J=lt.coordinates,{positions:Rt,index:kt,normals:ne}=(0,l.Hd)(J,!0);return{vertices:Rt,indices:kt,normals:ne,size:5}}function I(lt){const{shape:J}=lt,{positions:Rt,index:kt}=H(J);return{vertices:Rt,indices:kt,size:3}}function G(lt){const J=lt.coordinates;return{vertices:[...J[0],0,0,0,...J[1],0,1,0,...J[2],0,1,1,...J[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function ut(lt,J){const{segmentNumber:Rt=30}=J,kt=lt.coordinates,ne=[],re=[];for(let It=0;It<Rt;It++)ne.push(It,1,It,kt[0][0],kt[0][1],kt[1][0],kt[1][1],It,-1,It,kt[0][0],kt[0][1],kt[1][0],kt[1][1]),It!==Rt-1&&re.push(...[0,1,2,1,3,2].map(Nt=>It*2+Nt));return{vertices:ne,indices:re,size:7}}function L(lt){const J=lt.coordinates;J.length===2&&J.push(0);const Rt=U(-1,1),kt=U(1,1),ne=U(-1,-1),re=U(1,-1);return{vertices:[...J,...Rt,...J,...ne,...J,...re,...J,...kt],indices:[0,1,2,3,0,2],size:5}}function j(lt,J=!1){if(h&&h[lt])return h[lt];const Rt=m.SE[lt]?m.SE[lt]():m.SE.cylinder(),kt=(0,l.Hd)([Rt],J);return h[lt]=kt,kt}function O(lt,J,Rt=3,kt=!1){const ne=new Float32Array(lt.length/Rt*3);let re,It,Nt;const p=vec3.create(),w=vec3.create(),W=vec3.create();for(let st=0,Tt=J.length;st<Tt;st+=3){re=J[st+0]*3,It=J[st+1]*3,Nt=J[st+2]*3;let Gt=[lt[re],lt[re+1]],ze=[lt[It],lt[It+1]],$e=[lt[Nt],lt[Nt+1]];kt&&(Gt=lngLatToMeters(Gt),ze=lngLatToMeters(ze),$e=lngLatToMeters($e));const[rn,gn]=Gt,nt=vec3.fromValues(rn,gn,lt[re+2]),[Ln,rr]=ze,tr=vec3.fromValues(Ln,rr,lt[It+2]),[sr,Br]=$e,fi=vec3.fromValues(sr,Br,lt[Nt+2]);vec3.sub(p,fi,tr),vec3.sub(w,nt,tr),vec3.cross(W,p,w),ne[re]+=p[0],ne[re+1]+=p[1],ne[re+2]+=p[2],ne[It]+=p[0],ne[It+1]+=p[1],ne[It+2]+=p[2],ne[Nt]+=p[0],ne[Nt+1]+=p[1],ne[Nt+2]+=p[2]}return B(ne),ne}function B(lt){for(let J=0,Rt=lt.length;J<Rt;J+=3){const kt=vec3.fromValues(lt[J],lt[J+1],lt[J+2]),ne=vec3.create();vec3.normalize(ne,kt),lt.set(ne,J)}}function _(lt){const J=lt[0][0],Rt=lt[0][lt[0].length-1];return J[0]===Rt[0]&&J[1]===Rt[1]}function H(lt){const J=["cylinder","triangleColumn","hexagonColumn","squareColumn"],Rt=m.SE[lt]?m.SE[lt]():m.SE.circle();return J.indexOf(lt)===-1?(0,l.Fx)([Rt]):(0,l.ZP)([Rt])}function U(lt,J){const Rt=(lt+1)/2,kt=(J+1)/2;return[Rt,kt]}function V(){const lt=(0,c.j7)(c.Y5,{segments:c.r1}),{positionsArr:J,indicesArr:Rt,normalArr:kt}=lt;return{vertices:J,indices:Rt,size:5,normals:kt}}function D(){const lt=(0,c.j7)(c.Y5+c.XJ,{segments:c.r1}),{positionsArr:J,indicesArr:Rt,normalArr:kt}=lt;return{vertices:J,indices:Rt,size:5,normals:kt}}},36554:(Xt,K,e)=>{"use strict";e.d(K,{I:()=>c,c:()=>d});var u=e(64939),i=e(9187),a=e.n(i);function c(m){return Math.max(Math.ceil(m/4)*4,4)}function d(m,l,r,h=!0){const g=r===3;if(h){m=m.slice();const o=[];for(let S=0;S<m.length;S+=r){o[0]=m[S],o[1]=m[S+1],g&&(o[2]=m[S+2]);const T=(0,u.vP)(o,!0,{enable:!1,decimal:1});m[S]=T[0],m[S+1]=T[1],g&&(m[S+2]=T[2])}}return a()(m,l,r)}},24238:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>Z});var u=e(15861),i=e(4942),a=e(54674),c=e(71590),d=e(64939),m=e(98422),l=e(42659);const r=`
layout(std140) uniform commonUniforms {
 float u_opacity;
};
in vec3 vVertexNormal;
in float v_offset;
in vec4 v_Color;

#pragma include "scene_uniforms"
out vec4 outputColor;
void main() {
    
    
    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
    // \u53BB\u9664\u80CC\u9762
    if(intensity > 1.0) intensity = 0.0;

    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,h=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 float u_opacity;
};

#pragma include "scene_uniforms"
out vec3 vVertexNormal;
out vec4 v_Color;
out float v_offset;

void main() {
    float EARTH_RADIUS = 100.0;

    v_Color = a_Color;

    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);
    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,{isNumber:g}=d.lodashUtil;class A extends m.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){const{opacity:N=1}=this.layer.getLayerConfig(),Q={u_opacity:g(N)?N:1};return this.getUniformsBufferInfo(Q)}initModels(){var N=this;return(0,u.Z)(function*(){return N.initUniformsBuffer(),N.buildModels()})()}clearModels(){return""}buildModels(){var N=this;return(0,u.Z)(function*(){return N.layer.zIndex=-997,[yield N.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:h,fragmentShader:r,defines:N.getDefines(),triangulation:l.NW,depth:{enable:!1},blend:N.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:c.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:c.gl.STATIC_DRAW,data:[],type:c.gl.FLOAT},size:3,update:(N,Q,ft,I,G)=>G}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}const o=`uniform sampler2D u_texture;

in vec2 v_texCoord;
in float v_lightWeight;
out vec4 outputColor;

void main() {
    vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
    color.xyz = color.xyz * v_lightWeight;
    outputColor = color;
}
`,S=`// attribute vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

// attribute vec2 a_Extrude;
// attribute float a_Size;
// attribute float a_Shape;

layout(std140) uniform commonUniforms {
	vec4 u_sunLight: [1.0, -10.5, 12.0,0.0];
	float u_ambientRatio : 0.5;
	float u_diffuseRatio : 0.3;
	float u_specularRatio : 0.2;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
out float v_lightWeight;

float calc_lighting(vec4 pos) {

	vec3 worldPos = vec3(pos * u_ModelMatrix);

	vec3 worldNormal = a_Normal;

	// cal light weight
	vec3 viewDir = normalize(u_CameraPosition - worldPos);

	vec3 lightDir = normalize(u_sunLight.xyz);

	vec3 halfDir = normalize(viewDir+lightDir);
	// lambert
	float lambert = dot(worldNormal, lightDir);
	// specular
	float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
	//sum to light weight
	float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;

	return lightWeight;
}

void main() {

	v_texCoord = a_Uv;

	float lightWeight = calc_lighting(vec4(a_Position, 1.0));
	v_lightWeight = lightWeight;

	gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`;class T extends m.Z{constructor(...N){super(...N),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"earthTime",3.4),(0,i.Z)(this,"sunX",1e3),(0,i.Z)(this,"sunY",1e3),(0,i.Z)(this,"sunZ",1e3),(0,i.Z)(this,"sunRadius",Math.sqrt(this.sunX*this.sunX+this.sunY*this.sunY+this.sunZ*this.sunZ))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){const{animateOption:N,globalOptions:Q}=this.layer.getLayerConfig();N!=null&&N.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY));const ft={u_sunLight:[this.sunX,this.sunY,this.sunZ,0],u_ambientRatio:(Q==null?void 0:Q.ambientRatio)||.6,u_diffuseRatio:(Q==null?void 0:Q.diffuseRatio)||.4,u_specularRatio:(Q==null?void 0:Q.specularRatio)||.1};return this.textures=[this.texture],this.getUniformsBufferInfo(ft)}setEarthTime(N){this.earthTime=N,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}initModels(){var N=this;return(0,u.Z)(function*(){const{globalOptions:Q}=N.layer.getLayerConfig();(Q==null?void 0:Q.earthTime)!==void 0&&N.setEarthTime(Q.earthTime);const ft=N.layer.getSource(),{createTexture2D:I}=N.rendererService;return N.texture=I({height:0,width:0}),ft.data.images.then(G=>{N.texture=I({data:G[0],width:G[0].width,height:G[0].height}),N.textures=[N.texture],N.layerService.reRender()}),N.initUniformsBuffer(),N.buildModels()})()}clearModels(){return""}buildModels(){var N=this;return(0,u.Z)(function*(){return N.layer.zIndex=-998,[yield N.layer.buildLayerModel({moduleName:"earthBase",vertexShader:S,fragmentShader:o,defines:N.getDefines(),triangulation:l.NW,depth:{enable:!0},blend:N.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:c.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:c.gl.STATIC_DRAW,data:[],type:c.gl.FLOAT},size:3,update:(N,Q,ft,I,G)=>G}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}const E=`
in vec3 vVertexNormal;
in vec4 v_Color;

layout(std140) uniform commonUniforms {
 float u_opacity;
};
out vec4 outputColor;
#pragma include "scene_uniforms"
void main() {
    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));
    // \u53BB\u9664\u80CC\u9762
    if(intensity > 1.0) intensity = 0.0;

    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,b=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 float u_opacity;
};
#pragma include "scene_uniforms"

out vec3 vVertexNormal;
out vec4 v_Color;

void main() {
    v_Color = a_Color;

    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,{isNumber:C}=d.lodashUtil;class X extends m.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){const{opacity:N=1}=this.layer.getLayerConfig(),Q={u_opacity:C(N)?N:1};return this.getUniformsBufferInfo(Q)}initModels(){var N=this;return(0,u.Z)(function*(){return N.initUniformsBuffer(),N.buildModels()})()}clearModels(){return""}buildModels(){var N=this;return(0,u.Z)(function*(){return N.layer.zIndex=-999,[yield N.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:b,fragmentShader:E,defines:N.getDefines(),triangulation:l.qZ,depth:{enable:!1},blend:N.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:c.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:c.gl.STATIC_DRAW,data:[],type:c.gl.FLOAT},size:3,update:(N,Q,ft,I,G)=>G}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}const R={base:T,atomSphere:A,bloomSphere:X},M=["base","atomSphere","bloomSphere"];class Z extends a.Z{constructor(...N){super(...N),(0,i.Z)(this,"type","EarthLayer"),(0,i.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}})}buildModels(){var N=this;return(0,u.Z)(function*(){const Q=N.getModelType();N.layerModel=new R[Q](N),yield N.initLayerModels()})()}setEarthTime(N){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(N):console.warn("\u8BF7\u5728 scene loaded \u4E4B\u540E\u6267\u884C\u8BE5\u65B9\u6CD5\uFF01")}getModelType(){var N;const Q=this.styleAttributeService.getLayerStyleAttribute("shape");let ft=(Q==null||(N=Q.scale)===null||N===void 0?void 0:N.field)||"base";return M.indexOf(ft)<0&&(ft="base"),ft}}},90440:(Xt,K,e)=>{"use strict";if(e.d(K,{XJ:()=>d,Y5:()=>a,j7:()=>r,r1:()=>c,rq:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(85975);if(!/^(1887|7596)$/.test(e.j))var i=e(77160);const a=100,c=36,d=40;function m(h){return h/180*Math.acos(-1)}function l(h){const g=m(h[0])+Math.PI/2,A=m(h[1]),o=a+Math.random()*.4,S=o*Math.cos(A)*Math.cos(g),T=o*Math.cos(A)*Math.sin(g),E=o*Math.sin(A);return[T,E,S]}function r(h,g){const A=u.Ue(),o=u.Ue(),S=i.al(0,1,0),T=i.al(0,0,0);g=g||{},h=typeof h<"u"?h:1;const b=2+(typeof g.segments<"u"?g.segments:32),C=2*b,X=[],R=[],M=[],Z=[],rt=[],N=[];for(let Q=0;Q<=b;Q++){const ft=Q/b,I=ft*Math.PI;for(let G=0;G<=C;G++){const ut=G/C,L=ut*Math.PI*2;u.yR(o),u.jI(o,o,-I),u.yR(A),u.uD(A,A,L),i.fF(T,S,o),i.fF(T,T,A),i.bA(T,T,-h),M.push(T.slice()),Z.push(...T.slice()),i.Fv(T,T),rt.push(...T.slice()),N.push([ut,1-ft]),Z.push(ut,1-ft)}if(Q>0){const G=M.length;let ut=G-2*(C+1);for(;ut+C+2<G;ut++)X.push([ut,ut+1,ut+C+1]),R.push(ut,ut+1,ut+C+1),X.push([ut+C+1,ut+1,ut+C+2]),R.push(ut+C+1,ut+1,ut+C+2)}}return{cells:X,positions:M,uvs:N,positionsArr:Z,indicesArr:R,normalArr:rt}}},35551:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(8495);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","GeometryLayer"),(0,i.Z)(this,"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}})}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}getDefaultConfig(){const l=this.getModelType();return{plane:{},sprite:{},billboard:{}}[l]}getModelType(){var l;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),h=r==null||(l=r.scale)===null||l===void 0?void 0:l.field;return h==="plane"?"plane":h==="sprite"?"sprite":h==="billboard"?"billboard":"plane"}}},8495:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>C});var u=e(15861),i=e(1413),a=e(4942),c=e(71590),d=e(98422);const m=`layout(std140) uniform commonUniforms {
 vec2 u_size;
 float u_raisingHeight;
 float u_rotation;
 float u_opacity;
};

uniform sampler2D u_texture;

in vec2 v_uv;
out vec4 outputColor;

#pragma include "picking"
void main() {
  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,l=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_size;
  float u_raisingHeight;
  float u_rotation;
  float u_opacity;
};

out vec2 v_uv;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"
void main() {
  vec3 extrude = a_Extrude;
  v_uv = a_Uv;
  float raiseHeight = u_raisingHeight;
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  // \u8BA1\u7B97\u7ECF\u7EAC\u5EA6\u70B9\u4F4D\u5750\u6807
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  // \u8BA1\u7B97\u7ED5 z \u8F74\u65CB\u8F6C\u540E\u7684\u504F\u79FB
  vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0), u_rotation));
  // \u7ED5 z \u8F74\u65CB\u8F6C
  float x = project_pos.x + offsetXY.x;
  float y = project_pos.y + offsetXY.y;
  // z \u8F74\u4E0D\u53C2\u4E0E\u65CB\u8F6C
  float z = project_pixel(extrude.y * u_size.y + raiseHeight);

  gl_Position = project_common_position_to_clipspace(vec4(x, y, z, 1.0));

  setPickingColor(a_PickingColor);
}
`;class r extends d.Z{constructor(...R){super(...R),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"radian",0),(0,a.Z)(this,"planeGeometryTriangulation",()=>{const{center:M=[120,30]}=this.layer.getLayerConfig();return{size:4,indices:[0,1,2,2,3,0],vertices:[...M,1,1,...M,0,1,...M,0,0,...M,1,0]}})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,EXTRUDE:9,UV:10})}getUninforms(){const R=this.getCommonUniformsInfo(),M=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},R.uniformsOption),M.uniformsOption)}getCommonUniformsInfo(){const{opacity:R,width:M=1,height:Z=1,raisingHeight:rt=0}=this.layer.getLayerConfig();let N=1;this.mapService.getType()==="amap"&&(N=-1),this.radian=N*Math.PI*(this.mapService.getRotation()%360)/180;const Q={u_size:[M,Z],u_raisingHeight:Number(rt),u_rotation:this.radian,u_opacity:R||1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(Q)}clearModels(){var R;(R=this.texture)===null||R===void 0||R.destroy()}initModels(){var R=this;return(0,u.Z)(function*(){const{drawCanvas:M}=R.layer.getLayerConfig(),{createTexture2D:Z}=R.rendererService;return R.texture=Z({height:0,width:0}),M&&R.updateTexture(M),R.initUniformsBuffer(),[yield R.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:l,fragmentShader:m,triangulation:R.planeGeometryTriangulation,defines:R.getDefines(),inject:R.getInject(),primitive:c.gl.TRIANGLES,depth:{enable:!0}})]})()}buildModels(){var R=this;return(0,u.Z)(function*(){return R.initModels()})()}updateTexture(R){const{createTexture2D:M}=this.rendererService,{canvasWidth:Z=1,canvasHeight:rt=1}=this.layer.getLayerConfig(),N=document.createElement("canvas");N.width=Z,N.height=rt,N.getContext("2d")&&(R(N),this.texture=M({data:N,width:N.width,height:N.height,wrapS:c.gl.CLAMP_TO_EDGE,wrapT:c.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:c.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:3,update:(R,M,Z,rt)=>{const N=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Q=rt%4*3;return[N[Q],N[Q+1],N[Q+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(R,M,Z)=>[Z[2],Z[3]]}})}}const h=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_terrainClipHeight;
};

in vec3 v_Color;
in vec2 v_uv;
in float v_clip;
out vec4 outputColor;

#pragma include "picking"
void main() {
  if (u_mapFlag > 0.0) {
    outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));
    outputColor.a *= u_opacity;
  } else {
    outputColor = vec4(v_Color, u_opacity);
  }
  outputColor.a *= v_clip;
  outputColor = filterColor(outputColor);
}
`,g=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_terrainClipHeight;
};

out vec3 v_Color;
out vec2 v_uv;
out float v_clip;

#pragma include "projection"
#pragma include "picking"
void main() {
  v_Color = a_Color;
  v_uv = a_Uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  v_clip = 1.0;
  if (a_Position.z < u_terrainClipHeight) {
    v_clip = 0.0;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));

  setPickingColor(a_PickingColor);
}
`;class A extends d.Z{constructor(...R){super(...R),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"terrainImage",void 0),(0,a.Z)(this,"terrainImageLoaded",!1),(0,a.Z)(this,"mapTexture",void 0),(0,a.Z)(this,"planeGeometryTriangulation",()=>{const{width:M=1,height:Z=1,widthSegments:rt=1,heightSegments:N=1,center:Q=[120,30],terrainTexture:ft,rgb2height:I=(L,j,O)=>L+j+O}=this.layer.getLayerConfig(),{indices:G,positions:ut}=this.initPlane(M,Z,rt,N,...Q);return ft?this.translateVertex(ut,G,this.terrainImage,rt,N,I):{vertices:ut,indices:G,size:5}})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:10})}initPlane(R=1,M=1,Z=1,rt=1,N=120,Q=30){const ft=R/2,I=M/2,G=Math.floor(Z),ut=Math.floor(rt),L=G+1,j=ut+1,O=R/G,B=M/ut,_=[],H=[];for(let U=0;U<j;U++){const V=U*B-I;for(let D=0;D<L;D++){const lt=D*O-ft;H.push(lt+N,-V+Q,0),H.push(D/G),H.push(1-U/ut)}}for(let U=0;U<ut;U++)for(let V=0;V<G;V++){const D=V+L*U,lt=V+L*(U+1),J=V+1+L*(U+1),Rt=V+1+L*U;_.push(D,lt,Rt),_.push(lt,J,Rt)}return{indices:_,positions:H}}getUninforms(){const R=this.getCommonUniformsInfo(),M=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},R.uniformsOption),M.uniformsOption)}getCommonUniformsInfo(){const{opacity:R,mapTexture:M,terrainClipHeight:Z=0,terrainTexture:rt}=this.layer.getLayerConfig();if(this.mapTexture!==M){var N;this.mapTexture=M,(N=this.texture)===null||N===void 0||N.destroy(),this.updateTexture(M)}const Q={u_opacity:R||1,u_mapFlag:M?1:0,u_terrainClipHeight:rt?Z:-1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(Q)}clearModels(){var R;this.terrainImage=null,(R=this.texture)===null||R===void 0||R.destroy(),this.textures=[]}initModels(){var R=this;return(0,u.Z)(function*(){const{mapTexture:M,terrainTexture:Z}=R.layer.getLayerConfig();R.mapTexture=M;const{createTexture2D:rt}=R.rendererService;return R.texture=rt({height:0,width:0}),R.updateTexture(M),R.initUniformsBuffer(),Z&&(R.terrainImage=yield R.loadTerrainImage(Z)),[yield R.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:g,fragmentShader:h,triangulation:R.planeGeometryTriangulation,defines:R.getDefines(),inject:R.getInject(),primitive:c.gl.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:c.gl.BACK}})]})()}buildModels(){var R=this;return(0,u.Z)(function*(){return R.initModels()})()}createModelData(R){if(R){const{widthSegments:rt,heightSegments:N,width:Q,height:ft}=this.layer.getLayerConfig(),{widthSegments:I,heightSegments:G,width:ut,height:L}=R;this.layer.style({widthSegments:I!==void 0?I:rt,heightSegments:G!==void 0?G:N,width:ut!==void 0?ut:Q,height:L!==void 0?L:ft})}const M=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(M,this.planeGeometryTriangulation)}updateTexture(R){const{createTexture2D:M}=this.rendererService;if(R){const Z=new Image;Z.crossOrigin="anonymous",Z.onload=()=>{this.texture=M({data:Z,width:Z.width,height:Z.height,wrapS:c.gl.CLAMP_TO_EDGE,wrapT:c.gl.CLAMP_TO_EDGE}),this.layerService.reRender()},Z.src=R}else this.texture=M({width:0,height:0})}getImageData(R){const M=document.createElement("canvas"),Z=M.getContext("2d"),{width:rt,height:N}=R;return M.width=rt,M.height=N,Z.drawImage(R,0,0,rt,N),Z.getImageData(0,0,rt,N)}translateVertex(R,M,Z,rt,N,Q){const ft=Z.width,I=Z.height,G=this.getImageData(Z).data,ut=Math.floor(rt),L=Math.floor(N),j=ut+1,O=L+1,B=ft/ut,_=I/L;for(let H=0;H<O;H++){const V=Math.floor(H*_)*ft;for(let D=0;D<j;D++){const lt=Math.floor(D*B),J=(V+lt)*4,Rt=G[J],kt=G[J+1],ne=G[J+2],re=(H*j+D)*5+2;R[re]=Q(Rt,kt,ne)}}return{vertices:R,indices:M,size:5}}loadTerrainImage(R){var M=this;return(0,u.Z)(function*(){if(M.terrainImage)return M.terrainImageLoaded?M.terrainImage:new Promise(Z=>{M.terrainImage.onload=()=>{Z(M.terrainImage)}});{const Z=new Image;return Z.crossOrigin="anonymous",new Promise(rt=>{Z.onload=()=>{M.terrainImageLoaded=!0,rt(Z),setTimeout(()=>M.layer.emit("terrainImageLoaded",null))},Z.src=R})}})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(R,M,Z)=>[Z[3],Z[4]]}})}}const o=`
layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_Scale;
};
uniform sampler2D u_texture;

in vec3 v_Color;
in float v_d;
out vec4 outputColor;

void main() {

  if(v_d < 0.0) {
    discard;
  }

  if(u_mapFlag > 0.0) {
    outputColor = texture(SAMPLER_2D(u_texture), gl_PointCoord);
    outputColor.a *= u_opacity;
  } else {
    outputColor = vec4(v_Color, u_opacity);
  }
}
`,S=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_Scale;
};

out vec3 v_Color;
out float v_d;

#pragma include "projection"
void main() {
  v_Color = a_Color.xyz;
  v_d = a_Position.z;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));
  gl_PointSize = pow(u_Zoom - 1.0, 2.0) * u_Scale;
}
`;var T=function(X){return X.UP="up",X.DOWN="down",X}(T||{});class E extends d.Z{constructor(...R){super(...R),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"mapTexture",void 0),(0,a.Z)(this,"positions",void 0),(0,a.Z)(this,"indices",void 0),(0,a.Z)(this,"timer",void 0),(0,a.Z)(this,"spriteTop",void 0),(0,a.Z)(this,"spriteUpdate",void 0),(0,a.Z)(this,"spriteAnimate",void 0),(0,a.Z)(this,"planeGeometryUpdateTriangulation",()=>{const{spriteBottom:M=-10}=this.layer.getLayerConfig(),Z=this.spriteUpdate,rt=M,N=this.spriteTop;for(let Q=0;Q<this.positions.length;Q+=5)this.spriteAnimate===T.UP?(this.positions[Q+2]+=Z,this.positions[Q+2]>N&&(this.positions[Q+2]=rt)):(this.positions[Q+2]-=Z,this.positions[Q+2]<rt&&(this.positions[Q+2]=N));return{vertices:this.positions,indices:this.indices,size:5}}),(0,a.Z)(this,"updatePosition",()=>{var M;this.planeGeometryUpdateTriangulation();const Z=(M=this.styleAttributeService.getLayerStyleAttribute("position"))===null||M===void 0?void 0:M.vertexAttribute;if(Z){const rt=[];for(let N=0;N<this.positions.length;N+=5)rt.push(this.positions[N],this.positions[N+1],this.positions[N+2]);Z.updateBuffer({data:rt,offset:0})}this.layerService.throttleRenderLayers(),this.timer=requestAnimationFrame(this.updatePosition)}),(0,a.Z)(this,"planeGeometryTriangulation",()=>{const{center:M=[120,30],spriteCount:Z=100,spriteRadius:rt=10}=this.layer.getLayerConfig(),{indices:N,positions:Q}=this.initSprite(rt,Z,...M);return this.positions=Q,this.indices=N,{vertices:Q,indices:N,size:5}})}initSprite(R=10,M=100,Z=120,rt=30){const N=[],Q=[],ft=this.spriteAnimate===T.UP?-this.spriteTop:this.spriteTop;for(let G=0;G<M;G++){const ut=Math.random()*ft;Q.push(...I(ut))}for(let G=0;G<M;G++)N.push(G);function I(G){const ut=R*Math.random(),L=R*Math.random(),j=-R/2+ut,O=-R/2+L;return[j+Z,-O+rt,G,0,0]}return{indices:N,positions:Q}}getUninforms(){const R=this.getCommonUniformsInfo(),M=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},R.uniformsOption),M.uniformsOption)}getCommonUniformsInfo(){const{opacity:R,mapTexture:M,spriteScale:Z=1}=this.layer.getLayerConfig();if(this.mapTexture!==M){var rt;this.mapTexture=M,(rt=this.texture)===null||rt===void 0||rt.destroy(),this.textures=[],this.updateTexture(M)}const N={u_opacity:R||1,u_mapFlag:M?1:0,u_Scale:Z,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(N)}clearModels(){var R;cancelAnimationFrame(this.timer),(R=this.texture)===null||R===void 0||R.destroy(),this.textures=[]}initModels(){var R=this;return(0,u.Z)(function*(){const{mapTexture:M,spriteTop:Z=300,spriteUpdate:rt=10,spriteAnimate:N=T.DOWN}=R.layer.getLayerConfig();R.initUniformsBuffer(),R.mapTexture=M,R.spriteTop=Z,R.spriteUpdate=rt,N==="up"?R.spriteAnimate=T.UP:R.spriteAnimate=T.DOWN;const{createTexture2D:Q}=R.rendererService;return R.texture=Q({height:0,width:0}),R.updateTexture(M),setTimeout(()=>{R.updatePosition()},100),[yield R.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:S,fragmentShader:o,triangulation:R.planeGeometryTriangulation,defines:R.getDefines(),inject:R.getInject(),primitive:c.gl.POINTS,depth:{enable:!1},blend:R.getBlend()})]})()}buildModels(){var R=this;return(0,u.Z)(function*(){return R.initModels()})()}updateTexture(R){const{createTexture2D:M}=this.rendererService;if(R){const Z=new Image;Z.crossOrigin="anonymous",Z.onload=()=>{this.texture=M({data:Z,width:Z.width,height:Z.height,wrapS:c.gl.CLAMP_TO_EDGE,wrapT:c.gl.CLAMP_TO_EDGE}),this.layerService.reRender()},Z.src=R}else this.texture=M({width:1,height:1})}registerBuiltinAttributes(){return""}}const C={plane:A,sprite:E,billboard:r}},79920:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(44888);if(!/^(1887|7596)$/.test(e.j))var d=e(28521);class m extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...r){super(...r),(0,i.Z)(this,"type","HeatMapLayer")}buildModels(){var r=this;return(0,u.Z)(function*(){const h=r.getModelType();r.layerModel=new d.Z[h](r),yield r.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(r={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(r),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(g=>g.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(r)})),this.hooks.afterRender.call(),this)}updateModelData(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}getModelType(){var r;const h=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:g}=this.getLayerConfig(),o=this.getSource().data.type,S=(h==null||(r=h.scale)===null||r===void 0?void 0:r.field)||"heatmap";return S==="heatmap"||S==="heatmap3d"?"heatmap":o==="hexagon"?(g==null?void 0:g.indexOf(S))===-1?"hexagon":"grid3d":o==="grid"?(g==null?void 0:g.indexOf(S))===-1?"grid":"grid3d":"heatmap"}getLegend(r){if(this.getModelType()==="heatmap"){if(r!=="color")return{type:void 0,field:void 0,items:[]};const h=this.getLayerConfig().rampColors;return(0,c.I)(h,r)}else return super.getLegend(r)}}},28521:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>ut});var u=e(15861),i=e(1413),a=e(71590),c=e(98422),d=e(42659);const m=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,l=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class r extends c.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const j=this.getCommonUniformsInfo(),O=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},j.uniformsOption),O.uniformsOption)}getCommonUniformsInfo(){const{opacity:j,coverage:O,angle:B}=this.layer.getLayerConfig(),_={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:j||1,u_coverage:O||.9,u_angle:B||0};return this.getUniformsBufferInfo(_)}initModels(){var j=this;return(0,u.Z)(function*(){return j.buildModels()})()}buildModels(){var j=this;return(0,u.Z)(function*(){return j.initUniformsBuffer(),[yield j.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:l,fragmentShader:m,defines:j.getDefines(),triangulation:d.Rs,primitive:a.gl.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:a.GC.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:j=>{const O=j.coordinates;return[O[0],O[1],0]}}})}}const h=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,g=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class A extends c.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const j=this.getCommonUniformsInfo(),O=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},j.uniformsOption),O.uniformsOption)}getCommonUniformsInfo(){const{opacity:j,coverage:O,angle:B}=this.layer.getLayerConfig(),_={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:j||1,u_coverage:O||.9,u_angle:B||0};return this.getUniformsBufferInfo(_)}initModels(){var j=this;return(0,u.Z)(function*(){return j.buildModels()})()}buildModels(){var j=this;return(0,u.Z)(function*(){return j.initUniformsBuffer(),[yield j.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:g,fragmentShader:h,defines:j.getDefines(),triangulation:d.NM,primitive:a.gl.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:j=>{const{size:O}=j;return Array.isArray(O)?[O[0]]:[O]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:a.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(j,O,B,_,H)=>H}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:a.GC.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:j=>{const O=j.coordinates;return[O[0],O[1],0]}}})}}var o=e(4942),S=e(64939),T=e(85975),E=e(22032);const b=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,C=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
  vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,X=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,R=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,M=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,Z=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:rt}=S.lodashUtil;class N extends c.Z{constructor(...j){super(...j),(0,o.Z)(this,"texture",void 0),(0,o.Z)(this,"colorTexture",void 0),(0,o.Z)(this,"heatmapFramerBuffer",void 0),(0,o.Z)(this,"heatmapTexture",void 0),(0,o.Z)(this,"intensityModel",void 0),(0,o.Z)(this,"colorModel",void 0),(0,o.Z)(this,"shapeType",void 0),(0,o.Z)(this,"preRampColors",void 0),(0,o.Z)(this,"colorModelUniformBuffer",[]),(0,o.Z)(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:j,useFramebuffer:O}=this.rendererService;O(this.heatmapFramerBuffer,()=>{j({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(j){const{rampColors:O}=this.layer.getLayerConfig();rt(this.preRampColors,O)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(j):this.draw3DHeatMap(j)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var j=this;return(0,u.Z)(function*(){var O;const{createFramebuffer:B,getViewportSize:_,createTexture2D:H}=j.rendererService,U=j.styleAttributeService.getLayerStyleAttribute("shape"),V=(U==null||(O=U.scale)===null||O===void 0?void 0:O.field)||"heatmap";j.shapeType=V,j.intensityModel=yield j.buildHeatMapIntensity(),j.colorModel=V==="heatmap"?j.buildHeatmap():j.build3dHeatMap();const{width:D,height:lt}=_();return j.heatmapTexture=H({width:Math.floor(D/4),height:Math.floor(lt/4),wrapS:a.gl.CLAMP_TO_EDGE,wrapT:a.gl.CLAMP_TO_EDGE,min:a.gl.LINEAR,mag:a.gl.LINEAR,usage:a.v2.RENDER_TARGET}),j.heatmapFramerBuffer=B({color:j.heatmapTexture,depth:!0,width:Math.floor(D/4),height:Math.floor(lt/4)}),j.updateColorTexture(),[j.intensityModel,j.colorModel]})()}buildModels(){var j=this;return(0,u.Z)(function*(){return j.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:a.GC.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:(j,O,B)=>[B[3],B[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:j=>{const{size:O=1}=j;return[O]}}})}buildHeatMapIntensity(){var j=this;return(0,u.Z)(function*(){return j.uniformBuffers=[j.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],j.layer.triangulation=d.zO,yield j.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:Z,fragmentShader:M,triangulation:d.zO,defines:j.getDefines(),depth:{enable:!1},cull:{enable:!0,face:a.gl.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:R,fs:X}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:j,fs:O,uniforms:B}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:_,createElements:H,createBuffer:U,createModel:V}=this.rendererService;return V({vs:j,fs:O,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:_({shaderLocation:this.attributeLocation.POSITION,buffer:U({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:a.gl.FLOAT}),size:3}),a_Uv:_({shaderLocation:this.attributeLocation.UV,buffer:U({data:[0,1,1,1,0,0,1,0],type:a.gl.FLOAT}),size:2})},uniforms:(0,i.Z)({},B),depth:{enable:!1},elements:H({data:[0,2,1,2,3,1],type:a.gl.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:j}=this.rendererService,{width:O,height:B}=j(),_=(0,E.P)(O/4,B/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:C,fs:b}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:H,fs:U,uniforms:V}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:D,createElements:lt,createBuffer:J,createModel:Rt}=this.rendererService;return Rt({vs:H,fs:U,attributes:{a_Position:D({shaderLocation:this.attributeLocation.POSITION,buffer:J({data:_.vertices,type:a.gl.FLOAT}),size:3}),a_Uv:D({shaderLocation:this.attributeLocation.UV,buffer:J({data:_.uvs,type:a.gl.FLOAT}),size:2})},primitive:a.gl.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:(0,i.Z)({},V),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:a.gl.SRC_ALPHA,srcAlpha:1,dstRGB:a.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:lt({data:_.indices,type:a.gl.UNSIGNED_INT,count:_.indices.length})})}drawIntensityMode(){var j;const{intensity:O=10,radius:B=5}=this.layer.getLayerConfig(),_={u_radius:B,u_intensity:O};this.uniformBuffers[0].subData({offset:0,data:[B,O]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(j=this.intensityModel)===null||j===void 0||j.draw({uniforms:_,blend:{enable:!0,func:{srcRGB:a.gl.ONE,srcAlpha:1,dstRGB:a.gl.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(j){var O;const{opacity:B=1}=this.layer.getLayerConfig(),_={u_opacity:B,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},H=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[B]}),(O=this.colorModel)===null||O===void 0||O.draw({uniforms:_,textures:H,blend:this.getBlend(),stencil:this.getStencil(j)})}draw3DHeatMap(j){var O;const{opacity:B=1}=this.layer.getLayerConfig(),_=T.Ue();T.U_(_,this.cameraService.getViewProjectionMatrixUncentered());const H={u_opacity:B,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[..._]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...H.u_ViewProjectionMatrixUncentered,...H.u_InverseViewProjectionMatrix,B]});const U=[this.heatmapTexture,this.colorTexture];(O=this.colorModel)===null||O===void 0||O.draw({uniforms:H,textures:U,blend:{enable:!0,func:{srcRGB:a.gl.SRC_ALPHA,srcAlpha:1,dstRGB:a.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(j)})}updateColorTexture(){const{createTexture2D:j}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:O}=this.layer.getLayerConfig(),B=(0,S.Cl)(O);this.colorTexture=j({data:B.data,usage:a.v2.SAMPLED,width:B.width,height:B.height,wrapS:a.gl.CLAMP_TO_EDGE,wrapT:a.gl.CLAMP_TO_EDGE,min:a.gl.NEAREST,mag:a.gl.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=O}}const Q=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,ft=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class I extends c.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const j=this.getCommonUniformsInfo(),O=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},j.uniformsOption),O.uniformsOption)}getCommonUniformsInfo(){const{opacity:j,coverage:O,angle:B}=this.layer.getLayerConfig(),_={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:j||1,u_coverage:O||.9,u_angle:B||0};return this.getUniformsBufferInfo(_)}initModels(){var j=this;return(0,u.Z)(function*(){return j.buildModels()})()}buildModels(){var j=this;return(0,u.Z)(function*(){return j.initUniformsBuffer(),[yield j.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:ft,fragmentShader:Q,defines:j.getDefines(),triangulation:d.Rs,depth:{enable:!1},primitive:a.gl.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:a.GC.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:j=>{const O=j.coordinates;return[O[0],O[1],0]}}})}}const ut={heatmap:N,heatmap3d:N,grid:r,grid3d:A,hexagon:I}},22032:(Xt,K,e)=>{"use strict";e.d(K,{P:()=>u});function u(i,a){const c=[],d=[],m=[],l=i+1,r=a+1,h=i/2,g=a/2;for(let A=0;A<r;A++){const o=A-g;for(let S=0;S<l;S++){const T=S-h;d.push(T/h,-o/g,0),m.push(S/i),m.push(1-A/a)}}for(let A=0;A<a;A++)for(let o=0;o<i;o++){const S=o+l*A,T=o+l*(A+1),E=o+1+l*(A+1),b=o+1+l*A;c.push(S,T,b),c.push(T,E,b)}return{vertices:d,indices:c,uvs:m}}},14759:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(66154);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","ImageLayer")}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}getDefaultConfig(){const l=this.getModelType();return{image:{}}[l]}getModelType(){return"image"}}},66154:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>A});var u=e(15861),i=e(4942),a=e(71590),c=e(64939),d=e(98422),m=e(42659);const l=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,r=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class h extends d.Z{constructor(...S){super(...S),(0,i.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:S,brightness:T,contrast:E,saturation:b,gamma:C}=this.layer.getLayerConfig(),X={u_opacity:(0,c.LS)(S,1),u_brightness:(0,c.LS)(T,1),u_contrast:(0,c.LS)(E,1),u_saturation:(0,c.LS)(b,1),u_gamma:(0,c.LS)(C,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(X)}initModels(){var S=this;return(0,u.Z)(function*(){return yield S.loadTexture(),S.buildModels()})()}clearModels(){var S;(S=this.texture)===null||S===void 0||S.destroy()}loadTexture(){var S=this;return(0,u.Z)(function*(){const{createTexture2D:T}=S.rendererService,b=yield S.layer.getSource().data.images;S.texture=T({data:b[0],width:b[0].width,height:b[0].height,mag:a.gl.LINEAR,min:a.gl.LINEAR})})()}buildModels(){var S=this;return(0,u.Z)(function*(){return S.initUniformsBuffer(),[yield S.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:r,fragmentShader:l,defines:S.getDefines(),triangulation:m.iC,primitive:a.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:(S,T,E)=>[E[3],E[4]]}})}}const A={image:h}},29283:(Xt,K,e)=>{"use strict";if(e.d(K,{$1:()=>E.Z,Fy:()=>C.Fy,Ie:()=>r.Z,Im:()=>o.Z,Q8:()=>l.Z,Rf:()=>i.Z,VR:()=>d.Z,YY:()=>A.Z,cA:()=>C.cA,dW:()=>g.Z,fJ:()=>T.Z,gq:()=>c.Z,mM:()=>u.Z,ns:()=>h.Z,qy:()=>C.qy,sh:()=>S.Z,vo:()=>b.Z,xg:()=>C.xg,zP:()=>m.Z,zW:()=>C.zW,zi:()=>a.Z}),!/^(1887|7596)$/.test(e.j))var u=e(86939);if(!/^(1887|7596)$/.test(e.j))var i=e(97617);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(98422);if(!/^(1887|7596)$/.test(e.j))var d=e(35551);if(!/^(1887|7596)$/.test(e.j))var m=e(79920);if(!/^(1887|7596)$/.test(e.j))var l=e(14759);if(!/^(1887|7596)$/.test(e.j))var r=e(58683);if(!/^(1887|7596)$/.test(e.j))var h=e(64380);if(!/^(1887|7596)$/.test(e.j))var g=e(89955);if(!/^(1887|7596)$/.test(e.j))var A=e(62632);if(!/^(1887|7596)$/.test(e.j))var o=e(30520);if(!/^(1887|7596)$/.test(e.j))var S=e(32026);if(!/^(1887|7596)$/.test(e.j))var T=e(24238);if(!/^(1887|7596)$/.test(e.j))var E=e(85353);if(!/^(1887|7596)$/.test(e.j))var b=e(78825);if(!/^(1887|7596)$/.test(e.j))var C=e(76514)},58683:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);if(!/^(1887|7596)$/.test(e.j))var c=e(54674);if(!/^(1887|7596)$/.test(e.j))var d=e(43610);class m extends(/^(1887|7596)$/.test(e.j)?null:c.Z){constructor(...r){super(...r),(0,a.Z)(this,"type","LineLayer"),(0,a.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,a.Z)(this,"arrowInsertCount",0),(0,a.Z)(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var r=this;return(0,i.Z)(function*(){const h=r.getModelType();r.layerModel=new d.Z[h](r),yield r.initLayerModels()})()}getDefaultConfig(){const r=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[r]}getModelType(){var r;if(this.layerType)return this.layerType;const h=this.styleAttributeService.getLayerStyleAttribute("shape");return(h==null||(r=h.scale)===null||r===void 0?void 0:r.field)||"line"}processData(r){if(this.getModelType()!=="simple")return r;const h=[];return r.map(g=>{if(Array.isArray(g.coordinates)&&Array.isArray(g.coordinates[0])&&Array.isArray(g.coordinates[0][0])){const A=(0,u.Z)({},g);g.coordinates.map(o=>{h.push((0,u.Z)((0,u.Z)({},A),{},{coordinates:o}))})}else h.push(g)}),h}}},43610:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>B});var u=e(15861),i=e(4942),a=e(71590),c=e(64939),d=e(98422),m=e(42659);const l=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,r=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // \u6B63\u5411
    return mid;
  } else {
    // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // \u8D77\u59CB\u70B9
  vec2 target_world = a_Instance.ba; // \u7EC8\u70B9

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // \u8BA1\u7B97 dashArray \u548C distanceRatio \u8F93\u51FA\u5230\u7247\u5143
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance / pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,h={solid:0,dash:1};class g extends d.Z{constructor(...H){super(...H),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"updateTexture",()=>{const{createTexture2D:U}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=U({data:this.iconService.getCanvas(),mag:a.gl.NEAREST,min:a.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:H,targetColor:U,textureBlend:V="normal",lineType:D="solid",dashArray:lt=[10,5],forward:J=!0,lineTexture:Rt=!1,iconStep:kt=100,segmentNumber:ne=30}=this.layer.getLayerConfig(),{animateOption:re}=this.layer.getLayerConfig();let It=lt;D!=="dash"&&(It=[0,0]),It.length===2&&It.push(0,0);let Nt=0,p=[0,0,0,0],w=[0,0,0,0];if(H&&U&&(p=(0,c.CI)(H),w=(0,c.CI)(U),Nt=1),this.rendererService.getDirty()){var W;(W=this.texture)===null||W===void 0||W.bind()}const st={u_animate:this.animateOption2Array(re),u_dash_array:It,u_sourceColor:p,u_targetColor:w,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:ne,u_lineDir:J?1:-1,u_icon_step:kt,u_line_texture:Rt?1:0,u_textureBlend:V==="normal"?0:1,u_blur:.9,u_line_type:h[D||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:Nt};return this.getUniformsBufferInfo(st)}initModels(){var H=this;return(0,u.Z)(function*(){return H.updateTexture(),H.iconService.on("imageUpdate",H.updateTexture),H.buildModels()})()}clearModels(){var H;(H=this.texture)===null||H===void 0||H.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:l,vert:r,type:""}}buildModels(){var H=this;return(0,u.Z)(function*(){H.initUniformsBuffer();const{segmentNumber:U=30}=H.layer.getLayerConfig(),{frag:V,vert:D,type:lt}=H.getShaders();return[yield H.layer.buildLayerModel({moduleName:"lineArc2d"+lt,vertexShader:D,fragmentShader:V,defines:H.getDefines(),inject:H.getInject(),triangulation:m.$4,depth:{enable:!1},styleOption:{segmentNumber:U}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:H=>{const{size:U=1}=H;return Array.isArray(U)?[U[0]]:[U]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:a.GC.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[V[3],V[4],V[5],V[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:a.GC.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[(0,c.Ks)(V[3]),(0,c.Ks)(V[4]),(0,c.Ks)(V[5]),(0,c.Ks)(V[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const U=this.iconService.getIconMap(),{texture:V}=H,{x:D,y:lt}=U[V]||{x:0,y:0};return[D,lt]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:a.GC.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:H=>{const{thetaOffset:U=1}=H;return[U]}}})}}var A=e(90440);const o=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,S=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,T={solid:0,dash:1};class E extends d.Z{constructor(...H){super(...H),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"updateTexture",()=>{const{createTexture2D:U}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=U({data:this.iconService.getCanvas(),mag:a.gl.NEAREST,min:a.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:H,targetColor:U,textureBlend:V="normal",lineType:D="solid",dashArray:lt=[10,5],lineTexture:J=!1,iconStep:Rt=100,segmentNumber:kt=30,globalArcHeight:ne=10}=this.layer.getLayerConfig(),{animateOption:re}=this.layer.getLayerConfig();lt.length===2&&lt.push(0,0);let It=0,Nt=[0,0,0,0],p=[0,0,0,0];if(H&&U&&(Nt=(0,c.CI)(H),p=(0,c.CI)(U),It=1),this.rendererService.getDirty()){var w;(w=this.texture)===null||w===void 0||w.bind()}const W={u_animate:this.animateOption2Array(re),u_dash_array:lt,u_sourceColor:Nt,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:A.Y5,u_global_height:ne,segmentNumber:kt,u_line_type:T[D]||0,u_icon_step:Rt,u_line_texture:J?1:0,u_textureBlend:V==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:It};return this.getUniformsBufferInfo(W)}initModels(){var H=this;return(0,u.Z)(function*(){return H.initUniformsBuffer(),H.updateTexture(),H.iconService.on("imageUpdate",H.updateTexture),H.buildModels()})()}clearModels(){var H;(H=this.texture)===null||H===void 0||H.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:o,vert:S,type:""}}buildModels(){var H=this;return(0,u.Z)(function*(){const{segmentNumber:U=30}=H.layer.getLayerConfig(),{frag:V,vert:D,type:lt}=H.getShaders();return[yield H.layer.buildLayerModel({moduleName:"lineArc3d"+lt,vertexShader:D,fragmentShader:V,defines:H.getDefines(),inject:H.getInject(),triangulation:m.$4,styleOption:{segmentNumber:U}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:H=>{const{size:U=1}=H;return Array.isArray(U)?[U[0]]:[U]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:a.GC.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[V[3],V[4],V[5],V[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:a.GC.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[(0,c.Ks)(V[3]),(0,c.Ks)(V[4]),(0,c.Ks)(V[5]),(0,c.Ks)(V[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const U=this.iconService.getIconMap(),{texture:V}=H,{x:D,y:lt}=U[V]||{x:0,y:0};return[D,lt]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:a.GC.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:H=>{const{thetaOffset:U=1}=H;return[U]}}})}}var b=e(80003);const C=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,X=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source_world = a_Instance.rg; // \u8D77\u70B9
  vec2 target_world = a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`;class R extends d.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:H=2,strokeWidth:U=1,strokeOpacity:V=1}=this.layer.getLayerConfig(),D={u_gap_width:H,u_stroke_width:U,u_stroke_opacity:V};return this.getUniformsBufferInfo(D)}initModels(){var H=this;return(0,u.Z)(function*(){return H.initUniformsBuffer(),H.buildModels()})()}buildModels(){var H=this;return(0,u.Z)(function*(){return[yield H.layer.buildLayerModel({moduleName:"flow_line",vertexShader:X,fragmentShader:C,defines:H.getDefines(),inject:H.getInject(),triangulation:b.nW,styleOption:H.layer.getLayerConfig().symbol,primitive:a.gl.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const{size:U=1}=H;return Array.isArray(U)?[U[0],U[1]]:[U,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:a.GC.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[V[3],V[4],V[5],V[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:a.GC.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[(0,c.Ks)(V[3]),(0,c.Ks)(V[4]),(0,c.Ks)(V[5]),(0,c.Ks)(V[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:a.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(H,U,V,D,lt)=>lt}})}}const M=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Z=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,rt={solid:0,dash:1};class N extends d.Z{constructor(...H){super(...H),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"updateTexture",()=>{const{createTexture2D:U}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=U({data:this.iconService.getCanvas(),mag:a.gl.NEAREST,min:a.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:H,targetColor:U,textureBlend:V="normal",lineType:D="solid",dashArray:lt=[10,5],lineTexture:J=!1,iconStep:Rt=100,segmentNumber:kt=30}=this.layer.getLayerConfig(),{animateOption:ne}=this.layer.getLayerConfig();if(lt.length===2&&lt.push(0,0),this.rendererService.getDirty()){var re;(re=this.texture)===null||re===void 0||re.bind()}let It=0,Nt=[0,0,0,0],p=[0,0,0,0];H&&U&&(Nt=(0,c.CI)(H),p=(0,c.CI)(U),It=1);let w=this.layer.getLayerAnimateTime();isNaN(w)&&(w=0);const W={u_animate:this.animateOption2Array(ne),u_dash_array:lt,u_sourceColor:Nt,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:kt,u_line_type:rt[D]||0,u_icon_step:Rt,u_line_texture:J?1:0,u_textureBlend:V==="normal"?0:1,u_time:w,u_linearColor:It};return this.getUniformsBufferInfo(W)}initModels(){var H=this;return(0,u.Z)(function*(){return H.initUniformsBuffer(),H.updateTexture(),H.iconService.on("imageUpdate",H.updateTexture),H.buildModels()})()}clearModels(){var H;(H=this.texture)===null||H===void 0||H.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var H=this;return(0,u.Z)(function*(){const{segmentNumber:U=30}=H.layer.getLayerConfig();return[yield H.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:Z,fragmentShader:M,triangulation:m.$4,styleOption:{segmentNumber:U},defines:H.getDefines(),inject:H.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:1,update:H=>{const{size:U=1}=H;return Array.isArray(U)?[U[0]]:[U]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:a.GC.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[V[3],V[4],V[5],V[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:a.GC.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>[(0,c.Ks)(V[3]),(0,c.Ks)(V[4]),(0,c.Ks)(V[5]),(0,c.Ks)(V[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const U=this.iconService.getIconMap(),{texture:V}=H,{x:D,y:lt}=U[V]||{x:0,y:0};return[D,lt]}}})}}var Q=e(82613);const ft=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,I=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`;class G extends d.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:H,targetColor:U,lineType:V="solid",dashArray:D=[10,5,0,0],vertexHeightScale:lt=20}=this.layer.getLayerConfig();let J=D;V!=="dash"&&(J=[0,0,0,0]),J.length===2&&J.push(0,0);let Rt=0,kt=[0,0,0,0],ne=[0,0,0,0];H&&U&&(kt=(0,c.CI)(H),ne=(0,c.CI)(U),Rt=1);const re={u_sourceColor:kt,u_targetColor:ne,u_dash_array:J,u_vertexScale:lt,u_linearColor:Rt};return this.getUniformsBufferInfo(re)}initModels(){var H=this;return(0,u.Z)(function*(){return H.buildModels()})()}getShaders(){return{frag:ft,vert:I,type:"lineSimpleNormal"}}buildModels(){var H=this;return(0,u.Z)(function*(){H.initUniformsBuffer();const{frag:U,vert:V,type:D}=H.getShaders();return[yield H.layer.buildLayerModel({moduleName:D,vertexShader:V,fragmentShader:U,triangulation:m.us,defines:H.getDefines(),inject:H.getInject(),primitive:a.gl.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:a.GC.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(H,U,V)=>{const{size:D=1}=H,lt=Array.isArray(D)?[D[0],D[1]]:[D,0];return[lt[0],lt[1],V[3],V[5]]}}})}}const ut=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,L=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance; // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // \u56FA\u5B9A\u9AD8\u5EA6
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class j extends d.Z{constructor(...H){super(...H),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"updateTexture",()=>{const{createTexture2D:U}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=U({data:this.iconService.getCanvas(),mag:a.gl.NEAREST,min:a.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:H,targetColor:U,textureBlend:V="normal",heightfixed:D=!1,lineTexture:lt=!1,iconStep:J=100,iconStepCount:Rt=1}=this.layer.getLayerConfig(),{animateOption:kt}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var ne;(ne=this.texture)===null||ne===void 0||ne.bind()}let re=0,It=[0,0,0,0],Nt=[0,0,0,0];H&&U&&(It=(0,c.CI)(H),Nt=(0,c.CI)(U),re=1);const p={u_animate:this.animateOption2Array(kt),u_sourceColor:It,u_targetColor:Nt,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:J,u_heightfixed:Number(D),u_linearColor:re,u_line_texture:lt?1:0,u_textureBlend:V==="normal"?0:1,u_iconStepCount:Rt,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(p)}initModels(){var H=this;return(0,u.Z)(function*(){return H.initUniformsBuffer(),H.updateTexture(),H.iconService.on("imageUpdate",H.updateTexture),H.buildModels()})()}clearModels(){var H;(H=this.texture)===null||H===void 0||H.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var H=this;return(0,u.Z)(function*(){return[yield H.layer.buildLayerModel({moduleName:"lineWall",vertexShader:L,fragmentShader:ut,triangulation:m.sN,defines:H.getDefines(),inject:H.getInject(),depth:{enable:!1},blend:H.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const{size:U=1}=H;return Array.isArray(U)?[U[0],U[1]]:[U,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:a.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(H,U,V,D,lt)=>lt}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:a.GC.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(H,U,V)=>[V[3],V[4],V[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:H=>{const U=this.iconService.getIconMap(),{texture:V}=H,{x:D,y:lt}=U[V]||{x:0,y:0};return[D,lt]}}})}}const B={arc:g,arc3d:E,greatcircle:N,wall:j,line:Q.Z,simple:G,flowline:R,earthArc3d:E}},82613:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>g}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(71590),c=e(64939);if(!/^(1887|7596)$/.test(e.j))var d=e(98422);if(!/^(1887|7596)$/.test(e.j))var m=e(76514);if(!/^(1887|7596)$/.test(e.j))var l=e(42659);const r=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,h=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`;class g extends(/^(1887|7596)$/.test(e.j)?null:d.Z){constructor(...o){super(...o),(0,i.Z)(this,"textureEventFlag",!1),(0,i.Z)(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,i.Z)(this,"updateTexture",()=>{const{createTexture2D:S}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=S({data:this.iconService.getCanvas(),mag:a.gl.NEAREST,min:a.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:o,targetColor:S,textureBlend:T="normal",lineType:E="solid",dashArray:b=[10,5,0,0],lineTexture:C=!1,iconStep:X=100,vertexHeightScale:R=20,strokeWidth:M=0,raisingHeight:Z=0,heightfixed:rt=!1,linearDir:N=m.cA.VERTICAL,blur:Q=[1,1,1,0]}=this.layer.getLayerConfig();let ft=b;if(E!=="dash"&&(ft=[0,0,0,0]),ft.length===2&&ft.push(0,0),this.rendererService.getDirty()&&this.texture){var I;(I=this.texture)===null||I===void 0||I.bind()}const{animateOption:G}=this.layer.getLayerConfig();let ut=0,L=[0,0,0,0],j=[0,0,0,0];o&&S&&(L=(0,c.CI)(o),j=(0,c.CI)(S),ut=1);const O={u_animate:this.animateOption2Array(G),u_dash_array:ft,u_blur:Q,u_sourceColor:L,u_targetColor:j,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:X,u_heightfixed:Number(rt),u_vertexScale:R,u_raisingHeight:Number(Z),u_strokeWidth:M,u_textureBlend:T===m.qy.NORMAL?0:1,u_line_texture:C?1:0,u_linearDir:N===m.cA.VERTICAL?1:0,u_linearColor:ut,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(O)}initModels(){var o=this;return(0,u.Z)(function*(){return o.initUniformsBuffer(),o.textureEventFlag||(o.textureEventFlag=!0,o.updateTexture(),o.iconService.on("imageUpdate",o.updateTexture)),o.buildModels()})()}clearModels(){var o;(o=this.texture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var o=this;return(0,u.Z)(function*(){const{depth:S=!1}=o.layer.getLayerConfig(),{frag:T,vert:E,type:b}=o.getShaders();return o.layer.triangulation=l.sN,[yield o.layer.buildLayerModel({moduleName:"line"+b,vertexShader:E,fragmentShader:T,triangulation:l.sN,defines:o.getDefines(),inject:o.getInject(),depth:{enable:S}})]})()}getShaders(){return{frag:r,vert:h,type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:a.GC.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(o,S,T,E,b,C)=>C===void 0?[T[3],10,T[4]]:[T[3],C,T[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:o=>{const{size:S=1}=o;return Array.isArray(S)?[S[0],S[1]]:[S,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:a.GC.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:(o,S,T,E,b)=>[...b,T[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:o=>{const S=this.iconService.getIconMap(),{texture:T}=o,{x:E,y:b}=S[T]||{x:0,y:0};return[E,b]}}})}}},85353:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(19087);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","MaskLayer")}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}getModelType(){return"fill"}}},19087:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>g});var u=e(15861),i=e(1413),a=e(64939),c=e(98422),d=e(42659);const m=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,l=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class r extends c.Z{getUninforms(){const o=this.getCommonUniformsInfo(),S=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},o.uniformsOption),S.uniformsOption)}getCommonUniformsInfo(){const{opacity:o=1,color:S="#000"}=this.layer.getLayerConfig(),T={u_color:(0,a.CI)(S),u_opacity:o||1};return this.getUniformsBufferInfo(T)}initModels(){var o=this;return(0,u.Z)(function*(){return o.buildModels()})()}buildModels(){var o=this;return(0,u.Z)(function*(){return o.initUniformsBuffer(),[yield o.layer.buildLayerModel({moduleName:"mask",vertexShader:l,fragmentShader:m,defines:o.getDefines(),triangulation:d.Qr,depth:{enable:!1},pick:!1})]})()}clearModels(o=!0){o&&this.layerService.clear()}registerBuiltinAttributes(){return""}}const g={fill:r}},35946:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(71590),d=e(64939);class m{constructor(){(0,a.Z)(this,"mapService",void 0),(0,a.Z)(this,"fontService",void 0)}apply(r,{styleAttributeService:h,mapService:g,fontService:A}){var o=this;this.mapService=g,this.fontService=A,r.hooks.init.tapPromise("DataMappingPlugin",(0,i.Z)(function*(){r.log(c.Or.MappingStart,c.KD.INIT),o.generateMaping(r,{styleAttributeService:h}),r.log(c.Or.MappingEnd,c.KD.INIT)})),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var S=(0,i.Z)(function*(T){if(!T)return T;r.dataState.dataMappingNeedUpdate=!1,r.log(c.Or.MappingStart,c.KD.UPDATE);const E=o.generateMaping(r,{styleAttributeService:h});return r.log(c.Or.MappingEnd,c.KD.UPDATE),E});return function(T){return S.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",()=>{const S=r.getSource();if(r.layerModelNeedUpdate||!S||!S.inited)return;const T=h.getLayerStyleAttributes()||[],E=h.getLayerStyleAttribute("filter"),{dataArray:b}=S.data;if(Array.isArray(b)&&b.length===0)return;const C=T.filter(R=>R.needRemapping);let X=b;if(E!=null&&E.needRemapping&&E!==null&&E!==void 0&&E.scale&&(X=b.filter(R=>this.applyAttributeMapping(E,R)[0])),C.length){const R=this.mapping(r,C,X,r.getEncodedData());r.setEncodedData(R)}})}generateMaping(r,{styleAttributeService:h}){const g=h.getLayerStyleAttributes()||[],A=h.getLayerStyleAttribute("filter"),{dataArray:o}=r.getSource().data;let S=o;A!=null&&A.scale&&(S=o.filter(E=>this.applyAttributeMapping(A,E)[0])),S=r.processData(S);const T=this.mapping(r,g,S,void 0);return r.setEncodedData(T),r.emit("dataUpdate",null),!0}mapping(r,h,g,A){const o=h.filter(T=>T.scale!==void 0).filter(T=>T.name!=="filter"),S=g.map((T,E)=>{const b=A?A[E]:{},C=(0,u.Z)({id:T._id,coordinates:T.coordinates},b);return o.forEach(X=>{let R=this.applyAttributeMapping(X,T);(X.name==="color"||X.name==="stroke")&&(R=R.map(M=>(0,d.CI)(M))),C[X.name]=Array.isArray(R)&&R.length===1?R[0]:R,X.name==="shape"&&(C.shape=this.fontService.getIconFontKey(C[X.name]))}),C});return h.forEach(T=>{T.needRemapping=!1}),this.adjustData2SimpleCoordinates(S),S}adjustData2SimpleCoordinates(r){r.length>0&&this.mapService.version==="SIMPLE"&&r.map(h=>{h.simpleCoordinate||(h.coordinates=this.unProjectCoordinates(h.coordinates),h.simpleCoordinate=!0)})}unProjectCoordinates(r){if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){const h=[];return r.map(g=>{const A=[];g.map(o=>{A.push(this.mapService.simpleMapCoord.unproject(o))}),h.push(A)}),h}else{const h=[];return r.map(g=>{h.push(this.mapService.simpleMapCoord.unproject(g))}),h}}applyAttributeMapping(r,h){var g;if(!r.scale)return[];const A=(r==null||(g=r.scale)===null||g===void 0?void 0:g.scalers)||[],o=[];return A.forEach(({field:T})=>{var E;(h.hasOwnProperty(T)||((E=r.scale)===null||E===void 0?void 0:E.type)==="variable")&&o.push(h[T])}),r.mapping?r.mapping(o):[]}getArrowPoints(r,h){const g=[h[0]-r[0],h[1]-r[1]],A=(0,d.Fv)(g);return[r[0]+A[0]*1e-4,r[1]+A[1]*1e-4]}}},61418:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(71590),c=e(32548);class d{constructor(){(0,i.Z)(this,"mapService",void 0)}apply(l){var r=this;this.mapService=l.getContainer().mapService,l.hooks.init.tapPromise("DataSourcePlugin",(0,u.Z)(function*(){l.log(a.Or.SourceInitStart,a.KD.INIT);let h=l.getSource();if(!h){const{data:g,options:A}=l.sourceOption||l.defaultSourceConfig;h=new c.default(g,A),l.setSource(h)}h.inited?(r.updateClusterData(l),l.log(a.Or.SourceInitEnd,a.KD.INIT)):yield new Promise(g=>{h.on("update",A=>{A.type==="inited"&&(r.updateClusterData(l),l.log(a.Or.SourceInitEnd,a.KD.INIT)),g(null)})})})),l.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,u.Z)(function*(){const h=r.updateClusterData(l),g=l.dataState.dataSourceNeedUpdate;return l.dataState.dataSourceNeedUpdate=!1,h||g}))}updateClusterData(l){if(l.isTileLayer||l.tileLayer||!l.getSource())return!1;const r=l.getSource(),h=r.cluster,{zoom:g=0}=r.clusterOptions,A=this.mapService.getZoom()-1,o=l.dataState.dataSourceNeedUpdate;return h&&o&&r.updateClusterData(Math.floor(A)),h&&Math.abs(l.clusterZoom-A)>=1?(g!==Math.floor(A)&&r.updateClusterData(Math.floor(A)),l.clusterZoom=A,!0):!1}}},1111:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>Xe});var u=e(1413),i=e(15861),a=e(4942),c=e(71590),d=e(64939),m=e(50363),l=e(24028),r=e(91077),h=e(29173),g=(0,h.Z)(r.Z),A=g.right,o=g.left;const S=A;var T=Array.prototype,E=T.slice,b=T.map,C=Math.sqrt(50),X=Math.sqrt(10),R=Math.sqrt(2);function M(q,At,Yt){var Mt,Dt=-1,$t,te,Qt;if(At=+At,q=+q,Yt=+Yt,q===At&&Yt>0)return[q];if((Mt=At<q)&&($t=q,q=At,At=$t),(Qt=Z(q,At,Yt))===0||!isFinite(Qt))return[];if(Qt>0)for(q=Math.ceil(q/Qt),At=Math.floor(At/Qt),te=new Array($t=Math.ceil(At-q+1));++Dt<$t;)te[Dt]=(q+Dt)*Qt;else for(q=Math.floor(q*Qt),At=Math.ceil(At*Qt),te=new Array($t=Math.ceil(q-At+1));++Dt<$t;)te[Dt]=(q-Dt)/Qt;return Mt&&te.reverse(),te}function Z(q,At,Yt){var Mt=(At-q)/Math.max(0,Yt),Dt=Math.floor(Math.log(Mt)/Math.LN10),$t=Mt/Math.pow(10,Dt);return Dt>=0?($t>=C?10:$t>=X?5:$t>=R?2:1)*Math.pow(10,Dt):-Math.pow(10,-Dt)/($t>=C?10:$t>=X?5:$t>=R?2:1)}function rt(q,At,Yt){var Mt=Math.abs(At-q)/Math.max(0,Yt),Dt=Math.pow(10,Math.floor(Math.log(Mt)/Math.LN10)),$t=Mt/Dt;return $t>=C?Dt*=10:$t>=X?Dt*=5:$t>=R&&(Dt*=2),At<q?-Dt:Dt}function N(){var q=identity,At=extent,Yt=sturges;function Mt(Dt){var $t,te=Dt.length,Qt,ve=new Array(te);for($t=0;$t<te;++$t)ve[$t]=q(Dt[$t],$t,Dt);var le=At(ve),Ke=le[0],ln=le[1],an=Yt(ve,Ke,ln);Array.isArray(an)||(an=tickStep(Ke,ln,an),an=range(Math.ceil(Ke/an)*an,ln,an));for(var Tn=an.length;an[0]<=Ke;)an.shift(),--Tn;for(;an[Tn-1]>ln;)an.pop(),--Tn;var Nr=new Array(Tn+1),yr;for($t=0;$t<=Tn;++$t)yr=Nr[$t]=[],yr.x0=$t>0?an[$t-1]:Ke,yr.x1=$t<Tn?an[$t]:ln;for($t=0;$t<te;++$t)Qt=ve[$t],Ke<=Qt&&Qt<=ln&&Nr[bisect(an,Qt,0,Tn)].push(Dt[$t]);return Nr}return Mt.value=function(Dt){return arguments.length?(q=typeof Dt=="function"?Dt:constant(Dt),Mt):q},Mt.domain=function(Dt){return arguments.length?(At=typeof Dt=="function"?Dt:constant([Dt[0],Dt[1]]),Mt):At},Mt.thresholds=function(Dt){return arguments.length?(Yt=typeof Dt=="function"?Dt:Array.isArray(Dt)?constant(slice.call(Dt)):constant(Dt),Mt):Yt},Mt}function Q(q,At,Yt){return q=map.call(q,number).sort(ascending),Math.ceil((Yt-At)/(2*(quantile(q,.75)-quantile(q,.25))*Math.pow(q.length,-1/3)))}var ft=e(41461),I="$";function G(){}G.prototype=ut.prototype={constructor:G,has:function(q){return I+q in this},get:function(q){return this[I+q]},set:function(q,At){return this[I+q]=At,this},remove:function(q){var At=I+q;return At in this&&delete this[At]},clear:function(){for(var q in this)q[0]===I&&delete this[q]},keys:function(){var q=[];for(var At in this)At[0]===I&&q.push(At.slice(1));return q},values:function(){var q=[];for(var At in this)At[0]===I&&q.push(this[At]);return q},entries:function(){var q=[];for(var At in this)At[0]===I&&q.push({key:At.slice(1),value:this[At]});return q},size:function(){var q=0;for(var At in this)At[0]===I&&++q;return q},empty:function(){for(var q in this)if(q[0]===I)return!1;return!0},each:function(q){for(var At in this)At[0]===I&&q(this[At],At.slice(1),this)}};function ut(q,At){var Yt=new G;if(q instanceof G)q.each(function(Qt,ve){Yt.set(ve,Qt)});else if(Array.isArray(q)){var Mt=-1,Dt=q.length,$t;if(At==null)for(;++Mt<Dt;)Yt.set(Mt,q[Mt]);else for(;++Mt<Dt;)Yt.set(At($t=q[Mt],Mt,q),$t)}else if(q)for(var te in q)Yt.set(te,q[te]);return Yt}const L=ut;function j(){var q=[],At=[],Yt,Mt,Dt;function $t(Qt,ve,le,Ke){if(ve>=q.length)return Yt!=null&&Qt.sort(Yt),Mt!=null?Mt(Qt):Qt;for(var ln=-1,an=Qt.length,Tn=q[ve++],Nr,yr,Mr=map(),Li,ei=le();++ln<an;)(Li=Mr.get(Nr=Tn(yr=Qt[ln])+""))?Li.push(yr):Mr.set(Nr,[yr]);return Mr.each(function(pi,wr){Ke(ei,wr,$t(pi,ve,le,Ke))}),ei}function te(Qt,ve){if(++ve>q.length)return Qt;var le,Ke=At[ve-1];return Mt!=null&&ve>=q.length?le=Qt.entries():(le=[],Qt.each(function(ln,an){le.push({key:an,values:te(ln,ve)})})),Ke!=null?le.sort(function(ln,an){return Ke(ln.key,an.key)}):le}return Dt={object:function(Qt){return $t(Qt,0,O,B)},map:function(Qt){return $t(Qt,0,_,H)},entries:function(Qt){return te($t(Qt,0,_,H),0)},key:function(Qt){return q.push(Qt),Dt},sortKeys:function(Qt){return At[q.length-1]=Qt,Dt},sortValues:function(Qt){return Yt=Qt,Dt},rollup:function(Qt){return Mt=Qt,Dt}}}function O(){return{}}function B(q,At,Yt){q[At]=Yt}function _(){return map()}function H(q,At,Yt){q.set(At,Yt)}function U(){}var V=L.prototype;U.prototype=D.prototype={constructor:U,has:V.has,add:function(q){return q+="",this[I+q]=q,this},remove:V.remove,clear:V.clear,values:V.keys,size:V.size,empty:V.empty,each:V.each};function D(q,At){var Yt=new U;if(q instanceof U)q.each(function($t){Yt.add($t)});else if(q){var Mt=-1,Dt=q.length;if(At==null)for(;++Mt<Dt;)Yt.add(q[Mt]);else for(;++Mt<Dt;)Yt.add(At(q[Mt],Mt,q))}return Yt}const lt=null;var J=Array.prototype,Rt=J.map,kt=J.slice,ne=e(48348),re={name:"implicit"};function It(){var q=L(),At=[],Yt=[],Mt=re;function Dt($t){var te=$t+"",Qt=q.get(te);if(!Qt){if(Mt!==re)return Mt;q.set(te,Qt=At.push($t))}return Yt[(Qt-1)%Yt.length]}return Dt.domain=function($t){if(!arguments.length)return At.slice();At=[],q=L();for(var te=-1,Qt=$t.length,ve,le;++te<Qt;)q.has(le=(ve=$t[te])+"")||q.set(le,At.push(ve));return Dt},Dt.range=function($t){return arguments.length?(Yt=kt.call($t),Dt):Yt.slice()},Dt.unknown=function($t){return arguments.length?(Mt=$t,Dt):Mt},Dt.copy=function(){return It(At,Yt).unknown(Mt)},ne.o.apply(Dt,arguments),Dt}function Nt(){var q=ordinal().unknown(void 0),At=q.domain,Yt=q.range,Mt=[0,1],Dt,$t,te=!1,Qt=0,ve=0,le=.5;delete q.unknown;function Ke(){var ln=At().length,an=Mt[1]<Mt[0],Tn=Mt[an-0],Nr=Mt[1-an];Dt=(Nr-Tn)/Math.max(1,ln-Qt+ve*2),te&&(Dt=Math.floor(Dt)),Tn+=(Nr-Tn-Dt*(ln-Qt))*le,$t=Dt*(1-Qt),te&&(Tn=Math.round(Tn),$t=Math.round($t));var yr=sequence(ln).map(function(Mr){return Tn+Dt*Mr});return Yt(an?yr.reverse():yr)}return q.domain=function(ln){return arguments.length?(At(ln),Ke()):At()},q.range=function(ln){return arguments.length?(Mt=[+ln[0],+ln[1]],Ke()):Mt.slice()},q.rangeRound=function(ln){return Mt=[+ln[0],+ln[1]],te=!0,Ke()},q.bandwidth=function(){return $t},q.step=function(){return Dt},q.round=function(ln){return arguments.length?(te=!!ln,Ke()):te},q.padding=function(ln){return arguments.length?(Qt=Math.min(1,ve=+ln),Ke()):Qt},q.paddingInner=function(ln){return arguments.length?(Qt=Math.min(1,ln),Ke()):Qt},q.paddingOuter=function(ln){return arguments.length?(ve=+ln,Ke()):ve},q.align=function(ln){return arguments.length?(le=Math.max(0,Math.min(1,ln)),Ke()):le},q.copy=function(){return Nt(At(),Mt).round(te).paddingInner(Qt).paddingOuter(ve).align(le)},initRange.apply(Ke(),arguments)}function p(q){var At=q.copy;return q.padding=q.paddingOuter,delete q.paddingInner,delete q.paddingOuter,q.copy=function(){return p(At())},q}function w(){return p(Nt.apply(null,arguments).paddingInner(1))}var W=e(81265),st=e(58916),Tt=e(79935),Gt=e(58749),ze=e(34299),$e=[0,1];function rn(q){return q}function gn(q,At){return(At-=q=+q)?function(Yt){return(Yt-q)/At}:(0,Gt.Z)(isNaN(At)?NaN:.5)}function nt(q){var At=q[0],Yt=q[q.length-1],Mt;return At>Yt&&(Mt=At,At=Yt,Yt=Mt),function(Dt){return Math.max(At,Math.min(Yt,Dt))}}function Ln(q,At,Yt){var Mt=q[0],Dt=q[1],$t=At[0],te=At[1];return Dt<Mt?(Mt=gn(Dt,Mt),$t=Yt(te,$t)):(Mt=gn(Mt,Dt),$t=Yt($t,te)),function(Qt){return $t(Mt(Qt))}}function rr(q,At,Yt){var Mt=Math.min(q.length,At.length)-1,Dt=new Array(Mt),$t=new Array(Mt),te=-1;for(q[Mt]<q[0]&&(q=q.slice().reverse(),At=At.slice().reverse());++te<Mt;)Dt[te]=gn(q[te],q[te+1]),$t[te]=Yt(At[te],At[te+1]);return function(Qt){var ve=S(q,Qt,1,Mt)-1;return $t[ve](Dt[ve](Qt))}}function tr(q,At){return At.domain(q.domain()).range(q.range()).interpolate(q.interpolate()).clamp(q.clamp()).unknown(q.unknown())}function sr(){var q=$e,At=$e,Yt=W.Z,Mt,Dt,$t,te=rn,Qt,ve,le;function Ke(){return Qt=Math.min(q.length,At.length)>2?rr:Ln,ve=le=null,ln}function ln(an){return isNaN(an=+an)?$t:(ve||(ve=Qt(q.map(Mt),At,Yt)))(Mt(te(an)))}return ln.invert=function(an){return te(Dt((le||(le=Qt(At,q.map(Mt),st.Z)))(an)))},ln.domain=function(an){return arguments.length?(q=Rt.call(an,ze.Z),te===rn||(te=nt(q)),Ke()):q.slice()},ln.range=function(an){return arguments.length?(At=kt.call(an),Ke()):At.slice()},ln.rangeRound=function(an){return At=kt.call(an),Yt=Tt.Z,Ke()},ln.clamp=function(an){return arguments.length?(te=an?nt(q):rn,ln):te!==rn},ln.interpolate=function(an){return arguments.length?(Yt=an,Ke()):Yt},ln.unknown=function(an){return arguments.length?($t=an,ln):$t},function(an,Tn){return Mt=an,Dt=Tn,Ke()}}function Br(q,At){return sr()(q,At)}var fi=e(46196),Yn=e(53726),Ui=e(95097),Wr=e(37655),Zt=e(92162);function P(q,At,Yt,Mt){var Dt=rt(q,At,Yt),$t;switch(Mt=(0,fi.Z)(Mt==null?",f":Mt),Mt.type){case"s":{var te=Math.max(Math.abs(q),Math.abs(At));return Mt.precision==null&&!isNaN($t=(0,Yn.Z)(Dt,te))&&(Mt.precision=$t),(0,Ui.jH)(Mt,te)}case"":case"e":case"g":case"p":case"r":{Mt.precision==null&&!isNaN($t=(0,Wr.Z)(Dt,Math.max(Math.abs(q),Math.abs(At))))&&(Mt.precision=$t-(Mt.type==="e"));break}case"f":case"%":{Mt.precision==null&&!isNaN($t=(0,Zt.Z)(Dt))&&(Mt.precision=$t-(Mt.type==="%")*2);break}}return(0,Ui.WU)(Mt)}function Y(q){var At=q.domain;return q.ticks=function(Yt){var Mt=At();return M(Mt[0],Mt[Mt.length-1],Yt==null?10:Yt)},q.tickFormat=function(Yt,Mt){var Dt=At();return P(Dt[0],Dt[Dt.length-1],Yt==null?10:Yt,Mt)},q.nice=function(Yt){Yt==null&&(Yt=10);var Mt=At(),Dt=0,$t=Mt.length-1,te=Mt[Dt],Qt=Mt[$t],ve;return Qt<te&&(ve=te,te=Qt,Qt=ve,ve=Dt,Dt=$t,$t=ve),ve=Z(te,Qt,Yt),ve>0?(te=Math.floor(te/ve)*ve,Qt=Math.ceil(Qt/ve)*ve,ve=Z(te,Qt,Yt)):ve<0&&(te=Math.ceil(te*ve)/ve,Qt=Math.floor(Qt*ve)/ve,ve=Z(te,Qt,Yt)),ve>0?(Mt[Dt]=Math.floor(te/ve)*ve,Mt[$t]=Math.ceil(Qt/ve)*ve,At(Mt)):ve<0&&(Mt[Dt]=Math.ceil(te*ve)/ve,Mt[$t]=Math.floor(Qt*ve)/ve,At(Mt)),q},q}function pt(){var q=Br(rn,rn);return q.copy=function(){return tr(q,pt())},ne.o.apply(q,arguments),Y(q)}function Ct(q){var At;function Yt(Mt){return isNaN(Mt=+Mt)?At:Mt}return Yt.invert=Yt,Yt.domain=Yt.range=function(Mt){return arguments.length?(q=map.call(Mt,number),Yt):q.slice()},Yt.unknown=function(Mt){return arguments.length?(At=Mt,Yt):At},Yt.copy=function(){return Ct(q).unknown(At)},q=arguments.length?map.call(q,number):[0,1],linearish(Yt)}var Et=e(37604);function pe(q){return Math.log(q)}function ae(q){return Math.exp(q)}function xe(q){return-Math.log(-q)}function me(q){return-Math.exp(-q)}function en(q){return isFinite(q)?+("1e"+q):q<0?0:q}function se(q){return q===10?en:q===Math.E?Math.exp:function(At){return Math.pow(q,At)}}function ye(q){return q===Math.E?Math.log:q===10&&Math.log10||q===2&&Math.log2||(q=Math.log(q),function(At){return Math.log(At)/q})}function ke(q){return function(At){return-q(-At)}}function Rn(q){var At=q(pe,ae),Yt=At.domain,Mt=10,Dt,$t;function te(){return Dt=ye(Mt),$t=se(Mt),Yt()[0]<0?(Dt=ke(Dt),$t=ke($t),q(xe,me)):q(pe,ae),At}return At.base=function(Qt){return arguments.length?(Mt=+Qt,te()):Mt},At.domain=function(Qt){return arguments.length?(Yt(Qt),te()):Yt()},At.ticks=function(Qt){var ve=Yt(),le=ve[0],Ke=ve[ve.length-1],ln;(ln=Ke<le)&&(an=le,le=Ke,Ke=an);var an=Dt(le),Tn=Dt(Ke),Nr,yr,Mr,Li=Qt==null?10:+Qt,ei=[];if(!(Mt%1)&&Tn-an<Li){if(an=Math.round(an)-1,Tn=Math.round(Tn)+1,le>0){for(;an<Tn;++an)for(yr=1,Nr=$t(an);yr<Mt;++yr)if(Mr=Nr*yr,!(Mr<le)){if(Mr>Ke)break;ei.push(Mr)}}else for(;an<Tn;++an)for(yr=Mt-1,Nr=$t(an);yr>=1;--yr)if(Mr=Nr*yr,!(Mr<le)){if(Mr>Ke)break;ei.push(Mr)}}else ei=M(an,Tn,Math.min(Tn-an,Li)).map($t);return ln?ei.reverse():ei},At.tickFormat=function(Qt,ve){if(ve==null&&(ve=Mt===10?".0e":","),typeof ve!="function"&&(ve=(0,Ui.WU)(ve)),Qt===1/0)return ve;Qt==null&&(Qt=10);var le=Math.max(1,Mt*Qt/At.ticks().length);return function(Ke){var ln=Ke/$t(Math.round(Dt(Ke)));return ln*Mt<Mt-.5&&(ln*=Mt),ln<=le?ve(Ke):""}},At.nice=function(){return Yt((0,Et.Z)(Yt(),{floor:function(Qt){return $t(Math.floor(Dt(Qt)))},ceil:function(Qt){return $t(Math.ceil(Dt(Qt)))}}))},At}function yn(){var q=Rn(sr()).domain([1,10]);return q.copy=function(){return tr(q,yn()).base(q.base())},ne.o.apply(q,arguments),q}function _n(q){return function(At){return Math.sign(At)*Math.log1p(Math.abs(At/q))}}function Cn(q){return function(At){return Math.sign(At)*Math.expm1(Math.abs(At))*q}}function or(q){var At=1,Yt=q(_n(At),Cn(At));return Yt.constant=function(Mt){return arguments.length?q(_n(At=+Mt),Cn(At)):At},linearish(Yt)}function Tr(){var q=or(transformer());return q.copy=function(){return copy(q,Tr()).constant(q.constant())},initRange.apply(q,arguments)}function Qn(q){return function(At){return At<0?-Math.pow(-At,q):Math.pow(At,q)}}function Sr(q){return q<0?-Math.sqrt(-q):Math.sqrt(q)}function Lt(q){return q<0?-q*q:q*q}function Wt(q){var At=q(rn,rn),Yt=1;function Mt(){return Yt===1?q(rn,rn):Yt===.5?q(Sr,Lt):q(Qn(Yt),Qn(1/Yt))}return At.exponent=function(Dt){return arguments.length?(Yt=+Dt,Mt()):Yt},Y(At)}function Re(){var q=Wt(sr());return q.copy=function(){return tr(q,Re()).exponent(q.exponent())},ne.o.apply(q,arguments),q}function Ie(){return Re.apply(null,arguments).exponent(.5)}function ar(){var q=[],At=[],Yt=[],Mt;function Dt(){var te=0,Qt=Math.max(1,At.length);for(Yt=new Array(Qt-1);++te<Qt;)Yt[te-1]=(0,ft.Z)(q,te/Qt);return $t}function $t(te){return isNaN(te=+te)?Mt:At[S(Yt,te)]}return $t.invertExtent=function(te){var Qt=At.indexOf(te);return Qt<0?[NaN,NaN]:[Qt>0?Yt[Qt-1]:q[0],Qt<Yt.length?Yt[Qt]:q[q.length-1]]},$t.domain=function(te){if(!arguments.length)return q.slice();q=[];for(var Qt=0,ve=te.length,le;Qt<ve;++Qt)le=te[Qt],le!=null&&!isNaN(le=+le)&&q.push(le);return q.sort(r.Z),Dt()},$t.range=function(te){return arguments.length?(At=kt.call(te),Dt()):At.slice()},$t.unknown=function(te){return arguments.length?(Mt=te,$t):Mt},$t.quantiles=function(){return Yt.slice()},$t.copy=function(){return ar().domain(q).range(At).unknown(Mt)},ne.o.apply($t,arguments)}function gr(){var q=0,At=1,Yt=1,Mt=[.5],Dt=[0,1],$t;function te(ve){return ve<=ve?Dt[S(Mt,ve,0,Yt)]:$t}function Qt(){var ve=-1;for(Mt=new Array(Yt);++ve<Yt;)Mt[ve]=((ve+1)*At-(ve-Yt)*q)/(Yt+1);return te}return te.domain=function(ve){return arguments.length?(q=+ve[0],At=+ve[1],Qt()):[q,At]},te.range=function(ve){return arguments.length?(Yt=(Dt=kt.call(ve)).length-1,Qt()):Dt.slice()},te.invertExtent=function(ve){var le=Dt.indexOf(ve);return le<0?[NaN,NaN]:le<1?[q,Mt[0]]:le>=Yt?[Mt[Yt-1],At]:[Mt[le-1],Mt[le]]},te.unknown=function(ve){return arguments.length&&($t=ve),te},te.thresholds=function(){return Mt.slice()},te.copy=function(){return gr().domain([q,At]).range(Dt).unknown($t)},ne.o.apply(Y(te),arguments)}function xr(){var q=[.5],At=[0,1],Yt,Mt=1;function Dt($t){return $t<=$t?At[S(q,$t,0,Mt)]:Yt}return Dt.domain=function($t){return arguments.length?(q=kt.call($t),Mt=Math.min(q.length,At.length-1),Dt):q.slice()},Dt.range=function($t){return arguments.length?(At=kt.call($t),Mt=Math.min(q.length,At.length-1),Dt):At.slice()},Dt.invertExtent=function($t){var te=At.indexOf($t);return[q[te-1],q[te]]},Dt.unknown=function($t){return arguments.length?(Yt=$t,Dt):Yt},Dt.copy=function(){return xr().domain(q).range(At).unknown(Yt)},ne.o.apply(Dt,arguments)}var Dr=e(82209),Qr=e(4584),Hi=e(22776),Oi=e(69478),Ei=e(42784),Ji=e(7197),Gi=e(15086),so=e(98179),uo=e(64605),kr=1e3,Zi=kr*60,Ni=Zi*60,Jr=Ni*24,di=Jr*7,Yi=Jr*30,si=Jr*365;function lo(q){return new Date(q)}function Ii(q){return q instanceof Date?+q:+new Date(+q)}function co(q,At,Yt,Mt,Dt,$t,te,Qt,ve){var le=Br(rn,rn),Ke=le.invert,ln=le.domain,an=ve(".%L"),Tn=ve(":%S"),Nr=ve("%I:%M"),yr=ve("%I %p"),Mr=ve("%a %d"),Li=ve("%b %d"),ei=ve("%B"),pi=ve("%Y"),wr=[[te,1,kr],[te,5,5*kr],[te,15,15*kr],[te,30,30*kr],[$t,1,Zi],[$t,5,5*Zi],[$t,15,15*Zi],[$t,30,30*Zi],[Dt,1,Ni],[Dt,3,3*Ni],[Dt,6,6*Ni],[Dt,12,12*Ni],[Mt,1,Jr],[Mt,2,2*Jr],[Yt,1,di],[At,1,Yi],[At,3,3*Yi],[q,1,si]];function Si(Pn){return(te(Pn)<Pn?an:$t(Pn)<Pn?Tn:Dt(Pn)<Pn?Nr:Mt(Pn)<Pn?yr:At(Pn)<Pn?Yt(Pn)<Pn?Mr:Li:q(Pn)<Pn?ei:pi)(Pn)}function Mi(Pn,Kr,ni,Fr){if(Pn==null&&(Pn=10),typeof Pn=="number"){var xi=Math.abs(ni-Kr)/Pn,ui=(0,h.Z)(function(ri){return ri[2]}).right(wr,xi);ui===wr.length?(Fr=rt(Kr/si,ni/si,Pn),Pn=q):ui?(ui=wr[xi/wr[ui-1][2]<wr[ui][2]/xi?ui-1:ui],Fr=ui[1],Pn=ui[0]):(Fr=Math.max(rt(Kr,ni,Pn),1),Pn=Qt)}return Fr==null?Pn:Pn.every(Fr)}return le.invert=function(Pn){return new Date(Ke(Pn))},le.domain=function(Pn){return arguments.length?ln(Rt.call(Pn,Ii)):ln().map(lo)},le.ticks=function(Pn,Kr){var ni=ln(),Fr=ni[0],xi=ni[ni.length-1],ui=xi<Fr,ri;return ui&&(ri=Fr,Fr=xi,xi=ri),ri=Mi(Pn,Fr,xi,Kr),ri=ri?ri.range(Fr,xi+1):[],ui?ri.reverse():ri},le.tickFormat=function(Pn,Kr){return Kr==null?Si:ve(Kr)},le.nice=function(Pn,Kr){var ni=ln();return(Pn=Mi(Pn,ni[0],ni[ni.length-1],Kr))?ln((0,Et.Z)(ni,Pn)):le},le.copy=function(){return tr(le,co(q,At,Yt,Mt,Dt,$t,te,Qt,ve))},le}function Oo(){return ne.o.apply(co(Dr.Z,Qr.Z,Hi.OM,Oi.Z,Ei.Z,Ji.Z,Gi.Z,so.Z,uo.i$).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Ki(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bn(){var q=0,At=1,Yt,Mt,Dt,$t,te=rn,Qt=!1,ve;function le(Ke){return isNaN(Ke=+Ke)?ve:te(Dt===0?.5:(Ke=($t(Ke)-Yt)*Dt,Qt?Math.max(0,Math.min(1,Ke)):Ke))}return le.domain=function(Ke){return arguments.length?(Yt=$t(q=+Ke[0]),Mt=$t(At=+Ke[1]),Dt=Yt===Mt?0:1/(Mt-Yt),le):[q,At]},le.clamp=function(Ke){return arguments.length?(Qt=!!Ke,le):Qt},le.interpolator=function(Ke){return arguments.length?(te=Ke,le):te},le.unknown=function(Ke){return arguments.length?(ve=Ke,le):ve},function(Ke){return $t=Ke,Yt=Ke(q),Mt=Ke(At),Dt=Yt===Mt?0:1/(Mt-Yt),le}}function hi(q,At){return At.domain(q.domain()).interpolator(q.interpolator()).clamp(q.clamp()).unknown(q.unknown())}function Ti(){var q=Y(bn()(rn));return q.copy=function(){return hi(q,Ti())},ne.O.apply(q,arguments)}function Lr(){var q=loggish(bn()).domain([1,10]);return q.copy=function(){return hi(q,Lr()).base(q.base())},initInterpolator.apply(q,arguments)}function ur(){var q=symlogish(bn());return q.copy=function(){return hi(q,ur()).constant(q.constant())},initInterpolator.apply(q,arguments)}function pr(){var q=powish(bn());return q.copy=function(){return hi(q,pr()).exponent(q.exponent())},initInterpolator.apply(q,arguments)}function ti(){return pr.apply(null,arguments).exponent(.5)}function fo(){var q=[],At=identity;function Yt(Mt){if(!isNaN(Mt=+Mt))return At((bisect(q,Mt)-1)/(q.length-1))}return Yt.domain=function(Mt){if(!arguments.length)return q.slice();q=[];for(var Dt=0,$t=Mt.length,te;Dt<$t;++Dt)te=Mt[Dt],te!=null&&!isNaN(te=+te)&&q.push(te);return q.sort(ascending),Yt},Yt.interpolator=function(Mt){return arguments.length?(At=Mt,Yt):At},Yt.copy=function(){return fo(At).domain(q)},initInterpolator.apply(Yt,arguments)}function Fi(){var q=0,At=.5,Yt=1,Mt,Dt,$t,te,Qt,ve=rn,le,Ke=!1,ln;function an(Tn){return isNaN(Tn=+Tn)?ln:(Tn=.5+((Tn=+le(Tn))-Dt)*(Tn<Dt?te:Qt),ve(Ke?Math.max(0,Math.min(1,Tn)):Tn))}return an.domain=function(Tn){return arguments.length?(Mt=le(q=+Tn[0]),Dt=le(At=+Tn[1]),$t=le(Yt=+Tn[2]),te=Mt===Dt?0:.5/(Dt-Mt),Qt=Dt===$t?0:.5/($t-Dt),an):[q,At,Yt]},an.clamp=function(Tn){return arguments.length?(Ke=!!Tn,an):Ke},an.interpolator=function(Tn){return arguments.length?(ve=Tn,an):ve},an.unknown=function(Tn){return arguments.length?(ln=Tn,an):ln},function(Tn){return le=Tn,Mt=Tn(q),Dt=Tn(At),$t=Tn(Yt),te=Mt===Dt?0:.5/(Dt-Mt),Qt=Dt===$t?0:.5/($t-Dt),an}}function qi(){var q=Y(Fi()(rn));return q.copy=function(){return hi(q,qi())},ne.O.apply(q,arguments)}function zi(){var q=loggish(Fi()).domain([.1,1,10]);return q.copy=function(){return copy(q,zi()).base(q.base())},initInterpolator.apply(q,arguments)}function to(){var q=symlogish(Fi());return q.copy=function(){return copy(q,to()).constant(q.constant())},initInterpolator.apply(q,arguments)}function Pr(){var q=powish(Fi());return q.copy=function(){return copy(q,Pr()).exponent(q.exponent())},initInterpolator.apply(q,arguments)}function br(){return Pr.apply(null,arguments).exponent(.5)}function Or(q){let At,Yt=[];function Mt(Dt){return Dt==null?At:Dt}return Mt.invert=Mt,Mt.domain=Mt.range=Dt=>Dt?(Yt=Dt,Dt):Yt,Mt.unknown=Dt=>Dt?(At=Dt,Dt):At,Mt.copy=()=>Or(q).unknown(At),Mt}const{isNil:Bi,isString:ho,uniq:hn}=d.lodashUtil,zn=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,jn={[c.vY.LINEAR]:pt,[c.vY.POWER]:Re,[c.vY.LOG]:yn,[c.vY.IDENTITY]:Or,[c.vY.SEQUENTIAL]:Ti,[c.vY.TIME]:Oo,[c.vY.QUANTILE]:ar,[c.vY.QUANTIZE]:gr,[c.vY.THRESHOLD]:xr,[c.vY.CAT]:It,[c.vY.DIVERGING]:qi};class Xe{constructor(){(0,a.Z)(this,"scaleOptions",{})}apply(At,{styleAttributeService:Yt}){var Mt=this;At.hooks.init.tapPromise("FeatureScalePlugin",(0,i.Z)(function*(){var Dt;At.log(c.Or.ScaleInitStart,c.KD.INIT),Mt.scaleOptions=At.getScaleOptions();const $t=Yt.getLayerStyleAttributes(),te=(Dt=At.getSource())===null||Dt===void 0?void 0:Dt.data.dataArray;Array.isArray(te)&&te.length===0||(Mt.caculateScalesForAttributes($t||[],te),At.log(c.Or.ScaleInitEnd,c.KD.INIT))})),At.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var Dt=(0,i.Z)(function*($t){if(!$t)return $t;At.log(c.Or.ScaleInitStart,c.KD.UPDATE),Mt.scaleOptions=At.getScaleOptions();const te=Yt.getLayerStyleAttributes(),Qt=At.getSource().data.dataArray;return Array.isArray(Qt)&&Qt.length===0||(Mt.caculateScalesForAttributes(te||[],Qt),At.log(c.Or.ScaleInitEnd,c.KD.UPDATE),At.layerModelNeedUpdate=!0),!0});return function($t){return Dt.apply(this,arguments)}}()),At.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(At.layerModelNeedUpdate)return;this.scaleOptions=At.getScaleOptions();const Dt=Yt.getLayerStyleAttributes(),$t=At.getSource().data.dataArray;if(!(Array.isArray($t)&&$t.length===0)&&Dt){const te=Dt.filter(Qt=>Qt.needRescale);te.length&&this.caculateScalesForAttributes(te,$t)}})}isNumber(At){return!isNaN(parseFloat(At))&&isFinite(At)}caculateScalesForAttributes(At,Yt){At.forEach(Mt=>{if(Mt.scale){const Dt=Mt.scale,$t=Mt.scale.field;Dt.names=this.parseFields(Bi($t)?[]:$t);const te=[];Dt.names.forEach(Qt=>{var ve;te.push(this.createScale(Qt,Mt.name,(ve=Mt.scale)===null||ve===void 0?void 0:ve.values,Yt))}),te.some(Qt=>Qt.type===c.ee.VARIABLE)?(Dt.type=c.ee.VARIABLE,te.forEach(Qt=>{if(!Dt.callback&&Dt.values!=="text"){var ve;switch((ve=Qt.option)===null||ve===void 0?void 0:ve.type){case c.vY.LOG:case c.vY.LINEAR:case c.vY.POWER:if(Dt.values&&Dt.values.length>2){const Ke=Qt.scale.ticks(Dt.values.length);Qt.scale.domain(Ke)}Dt.values?Qt.scale.range(Dt.values):Qt.scale.range(Qt.option.domain);break;case c.vY.QUANTILE:case c.vY.QUANTIZE:case c.vY.THRESHOLD:Qt.scale.range(Dt.values);break;case c.vY.IDENTITY:break;case c.vY.CAT:Dt.values?Qt.scale.range(Dt.values):Qt.scale.range(Qt.option.domain);break;case c.vY.DIVERGING:case c.vY.SEQUENTIAL:Qt.scale.interpolator(l.hD(Dt.values));break}}if(Dt.values==="text"){var le;Qt.scale.range((le=Qt.option)===null||le===void 0?void 0:le.domain)}})):(Dt.type=c.ee.CONSTANT,Dt.defaultValues=te.map((Qt,ve)=>Qt.scale(Dt.names[ve]))),Dt.scalers=te.map(Qt=>({field:Qt.field,func:Qt.scale,option:Qt.option})),Mt.needRescale=!1}})}parseFields(At){return Array.isArray(At)?At:ho(At)?At.split("*"):[At]}createScale(At,Yt,Mt,Dt){var $t,te;const Qt=this.scaleOptions[Yt]&&(($t=this.scaleOptions[Yt])===null||$t===void 0?void 0:$t.field)===At?this.scaleOptions[Yt]:this.scaleOptions[At],ve={field:At,scale:void 0,type:c.ee.VARIABLE,option:Qt};if(!Dt||!Dt.length)return Qt&&Qt.type?ve.scale=this.createDefaultScale(Qt):(ve.scale=It([At]),ve.type=c.ee.CONSTANT),ve;const le=(te=Dt.find(Ke=>!Bi(Ke[At])))===null||te===void 0?void 0:te[At];if(this.isNumber(At)||Bi(le)&&!Qt)ve.scale=It([At]),ve.type=c.ee.CONSTANT;else{let Ke=Qt&&Qt.type||this.getDefaultType(le);Mt==="text"&&(Ke=c.vY.CAT),Mt===void 0&&(Ke=c.vY.IDENTITY);const ln=this.createScaleConfig(Ke,At,Qt,Dt);ve.scale=this.createDefaultScale(ln),ve.option=ln}return ve}getDefaultType(At){let Yt=c.vY.LINEAR;return typeof At=="string"&&(Yt=zn.test(At)?c.vY.TIME:c.vY.CAT),Yt}createScaleConfig(At,Yt,Mt,Dt){const $t={type:At};let te=[];if(At===c.vY.QUANTILE){const Qt=new Map;Dt==null||Dt.forEach(ve=>{Qt.set(ve._id,ve[Yt])}),te=Array.from(Qt.values())}else te=(Dt==null?void 0:Dt.map(Qt=>Qt[Yt]))||[];if(Mt!=null&&Mt.domain)$t.domain=Mt==null?void 0:Mt.domain;else if(At===c.vY.CAT||At===c.vY.IDENTITY)$t.domain=hn(te);else if(At===c.vY.QUANTILE)$t.domain=te;else if(At===c.vY.DIVERGING){const Qt=(0,m.Z)(te),ve=(Mt==null?void 0:Mt.neutral)!==void 0?Mt==null?void 0:Mt.neutral:(Qt[0]+Qt[1])/2;$t.domain=[Qt[0],ve,Qt[1]]}else $t.domain=(0,m.Z)(te);return(0,u.Z)((0,u.Z)({},$t),Mt)}createDefaultScale({type:At,domain:Yt,unknown:Mt,clamp:Dt,nice:$t}){const te=jn[At]();return Yt&&te.domain&&te.domain(Yt),Mt&&te.unknown(Mt),Dt!==void 0&&te.clamp&&te.clamp(Dt),$t!==void 0&&te.nice&&te.nice($t),te}}},43185:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(1413);class i{apply(c){c.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{c.animateStatus&&c.models.forEach(m=>{m.addUniforms((0,u.Z)({},c.layerModel.getAnimateUniforms()))})})}}},89870:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});class u{apply(a){a.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:c,enableMask:d}=a.getLayerConfig();!a.tileLayer&&c&&c.length>0&&a.updateLayerConfig({mask:d})})}}},97344:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(15861);var i=e(71590);class a{build(d){return(0,u.Z)(function*(){d.prepareBuildModel(),yield d.buildModels()})()}initLayerModel(d){var m=this;return(0,u.Z)(function*(){yield m.build(d),d.styleNeedUpdate=!1})()}prepareLayerModel(d){var m=this;return(0,u.Z)(function*(){yield m.build(d),d.styleNeedUpdate=!1})()}apply(d){var m=this;d.hooks.init.tapPromise("LayerModelPlugin",(0,u.Z)(function*(){if(d.getSource().isTile){d.prepareBuildModel();return}d.log(i.Or.BuildModelStart,i.KD.INIT),yield m.initLayerModel(d),d.log(i.Or.BuildModelEnd,i.KD.INIT)})),d.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var l=(0,u.Z)(function*(r){return!r||d.getSource().isTile?!1:(d.log(i.Or.BuildModelStart,i.KD.UPDATE),yield m.prepareLayerModel(d),d.log(i.Or.BuildModelEnd,i.KD.UPDATE),!0)});return function(r){return l.apply(this,arguments)}}())}}},8131:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});class u{apply(a){a.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:c,fitBoundsOptions:d}=a.getLayerConfig();c&&a.fitBounds(d),a.styleNeedUpdate=!1})}}},87337:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(45987);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);const a=/^(1887|7596)$/.test(e.j)?null:["type"],c={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},d={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},m={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},l={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function r(g){const A={u_DirectionalLights:new Array(3).fill((0,i.Z)({},m)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,i.Z)({},l)),u_NumOfSpotLights:0};return(!g||!g.length)&&(g=[d]),g.forEach(o=>{let{type:S="directional"}=o,T=(0,u.Z)(o,a);const E=c[S].lights,b=c[S].num,C=A[b];A[E][C]=(0,i.Z)((0,i.Z)({},A[E][C]),T),A[b]++}),A}class h{apply(A){A.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:o}=A.getLayerConfig();o&&A.models.forEach(S=>S.addUniforms((0,i.Z)({},r())))})}}},52019:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(4942);if(!/^(1887|7596)$/.test(e.j))var i=e(32271);class a{constructor(){(0,u.Z)(this,"enabled",void 0)}apply(d,{rendererService:m,postProcessingPassFactory:l,normalPassFactory:r}){d.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:h,passes:g=[]}=d.getLayerConfig();this.enabled=!!h&&d.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(d.multiPassRenderer=(0,i.N)(d,g,l,r),d.multiPassRenderer.setRenderFlag(!0))}),d.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:h,height:g}=m.getViewportSize();d.multiPassRenderer.resize(h,g)}})}}},28394:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(4942);var i=e(71590),a=e(64939);if(!/^(1887|7596)$/.test(e.j))var c=e(36307);const{isNumber:d}=a.lodashUtil,m={NONE:0,ENCODE:1,HIGHLIGHT:2};class l{constructor(){(0,u.Z)(this,"pickingUniformMap",void 0)}pickOption2Array(){const h=[];return this.pickingUniformMap.forEach(g=>{d(g)?h.push(g):h.push(...g)}),h}updatePickOption(h,g){Object.keys(h).forEach(T=>{this.pickingUniformMap.set(T,h[T])});const A=g.getLayerConfig().pickingBuffer||0,o=Number(g.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",A),this.pickingUniformMap.set("u_shaderPick",o),g.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(h,{styleAttributeService:g}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),h.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:A}=h.getLayerConfig();g.registerStyleAttribute({name:"pickingColor",type:i.GC.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:c.F.PICKING_COLOR,buffer:{data:[],type:i.gl.FLOAT},size:3,update:o=>{const{id:S}=o;return A?(0,a.Z6)(S):[0,0,0]}}})}),h.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:A}=h.getLayerConfig();A&&h.isVisible()&&(this.updatePickOption({u_PickingStage:m.ENCODE},h),h.models.forEach(o=>o.addUniforms({u_PickingStage:m.ENCODE})))}),h.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:A}=h.getLayerConfig();A&&h.isVisible()&&(this.updatePickOption({u_PickingStage:m.HIGHLIGHT},h),h.models.forEach(o=>o.addUniforms({u_PickingStage:m.HIGHLIGHT})))}),h.hooks.beforeHighlight.tap("PixelPickingPlugin",A=>{const{highlightColor:o,activeMix:S=0}=h.getLayerConfig(),T=typeof o=="string"?(0,a.CI)(o):o||[1,0,0,1];h.updateLayerConfig({pickedFeatureID:(0,a.W0)(new Uint8Array(A))});const E={u_PickingStage:m.HIGHLIGHT,u_PickingColor:A,u_HighlightColor:T.map(b=>b*255),u_activeMix:S};this.updatePickOption(E,h),h.models.forEach(b=>b.addUniforms(E))}),h.hooks.beforeSelect.tap("PixelPickingPlugin",A=>{const{selectColor:o,selectMix:S=0}=h.getLayerConfig(),T=typeof o=="string"?(0,a.CI)(o):o||[1,0,0,1];h.updateLayerConfig({pickedFeatureID:(0,a.W0)(new Uint8Array(A))});const E={u_PickingStage:m.HIGHLIGHT,u_PickingColor:A,u_HighlightColor:T.map(b=>b*255),u_activeMix:S,u_CurrentSelectedId:A,u_SelectColor:T.map(b=>b*255)};this.updatePickOption(E,h),h.models.forEach(b=>b.addUniforms(E))})}}},13990:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(71590);if(!/^(1887|7596)$/.test(e.j))var i=e(36307);if(!/^(1887|7596)$/.test(e.j))var a=e(58369);class c{apply(m,{styleAttributeService:l}){m.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{(0,a.s)(m)||this.registerBuiltinAttributes(l,m)})}registerBuiltinAttributes(m,l){if(l.type==="MaskLayer"){this.registerPositionAttribute(m);return}this.registerPositionAttribute(m),this.registerColorAttribute(m)}registerPositionAttribute(m){m.registerStyleAttribute({name:"position",type:u.GC.Attribute,descriptor:{name:"a_Position",shaderLocation:i.F.POSITION,buffer:{data:[],type:u.gl.FLOAT},size:3,update:(l,r,h)=>h.length===2?[h[0],h[1],0]:[h[0],h[1],h[2]]}})}registerColorAttribute(m){m.registerStyleAttribute({name:"color",type:u.GC.Attribute,descriptor:{name:"a_Color",shaderLocation:i.F.COLOR,buffer:{usage:u.gl.DYNAMIC_DRAW,data:[],type:u.gl.FLOAT},size:4,update:l=>{const{color:r}=l;return!r||!r.length?[1,1,1,1]:r}}})}}},88672:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>c}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(71590);class c{constructor(){(0,i.Z)(this,"cameraService",void 0),(0,i.Z)(this,"coordinateSystemService",void 0),(0,i.Z)(this,"rendererService",void 0),(0,i.Z)(this,"mapService",void 0),(0,i.Z)(this,"layerService",void 0)}apply(m,{rendererService:l,mapService:r,layerService:h,coordinateSystemService:g,cameraService:A}){this.rendererService=l,this.mapService=r,this.layerService=h,this.coordinateSystemService=g,this.cameraService=A;let o;this.rendererService.uniformBuffers[0]||(o=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=o),m.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const S=m.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(S);const{width:T,height:E}=this.rendererService.getViewportSize(),{data:b,uniforms:C}=this.generateUBO(T,E);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:b}),this.rendererService.queryVerdorInfo()==="WebGL1"&&m.models.forEach(R=>{R.addUniforms((0,u.Z)((0,u.Z)({},C),{},{u_PickingBuffer:m.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(m.getShaderPickStat())}))})})}generateUBO(m,l){const r=this.cameraService.getProjectionMatrix(),h=this.cameraService.getViewMatrix(),g=this.cameraService.getViewProjectionMatrix(),A=this.cameraService.getModelMatrix(),o=this.coordinateSystemService.getViewportCenterProjection(),S=this.coordinateSystemService.getPixelsPerDegree(),T=this.cameraService.getZoom(),E=this.coordinateSystemService.getPixelsPerDegree2(),b=this.cameraService.getZoomScale(),C=this.coordinateSystemService.getPixelsPerMeter(),X=this.coordinateSystemService.getCoordinateSystem(),R=this.cameraService.getCameraPosition(),M=window.devicePixelRatio,Z=this.coordinateSystemService.getViewportCenter(),rt=[m,l],N=this.cameraService.getFocalDistance();return{data:[...h,...r,...g,...A,...o,...S,T,...E,b,...C,X,...R,M,...Z,...rt,N,0,0,0],uniforms:{[a.lv.ProjectionMatrix]:r,[a.lv.ViewMatrix]:h,[a.lv.ViewProjectionMatrix]:g,[a.lv.Zoom]:T,[a.lv.ZoomScale]:b,[a.lv.FocalDistance]:N,[a.lv.CameraPosition]:R,[a.kw.CoordinateSystem]:X,[a.kw.ViewportCenter]:Z,[a.kw.ViewportCenterProjection]:o,[a.kw.PixelsPerDegree]:S,[a.kw.PixelsPerDegree2]:E,[a.kw.PixelsPerMeter]:C,u_ViewportSize:rt,u_ModelMatrix:A,u_DevicePixelRatio:M}}}}},96654:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});class u{apply(a){a.hooks.beforeRender.tap("UpdateModelPlugin",()=>{a.layerModel&&a.layerModel.needUpdate().then(c=>{c&&a.renderLayers()})}),a.hooks.afterRender.tap("UpdateModelPlugin",()=>{a.layerModelNeedUpdate=!1})}}},21834:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});class u{apply(a,{styleAttributeService:c}){a.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(a,{styleAttributeService:c})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{a.layerModelNeedUpdate||a.inited&&this.updateStyleAttribute(a,{styleAttributeService:c})})}updateStyleAttribute(a,{styleAttributeService:c}){const d=c.getLayerStyleAttributes()||[],m=c.getLayerStyleAttribute("filter");if(m&&m.needRegenerateVertices){a.layerModelNeedUpdate=!0,d.forEach(l=>l.needRegenerateVertices=!1);return}d.filter(l=>l.needRegenerateVertices).forEach(l=>{c.updateAttributeByFeatureRange(l.name,a.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,a),l.needRegenerateVertices=!1})}initStyleAttribute(a,{styleAttributeService:c}){(c.getLayerStyleAttributes()||[]).filter(m=>m.needRegenerateVertices).forEach(m=>{c.updateAttributeByFeatureRange(m.name,a.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}}},88212:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>E}),!/^(1887|7596)$/.test(e.j))var u=e(35946);if(!/^(1887|7596)$/.test(e.j))var i=e(61418);if(!/^(1887|7596)$/.test(e.j))var a=e(1111);if(!/^(1887|7596)$/.test(e.j))var c=e(43185);if(!/^(1887|7596)$/.test(e.j))var d=e(89870);if(!/^(1887|7596)$/.test(e.j))var m=e(97344);if(!/^(1887|7596)$/.test(e.j))var l=e(8131);if(!/^(1887|7596)$/.test(e.j))var r=e(87337);if(!/^(1887|7596)$/.test(e.j))var h=e(52019);if(!/^(1887|7596)$/.test(e.j))var g=e(28394);if(!/^(1887|7596)$/.test(e.j))var A=e(13990);if(!/^(1887|7596)$/.test(e.j))var o=e(88672);if(!/^(1887|7596)$/.test(e.j))var S=e(96654);if(!/^(1887|7596)$/.test(e.j))var T=e(21834);function E(){return[new i.Z,new A.Z,new a.Z,new u.Z,new l.Z,new d.Z,new T.Z,new S.Z,new h.Z,new o.Z,new c.Z,new r.Z,new g.Z,new m.Z]}},64380:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(53475);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","PointLayer"),(0,i.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,i.Z)(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,i.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel&&l.layerModel.clearModels(),l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}rebuildModels(){var l=this;return(0,u.Z)(function*(){yield l.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:l,values:r}=this.shapeOption,{shape2d:h}=this.getLayerConfig(),g=this.iconService.getIconMap();if(l&&(h==null?void 0:h.indexOf(l))!==-1)return"fill";if(r==="text")return"text";if(r&&r instanceof Array){for(const A of r)if(typeof A=="string"&&g.hasOwnProperty(A))return"image"}}return"normal"}getDefaultConfig(){const l=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[l]}getModelType(){const l=this.getEncodedData(),{shape2d:r,shape3d:h,billboard:g=!0}=this.getLayerConfig(),A=this.iconService.getIconMap(),o=l.find(S=>S.hasOwnProperty("shape"));if(o){const S=o.shape;return S==="dot"?"normal":S==="simple"?"simplePoint":S==="radar"?"radar":this.layerType==="fillImage"||g===!1?"fillImage":(r==null?void 0:r.indexOf(S))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(h==null?void 0:h.indexOf(S))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":A.hasOwnProperty(S)?"image":"text"}else return this.getModelTypeWillEmptyData()}}},94535:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(71590),c=e(64939);if(!/^(1887|7596)$/.test(e.j))var d=e(98422);if(!/^(1887|7596)$/.test(e.j))var m=e(42659);const l=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,r=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if (u_heightfixed < 1.0) {
    // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
  } else {
    // \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if (u_linearColor == 1.0) {
    // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`;class h extends(/^(1887|7596)$/.test(e.j)?null:d.Z){constructor(...A){super(...A),(0,i.Z)(this,"raiseCount",0),(0,i.Z)(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:A={enable:!1,speed:.01,repeat:!1},sourceColor:o,targetColor:S,pickLight:T=!1,heightfixed:E=!1,opacityLinear:b={enable:!1,dir:"up"},lightEnable:C=!0}=this.layer.getLayerConfig();let X=0,R=[0,0,0,0],M=[0,0,0,0];if(o&&S&&(R=(0,c.CI)(o),M=(0,c.CI)(S),X=1),this.raiseCount<1&&this.raiseRepeat>0&&A.enable){const{speed:N=.01}=A;this.raiseCount+=N,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const Z={u_pickLight:Number(T),u_heightfixed:Number(E),u_r:A.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:X,u_sourceColor:R,u_targetColor:M,u_opacitylinear:Number(b.enable),u_opacitylinear_dir:b.dir==="up"?1:0,u_lightEnable:Number(C)};return this.getUniformsBufferInfo(Z)}initModels(){var A=this;return(0,u.Z)(function*(){return A.buildModels()})()}buildModels(){var A=this;return(0,u.Z)(function*(){const{depth:o=!0,animateOption:{repeat:S=1}}=A.layer.getLayerConfig();return A.raiseRepeat=S,A.initUniformsBuffer(),[yield A.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:r,fragmentShader:l,triangulation:m.NM,defines:A.getDefines(),inject:A.getInject(),cull:{enable:!0,face:a.gl.FRONT},depth:{enable:o}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:a.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:A=>{const{size:o}=A;if(o){let S=[];return Array.isArray(o)&&(S=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(S=[o,o,o]),S}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:a.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:a.gl.STATIC_DRAW,data:[],type:a.gl.FLOAT},size:3,update:(A,o,S,T,E)=>E}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:a.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:4,update:A=>{const o=(0,c.SI)(A.coordinates);return[o[0],o[1],(0,c.Ks)(o[0]),(0,c.Ks)(o[1])]}}})}}},92841:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>r}),!/^(1887|7596)$/.test(e.j))var u=e(15861);var i=e(71590);if(!/^(1887|7596)$/.test(e.j))var a=e(98422);if(!/^(1887|7596)$/.test(e.j))var c=e(42659);if(!/^(1887|7596)$/.test(e.j))var d=e(76514);const m=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,l=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class r extends(/^(1887|7596)$/.test(e.j)?null:a.Z){get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:g=1,strokeWidth:A=0,blend:o,blur:S=0,raisingHeight:T=0,heightfixed:E=!1,unit:b="pixel"}=this.layer.getLayerConfig();let C=this.getAnimateUniforms().u_time;isNaN(C)&&(C=-1);const X={u_blur_height_fixed:[S,Number(T),Number(E)],u_stroke_width:A,u_additive:o==="additive"?1:0,u_stroke_opacity:g,u_size_unit:d.xg[b],u_time:C,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(X)}getAnimateUniforms(){const{animateOption:g={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(g),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),c.oX)}initModels(){var g=this;return(0,u.Z)(function*(){return g.buildModels()})()}buildModels(){var g=this;return(0,u.Z)(function*(){const{frag:A,vert:o,type:S}=g.getShaders();return g.layer.triangulation=c.oX,g.initUniformsBuffer(),[yield g.layer.buildLayerModel({moduleName:S,vertexShader:o,fragmentShader:A,defines:g.getDefines(),inject:g.getInject(),triangulation:c.oX,depth:{enable:!1}})]})()}getShaders(){return{frag:m,vert:l,type:"pointFill"}}animateOption2Array(g){return[g.enable?0:1,g.speed||1,g.rings||3,0]}registerBuiltinAttributes(){const g=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:(A,o,S,T)=>{const E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=T%4*3;return[E[b],E[b+1],E[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:A=>{const{size:o=5}=A;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.GC.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:A=>{const{shape:o=2}=A;return[g.indexOf(o)]}}})}}},12845:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(71590);if(!/^(1887|7596)$/.test(e.j))var d=e(98422);if(!/^(1887|7596)$/.test(e.j))var m=e(42659);const l=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,r=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class h extends(/^(1887|7596)$/.test(e.j)?null:d.Z){constructor(...A){super(...A),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"updateTexture",()=>{const{createTexture2D:o}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=o({data:this.iconService.getCanvas(),mag:c.gl.LINEAR,min:c.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var A;(A=this.texture)===null||A===void 0||A.bind()}const o=this.getCommonUniformsInfo(),S=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},o.uniformsOption),S.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:A=0,heightfixed:o=!1}=this.layer.getLayerConfig(),S={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(A),u_heightfixed:Number(o),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(S)}initModels(){var A=this;return(0,u.Z)(function*(){return A.iconService.on("imageUpdate",A.updateTexture),A.updateTexture(),A.buildModels()})()}clearModels(){var A;(A=this.texture)===null||A===void 0||A.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var A=this;return(0,u.Z)(function*(){return A.initUniformsBuffer(),[yield A.layer.buildLayerModel({moduleName:"pointImage",vertexShader:r,fragmentShader:l,triangulation:m.xH,defines:A.getDefines(),inject:A.getInject(),depth:{enable:!1},primitive:c.gl.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:c.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:1,update:A=>{const{size:o=5}=A;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:A=>{const o=this.iconService.getIconMap(),{shape:S}=A,{x:T,y:E}=o[S]||{x:-64,y:-64};return[T,E]}}})}}},53475:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>H});var u=e(15861),i=e(71590),a=e(98422),c=e(64939);const d=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,m=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function l(U){const V=U.coordinates;return{vertices:[...V],indices:[0],size:V.length}}class r extends a.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:V,strokeOpacity:D=1,strokeWidth:lt=0,stroke:J="#fff"}=this.layer.getLayerConfig(),Rt={u_stroke_color:(0,c.CI)(J),u_additive:V==="additive"?1:0,u_stroke_opacity:D,u_stroke_width:lt};return this.getUniformsBufferInfo(Rt)}initModels(){var V=this;return(0,u.Z)(function*(){return V.buildModels()})()}buildModels(){var V=this;return(0,u.Z)(function*(){return V.layer.triangulation=l,V.initUniformsBuffer(),[yield V.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:m,fragmentShader:d,defines:V.getDefines(),inject:V.getInject(),triangulation:l,depth:{enable:!1},primitive:i.gl.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:V=>{const{size:D=1}=V;return Array.isArray(D)?[D[0]]:[D]}}})}}var h=e(4942),g=e(42659),A=e(90440);const o=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,S=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    //
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:T}=c.lodashUtil;class E extends a.Z{constructor(...V){super(...V),(0,h.Z)(this,"raiseCount",0),(0,h.Z)(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:V={enable:!1,speed:.01,repeat:!1},opacity:D=1,sourceColor:lt,targetColor:J,pickLight:Rt=!1,heightfixed:kt=!0,opacityLinear:ne={enable:!1,dir:"up"},lightEnable:re=!0}=this.layer.getLayerConfig();let It=0,Nt=[0,0,0,0],p=[0,0,0,0];if(lt&&J&&(Nt=(0,c.CI)(lt),p=(0,c.CI)(J),It=1),this.raiseCount<1&&this.raiseRepeat>0&&V.enable){const{speed:st=.01}=V;this.raiseCount+=st,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const w={u_sourceColor:Nt,u_targetColor:p,u_linearColor:It,u_pickLight:Number(Rt),u_heightfixed:Number(kt),u_r:V.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:T(D)?D:1,u_opacitylinear:Number(ne.enable),u_opacitylinear_dir:ne.dir==="up"?1:0,u_lightEnable:Number(re)};return this.getUniformsBufferInfo(w)}initModels(){var V=this;return(0,u.Z)(function*(){return V.initUniformsBuffer(),V.buildModels()})()}buildModels(){var V=this;return(0,u.Z)(function*(){const{animateOption:{repeat:D=1}}=V.layer.getLayerConfig();return V.raiseRepeat=D,[yield V.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:S,fragmentShader:o,triangulation:g.NM,depth:{enable:!0},defines:V.getDefines(),inject:V.getInject(),cull:{enable:!0,face:i.gl.FRONT},blend:V.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:V=>{const{size:D}=V;if(D){let lt=[];return Array.isArray(D)&&(lt=D.length===2?[D[0],D[0],D[1]]:D),Array.isArray(D)||(lt=[D,D,D]),lt}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:i.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:i.gl.STATIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:(V,D,lt,J,Rt)=>Rt}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:i.GC.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:V=>{const D=(0,c.SI)(V.coordinates);return(0,A.rq)([D[0],D[1]])}}})}}var b=e(77160),C=e(85975);const X=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,R=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`;class M extends a.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:V=1,strokeWidth:D=0,blend:lt,blur:J=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const Rt={u_additive:lt==="additive"?1:0,u_stroke_opacity:V,u_stroke_width:D,u_blur:J};return this.getUniformsBufferInfo(Rt)}initModels(){var V=this;return(0,u.Z)(function*(){return V.initUniformsBuffer(),V.buildModels()})()}buildModels(){var V=this;return(0,u.Z)(function*(){return V.layer.triangulation=g.S,[yield V.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:R,fragmentShader:X,triangulation:g.S,defines:V.getDefines(),inject:V.getInject(),depth:{enable:!0},blend:V.getBlend()})]})()}animateOption2Array(V){return[V.enable?0:1,V.speed||1,V.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:(V,D,lt,J)=>{const[Rt,kt,ne]=lt,re=b.al(0,0,1),It=b.al(Rt,0,ne),Nt=Rt>=0?b.EU(re,It):Math.PI*2-b.EU(re,It),p=Math.PI*2-Math.asin(kt/100),w=C.Ue();C.uD(w,w,Nt),C.lM(w,w,p);const W=b.al(1,1,0);b.fF(W,W,w),b.Fv(W,W);const st=b.al(-1,1,0);b.fF(st,st,w),b.Fv(st,st);const Tt=b.al(-1,-1,0);b.fF(Tt,Tt,w),b.Fv(Tt,Tt);const Gt=b.al(1,-1,0);b.fF(Gt,Gt,w),b.Fv(Gt,Gt);const ze=[...W,...st,...Tt,...Gt],$e=J%4*3;return[ze[$e],ze[$e+1],ze[$e+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:V=>{const{size:D=5}=V;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:i.GC.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:V=>{const{shape:D=2}=V;return[this.layer.getLayerConfig().shape2d.indexOf(D)]}}})}}var Z=e(94535),rt=e(92841),N=e(76514);const Q=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,ft=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class I extends a.Z{constructor(...V){super(...V),(0,h.Z)(this,"meter2coord",1),(0,h.Z)(this,"texture",void 0),(0,h.Z)(this,"isMeter",!1),(0,h.Z)(this,"radian",0),(0,h.Z)(this,"updateTexture",()=>{const{createTexture2D:D}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=D({data:this.iconService.getCanvas(),mag:i.gl.LINEAR,min:i.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:V=0,heightfixed:D=!1,unit:lt="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var J;(J=this.texture)===null||J===void 0||J.bind()}const Rt={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(D),u_raisingHeight:Number(V),u_size_unit:N.xg[lt]};return this.getUniformsBufferInfo(Rt)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),g.oX)}initModels(){var V=this;return(0,u.Z)(function*(){return V.iconService.on("imageUpdate",V.updateTexture),V.updateTexture(),V.buildModels()})()}buildModels(){var V=this;return(0,u.Z)(function*(){return V.initUniformsBuffer(),[yield V.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:ft,fragmentShader:Q,triangulation:g.oX,depth:{enable:!1},defines:V.getDefines(),inject:V.getInject(),cull:{enable:!0,face:i.gl.FRONT}})]})()}clearModels(){var V;this.iconService.off("imageUpdate",this.updateTexture),(V=this.texture)===null||V===void 0||V.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:i.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:2,update:V=>{const D=this.iconService.getIconMap(),{shape:lt}=V,{x:J,y:Rt}=D[lt]||{x:-64,y:-64};return[J,Rt]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:(V,D,lt,J)=>{const Rt=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],kt=J%4*3;return[Rt[kt],Rt[kt+1],Rt[kt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:V=>{const{size:D=5}=V;return Array.isArray(D)?[D[0]]:[D]}}})}}var G=e(12845),ut=e(40066);const L=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,j=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class O extends a.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:V,speed:D=1,unit:lt="pixel"}=this.layer.getLayerConfig(),J={u_additive:V==="additive"?1:0,u_size_unit:N.xg[lt],u_speed:D,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(J)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),g.oX)}initModels(){var V=this;return(0,u.Z)(function*(){return V.buildModels()})()}buildModels(){var V=this;return(0,u.Z)(function*(){return V.initUniformsBuffer(),[yield V.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:j,fragmentShader:L,triangulation:g.oX,defines:V.getDefines(),inject:V.getInject(),depth:{enable:!1}})]})()}animateOption2Array(V){return[V.enable?0:1,V.speed||1,V.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:i.GC.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:3,update:(V,D,lt,J)=>{const Rt=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],kt=J%4*3;return[Rt[kt],Rt[kt+1],Rt[kt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:V=>{const{size:D=5}=V;return Array.isArray(D)?[D[0]]:[D]}}})}}var B=e(79069);const H={fillImage:I,fill:rt.Z,radar:O,image:G.Z,normal:ut.Z,simplePoint:r,extrude:Z.Z,text:B.Z,earthFill:M,earthExtrude:E}},40066:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(15861);var i=e(71590);if(!/^(1887|7596)$/.test(e.j))var a=e(98422);const c=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,d=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`;function m(r){const h=r.coordinates;return{vertices:[...h],indices:[0],size:h.length}}class l extends(/^(1887|7596)$/.test(e.j)?null:a.Z){get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const h={u_size_scale:.5};return this.getUniformsBufferInfo(h)}initModels(){var h=this;return(0,u.Z)(function*(){return h.buildModels()})()}buildModels(){var h=this;return(0,u.Z)(function*(){return h.layer.triangulation=m,h.initUniformsBuffer(),[yield h.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:d,fragmentShader:c,triangulation:m,defines:h.getDefines(),inject:h.getInject(),depth:{enable:!1},primitive:i.gl.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:i.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:i.gl.DYNAMIC_DRAW,data:[],type:i.gl.FLOAT},size:1,update:h=>{const{size:g=1}=h;return Array.isArray(g)?[g[0]]:[g]}}})}}},79069:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>S}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(71590),d=e(64939);if(!/^(1887|7596)$/.test(e.j))var m=e(98422);if(!/^(1887|7596)$/.test(e.j))var l=e(30511);if(!/^(1887|7596)$/.test(e.j))var r=e(34135);const h=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,g=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:A}=d.lodashUtil;function o(T){const E=this,b=T.id,C=[],X=[];if(!E.glyphInfoMap||!E.glyphInfoMap[b])return{vertices:[],indices:[],size:7};const R=E.glyphInfoMap[b].centroid,M=R.length===2?[R[0],R[1],0]:R;return E.glyphInfoMap[b].glyphQuads.forEach((Z,rt)=>{C.push(...M,Z.tex.x,Z.tex.y+Z.tex.height,Z.tl.x,Z.tl.y,...M,Z.tex.x+Z.tex.width,Z.tex.y+Z.tex.height,Z.tr.x,Z.tr.y,...M,Z.tex.x+Z.tex.width,Z.tex.y,Z.br.x,Z.br.y,...M,Z.tex.x,Z.tex.y,Z.bl.x,Z.bl.y),X.push(0+rt*4,1+rt*4,2+rt*4,2+rt*4,3+rt*4,0+rt*4)}),{vertices:C,indices:X,size:7}}class S extends(/^(1887|7596)$/.test(e.j)?null:m.Z){constructor(...E){var b;super(...E),b=this,(0,a.Z)(this,"glyphInfo",void 0),(0,a.Z)(this,"glyphInfoMap",{}),(0,a.Z)(this,"rawEncodeData",void 0),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"currentZoom",-1),(0,a.Z)(this,"extent",void 0),(0,a.Z)(this,"textureHeight",0),(0,a.Z)(this,"textCount",0),(0,a.Z)(this,"preTextStyle",{}),(0,a.Z)(this,"mapping",(0,i.Z)(function*(){b.initGlyph(),b.updateTexture(),yield b.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const E=this.getCommonUniformsInfo(),b=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,u.Z)((0,u.Z)((0,u.Z)({},E.uniformsOption),b.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:E="#fff",strokeWidth:b=0,halo:C=.5,gamma:X=2,raisingHeight:R=0}=this.layer.getLayerConfig(),M=this.getFontServiceMapping(),Z=this.getFontServiceCanvas();M&&Object.keys(M).length!==this.textCount&&Z&&(this.updateTexture(),this.textCount=Object.keys(M).length),this.preTextStyle=this.getTextStyle();const rt={u_stroke_color:(0,d.CI)(E),u_sdf_map_size:[(Z==null?void 0:Z.width)||1,(Z==null?void 0:Z.height)||1],u_raisingHeight:Number(R),u_stroke_width:b,u_gamma_scale:X,u_halo_blur:C};return this.getUniformsBufferInfo(rt)}initModels(){var E=this;return(0,i.Z)(function*(){return E.bindEvent(),E.extent=E.textExtent(),E.rawEncodeData=E.layer.getEncodedData(),E.preTextStyle=E.getTextStyle(),E.initUniformsBuffer(),E.buildModels()})()}buildModels(){var E=this;return(0,i.Z)(function*(){const{textAllowOverlap:b=!1}=E.layer.getLayerConfig();return E.initGlyph(),E.updateTexture(),b||E.filterGlyphs(),[yield E.layer.buildLayerModel({moduleName:"pointText",vertexShader:g,fragmentShader:h,defines:E.getDefines(),inject:E.getInject(),triangulation:o.bind(E),depth:{enable:!1}})]})()}needUpdate(){var E=this;return(0,i.Z)(function*(){const{textAllowOverlap:b=!1,textAnchor:C="center",textOffset:X,padding:R,fontFamily:M,fontWeight:Z}=E.getTextStyle();if(!A(R,E.preTextStyle.padding)||!A(X,E.preTextStyle.textOffset)||!A(C,E.preTextStyle.textAnchor)||!A(M,E.preTextStyle.fontFamily)||!A(Z,E.preTextStyle.fontWeight))return yield E.mapping(),!0;if(b)return!1;const rt=E.mapService.getZoom(),N=E.mapService.getBounds(),Q=(0,d.oO)(E.extent,N);return Math.abs(E.currentZoom-rt)>.5||!Q||b!==E.preTextStyle.textAllowOverlap?(yield E.reBuildModel(),!0):!1})()}clearModels(){var E;(E=this.texture)===null||E===void 0||E.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:c.GC.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:c.gl.STATIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(E,b,C)=>[C[5],C[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:c.GC.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(E,b,C)=>[C[3],C[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:c.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:1,update:E=>{const{size:b=12}=E;return Array.isArray(b)?[b[0]]:[b]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const E=this.mapService.getBounds();return(0,d.yA)(E,.5)}initTextFont(){const{fontWeight:E,fontFamily:b}=this.getTextStyle(),C=this.rawEncodeData,X=[];C.forEach(R=>{let{shape:M=""}=R;M=M.toString();for(const Z of M)X.indexOf(Z)===-1&&X.push(Z)}),this.fontService.setFontOptions({characterSet:X,fontWeight:E,fontFamily:b,iconfont:!1})}initIconFontTex(){const{fontWeight:E,fontFamily:b}=this.getTextStyle(),C=this.rawEncodeData,X=[];C.forEach(R=>{let{shape:M=""}=R;M=`${M}`,X.indexOf(M)===-1&&X.push(M)}),this.fontService.setFontOptions({characterSet:X,fontWeight:E,fontFamily:b,iconfont:!0})}getTextStyle(){const{fontWeight:E="400",fontFamily:b="sans-serif",textAllowOverlap:C=!1,padding:X=[0,0],textAnchor:R="center",textOffset:M=[0,0],opacity:Z=1,strokeOpacity:rt=1,strokeWidth:N=0,stroke:Q="#000"}=this.layer.getLayerConfig();return{fontWeight:E,fontFamily:b,textAllowOverlap:C,padding:X,textAnchor:R,textOffset:M,opacity:Z,strokeOpacity:rt,strokeWidth:N,stroke:Q}}generateGlyphLayout(E){const b=this.getFontServiceMapping(),{spacing:C=2,textAnchor:X="center",textOffset:R}=this.layer.getLayerConfig(),M=this.rawEncodeData;this.glyphInfo=M.map(Z=>{const{shape:rt="",id:N,size:Q=1}=Z,ft=Z.textOffset?Z.textOffset:R||[0,0],I=Z.textAnchor?Z.textAnchor:X||"center",G=(0,r.h)(rt.toString(),b,Q,I,"left",C,ft,E),ut=(0,r.E)(G,ft,!1);return Z.shaping=G,Z.glyphQuads=ut,Z.centroid=(0,d.SI)(Z.coordinates),this.glyphInfoMap[N]={shaping:G,glyphQuads:ut,centroid:(0,d.SI)(Z.coordinates)},Z})}getFontServiceMapping(){const{fontWeight:E="400",fontFamily:b="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${b}_${E}`)}getFontServiceCanvas(){const{fontWeight:E="400",fontFamily:b="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${b}_${E}`)}filterGlyphs(){const{padding:E=[0,0],textAllowOverlap:b=!1}=this.layer.getLayerConfig();if(b)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:C,height:X}=this.rendererService.getViewportSize(),R=new l.Z(C,X);this.glyphInfo.filter(Z=>{const{shaping:rt,id:N=0}=Z,Q=Z.centroid,I=Z.size/16,G=this.mapService.lngLatToContainer(Q),{box:ut}=R.placeCollisionBox({x1:rt.left*I-E[0],x2:rt.right*I+E[0],y1:rt.top*I-E[1],y2:rt.bottom*I+E[1],anchorPointX:G.x,anchorPointY:G.y});return ut&&ut.length?(R.insertCollisionBox(ut,N),!0):!1}).forEach(Z=>{this.glyphInfoMap[Z.id]=Z})}initGlyph(){const{iconfont:E=!1}=this.layer.getLayerConfig();E?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(E)}updateTexture(){const{createTexture2D:E}=this.rendererService,b=this.getFontServiceCanvas();this.textureHeight=b.height,this.texture&&this.texture.destroy(),this.texture=E({data:b,mag:c.gl.LINEAR,min:c.gl.LINEAR,width:b.width,height:b.height}),this.textures=[this.texture]}reBuildModel(){var E=this;return(0,i.Z)(function*(){E.filterGlyphs();const b=yield E.layer.buildLayerModel({moduleName:"pointText",vertexShader:g,fragmentShader:h,triangulation:o.bind(E),defines:E.getDefines(),inject:E.getInject(),depth:{enable:!1}});E.layer.models=[b]})()}}},89955:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(16762);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","PolygonLayer"),(0,i.Z)(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}getModelType(){var l;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),h=r==null||(l=r.scale)===null||l===void 0?void 0:l.field;return h==="fill"||!h?"fill":h==="extrude"?"extrude":h==="extrusion"?"extrusion":h==="water"?"water":h==="ocean"?"ocean":h==="line"?"line":this.getPointModelType()}getPointModelType(){const l=this.getEncodedData(),{shape2d:r,shape3d:h}=this.getLayerConfig(),g=this.iconService.getIconMap(),A=l.find(o=>o.hasOwnProperty("shape"));if(A){const o=A.shape;return o==="dot"?"point_normal":(r==null?void 0:r.indexOf(o))!==-1?"point_fill":(h==null?void 0:h.indexOf(o))!==-1?"point_extrude":g.hasOwnProperty(o)?"point_image":"text"}else return"fill"}}},16762:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>D});var u=e(82613),i=e(94535),a=e(92841),c=e(12845),d=e(40066),m=e(79069),l=e(15861),r=e(1413),h=e(4942),g=e(71590),A=e(64939),o=e(98422),S=e(42659),T=e(34276);const E=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,b=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,C=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,X=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,R=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,M=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Z extends o.Z{constructor(...J){super(...J),(0,h.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const J=this.getCommonUniformsInfo(),Rt=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,r.Z)((0,r.Z)({},J.uniformsOption),Rt.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:J,heightfixed:Rt=!1,raisingHeight:kt=0,topsurface:ne=!0,sidesurface:re=!0,sourceColor:It,targetColor:Nt}=this.layer.getLayerConfig();let p=0,w=[1,1,1,1],W=[1,1,1,1];It&&Nt&&(w=(0,A.CI)(It),W=(0,A.CI)(Nt),p=1);const st={u_sourceColor:w,u_targetColor:W,u_linearColor:p,u_topsurface:Number(ne),u_sidesurface:Number(re),u_heightfixed:Number(Rt),u_raisingHeight:Number(kt)};return J&&this.texture&&(st.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(st)}initModels(){var J=this;return(0,l.Z)(function*(){return yield J.loadTexture(),J.buildModels()})()}buildModels(){var J=this;return(0,l.Z)(function*(){const{frag:Rt,vert:kt,type:ne}=J.getShaders();return J.initUniformsBuffer(),[yield J.layer.buildLayerModel({moduleName:ne,vertexShader:kt,fragmentShader:Rt,depth:{enable:!0},defines:J.getDefines(),inject:J.getInject(),triangulation:S.Xz})]})()}getShaders(){const{pickLight:J,mapTexture:Rt}=this.layer.getLayerConfig();return Rt?{frag:R,vert:M,type:"polygonExtrudeTexture"}:J?{frag:b,vert:C,type:"polygonExtrudePickLight"}:{frag:E,vert:X,type:"polygonExtrude"}}clearModels(){var J;(J=this.texture)===null||J===void 0||J.destroy(),this.textures=[]}registerBuiltinAttributes(){const J=this.layer.getSource().extent,Rt=J[2]-J[0],kt=J[3]-J[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:g.GC.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:3,update:(ne,re,It)=>{const Nt=It[0],p=It[1];return[(Nt-J[0])/Rt,(p-J[1])/kt,It[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:g.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:3,update:(ne,re,It,Nt,p)=>p}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:g.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:ne=>{const{size:re=10}=ne;return Array.isArray(re)?[re[0]]:[re]}}})}loadTexture(){var J=this;return(0,l.Z)(function*(){const{mapTexture:Rt}=J.layer.getLayerConfig(),{createTexture2D:kt}=J.rendererService;if(J.texture=kt({height:1,width:1}),Rt){const ne=yield(0,T.p)(Rt);J.texture=kt({data:ne,width:ne.width,height:ne.height,wrapS:g.gl.CLAMP_TO_EDGE,wrapT:g.gl.CLAMP_TO_EDGE,min:g.gl.LINEAR,mag:g.gl.LINEAR})}})()}}const rt=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,N=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Q extends o.Z{constructor(...J){super(...J),(0,h.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const J=this.getCommonUniformsInfo(),Rt=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,r.Z)((0,r.Z)({},J.uniformsOption),Rt.uniformsOption)}getCommonUniformsInfo(){const J={};return this.getUniformsBufferInfo(J)}initModels(){var J=this;return(0,l.Z)(function*(){return J.buildModels()})()}buildModels(){var J=this;return(0,l.Z)(function*(){const{frag:Rt,vert:kt,type:ne}=J.getShaders();return J.initUniformsBuffer(),[yield J.layer.buildLayerModel({moduleName:ne,vertexShader:kt,fragmentShader:Rt,defines:J.getDefines(),inject:J.getInject(),triangulation:S.Xz,depth:{enable:!0}})]})()}getShaders(){return{frag:rt,vert:N,type:"polygonExtrude"}}clearModels(){var J;(J=this.texture)===null||J===void 0||J.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:g.GC.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:3,update:(J,Rt,kt,ne,re)=>re}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:g.GC.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:J=>{const{size:Rt=10}=J;return Array.isArray(Rt)?[Rt[0]]:[Rt]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:g.GC.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:J=>{const{extrusionBase:Rt=0}=J;return[Rt]}}})}}const ft=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,I=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,G=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,ut=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class L extends o.Z{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const J=this.getCommonUniformsInfo(),Rt=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,r.Z)((0,r.Z)({},J.uniformsOption),Rt.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:J=0,opacityLinear:Rt={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),kt={u_raisingHeight:Number(J),u_opacitylinear:Number(Rt.enable),u_dir:Rt.dir==="in"?1:0};return this.getUniformsBufferInfo(kt)}initModels(){var J=this;return(0,l.Z)(function*(){return J.buildModels()})()}buildModels(){var J=this;return(0,l.Z)(function*(){const{frag:Rt,vert:kt,triangulation:ne,type:re}=J.getModelParams();return J.initUniformsBuffer(),J.layer.triangulation=ne,[yield J.layer.buildLayerModel({moduleName:re,vertexShader:kt,fragmentShader:Rt,defines:J.getDefines(),inject:J.getInject(),triangulation:ne,primitive:g.gl.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:J={enable:!1,dir:"in"}}=this.layer.getLayerConfig();J.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:g.GC.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:3,update:(Rt,kt,ne)=>[ne[3],ne[4],ne[5]]}})}getModelParams(){const{opacityLinear:J={enable:!1}}=this.layer.getLayerConfig();return J.enable?{frag:I,vert:G,type:"polygonLinear",triangulation:S.T3}:{frag:ft,vert:ut,type:"polygonFill",triangulation:S.Qr}}}const j=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,O=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class B extends o.Z{constructor(...J){super(...J),(0,h.Z)(this,"texture1",void 0),(0,h.Z)(this,"texture2",void 0),(0,h.Z)(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const J=this.getCommonUniformsInfo(),Rt=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,r.Z)((0,r.Z)({},J.uniformsOption),Rt.uniformsOption)}getCommonUniformsInfo(){const{watercolor:J="#6D99A8",watercolor2:Rt="#0F121C"}=this.layer.getLayerConfig(),kt={u_watercolor:(0,A.CI)(J),u_watercolor2:(0,A.CI)(Rt),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(kt)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var J=this;return(0,l.Z)(function*(){return J.loadTexture(),J.buildModels()})()}buildModels(){var J=this;return(0,l.Z)(function*(){return J.initUniformsBuffer(),[yield J.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:O,fragmentShader:j,defines:J.getDefines(),inject:J.getInject(),triangulation:S.Qr,primitive:g.gl.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var J,Rt,kt;(J=this.texture1)===null||J===void 0||J.destroy(),(Rt=this.texture2)===null||Rt===void 0||Rt.destroy(),(kt=this.texture3)===null||kt===void 0||kt.destroy()}registerBuiltinAttributes(){const J=this.layer.getSource().extent,[Rt,kt,ne,re]=J,It=ne-Rt,Nt=re-kt;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:g.GC.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:(p,w,W)=>{const[st,Tt]=W;return[(st-Rt)/It,(Tt-kt)/Nt]}}})}loadTexture(){const{createTexture2D:J}=this.rendererService,Rt={height:0,width:0};this.texture1=J(Rt),this.texture2=J(Rt),this.texture3=J(Rt),kt(re=>{this.texture1=ne(re[0]),this.texture2=ne(re[1]),this.texture3=ne(re[2]),this.layerService.reRender()});function kt(re){let It=0;const Nt=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(w=>{const W=new Image;W.crossOrigin="",W.src=w,Nt.push(W),W.onload=()=>{It++,It===3&&re(Nt)}})}function ne(re){return J({data:re,width:re.width,height:re.height,wrapS:g.gl.MIRRORED_REPEAT,wrapT:g.gl.MIRRORED_REPEAT,min:g.gl.LINEAR,mag:g.gl.LINEAR})}}}const _=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,H=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class U extends o.Z{constructor(...J){super(...J),(0,h.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const J=this.getCommonUniformsInfo(),Rt=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,r.Z)((0,r.Z)({},J.uniformsOption),Rt.uniformsOption)}getCommonUniformsInfo(){const{speed:J=.5}=this.layer.getLayerConfig(),Rt={u_speed:J,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(Rt)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var J=this;return(0,l.Z)(function*(){return J.loadTexture(),J.buildModels()})()}buildModels(){var J=this;return(0,l.Z)(function*(){return J.initUniformsBuffer(),[yield J.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:H,fragmentShader:_,triangulation:S.Qr,defines:J.getDefines(),inject:J.getInject(),primitive:g.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var J;(J=this.texture)===null||J===void 0||J.destroy()}registerBuiltinAttributes(){const J=this.layer.getSource().extent,[Rt,kt,ne,re]=J,It=ne-Rt,Nt=re-kt;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:g.GC.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:(p,w,W)=>{const[st,Tt]=W;return[(st-Rt)/It,(Tt-kt)/Nt]}}})}loadTexture(){const{waterTexture:J}=this.layer.getLayerConfig(),{createTexture2D:Rt}=this.rendererService;this.texture=Rt({height:1,width:1});const kt=new Image;kt.crossOrigin="",J?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),kt.src=J):kt.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",kt.onload=()=>{this.texture=Rt({data:kt,width:kt.width,height:kt.height,wrapS:g.gl.MIRRORED_REPEAT,wrapT:g.gl.MIRRORED_REPEAT,min:g.gl.LINEAR,mag:g.gl.LINEAR}),this.layerService.reRender()}}}const D={fill:L,line:u.Z,extrude:Z,text:m.Z,point_fill:a.Z,point_image:c.Z,point_normal:d.Z,point_extrude:i.Z,water:U,ocean:B,extrusion:Q}},62632:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(44888);if(!/^(1887|7596)$/.test(e.j))var d=e(12135);class m extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...r){super(...r),(0,i.Z)(this,"type","RasterLayer")}buildModels(){var r=this;return(0,u.Z)(function*(){const h=r.getModelType();r.layerModel=new d.Z[h](r),yield r.initLayerModels()})()}getDefaultConfig(){const r=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[r]}getModelType(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(r){if(r!=="color")return{type:void 0,field:void 0,items:[]};const h=this.getLayerConfig().rampColors;return(0,c.I)(h,r)}}},12135:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>Z});var u=e(15861),i=e(1413),a=e(4942),c=e(71590),d=e(64939),m=e(98422),l=e(42659);const r=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,h=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class g extends m.Z{constructor(...N){super(...N),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const N=this.getCommonUniformsInfo(),Q=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},N.uniformsOption),Q.uniformsOption)}getCommonUniformsInfo(){const{opacity:N=1,clampLow:Q=!0,clampHigh:ft=!0,noDataValue:I=-9999999,domain:G,rampColors:ut}=this.layer.getLayerConfig(),L=G||(0,d.ZB)(ut);this.colorTexture=this.layer.textureService.getColorTexture(ut,L);const j={u_domain:L,u_opacity:N||1,u_noDataValue:I,u_clampLow:Q?1:0,u_clampHigh:(typeof ft<"u"?ft:Q)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(j)}getRasterData(N){return(0,u.Z)(function*(){if(Array.isArray(N.data))return{data:N.data,width:N.width,height:N.height};{const{rasterData:Q,width:ft,height:I}=yield N.data;return{data:Array.from(Q),width:ft,height:I}}})()}initModels(){var N=this;return(0,u.Z)(function*(){return N.buildModels()})()}buildModels(){var N=this;return(0,u.Z)(function*(){N.initUniformsBuffer();const Q=N.layer.getSource(),{createTexture2D:ft,queryVerdorInfo:I}=N.rendererService,G=Q.data.dataArray[0],{data:ut,width:L,height:j}=yield N.getRasterData(G);return N.texture=ft({data:new Float32Array(ut),width:L,height:j,format:I()==="WebGL1"?c.gl.LUMINANCE:c.gl.RED,type:c.gl.FLOAT,alignment:1}),[yield N.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:h,fragmentShader:r,defines:N.getDefines(),triangulation:l.iC,primitive:c.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var N,Q;(N=this.texture)===null||N===void 0||N.destroy(),(Q=this.colorTexture)===null||Q===void 0||Q.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}var A=e(45987);const o=["data"],S=["rasterData"],T=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,E=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class b extends m.Z{constructor(...N){super(...N),(0,a.Z)(this,"texture",void 0),(0,a.Z)(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const N=this.getCommonUniformsInfo(),Q=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,i.Z)((0,i.Z)({},N.uniformsOption),Q.uniformsOption)}getCommonUniformsInfo(){const{opacity:N=1,noDataValue:Q=0}=this.layer.getLayerConfig(),{rMinMax:ft=[0,255],gMinMax:I=[0,255],bMinMax:G=[0,255]}=this.dataOption,ut={u_rminmax:ft,u_gminmax:I,u_bminmax:G,u_opacity:N||1,u_noDataValue:Q,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(ut)}getRasterData(N){var Q=this;return(0,u.Z)(function*(){if(Array.isArray(N.data)){const{data:ut}=N,L=(0,A.Z)(N,o);return Q.dataOption=L,(0,i.Z)({data:ut},L)}const ft=yield N.data,{rasterData:I}=ft,G=(0,A.Z)(ft,S);return Q.dataOption=G,Array.isArray(I)?(0,i.Z)({data:I},G):(0,i.Z)({data:Array.from(I)},G)})()}initModels(){var N=this;return(0,u.Z)(function*(){N.initUniformsBuffer();const Q=N.layer.getSource(),{createTexture2D:ft}=N.rendererService,I=Q.data.dataArray[0],{data:G,width:ut,height:L}=yield N.getRasterData(I);return N.texture=ft({data:new Float32Array(G),width:ut,height:L,format:c.gl.RGB,type:c.gl.FLOAT}),[yield N.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:E,fragmentShader:T,defines:N.getDefines(),triangulation:l.iC,primitive:c.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var N=this;return(0,u.Z)(function*(){return N.initModels()})()}clearModels(){var N;(N=this.texture)===null||N===void 0||N.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}const C=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,X=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class R extends m.Z{constructor(...N){super(...N),(0,a.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:N,clampLow:Q=!0,clampHigh:ft=!0,noDataValue:I=-9999999,domain:G,rampColors:ut,colorTexture:L,rScaler:j=6553.6,gScaler:O=25.6,bScaler:B=.1,offset:_=1e4}=this.layer.getLayerConfig(),H=G||(0,d.ZB)(ut);let U=L;L?this.layer.textureService.setColorTexture(L,ut,H):U=this.layer.textureService.getColorTexture(ut,H);const V={u_unpack:[j,O,B,_],u_domain:H,u_opacity:N||1,u_noDataValue:I,u_clampLow:Q,u_clampHigh:typeof ft<"u"?ft:Q,u_texture:this.texture,u_colorTexture:U};return this.textures=[this.texture,U],this.getUniformsBufferInfo(V)}initModels(){var N=this;return(0,u.Z)(function*(){N.initUniformsBuffer();const Q=N.layer.getSource(),{createTexture2D:ft}=N.rendererService,I=yield Q.data.images;return N.texture=ft({data:I[0],width:I[0].width,height:I[0].height,min:c.gl.LINEAR,mag:c.gl.LINEAR}),[yield N.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:X,fragmentShader:C,defines:N.getDefines(),triangulation:l.iC,primitive:c.gl.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var N;(N=this.texture)===null||N===void 0||N.destroy()}buildModels(){var N=this;return(0,u.Z)(function*(){return N.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:c.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:c.gl.DYNAMIC_DRAW,data:[],type:c.gl.FLOAT},size:2,update:(N,Q,ft)=>[ft[3],ft[4]]}})}}const Z={raster:g,rasterRgb:b,raster3d:g,rasterTerrainRgb:R}},30520:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(64939);if(!/^(1887|7596)$/.test(e.j))var c=e(93027);if(!/^(1887|7596)$/.test(e.j))var d=e(77028);if(!/^(1887|7596)$/.test(e.j))var m=e(42304);if(!/^(1887|7596)$/.test(e.j))var l=e(38150);const{debounce:r}=a.lodashUtil;class h{constructor(A){(0,i.Z)(this,"parent",void 0),(0,i.Z)(this,"tileLayerService",void 0),(0,i.Z)(this,"mapService",void 0),(0,i.Z)(this,"layerService",void 0),(0,i.Z)(this,"rendererService",void 0),(0,i.Z)(this,"pickingService",void 0),(0,i.Z)(this,"tilePickService",void 0),(0,i.Z)(this,"tilesetManager",void 0),(0,i.Z)(this,"initedTileset",!1),(0,i.Z)(this,"lastViewStates",void 0),(0,i.Z)(this,"mapchange",()=>{var S;if(this.parent.isVisible()===!1)return;const{latLonBounds:T,zoom:E}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===E&&this.lastViewStates.latLonBounds.toString()===T.toString()||(this.lastViewStates={zoom:E,latLonBounds:T},(S=this.tilesetManager)===null||S===void 0||S.throttleUpdate(E,T))}),(0,i.Z)(this,"viewchange",r(this.mapchange,24)),this.parent=A;const o=this.parent.getContainer();this.rendererService=o.rendererService,this.layerService=o.layerService,this.mapService=o.mapService,this.pickingService=o.pickingService,this.tileLayerService=new c.$({rendererService:this.rendererService,layerService:this.layerService,parent:A}),this.tilePickService=new d.t({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:A}),this.parent.setLayerPickService(this.tilePickService),this.proxy(A),this.initTileSetManager()}initTileSetManager(){var A;const o=this.parent.getSource();if(this.tilesetManager=o.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:S,zoom:T}=this.getCurrentView();(A=this.tilesetManager)===null||A===void 0||A.update(T,S)}getCurrentView(){const A=this.mapService.getBounds(),o=[A[0][0],A[0][1],A[1][0],A[1][1]],S=this.mapService.getZoom();return{latLonBounds:o,zoom:S}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",A=>{}),this.tilesetManager.on("tile-unload",A=>{this.tileUnLoad(A)}),this.tilesetManager.on("tile-error",(A,o)=>{this.tileError(A)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(A){return this.tileLayerService.getTile(A)}tileLoaded(A){}tileError(A){console.warn("error:",A)}destroy(){var A;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(A=this.tilesetManager)===null||A===void 0||A.destroy(),this.tileLayerService.destroy()}reload(){var A;this.tilesetManager.clear();const{latLonBounds:o,zoom:S}=this.getCurrentView();(A=this.tilesetManager)===null||A===void 0||A.update(S,o)}tileUnLoad(A){this.tileLayerService.removeTile(A.key)}tileUpdate(){var A=this;return(0,u.Z)(function*(){if(!A.tilesetManager)return;const o=A.parent.getMinZoom(),S=A.parent.getMaxZoom(),T=A.tilesetManager.tiles.filter(E=>E.isLoaded).filter(E=>E.isVisibleChange).filter(E=>E.data).filter(E=>E.z>=o&&E.z<S);yield Promise.all(T.map(function(){var E=(0,u.Z)(function*(b){if(A.tileLayerService.hasTile(b.key))A.tileLayerService.updateTileVisible(b),A.tilePickService.setPickState(),A.layerService.reRender();else{const C=(0,m.y)(A.parent),X=new C(b,A.parent);yield X.initTileLayer(),A.tilePickService.setPickState(),X.getLayers().length!==0&&(A.tileLayerService.addTile(X),A.tileLayerService.updateTileVisible(b),A.layerService.reRender())}});return function(b){return E.apply(this,arguments)}}())),A.tilesetManager.isLoaded&&A.parent.emit("tiles-loaded",A.tilesetManager.currentTiles)})()}setPickState(A){}pickRender(A){this.tilePickService.pickRender(A)}selectFeature(A){this.tilePickService.selectFeature(A)}highlightPickedFeature(A){this.tilePickService.highlightPickedFeature(A)}proxy(A){l.B.forEach(o=>{const S=A[o].bind(A);A[o]=(...T)=>(S(...T),this.getLayers().map(E=>{E[o](...T)}),o==="style"&&this.getTiles().forEach(E=>E.styleUpdate(...T)),A)})}}},32026:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>c}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);class c extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...m){super(...m),(0,i.Z)(this,"type","TileDebugLayer"),(0,i.Z)(this,"zIndex",1e4),(0,i.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}})}buildModels(){return(0,u.Z)(function*(){})()}}},93027:(Xt,K,e)=>{"use strict";if(e.d(K,{$:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);class a{constructor({rendererService:d,layerService:m,parent:l}){(0,i.Z)(this,"tileResource",new Map),(0,i.Z)(this,"rendererService",void 0),(0,i.Z)(this,"layerService",void 0),(0,i.Z)(this,"parent",void 0),(0,i.Z)(this,"layerTiles",[]),this.rendererService=d,this.layerService=m,this.parent=l}get tiles(){return this.layerTiles}hasTile(d){return this.layerTiles.some(m=>m.key===d)}addTile(d){this.layerTiles.push(d)}getTile(d){return this.layerTiles.find(m=>m.key===d)}getVisibleTileBylngLat(d){return this.layerTiles.find(m=>m.isLoaded&&m.visible&&m.lnglatInBounds(d))}removeTile(d){const m=this.layerTiles.findIndex(r=>r.key===d),l=this.layerTiles.splice(m,1);l[0]&&l[0].destroy()}updateTileVisible(d){const m=this.getTile(d.key);if(d.isVisible)if(d.parent){const l=this.isChildrenLoaded(d.parent);m==null||m.updateVisible(l)}else m==null||m.updateVisible(!0);else if(d.parent){const l=this.isChildrenLoaded(d.parent);m==null||m.updateVisible(!l)}else m==null||m.updateVisible(!1)}isParentLoaded(d){const m=d.parent;if(!m)return!0;const l=this.getTile(m==null?void 0:m.key);return!!(l!=null&&l.isLoaded)}isChildrenLoaded(d){const m=d==null?void 0:d.children;return m.length===0?!0:m.every(l=>{const r=this.getTile(l==null?void 0:l.key);return r?(r==null?void 0:r.isLoaded)===!0:!0})}render(){var d=this;return(0,u.Z)(function*(){const l=d.getRenderLayers().map(function(){var r=(0,u.Z)(function*(h){yield d.layerService.renderTileLayer(h)});return function(h){return r.apply(this,arguments)}}());yield Promise.all(l)})()}getRenderLayers(){const d=this.layerTiles.filter(l=>l.visible&&l.isLoaded),m=[];return d.map(l=>m.push(...l.getLayers())),m}getLayers(){const d=this.layerTiles.filter(l=>l.isLoaded),m=[];return d.map(l=>m.push(...l.getLayers())),m}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(d=>d.destroy()),this.tileResource.clear()}}},77028:(Xt,K,e)=>{"use strict";if(e.d(K,{t:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);var a=e(64939);if(!/^(1887|7596)$/.test(e.j))var c=e(44534);const d="select",m="active";class l{constructor({layerService:h,tileLayerService:g,parent:A}){(0,i.Z)(this,"layerService",void 0),(0,i.Z)(this,"tileLayerService",void 0),(0,i.Z)(this,"tileSourceService",void 0),(0,i.Z)(this,"parent",void 0),(0,i.Z)(this,"tilePickID",new Map),this.layerService=h,this.tileLayerService=g,this.parent=A,this.tileSourceService=new c.z}pickRender(h){const g=this.tileLayerService.getVisibleTileBylngLat(h.lngLat);if(g){const A=g.getMainLayer();A==null||A.layerPickService.pickRender(h)}}pick(h,g){var A=this;return(0,u.Z)(function*(){const S=A.parent.getContainer().pickingService;if(h.type==="RasterLayer"){const T=A.tileLayerService.getVisibleTileBylngLat(g.lngLat);if(T&&T.getMainLayer()!==void 0){const E=T.getMainLayer();return E.layerPickService.pickRasterLayer(E,g,A.parent)}return!1}return A.pickRender(g),S.pickFromPickingFBO(h,g)})()}selectFeature(h){const[g,A,o]=h,S=this.color2PickId(g,A,o);this.tilePickID.set(d,S),this.updateHighLight(g,A,o,d)}highlightPickedFeature(h){const[g,A,o]=h,S=this.color2PickId(g,A,o);this.tilePickID.set(m,S),this.updateHighLight(g,A,o,m)}updateHighLight(h,g,A,o){this.tileLayerService.tiles.map(S=>{const T=S.getMainLayer();switch(o){case d:T==null||T.hooks.beforeSelect.call([h,g,A]);break;case m:T==null||T.hooks.beforeHighlight.call([h,g,A]);break}})}setPickState(){const h=this.tilePickID.get(d),g=this.tilePickID.get(m);if(h){const[A,o,S]=this.pickId2Color(h);this.updateHighLight(A,o,S,d);return}if(g){const[A,o,S]=this.pickId2Color(g);this.updateHighLight(A,o,S,m);return}}color2PickId(h,g,A){return(0,a.W0)(new Uint8Array([h,g,A]))}pickId2Color(h){return(0,a.Z6)(h)}getFeatureById(h){const g=this.tileLayerService.getTiles().filter(o=>o.visible),A=[];return g.forEach(o=>{A.push(...o.getFeatureById(h))}),A}pickRasterLayer(){return!1}}},44534:(Xt,K,e)=>{"use strict";e.d(K,{z:()=>re});var u=e(1413),i=63710088e-1,a={centimeters:i*100,centimetres:i*100,degrees:i/111325,feet:i*3.28084,inches:i*39.37,kilometers:i/1e3,kilometres:i/1e3,meters:i,metres:i,miles:i/1609.344,millimeters:i*1e3,millimetres:i*1e3,nauticalmiles:i/1852,radians:1,yards:i*1.0936},c={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/i,yards:1.0936133},d={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function m(It,Nt,p){p===void 0&&(p={});var w={type:"Feature"};return(p.id===0||p.id)&&(w.id=p.id),p.bbox&&(w.bbox=p.bbox),w.properties=Nt||{},w.geometry=It,w}function l(It,Nt,p){switch(p===void 0&&(p={}),It){case"Point":return r(Nt).geometry;case"LineString":return o(Nt).geometry;case"Polygon":return g(Nt).geometry;case"MultiPoint":return b(Nt).geometry;case"MultiLineString":return E(Nt).geometry;case"MultiPolygon":return C(Nt).geometry;default:throw new Error(It+" is invalid")}}function r(It,Nt,p){if(p===void 0&&(p={}),!It)throw new Error("coordinates is required");if(!Array.isArray(It))throw new Error("coordinates must be an Array");if(It.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ut(It[0])||!ut(It[1]))throw new Error("coordinates must contain numbers");var w={type:"Point",coordinates:It};return m(w,Nt,p)}function h(It,Nt,p){return p===void 0&&(p={}),T(It.map(function(w){return r(w,Nt)}),p)}function g(It,Nt,p){p===void 0&&(p={});for(var w=0,W=It;w<W.length;w++){var st=W[w];if(st.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Tt=0;Tt<st[st.length-1].length;Tt++)if(st[st.length-1][Tt]!==st[0][Tt])throw new Error("First and last Position are not equivalent.")}var Gt={type:"Polygon",coordinates:It};return m(Gt,Nt,p)}function A(It,Nt,p){return p===void 0&&(p={}),T(It.map(function(w){return g(w,Nt)}),p)}function o(It,Nt,p){if(p===void 0&&(p={}),It.length<2)throw new Error("coordinates must be an array of two or more positions");var w={type:"LineString",coordinates:It};return m(w,Nt,p)}function S(It,Nt,p){return p===void 0&&(p={}),T(It.map(function(w){return o(w,Nt)}),p)}function T(It,Nt){Nt===void 0&&(Nt={});var p={type:"FeatureCollection"};return Nt.id&&(p.id=Nt.id),Nt.bbox&&(p.bbox=Nt.bbox),p.features=It,p}function E(It,Nt,p){p===void 0&&(p={});var w={type:"MultiLineString",coordinates:It};return m(w,Nt,p)}function b(It,Nt,p){p===void 0&&(p={});var w={type:"MultiPoint",coordinates:It};return m(w,Nt,p)}function C(It,Nt,p){p===void 0&&(p={});var w={type:"MultiPolygon",coordinates:It};return m(w,Nt,p)}function X(It,Nt,p){p===void 0&&(p={});var w={type:"GeometryCollection",geometries:It};return m(w,Nt,p)}function R(It,Nt){if(Nt===void 0&&(Nt=0),Nt&&!(Nt>=0))throw new Error("precision must be a positive number");var p=Math.pow(10,Nt||0);return Math.round(It*p)/p}function M(It,Nt){Nt===void 0&&(Nt="kilometers");var p=a[Nt];if(!p)throw new Error(Nt+" units is invalid");return It*p}function Z(It,Nt){Nt===void 0&&(Nt="kilometers");var p=a[Nt];if(!p)throw new Error(Nt+" units is invalid");return It/p}function rt(It,Nt){return Q(Z(It,Nt))}function N(It){var Nt=It%360;return Nt<0&&(Nt+=360),Nt}function Q(It){var Nt=It%(2*Math.PI);return Nt*180/Math.PI}function ft(It){var Nt=It%360;return Nt*Math.PI/180}function I(It,Nt,p){if(Nt===void 0&&(Nt="kilometers"),p===void 0&&(p="kilometers"),!(It>=0))throw new Error("length must be a positive number");return M(Z(It,Nt),p)}function G(It,Nt,p){if(Nt===void 0&&(Nt="meters"),p===void 0&&(p="kilometers"),!(It>=0))throw new Error("area must be a positive number");var w=d[Nt];if(!w)throw new Error("invalid original units");var W=d[p];if(!W)throw new Error("invalid final units");return It/w*W}function ut(It){return!isNaN(It)&&It!==null&&!Array.isArray(It)}function L(It){return!!It&&It.constructor===Object}function j(It){if(!It)throw new Error("bbox is required");if(!Array.isArray(It))throw new Error("bbox must be an Array");if(It.length!==4&&It.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");It.forEach(function(Nt){if(!ut(Nt))throw new Error("bbox must only contain numbers")})}function O(It){if(!It)throw new Error("id is required");if(["string","number"].indexOf(typeof It)===-1)throw new Error("id must be a number or a string")}var B=e(32676);function _(It){if(!It)throw new Error("coord is required");if(!Array.isArray(It)){if(It.type==="Feature"&&It.geometry!==null&&It.geometry.type==="Point")return It.geometry.coordinates;if(It.type==="Point")return It.coordinates}if(Array.isArray(It)&&It.length>=2&&!Array.isArray(It[0])&&!Array.isArray(It[1]))return It;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function H(It){if(Array.isArray(It))return It;if(It.type==="Feature"){if(It.geometry!==null)return It.geometry.coordinates}else if(It.coordinates)return It.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function U(It){if(It.length>1&&isNumber(It[0])&&isNumber(It[1]))return!0;if(Array.isArray(It[0])&&It[0].length)return U(It[0]);throw new Error("coordinates must only contain numbers")}function V(It,Nt,p){if(!Nt||!p)throw new Error("type and name required");if(!It||It.type!==Nt)throw new Error("Invalid input to "+p+": must be a "+Nt+", given "+It.type)}function D(It,Nt,p){if(!It)throw new Error("No feature passed");if(!p)throw new Error(".featureOf() requires a name");if(!It||It.type!=="Feature"||!It.geometry)throw new Error("Invalid input to "+p+", Feature with geometry required");if(!It.geometry||It.geometry.type!==Nt)throw new Error("Invalid input to "+p+": must be a "+Nt+", given "+It.geometry.type)}function lt(It,Nt,p){if(!It)throw new Error("No featureCollection passed");if(!p)throw new Error(".collectionOf() requires a name");if(!It||It.type!=="FeatureCollection")throw new Error("Invalid input to "+p+", FeatureCollection required");for(var w=0,W=It.features;w<W.length;w++){var st=W[w];if(!st||st.type!=="Feature"||!st.geometry)throw new Error("Invalid input to "+p+", Feature with geometry required");if(!st.geometry||st.geometry.type!==Nt)throw new Error("Invalid input to "+p+": must be a "+Nt+", given "+st.geometry.type)}}function J(It){return It.type==="Feature"?It.geometry:It}function Rt(It,Nt){return It.type==="FeatureCollection"?"FeatureCollection":It.type==="GeometryCollection"?"GeometryCollection":It.type==="Feature"&&It.geometry!==null?It.geometry.type:It.type}function kt(It,Nt,p){p===void 0&&(p={});var w=J(It),W=J(Nt),st=B.union(w.coordinates,W.coordinates);return st.length===0?null:st.length===1?g(st[0],p.properties):C(st,p.properties)}const ne=kt;class re{getCombineFeature(Nt){let p=null;const w=Nt[0];return Nt.map(W=>{const st=g(W.coordinates);p===null?p=st:p=ne(p,st)}),w&&(p.properties=(0,u.Z)({},w)),p}}},46915:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(58683);if(!/^(1887|7596)$/.test(e.j))var a=e(64380);if(!/^(1887|7596)$/.test(e.j))var c=e(19847);class d extends(/^(1887|7596)$/.test(e.j)?null:c.Z){initTileLayer(){var l=this;return(0,u.Z)(function*(){const r=l.getSourceOption(),h=r.data.features[0].properties,g=new i.Z().source(r.data,r.options).size(1).shape("line").color("red"),A=new a.Z({minZoom:l.z-1,maxZoom:l.z+1,textAllowOverlap:!0}).source([h],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(l.key).style({stroke:"#fff",strokeWidth:2});yield l.addLayer(g),yield l.addLayer(A),l.isLoaded=!0})()}getSourceOption(){const l=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:l.transforms}}}}},17162:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(14759);if(!/^(1887|7596)$/.test(e.j))var c=e(19847);class d extends(/^(1887|7596)$/.test(e.j)?null:c.Z){initTileLayer(){var l=this;return(0,i.Z)(function*(){const r=l.parent.getLayerAttributeConfig(),h=l.getLayerOptions(),g=l.getSourceOption(),A=new a.Z((0,u.Z)({},h)).source(g.data,g.options);r&&Object.keys(r).forEach(o=>{var S,T;const E=o;A[E]((S=r[E])===null||S===void 0?void 0:S.field,(T=r[E])===null||T===void 0?void 0:T.values)}),yield l.addLayer(A),l.isLoaded=!0})()}getSourceOption(){const l=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:l.transforms}}}}},314:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(85353);if(!/^(1887|7596)$/.test(e.j))var c=e(19847);class d extends(/^(1887|7596)$/.test(e.j)?null:c.Z){initTileLayer(){var l=this;return(0,i.Z)(function*(){const r=l.parent.getLayerAttributeConfig(),h=l.getLayerOptions(),g=l.getSourceOption(),A=new a.Z((0,u.Z)({},h)).source(g.data,g.options);r&&Object.keys(r).forEach(o=>{var S,T;const E=o;A[E]((S=r[E])===null||S===void 0?void 0:S.field,(T=r[E])===null||T===void 0?void 0:T.values)}),yield l.addLayer(A),l.isLoaded=!0})()}getFeatures(l){return l?this.sourceTile.data.getTileData(l):[]}getSourceOption(){const l=this.parent.getSource(),{sourceLayer:r,featureId:h}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:h},transforms:l.transforms}}}}},9994:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(45987);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);if(!/^(1887|7596)$/.test(e.j))var a=e(15861);if(!/^(1887|7596)$/.test(e.j))var c=e(62632);if(!/^(1887|7596)$/.test(e.j))var d=e(19847);const m=/^(1887|7596)$/.test(e.j)?null:["rasterData"];class l extends(/^(1887|7596)$/.test(e.j)?null:d.Z){initTileLayer(){var h=this;return(0,a.Z)(function*(){const g=h.parent.getLayerAttributeConfig(),A=h.getLayerOptions(),o=h.getSourceOption(),S=new c.Z((0,i.Z)({},A)).source(o.data,o.options);g&&Object.keys(g).forEach(T=>{var E,b;const C=T;S[C]((E=g[C])===null||E===void 0?void 0:E.field,(b=g[C])===null||b===void 0?void 0:b.values)}),yield h.addLayer(S),h.isLoaded=!0})()}getSourceOption(){const h=this.parent.getSource(),g=this.sourceTile.data.data,{rasterData:A}=g,o=(0,u.Z)(g,m);return{data:A,options:{parser:(0,i.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},o),transforms:h.transforms}}}}},34853:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(62632);if(!/^(1887|7596)$/.test(e.j))var c=e(19847);class d extends(/^(1887|7596)$/.test(e.j)?null:c.Z){initTileLayer(){var l=this;return(0,i.Z)(function*(){const r=l.parent.getLayerAttributeConfig(),h=l.getLayerOptions(),g=l.getSourceOption(),A=new a.Z((0,u.Z)({},h)).source(g.data,g.options);r&&Object.keys(r).forEach(o=>{var S,T;const E=o;A[E]((S=r[E])===null||S===void 0?void 0:S.field,(T=r[E])===null||T===void 0?void 0:T.values)}),yield l.addLayer(A),l.isLoaded=!0})()}getSourceOption(){const l=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:l.transforms}}}}},29960:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>g}),!/^(1887|7596)$/.test(e.j))var u=e(45987);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);if(!/^(1887|7596)$/.test(e.j))var a=e(15861);if(!/^(1887|7596)$/.test(e.j))var c=e(4942);var d=e(64939);if(!/^(1887|7596)$/.test(e.j))var m=e(62632);if(!/^(1887|7596)$/.test(e.j))var l=e(19847);const r=/^(1887|7596)$/.test(e.j)?null:["rasterData"],h={positions:[0,1],colors:["#000","#fff"]};class g extends(/^(1887|7596)$/.test(e.j)?null:l.Z){constructor(...o){super(...o),(0,c.Z)(this,"colorTexture",void 0)}initTileLayer(){var o=this;return(0,a.Z)(function*(){const S=o.parent.getLayerAttributeConfig(),T=o.getLayerOptions(),E=o.getSourceOption(),{rampColors:b,domain:C}=o.getLayerOptions();o.colorTexture=o.parent.textureService.getColorTexture(b,C);const X=new m.Z((0,i.Z)((0,i.Z)({},T),{},{colorTexture:o.colorTexture})).source(E.data,E.options);S&&Object.keys(S).forEach(R=>{var M,Z;const rt=R;X[rt]((M=S[rt])===null||M===void 0?void 0:M.field,(Z=S[rt])===null||Z===void 0?void 0:Z.values)}),yield o.addLayer(X),o.isLoaded=!0})()}getSourceOption(){const o=this.parent.getSource(),S=this.sourceTile.data.data,{rasterData:T}=S,E=(0,u.Z)(S,r);return{data:T,options:{parser:(0,i.Z)({type:"raster",extent:this.sourceTile.bounds},E),transforms:o.transforms}}}styleUpdate(...o){const{rampColors:S=h,domain:T}=o;this.colorTexture=this.parent.textureService.getColorTexture(S,T||(0,d.ZB)(S)),this.layers.forEach(E=>E.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(o=>o.destroy())}}},19847:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>h}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(1413);if(!/^(1887|7596)$/.test(e.j))var a=e(4942);var c=e(71590),d=e(26729),m=e.n(d);if(!/^(1887|7596)$/.test(e.j))var l=e(89955);if(!/^(1887|7596)$/.test(e.j))var r=e(35754);class h extends(/^(1887|7596)$/.test(e.j)?null:d.EventEmitter){constructor(A,o){super(),(0,a.Z)(this,"x",void 0),(0,a.Z)(this,"y",void 0),(0,a.Z)(this,"z",void 0),(0,a.Z)(this,"key",void 0),(0,a.Z)(this,"parent",void 0),(0,a.Z)(this,"sourceTile",void 0),(0,a.Z)(this,"visible",!0),(0,a.Z)(this,"layers",[]),(0,a.Z)(this,"isLoaded",!1),(0,a.Z)(this,"tileMaskLayers",[]),(0,a.Z)(this,"tileMask",void 0),this.parent=o,this.sourceTile=A,this.x=A.x,this.y=A.y,this.z=A.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...A){}lnglatInBounds(A){const[o,S,T,E]=this.sourceTile.bounds,{lng:b,lat:C}=A;return b>=o&&b<=T&&C>=S&&C<=E}getLayerOptions(){var A;const o=this.parent.getLayerConfig();return(0,i.Z)((0,i.Z)({},o),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(0,r.L)(this.parent.type),mask:o.mask||((A=o.maskLayers)===null||A===void 0?void 0:A.length)!==0&&o.enableMask})}getMaskLayer(){const{maskLayers:A}=this.parent.getLayerConfig(),o=[];return A==null||A.forEach(S=>{if(!S.tileLayer)return o.push(S),S;const E=S.tileLayer.getTile(this.sourceTile.key),b=E==null?void 0:E.getLayers()[0];b&&o.push(b)}),o}addTileMask(){var A=this;return(0,u.Z)(function*(){const o=new l.Z({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[A.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),S=(0,c.e7)(A.parent.container);o.setContainer(S),yield o.init(),A.tileMask=o;const T=A.getMainLayer();return T!==void 0&&(T.tileMask=o),o})()}addMask(A,o){var S=this;return(0,u.Z)(function*(){const T=(0,c.e7)(S.parent.container);o.setContainer(T),yield o.init(),A.addMask(o),S.tileMaskLayers.push(o)})()}addLayer(A){var o=this;return(0,u.Z)(function*(){A.isTileLayer=!0;const S=(0,c.e7)(o.parent.container);A.setContainer(S),o.layers.push(A),yield A.init()})()}updateVisible(A){this.visible=A,this.updateOptions("visible",A)}updateOptions(A,o){this.layers.forEach(S=>{S.updateLayerConfig({[A]:o})})}getMainLayer(){return this.layers[0]}getFeatures(A){return[]}getFeatureById(A){return[]}destroy(){var A;(A=this.tileMask)===null||A===void 0||A.destroy(),this.layers.forEach(o=>o.destroy())}}},3066:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(1413);if(!/^(1887|7596)$/.test(e.j))var i=e(15861);if(!/^(1887|7596)$/.test(e.j))var a=e(19847);if(!/^(1887|7596)$/.test(e.j))var c=e(35754);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){initTileLayer(){var l=this;return(0,i.Z)(function*(){const r=l.parent.getLayerAttributeConfig(),h=l.getLayerOptions(),g=(0,c.p)(l.parent.type),A=l.getSourceOption();if(!A){l.isLoaded=!0,l.emit("loaded");return}const o=new g((0,u.Z)({},h)).source(A.data,A.options);Object.keys(r).forEach(S=>{var T,E;const b=S;o[b]((T=r[b])===null||T===void 0?void 0:T.field,(E=r[b])===null||E===void 0?void 0:E.values)}),yield l.addLayer(o),h.tileMask&&(yield l.addTileMask()),l.setLayerMinMaxZoom(o),l.isLoaded=!0,l.emit("loaded")})()}getSourceOption(){const l=this.parent.getSource(),{sourceLayer:r="defaultLayer",featureId:h="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:h},transforms:l.transforms}}}setLayerMinMaxZoom(l){l.getModelType()==="text"&&l.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(l){return this.sourceTile.data.getTileData(l)}getFeatureById(l){const r=this.getMainLayer();return r?r.getSource().data.dataArray.filter(g=>g._id===l):[]}}},42304:(Xt,K,e)=>{"use strict";e.d(K,{y:()=>h});var u=e(71590);if(!/^(1887|7596)$/.test(e.j))var i=e(46915);if(!/^(1887|7596)$/.test(e.j))var a=e(17162);if(!/^(1887|7596)$/.test(e.j))var c=e(314);if(!/^(1887|7596)$/.test(e.j))var d=e(9994);if(!/^(1887|7596)$/.test(e.j))var m=e(34853);if(!/^(1887|7596)$/.test(e.j))var l=e(29960);if(!/^(1887|7596)$/.test(e.j))var r=e(3066);function h(g){switch(g.type){case"PolygonLayer":return r.Z;case"LineLayer":return r.Z;case"PointLayer":return r.Z;case"TileDebugLayer":return i.Z;case"MaskLayer":return c.Z;case"RasterLayer":const{dataType:o}=g.getSource().parser;switch(o){case u.n3.RGB:case u.n3.CUSTOMRGB:return d.Z;case u.n3.ARRAYBUFFER:case u.n3.CUSTOMARRAYBUFFER:return l.Z;case u.n3.TERRAINRGB:case u.n3.CUSTOMTERRAINRGB:return m.Z;default:return a.Z}default:return r.Z}}},35754:(Xt,K,e)=>{"use strict";if(e.d(K,{L:()=>d,p:()=>c}),!/^(1887|7596)$/.test(e.j))var u=e(58683);if(!/^(1887|7596)$/.test(e.j))var i=e(64380);if(!/^(1887|7596)$/.test(e.j))var a=e(89955);function c(m){return m==="PolygonLayer"?a.Z:m==="LineLayer"?u.Z:i.Z}function d(m){return["PolygonLayer","LineLayer"].indexOf(m)!==-1}},38150:(Xt,K,e)=>{"use strict";e.d(K,{B:()=>u});const u=/^(1887|7596)$/.test(e.j)?null:["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"]},58369:(Xt,K,e)=>{"use strict";e.d(K,{s:()=>i});const u=/^(1887|7596)$/.test(e.j)?null:["mvt","geojsonvt","testTile"];function i(a){const c=a.getSource();return u.includes(c.parser.type)}},9868:(Xt,K,e)=>{"use strict";e.d(K,{y:()=>i});var u=e(71590);const i={[u.h0.additive]:{enable:!0,func:{srcRGB:u.gl.ONE,dstRGB:u.gl.ONE,srcAlpha:1,dstAlpha:1}},[u.h0.none]:{enable:!1},[u.h0.normal]:{enable:!0,func:{srcRGB:u.gl.SRC_ALPHA,dstRGB:u.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[u.h0.subtractive]:{enable:!0,func:{srcRGB:u.gl.ONE,dstRGB:u.gl.ONE,srcAlpha:u.gl.ZERO,dstAlpha:u.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:u.gl.FUNC_SUBTRACT,alpha:u.gl.FUNC_SUBTRACT}},[u.h0.max]:{enable:!0,func:{srcRGB:u.gl.ONE,dstRGB:u.gl.ONE},equation:{rgb:u.gl.MAX_EXT}},[u.h0.min]:{enable:!0,func:{srcRGB:u.gl.ONE,dstRGB:u.gl.ONE},equation:{rgb:u.gl.MIN_EXT}}}},30511:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(4942);if(!/^(1887|7596)$/.test(e.j))var i=e(98333);if(!/^(1887|7596)$/.test(e.j))var a=e(85975);if(!/^(1887|7596)$/.test(e.j))var c=e(95450);class d{constructor(l,r){(0,u.Z)(this,"width",void 0),(0,u.Z)(this,"height",void 0),(0,u.Z)(this,"grid",void 0),(0,u.Z)(this,"viewportPadding",100),(0,u.Z)(this,"screenRightBoundary",void 0),(0,u.Z)(this,"screenBottomBoundary",void 0),(0,u.Z)(this,"gridRightBoundary",void 0),(0,u.Z)(this,"gridBottomBoundary",void 0),this.width=l,this.height=r,this.viewportPadding=Math.max(l,r),this.grid=new c.Z(l+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=l+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=l+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}placeCollisionBox(l){const r=l.x1+l.anchorPointX+this.viewportPadding,h=l.y1+l.anchorPointY+this.viewportPadding,g=l.x2+l.anchorPointX+this.viewportPadding,A=l.y2+l.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,h,g,A)||this.grid.hitTest(r,h,g,A)?{box:[]}:{box:[r,h,g,A]}}insertCollisionBox(l,r){const h={featureIndex:r};this.grid.insert(h,l[0],l[1],l[2],l[3])}project(l,r,h){const g=i.al(r,h,0,1),A=i.Ue(),o=a.al(...l);return i.fF(A,g,o),{x:(A[0]/A[3]+1)/2*this.width+this.viewportPadding,y:(-A[1]/A[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(l,r,h,g){return h>=0&&l<this.gridRightBoundary&&g>=0&&r<this.gridBottomBoundary}}},50181:(Xt,K,e)=>{"use strict";if(e.d(K,{ZP:()=>T}),!/^(1887|7596)$/.test(e.j))var u=e(4942);var i=e(64939),a=e(31437);const c=a.Ue(),d=a.Ue(),m=a.Ue(),l=a.Ue(),r=a.Ue();function h(E,b,C,X,R){a.IH(E,C,X),a.Fv(E,E),b=a.al(-E[1],E[0]);const M=a.al(-C[1],C[0]);return[R/a.AK(b,M),b]}function g(E,b){return a.t8(E,-b[1],b[0])}function A(E,b,C){return a.lu(E,b,C),a.Fv(E,E),E}function o(E,b){return E[0]===b[0]&&E[1]===b[1]}function S(E){const b=new Map;for(let C=0;C<E.length;C++){const X=E[0].toString()+"-"+E[1].toString();b.get(X)?(E.splice(C,1),C++):b.set(X,X)}return E}class T{constructor(b={}){(0,u.Z)(this,"complex",void 0),(0,u.Z)(this,"join",void 0),(0,u.Z)(this,"cap",void 0),(0,u.Z)(this,"miterLimit",void 0),(0,u.Z)(this,"thickness",void 0),(0,u.Z)(this,"normal",void 0),(0,u.Z)(this,"lastFlip",-1),(0,u.Z)(this,"miter",a.al(0,0)),(0,u.Z)(this,"started",!1),(0,u.Z)(this,"dash",!1),(0,u.Z)(this,"totalDistance",0),(0,u.Z)(this,"currentIndex",0),this.join=b.join||"miter",this.cap=b.cap||"butt",this.miterLimit=b.miterLimit||10,this.thickness=b.thickness||1,this.dash=b.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(b){const C=this.complex;if(b.length<=1)return C;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const X=b.length;let R=C.startIndex;for(let M=1;M<X;M++){const Z=b[M-1],rt=b[M],N=M<b.length-1?b[M+1]:null,Q=this.simpleSegment(C,R,Z,rt,N);R+=Q}if(this.dash)for(let M=0;M<C.positions.length/6;M++)C.positions[M*6+5]=this.totalDistance;return C.startIndex=C.positions.length/6,C}extrude(b){const C=this.complex;if(b.length<=1)return C;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const X=b.length;let R=C.startIndex;for(let M=1;M<X;M++){const Z=b[M-1],rt=b[M],N=M<b.length-1?b[M+1]:null,Q=this.segment(C,R,Z,rt,N);R+=Q}if(this.dash)for(let M=0;M<C.positions.length/6;M++)C.positions[M*6+5]=this.totalDistance;return C.startIndex=C.positions.length/6,C}simpleSegment(b,C,X,R,M){let Z=0;const rt=b.indices,N=b.positions,Q=b.normals,ft=(0,i.Z)([R[0],R[1]]),I=(0,i.Z)([X[0],X[1]]);A(m,ft,I);let G=0;if(this.dash&&(G=this.lineSegmentDistance(ft,I),this.totalDistance+=G),this.normal||(this.normal=a.Ue(),g(this.normal,m)),this.started||(this.started=!0,this.extrusions(N,Q,X,this.normal,this.thickness,this.totalDistance-G)),rt.push(C+0,C+1,C+2),!M)g(this.normal,m),this.extrusions(N,Q,R,this.normal,this.thickness,this.totalDistance),rt.push(...this.lastFlip===1?[C,C+2,C+3]:[C+2,C+1,C+3]),Z+=2;else{const ut=(0,i.Z)([M[0],M[1]]);o(ft,ut)&&a.IH(ut,ft,a.Fv(ut,a.$X(ut,ft,I))),A(l,ut,ft);const[L,j]=h(r,a.Ue(),m,l,this.thickness);let O=a.AK(r,this.normal)<0?-1:1;this.extrusions(N,Q,R,j,L,this.totalDistance),rt.push(...this.lastFlip===1?[C,C+2,C+3]:[C+2,C+1,C+3]),O=-1,a.JG(this.normal,j),Z+=2,this.lastFlip=O}return Z}segment(b,C,X,R,M){let Z=0;const rt=b.indices,N=b.positions,Q=b.normals,ft=this.cap==="square",I=this.join==="bevel",G=(0,i.Z)([R[0],R[1]]),ut=(0,i.Z)([X[0],X[1]]);A(m,G,ut);let L=0;if(this.dash&&(L=this.lineSegmentDistance(G,ut),this.totalDistance+=L),this.normal||(this.normal=a.Ue(),g(this.normal,m)),!this.started)if(this.started=!0,ft){const j=a.Ue(),O=a.Ue();a.IH(j,this.normal,m),a.IH(O,this.normal,m),Q.push(O[0],O[1],0),Q.push(j[0],j[1],0),N.push(X[0],X[1],X[2]|0,this.totalDistance-L,-this.thickness,X[2]|0),this.complex.indexes.push(this.currentIndex),N.push(X[0],X[1],X[2]|0,this.totalDistance-L,this.thickness,X[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(N,Q,X,this.normal,this.thickness,this.totalDistance-L);if(rt.push(C+0,C+1,C+2),M){const j=(0,i.Z)([M[0],M[1]]);o(G,j)&&a.IH(j,G,a.Fv(j,a.$X(j,G,ut))),A(l,j,G);const[O,B]=h(r,a.Ue(),m,l,this.thickness);let _=a.AK(r,this.normal)<0?-1:1,H=I;!H&&this.join==="miter"&&O>this.miterLimit&&(H=!0),H?(Q.push(this.normal[0],this.normal[1],0),Q.push(B[0],B[1],0),N.push(R[0],R[1],R[2]|0,this.totalDistance,-this.thickness*_,R[2]|0),this.complex.indexes.push(this.currentIndex),N.push(R[0],R[1],R[2]|0,this.totalDistance,this.thickness*_,R[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,rt.push(...this.lastFlip!==-_?[C,C+2,C+3]:[C+2,C+1,C+3]),rt.push(C+2,C+3,C+4),g(c,l),a.JG(this.normal,c),Q.push(this.normal[0],this.normal[1],0),N.push(R[0],R[1],R[2]|0,this.totalDistance,-this.thickness*_,R[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Z+=3):(this.extrusions(N,Q,R,B,O,this.totalDistance),rt.push(...this.lastFlip===1?[C,C+2,C+3]:[C+2,C+1,C+3]),_=-1,a.JG(this.normal,B),Z+=2),this.lastFlip=_}else{if(g(this.normal,m),ft){const j=a.Ue(),O=a.Ue();a.lu(O,m,this.normal),a.IH(j,m,this.normal),Q.push(O[0],O[1],0),Q.push(j[0],j[1],0),N.push(R[0],R[1],R[2]|0,this.totalDistance,this.thickness,R[2]|0),this.complex.indexes.push(this.currentIndex),N.push(R[0],R[1],R[2]|0,this.totalDistance,this.thickness,R[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(N,Q,R,this.normal,this.thickness,this.totalDistance);rt.push(...this.lastFlip===1?[C,C+2,C+3]:[C+2,C+1,C+3]),Z+=2}return Z}extrusions(b,C,X,R,M,Z){C.push(R[0],R[1],0),C.push(R[0],R[1],0),b.push(X[0],X[1],X[2]|0,Z,-M,X[2]|0),this.complex.indexes.push(this.currentIndex),b.push(X[0],X[1],X[2]|0,Z,M,X[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(b,C){const X=C[0]-b[0],R=C[1]-b[1];return Math.sqrt(X*X+R*R)}}},95450:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(4942);class i{constructor(d,m,l){(0,u.Z)(this,"boxCells",[]),(0,u.Z)(this,"xCellCount",void 0),(0,u.Z)(this,"yCellCount",void 0),(0,u.Z)(this,"boxKeys",void 0),(0,u.Z)(this,"bboxes",void 0),(0,u.Z)(this,"width",void 0),(0,u.Z)(this,"height",void 0),(0,u.Z)(this,"xScale",void 0),(0,u.Z)(this,"yScale",void 0),(0,u.Z)(this,"boxUid",void 0);const r=this.boxCells;this.xCellCount=Math.ceil(d/l),this.yCellCount=Math.ceil(m/l);for(let h=0;h<this.xCellCount*this.yCellCount;h++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=d,this.height=m,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/m,this.boxUid=0}insert(d,m,l,r,h){this.forEachCell(m,l,r,h,this.insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push(m),this.bboxes.push(l),this.bboxes.push(r),this.bboxes.push(h)}query(d,m,l,r,h){return this.queryHitTest(d,m,l,r,!1,h)}hitTest(d,m,l,r,h){return this.queryHitTest(d,m,l,r,!0,h)}insertBoxCell(d,m,l,r,h,g){this.boxCells[h].push(g)}queryHitTest(d,m,l,r,h,g){if(l<0||d>this.width||r<0||m>this.height)return h?!1:[];const A=[];if(d<=0&&m<=0&&this.width<=l&&this.height<=r){if(h)return!0;for(let S=0;S<this.boxKeys.length;S++)A.push({key:this.boxKeys[S],x1:this.bboxes[S*4],y1:this.bboxes[S*4+1],x2:this.bboxes[S*4+2],y2:this.bboxes[S*4+3]});return g?A.filter(g):A}const o={hitTest:h,seenUids:{box:{},circle:{}}};return this.forEachCell(d,m,l,r,this.queryCell,A,o,g),h?A.length>0:A}queryCell(d,m,l,r,h,g,A,o){const S=A.seenUids,T=this.boxCells[h];if(T!==null){const E=this.bboxes;for(const b of T)if(!S.box[b]){S.box[b]=!0;const C=b*4;if(d<=E[C+2]&&m<=E[C+3]&&l>=E[C+0]&&r>=E[C+1]&&(!o||o(this.boxKeys[b]))){if(A.hitTest)return g.push(!0),!0;g.push({key:this.boxKeys[b],x1:E[C],y1:E[C+1],x2:E[C+2],y2:E[C+3]})}}}return!1}forEachCell(d,m,l,r,h,g,A,o){const S=this.convertToXCellCoord(d),T=this.convertToYCellCoord(m),E=this.convertToXCellCoord(l),b=this.convertToYCellCoord(r);for(let C=S;C<=E;C++)for(let X=T;X<=b;X++){const R=this.xCellCount*X+C;if(h.call(this,d,m,l,r,R,g,A,o))return}}convertToXCellCoord(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))}convertToYCellCoord(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))}}const a=/^(1887|7596)$/.test(e.j)?null:i},34276:(Xt,K,e)=>{"use strict";if(e.d(K,{p:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(15861);function i(c){return a.apply(this,arguments)}function a(){return a=(0,u.Z)(function*(c){if(window.createImageBitmap){const d=yield fetch(c);return yield createImageBitmap(yield d.blob())}else{const d=new window.Image;return new Promise(m=>{d.onload=()=>m(d),d.src=c,d.crossOrigin="Anonymous"})}}),a.apply(this,arguments)}},32271:(Xt,K,e)=>{"use strict";e.d(K,{E:()=>u,N:()=>i});function u(a){return a.map(c=>(typeof c=="string"&&(c=[c,{}]),c))}function i(a,c,d,m){const l=a.multiPassRenderer;return l.add(m("render")),u(c).forEach(r=>{const[h,g]=r;l.add(d(h),g)}),l.add(d("copy")),l}},44888:(Xt,K,e)=>{"use strict";e.d(K,{I:()=>u});function u(i,a){return{type:i.type,field:"value",items:i.positions.map((c,d)=>({[a]:d>=i.colors.length?null:i.colors[d],value:c}))}}},32449:(Xt,K,e)=>{"use strict";e.d(K,{F:()=>i,o:()=>a});var u=e(71590);function i(c,d){return{enable:c,mask:255,func:{cmp:u.gl.EQUAL,ref:d?1:0,mask:1}}}function a(c){return c.maskOperation===u.lE.OR?{enable:!0,mask:255,func:{cmp:u.gl.ALWAYS,ref:1,mask:255},opFront:{fail:u.gl.KEEP,zfail:u.gl.REPLACE,zpass:u.gl.REPLACE}}:{enable:!0,mask:255,func:{cmp:c.stencilType===u.yn.SINGLE||c.stencilIndex===0?u.gl.ALWAYS:u.gl.LESS,ref:c.stencilType===u.yn.SINGLE?1:c.stencilIndex===0?2:1,mask:255},opFront:{fail:u.gl.KEEP,zfail:u.gl.REPLACE,zpass:u.gl.REPLACE}}}},34135:(Xt,K,e)=>{"use strict";e.d(K,{E:()=>l,h:()=>m});function u(r){let h=.5,g=.5;switch(r){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0;break;default:h=.5}switch(r){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0;break;default:g=.5}return{horizontalAlign:h,verticalAlign:g}}function i(r,h,g,A,o){if(!o)return;const S=r[A],T=S.glyph;if(T){const E=h[T].advance*S.scale,b=(r[A].x+E)*o;for(let C=g;C<=A;C++)r[C].x-=b}}function a(r,h,g,A,o,S,T){const E=(h-g)*o,b=(-A*T+.5)*S;for(const C of r)C.x+=E,C.y+=b}function c(r,h,g,A,o,S,T){let b=0,C=-8,X=0;const R=r.positionedGlyphs,M=S==="right"?1:S==="left"?0:.5,Z=R.length;g.forEach(ft=>{if(ft.split("").forEach(I=>{const G=h[I];G&&(R.push({glyph:I,x:b,y:C+0,vertical:!1,scale:1,metrics:G}),b+=G.advance+T)}),R.length!==Z){const I=b-T;X=Math.max(I,X),i(R,h,Z,R.length-1,M)}b=0,C-=A+5});const{horizontalAlign:rt,verticalAlign:N}=u(o);a(R,M,rt,N,X,A,g.length);const Q=C- -8;r.top+=-N*Q,r.bottom=r.top-Q,r.left+=-rt*X,r.right=r.left+X}function d(r,h,g,A,o,S,T){let b=0,C=-8,X=0;const R=r.positionedGlyphs,M=S==="right"?1:S==="left"?0:.5,Z=R.length;g.forEach(ft=>{const I=h[ft];if(I&&(R.push({glyph:ft,x:I.advance/2,y:C+0,vertical:!1,scale:1,metrics:I}),b+=I.advance+T),R.length!==Z){const ut=b-T;X=Math.max(ut,X),i(R,h,Z,R.length-1,M)}b=0,C-=A+5});const{horizontalAlign:rt,verticalAlign:N}=u(o);a(R,M,rt,N,X,A,g.length);const Q=C- -8;r.top+=-N*Q,r.bottom=r.top-Q,r.left+=-rt*X,r.right=r.left+X}function m(r,h,g,A,o,S,T=[0,0],E){const b=r.split(`
`),C=[],X={positionedGlyphs:C,top:T[1],bottom:T[1],left:T[0],right:T[0],lineCount:b.length,text:r};return E?d(X,h,b,g,A,o,S):c(X,h,b,g,A,o,S),C.length?X:!1}function l(r,h=[0,0],g){const{positionedGlyphs:A=[]}=r,o=[];for(const S of A){const T=S.metrics,E=4,b=T.advance*S.scale/2,C=g?[S.x+b,S.y]:[0,0],X=g?[0,0]:[S.x+b+h[0],S.y+h[1]],R=(0-E)*S.scale-b+X[0],M=(0-E)*S.scale+X[1],Z=R+T.width*S.scale,rt=M+T.height*S.scale,N={x:R,y:M},Q={x:Z,y:M},ft={x:R,y:rt},I={x:Z,y:rt};o.push({tl:N,tr:Q,bl:ft,br:I,tex:T,glyphOffset:C})}return o}},78825:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15861);if(!/^(1887|7596)$/.test(e.j))var i=e(4942);if(!/^(1887|7596)$/.test(e.j))var a=e(54674);if(!/^(1887|7596)$/.test(e.j))var c=e(38667);class d extends(/^(1887|7596)$/.test(e.j)?null:a.Z){constructor(...l){super(...l),(0,i.Z)(this,"type","WindLayer")}buildModels(){var l=this;return(0,u.Z)(function*(){const r=l.getModelType();l.layerModel=new c.Z[r](l),yield l.initLayerModels()})()}renderModels(l={}){return this.layerModel&&this.layerModel.render(l),this}getDefaultConfig(){const l=this.getModelType();return{wind:{}}[l]}getModelType(){return"wind"}}},38667:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>S});var u=e(15861),i=e(4942),a=e(71590),c=e(64939),d=e(98422),m=e(42659),l=e(97200);const r=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,h=`precision highp float;
uniform mat4 u_ModelMatrix;

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

varying vec2 v_texCoord;
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,g={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"};class A extends d.Z{constructor(...E){super(...E),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"colorModel",void 0),(0,i.Z)(this,"wind",void 0),(0,i.Z)(this,"imageCoords",void 0),(0,i.Z)(this,"sizeScale",.5),(0,i.Z)(this,"frequency",new c.iH(7.2)),(0,i.Z)(this,"cacheZoom",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}render(E){this.drawColorMode(E),this.frequency.run(()=>{this.drawWind()})}getUninforms(){throw new Error("Method not implemented.")}initModels(){var E=this;return(0,u.Z)(function*(){var b,C;const{uMin:X=-21.32,uMax:R=26.8,vMin:M=-21.57,vMax:Z=21.42,fadeOpacity:rt=.996,speedFactor:N=.25,dropRate:Q=.003,dropRateBump:ft=.01,rampColors:I=g,sizeScale:G=.5}=E.layer.getLayerConfig(),{createTexture2D:ut}=E.rendererService,L=E.layer.getSource();E.texture=ut({height:0,width:0}),E.cacheZoom=Math.floor(E.mapService.getZoom());const j=E.rendererService.getGLContext();E.imageCoords=(b=L.data)===null||b===void 0?void 0:b.dataArray[0].coordinates,(C=L.data)===null||C===void 0||(C=C.images)===null||C===void 0||C.then(B=>{var _;E.sizeScale=G*E.getZoomScale();const{imageWidth:H,imageHeight:U}=E.getWindSize(),V={glContext:j,imageWidth:H,imageHeight:U,fadeOpacity:rt,speedFactor:N,dropRate:Q,dropRateBump:ft,rampColors:I};E.wind=new l.a(V),E.wind.setWind({uMin:X,uMax:R,vMin:M,vMax:Z,image:B[0]}),(_=E.texture)===null||_===void 0||_.destroy(),E.texture=ut({width:H,height:U}),E.layerService.reRender()});const O=yield E.layer.buildLayerModel({moduleName:"wind",vertexShader:h,fragmentShader:r,defines:E.getDefines(),triangulation:m.iC,primitive:a.gl.TRIANGLES,depth:{enable:!1}});return E.colorModel=O,[O]})()}getWindSize(){const E=this.mapService.lngLatToPixel(this.imageCoords[0]),b=this.mapService.lngLatToPixel(this.imageCoords[1]),C=Math.min(Math.floor((b.x-E.x)*this.sizeScale),2048),X=Math.min(Math.floor((E.y-b.y)*this.sizeScale),2048);return{imageWidth:C,imageHeight:X}}buildModels(){var E=this;return(0,u.Z)(function*(){return E.initModels()})()}clearModels(){var E,b;(E=this.texture)===null||E===void 0||E.destroy(),(b=this.wind)===null||b===void 0||b.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:a.GC.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:a.gl.DYNAMIC_DRAW,data:[],type:a.gl.FLOAT},size:2,update:(E,b,C)=>[C[3],C[4]]}})}getZoomScale(){return Math.min((this.cacheZoom+4)/30*2,2)}drawWind(){if(this.wind){const{uMin:E=-21.32,uMax:b=26.8,vMin:C=-21.57,vMax:X=21.42,numParticles:R=65535,fadeOpacity:M=.996,speedFactor:Z=.25,dropRate:rt=.003,dropRateBump:N=.01,rampColors:Q=g,sizeScale:ft=.5}=this.layer.getLayerConfig();let I=R;const G=Math.floor(this.mapService.getZoom());if(typeof ft=="number"&&ft!==this.sizeScale||G!==this.cacheZoom){const O=this.getZoomScale();this.sizeScale=ft,I*=O;const{imageWidth:B,imageHeight:_}=this.getWindSize();this.wind.reSize(B,_),this.cacheZoom=G}this.wind.updateWindDir(E,b,C,X),this.wind.updateParticelNum(I),this.wind.updateColorRampTexture(Q),this.wind.fadeOpacity=M,this.wind.speedFactor=Z,this.wind.dropRate=rt,this.wind.dropRateBump=N;const{d:ut,w:L,h:j}=this.wind.draw();this.rendererService.setBaseState(),this.texture.update({data:ut,width:L,height:j})}}drawColorMode(E={}){var b;const{opacity:C}=this.layer.getLayerConfig();this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),(b=this.colorModel)===null||b===void 0||b.draw({uniforms:{u_opacity:C||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(E)}),this.layer.hooks.afterRender.call()}}const S={wind:A}},18622:(Xt,K,e)=>{"use strict";e.d(K,{HO:()=>u,Jb:()=>d,Wp:()=>c,cU:()=>a,gS:()=>m});function u(o,S,T){const E=i(o,o.VERTEX_SHADER,S),b=i(o,o.FRAGMENT_SHADER,T);if(!E||!b)return null;const C=o.createProgram();if(!C)return null;if(o.attachShader(C,E),o.attachShader(C,b),o.linkProgram(C),!o.getProgramParameter(C,o.LINK_STATUS)){const Z=o.getProgramInfoLog(C);return console.warn("Failed to link program: "+Z),o.deleteProgram(C),o.deleteShader(b),o.deleteShader(E),null}const R=o.getProgramParameter(C,o.ACTIVE_ATTRIBUTES);for(let Z=0;Z<R;Z++){const rt=o.getActiveAttrib(C,Z);C[rt.name]=o.getAttribLocation(C,rt.name)}const M=o.getProgramParameter(C,o.ACTIVE_UNIFORMS);for(let Z=0;Z<M;Z++){const rt=o.getActiveUniform(C,Z);C[rt.name]=o.getUniformLocation(C,rt.name)}return C.vertexShader=E,C.fragmentShader=b,C}function i(o,S,T){const E=o.createShader(S);if(E==null)return console.warn("unable to create shader"),null;if(o.shaderSource(E,T),o.compileShader(E),!o.getShaderParameter(E,o.COMPILE_STATUS)){const C=o.getShaderInfoLog(E);return console.warn("Failed to compile shader: "+C),o.deleteShader(E),null}return E}function a(o,S,T,E,b){const C=o.createTexture();return o.bindTexture(o.TEXTURE_2D,C),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,S),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,S),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,E,b,0,o.RGBA,o.UNSIGNED_BYTE,T),o.bindTexture(o.TEXTURE_2D,null),C}function c(o,S,T){const E=o.createTexture();return o.bindTexture(o.TEXTURE_2D,E),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,S),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,S),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,T),o.bindTexture(o.TEXTURE_2D,null),E}function d(o,S,T){o.activeTexture(o.TEXTURE0+T),o.bindTexture(o.TEXTURE_2D,S)}function m(o,S){const T=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,T),o.bufferData(o.ARRAY_BUFFER,S,o.STATIC_DRAW),T}function l(o,S,T,E,b){const C=o.createBuffer();C||console.warn("failed create vertex buffer"),o.bindBuffer(o.ARRAY_BUFFER,C),o.bufferData(o.ARRAY_BUFFER,T,o.STATIC_DRAW);const X=o.getAttribLocation(b,S);return o.vertexAttribPointer(X,E,o.FLOAT,!1,0,0),o.enableVertexAttribArray(X),o.bindBuffer(o.ARRAY_BUFFER,null),{buffer:C,attr:X,count:E}}function r(o,S){const T=o.createBuffer();return T?(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,T),o.bufferData(o.ELEMENT_ARRAY_BUFFER,S,o.STATIC_DRAW)):console.warn("failed create vertex buffer"),T}function h(o,S,T,E,b){const C=o.getUniformLocation(E,S);return C===null||C<0?console.warn("\u65E0\u6CD5\u83B7\u53D6 uniform \u53D8\u91CF\u7684\u5B58\u50A8\u4F4D\u7F6E"):g(o,C,T,b),C}function g(o,S,T,E){switch(E){case"float":o.uniform1f(S,T);break;case"vec2":o.uniform2fv(S,T);break;case"vec3":o.uniform3fv(S,T);break;case"vec4":o.uniform4fv(S,T);break;case"bool":o.uniform1i(S,T);break;case"sampler2d":break;case"mat4":o.uniformMatrix4fv(S,!1,T);break}}function A(o){const{drawingBufferWidth:S,drawingBufferHeight:T}=o,E=S,b=T,C=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,C);const X=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,X),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,E,b),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,X);const R=o.createTexture();return C.texture=R,C.width=E,C.height=b,o.bindTexture(o.TEXTURE_2D,R),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,E,b,0,o.RGBA,o.UNSIGNED_BYTE,null),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,R,0),o.bindTexture(o.TEXTURE_2D,null),o.bindFramebuffer(o.FRAMEBUFFER,null),{FRAMEBUFFER:C,OFFER_SCREEN_WIDTH:E,OFFER_SCREEN_HEIGHT:b}}},97200:(Xt,K,e)=>{"use strict";if(e.d(K,{a:()=>l}),!/^(1887|7596)$/.test(e.j))var u=e(4942);if(!/^(1887|7596)$/.test(e.j))var i=e(18622);if(!/^(1887|7596)$/.test(e.j))var a=e(21450);function c(r){let h=document.createElement("canvas");const g=h.getContext("2d");h.width=256,h.height=1;const A=g.createLinearGradient(0,0,256,0);for(const o of Object.keys(r))A.addColorStop(+o,r[+o]);return g.fillStyle=A,g.fillRect(0,0,256,1),h=null,new Uint8Array(g.getImageData(0,0,256,1).data)}function d(r,h,g,A){r.bindBuffer(r.ARRAY_BUFFER,h),r.enableVertexAttribArray(g),r.vertexAttribPointer(g,A,r.FLOAT,!1,0,0)}function m(r,h,g){r.bindFramebuffer(r.FRAMEBUFFER,h),g&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,g,0)}class l{constructor(h){(0,u.Z)(this,"width",512),(0,u.Z)(this,"height",512),(0,u.Z)(this,"pixels",void 0),(0,u.Z)(this,"fadeOpacity",void 0),(0,u.Z)(this,"speedFactor",void 0),(0,u.Z)(this,"dropRate",void 0),(0,u.Z)(this,"dropRateBump",void 0),(0,u.Z)(this,"gl",void 0),(0,u.Z)(this,"drawProgram",void 0),(0,u.Z)(this,"fullScreenProgram",void 0),(0,u.Z)(this,"updateProgram",void 0),(0,u.Z)(this,"rampColors",void 0),(0,u.Z)(this,"numParticles",65536),(0,u.Z)(this,"numParticlesSize",void 0),(0,u.Z)(this,"particleStateResolution",void 0),(0,u.Z)(this,"quadBuffer",void 0),(0,u.Z)(this,"particleIndexBuffer",void 0),(0,u.Z)(this,"framebuffer",void 0),(0,u.Z)(this,"colorRampTexture",void 0),(0,u.Z)(this,"backgroundTexture",void 0),(0,u.Z)(this,"screenTexture",void 0),(0,u.Z)(this,"particleStateTexture0",void 0),(0,u.Z)(this,"particleStateTexture1",void 0),(0,u.Z)(this,"windTexture",void 0),(0,u.Z)(this,"windData",void 0),this.gl=h.glContext,this.width=h.imageWidth,this.height=h.imageHeight,this.fadeOpacity=h.fadeOpacity,this.speedFactor=h.speedFactor,this.dropRate=h.dropRate,this.dropRateBump=h.dropRateBump,this.rampColors=h.rampColors,this.init()}init(){const h=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=i.HO(h,a.qh,a.Rq),this.fullScreenProgram=i.HO(h,a.r4,a.nZ),this.updateProgram=i.HO(h,a.lm,a.HQ),this.quadBuffer=i.gS(h,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=h.createFramebuffer(),this.colorRampTexture=i.cU(this.gl,this.gl.LINEAR,c(this.rampColors),16,16);const g=new Uint8Array(this.width*this.height*4);this.backgroundTexture=i.cU(h,h.NEAREST,g,this.width,this.height),this.screenTexture=i.cU(h,h.NEAREST,g,this.width,this.height);const A=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=A*A;const o=new Uint8Array(this.numParticlesSize*4);for(let T=0;T<o.length;T++)o[T]=Math.floor(Math.random()*256);this.particleStateTexture0=i.cU(h,h.NEAREST,o,A,A),this.particleStateTexture1=i.cU(h,h.NEAREST,o,A,A);const S=new Float32Array(this.numParticlesSize);for(let T=0;T<this.numParticlesSize;T++)S[T]=T;this.particleIndexBuffer=i.gS(h,S)}setWind(h){this.windData=h,this.windTexture=i.Wp(this.gl,this.gl.LINEAR,h.image)}updateParticelNum(h){const g=this.gl;if(h!==this.numParticles){this.numParticles=h;const A=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=A*A;const o=new Uint8Array(this.numParticlesSize*4);for(let T=0;T<o.length;T++)o[T]=Math.floor(Math.random()*256);this.particleStateTexture0=i.cU(g,g.NEAREST,o,A,A),this.particleStateTexture1=i.cU(g,g.NEAREST,o,A,A);const S=new Float32Array(this.numParticlesSize);for(let T=0;T<this.numParticlesSize;T++)S[T]=T;this.particleIndexBuffer=i.gS(g,S)}}updateWindDir(h,g,A,o){this.windData.uMin=h,this.windData.uMax=g,this.windData.vMin=A,this.windData.vMax=o}updateColorRampTexture(h){if(this.isColorChanged(h)){this.rampColors=h;const g=this.gl;g.deleteTexture(this.colorRampTexture),this.colorRampTexture=i.cU(g,g.LINEAR,c(h),16,16)}}isColorChanged(h){const g=Object.keys(h);for(const A of g){const o=Number(A);if(!this.rampColors[o]||this.rampColors[o]&&this.rampColors[o]!==h[o])return!0}return!1}reSize(h,g){if(h!==this.width||g!==this.height){const A=this.gl;A.deleteTexture(this.backgroundTexture),A.deleteTexture(this.screenTexture),this.width=h,this.height=g;const o=new Uint8Array(h*g*4);this.backgroundTexture=i.cU(A,A.NEAREST,o,h,g),this.screenTexture=i.cU(A,A.NEAREST,o,h,g)}}draw(){var h;if((h=this.windData)!==null&&h!==void 0&&h.image){const g=this.gl;return i.Jb(g,this.windTexture,0),i.Jb(g,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}else return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}drawScreen(){const h=this.gl;m(h,this.framebuffer,this.screenTexture),h.viewport(0,0,this.width,this.height),h.disable(h.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),h.readPixels(0,0,this.width,this.height,h.RGBA,h.UNSIGNED_BYTE,this.pixels),m(h,null,null),h.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);const g=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=g}drawFullTexture(h,g){const A=this.gl,o=this.fullScreenProgram;A.useProgram(o),A.bindBuffer(A.ARRAY_BUFFER,this.quadBuffer),A.vertexAttribPointer(o.a_pos,2,A.FLOAT,!1,0,0),A.enableVertexAttribArray(o.a_pos),A.bindBuffer(A.ARRAY_BUFFER,null),i.Jb(A,h,2),A.uniform1i(o.u_screen,2),A.uniform1f(o.u_opacity,g),A.drawArrays(A.TRIANGLES,0,6)}drawParticles(){const h=this.gl,g=this.drawProgram;h.useProgram(g),d(h,this.particleIndexBuffer,g.a_index,1),i.Jb(h,this.colorRampTexture,2),h.uniform1i(g.u_wind,0),h.uniform1i(g.u_particles,1),h.uniform1i(g.u_color_ramp,2),h.uniform1f(g.u_particles_res,this.particleStateResolution),h.uniform2f(g.u_wind_min,this.windData.uMin,this.windData.vMin),h.uniform2f(g.u_wind_max,this.windData.uMax,this.windData.vMax),h.drawArrays(h.POINTS,0,this.numParticlesSize)}updateParticles(){const h=this.gl;m(h,this.framebuffer,this.particleStateTexture1),h.viewport(0,0,this.particleStateResolution,this.particleStateResolution);const g=this.updateProgram;h.useProgram(g),d(h,this.quadBuffer,g.a_pos,2),h.uniform1i(g.u_wind,0),h.uniform1i(g.u_particles,1),h.uniform1f(g.u_rand_seed,Math.random()),h.uniform2f(g.u_wind_res,this.windData.image.width*2,this.windData.image.height*2),h.uniform2f(g.u_wind_min,this.windData.uMin,this.windData.vMin),h.uniform2f(g.u_wind_max,this.windData.uMax,this.windData.vMax),h.uniform1f(g.u_speed_factor,this.speedFactor),h.uniform1f(g.u_drop_rate,this.dropRate),h.uniform1f(g.u_drop_rate_bump,this.dropRateBump),h.drawArrays(h.TRIANGLES,0,6);const A=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=A,m(h,null,null)}destroy(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}},21450:(Xt,K,e)=>{"use strict";e.d(K,{HQ:()=>c,Rq:()=>i,lm:()=>a,nZ:()=>m,qh:()=>u,r4:()=>d});const u=/^(1887|7596)$/.test(e.j)?null:`
 precision mediump float;

 attribute float a_index;

 uniform sampler2D u_particles;
 uniform float u_particles_res;

 varying vec2 v_particle_pos;

 void main() {
     vec4 color = texture2D(u_particles, vec2(
         fract(a_index / u_particles_res),
         floor(a_index / u_particles_res) / u_particles_res)
     );

     // decode current particle position from the pixel's RGBA value
     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);

     gl_PointSize = 1.0;
     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);
 }`,i=/^(1887|7596)$/.test(e.j)?null:`
 precision mediump float;

 uniform sampler2D u_wind;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform sampler2D u_color_ramp;

 varying vec2 v_particle_pos;

 void main() {
     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);
     float speed_t = length(velocity) / length(u_wind_max);

     // color ramp is encoded in a 16x16 texture
     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);

     gl_FragColor = texture2D(u_color_ramp, ramp_pos);
 }`,a=/^(1887|7596)$/.test(e.j)?null:`
 precision mediump float;

 attribute vec2 a_pos;

 varying vec2 v_tex_pos;

 void main() {
     v_tex_pos = a_pos;
     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);
     // framebuffer \u59CB\u7EC8\u7528\u94FA\u6EE1\u5C4F\u5E55\u7684 texture
 }`,c=/^(1887|7596)$/.test(e.j)?null:`
 precision highp float;

 uniform sampler2D u_particles;
 uniform sampler2D u_wind;
 uniform vec2 u_wind_res;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform float u_rand_seed;
 uniform float u_speed_factor;
 uniform float u_drop_rate;
 uniform float u_drop_rate_bump;

 varying vec2 v_tex_pos;

 // pseudo-random generator
 const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);
 float rand(const vec2 co) {
 float t = dot(rand_constants.xy, co);
     return fract(sin(t) * (rand_constants.z + t));
 }

 // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation
 vec2 lookup_wind(const vec2 uv) {
     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering
     vec2 px = 1.0 / u_wind_res;
     vec2 vc = (floor(uv * u_wind_res)) * px;
     vec2 f = fract(uv * u_wind_res);
     vec2 tl = texture2D(u_wind, vc).rg;
     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;
     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;
     vec2 br = texture2D(u_wind, vc + px).rg;
     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);
 }

 void main() {
     vec4 color = texture2D(u_particles, v_tex_pos);
     vec2 pos = vec2(
         color.r / 255.0 + color.b,
         color.g / 255.0 + color.a); // decode particle position from pixel RGBA
     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));
     float speed_t = length(velocity) / length(u_wind_max);

     // take EPSG:4236 distortion into account for calculating where the particle moved
     float distortion = cos(radians(pos.y * 180.0 - 90.0));
     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;

     // update particle position, wrapping around the date line
     pos = fract(1.0 + pos + offset);

     // a random seed to use for the particle drop
     vec2 seed = (pos + v_tex_pos) * u_rand_seed;

     // drop rate is a chance a particle will restart at random position, to avoid degeneration
     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;
     float drop = step(1.0 - drop_rate, rand(seed));

     vec2 random_pos = vec2(
         rand(seed + 1.3),
         rand(seed + 2.1));
         pos = mix(pos, random_pos, drop);

     // encode the new particle position back into RGBA
     gl_FragColor = vec4(
         fract(pos * 255.0),
         floor(pos * 255.0) / 255.0);
 }`,d=/^(1887|7596)$/.test(e.j)?null:`
     precision mediump float;

     attribute vec2 a_pos;

     varying vec2 v_tex_pos;

     void main() {
         v_tex_pos = a_pos;
         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);
         gl_PointSize = 100.0;
 }`,m=/^(1887|7596)$/.test(e.j)?null:`
 precision mediump float;

 uniform sampler2D u_screen;
 uniform float u_opacity;
 varying vec2 v_tex_pos;

 void main() {
     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);

     // a hack to guarantee opacity fade out even with a value close to 1.0
     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);
 }`},50363:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){let c,d;if(a===void 0)for(const m of i)m!=null&&(c===void 0?m>=m&&(c=d=m):(c>m&&(c=m),d<m&&(d=m)));else{let m=-1;for(let l of i)(l=a(l,++m,i))!=null&&(c===void 0?l>=l&&(c=d=l):(c>l&&(c=l),d<l&&(d=l)))}return[c,d]}},64844:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});var u=class{constructor(i,a){const{buffer:c,offset:d,stride:m,normalized:l,size:r,divisor:h,shaderLocation:g}=a;this.buffer=c,this.attribute={shaderLocation:g,buffer:c.get(),offset:d||0,stride:m||0,normalized:l||!1,divisor:h||0},r&&(this.attribute.size=r)}get(){return this.buffer}updateBuffer(i){this.buffer.subData(i)}destroy(){this.buffer.destroy()}}},90744:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(71590);if(!/^(1887|7596)$/.test(e.j))var a=e(28356);if(!/^(1887|7596)$/.test(e.j))var c=e(52749);var d=class{constructor(m,l){this.isDestroyed=!1;const{data:r,usage:h,type:g,isUBO:A,label:o}=l;let S;(0,c.f)(r)?S=r:S=new a.S1[this.type||i.gl.FLOAT](r),this.type=g,this.size=S.byteLength,this.buffer=m.createBuffer({viewOrSize:S,usage:A?u.FB.UNIFORM:u.FB.VERTEX,hint:a.yw[h||i.gl.STATIC_DRAW]}),o&&m.setResourceName(this.buffer,o)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:m,offset:l}){let r;(0,c.f)(m)?r=m:r=new a.S1[this.type||i.gl.FLOAT](m),this.buffer.setSubData(l,new Uint8Array(r.buffer))}}},35191:(Xt,K,e)=>{"use strict";if(e.d(K,{m:()=>A}),!/^(1887|7596)$/.test(e.j))var u=e(15580);if(!/^(1887|7596)$/.test(e.j))var i=e(66243);function a(o,S){return o=(0,i.V4)(o,S.blendMode),o=(0,i.V4)(o,S.blendSrcFactor),o=(0,i.V4)(o,S.blendDstFactor),o}function c(o,S){return o=a(o,S.rgbBlendState),o=a(o,S.alphaBlendState),o=(0,i.V4)(o,S.channelWriteMask),o}function d(o,S){return o=(0,i.V4)(o,S.r<<24|S.g<<16|S.b<<8|S.a),o}function m(o,S){var T,E,b,C,X,R,M,Z;for(let rt=0;rt<S.attachmentsState.length;rt++)o=c(o,S.attachmentsState[rt]);return o=d(o,S.blendConstant||u.Ab),o=(0,i.V4)(o,S.depthCompare),o=(0,i.V4)(o,S.depthWrite?1:0),o=(0,i.V4)(o,(T=S.stencilFront)==null?void 0:T.compare),o=(0,i.V4)(o,(E=S.stencilFront)==null?void 0:E.passOp),o=(0,i.V4)(o,(b=S.stencilFront)==null?void 0:b.failOp),o=(0,i.V4)(o,(C=S.stencilFront)==null?void 0:C.depthFailOp),o=(0,i.V4)(o,(X=S.stencilBack)==null?void 0:X.compare),o=(0,i.V4)(o,(R=S.stencilBack)==null?void 0:R.passOp),o=(0,i.V4)(o,(M=S.stencilBack)==null?void 0:M.failOp),o=(0,i.V4)(o,(Z=S.stencilBack)==null?void 0:Z.depthFailOp),o=(0,i.V4)(o,S.stencilWrite?1:0),o=(0,i.V4)(o,S.cullMode),o=(0,i.V4)(o,S.frontFace?1:0),o=(0,i.V4)(o,S.polygonOffset?1:0),o}function l(o){let S=0;S=(0,i.V4)(S,o.program.id),o.inputLayout!==null&&(S=(0,i.V4)(S,o.inputLayout.id)),S=m(S,o.megaStateDescriptor);for(let T=0;T<o.colorAttachmentFormats.length;T++)S=(0,i.V4)(S,o.colorAttachmentFormats[T]||0);return S=(0,i.V4)(S,o.depthStencilAttachmentFormat||0),(0,i.Mm)(S)}function r(o){let S=0;if(o.samplerBindings)for(let T=0;T<o.samplerBindings.length;T++){const E=o.samplerBindings[T];E!==null&&E.texture!==null&&(S=(0,i.V4)(S,E.texture.id))}if(o.uniformBufferBindings)for(let T=0;T<o.uniformBufferBindings.length;T++){const E=o.uniformBufferBindings[T];E!==null&&E.buffer!==null&&(S=(0,i.V4)(S,E.buffer.id),S=(0,i.V4)(S,E.binding),S=(0,i.V4)(S,E.offset),S=(0,i.V4)(S,E.size))}if(o.storageBufferBindings)for(let T=0;T<o.storageBufferBindings.length;T++){const E=o.storageBufferBindings[T];E!==null&&E.buffer!==null&&(S=(0,i.V4)(S,E.buffer.id),S=(0,i.V4)(S,E.binding),S=(0,i.V4)(S,E.offset),S=(0,i.V4)(S,E.size))}if(o.storageTextureBindings)for(let T=0;T<o.storageTextureBindings.length;T++){const E=o.storageTextureBindings[T];E!==null&&E.texture!==null&&(S=(0,i.V4)(S,E.texture.id),S=(0,i.V4)(S,E.binding))}return(0,i.Mm)(S)}function h(o,S){var T,E,b,C;return((T=o.vertex)==null?void 0:T.glsl)===((E=S.vertex)==null?void 0:E.glsl)&&((b=o.fragment)==null?void 0:b.glsl)===((C=S.fragment)==null?void 0:C.glsl)}function g(o){var S,T;return{vertex:{glsl:(S=o.vertex)==null?void 0:S.glsl},fragment:{glsl:(T=o.fragment)==null?void 0:T.glsl}}}var A=class{constructor(o){this.device=o,this.bindingsCache=new i.zN(u.PU,r),this.renderPipelinesCache=new i.zN(u.zC,l),this.inputLayoutsCache=new i.zN(u.F3,i.$W),this.programCache=new i.zN(h,i.$W)}createBindings(o){var S;let T=this.bindingsCache.get(o);if(T===null){const E=(0,u.LJ)(o);E.uniformBufferBindings=(S=E.uniformBufferBindings)==null?void 0:S.filter(({size:b})=>b&&b>0),T=this.device.createBindings(E),this.bindingsCache.add(E,T)}return T}createRenderPipeline(o){let S=this.renderPipelinesCache.get(o);if(S===null){const T=(0,u.yA)(o);T.colorAttachmentFormats=T.colorAttachmentFormats.filter(E=>E),S=this.device.createRenderPipeline(T),this.renderPipelinesCache.add(T,S)}return S}createInputLayout(o){o.vertexBufferDescriptors=o.vertexBufferDescriptors.filter(T=>!!T);let S=this.inputLayoutsCache.get(o);if(S===null){const T=(0,u.Id)(o);S=this.device.createInputLayout(T),this.inputLayoutsCache.add(T,S)}return S}createProgram(o){let S=this.programCache.get(o);if(S===null){const T=g(o);S=this.device.createProgram(o),this.programCache.add(T,S)}return S}destroy(){for(const o of this.bindingsCache.values())o.destroy();for(const o of this.renderPipelinesCache.values())o.destroy();for(const o of this.inputLayoutsCache.values())o.destroy();for(const o of this.programCache.values())o.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}},24283:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(71590);if(!/^(1887|7596)$/.test(e.j))var a=e(28356);if(!/^(1887|7596)$/.test(e.j))var c=e(52749);var d=class{constructor(m,l){const{data:r,type:h,count:g=0}=l;let A;(0,c.f)(r)?A=r:A=new a.S1[this.type||i.gl.UNSIGNED_INT](r),this.type=h,this.count=g,this.indexBuffer=m.createBuffer({viewOrSize:A,usage:u.FB.INDEX})}get(){return this.indexBuffer}subData({data:m}){let l;(0,c.f)(m)?l=m:l=new a.S1[this.type||i.gl.UNSIGNED_INT](m),this.indexBuffer.setSubData(0,new Uint8Array(l.buffer))}destroy(){this.indexBuffer.destroy()}}},99619:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(15580);if(!/^(1887|7596)$/.test(e.j))var i=e(2294);var a=class{constructor(c,d){this.device=c,this.options=d,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(c=!1){const{width:d,height:m,color:l}=this.options;l&&((0,i.v)(l)?(c&&l.resize({width:d,height:m}),this.colorTexture=l.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=l.width,this.height=l.height):d&&m&&(this.colorTexture=this.device.createTexture({format:u.ED.U8_RGBA_RT,usage:u.v2.RENDER_TARGET,width:d,height:m}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=d,this.height=m))}createDepthRenderTarget(c=!1){const{width:d,height:m,depth:l}=this.options;l&&((0,i.v)(l)?(c&&l.resize({width:d,height:m}),this.depthTexture=l.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=l.width,this.height=l.height):d&&m&&(this.depthTexture=this.device.createTexture({format:u.ED.D24_S8,usage:u.v2.RENDER_TARGET,width:d,height:m}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=d,this.height=m))}get(){return this.colorRenderTarget}destroy(){var c,d;(c=this.colorRenderTarget)==null||c.destroy(),(d=this.depthRenderTarget)==null||d.destroy()}resize({width:c,height:d}){(this.width!==c||this.height!==d)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=c,this.options.height=d,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}},38261:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>R}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(71590),a=e(64939);if(!/^(1887|7596)$/.test(e.j))var c=e(99619);if(!/^(1887|7596)$/.test(e.j))var d=e(2294);if(!/^(1887|7596)$/.test(e.j))var m=e(28356);var l=Object.defineProperty,r=Object.defineProperties,h=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,S=(M,Z,rt)=>Z in M?l(M,Z,{enumerable:!0,configurable:!0,writable:!0,value:rt}):M[Z]=rt,T=(M,Z)=>{for(var rt in Z||(Z={}))A.call(Z,rt)&&S(M,rt,Z[rt]);if(g)for(var rt of g(Z))o.call(Z,rt)&&S(M,rt,Z[rt]);return M},E=(M,Z)=>r(M,h(Z)),{isPlainObject:b,isTypedArray:C,isNil:X}=a.lodashUtil,R=class{constructor(M,Z,rt){this.device=M,this.options=Z,this.service=rt,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:N,fs:Q,attributes:ft,uniforms:I,count:G,elements:ut,diagnosticDerivativeUniformityEnabled:L}=Z;this.options=Z;const j=L?"":this.service.viewportOrigin===u.Fp.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=rt.renderCache.createProgram({vertex:{glsl:N},fragment:{glsl:Q,postprocess:H=>j+H}}),I&&(this.uniforms=this.extractUniforms(I));const O=[];let B=0;Object.keys(ft).forEach(H=>{const U=ft[H],V=U.get();this.vertexBuffers.push(V.get());const{offset:D=0,stride:lt=0,size:J=1,divisor:Rt=0,shaderLocation:kt=0}=U.attribute;O.push({arrayStride:lt||J*4,stepMode:u.Kz.VERTEX,attributes:[{format:m.JJ[J],shaderLocation:kt,offset:D,divisor:Rt}]}),B=V.size/J}),G||(this.options.count=B),ut&&(this.indexBuffer=ut.get());const _=rt.renderCache.createInputLayout({vertexBufferDescriptors:O,indexBufferFormat:ut?u.ED.U32_R:null,program:this.program});this.inputLayout=_,this.pipeline=this.createPipeline(Z)}createPipeline(M,Z){var rt;const{primitive:N=i.gl.TRIANGLES,depth:Q,cull:ft,blend:I,stencil:G}=M,ut=this.initDepthDrawParams({depth:Q}),L=!!(ut&&ut.enable),j=this.initCullDrawParams({cull:ft}),O=!!(j&&j.enable),B=this.getBlendDrawParams({blend:I}),_=!!(B&&B.enable),H=this.getStencilDrawParams({stencil:G}),U=!!(H&&H.enable),V=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:m.MM[N],colorAttachmentFormats:[u.ED.U8_RGBA_RT],depthStencilAttachmentFormat:u.ED.D24_S8,megaStateDescriptor:{attachmentsState:[Z?{channelWriteMask:u.GI.ALL,rgbBlendState:{blendMode:u.bt.ADD,blendSrcFactor:u.zi.ONE,blendDstFactor:u.zi.ZERO},alphaBlendState:{blendMode:u.bt.ADD,blendSrcFactor:u.zi.ONE,blendDstFactor:u.zi.ZERO}}:{channelWriteMask:U&&H.opFront.zpass===u.Kd.REPLACE?u.GI.NONE:u.GI.ALL,rgbBlendState:{blendMode:_&&B.equation.rgb||u.bt.ADD,blendSrcFactor:_&&B.func.srcRGB||u.zi.SRC_ALPHA,blendDstFactor:_&&B.func.dstRGB||u.zi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:_&&B.equation.alpha||u.bt.ADD,blendSrcFactor:_&&B.func.srcAlpha||u.zi.ONE,blendDstFactor:_&&B.func.dstAlpha||u.zi.ONE}}],blendConstant:_?u.Ab:void 0,depthWrite:L,depthCompare:L&&ut.func||u.wb.LESS,cullMode:O&&j.face||u.Wf.NONE,stencilWrite:U,stencilFront:{compare:U?H.func.cmp:u.wb.ALWAYS,passOp:H.opFront.zpass,failOp:H.opFront.fail,depthFailOp:H.opFront.zfail,mask:H.opFront.mask},stencilBack:{compare:U?H.func.cmp:u.wb.ALWAYS,passOp:H.opBack.zpass,failOp:H.opBack.fail,depthFailOp:H.opBack.zfail,mask:H.opBack.mask}}});return U&&!X((rt=G==null?void 0:G.func)==null?void 0:rt.ref)&&(V.stencilFuncReference=G.func.ref),V}updateAttributesAndElements(){}updateAttributes(){}addUniforms(M){this.uniforms=T(T({},this.uniforms),this.extractUniforms(M))}draw(M,Z){const rt=T(T({},this.options),M),{count:N=0,instances:Q,elements:ft,uniforms:I={},uniformBuffers:G,textures:ut}=rt;this.uniforms=T(T({},this.uniforms),this.extractUniforms(I));const{renderPass:L,currentFramebuffer:j,width:O,height:B}=this.service;this.pipeline=this.createPipeline(rt,Z);const _=this.service.device,H=_.swapChainHeight;if(_.swapChainHeight=(j==null?void 0:j.height)||B,L.setViewport(0,0,(j==null?void 0:j.width)||O,(j==null?void 0:j.height)||B),_.swapChainHeight=H,L.setPipeline(this.pipeline),X(this.pipeline.stencilFuncReference)||L.setStencilReference(this.pipeline.stencilFuncReference),L.setVertexInput(this.inputLayout,this.vertexBuffers.map(U=>({buffer:U})),ft?{buffer:this.indexBuffer,offset:0}:null),G&&(this.bindings=_.createBindings({pipeline:this.pipeline,uniformBufferBindings:G.map((U,V)=>{const D=U;return{binding:V,buffer:D.get(),size:D.size}}),samplerBindings:ut==null?void 0:ut.map(U=>({texture:U.texture,sampler:U.sampler}))})),this.bindings&&(L.setBindings(this.bindings),Object.keys(this.uniforms).forEach(U=>{const V=this.uniforms[U];V instanceof d.Z?this.uniforms[U]=V.get():V instanceof c.Z&&(this.uniforms[U]=V.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),ft){const U=ft.count;U===0?L.draw(N,Q):L.drawIndexed(U,Q)}else L.draw(N,Q)}destroy(){var M,Z,rt;(M=this.vertexBuffers)==null||M.forEach(N=>N.destroy()),(Z=this.indexBuffer)==null||Z.destroy(),(rt=this.bindings)==null||rt.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:M}){if(M)return{enable:M.enable===void 0?!0:!!M.enable,mask:M.mask===void 0?!0:!!M.mask,func:m.rz[M.func||i.gl.LESS],range:M.range||[0,1]}}getBlendDrawParams({blend:M}){const{enable:Z,func:rt,equation:N,color:Q=[0,0,0,0]}=M||{};return{enable:!!Z,func:{srcRGB:m.E[rt&&rt.srcRGB||i.gl.SRC_ALPHA],srcAlpha:m.E[rt&&rt.srcAlpha||i.gl.SRC_ALPHA],dstRGB:m.E[rt&&rt.dstRGB||i.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:m.E[rt&&rt.dstAlpha||i.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:m.Az[N&&N.rgb||i.gl.FUNC_ADD],alpha:m.Az[N&&N.alpha||i.gl.FUNC_ADD]},color:Q}}getStencilDrawParams({stencil:M}){const{enable:Z,mask:rt=4294967295,func:N={cmp:i.gl.ALWAYS,ref:0,mask:4294967295},opFront:Q={fail:i.gl.KEEP,zfail:i.gl.KEEP,zpass:i.gl.KEEP},opBack:ft={fail:i.gl.KEEP,zfail:i.gl.KEEP,zpass:i.gl.KEEP}}=M||{};return{enable:!!Z,mask:rt,func:E(T({},N),{cmp:m.hP[N.cmp]}),opFront:{fail:m.sx[Q.fail],zfail:m.sx[Q.zfail],zpass:m.sx[Q.zpass],mask:N.mask},opBack:{fail:m.sx[ft.fail],zfail:m.sx[ft.zfail],zpass:m.sx[ft.zpass],mask:N.mask}}}initCullDrawParams({cull:M}){if(M){const{enable:Z,face:rt=i.gl.BACK}=M;return{enable:!!Z,face:m.F2[rt]}}}extractUniforms(M){const Z={};return Object.keys(M).forEach(rt=>{this.extractUniformsRecursively(rt,M[rt],Z,"")}),Z}extractUniformsRecursively(M,Z,rt,N){if(Z===null||typeof Z=="number"||typeof Z=="boolean"||Array.isArray(Z)&&typeof Z[0]=="number"||C(Z)||Z===""||"resize"in Z){rt[`${N&&N+"."}${M}`]=Z;return}b(Z)&&Object.keys(Z).forEach(Q=>{this.extractUniformsRecursively(Q,Z[Q],rt,`${N&&N+"."}${M}`)}),Array.isArray(Z)&&Z.forEach((Q,ft)=>{Object.keys(Q).forEach(I=>{this.extractUniformsRecursively(I,Q[I],rt,`${N&&N+"."}${M}[${ft}]`)})})}}},2294:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m,v:()=>d}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(71590);if(!/^(1887|7596)$/.test(e.j))var a=e(28356);if(!/^(1887|7596)$/.test(e.j))var c=e(52749);function d(l){return!!(l&&l.texture)}var m=class{constructor(l,r){this.device=l,this.options=r,this.isDestroy=!1;const{wrapS:h=i.gl.CLAMP_TO_EDGE,wrapT:g=i.gl.CLAMP_TO_EDGE,aniso:A,mag:o=i.gl.NEAREST,min:S=i.gl.NEAREST}=r;this.createTexture(r),this.sampler=l.createSampler({addressModeU:a.In[h],addressModeV:a.In[g],minFilter:S===i.gl.NEAREST?u.X9.POINT:u.X9.BILINEAR,magFilter:o===i.gl.NEAREST?u.X9.POINT:u.X9.BILINEAR,mipmapFilter:u.f$.NO_MIP,maxAnisotropy:A})}createTexture(l){const{type:r=i.gl.UNSIGNED_BYTE,width:h,height:g,flipY:A=!1,format:o=i.gl.RGBA,alignment:S=1,usage:T=i.v2.SAMPLED,unorm:E=!1,label:b}=l;let{data:C}=l;this.width=h,this.height=g;let X=u.ED.U8_RGBA_RT;if(r===i.gl.UNSIGNED_BYTE&&o===i.gl.RGBA)X=E?u.ED.U8_RGBA_NORM:u.ED.U8_RGBA_RT;else if(r===i.gl.UNSIGNED_BYTE&&o===i.gl.LUMINANCE)X=u.ED.U8_LUMINANCE;else if(r===i.gl.FLOAT&&o===i.gl.LUMINANCE)X=u.ED.F32_LUMINANCE;else if(r===i.gl.FLOAT&&o===i.gl.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(C&&(C=(0,c.C)(C,0)),X=u.ED.F32_RGBA):X=u.ED.F32_RGB;else if(r===i.gl.FLOAT&&o===i.gl.RGBA)X=u.ED.F32_RGBA;else if(r===i.gl.FLOAT&&o===i.gl.RED)X=u.ED.F32_R;else throw new Error(`create texture error, type: ${r}, format: ${o}`);this.texture=this.device.createTexture({format:X,width:h,height:g,usage:T===i.v2.SAMPLED?u.v2.SAMPLED:u.v2.RENDER_TARGET,pixelStore:{unpackFlipY:A,packAlignment:S},mipLevelCount:1}),b&&this.device.setResourceName(this.texture,b),C&&this.texture.setImageData([C])}get(){return this.texture}update(l){const{data:r}=l;this.texture.setImageData([r])}bind(){}resize({width:l,height:r}){(this.width!==l||this.height!==r)&&this.destroy(),this.options.width=l,this.options.height=r,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var l;!this.isDestroy&&!this.texture.destroyed&&((l=this.texture)==null||l.destroy()),this.isDestroy=!0}}},28356:(Xt,K,e)=>{"use strict";e.d(K,{Az:()=>g,E:()=>A,F2:()=>h,In:()=>l,JJ:()=>d,MM:()=>c,S1:()=>a,hP:()=>S,rz:()=>r,sx:()=>o,yw:()=>m});var u=e(15580),i=e(71590),a={[i.gl.FLOAT]:Float32Array,[i.gl.UNSIGNED_BYTE]:Uint8Array,[i.gl.SHORT]:Int16Array,[i.gl.UNSIGNED_SHORT]:Uint16Array,[i.gl.INT]:Int32Array,[i.gl.UNSIGNED_INT]:Uint32Array},c={[i.gl.POINTS]:u.YV.POINTS,[i.gl.LINES]:u.YV.LINES,[i.gl.LINE_LOOP]:u.YV.LINES,[i.gl.LINE_STRIP]:u.YV.LINE_STRIP,[i.gl.TRIANGLES]:u.YV.TRIANGLES,[i.gl.TRIANGLE_FAN]:u.YV.TRIANGLES,[i.gl.TRIANGLE_STRIP]:u.YV.TRIANGLE_STRIP},d={1:u.ED.F32_R,2:u.ED.F32_RG,3:u.ED.F32_RGB,4:u.ED.F32_RGBA},m={[i.gl.STATIC_DRAW]:u.MP.STATIC,[i.gl.DYNAMIC_DRAW]:u.MP.DYNAMIC,[i.gl.STREAM_DRAW]:u.MP.DYNAMIC},l={[i.gl.REPEAT]:u.OB.REPEAT,[i.gl.CLAMP_TO_EDGE]:u.OB.CLAMP_TO_EDGE,[i.gl.MIRRORED_REPEAT]:u.OB.MIRRORED_REPEAT},r={[i.gl.NEVER]:u.wb.NEVER,[i.gl.ALWAYS]:u.wb.ALWAYS,[i.gl.LESS]:u.wb.LESS,[i.gl.LEQUAL]:u.wb.LEQUAL,[i.gl.GREATER]:u.wb.GREATER,[i.gl.GEQUAL]:u.wb.GEQUAL,[i.gl.EQUAL]:u.wb.EQUAL,[i.gl.NOTEQUAL]:u.wb.NOTEQUAL},h={[i.gl.FRONT]:u.Wf.FRONT,[i.gl.BACK]:u.Wf.BACK},g={[i.gl.FUNC_ADD]:u.bt.ADD,[i.gl.MIN_EXT]:u.bt.MIN,[i.gl.MAX_EXT]:u.bt.MAX,[i.gl.FUNC_SUBTRACT]:u.bt.SUBSTRACT,[i.gl.FUNC_REVERSE_SUBTRACT]:u.bt.REVERSE_SUBSTRACT},A={[i.gl.ZERO]:u.zi.ZERO,[i.gl.ONE]:u.zi.ONE,[i.gl.SRC_COLOR]:u.zi.SRC,[i.gl.ONE_MINUS_SRC_COLOR]:u.zi.ONE_MINUS_SRC,[i.gl.SRC_ALPHA]:u.zi.SRC_ALPHA,[i.gl.ONE_MINUS_SRC_ALPHA]:u.zi.ONE_MINUS_SRC_ALPHA,[i.gl.DST_COLOR]:u.zi.DST,[i.gl.ONE_MINUS_DST_COLOR]:u.zi.ONE_MINUS_DST,[i.gl.DST_ALPHA]:u.zi.DST_ALPHA,[i.gl.ONE_MINUS_DST_ALPHA]:u.zi.ONE_MINUS_DST_ALPHA,[i.gl.CONSTANT_COLOR]:u.zi.CONST,[i.gl.ONE_MINUS_CONSTANT_COLOR]:u.zi.ONE_MINUS_CONSTANT,[i.gl.CONSTANT_ALPHA]:u.zi.CONST,[i.gl.ONE_MINUS_CONSTANT_ALPHA]:u.zi.ONE_MINUS_CONSTANT,[i.gl.SRC_ALPHA_SATURATE]:u.zi.SRC_ALPHA_SATURATE},o={[i.gl.REPLACE]:u.Kd.REPLACE,[i.gl.KEEP]:u.Kd.KEEP,[i.gl.ZERO]:u.Kd.ZERO,[i.gl.INVERT]:u.Kd.INVERT,[i.gl.INCR]:u.Kd.INCREMENT_CLAMP,[i.gl.DECR]:u.Kd.DECREMENT_CLAMP,[i.gl.INCR_WRAP]:u.Kd.INCREMENT_WRAP,[i.gl.DECR_WRAP]:u.Kd.DECREMENT_WRAP},S={[i.gl.ALWAYS]:u.wb.ALWAYS,[i.gl.EQUAL]:u.wb.EQUAL,[i.gl.GEQUAL]:u.wb.GEQUAL,[i.gl.GREATER]:u.wb.GREATER,[i.gl.LEQUAL]:u.wb.LEQUAL,[i.gl.LESS]:u.wb.LESS,[i.gl.NEVER]:u.wb.NEVER,[i.gl.NOTEQUAL]:u.wb.NOTEQUAL}},72440:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>S}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(64939);if(!/^(1887|7596)$/.test(e.j))var a=e(64844);if(!/^(1887|7596)$/.test(e.j))var c=e(90744);if(!/^(1887|7596)$/.test(e.j))var d=e(35191);if(!/^(1887|7596)$/.test(e.j))var m=e(24283);if(!/^(1887|7596)$/.test(e.j))var l=e(99619);if(!/^(1887|7596)$/.test(e.j))var r=e(38261);if(!/^(1887|7596)$/.test(e.j))var h=e(2294);if(!/^(1887|7596)$/.test(e.j))var g=e(83759);var A=(T,E,b)=>new Promise((C,X)=>{var R=rt=>{try{Z(b.next(rt))}catch(N){X(N)}},M=rt=>{try{Z(b.throw(rt))}catch(N){X(N)}},Z=rt=>rt.done?C(rt.value):Promise.resolve(rt.value).then(R,M);Z((b=b.apply(T,E)).next())}),{isUndefined:o}=i.lodashUtil,S=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=T=>new r.Z(this.device,T,this),this.createAttribute=T=>new a.Z(this.device,T),this.createBuffer=T=>new c.Z(this.device,T),this.createElements=T=>new m.Z(this.device,T),this.createTexture2D=T=>new h.Z(this.device,T),this.createFramebuffer=T=>new l.Z(this.device,T),this.useFramebuffer=(T,E)=>{this.currentFramebuffer=T,this.beginFrame(),E(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(T,E)=>A(this,null,function*(){this.currentFramebuffer=T,this.preRenderPass=this.renderPass,this.beginFrame(),yield E(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=T=>{const{color:E,depth:b,stencil:C,framebuffer:X=null}=T;if(X)X.clearOptions={color:E,depth:b,stencil:C};else{const R=this.queryVerdorInfo();if(R==="WebGL1"){const M=this.getGLContext();o(C)?o(b)||(M.clearDepth(b),M.clear(M.DEPTH_BUFFER_BIT)):(M.clearStencil(C),M.clear(M.STENCIL_BUFFER_BIT))}else if(R==="WebGL2"){const M=this.getGLContext();o(C)?o(b)||M.clearBufferfv(M.DEPTH,0,[b]):M.clearBufferiv(M.STENCIL,0,[C])}}},this.viewport=({width:T,height:E})=>{this.swapChain.configureSwapChain(T,E),this.createMainColorDepthRT(T,E),this.width=T,this.height=E},this.readPixels=T=>{const{framebuffer:E,x:b,y:C,width:X,height:R}=T,M=this.device.createReadback(),Z=E.colorTexture,rt=M.readTextureSync(Z,b,this.viewportOrigin===u.Fp.LOWER_LEFT?C:this.height-C,X,R,new Uint8Array(X*R*4));if(this.viewportOrigin!==u.Fp.LOWER_LEFT)for(let N=0;N<rt.length;N+=4){const Q=rt[N];rt[N]=rt[N+2],rt[N+2]=Q}return M.destroy(),rt},this.readPixelsAsync=T=>A(this,null,function*(){const{framebuffer:E,x:b,y:C,width:X,height:R}=T,M=this.device.createReadback(),Z=E.colorTexture,rt=yield M.readTexture(Z,b,this.viewportOrigin===u.Fp.LOWER_LEFT?C:this.height-C,X,R,new Uint8Array(X*R*4));if(this.viewportOrigin!==u.Fp.LOWER_LEFT)for(let N=0;N<rt.length;N+=4){const Q=rt[N];rt[N]=rt[N+2],rt[N+2]=Q}return M.destroy(),rt}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var T;return(T=this.canvas)==null?void 0:T.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var T;this.canvas=null,(T=this.uniformBuffers)==null||T.forEach(E=>{E.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(T,E){return A(this,null,function*(){const{enableWebGPU:b,shaderCompilerPath:C,antialias:X}=E;this.canvas=T;const M=yield(b?new u.zo({shaderCompilerPath:C}):new u.j8({targets:["webgl2","webgl1"],antialias:X,onContextLost(rt){console.warn("context lost",rt)},onContextCreationError(rt){console.warn("context creation error",rt)},onContextRestored(rt){console.warn("context restored",rt)}})).createSwapChain(T);M.configureSwapChain(T.width,T.height),this.device=M.getDevice(),this.swapChain=M,this.renderCache=new d.m(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const Z=this.device.gl;this.extensionObject={OES_texture_float:!(0,g.D)(Z)&&this.device.OES_texture_float},this.createMainColorDepthRT(T.width,T.height)})}createMainColorDepthRT(T,E){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:u.ED.U8_RGBA_RT,width:T,height:E,usage:u.v2.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:u.ED.D24_S8,width:T,height:E,usage:u.v2.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:T,swapChain:E,mainColorRT:b,mainDepthRT:C}=this,X=T?T.colorRenderTarget:b,R=T?null:E.getOnscreenTexture(),M=T?T.depthRenderTarget:C,{color:Z=[0,0,0,0],depth:rt=1,stencil:N=0}=(T==null?void 0:T.clearOptions)||{},Q=X?(0,u.RH)(Z[0]*255,Z[1]*255,Z[2]*255,Z[3]):u.Ab,ft=M?rt:void 0,I=M?N:void 0,G=this.device.createRenderPass({colorAttachment:[X],colorResolveTo:[R],colorClearColor:[Q],colorStore:[!0],depthStencilAttachment:M,depthClearValue:ft,stencilClearValue:I});this.renderPass=G}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const T=this.device.gl;return T.getParameter(T.ALIASED_POINT_SIZE_RANGE)}testExtension(T){return!!this.getGLContext().getExtension(T)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(T){this.isDirty=T}getDirty(){return this.isDirty}}},66243:(Xt,K,e)=>{"use strict";e.d(K,{$W:()=>a,Mm:()=>i,V4:()=>u,zN:()=>d});function u(m,l=0){return m+=l,m+=m<<10,m+=m>>>6,m>>>0}function i(m){return m+=m<<3,m^=m>>>11,m+=m<<15,m>>>0}function a(){return 0}var c=class{constructor(){this.keys=[],this.values=[]}},d=class{constructor(m,l){this.keyEqualFunc=m,this.keyHashFunc=l,this.buckets=new Map}findBucketIndex(m,l){for(let r=0;r<m.keys.length;r++)if(this.keyEqualFunc(l,m.keys[r]))return r;return-1}findBucket(m){const l=this.keyHashFunc(m);return this.buckets.get(l)}get(m){const l=this.findBucket(m);if(l===void 0)return null;const r=this.findBucketIndex(l,m);return r<0?null:l.values[r]}add(m,l){const r=this.keyHashFunc(m);this.buckets.get(r)===void 0&&this.buckets.set(r,new c);const h=this.buckets.get(r);h.keys.push(m),h.values.push(l)}delete(m){const l=this.findBucket(m);if(l===void 0)return;const r=this.findBucketIndex(l,m);r!==-1&&(l.keys.splice(r,1),l.values.splice(r,1))}clear(){this.buckets.clear()}size(){let m=0;for(const l of this.buckets.values())m+=l.values.length;return m}*values(){for(const m of this.buckets.values())for(let l=m.values.length-1;l>=0;l--)yield m.values[l]}}},52749:(Xt,K,e)=>{"use strict";e.d(K,{C:()=>a,f:()=>i});var u={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function i(c){return Object.prototype.toString.call(c)in u}function a(c,d){const m=c.length,l=Math.ceil(m/3),r=m+l,h=new Float32Array(r);for(let g=0;g<r;g+=4)h[g]=c[g/4*3],h[g+1]=c[g/4*3+1],h[g+2]=c[g/4*3+2],h[g+3]=d;return h}},83759:(Xt,K,e)=>{"use strict";e.d(K,{D:()=>u});function u(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}},10820:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});var u=class{constructor(i,a){const{buffer:c,offset:d,stride:m,normalized:l,size:r,divisor:h}=a;this.buffer=c,this.attribute={buffer:c.get(),offset:d||0,stride:m||0,normalized:l||!1,divisor:h||0},r&&(this.attribute.size=r)}get(){return this.attribute}updateBuffer(i){this.buffer.subData(i)}destroy(){this.buffer.destroy()}}},75865:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(71590);if(!/^(1887|7596)$/.test(e.j))var i=e(21009);var a=class{constructor(c,d){this.isDestroyed=!1;const{data:m,usage:l,type:r}=d;this.buffer=c.buffer({data:m,usage:i.cr[l||u.gl.STATIC_DRAW],type:i.ss[r||u.gl.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:c,offset:d}){this.buffer.subdata(c,d)}}},76496:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(71590);if(!/^(1887|7596)$/.test(e.j))var i=e(21009);var a=class{constructor(c,d){const{data:m,usage:l,type:r,count:h}=d;this.elements=c.elements({data:m,usage:i.cr[l||u.gl.STATIC_DRAW],type:i.ss[r||u.gl.UNSIGNED_BYTE],count:h})}get(){return this.elements}subData({data:c}){this.elements.subdata(c)}destroy(){}}},96480:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});var u=class{constructor(i,a){const{width:c,height:d,color:m,colors:l}=a,r={width:c,height:d};Array.isArray(l)&&(r.colors=l.map(h=>h.get())),m&&typeof m!="boolean"&&(r.color=m.get()),this.framebuffer=i.framebuffer(r)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:i,height:a}){this.framebuffer.resize(i,a)}}},10987:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>b}),!/^(1887|7596)$/.test(e.j))var u=e(15580);var i=e(71590),a=e(64939);if(!/^(1887|7596)$/.test(e.j))var c=e(21009);var d=Object.defineProperty,m=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,A=(C,X,R)=>X in C?d(C,X,{enumerable:!0,configurable:!0,writable:!0,value:R}):C[X]=R,o=(C,X)=>{for(var R in X||(X={}))h.call(X,R)&&A(C,R,X[R]);if(r)for(var R of r(X))g.call(X,R)&&A(C,R,X[R]);return C},S=(C,X)=>m(C,l(X)),{isPlainObject:T,isTypedArray:E}=a.lodashUtil,b=class{constructor(C,X){this.destroyed=!1,this.uniforms={},this.reGl=C;const{vs:R,fs:M,attributes:Z,uniforms:rt,primitive:N,count:Q,elements:ft,depth:I,cull:G,instances:ut}=X,L={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:u.Fp.LOWER_LEFT,clipSpaceNearZ:u.R$.NEGATIVE_ONE,supportMRT:!1},j={};this.options=X,rt&&(this.uniforms=this.extractUniforms(rt),Object.keys(rt).forEach(U=>{j[U]=C.prop(U)}));const O={};Object.keys(Z).forEach(U=>{O[U]=Z[U].get()});const B=(0,i.Vb)((0,u.oX)(L,"frag",M,null,!1)),_=(0,i.Vb)((0,u.oX)(L,"vert",R,null,!1)),H={attributes:O,frag:B,uniforms:j,vert:_,colorMask:C.prop("colorMask"),lineWidth:1,blend:{enable:C.prop("blend.enable"),func:C.prop("blend.func"),equation:C.prop("blend.equation"),color:C.prop("blend.color")},stencil:{enable:C.prop("stencil.enable"),mask:C.prop("stencil.mask"),func:C.prop("stencil.func"),opFront:C.prop("stencil.opFront"),opBack:C.prop("stencil.opBack")},primitive:c.MM[N===void 0?i.gl.TRIANGLES:N]};ut&&(H.instances=ut),Q?H.count=Q:ft&&(H.elements=ft.get()),this.initDepthDrawParams({depth:I},H),this.initCullDrawParams({cull:G},H),this.drawCommand=C(H),this.drawParams=H}updateAttributesAndElements(C,X){const R={};Object.keys(C).forEach(M=>{R[M]=C[M].get()}),this.drawParams.attributes=R,this.drawParams.elements=X.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(C){const X={};Object.keys(C).forEach(R=>{X[R]=C[R].get()}),this.drawParams.attributes=X,this.drawCommand=this.reGl(this.drawParams)}addUniforms(C){this.uniforms=o(o({},this.uniforms),this.extractUniforms(C))}draw(C,X){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const R=o(o({},this.uniforms),this.extractUniforms(C.uniforms||{})),M={};Object.keys(R).forEach(Z=>{const rt=typeof R[Z];rt==="boolean"||rt==="number"||Array.isArray(R[Z])||R[Z].BYTES_PER_ELEMENT?M[Z]=R[Z]:M[Z]=R[Z].get()}),M.blend=X?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(C),M.stencil=this.getStencilDrawParams(C),M.colorMask=this.getColorMaskDrawParams(C,X),this.drawCommand(M)}destroy(){var C,X;(X=(C=this.drawParams)==null?void 0:C.elements)==null||X.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(R=>{R==null||R.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:C},X){C&&(X.depth={enable:C.enable===void 0?!0:!!C.enable,mask:C.mask===void 0?!0:!!C.mask,func:c.rz[C.func||i.gl.LESS],range:C.range||[0,1]})}getBlendDrawParams({blend:C}){const{enable:X,func:R,equation:M,color:Z=[0,0,0,0]}=C||{};return{enable:!!X,func:{srcRGB:c.E[R&&R.srcRGB||i.gl.SRC_ALPHA],srcAlpha:c.E[R&&R.srcAlpha||i.gl.SRC_ALPHA],dstRGB:c.E[R&&R.dstRGB||i.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:c.E[R&&R.dstAlpha||i.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:c.Az[M&&M.rgb||i.gl.FUNC_ADD],alpha:c.Az[M&&M.alpha||i.gl.FUNC_ADD]},color:Z}}getStencilDrawParams({stencil:C}){const{enable:X,mask:R=-1,func:M={cmp:i.gl.ALWAYS,ref:0,mask:-1},opFront:Z={fail:i.gl.KEEP,zfail:i.gl.KEEP,zpass:i.gl.KEEP},opBack:rt={fail:i.gl.KEEP,zfail:i.gl.KEEP,zpass:i.gl.KEEP}}=C||{};return{enable:!!X,mask:R,func:S(o({},M),{cmp:c.hP[M.cmp]}),opFront:{fail:c.sx[Z.fail],zfail:c.sx[Z.zfail],zpass:c.sx[Z.zpass]},opBack:{fail:c.sx[rt.fail],zfail:c.sx[rt.zfail],zpass:c.sx[rt.zpass]}}}getColorMaskDrawParams({stencil:C},X){return C!=null&&C.enable&&C.opFront&&!X?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:C},X){if(C){const{enable:R,face:M=i.gl.BACK}=C;X.cull={enable:!!R,face:c.F2[M]}}}extractUniforms(C){const X={};return Object.keys(C).forEach(R=>{this.extractUniformsRecursively(R,C[R],X,"")}),X}extractUniformsRecursively(C,X,R,M){if(X===null||typeof X=="number"||typeof X=="boolean"||Array.isArray(X)&&typeof X[0]=="number"||E(X)||X===""||"resize"in X){R[`${M&&M+"."}${C}`]=X;return}T(X)&&Object.keys(X).forEach(Z=>{this.extractUniformsRecursively(Z,X[Z],R,`${M&&M+"."}${C}`)}),Array.isArray(X)&&X.forEach((Z,rt)=>{Object.keys(Z).forEach(N=>{this.extractUniformsRecursively(N,Z[N],R,`${M&&M+"."}${C}[${rt}]`)})})}}},91043:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(71590);if(!/^(1887|7596)$/.test(e.j))var i=e(21009);var a=class{constructor(c,d){this.isDestroy=!1;const{data:m,type:l=u.gl.UNSIGNED_BYTE,width:r,height:h,flipY:g=!1,format:A=u.gl.RGBA,mipmap:o=!1,wrapS:S=u.gl.CLAMP_TO_EDGE,wrapT:T=u.gl.CLAMP_TO_EDGE,aniso:E=0,alignment:b=1,premultiplyAlpha:C=!1,mag:X=u.gl.NEAREST,min:R=u.gl.NEAREST,colorSpace:M=u.gl.BROWSER_DEFAULT_WEBGL,x:Z=0,y:rt=0,copy:N=!1}=d;this.width=r,this.height=h;const Q={width:r,height:h,type:i.ss[l],format:i.d6[A],wrapS:i.In[S],wrapT:i.In[T],mag:i.DZ[X],min:i.DZ[R],alignment:b,flipY:g,colorSpace:i.VO[M],premultiplyAlpha:C,aniso:E,x:Z,y:rt,copy:N};m&&(Q.data=m),typeof o=="number"?Q.mipmap=i.hI[o]:typeof o=="boolean"&&(Q.mipmap=o),this.texture=c.texture(Q)}get(){return this.texture}update(c={}){this.texture(c)}bind(){this.texture._texture.bind()}resize({width:c,height:d}){this.texture.resize(c,d),this.width=c,this.height=d}getSize(){return[this.width,this.height]}destroy(){var c;this.isDestroy||(c=this.texture)==null||c.destroy(),this.isDestroy=!0}}},21009:(Xt,K,e)=>{"use strict";e.d(K,{Az:()=>A,DZ:()=>l,E:()=>o,F2:()=>E,In:()=>r,MM:()=>i,VO:()=>h,cr:()=>a,d6:()=>d,hI:()=>m,hP:()=>S,rz:()=>g,ss:()=>c,sx:()=>T});var u=e(71590),i={[u.gl.POINTS]:"points",[u.gl.LINES]:"lines",[u.gl.LINE_LOOP]:"line loop",[u.gl.LINE_STRIP]:"line strip",[u.gl.TRIANGLES]:"triangles",[u.gl.TRIANGLE_FAN]:"triangle fan",[u.gl.TRIANGLE_STRIP]:"triangle strip"},a={[u.gl.STATIC_DRAW]:"static",[u.gl.DYNAMIC_DRAW]:"dynamic",[u.gl.STREAM_DRAW]:"stream"},c={[u.gl.BYTE]:"int8",[u.gl.INT]:"int32",[u.gl.UNSIGNED_BYTE]:"uint8",[u.gl.UNSIGNED_SHORT]:"uint16",[u.gl.UNSIGNED_INT]:"uint32",[u.gl.FLOAT]:"float"},d={[u.gl.ALPHA]:"alpha",[u.gl.LUMINANCE]:"luminance",[u.gl.LUMINANCE_ALPHA]:"luminance alpha",[u.gl.RGB]:"rgb",[u.gl.RGBA]:"rgba",[u.gl.RGBA4]:"rgba4",[u.gl.RGB5_A1]:"rgb5 a1",[u.gl.RGB565]:"rgb565",[u.gl.DEPTH_COMPONENT]:"depth",[u.gl.DEPTH_STENCIL]:"depth stencil"},m={[u.gl.DONT_CARE]:"dont care",[u.gl.NICEST]:"nice",[u.gl.FASTEST]:"fast"},l={[u.gl.NEAREST]:"nearest",[u.gl.LINEAR]:"linear",[u.gl.LINEAR_MIPMAP_LINEAR]:"mipmap",[u.gl.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[u.gl.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[u.gl.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},r={[u.gl.REPEAT]:"repeat",[u.gl.CLAMP_TO_EDGE]:"clamp",[u.gl.MIRRORED_REPEAT]:"mirror"},h={[u.gl.NONE]:"none",[u.gl.BROWSER_DEFAULT_WEBGL]:"browser"},g={[u.gl.NEVER]:"never",[u.gl.ALWAYS]:"always",[u.gl.LESS]:"less",[u.gl.LEQUAL]:"lequal",[u.gl.GREATER]:"greater",[u.gl.GEQUAL]:"gequal",[u.gl.EQUAL]:"equal",[u.gl.NOTEQUAL]:"notequal"},A={[u.gl.FUNC_ADD]:"add",[u.gl.MIN_EXT]:"min",[u.gl.MAX_EXT]:"max",[u.gl.FUNC_SUBTRACT]:"subtract",[u.gl.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},o={[u.gl.ZERO]:"zero",[u.gl.ONE]:"one",[u.gl.SRC_COLOR]:"src color",[u.gl.ONE_MINUS_SRC_COLOR]:"one minus src color",[u.gl.SRC_ALPHA]:"src alpha",[u.gl.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[u.gl.DST_COLOR]:"dst color",[u.gl.ONE_MINUS_DST_COLOR]:"one minus dst color",[u.gl.DST_ALPHA]:"dst alpha",[u.gl.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[u.gl.CONSTANT_COLOR]:"constant color",[u.gl.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[u.gl.CONSTANT_ALPHA]:"constant alpha",[u.gl.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[u.gl.SRC_ALPHA_SATURATE]:"src alpha saturate"},S={[u.gl.NEVER]:"never",[u.gl.ALWAYS]:"always",[u.gl.LESS]:"less",[u.gl.LEQUAL]:"lequal",[u.gl.GREATER]:"greater",[u.gl.GEQUAL]:"gequal",[u.gl.EQUAL]:"equal",[u.gl.NOTEQUAL]:"notequal"},T={[u.gl.ZERO]:"zero",[u.gl.KEEP]:"keep",[u.gl.REPLACE]:"replace",[u.gl.INVERT]:"invert",[u.gl.INCR]:"increment",[u.gl.DECR]:"decrement",[u.gl.INCR_WRAP]:"increment wrap",[u.gl.DECR_WRAP]:"decrement wrap"},E={[u.gl.FRONT]:"front",[u.gl.BACK]:"back"}},10910:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>g});var u=e(81550),i=e.n(u);if(!/^(1887|7596)$/.test(e.j))var a=e(10820);if(!/^(1887|7596)$/.test(e.j))var c=e(75865);if(!/^(1887|7596)$/.test(e.j))var d=e(76496);if(!/^(1887|7596)$/.test(e.j))var m=e(96480);if(!/^(1887|7596)$/.test(e.j))var l=e(10987);if(!/^(1887|7596)$/.test(e.j))var r=e(91043);var h=(A,o,S)=>new Promise((T,E)=>{var b=R=>{try{X(S.next(R))}catch(M){E(M)}},C=R=>{try{X(S.throw(R))}catch(M){E(M)}},X=R=>R.done?T(R.value):Promise.resolve(R.value).then(b,C);X((S=S.apply(A,o)).next())}),g=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=A=>new l.Z(this.gl,A),this.createAttribute=A=>new a.Z(this.gl,A),this.createBuffer=A=>new c.Z(this.gl,A),this.createElements=A=>new d.Z(this.gl,A),this.createTexture2D=A=>new r.Z(this.gl,A),this.createFramebuffer=A=>new m.Z(this.gl,A),this.useFramebuffer=(A,o)=>{this.gl({framebuffer:A?A.get():null})(o)},this.useFramebufferAsync=(A,o)=>h(this,null,function*(){this.gl({framebuffer:A?A.get():null})(o)}),this.clear=A=>{var o;const{color:S,depth:T,stencil:E,framebuffer:b=null}=A,C={color:S,depth:T,stencil:E};C.framebuffer=b===null?b:b.get(),(o=this.gl)==null||o.clear(C)},this.viewport=({x:A,y:o,width:S,height:T})=>{this.gl._gl.viewport(A,o,S,T),this.width=S,this.height=T,this.gl._refresh()},this.readPixels=A=>{const{framebuffer:o,x:S,y:T,width:E,height:b}=A,C={x:S,y:T,width:E,height:b};return o&&(C.framebuffer=o.get()),this.gl.read(C)},this.readPixelsAsync=A=>h(this,null,function*(){return this.readPixels(A)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var A;return(A=this.canvas)==null?void 0:A.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var A,o,S;this.canvas=null,(S=(o=(A=this.gl)==null?void 0:A._gl)==null?void 0:o.getExtension("WEBGL_lose_context"))==null||S.loseContext(),this.gl.destroy(),this.gl=null}}init(A,o,S){return h(this,null,function*(){this.canvas=A,S?this.gl=S:this.gl=yield new Promise((T,E)=>{i()({canvas:this.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(b,C)=>{(b||!C)&&E(b),T(C)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(A){return!!this.getGLContext().getExtension(A)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const A=this.getGLContext();A.disable(A.CULL_FACE)}setDirty(A){this.isDirty=A}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}}},35313:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>d,z:()=>c});var u=e(64939),i=e(26729),a=e.n(i),c=/^(1887|7596)$/.test(e.j)?null:["selectstart","selecting","selectend"],d=class extends(/^(1887|7596)$/.test(e.j)?null:i.EventEmitter){constructor(m,l={}){super(),this.isEnable=!1,this.onDragStart=r=>{this.box.style.display="block",this.startEvent=this.endEvent=r,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=r=>{this.endEvent=r,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=r=>{this.endEvent=r,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=m,this.options=l}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:m}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const l=u.SO.create("div",void 0,this.container);l.classList.add("l7-select-box"),m&&l.classList.add(m),l.style.display="none",this.box=l}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:m,y:l}=this.startEvent,{x:r,y:h}=this.endEvent,g=Math.min(m,r),A=Math.min(l,h),o=Math.abs(m-r),S=Math.abs(l-h);this.box.style.top=`${A}px`,this.box.style.left=`${g}px`,this.box.style.width=`${o}px`,this.box.style.height=`${S}px`}getLngLatBox(){const{lngLat:{lng:m,lat:l}}=this.startEvent,{lngLat:{lng:r,lat:h}}=this.endEvent;return(0,u.Ol)([[m,l],[r,h]])}}},32966:(Xt,K,e)=>{"use strict";e.d(K,{x:()=>X});var u=e(92078),i=e(71590),a=e(29283);if(!/^(1887|7596)$/.test(e.j))var c=e(10910);if(!/^(1887|7596)$/.test(e.j))var d=e(72440);var m=e(64939);if(!/^(1887|7596)$/.test(e.j))var l=e(35313);var r=Object.defineProperty,h=Object.defineProperties,g=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,T=(R,M,Z)=>M in R?r(R,M,{enumerable:!0,configurable:!0,writable:!0,value:Z}):R[M]=Z,E=(R,M)=>{for(var Z in M||(M={}))o.call(M,Z)&&T(R,Z,M[Z]);if(A)for(var Z of A(M))S.call(M,Z)&&T(R,Z,M[Z]);return R},b=(R,M)=>h(R,g(M)),C=(R,M,Z)=>new Promise((rt,N)=>{var Q=G=>{try{I(Z.next(G))}catch(ut){N(ut)}},ft=G=>{try{I(Z.throw(G))}catch(ut){N(ut)}},I=G=>G.done?rt(G.value):Promise.resolve(G.value).then(Q,ft);I((Z=Z.apply(R,M)).next())}),X=class{constructor(R){const{id:M,map:Z,renderer:rt="device"}=R,N=(0,i.Hp)();this.container=N,Z.setContainer(N,M),rt==="regl"?N.rendererService=new c.Z:N.rendererService=new d.Z,this.sceneService=N.sceneService,this.mapService=N.mapService,this.iconService=N.iconService,this.fontService=N.fontService,this.controlService=N.controlService,this.layerService=N.layerService,this.debugService=N.debugService,this.debugService.setEnable(R.debug),this.markerService=N.markerService,this.interactionService=N.interactionService,this.popupService=N.popupService,this.boxSelect=new l.Z(this,{}),this.initComponent(M),this.sceneService.init(R),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(R){return C(this,null,function*(){return this.sceneService.exportPng(R)})}exportMap(R){return C(this,null,function*(){return this.sceneService.exportPng(R)})}registerRenderService(R){this.sceneService.loaded?new R(this).init():this.on("loaded",()=>{new R(this).init()})}setBgColor(R){this.mapService.setBgColor(R)}addLayer(R){this.loaded?this.preAddLayer(R):this.once("loaded",()=>{this.preAddLayer(R)})}preAddLayer(R){const M=(0,i.e7)(this.container);if(R.setContainer(M),this.sceneService.addLayer(R),R.inited){this.initTileLayer(R);const Z=this.initMask(R);this.addMask(Z,R.id)}else R.on("inited",()=>{this.initTileLayer(R);const Z=this.initMask(R);this.addMask(Z,R.id)})}initMask(R){const{mask:M,maskfence:Z,maskColor:rt="#000",maskOpacity:N=0}=R.getLayerConfig();return!M||!Z?void 0:new a.$1().source(Z).shape("fill").style({color:rt,opacity:N})}addMask(R,M){if(!R)return;const Z=this.getLayer(M);if(Z){const rt=(0,i.e7)(this.container);R.setContainer(rt),Z.addMaskLayer(R),this.sceneService.addMask(R)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(R){return this.layerService.getLayer(R)}getLayerByName(R){return this.layerService.getLayerByName(R)}removeLayer(R,M){return C(this,null,function*(){yield this.layerService.remove(R,M)})}removeAllLayer(){return C(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(R){this.layerService.setEnableRender(R)}addIconFont(R,M){this.fontService.addIconFont(R,M)}addIconFonts(R){R.forEach(([M,Z])=>{this.fontService.addIconFont(M,Z)})}addFontFace(R,M){this.fontService.once("fontloaded",Z=>{this.emit("fontloaded",Z)}),this.fontService.addFontFace(R,M)}addImage(R,M){return C(this,null,function*(){yield this.iconService.addImage(R,M)})}hasImage(R){return this.iconService.hasImage(R)}removeImage(R){this.iconService.removeImage(R)}addIconFontGlyphs(R,M){this.fontService.addIconGlyphs(M)}addControl(R){this.controlService.addControl(R,this.container)}removeControl(R){this.controlService.removeControl(R)}getControlByName(R){return this.controlService.getControlByName(R)}addMarker(R){this.markerService.addMarker(R)}addMarkerLayer(R){this.markerService.addMarkerLayer(R)}removeMarkerLayer(R){this.markerService.removeMarkerLayer(R)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(R){this.popupService.addPopup(R)}removePopup(R){this.popupService.removePopup(R)}on(R,M){var Z;l.z.includes(R)?(Z=this.boxSelect)==null||Z.on(R,M):i.P7.includes(R)?this.sceneService.on(R,M):this.mapService.on(R,M)}once(R,M){var Z;l.z.includes(R)?(Z=this.boxSelect)==null||Z.once(R,M):i.P7.includes(R)?this.sceneService.once(R,M):this.mapService.once(R,M)}emit(R,M){i.P7.indexOf(R)===-1?this.mapService.on(R,M):this.sceneService.emit(R,M)}off(R,M){var Z;l.z.includes(R)?(Z=this.boxSelect)==null||Z.off(R,M):i.P7.includes(R)?this.sceneService.off(R,M):this.mapService.off(R,M)}getZoom(){return this.mapService.getZoom()}getCenter(R){return this.mapService.getCenter(R)}setCenter(R,M){return this.mapService.setCenter(R,M)}getPitch(){return this.mapService.getPitch()}setPitch(R){return this.mapService.setPitch(R)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(R){this.mapService.setRotation(R)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(R){this.mapService.panTo(R)}panBy(R,M){this.mapService.panBy(R,M)}getContainer(){return this.mapService.getContainer()}setZoom(R){this.mapService.setZoom(R)}fitBounds(R,M){const{fitBoundsOptions:Z,animate:rt}=this.sceneService.getSceneConfig();this.mapService.fitBounds(R,M||b(E({},Z),{animate:rt}))}setZoomAndCenter(R,M){this.mapService.setZoomAndCenter(R,M)}setMapStyle(R){this.mapService.setMapStyle(R)}setMapStatus(R){this.mapService.setMapStatus(R)}pixelToLngLat(R){return this.mapService.pixelToLngLat(R)}lngLatToPixel(R){return this.mapService.lngLatToPixel(R)}containerToLngLat(R){return this.mapService.containerToLngLat(R)}lngLatToContainer(R){return this.mapService.lngLatToContainer(R)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(R){this.container.postProcessingPass.name=new R}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(R=!0){this.boxSelect.enable(),R&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(R,M){m.SA.REGISTERED_PROTOCOLS[R]=M}static removeProtocol(R){delete m.SA.REGISTERED_PROTOCOLS[R]}getProtocol(R){return m.SA.REGISTERED_PROTOCOLS[R]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(R){this.controlService.init({container:m.SO.getContainer(R)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:R,logoPosition:M}=this.sceneService.getSceneConfig();R&&this.addControl(new u.TR({position:M}))}initTileLayer(R){R.getSource().isTile&&(R.tileLayer=new a.Im(R))}}},32548:(Xt,K,e)=>{"use strict";e.d(K,{default:()=>Ts});var u={},i={},a=s=>i[s],c=(s,f)=>{i[s]=f},d=s=>u[s],m=(s,f)=>{u[s]=f},l=e(18904),r=63710088e-1,h={centimeters:r*100,centimetres:r*100,degrees:r/111325,feet:r*3.28084,inches:r*39.37,kilometers:r/1e3,kilometres:r/1e3,meters:r,metres:r,miles:r/1609.344,millimeters:r*1e3,millimetres:r*1e3,nauticalmiles:r/1852,radians:1,yards:r*1.0936},g={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r,yards:1.0936133},A={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function o(s,f,y){y===void 0&&(y={});var k={type:"Feature"};return(y.id===0||y.id)&&(k.id=y.id),y.bbox&&(k.bbox=y.bbox),k.properties=f||{},k.geometry=s,k}function S(s,f,y){switch(y===void 0&&(y={}),s){case"Point":return T(f).geometry;case"LineString":return X(f).geometry;case"Polygon":return b(f).geometry;case"MultiPoint":return rt(f).geometry;case"MultiLineString":return Z(f).geometry;case"MultiPolygon":return N(f).geometry;default:throw new Error(s+" is invalid")}}function T(s,f,y){if(y===void 0&&(y={}),!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!H(s[0])||!H(s[1]))throw new Error("coordinates must contain numbers");var k={type:"Point",coordinates:s};return o(k,f,y)}function E(s,f,y){return y===void 0&&(y={}),M(s.map(function(k){return T(k,f)}),y)}function b(s,f,y){y===void 0&&(y={});for(var k=0,it=s;k<it.length;k++){var dt=it[k];if(dt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ot=0;Ot<dt[dt.length-1].length;Ot++)if(dt[dt.length-1][Ot]!==dt[0][Ot])throw new Error("First and last Position are not equivalent.")}var St={type:"Polygon",coordinates:s};return o(St,f,y)}function C(s,f,y){return y===void 0&&(y={}),M(s.map(function(k){return b(k,f)}),y)}function X(s,f,y){if(y===void 0&&(y={}),s.length<2)throw new Error("coordinates must be an array of two or more positions");var k={type:"LineString",coordinates:s};return o(k,f,y)}function R(s,f,y){return y===void 0&&(y={}),M(s.map(function(k){return X(k,f)}),y)}function M(s,f){f===void 0&&(f={});var y={type:"FeatureCollection"};return f.id&&(y.id=f.id),f.bbox&&(y.bbox=f.bbox),y.features=s,y}function Z(s,f,y){y===void 0&&(y={});var k={type:"MultiLineString",coordinates:s};return o(k,f,y)}function rt(s,f,y){y===void 0&&(y={});var k={type:"MultiPoint",coordinates:s};return o(k,f,y)}function N(s,f,y){y===void 0&&(y={});var k={type:"MultiPolygon",coordinates:s};return o(k,f,y)}function Q(s,f,y){y===void 0&&(y={});var k={type:"GeometryCollection",geometries:s};return o(k,f,y)}function ft(s,f){if(f===void 0&&(f=0),f&&!(f>=0))throw new Error("precision must be a positive number");var y=Math.pow(10,f||0);return Math.round(s*y)/y}function I(s,f){f===void 0&&(f="kilometers");var y=h[f];if(!y)throw new Error(f+" units is invalid");return s*y}function G(s,f){f===void 0&&(f="kilometers");var y=h[f];if(!y)throw new Error(f+" units is invalid");return s/y}function ut(s,f){return j(G(s,f))}function L(s){var f=s%360;return f<0&&(f+=360),f}function j(s){var f=s%(2*Math.PI);return f*180/Math.PI}function O(s){var f=s%360;return f*Math.PI/180}function B(s,f,y){if(f===void 0&&(f="kilometers"),y===void 0&&(y="kilometers"),!(s>=0))throw new Error("length must be a positive number");return I(G(s,f),y)}function _(s,f,y){if(f===void 0&&(f="meters"),y===void 0&&(y="kilometers"),!(s>=0))throw new Error("area must be a positive number");var k=A[f];if(!k)throw new Error("invalid original units");var it=A[y];if(!it)throw new Error("invalid final units");return s/k*it}function H(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function U(s){return!!s&&s.constructor===Object}function V(s){if(!s)throw new Error("bbox is required");if(!Array.isArray(s))throw new Error("bbox must be an Array");if(s.length!==4&&s.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");s.forEach(function(f){if(!H(f))throw new Error("bbox must only contain numbers")})}function D(s){if(!s)throw new Error("id is required");if(["string","number"].indexOf(typeof s)===-1)throw new Error("id must be a number or a string")}function lt(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return s.geometry.coordinates;if(s.type==="Point")return s.coordinates}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return s;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function J(s){if(Array.isArray(s))return s;if(s.type==="Feature"){if(s.geometry!==null)return s.geometry.coordinates}else if(s.coordinates)return s.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Rt(s){if(s.length>1&&isNumber(s[0])&&isNumber(s[1]))return!0;if(Array.isArray(s[0])&&s[0].length)return Rt(s[0]);throw new Error("coordinates must only contain numbers")}function kt(s,f,y){if(!f||!y)throw new Error("type and name required");if(!s||s.type!==f)throw new Error("Invalid input to "+y+": must be a "+f+", given "+s.type)}function ne(s,f,y){if(!s)throw new Error("No feature passed");if(!y)throw new Error(".featureOf() requires a name");if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+y+", Feature with geometry required");if(!s.geometry||s.geometry.type!==f)throw new Error("Invalid input to "+y+": must be a "+f+", given "+s.geometry.type)}function re(s,f,y){if(!s)throw new Error("No featureCollection passed");if(!y)throw new Error(".collectionOf() requires a name");if(!s||s.type!=="FeatureCollection")throw new Error("Invalid input to "+y+", FeatureCollection required");for(var k=0,it=s.features;k<it.length;k++){var dt=it[k];if(!dt||dt.type!=="Feature"||!dt.geometry)throw new Error("Invalid input to "+y+", Feature with geometry required");if(!dt.geometry||dt.geometry.type!==f)throw new Error("Invalid input to "+y+": must be a "+f+", given "+dt.geometry.type)}}function It(s){return s.type==="Feature"?s.geometry:s}function Nt(s,f){return s.type==="FeatureCollection"?"FeatureCollection":s.type==="GeometryCollection"?"GeometryCollection":s.type==="Feature"&&s.geometry!==null?s.geometry.type:s.type}function p(s,f,y){if(s!==null)for(var k,it,dt,Ot,St,vt,jt,be=0,Oe=0,sn,An=s.type,Fn=An==="FeatureCollection",Wn=An==="Feature",mr=Fn?s.features.length:1,er=0;er<mr;er++){jt=Fn?s.features[er].geometry:Wn?s.geometry:s,sn=jt?jt.type==="GeometryCollection":!1,St=sn?jt.geometries.length:1;for(var fr=0;fr<St;fr++){var ir=0,lr=0;if(Ot=sn?jt.geometries[fr]:jt,Ot!==null){vt=Ot.coordinates;var Cr=Ot.type;switch(be=y&&(Cr==="Polygon"||Cr==="MultiPolygon")?1:0,Cr){case null:break;case"Point":if(f(vt,Oe,er,ir,lr)===!1)return!1;Oe++,ir++;break;case"LineString":case"MultiPoint":for(k=0;k<vt.length;k++){if(f(vt[k],Oe,er,ir,lr)===!1)return!1;Oe++,Cr==="MultiPoint"&&ir++}Cr==="LineString"&&ir++;break;case"Polygon":case"MultiLineString":for(k=0;k<vt.length;k++){for(it=0;it<vt[k].length-be;it++){if(f(vt[k][it],Oe,er,ir,lr)===!1)return!1;Oe++}Cr==="MultiLineString"&&ir++,Cr==="Polygon"&&lr++}Cr==="Polygon"&&ir++;break;case"MultiPolygon":for(k=0;k<vt.length;k++){for(lr=0,it=0;it<vt[k].length;it++){for(dt=0;dt<vt[k][it].length-be;dt++){if(f(vt[k][it][dt],Oe,er,ir,lr)===!1)return!1;Oe++}lr++}ir++}break;case"GeometryCollection":for(k=0;k<Ot.geometries.length;k++)if(p(Ot.geometries[k],f,y)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function w(s,f,y,k){var it=y;return p(s,function(dt,Ot,St,vt,jt){Ot===0&&y===void 0?it=dt:it=f(it,dt,Ot,St,vt,jt)},k),it}function W(s,f){var y;switch(s.type){case"FeatureCollection":for(y=0;y<s.features.length&&f(s.features[y].properties,y)!==!1;y++);break;case"Feature":f(s.properties,0);break}}function st(s,f,y){var k=y;return W(s,function(it,dt){dt===0&&y===void 0?k=it:k=f(k,it,dt)}),k}function Tt(s,f){if(s.type==="Feature")f(s,0);else if(s.type==="FeatureCollection")for(var y=0;y<s.features.length&&f(s.features[y],y)!==!1;y++);}function Gt(s,f,y){var k=y;return Tt(s,function(it,dt){dt===0&&y===void 0?k=it:k=f(k,it,dt)}),k}function ze(s){var f=[];return p(s,function(y){f.push(y)}),f}function $e(s,f){var y,k,it,dt,Ot,St,vt,jt,be,Oe,sn=0,An=s.type==="FeatureCollection",Fn=s.type==="Feature",Wn=An?s.features.length:1;for(y=0;y<Wn;y++){for(St=An?s.features[y].geometry:Fn?s.geometry:s,jt=An?s.features[y].properties:Fn?s.properties:{},be=An?s.features[y].bbox:Fn?s.bbox:void 0,Oe=An?s.features[y].id:Fn?s.id:void 0,vt=St?St.type==="GeometryCollection":!1,Ot=vt?St.geometries.length:1,it=0;it<Ot;it++){if(dt=vt?St.geometries[it]:St,dt===null){if(f(null,sn,jt,be,Oe)===!1)return!1;continue}switch(dt.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(f(dt,sn,jt,be,Oe)===!1)return!1;break}case"GeometryCollection":{for(k=0;k<dt.geometries.length;k++)if(f(dt.geometries[k],sn,jt,be,Oe)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}sn++}}function rn(s,f,y){var k=y;return $e(s,function(it,dt,Ot,St,vt){dt===0&&y===void 0?k=it:k=f(k,it,dt,Ot,St,vt)}),k}function gn(s,f){$e(s,function(y,k,it,dt,Ot){var St=y===null?null:y.type;switch(St){case null:case"Point":case"LineString":case"Polygon":return f(o(y,it,{bbox:dt,id:Ot}),k,0)===!1?!1:void 0}var vt;switch(St){case"MultiPoint":vt="Point";break;case"MultiLineString":vt="LineString";break;case"MultiPolygon":vt="Polygon";break}for(var jt=0;jt<y.coordinates.length;jt++){var be=y.coordinates[jt],Oe={type:vt,coordinates:be};if(f(o(Oe,it),k,jt)===!1)return!1}})}function nt(s,f,y){var k=y;return gn(s,function(it,dt,Ot){dt===0&&Ot===0&&y===void 0?k=it:k=f(k,it,dt,Ot)}),k}function Ln(s,f){gn(s,function(y,k,it){var dt=0;if(y.geometry){var Ot=y.geometry.type;if(!(Ot==="Point"||Ot==="MultiPoint")){var St,vt=0,jt=0,be=0;if(p(y,function(Oe,sn,An,Fn,Wn){if(St===void 0||k>vt||Fn>jt||Wn>be){St=Oe,vt=k,jt=Fn,be=Wn,dt=0;return}var mr=lineString([St,Oe],y.properties);if(f(mr,k,it,Wn,dt)===!1)return!1;dt++,St=Oe})===!1)return!1}}})}function rr(s,f,y){var k=y,it=!1;return Ln(s,function(dt,Ot,St,vt,jt){it===!1&&y===void 0?k=dt:k=f(k,dt,Ot,St,vt,jt),it=!0}),k}function tr(s,f){if(!s)throw new Error("geojson is required");gn(s,function(y,k,it){if(y.geometry!==null){var dt=y.geometry.type,Ot=y.geometry.coordinates;switch(dt){case"LineString":if(f(y,k,it,0,0)===!1)return!1;break;case"Polygon":for(var St=0;St<Ot.length;St++)if(f(lineString(Ot[St],y.properties),k,it,St)===!1)return!1;break}}})}function sr(s,f,y){var k=y;return tr(s,function(it,dt,Ot,St){dt===0&&y===void 0?k=it:k=f(k,it,dt,Ot,St)}),k}function Br(s,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var y=f.featureIndex||0,k=f.multiFeatureIndex||0,it=f.geometryIndex||0,dt=f.segmentIndex||0,Ot=f.properties,St;switch(s.type){case"FeatureCollection":y<0&&(y=s.features.length+y),Ot=Ot||s.features[y].properties,St=s.features[y].geometry;break;case"Feature":Ot=Ot||s.properties,St=s.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":St=s;break;default:throw new Error("geojson is invalid")}if(St===null)return null;var vt=St.coordinates;switch(St.type){case"Point":case"MultiPoint":return null;case"LineString":return dt<0&&(dt=vt.length+dt-1),lineString([vt[dt],vt[dt+1]],Ot,f);case"Polygon":return it<0&&(it=vt.length+it),dt<0&&(dt=vt[it].length+dt-1),lineString([vt[it][dt],vt[it][dt+1]],Ot,f);case"MultiLineString":return k<0&&(k=vt.length+k),dt<0&&(dt=vt[k].length+dt-1),lineString([vt[k][dt],vt[k][dt+1]],Ot,f);case"MultiPolygon":return k<0&&(k=vt.length+k),it<0&&(it=vt[k].length+it),dt<0&&(dt=vt[k][it].length-dt-1),lineString([vt[k][it][dt],vt[k][it][dt+1]],Ot,f)}throw new Error("geojson is invalid")}function fi(s,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var y=f.featureIndex||0,k=f.multiFeatureIndex||0,it=f.geometryIndex||0,dt=f.coordIndex||0,Ot=f.properties,St;switch(s.type){case"FeatureCollection":y<0&&(y=s.features.length+y),Ot=Ot||s.features[y].properties,St=s.features[y].geometry;break;case"Feature":Ot=Ot||s.properties,St=s.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":St=s;break;default:throw new Error("geojson is invalid")}if(St===null)return null;var vt=St.coordinates;switch(St.type){case"Point":return point(vt,Ot,f);case"MultiPoint":return k<0&&(k=vt.length+k),point(vt[k],Ot,f);case"LineString":return dt<0&&(dt=vt.length+dt),point(vt[dt],Ot,f);case"Polygon":return it<0&&(it=vt.length+it),dt<0&&(dt=vt[it].length+dt),point(vt[it][dt],Ot,f);case"MultiLineString":return k<0&&(k=vt.length+k),dt<0&&(dt=vt[k].length+dt),point(vt[k][dt],Ot,f);case"MultiPolygon":return k<0&&(k=vt.length+k),it<0&&(it=vt[k].length+it),dt<0&&(dt=vt[k][it].length-dt),point(vt[k][it][dt],Ot,f)}throw new Error("geojson is invalid")}var Yn=e(64939),Ui=e(38163),Wr=e.n(Ui);function Zt(s,f){return s.map(y=>y[f]*1)}function P(s){return s===void 0?!1:!Array.isArray(s)&&s.data!==void 0}function Y(s){return Array.isArray(s)?s.length===0?!1:!!P(s[0]):!1}function pt(s){return Array.isArray(s)?s.length===0||typeof s[0]=="number":!1}function Ct(s){const f=Object.isFrozen(s)?Yn.lodashUtil.cloneDeep(s):s;return Wr()(f,!0),f}function Et(s,f){return s||[[f[0],f[3]],[f[2],f[3]],[f[2],f[1]],[f[0],f[1]]]}var pe=Object.defineProperty,ae=Object.defineProperties,xe=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,en=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable,ye=(s,f,y)=>f in s?pe(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,ke=(s,f)=>{for(var y in f||(f={}))en.call(f,y)&&ye(s,y,f[y]);if(me)for(var y of me(f))se.call(f,y)&&ye(s,y,f[y]);return s},Rn=(s,f)=>ae(s,xe(f));function yn(s,f){const{x:y,y:k,x1:it,y1:dt,coordinates:Ot,geometry:St}=f,vt=[];if(!Array.isArray(s))return{dataArray:[]};if(St)return s.filter(jt=>jt[St]&&jt[St].type&&jt[St].coordinates&&jt[St].coordinates.length>0).forEach((jt,be)=>{const Oe=Ct(jt[St]);gn(Oe,sn=>{const An=J(sn),Fn=Rn(ke({},jt),{_id:be,coordinates:An});vt.push(Fn)})}),{dataArray:vt};for(let jt=0;jt<s.length;jt++){const be=s[jt];let Oe=[];if(Ot){let An="Polygon";Array.isArray(Ot[0])||(An="Point"),Array.isArray(Ot[0])&&!Array.isArray(Ot[0][0])&&(An="LineString"),Oe=Ct({type:An,coordinates:be[Ot]}).coordinates}else if(y&&k&&it&&dt){const An=[parseFloat(be[y]),parseFloat(be[k])],Fn=[parseFloat(be[it]),parseFloat(be[dt])];Oe=[An,Fn]}else y&&k&&(Oe=[parseFloat(be[y]),parseFloat(be[k])]);const sn=Rn(ke({},be),{_id:jt,coordinates:Oe});vt.push(sn)}return{dataArray:vt}}function _n(s,f){const y=(0,l.ue)(s);return yn(y,f)}var Cn=Object.defineProperty,or=Object.defineProperties,Tr=Object.getOwnPropertyDescriptors,Qn=Object.getOwnPropertySymbols,Sr=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable,Wt=(s,f,y)=>f in s?Cn(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Re=(s,f)=>{for(var y in f||(f={}))Sr.call(f,y)&&Wt(s,y,f[y]);if(Qn)for(var y of Qn(f))Lt.call(f,y)&&Wt(s,y,f[y]);return s},Ie=(s,f)=>or(s,Tr(f));function ar(s){const f=s.toString();let y=5381,k=f.length;for(;k;)y=y*33^f.charCodeAt(--k);return y>>>0}function gr(s,f){return f===void 0?null:typeof(s.properties[f]*1)=="number"?s.properties[f]*1:s.properties&&s.properties[f]?ar(s.properties[f]+"")%1000019:null}function xr(s,f){const y=[],k={};return s.features?(s.features=s.features.filter(it=>{const dt=it.geometry;return it!=null&&dt&&dt.type&&dt.coordinates&&dt.coordinates.length>0}),s=Ct(s),s.features.length===0?{dataArray:[],featureKeys:k}:(gn(s,(it,dt)=>{let Ot=gr(it,f==null?void 0:f.featureId);Ot===null&&(Ot=dt);const St=Ot,vt=J(it),jt=Ie(Re({},it.properties),{coordinates:vt,_id:St});y.push(jt)}),{dataArray:y,featureKeys:k})):(s.features=[],{dataArray:[]})}var Dr=e(22857),Qr=e(39341);function Hi(s,f){var y=[];if(s.type==="FeatureCollection")for(var k=0;k<s.features.length;k++)Oi(y,s.features[k],f,k);else s.type==="Feature"?Oi(y,s,f):Oi(y,{geometry:s},f);return y}function Oi(s,f,y,k){if(f.geometry){var it=f.geometry.coordinates,dt=f.geometry.type,Ot=Math.pow(y.tolerance/((1<<y.maxZoom)*y.extent),2),St=[],vt=f.id;if(y.promoteId?vt=f.properties[y.promoteId]:y.generateId&&(vt=k||0),dt==="Point")Ei(it,St);else if(dt==="MultiPoint")for(var jt=0;jt<it.length;jt++)Ei(it[jt],St);else if(dt==="LineString")Ji(it,St,Ot,!1);else if(dt==="MultiLineString")if(y.lineMetrics){for(jt=0;jt<it.length;jt++)St=[],Ji(it[jt],St,Ot,!1),s.push((0,Qr.Z)(vt,"LineString",St,f.properties));return}else Gi(it,St,Ot,!1);else if(dt==="Polygon")Gi(it,St,Ot,!0);else if(dt==="MultiPolygon")for(jt=0;jt<it.length;jt++){var be=[];Gi(it[jt],be,Ot,!0),St.push(be)}else if(dt==="GeometryCollection"){for(jt=0;jt<f.geometry.geometries.length;jt++)Oi(s,{id:vt,geometry:f.geometry.geometries[jt],properties:f.properties},y,k);return}else throw new Error("Input data is not a valid GeoJSON object.");s.push((0,Qr.Z)(vt,dt,St,f.properties))}}function Ei(s,f){f.push(so(s[0])),f.push(uo(s[1])),f.push(0)}function Ji(s,f,y,k){for(var it,dt,Ot=0,St=0;St<s.length;St++){var vt=so(s[St][0]),jt=uo(s[St][1]);f.push(vt),f.push(jt),f.push(0),St>0&&(k?Ot+=(it*jt-vt*dt)/2:Ot+=Math.sqrt(Math.pow(vt-it,2)+Math.pow(jt-dt,2))),it=vt,dt=jt}var be=f.length-3;f[2]=1,(0,Dr.Z)(f,0,be,y),f[be+2]=1,f.size=Math.abs(Ot),f.start=0,f.end=f.size}function Gi(s,f,y,k){for(var it=0;it<s.length;it++){var dt=[];Ji(s[it],dt,y,k),f.push(dt)}}function so(s){return s/360+.5}function uo(s){var f=Math.sin(s*Math.PI/180),y=.5-.25*Math.log((1+f)/(1-f))/Math.PI;return y<0?0:y>1?1:y}var kr=e(91780);function Zi(s,f){var y=f.buffer/f.extent,k=s,it=(0,kr.Z)(s,1,-1-y,y,0,-1,2,f),dt=(0,kr.Z)(s,1,1-y,2+y,0,-1,2,f);return(it||dt)&&(k=(0,kr.Z)(s,1,-y,1+y,0,-1,2,f)||[],it&&(k=Ni(it,1).concat(k)),dt&&(k=k.concat(Ni(dt,-1)))),k}function Ni(s,f){for(var y=[],k=0;k<s.length;k++){var it=s[k],dt=it.type,Ot;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")Ot=Jr(it.geometry,f);else if(dt==="MultiLineString"||dt==="Polygon"){Ot=[];for(var St=0;St<it.geometry.length;St++)Ot.push(Jr(it.geometry[St],f))}else if(dt==="MultiPolygon")for(Ot=[],St=0;St<it.geometry.length;St++){for(var vt=[],jt=0;jt<it.geometry[St].length;jt++)vt.push(Jr(it.geometry[St][jt],f));Ot.push(vt)}y.push((0,Qr.Z)(it.id,dt,Ot,it.tags))}return y}function Jr(s,f){var y=[];y.size=s.size,s.start!==void 0&&(y.start=s.start,y.end=s.end);for(var k=0;k<s.length;k+=3)y.push(s[k]+f,s[k+1],s[k+2]);return y}function di(s,f){if(s.transformed)return s;var y=1<<s.z,k=s.x,it=s.y,dt,Ot,St;for(dt=0;dt<s.features.length;dt++){var vt=s.features[dt],jt=vt.geometry,be=vt.type;if(vt.geometry=[],be===1)for(Ot=0;Ot<jt.length;Ot+=2)vt.geometry.push(Yi(jt[Ot],jt[Ot+1],f,y,k,it));else for(Ot=0;Ot<jt.length;Ot++){var Oe=[];for(St=0;St<jt[Ot].length;St+=2)Oe.push(Yi(jt[Ot][St],jt[Ot][St+1],f,y,k,it));vt.geometry.push(Oe)}}return s.transformed=!0,s}function Yi(s,f,y,k,it,dt){return[Math.round(y*(s*k-it)),Math.round(y*(f*k-dt))]}function si(s,f,y,k,it){for(var dt=f===it.maxZoom?0:it.tolerance/((1<<f)*it.extent),Ot={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:y,y:k,z:f,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},St=0;St<s.length;St++){Ot.numFeatures++,lo(Ot,s[St],dt,it);var vt=s[St].minX,jt=s[St].minY,be=s[St].maxX,Oe=s[St].maxY;vt<Ot.minX&&(Ot.minX=vt),jt<Ot.minY&&(Ot.minY=jt),be>Ot.maxX&&(Ot.maxX=be),Oe>Ot.maxY&&(Ot.maxY=Oe)}return Ot}function lo(s,f,y,k){var it=f.geometry,dt=f.type,Ot=[];if(dt==="Point"||dt==="MultiPoint")for(var St=0;St<it.length;St+=3)Ot.push(it[St]),Ot.push(it[St+1]),s.numPoints++,s.numSimplified++;else if(dt==="LineString")Ii(Ot,it,s,y,!1,!1);else if(dt==="MultiLineString"||dt==="Polygon")for(St=0;St<it.length;St++)Ii(Ot,it[St],s,y,dt==="Polygon",St===0);else if(dt==="MultiPolygon")for(var vt=0;vt<it.length;vt++){var jt=it[vt];for(St=0;St<jt.length;St++)Ii(Ot,jt[St],s,y,!0,St===0)}if(Ot.length){var be=f.tags||null;if(dt==="LineString"&&k.lineMetrics){be={};for(var Oe in f.tags)be[Oe]=f.tags[Oe];be.mapbox_clip_start=it.start/it.size,be.mapbox_clip_end=it.end/it.size}var sn={geometry:Ot,type:dt==="Polygon"||dt==="MultiPolygon"?3:dt==="LineString"||dt==="MultiLineString"?2:1,tags:be};f.id!==null&&(sn.id=f.id),s.features.push(sn)}}function Ii(s,f,y,k,it,dt){var Ot=k*k;if(k>0&&f.size<(it?Ot:k)){y.numPoints+=f.length/3;return}for(var St=[],vt=0;vt<f.length;vt+=3)(k===0||f[vt+2]>Ot)&&(y.numSimplified++,St.push(f[vt]),St.push(f[vt+1])),y.numPoints++;it&&co(St,dt),s.push(St)}function co(s,f){for(var y=0,k=0,it=s.length,dt=it-2;k<it;dt=k,k+=2)y+=(s[k]-s[dt])*(s[k+1]+s[dt+1]);if(y>0===f)for(k=0,it=s.length;k<it/2;k+=2){var Ot=s[k],St=s[k+1];s[k]=s[it-2-k],s[k+1]=s[it-1-k],s[it-2-k]=Ot,s[it-1-k]=St}}function Oo(s,f){return new Ki(s,f)}function Ki(s,f){f=this.options=hi(Object.create(this.options),f);var y=f.debug;if(y&&console.time("preprocess data"),f.maxZoom<0||f.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(f.promoteId&&f.generateId)throw new Error("promoteId and generateId cannot be used together.");var k=Hi(s,f);this.tiles={},this.tileCoords=[],y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",f.indexMaxZoom,f.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),k=Zi(k,f),k.length&&this.splitTile(k,0,0,0),y&&(k.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Ki.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ki.prototype.splitTile=function(s,f,y,k,it,dt,Ot){for(var St=[s,f,y,k],vt=this.options,jt=vt.debug;St.length;){k=St.pop(),y=St.pop(),f=St.pop(),s=St.pop();var be=1<<f,Oe=bn(f,y,k),sn=this.tiles[Oe];if(!sn&&(jt>1&&console.time("creation"),sn=this.tiles[Oe]=si(s,f,y,k,vt),this.tileCoords.push({z:f,x:y,y:k}),jt)){jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",f,y,k,sn.numFeatures,sn.numPoints,sn.numSimplified),console.timeEnd("creation"));var An="z"+f;this.stats[An]=(this.stats[An]||0)+1,this.total++}if(sn.source=s,it){if(f===vt.maxZoom||f===it)continue;var Fn=1<<it-f;if(y!==Math.floor(dt/Fn)||k!==Math.floor(Ot/Fn))continue}else if(f===vt.indexMaxZoom||sn.numPoints<=vt.indexMaxPoints)continue;if(sn.source=null,s.length!==0){jt>1&&console.time("clipping");var Wn=.5*vt.buffer/vt.extent,mr=.5-Wn,er=.5+Wn,fr=1+Wn,ir,lr,Cr,yi,Ai,ki;ir=lr=Cr=yi=null,Ai=(0,kr.Z)(s,be,y-Wn,y+er,0,sn.minX,sn.maxX,vt),ki=(0,kr.Z)(s,be,y+mr,y+fr,0,sn.minX,sn.maxX,vt),s=null,Ai&&(ir=(0,kr.Z)(Ai,be,k-Wn,k+er,1,sn.minY,sn.maxY,vt),lr=(0,kr.Z)(Ai,be,k+mr,k+fr,1,sn.minY,sn.maxY,vt),Ai=null),ki&&(Cr=(0,kr.Z)(ki,be,k-Wn,k+er,1,sn.minY,sn.maxY,vt),yi=(0,kr.Z)(ki,be,k+mr,k+fr,1,sn.minY,sn.maxY,vt),ki=null),jt>1&&console.timeEnd("clipping"),St.push(ir||[],f+1,y*2,k*2),St.push(lr||[],f+1,y*2,k*2+1),St.push(Cr||[],f+1,y*2+1,k*2),St.push(yi||[],f+1,y*2+1,k*2+1)}}},Ki.prototype.getTile=function(s,f,y){var k=this.options,it=k.extent,dt=k.debug;if(s<0||s>24)return null;var Ot=1<<s;f=(f%Ot+Ot)%Ot;var St=bn(s,f,y);if(this.tiles[St])return di(this.tiles[St],it);dt>1&&console.log("drilling down to z%d-%d-%d",s,f,y);for(var vt=s,jt=f,be=y,Oe;!Oe&&vt>0;)vt--,jt=Math.floor(jt/2),be=Math.floor(be/2),Oe=this.tiles[bn(vt,jt,be)];return!Oe||!Oe.source?null:(dt>1&&console.log("found parent tile z%d-%d-%d",vt,jt,be),dt>1&&console.time("drilling down"),this.splitTile(Oe.source,vt,jt,be,s,f,y),dt>1&&console.timeEnd("drilling down"),this.tiles[St]?di(this.tiles[St],it):null)};function bn(s,f,y){return((1<<s)*y+f)*32+s}function hi(s,f){for(var y in f)s[y]=f[y];return s}var Ti=class{constructor(s,f,y,k){this.vectorLayerCache={},this.x=f,this.y=y,this.z=k,this.vectorTile=s}getTileData(s){return!s||!this.vectorTile.layers[s]?[]:this.vectorLayerCache[s]?this.vectorLayerCache[s]:this.vectorTile.layers[s].features}getFeatureById(){throw new Error("Method not implemented.")}},Lr=Object.defineProperty,ur=Object.defineProperties,pr=Object.getOwnPropertyDescriptors,ti=Object.getOwnPropertySymbols,fo=Object.prototype.hasOwnProperty,Fi=Object.prototype.propertyIsEnumerable,qi=(s,f,y)=>f in s?Lr(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,zi=(s,f)=>{for(var y in f||(f={}))fo.call(f,y)&&qi(s,y,f[y]);if(ti)for(var y of ti(f))Fi.call(f,y)&&qi(s,y,f[y]);return s},to=(s,f)=>ur(s,pr(f)),Pr=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),br={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Or(s){let f=0;for(let y=0,k=s.length,it=k-1,dt,Ot;y<k;it=y++)dt=s[y],Ot=s[it],f+=(Ot.x-dt.x)*(dt.y+Ot.y);return f}function Bi(s){const f=s.length;if(f<=1)return[s];const y=[];let k,it;for(let dt=0;dt<f;dt++){const Ot=Or(s[dt]);Ot!==0&&(it===void 0&&(it=Ot<0),it===Ot<0?(k&&y.push(k),k=[s[dt]]):k.push(s[dt]))}return k&&y.push(k),y}var ho=["Unknown","Point","LineString","Polygon"];function hn(s,f,y,k,it){let dt=it.geometry;const Ot=it.type,St=it.tags,vt=it.id,jt=s*Math.pow(2,k),be=s*f,Oe=s*y;let sn=ho[Ot],An,Fn;function Wn(er){for(let fr=0;fr<er.length;fr++){const ir=er[fr];if(ir[3])break;const lr=180-(ir[1]+Oe)*360/jt,Cr=(ir[0]+be)*360/jt-180,yi=360/Math.PI*Math.atan(Math.exp(lr*Math.PI/180))-90;er[fr]=[Cr,yi,0,1]}}switch(Ot){case 1:const er=[];for(An=0;An<dt.length;An++)er[An]=dt[An][0];dt=er,Wn(dt);break;case 2:for(An=0;An<dt.length;An++)Wn(dt[An]);break;case 3:for(dt=Bi(dt),An=0;An<dt.length;An++)for(Fn=0;Fn<dt[An].length;Fn++)Wn(dt[An][Fn]);break}return dt.length===1?dt=dt[0]:sn="Multi"+sn,{type:"Feature",geometry:{type:sn,coordinates:dt},properties:St,id:vt,tileOrigin:[0,0],coord:""}}var zn=(s,f,y,k)=>Pr(void 0,null,function*(){return new Promise(it=>{const dt=f.getTile(s.z,s.x,s.y),St={layers:{defaultLayer:{features:dt?dt.features.map(jt=>hn(k,y.x,y.y,y.z,jt)):[]}}},vt=new Ti(St,s.x,s.y,s.z);it(vt)})});function jn(s){const f={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return s===void 0||typeof s.geojsonvtOptions>"u"?f:zi(zi({},f),s.geojsonvtOptions)}function Xe(s,f){const y=jn(f),k=y.extent||4096,it=Oo(s,y),dt=(St,vt)=>zn(vt,it,St,k),Ot=to(zi(zi({},br),f),{getTileData:dt});return{data:s,dataArray:[],tilesetOptions:Ot,isTile:!0}}var q=Object.defineProperty,At=Object.defineProperties,Yt=Object.getOwnPropertyDescriptors,Mt=Object.getOwnPropertySymbols,Dt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable,te=(s,f,y)=>f in s?q(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Qt=(s,f)=>{for(var y in f||(f={}))Dt.call(f,y)&&te(s,y,f[y]);if(Mt)for(var y of Mt(f))$t.call(f,y)&&te(s,y,f[y]);return s},ve=(s,f)=>At(s,Yt(f));function le(s,f){const{extent:y=[121.168,30.2828,121.384,30.4219],coordinates:k,requestParameters:it={}}=f,dt=new Promise(vt=>{s instanceof HTMLImageElement||(0,Yn.fg)(s)?vt([s]):Ke(s,it,jt=>{vt(jt)})}),Ot=Et(k,y);return{originData:s,images:dt,_id:1,dataArray:[{_id:0,coordinates:Ot}]}}function Ke(s,f,y){const k=[];if(typeof s=="string")(0,Yn.gJ)(ve(Qt({},f),{url:s}),(it,dt)=>{dt&&(k.push(dt),y(k))});else{const it=s.length;let dt=0;s.forEach(Ot=>{(0,Yn.gJ)(ve(Qt({},f),{url:Ot}),(St,vt)=>{dt++,vt&&k.push(vt),dt===it&&y(k)})})}return le}var ln=Object.defineProperty,an=Object.defineProperties,Tn=Object.getOwnPropertyDescriptors,Nr=Object.getOwnPropertySymbols,yr=Object.prototype.hasOwnProperty,Mr=Object.prototype.propertyIsEnumerable,Li=(s,f,y)=>f in s?ln(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,ei=(s,f)=>{for(var y in f||(f={}))yr.call(f,y)&&Li(s,y,f[y]);if(Nr)for(var y of Nr(f))Mr.call(f,y)&&Li(s,y,f[y]);return s},pi=(s,f)=>an(s,Tn(f)),wr=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),Si=(s,f,y,k)=>wr(void 0,null,function*(){const it={x:f.x,y:f.y,z:f.z},dt=(0,Yn.z0)(s,it);return new Promise(Ot=>{k?k(it,(St,vt)=>{if(St||!vt){const jt={layers:{defaultLayer:{features:[]}}},be=new Ti(jt,f.x,f.y,f.z);Ot(be)}else{const jt={layers:{defaultLayer:{features:vt.features}}},be=new Ti(jt,f.x,f.y,f.z);Ot(be)}}):(0,Yn.Yu)(pi(ei({},y),{url:dt}),(St,vt)=>{if(St||!vt){const jt={layers:{defaultLayer:{features:[]}}},be=new Ti(jt,f.x,f.y,f.z);Ot(be)}else{const be={layers:{defaultLayer:{features:JSON.parse(vt)}}},Oe=new Ti(be,f.x,f.y,f.z);Ot(Oe)}})})});function Mi(s,f){const y=(it,dt)=>Si(s,dt,f==null?void 0:f.requestParameters,f.getCustomData),k=pi(ei({},f),{getTileData:y});return{dataArray:[],tilesetOptions:k,isTile:!0}}var Pn=e(38929),Kr=e(3614),ni=e.n(Kr),Fr=Object.defineProperty,xi=Object.defineProperties,ui=Object.getOwnPropertyDescriptors,ri=Object.getOwnPropertySymbols,Ka=Object.prototype.hasOwnProperty,po=Object.prototype.propertyIsEnumerable,Vo=(s,f,y)=>f in s?Fr(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,ba=(s,f)=>{for(var y in f||(f={}))Ka.call(f,y)&&Vo(s,y,f[y]);if(ri)for(var y of ri(f))po.call(f,y)&&Vo(s,y,f[y]);return s},Ur=(s,f)=>xi(s,ui(f)),Oa=class{constructor(s,f,y,k){this.vectorLayerCache={},this.x=f,this.y=y,this.z=k,this.vectorTile=new Pn.VectorTile(new(ni())(s))}getTileData(s){if(!s||!this.vectorTile.layers[s])return[];if(this.vectorLayerCache[s])return this.vectorLayerCache[s];const f=this.vectorTile.layers[s];if(Array.isArray(f.features))return this.vectorLayerCache[s]=f.features,f.features;const y=[];for(let k=0;k<f.length;k++){const dt=f.feature(k).toGeoJSON(this.x,this.y,this.z);y.push(Ur(ba({},dt),{properties:ba({id:dt.id},dt.properties)}))}return this.vectorLayerCache[s]=y,y}getFeatureById(){throw new Error("Method not implemented.")}},vo=Object.defineProperty,Na=Object.defineProperties,mo=Object.getOwnPropertyDescriptors,la=Object.getOwnPropertySymbols,eo=Object.prototype.hasOwnProperty,ca=Object.prototype.propertyIsEnumerable,Ia=(s,f,y)=>f in s?vo(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,fa=(s,f)=>{for(var y in f||(f={}))eo.call(f,y)&&Ia(s,y,f[y]);if(la)for(var y of la(f))ca.call(f,y)&&Ia(s,y,f[y]);return s},da=(s,f)=>Na(s,mo(f)),Fa=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),qa={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},ts=(s,f,y,k,it)=>Fa(void 0,null,function*(){const dt=(0,Yn.z0)(s,f);return new Promise(Ot=>{if(it)it({x:y.x,y:y.y,z:y.z},(St,vt)=>{if(St||!vt)Ot(void 0);else{const jt=new Oa(vt,y.x,y.y,y.z);Ot(jt)}});else{const St=(0,Yn.ks)(da(fa({},k),{url:dt}),(vt,jt)=>{if(vt||!jt)Ot(void 0);else{const be=new Oa(jt,y.x,y.y,y.z);Ot(be)}});y.xhrCancel=()=>St.cancel()}})});function dr(s,f){const y=Array.isArray(s)?s[0]:s,k=(dt,Ot)=>ts(y,dt,Ot,f==null?void 0:f.requestParameters,f==null?void 0:f.getCustomData),it=da(fa(fa({},qa),f),{getTileData:k});return{data:y,dataArray:[],tilesetOptions:it,isTile:!0}}function Ar(s,f,y){switch(s){case"+":return f+y;case"-":return f-y;case"*":return f*y;case"/":return f/y;case"%":return f%y;case"^":return Math.pow(f,y);case"abs":return Math.abs(f);case"floor":return Math.floor(f);case"round":return Math.round(f);case"ceil":return Math.ceil(f);case"sin":return Math.sin(f);case"cos":return Math.cos(f);case"atan":return y===-1?Math.atan(f):Math.atan2(f,y);case"min":return Math.min(f,y);case"max":return Math.max(f,y);case"log10":return Math.log(f);case"log2":return Math.log2(f);default:return console.warn("Calculate symbol err! Return default 0"),0}}function wi(s,f){const{width:y,height:k}=f[0],it=f.map(vt=>vt.rasterData),dt=y*k,Ot=[],St=JSON.stringify(s);for(let vt=0;vt<dt;vt++){const jt=JSON.parse(St),be=No(jt,it,vt);if(typeof be=="number")Ot.push(be);else{const Oe=mi(jt);Ot.push(Oe)}}return Ot}function No(s,f,y){if(s.length===2&&s[0]==="band"&&typeof s[1]=="number")try{return f[s[1]][y]}catch(k){return console.warn("Raster Data err!"),0}s.map((k,it)=>{if(Array.isArray(k)&&k.length>0)switch(k[0]){case"band":try{s[it]=f[k[1]][y]}catch(dt){console.warn("Raster Data err!"),s[it]=0}break;default:No(k,f,y)}})}function vi(s){const[f,y=-1,k=-1]=s;return f===void 0?(console.warn("Express err!"),["+",0,0]):[f.replace(/\s+/g,""),y,k]}function mi(s){const f=vi(s),y=f[0];let k=f[1],it=f[2];return Array.isArray(k)&&(k=mi(s[1])),Array.isArray(it)&&(it=mi(s[2])),Ar(y,k,it)}var $i={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:no}};function no(s,f){const y=s[0].rasterData,k=s[1].rasterData,it=s[2].rasterData,dt=[],[Ot,St]=(f==null?void 0:f.countCut)||[2,98],vt=(f==null?void 0:f.RMinMax)||Ri(y,Ot,St),jt=(f==null?void 0:f.GMinMax)||Ri(k,Ot,St),be=(f==null?void 0:f.BMinMax)||Ri(it,Ot,St);for(let Oe=0;Oe<y.length;Oe++)dt.push(Math.max(0,y[Oe]-vt[0])),dt.push(Math.max(0,k[Oe]-jt[0])),dt.push(Math.max(0,it[Oe]-be[0]));return{rasterData:dt,rMinMax:vt,gMinMax:jt,bMinMax:be}}function Ri(s,f,y){const k=s.slice().sort((St,vt)=>St-vt),it=k.length,dt=k[Math.ceil(it*f/100)],Ot=k[Math.ceil(it*y/100)];return[dt,Ot]}var ko=Object.defineProperty,Io=Object.defineProperties,ji=Object.getOwnPropertyDescriptors,go=Object.getOwnPropertySymbols,ha=Object.prototype.hasOwnProperty,Fo=Object.prototype.propertyIsEnumerable,yo=(s,f,y)=>f in s?ko(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Xo=(s,f)=>{for(var y in f||(f={}))ha.call(f,y)&&yo(s,y,f[y]);if(go)for(var y of go(f))Fo.call(f,y)&&yo(s,y,f[y]);return s},es=(s,f)=>Io(s,ji(f)),Ao=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())});function Bo(s,f,y){return Ao(this,null,function*(){if(s.length===0)return{rasterData:[0],width:1,heigh:1};const k=yield Promise.all(s.map(({data:vt,bands:jt=[0]})=>f(vt,jt))),it=[];k.forEach(vt=>{Array.isArray(vt)?it.push(...vt):it.push(vt)});const{width:dt,height:Ot}=it[0];let St;switch(typeof y){case"function":St=y(it);break;case"object":Array.isArray(y)?St={rasterData:wi(y,it)}:St=Ho(y,it);break;default:St={rasterData:it[0].rasterData}}return es(Xo({},St),{width:dt,height:Ot})})}function Ho(s,f){const y=$i[s.type];if(y.type==="function")return y.method(f,s==null?void 0:s.options);if(y.type==="operation")return s.type==="rgb"?pa(y.expression,f):{rasterData:wi(y.expression,f)}}function pa(s,f){s.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),s.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),s.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const y=wi(s.r||["band",0],f),k=wi(s.g||["band",0],f),it=wi(s.b||["band",0],f);return[y,k,it]}function Eo(s,f,y,k){return Ao(this,null,function*(){const it=yield Bo(s,f,y);k(null,{data:it})})}function vr(s,f){const{extent:y=[121.168,30.2828,121.384,30.4219],coordinates:k,width:it,height:dt,min:Ot,max:St,format:vt,operation:jt}=f;let be,Oe,sn;if(vt===void 0||pt(s))be=Array.from(s),Oe=it,sn=dt;else{const Wn=Array.isArray(s)?s:[s];be=Bo(Wn,vt,jt)}const An=Et(k,y);return{_id:1,dataArray:[{_id:1,data:be,width:Oe,height:sn,min:Ot,max:St,coordinates:An}]}}var ii=e(71590),Go=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),Lo=(s,f,y,k)=>Go(void 0,null,function*(){return new Promise((it,dt)=>{f({x:s.x,y:s.y,z:s.z},(Ot,St)=>{if(Ot||St.length===0){dt(Ot);return}St&&Eo([{data:St,bands:[0]}],y,k,(vt,jt)=>{vt?dt(vt):jt&&it(jt)})})})}),va=(s,f)=>Go(void 0,null,function*(){return new Promise((y,k)=>{f({x:s.x,y:s.y,z:s.z},(it,dt)=>{if(it||!dt){k(it);return}dt instanceof ArrayBuffer?(0,Yn.Co)(dt,(Ot,St)=>{Ot&&k(Ot),y(St)}):dt instanceof HTMLImageElement?y(dt):k(it)})})});function Ba(s,f){return Array.isArray(s)?typeof s[0]=="string"?s.map(y=>(0,Yn.z0)(y,f)):s.map(y=>({url:(0,Yn.z0)(y.url,f),bands:y.bands||[0]})):(0,Yn.z0)(s,f)}function La(s){return typeof s=="string"?[{url:s,bands:[0]}]:typeof s[0]=="string"?s.map(f=>({url:f,bands:[0]})):s}function Mo(s,f){s.xhrCancel=()=>{f.map(y=>{y.abort()})}}var ma=Object.defineProperty,Ma=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,ga=Object.getOwnPropertySymbols,wa=Object.prototype.hasOwnProperty,To=Object.prototype.propertyIsEnumerable,Yo=(s,f,y)=>f in s?ma(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,$o=(s,f)=>{for(var y in f||(f={}))wa.call(f,y)&&Yo(s,y,f[y]);if(ga)for(var y of ga(f))To.call(f,y)&&Yo(s,y,f[y]);return s},So=(s,f)=>Ma(s,ro(f)),_a=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),Da=(s,f,y,k,it)=>_a(void 0,null,function*(){const dt=La(f.url);if(dt.length>1){const{rasterFiles:Ot,xhrList:St,errList:vt}=yield ns(dt,f);if(Mo(s,St),vt.length>0){y(vt,null);return}Eo(Ot,k,it,y)}else{const Ot=(0,Yn.ks)(f,(St,vt)=>{if(St)y(St);else if(vt){const jt=[{data:vt,bands:dt[0].bands}];Eo(jt,k,it,y)}});Mo(s,[Ot])}});function ns(s,f){return _a(this,null,function*(){const y=[],k=[],it=[];for(let dt=0;dt<s.length;dt++){const Ot=s[dt],St=So($o({},f),{url:Ot.url}),vt=Ot.bands,{err:jt,data:be,xhr:Oe}=yield(0,Yn.LF)(So($o({},St),{type:"arrayBuffer"}));jt&&it.push(jt),k.push(Oe),y.push({data:be,bands:vt})}return{rasterFiles:y,xhrList:k,errList:it}})}var Wo=Object.defineProperty,Pa=Object.defineProperties,rs=Object.getOwnPropertyDescriptors,Ua=Object.getOwnPropertySymbols,ya=Object.prototype.hasOwnProperty,Qo=Object.prototype.propertyIsEnumerable,Vi=(s,f,y)=>f in s?Wo(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,wo=(s,f)=>{for(var y in f||(f={}))ya.call(f,y)&&Vi(s,y,f[y]);if(Ua)for(var y of Ua(f))Qo.call(f,y)&&Vi(s,y,f[y]);return s},Aa=(s,f)=>Pa(s,rs(f)),Jo=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),is=(s,f,y,k)=>Jo(void 0,null,function*(){const{format:it=Za,operation:dt,requestParameters:Ot={}}=k,St=Aa(wo({},Ot),{url:Ba(s,f)});return new Promise((vt,jt)=>{Da(y,St,(be,Oe)=>{be?jt(be):Oe&&vt(Oe)},it,dt)})}),_o=(s,f,y,k)=>Jo(void 0,null,function*(){let it;const dt=Array.isArray(s)?s[0]:s;return k.wmtsOptions?it=((k==null?void 0:k.getURLFromTemplate)||Yn.jG)(dt,wo(wo({},f),k.wmtsOptions)):it=((k==null?void 0:k.getURLFromTemplate)||Yn.z0)(dt,f),new Promise((Ot,St)=>{var vt;const jt=(0,Yn.gJ)(Aa(wo({},k==null?void 0:k.requestParameters),{url:it,type:((vt=k==null?void 0:k.requestParameters)==null?void 0:vt.type)||"arrayBuffer"}),(be,Oe)=>{be?St(be):Oe&&Ot(Oe)},k.transformResponse);y.xhrCancel=()=>jt.cancel()})}),Za=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),za=Object.defineProperty,os=Object.defineProperties,ja=Object.getOwnPropertyDescriptors,gi=Object.getOwnPropertySymbols,as=Object.prototype.hasOwnProperty,ss=Object.prototype.propertyIsEnumerable,Ko=(s,f,y)=>f in s?za(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Do=(s,f)=>{for(var y in f||(f={}))as.call(f,y)&&Ko(s,y,f[y]);if(gi)for(var y of gi(f))ss.call(f,y)&&Ko(s,y,f[y]);return s},us=(s,f)=>os(s,ja(f)),Po={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Ci=[ii.n3.ARRAYBUFFER,ii.n3.RGB];function xo(s){return!!(Array.isArray(s)&&s.length===0||!Array.isArray(s)&&typeof s!="string")}function Ea(s,f={}){if(xo(s))throw new Error("tile server url is error");let y=(f==null?void 0:f.dataType)||ii.n3.IMAGE;y===ii.n3.RGB&&(y=ii.n3.ARRAYBUFFER);const k=(dt,Ot)=>{switch(y){case ii.n3.IMAGE:return _o(s,dt,Ot,f);case ii.n3.CUSTOMIMAGE:case ii.n3.CUSTOMTERRAINRGB:return va(Ot,f==null?void 0:f.getCustomData);case ii.n3.ARRAYBUFFER:return is(s,dt,Ot,f);case ii.n3.CUSTOMARRAYBUFFER:case ii.n3.CUSTOMRGB:return Lo(Ot,f==null?void 0:f.getCustomData,(f==null?void 0:f.format)||Za,f==null?void 0:f.operation);default:return _o(s,dt,Ot,f)}},it=us(Do(Do({},Po),f),{getTileData:k});return{data:s,dataArray:[],tilesetOptions:it,isTile:!0}}var Va=Object.defineProperty,ka=Object.defineProperties,Uo=Object.getOwnPropertyDescriptors,Zo=Object.getOwnPropertySymbols,Ta=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable,t=(s,f,y)=>f in s?Va(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,n=(s,f)=>{for(var y in f||(f={}))Ta.call(f,y)&&t(s,y,f[y]);if(Zo)for(var y of Zo(f))Xa.call(f,y)&&t(s,y,f[y]);return s},v=(s,f)=>ka(s,Uo(f)),x=(s,f)=>{var y={};for(var k in s)Ta.call(s,k)&&f.indexOf(k)<0&&(y[k]=s[k]);if(s!=null&&Zo)for(var k of Zo(s))f.indexOf(k)<0&&Xa.call(s,k)&&(y[k]=s[k]);return y};function $(s,f){const y=f,{extent:k=[121.168,30.2828,121.384,30.4219],coordinates:it,width:dt,height:Ot}=y,St=x(y,["extent","coordinates","width","height"]);s.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[vt,jt]=St.bands||[0,1],be=[s[vt],s[jt]],Oe=[];for(let Fn=0;Fn<be[0].length;Fn++)Oe.push((be[1][Fn]-be[0][Fn])/(be[1][Fn]+be[0][Fn]));const sn=Et(it,k);return{_id:1,dataArray:[v(n({_id:1,data:Oe,width:dt,height:Ot},St),{coordinates:sn})]}}var z=Object.defineProperty,et=Object.defineProperties,ht=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,wt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable,Vt=(s,f,y)=>f in s?z(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,de=(s,f)=>{for(var y in f||(f={}))wt.call(f,y)&&Vt(s,y,f[y]);if(mt)for(var y of mt(f))zt.call(f,y)&&Vt(s,y,f[y]);return s},Pe=(s,f)=>et(s,ht(f)),Qe=(s,f)=>{var y={};for(var k in s)wt.call(s,k)&&f.indexOf(k)<0&&(y[k]=s[k]);if(s!=null&&mt)for(var k of mt(s))f.indexOf(k)<0&&zt.call(s,k)&&(y[k]=s[k]);return y};function un(s,f){const y=f,{extent:k,coordinates:it,width:dt,height:Ot}=y,St=Qe(y,["extent","coordinates","width","height"]);s.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[vt,jt,be]=St.bands||[0,1,2],Oe=[s[vt],s[jt],s[be]],sn=[],[An,Fn]=(St==null?void 0:St.countCut)||[2,98],Wn=(St==null?void 0:St.RMinMax)||Ri(Oe[0],An,Fn),mr=(St==null?void 0:St.GMinMax)||Ri(Oe[1],An,Fn),er=(St==null?void 0:St.BMinMax)||Ri(Oe[2],An,Fn);for(let lr=0;lr<Oe[0].length;lr++)sn.push(Math.max(0,Oe[0][lr]-Wn[0])),sn.push(Math.max(0,Oe[1][lr]-mr[0])),sn.push(Math.max(0,Oe[2][lr]-er[0]));const fr=Et(it,k);return{_id:1,dataArray:[Pe(de({_id:1,data:sn,width:dt,height:Ot,rMinMax:Wn,gMinMax:mr,bMinMax:er},St),{coordinates:fr})]}}var fn=Object.defineProperty,xn=Object.defineProperties,on=Object.getOwnPropertyDescriptors,Vn=Object.getOwnPropertySymbols,Hn=Object.prototype.hasOwnProperty,cr=Object.prototype.propertyIsEnumerable,pn=(s,f,y)=>f in s?fn(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Je=(s,f)=>{for(var y in f||(f={}))Hn.call(f,y)&&pn(s,y,f[y]);if(Vn)for(var y of Vn(f))cr.call(f,y)&&pn(s,y,f[y]);return s},vn=(s,f)=>xn(s,on(f)),Jn=(s,f)=>{var y={};for(var k in s)Hn.call(s,k)&&f.indexOf(k)<0&&(y[k]=s[k]);if(s!=null&&Vn)for(var k of Vn(s))f.indexOf(k)<0&&cr.call(s,k)&&(y[k]=s[k]);return y};function Rr(s,f){const y=f,{extent:k,coordinates:it,min:dt,max:Ot,width:St,height:vt,format:jt,operation:be}=y,Oe=Jn(y,["extent","coordinates","min","max","width","height","format","operation"]);let sn;if(jt===void 0||pt(s))sn=Array.from(s);else{const Wn=Array.isArray(s)?s:[s];sn=Bo(Wn,jt,be)}const An=Et(it,k);return{_id:1,dataArray:[vn(Je({_id:1,data:sn,width:St,height:vt},Oe),{min:dt,max:Ot,coordinates:An})]}}var Ir=Object.defineProperty,oi=Object.defineProperties,bi=Object.getOwnPropertyDescriptors,Xr=Object.getOwnPropertySymbols,_i=Object.prototype.hasOwnProperty,io=Object.prototype.propertyIsEnumerable,Di=(s,f,y)=>f in s?Ir(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,qo=(s,f)=>{for(var y in f||(f={}))_i.call(f,y)&&Di(s,y,f[y]);if(Xr)for(var y of Xr(f))io.call(f,y)&&Di(s,y,f[y]);return s},oo=(s,f)=>oi(s,bi(f)),Ro=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),Ns={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Is=s=>Ro(void 0,null,function*(){return new Promise(f=>{const[y,k,it,dt]=s.bounds,Ot={layers:{testTile:{features:[{type:"Feature",properties:{key:s.x+"/"+s.y+"/"+s.z,x:(y+it)/2,y:(k+dt)/2},geometry:{type:"LineString",coordinates:[[it,dt],[it,k],[y,k],[y,k]]}}]}}};f(Ot)})});function Fs(s,f){const y=it=>Is(it),k=oo(qo(qo({},Ns),f),{getTileData:y});return{data:s,dataArray:[],tilesetOptions:k,isTile:!0}}var Bs=e(46343),Ls=e(26729),ou=e(69848),au=e.n(ou),su=Object.defineProperty,Ms=Object.getOwnPropertySymbols,uu=Object.prototype.hasOwnProperty,lu=Object.prototype.propertyIsEnumerable,ws=(s,f,y)=>f in s?su(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,ls=(s,f)=>{for(var y in f||(f={}))uu.call(f,y)&&ws(s,y,f[y]);if(Ms)for(var y of Ms(f))lu.call(f,y)&&ws(s,y,f[y]);return s};function cs(s,f){const{radius:y=40,maxZoom:k=18,minZoom:it=0,zoom:dt=2}=f;if(s.pointIndex){const vt=s.pointIndex.getClusters(s.extent,Math.floor(dt));return s.dataArray=cu(vt),s}const Ot=new(au())({radius:y,minZoom:it,maxZoom:k}),St={type:"FeatureCollection",features:[]};return St.features=s.dataArray.map(vt=>({type:"Feature",geometry:{type:"Point",coordinates:vt.coordinates},properties:ls({},vt)})),Ot.load(St.features),Ot}function cu(s){return s.map((f,y)=>ls({coordinates:f.geometry.coordinates,_id:y+1},f.properties))}function fu(s){if(s.length===0)throw new Error("max requires at least one data point");let f=s[0];for(let y=1;y<s.length;y++)s[y]>f&&(f=s[y]);return f}function fs(s){if(s.length===0)throw new Error("min requires at least one data point");let f=s[0];for(let y=1;y<s.length;y++)s[y]<f&&(f=s[y]);return f}function Sa(s){if(s.length===0)return 0;let f=s[0],y=0,k;for(let it=1;it<s.length;it++)k=f+s[it]*1,Math.abs(f)>=Math.abs(s[it])?y+=f-k+s[it]:y+=s[it]-k+f,f=k;return f+y*1}function du(s){if(s.length===0)throw new Error("mean requires at least one data point");return Sa(s)/s.length}var hu={min:fs,max:fu,mean:du,sum:Sa},pu=Object.defineProperty,_s=Object.getOwnPropertySymbols,vu=Object.prototype.hasOwnProperty,Ds=Object.prototype.propertyIsEnumerable,Ps=(s,f,y)=>f in s?pu(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,xa=(s,f)=>{for(var y in f||(f={}))vu.call(f,y)&&Ps(s,y,f[y]);if(_s)for(var y of _s(f))Ds.call(f,y)&&Ps(s,y,f[y]);return s},Us=(s,f,y)=>new Promise((k,it)=>{var dt=vt=>{try{St(y.next(vt))}catch(jt){it(jt)}},Ot=vt=>{try{St(y.throw(vt))}catch(jt){it(jt)}},St=vt=>vt.done?k(vt.value):Promise.resolve(vt.value).then(dt,Ot);St((y=y.apply(s,f)).next())}),{cloneDeep:mu,isFunction:Zs,isString:ta,mergeWith:gu}=Yn.lodashUtil;function yu(s,f){if(Array.isArray(f))return f}var zs=class extends Ls.EventEmitter{constructor(s,f){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new Bs.ni},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=s,this.initCfg(f),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(s){return this.clusterIndex.getClusters(this.caculClusterExtent(2),s)}getClustersLeaves(s){return this.clusterIndex.getLeaves(s,1/0)}getParserType(){return this.parser.type}updateClusterData(s){const{method:f="sum",field:y}=this.clusterOptions;let k=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(s));this.clusterOptions.zoom=s,k.forEach(it=>{it.id||(it.properties.point_count=1)}),(y||Zs(f))&&(k=k.map(it=>{const dt=it.id;if(dt){const St=this.clusterIndex.getLeaves(dt,1/0).map(jt=>jt.properties);let vt;if(ta(f)&&y){const jt=Zt(St,y);vt=hu[f](jt)}Zs(f)&&(vt=f(St)),it.properties.stat=vt}else it.properties.point_count=1;return it})),this.data=a("geojson")({type:"FeatureCollection",features:k}),this.executeTrans()}getFeatureById(s){const{type:f="geojson",geometry:y}=this.parser;if(f==="geojson"&&!this.cluster){const k=s<this.originData.features.length?this.originData.features[s]:"null",it=mu(k);if(it!=null&&it.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const dt=this.data.dataArray.find(Ot=>Ot._id===s);it.properties=dt}return it}else return f==="json"&&y?this.data.dataArray.find(k=>k._id===s):s<this.data.dataArray.length?this.data.dataArray[s]:"null"}updateFeaturePropertiesById(s,f){this.data.dataArray=this.data.dataArray.map(y=>y._id===s?xa(xa({},y),f):y),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(s,f){const y=this.data.dataArray.find(k=>k[s]===f);return y==null?void 0:y._id}setData(s,f){this.originData=s,this.dataArrayChanged=!1,this.initCfg(f),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var s;(s=this.tileset)==null||s.reloadAll()}reloadTilebyId(s,f,y){var k;(k=this.tileset)==null||k.reloadTileById(s,f,y)}reloadTileByLnglat(s,f,y){var k;(k=this.tileset)==null||k.reloadTileByLnglat(s,f,y)}getTileExtent(s,f){var y;return(y=this.tileset)==null?void 0:y.getTileExtent(s,f)}getTileByZXY(s,f,y){var k;return(k=this.tileset)==null?void 0:k.getTileByZXY(s,f,y)}reloadTileByExtent(s,f){var y;(y=this.tileset)==null||y.reloadTileByExtent(s,f)}destroy(){var s;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(s=this.tileset)==null||s.destroy()}processData(){return Us(this,null,function*(){return new Promise((s,f)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),s({})}catch(y){f(y)}})})}initCfg(s){this.cfg=gu(this.cfg,s,yu);const f=this.cfg;f&&(f.parser&&(this.parser=f.parser),f.transforms&&(this.transforms=f.transforms),this.cluster=f.cluster||!1,f.clusterOptions&&(this.cluster=!0,this.clusterOptions=xa(xa({},this.clusterOptions),f.clusterOptions)))}init(){return Us(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const s=this.parser,f=s.type||"geojson",y=a(f);this.data=y(this.originData,s),this.tileset=this.initTileset(),!s.cancelExtent&&(this.extent=(0,Yn.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(s){this.center=[(s[0]+s[2])/2,(s[1]+s[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:s}=this.data;return s?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(s),this.tileset):new Yn.nx(xa({},s))):void 0}executeTrans(){this.transforms.forEach(f=>{const{type:y}=f,k=d(y)(this.data,f);Object.assign(this.data,k)})}initCluster(){if(!this.cluster)return;const s=this.clusterOptions||{};this.clusterIndex=cs(this.data,s)}caculClusterExtent(s){let f=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(f=(0,Yn.yA)((0,Yn.ds)(this.extent),s)),f[0].concat(f[1])}};function ds(s,f){const{callback:y}=f;return y&&(s.dataArray=s.dataArray.filter(y)),s}var hs=6378e3;function js(s,f){const y=s.dataArray,{size:k=10}=f,it=k/(2*Math.PI*hs)*(256<<20)/2,{gridHash:dt,gridOffset:Ot}=Au(y,k),St=xu(dt,Ot,f);return{yOffset:it,xOffset:it,radius:it,type:"grid",dataArray:St}}function Au(s,f){let y=1/0,k=-1/0,it;for(const vt of s)it=vt.coordinates[1],Number.isFinite(it)&&(y=it<y?it:y,k=it>k?it:k);const dt=(y+k)/2,Ot=Eu(f,dt);if(Ot.xOffset<=0||Ot.yOffset<=0)return{gridHash:{},gridOffset:Ot};const St={};for(const vt of s){const jt=vt.coordinates[1],be=vt.coordinates[0];if(Number.isFinite(jt)&&Number.isFinite(be)){const Oe=Math.floor((jt+90)/Ot.yOffset),sn=Math.floor((be+180)/Ot.xOffset),An=`${Oe}-${sn}`;St[An]=St[An]||{count:0,points:[]},St[An].count+=1,St[An].points.push(vt)}}return{gridHash:St,gridOffset:Ot}}function Eu(s,f){const y=Tu(s),k=Su(f,s);return{yOffset:y,xOffset:k}}function Tu(s){return s/hs*(180/Math.PI)}function Su(s,f){return f/hs*(180/Math.PI)/Math.cos(s*Math.PI/180)}function xu(s,f,y){return Object.keys(s).reduce((k,it,dt)=>{const Ot=it.split("-"),St=parseInt(Ot[0],10),vt=parseInt(Ot[1],10),jt={};if(y.field&&y.method){const be=Yn.a5.getColumn(s[it].points,y.field);jt[y.method]=Yn.a5.statMap[y.method](be)}return Object.assign(jt,{_id:dt,coordinates:(0,Yn.Z)([-180+f.xOffset*(vt+.5),-90+f.yOffset*(St+.5)]),rawData:s[it].points,count:s[it].count}),k.push(jt),k},[])}var Wi=Math.PI/3,Ru=[0,Wi,2*Wi,3*Wi,4*Wi,5*Wi];function Ha(s){return s[0]}function Cu(s){return s[1]}function ea(){var s=0,f=0,y=1,k=1,it=Ha,dt=Cu,Ot,St,vt;function jt(Oe){var sn={},An=[],Fn,Wn=Oe.length;for(Fn=0;Fn<Wn;++Fn)if(!(isNaN(er=+it.call(null,mr=Oe[Fn],Fn,Oe))||isNaN(fr=+dt.call(null,mr,Fn,Oe)))){var mr,er,fr,ir=Math.round(fr=fr/vt),lr=Math.round(er=er/St-(ir&1)/2),Cr=fr-ir;if(Math.abs(Cr)*3>1){var yi=er-lr,Ai=lr+(er<lr?-1:1)/2,ki=ir+(fr<ir?-1:1),Ra=er-Ai,oa=fr-ki;yi*yi+Cr*Cr>Ra*Ra+oa*oa&&(lr=Ai+(ir&1?1:-1)/2,ir=ki)}var Ya=lr+"-"+ir,zo=sn[Ya];zo?zo.push(mr):(An.push(zo=sn[Ya]=[mr]),zo.x=(lr+(ir&1)/2)*St,zo.y=ir*vt)}return An}function be(Oe){var sn=0,An=0;return Ru.map(function(Fn){var Wn=Math.sin(Fn)*Oe,mr=-Math.cos(Fn)*Oe,er=Wn-sn,fr=mr-An;return sn=Wn,An=mr,[er,fr]})}return jt.hexagon=function(Oe){return"m"+be(Oe==null?Ot:+Oe).join("l")+"z"},jt.centers=function(){for(var Oe=[],sn=Math.round(f/vt),An=Math.round(s/St),Fn=sn*vt;Fn<k+Ot;Fn+=vt,++sn)for(var Wn=An*St+(sn&1)*St/2;Wn<y+St/2;Wn+=St)Oe.push([Wn,Fn]);return Oe},jt.mesh=function(){var Oe=be(Ot).slice(0,4).join("l");return jt.centers().map(function(sn){return"M"+sn+"m"+Oe}).join("")},jt.x=function(Oe){return arguments.length?(it=Oe,jt):it},jt.y=function(Oe){return arguments.length?(dt=Oe,jt):dt},jt.radius=function(Oe){return arguments.length?(Ot=+Oe,St=Ot*2*Math.sin(Wi),vt=Ot*1.5,jt):Ot},jt.size=function(Oe){return arguments.length?(s=f=0,y=+Oe[0],k=+Oe[1],jt):[y-s,k-f]},jt.extent=function(Oe){return arguments.length?(s=+Oe[0][0],f=+Oe[0][1],y=+Oe[1][0],k=+Oe[1][1],jt):[[s,f],[y,k]]},jt.radius(1)}var na=Object.defineProperty,bu=Object.defineProperties,ra=Object.getOwnPropertyDescriptors,ps=Object.getOwnPropertySymbols,ia=Object.prototype.hasOwnProperty,vs=Object.prototype.propertyIsEnumerable,ms=(s,f,y)=>f in s?na(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Vs=(s,f)=>{for(var y in f||(f={}))ia.call(f,y)&&ms(s,y,f[y]);if(ps)for(var y of ps(f))vs.call(f,y)&&ms(s,y,f[y]);return s},ks=(s,f)=>bu(s,ra(f)),Xs=6378e3;function gs(s,f){const y=s.dataArray,{size:k=10,method:it="sum"}=f,dt=k/(2*Math.PI*Xs)*(256<<20)/2,Ot=y.map(be=>{const[Oe,sn]=(0,Yn.Z)(be.coordinates);return ks(Vs({},be),{coordinates:[Oe,sn]})});return{dataArray:ea().radius(dt).x(be=>be.coordinates[0]).y(be=>be.coordinates[1])(Ot).map((be,Oe)=>{if(f.field&&it){const sn=Yn.a5.getColumn(be,f.field);be[it]=Yn.a5.statMap[it](sn)}return{[f.method]:be[it],count:be.length,rawData:be,coordinates:[be.x,be.y],_id:Oe}}),radius:dt,xOffset:dt,yOffset:dt,type:"hexagon"}}var Hs=Object.defineProperty,ys=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable,Ga=(s,f,y)=>f in s?Hs(s,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):s[f]=y,Es=(s,f)=>{for(var y in f||(f={}))Gs.call(f,y)&&Ga(s,y,f[y]);if(ys)for(var y of ys(f))As.call(f,y)&&Ga(s,y,f[y]);return s};function Ys(s,f){const{sourceField:y,targetField:k,data:it}=f,dt={};return it.forEach(Ot=>{dt[Ot[y]]=Ot}),s.dataArray=s.dataArray.map(Ot=>{const St=Ot[k];return Es(Es({},Ot),dt[St])}),s}function $s(s,f){const{callback:y}=f;return y&&(s.dataArray=s.dataArray.map(y)),s}var Ou=e(4771);c("rasterTile",Ea),c("mvt",dr),c("geojsonvt",Xe),c("testTile",Fs),c("geojson",xr),c("jsonTile",Mi),c("image",le),c("csv",_n),c("json",yn),c("raster",vr),c("rasterRgb",Rr),c("rgb",un),c("ndi",$),m("cluster",cs),m("filter",ds),m("join",Ys),m("map",$s),m("grid",js),m("hexagon",gs);var Ts=zs},4771:()=>{},84059:(Xt,K,e)=>{"use strict";e.r(K),e.d(K,{AJAXError:()=>l.Uj,AttributeType:()=>a.GC,BKDRHash:()=>l.e2,BaiduMap:()=>d.BaiduMap,BaseLayer:()=>c.zi,BaseMapService:()=>d.BaseMapService,BaseMapWrapper:()=>d.BaseMapWrapper,BaseModel:()=>c.gq,BasePostProcessingPass:()=>a.mp,BlendType:()=>a.h0,ButtonControl:()=>i.NA,CameraUniform:()=>a.lv,CanvasLayer:()=>c.mM,CanvasUpdateType:()=>c.Fy,CityBuildingLayer:()=>c.Rf,Control:()=>i.oT,CoordinateSystem:()=>a.lo,CoordinateUniform:()=>a.kw,DOM:()=>l.SO,Earth:()=>d.Earth,EarthLayer:()=>c.fJ,ExportImage:()=>i.dk,FrequencyController:()=>l.iH,Fullscreen:()=>i.iT,GaodeMap:()=>d.GaodeMap,GaodeMapV1:()=>d.GaodeMapV1,GaodeMapV2:()=>d.GaodeMapV2,GeoLocate:()=>i.v3,GeometryLayer:()=>c.VR,GoogleMap:()=>d.GoogleMap,HeatmapLayer:()=>c.zP,IDebugLog:()=>a.Or,ILayerStage:()=>a.KD,ImageLayer:()=>c.Q8,InteractionEvent:()=>a.sm,LRUCache:()=>l.z6,LayerPopup:()=>i.Kh,LayerSwitch:()=>i.F9,LineLayer:()=>c.Ie,LinearDir:()=>c.cA,LoadTileDataStatus:()=>l.Qj,Logo:()=>i.TR,Map:()=>d.Map,MapLibre:()=>d.MapLibre,MapServiceEvent:()=>a.I9,MapTheme:()=>i.Yq,Mapbox:()=>d.Mapbox,Marker:()=>i.Jx,MarkerLayer:()=>i.u7,MaskLayer:()=>c.$1,MaskOperation:()=>a.lE,MouseLocation:()=>i.A8,PassType:()=>a.GR,PointLayer:()=>c.ns,PolygonLayer:()=>c.dW,PopperControl:()=>i.p4,Popup:()=>i.GI,PositionType:()=>i.d,RasterLayer:()=>c.YY,RasterTileType:()=>a.n3,Satistics:()=>l.a5,Scale:()=>i.Ci,ScaleTypes:()=>a.vY,Scene:()=>m.x,SceneConifg:()=>l.SA,SceneEventList:()=>a.P7,SelectControl:()=>i.Yw,SizeUnitType:()=>c.xg,Source:()=>u.default,SourceTile:()=>l.LZ,StencilType:()=>a.yn,StyleScaleType:()=>a.ee,Swipe:()=>i.oF,TMap:()=>d.TMap,TencentMap:()=>d.TencentMap,TextureBlend:()=>c.qy,TextureUsage:()=>a.v2,TileDebugLayer:()=>c.sh,TileLayer:()=>c.Im,TilesetManager:()=>l.nx,UpdateTileStrategy:()=>l.dD,WindLayer:()=>c.vo,Zoom:()=>i.LG,aProjectFlat:()=>l.Z,amap2Project:()=>l.TG,amap2UnProject:()=>l.S8,anchorTranslate:()=>l.rQ,anchorType:()=>l.bV,applyAnchorClass:()=>l.zi,bBoxToBounds:()=>l.ds,bindAll:()=>l.Ev,boundsContains:()=>l.oO,calAngle:()=>l.mt,calDistance:()=>l.Lw,calculateCentroid:()=>l.SI,calculatePointsCenterAndRadius:()=>l.Rx,createLayerContainer:()=>a.e7,createSceneContainer:()=>a.Hp,decodePickingColor:()=>l.W0,defaultValue:()=>l.LS,djb2hash:()=>l.h8,encodePickingColor:()=>l.Z6,expandUrl:()=>l.Gk,extent:()=>l.We,flow:()=>l.ls,formatImage:()=>l.Co,fp64LowPart:()=>l.Ks,generateCatRamp:()=>l.hj,generateColorRamp:()=>l.Cl,generateCustomRamp:()=>l.Oc,generateLinearRamp:()=>l.M4,generateQuantizeRamp:()=>l.NJ,getAngle:()=>l._O,getArrayBuffer:()=>l.ks,getBBoxFromPoints:()=>l.Ol,getData:()=>l.Yu,getDefaultDomain:()=>l.ZB,getImage:()=>l.gJ,getJSON:()=>l.xA,getProtocolAction:()=>l.Y3,getReferrer:()=>l.an,getTileIndices:()=>l.rJ,getTileWarpXY:()=>l.qD,getURLFromTemplate:()=>l.z0,getWMTSURLFromTemplate:()=>l.jG,gl:()=>a.gl,globalConfigService:()=>a.cO,guid:()=>l.M8,isAndroid:()=>l.Dt,isColor:()=>l.D5,isImageBitmap:()=>l.fg,isNumber:()=>l.Id,isPC:()=>l.Ro,isURLTemplate:()=>l.Xj,isWorker:()=>l.hJ,isiOS:()=>l.Tt,latitude:()=>l.pq,lineAtOffset:()=>l.LT,lineAtOffsetAsyc:()=>l.wj,lineStyleType:()=>c.zW,lngLatInExtent:()=>l.if,lngLatToMeters:()=>l.vP,lnglatDistance:()=>l.yM,lodashUtil:()=>l.lodashUtil,longitude:()=>l.MS,makeXMLHttpRequestPromise:()=>l.LF,metersToLngLat:()=>l.Uv,normalize:()=>l.Fv,osmLonLat2TileXY:()=>l.RV,osmTileXY2LonLat:()=>l.cN,packCircleVertex:()=>a.wL,padBounds:()=>l.yA,postData:()=>l.qC,project:()=>l.iV,removeDuplicateUniforms:()=>a.Vb,rgb2arr:()=>l.CI,sameOrigin:()=>l._0,tileToBounds:()=>l.Dv,tranfrormCoord:()=>l.Jo,unProjectFlat:()=>l.ih,validateLngLat:()=>l.Fb,version:()=>r});var u=e(32548),i=e(92078),a=e(71590),c=e(29283),d=e(24162),m=e(32966),l=e(64939),r="2.22.1"},38163:Xt=>{Xt.exports=K;function K(i,a){var c=i&&i.type,d;if(c==="FeatureCollection")for(d=0;d<i.features.length;d++)K(i.features[d],a);else if(c==="GeometryCollection")for(d=0;d<i.geometries.length;d++)K(i.geometries[d],a);else if(c==="Feature")K(i.geometry,a);else if(c==="Polygon")e(i.coordinates,a);else if(c==="MultiPolygon")for(d=0;d<i.coordinates.length;d++)e(i.coordinates[d],a);return i}function e(i,a){if(i.length!==0){u(i[0],a);for(var c=1;c<i.length;c++)u(i[c],!a)}}function u(i,a){for(var c=0,d=0,m=0,l=i.length,r=l-1;m<l;r=m++){var h=(i[m][0]-i[r][0])*(i[r][1]+i[m][1]),g=c+h;d+=Math.abs(c)>=Math.abs(h)?c-g+h:h-g+c,c=g}c+d>=0!=!!a&&i.reverse()}},38929:(Xt,K,e)=>{Xt.exports.VectorTile=e(22779),e(66024),e(59701)},22779:(Xt,K,e)=>{"use strict";var u=e(59701);Xt.exports=i;function i(c,d){this.layers=c.readFields(a,{},d)}function a(c,d,m){if(c===3){var l=new u(m,m.readVarint()+m.pos);l.length&&(d[l.name]=l)}}},66024:(Xt,K,e)=>{"use strict";var u=e(75550);Xt.exports=i;function i(l,r,h,g,A){this.properties={},this.extent=h,this.type=0,this._pbf=l,this._geometry=-1,this._keys=g,this._values=A,l.readFields(a,this,r)}function a(l,r,h){l==1?r.id=h.readVarint():l==2?c(h,r):l==3?r.type=h.readVarint():l==4&&(r._geometry=h.pos)}function c(l,r){for(var h=l.readVarint()+l.pos;l.pos<h;){var g=r._keys[l.readVarint()],A=r._values[l.readVarint()];r.properties[g]=A}}i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var r=l.readVarint()+l.pos,h=1,g=0,A=0,o=0,S=[],T;l.pos<r;){if(g<=0){var E=l.readVarint();h=E&7,g=E>>3}if(g--,h===1||h===2)A+=l.readSVarint(),o+=l.readSVarint(),h===1&&(T&&S.push(T),T=[]),T.push(new u(A,o));else if(h===7)T&&T.push(T[0].clone());else throw new Error("unknown command "+h)}return T&&S.push(T),S},i.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var r=l.readVarint()+l.pos,h=1,g=0,A=0,o=0,S=1/0,T=-1/0,E=1/0,b=-1/0;l.pos<r;){if(g<=0){var C=l.readVarint();h=C&7,g=C>>3}if(g--,h===1||h===2)A+=l.readSVarint(),o+=l.readSVarint(),A<S&&(S=A),A>T&&(T=A),o<E&&(E=o),o>b&&(b=o);else if(h!==7)throw new Error("unknown command "+h)}return[S,E,T,b]},i.prototype.toGeoJSON=function(l,r,h){var g=this.extent*Math.pow(2,h),A=this.extent*l,o=this.extent*r,S=this.loadGeometry(),T=i.types[this.type],E,b;function C(M){for(var Z=0;Z<M.length;Z++){var rt=M[Z],N=180-(rt.y+o)*360/g;M[Z]=[(rt.x+A)*360/g-180,360/Math.PI*Math.atan(Math.exp(N*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(E=0;E<S.length;E++)X[E]=S[E][0];S=X,C(S);break;case 2:for(E=0;E<S.length;E++)C(S[E]);break;case 3:for(S=d(S),E=0;E<S.length;E++)for(b=0;b<S[E].length;b++)C(S[E][b]);break}S.length===1?S=S[0]:T="Multi"+T;var R={type:"Feature",geometry:{type:T,coordinates:S},properties:this.properties};return"id"in this&&(R.id=this.id),R};function d(l){var r=l.length;if(r<=1)return[l];for(var h=[],g,A,o=0;o<r;o++){var S=m(l[o]);S!==0&&(A===void 0&&(A=S<0),A===S<0?(g&&h.push(g),g=[l[o]]):g.push(l[o]))}return g&&h.push(g),h}function m(l){for(var r=0,h=0,g=l.length,A=g-1,o,S;h<g;A=h++)o=l[h],S=l[A],r+=(S.x-o.x)*(o.y+S.y);return r}},59701:(Xt,K,e)=>{"use strict";var u=e(66024);Xt.exports=i;function i(d,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(a,this,m),this.length=this._features.length}function a(d,m,l){d===15?m.version=l.readVarint():d===1?m.name=l.readString():d===5?m.extent=l.readVarint():d===2?m._features.push(l.pos):d===3?m._keys.push(l.readString()):d===4&&m._values.push(c(l))}function c(d){for(var m=null,l=d.readVarint()+d.pos;d.pos<l;){var r=d.readVarint()>>3;m=r===1?d.readString():r===2?d.readFloat():r===3?d.readDouble():r===4?d.readVarint64():r===5?d.readVarint():r===6?d.readSVarint():r===7?d.readBoolean():null}return m}i.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var m=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,m,this.extent,this._keys,this._values)}},91077:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){return i<a?-1:i>a?1:i>=a?0:NaN}},29173:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(91077);function i(c){return c.length===1&&(c=a(c)),{left:function(d,m,l,r){for(l==null&&(l=0),r==null&&(r=d.length);l<r;){var h=l+r>>>1;c(d[h],m)<0?l=h+1:r=h}return l},right:function(d,m,l,r){for(l==null&&(l=0),r==null&&(r=d.length);l<r;){var h=l+r>>>1;c(d[h],m)>0?r=h:l=h+1}return l}}}function a(c){return function(d,m){return(0,u.Z)(c(d),m)}}},62921:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return i===null?NaN:+i}},41461:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(62921);function i(a,c,d){if(d==null&&(d=u.Z),!!(m=a.length)){if((c=+c)<=0||m<2)return+d(a[0],0,a);if(c>=1)return+d(a[m-1],m-1,a);var m,l=(m-1)*c,r=Math.floor(l),h=+d(a[r],r,a),g=+d(a[r+1],r+1,a);return h+(g-h)*(l-r)}}},18904:(Xt,K,e)=>{"use strict";e.d(K,{ue:()=>T});var u={},i={},a=34,c=10,d=13;function m(Z){return new Function("d","return {"+Z.map(function(rt,N){return JSON.stringify(rt)+": d["+N+'] || ""'}).join(",")+"}")}function l(Z,rt){var N=m(Z);return function(Q,ft){return rt(N(Q),ft,Z)}}function r(Z){var rt=Object.create(null),N=[];return Z.forEach(function(Q){for(var ft in Q)ft in rt||N.push(rt[ft]=ft)}),N}function h(Z,rt){var N=Z+"",Q=N.length;return Q<rt?new Array(rt-Q+1).join(0)+N:N}function g(Z){return Z<0?"-"+h(-Z,6):Z>9999?"+"+h(Z,6):h(Z,4)}function A(Z){var rt=Z.getUTCHours(),N=Z.getUTCMinutes(),Q=Z.getUTCSeconds(),ft=Z.getUTCMilliseconds();return isNaN(Z)?"Invalid Date":g(Z.getUTCFullYear(),4)+"-"+h(Z.getUTCMonth()+1,2)+"-"+h(Z.getUTCDate(),2)+(ft?"T"+h(rt,2)+":"+h(N,2)+":"+h(Q,2)+"."+h(ft,3)+"Z":Q?"T"+h(rt,2)+":"+h(N,2)+":"+h(Q,2)+"Z":N||rt?"T"+h(rt,2)+":"+h(N,2)+"Z":"")}function o(Z){var rt=new RegExp('["'+Z+`
\r]`),N=Z.charCodeAt(0);function Q(B,_){var H,U,V=ft(B,function(D,lt){if(H)return H(D,lt-1);U=D,H=_?l(D,_):m(D)});return V.columns=U||[],V}function ft(B,_){var H=[],U=B.length,V=0,D=0,lt,J=U<=0,Rt=!1;B.charCodeAt(U-1)===c&&--U,B.charCodeAt(U-1)===d&&--U;function kt(){if(J)return i;if(Rt)return Rt=!1,u;var re,It=V,Nt;if(B.charCodeAt(It)===a){for(;V++<U&&B.charCodeAt(V)!==a||B.charCodeAt(++V)===a;);return(re=V)>=U?J=!0:(Nt=B.charCodeAt(V++))===c?Rt=!0:Nt===d&&(Rt=!0,B.charCodeAt(V)===c&&++V),B.slice(It+1,re-1).replace(/""/g,'"')}for(;V<U;){if((Nt=B.charCodeAt(re=V++))===c)Rt=!0;else if(Nt===d)Rt=!0,B.charCodeAt(V)===c&&++V;else if(Nt!==N)continue;return B.slice(It,re)}return J=!0,B.slice(It,U)}for(;(lt=kt())!==i;){for(var ne=[];lt!==u&&lt!==i;)ne.push(lt),lt=kt();_&&(ne=_(ne,D++))==null||H.push(ne)}return H}function I(B,_){return B.map(function(H){return _.map(function(U){return O(H[U])}).join(Z)})}function G(B,_){return _==null&&(_=r(B)),[_.map(O).join(Z)].concat(I(B,_)).join(`
`)}function ut(B,_){return _==null&&(_=r(B)),I(B,_).join(`
`)}function L(B){return B.map(j).join(`
`)}function j(B){return B.map(O).join(Z)}function O(B){return B==null?"":B instanceof Date?A(B):rt.test(B+="")?'"'+B.replace(/"/g,'""')+'"':B}return{parse:Q,parseRows:ft,format:G,formatBody:ut,formatRows:L,formatRow:j,formatValue:O}}var S=o(","),T=S.parse,E=S.parseRows,b=S.format,C=S.formatBody,X=S.formatRows,R=S.formatRow,M=S.formatValue},95097:(Xt,K,e)=>{"use strict";e.d(K,{WU:()=>S,jH:()=>T});var u=e(33085),i=e(78129),a=e(60576),c=e(46196),d=e(61485),m=e(56668),l=e(92994),r=e(79890),h=Array.prototype.map,g=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function A(b){var C=b.grouping===void 0||b.thousands===void 0?r.Z:(0,i.Z)(h.call(b.grouping,Number),b.thousands+""),X=b.currency===void 0?"":b.currency[0]+"",R=b.currency===void 0?"":b.currency[1]+"",M=b.decimal===void 0?".":b.decimal+"",Z=b.numerals===void 0?r.Z:(0,a.Z)(h.call(b.numerals,String)),rt=b.percent===void 0?"%":b.percent+"",N=b.minus===void 0?"-":b.minus+"",Q=b.nan===void 0?"NaN":b.nan+"";function ft(G){G=(0,c.Z)(G);var ut=G.fill,L=G.align,j=G.sign,O=G.symbol,B=G.zero,_=G.width,H=G.comma,U=G.precision,V=G.trim,D=G.type;D==="n"?(H=!0,D="g"):m.Z[D]||(U===void 0&&(U=12),V=!0,D="g"),(B||ut==="0"&&L==="=")&&(B=!0,ut="0",L="=");var lt=O==="$"?X:O==="#"&&/[boxX]/.test(D)?"0"+D.toLowerCase():"",J=O==="$"?R:/[%p]/.test(D)?rt:"",Rt=m.Z[D],kt=/[defgprs%]/.test(D);U=U===void 0?6:/[gprs]/.test(D)?Math.max(1,Math.min(21,U)):Math.max(0,Math.min(20,U));function ne(re){var It=lt,Nt=J,p,w,W;if(D==="c")Nt=Rt(re)+Nt,re="";else{re=+re;var st=re<0||1/re<0;if(re=isNaN(re)?Q:Rt(Math.abs(re),U),V&&(re=(0,d.Z)(re)),st&&+re==0&&j!=="+"&&(st=!1),It=(st?j==="("?j:N:j==="-"||j==="("?"":j)+It,Nt=(D==="s"?g[8+l.y/3]:"")+Nt+(st&&j==="("?")":""),kt){for(p=-1,w=re.length;++p<w;)if(W=re.charCodeAt(p),48>W||W>57){Nt=(W===46?M+re.slice(p+1):re.slice(p))+Nt,re=re.slice(0,p);break}}}H&&!B&&(re=C(re,1/0));var Tt=It.length+re.length+Nt.length,Gt=Tt<_?new Array(_-Tt+1).join(ut):"";switch(H&&B&&(re=C(Gt+re,Gt.length?_-Nt.length:1/0),Gt=""),L){case"<":re=It+re+Nt+Gt;break;case"=":re=It+Gt+re+Nt;break;case"^":re=Gt.slice(0,Tt=Gt.length>>1)+It+re+Nt+Gt.slice(Tt);break;default:re=Gt+It+re+Nt;break}return Z(re)}return ne.toString=function(){return G+""},ne}function I(G,ut){var L=ft((G=(0,c.Z)(G),G.type="f",G)),j=Math.max(-8,Math.min(8,Math.floor((0,u.Z)(ut)/3)))*3,O=Math.pow(10,-j),B=g[8+j/3];return function(_){return L(O*_)+B}}return{format:ft,formatPrefix:I}}var o,S,T;E({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function E(b){return o=A(b),S=o.format,T=o.formatPrefix,o}},33085:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(38885);function i(a){return a=(0,u.V)(Math.abs(a)),a?a[1]:NaN}},38885:(Xt,K,e)=>{"use strict";e.d(K,{V:()=>i,Z:()=>u});function u(a){return Math.abs(a=Math.round(a))>=1e21?a.toLocaleString("en").replace(/,/g,""):a.toString(10)}function i(a,c){if((d=(a=c?a.toExponential(c-1):a.toExponential()).indexOf("e"))<0)return null;var d,m=a.slice(0,d);return[m.length>1?m[0]+m.slice(2):m,+a.slice(d+1)]}},78129:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){return function(c,d){for(var m=c.length,l=[],r=0,h=i[0],g=0;m>0&&h>0&&(g+h+1>d&&(h=Math.max(1,d-g)),l.push(c.substring(m-=h,m+h)),!((g+=h+1)>d));)h=i[r=(r+1)%i.length];return l.reverse().join(a)}}},60576:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return function(a){return a.replace(/[0-9]/g,function(c){return i[+c]})}}},92994:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>a,y:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(38885);var i;function a(c,d){var m=(0,u.V)(c,d);if(!m)return c+"";var l=m[0],r=m[1],h=r-(i=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,g=l.length;return h===g?l:h>g?l+new Array(h-g+1).join("0"):h>0?l.slice(0,h)+"."+l.slice(h):"0."+new Array(1-h).join("0")+(0,u.V)(c,Math.max(0,d+h-1))[0]}},46196:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>i});var u=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function i(c){if(!(d=u.exec(c)))throw new Error("invalid format: "+c);var d;return new a({fill:d[1],align:d[2],sign:d[3],symbol:d[4],zero:d[5],width:d[6],comma:d[7],precision:d[8]&&d[8].slice(1),trim:d[9],type:d[10]})}i.prototype=a.prototype;function a(c){this.fill=c.fill===void 0?" ":c.fill+"",this.align=c.align===void 0?">":c.align+"",this.sign=c.sign===void 0?"-":c.sign+"",this.symbol=c.symbol===void 0?"":c.symbol+"",this.zero=!!c.zero,this.width=c.width===void 0?void 0:+c.width,this.comma=!!c.comma,this.precision=c.precision===void 0?void 0:+c.precision,this.trim=!!c.trim,this.type=c.type===void 0?"":c.type+""}a.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}},61485:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){t:for(var a=i.length,c=1,d=-1,m;c<a;++c)switch(i[c]){case".":d=m=c;break;case"0":d===0&&(d=c),m=c;break;default:if(!+i[c])break t;d>0&&(d=0);break}return d>0?i.slice(0,d)+i.slice(m+1):i}},56668:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(38885),i=e(92994);function a(d,m){var l=(0,u.V)(d,m);if(!l)return d+"";var r=l[0],h=l[1];return h<0?"0."+new Array(-h).join("0")+r:r.length>h+1?r.slice(0,h+1)+"."+r.slice(h+1):r+new Array(h-r.length+2).join("0")}const c={"%":function(d,m){return(d*100).toFixed(m)},b:function(d){return Math.round(d).toString(2)},c:function(d){return d+""},d:u.Z,e:function(d,m){return d.toExponential(m)},f:function(d,m){return d.toFixed(m)},g:function(d,m){return d.toPrecision(m)},o:function(d){return Math.round(d).toString(8)},p:function(d,m){return a(d*100,m)},r:a,s:i.Z,X:function(d){return Math.round(d).toString(16).toUpperCase()},x:function(d){return Math.round(d).toString(16)}}},79890:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return i}},92162:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(33085);function i(a){return Math.max(0,-(0,u.Z)(Math.abs(a)))}},53726:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(33085);function i(a,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor((0,u.Z)(c)/3)))*3-(0,u.Z)(Math.abs(a)))}},37655:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(33085);function i(a,c){return a=Math.abs(a),c=Math.abs(c)-a,Math.max(0,(0,u.Z)(c)-(0,u.Z)(a))+1}},88122:(Xt,K,e)=>{"use strict";if(e.d(K,{M:()=>a}),!/^(1887|7596)$/.test(e.j))var u=e(81265);function i(c,d){return(isNumberArray(d)?numberArray:a)(c,d)}function a(c,d){var m=d?d.length:0,l=c?Math.min(m,c.length):0,r=new Array(l),h=new Array(m),g;for(g=0;g<l;++g)r[g]=(0,u.Z)(c[g],d[g]);for(;g<m;++g)h[g]=d[g];return function(A){for(g=0;g<l;++g)h[g]=r[g](A);return h}}},49885:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>i,t:()=>u});function u(a,c,d,m,l){var r=a*a,h=r*a;return((1-3*a+3*r-h)*c+(4-6*r+3*h)*d+(1+3*a+3*r-3*h)*m+h*l)/6}function i(a){var c=a.length-1;return function(d){var m=d<=0?d=0:d>=1?(d=1,c-1):Math.floor(d*c),l=a[m],r=a[m+1],h=m>0?a[m-1]:2*l-r,g=m<c-1?a[m+2]:2*r-l;return u((d-m/c)*c,h,l,r,g)}}},55302:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return function(){return i}}},70088:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){var c=new Date;return i=+i,a=+a,function(d){return c.setTime(i*(1-d)+a*d),c}}},58916:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){return i=+i,a=+a,function(c){return i*(1-c)+a*c}}},67896:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u,v:()=>i});function u(a,c){c||(c=[]);var d=a?Math.min(c.length,a.length):0,m=c.slice(),l;return function(r){for(l=0;l<d;++l)m[l]=a[l]*(1-r)+c[l]*r;return m}}function i(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}},10967:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(81265);function i(a,c){var d={},m={},l;(a===null||typeof a!="object")&&(a={}),(c===null||typeof c!="object")&&(c={});for(l in c)l in a?d[l]=(0,u.Z)(a[l],c[l]):m[l]=c[l];return function(r){for(l in d)m[l]=d[l](r);return m}}},24028:(Xt,K,e)=>{"use strict";e.d(K,{ZP:()=>g,hD:()=>o});var u=e(2650),i=e(49885);function a(T){var E=T.length;return function(b){var C=Math.floor(((b%=1)<0?++b:b)*E),X=T[(C+E-1)%E],R=T[C%E],M=T[(C+1)%E],Z=T[(C+2)%E];return(0,i.t)((b-C/E)*E,X,R,M,Z)}}var c=e(55302);function d(T,E){return function(b){return T+b*E}}function m(T,E,b){return T=Math.pow(T,b),E=Math.pow(E,b)-T,b=1/b,function(C){return Math.pow(T+C*E,b)}}function l(T,E){var b=E-T;return b?d(T,b>180||b<-180?b-360*Math.round(b/360):b):constant(isNaN(T)?E:T)}function r(T){return(T=+T)==1?h:function(E,b){return b-E?m(E,b,T):(0,c.Z)(isNaN(E)?b:E)}}function h(T,E){var b=E-T;return b?d(T,b):(0,c.Z)(isNaN(T)?E:T)}const g=function T(E){var b=r(E);function C(X,R){var M=b((X=(0,u.B8)(X)).r,(R=(0,u.B8)(R)).r),Z=b(X.g,R.g),rt=b(X.b,R.b),N=h(X.opacity,R.opacity);return function(Q){return X.r=M(Q),X.g=Z(Q),X.b=rt(Q),X.opacity=N(Q),X+""}}return C.gamma=T,C}(1);function A(T){return function(E){var b=E.length,C=new Array(b),X=new Array(b),R=new Array(b),M,Z;for(M=0;M<b;++M)Z=(0,u.B8)(E[M]),C[M]=Z.r||0,X[M]=Z.g||0,R[M]=Z.b||0;return C=T(C),X=T(X),R=T(R),Z.opacity=1,function(rt){return Z.r=C(rt),Z.g=X(rt),Z.b=R(rt),Z+""}}}var o=A(i.Z),S=A(a)},79935:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){return i=+i,a=+a,function(c){return Math.round(i*(1-c)+a*c)}}},59843:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>m}),!/^(1887|7596)$/.test(e.j))var u=e(58916);var i=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,a=new RegExp(i.source,"g");function c(l){return function(){return l}}function d(l){return function(r){return l(r)+""}}function m(l,r){var h=i.lastIndex=a.lastIndex=0,g,A,o,S=-1,T=[],E=[];for(l=l+"",r=r+"";(g=i.exec(l))&&(A=a.exec(r));)(o=A.index)>h&&(o=r.slice(h,o),T[S]?T[S]+=o:T[++S]=o),(g=g[0])===(A=A[0])?T[S]?T[S]+=A:T[++S]=A:(T[++S]=null,E.push({i:S,x:(0,u.Z)(g,A)})),h=a.lastIndex;return h<r.length&&(o=r.slice(h),T[S]?T[S]+=o:T[++S]=o),T.length<2?E[0]?d(E[0].x):c(r):(r=E.length,function(b){for(var C=0,X;C<r;++C)T[(X=E[C]).i]=X.x(b);return T.join("")})}},81265:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>g}),!/^(1887|7596)$/.test(e.j))var u=e(2650);if(!/^(1887|7596)$/.test(e.j))var i=e(24028);if(!/^(1887|7596)$/.test(e.j))var a=e(88122);if(!/^(1887|7596)$/.test(e.j))var c=e(70088);if(!/^(1887|7596)$/.test(e.j))var d=e(58916);if(!/^(1887|7596)$/.test(e.j))var m=e(10967);if(!/^(1887|7596)$/.test(e.j))var l=e(59843);if(!/^(1887|7596)$/.test(e.j))var r=e(55302);if(!/^(1887|7596)$/.test(e.j))var h=e(67896);function g(A,o){var S=typeof o,T;return o==null||S==="boolean"?(0,r.Z)(o):(S==="number"?d.Z:S==="string"?(T=(0,u.ZP)(o))?(o=T,i.ZP):l.Z:o instanceof u.ZP?i.ZP:o instanceof Date?c.Z:(0,h.v)(o)?h.Z:Array.isArray(o)?a.M:typeof o.valueOf!="function"&&typeof o.toString!="function"||isNaN(o)?m.Z:d.Z)(A,o)}},58749:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return function(){return i}}},48348:(Xt,K,e)=>{"use strict";e.d(K,{O:()=>i,o:()=>u});function u(a,c){switch(arguments.length){case 0:break;case 1:this.range(a);break;default:this.range(c).domain(a);break}return this}function i(a,c){switch(arguments.length){case 0:break;case 1:this.interpolator(a);break;default:this.interpolator(c).domain(a);break}return this}},37604:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i,a){i=i.slice();var c=0,d=i.length-1,m=i[c],l=i[d],r;return l<m&&(r=c,c=d,d=r,r=m,m=l,l=r),i[c]=a.floor(m),i[d]=a.ceil(l),i}},34299:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(i){return+i}},64605:(Xt,K,e)=>{"use strict";e.d(K,{i$:()=>Cn});var u=e(67519),i=e(89692),a=e(22776),c=e(69478),d=e(82209),m=e(31181);function l(Lt){if(0<=Lt.y&&Lt.y<100){var Wt=new Date(-1,Lt.m,Lt.d,Lt.H,Lt.M,Lt.S,Lt.L);return Wt.setFullYear(Lt.y),Wt}return new Date(Lt.y,Lt.m,Lt.d,Lt.H,Lt.M,Lt.S,Lt.L)}function r(Lt){if(0<=Lt.y&&Lt.y<100){var Wt=new Date(Date.UTC(-1,Lt.m,Lt.d,Lt.H,Lt.M,Lt.S,Lt.L));return Wt.setUTCFullYear(Lt.y),Wt}return new Date(Date.UTC(Lt.y,Lt.m,Lt.d,Lt.H,Lt.M,Lt.S,Lt.L))}function h(Lt,Wt,Re){return{y:Lt,m:Wt,d:Re,H:0,M:0,S:0,L:0}}function g(Lt){var Wt=Lt.dateTime,Re=Lt.date,Ie=Lt.time,ar=Lt.periods,gr=Lt.days,xr=Lt.shortDays,Dr=Lt.months,Qr=Lt.shortMonths,Hi=C(ar),Oi=X(ar),Ei=C(gr),Ji=X(gr),Gi=C(xr),so=X(xr),uo=C(Dr),kr=X(Dr),Zi=C(Qr),Ni=X(Qr),Jr={a:pr,A:ti,b:fo,B:Fi,c:null,d:J,e:J,f:It,g:gn,G:Ln,H:Rt,I:kt,j:ne,L:re,m:Nt,M:p,p:qi,q:zi,Q:Rn,s:yn,S:w,u:W,U:st,V:Gt,w:ze,W:$e,x:null,X:null,y:rn,Y:nt,Z:rr,"%":ke},di={a:to,A:Pr,b:br,B:Or,c:null,d:tr,e:tr,f:Ui,g:me,G:se,H:sr,I:Br,j:fi,L:Yn,m:Wr,M:Zt,p:Bi,q:ho,Q:Rn,s:yn,S:P,u:Y,U:pt,V:Et,w:pe,W:ae,x:null,X:null,y:xe,Y:en,Z:ye,"%":ke},Yi={a:Oo,A:Ki,b:bn,B:hi,c:Ti,d:L,e:L,f:U,g:ft,G:Q,H:O,I:O,j,L:H,m:ut,M:B,p:co,q:G,Q:D,s:lt,S:_,u:M,U:Z,V:rt,w:R,W:N,x:Lr,X:ur,y:ft,Y:Q,Z:I,"%":V};Jr.x=si(Re,Jr),Jr.X=si(Ie,Jr),Jr.c=si(Wt,Jr),di.x=si(Re,di),di.X=si(Ie,di),di.c=si(Wt,di);function si(hn,zn){return function(jn){var Xe=[],q=-1,At=0,Yt=hn.length,Mt,Dt,$t;for(jn instanceof Date||(jn=new Date(+jn));++q<Yt;)hn.charCodeAt(q)===37&&(Xe.push(hn.slice(At,q)),(Dt=A[Mt=hn.charAt(++q)])!=null?Mt=hn.charAt(++q):Dt=Mt==="e"?" ":"0",($t=zn[Mt])&&(Mt=$t(jn,Dt)),Xe.push(Mt),At=q+1);return Xe.push(hn.slice(At,q)),Xe.join("")}}function lo(hn,zn){return function(jn){var Xe=h(1900,void 0,1),q=Ii(Xe,hn,jn+="",0),At,Yt;if(q!=jn.length)return null;if("Q"in Xe)return new Date(Xe.Q);if("s"in Xe)return new Date(Xe.s*1e3+("L"in Xe?Xe.L:0));if(zn&&!("Z"in Xe)&&(Xe.Z=0),"p"in Xe&&(Xe.H=Xe.H%12+Xe.p*12),Xe.m===void 0&&(Xe.m="q"in Xe?Xe.q:0),"V"in Xe){if(Xe.V<1||Xe.V>53)return null;"w"in Xe||(Xe.w=1),"Z"in Xe?(At=r(h(Xe.y,0,1)),Yt=At.getUTCDay(),At=Yt>4||Yt===0?u.l6.ceil(At):(0,u.l6)(At),At=i.Z.offset(At,(Xe.V-1)*7),Xe.y=At.getUTCFullYear(),Xe.m=At.getUTCMonth(),Xe.d=At.getUTCDate()+(Xe.w+6)%7):(At=l(h(Xe.y,0,1)),Yt=At.getDay(),At=Yt>4||Yt===0?a.wA.ceil(At):(0,a.wA)(At),At=c.Z.offset(At,(Xe.V-1)*7),Xe.y=At.getFullYear(),Xe.m=At.getMonth(),Xe.d=At.getDate()+(Xe.w+6)%7)}else("W"in Xe||"U"in Xe)&&("w"in Xe||(Xe.w="u"in Xe?Xe.u%7:"W"in Xe?1:0),Yt="Z"in Xe?r(h(Xe.y,0,1)).getUTCDay():l(h(Xe.y,0,1)).getDay(),Xe.m=0,Xe.d="W"in Xe?(Xe.w+6)%7+Xe.W*7-(Yt+5)%7:Xe.w+Xe.U*7-(Yt+6)%7);return"Z"in Xe?(Xe.H+=Xe.Z/100|0,Xe.M+=Xe.Z%100,r(Xe)):l(Xe)}}function Ii(hn,zn,jn,Xe){for(var q=0,At=zn.length,Yt=jn.length,Mt,Dt;q<At;){if(Xe>=Yt)return-1;if(Mt=zn.charCodeAt(q++),Mt===37){if(Mt=zn.charAt(q++),Dt=Yi[Mt in A?zn.charAt(q++):Mt],!Dt||(Xe=Dt(hn,jn,Xe))<0)return-1}else if(Mt!=jn.charCodeAt(Xe++))return-1}return Xe}function co(hn,zn,jn){var Xe=Hi.exec(zn.slice(jn));return Xe?(hn.p=Oi[Xe[0].toLowerCase()],jn+Xe[0].length):-1}function Oo(hn,zn,jn){var Xe=Gi.exec(zn.slice(jn));return Xe?(hn.w=so[Xe[0].toLowerCase()],jn+Xe[0].length):-1}function Ki(hn,zn,jn){var Xe=Ei.exec(zn.slice(jn));return Xe?(hn.w=Ji[Xe[0].toLowerCase()],jn+Xe[0].length):-1}function bn(hn,zn,jn){var Xe=Zi.exec(zn.slice(jn));return Xe?(hn.m=Ni[Xe[0].toLowerCase()],jn+Xe[0].length):-1}function hi(hn,zn,jn){var Xe=uo.exec(zn.slice(jn));return Xe?(hn.m=kr[Xe[0].toLowerCase()],jn+Xe[0].length):-1}function Ti(hn,zn,jn){return Ii(hn,Wt,zn,jn)}function Lr(hn,zn,jn){return Ii(hn,Re,zn,jn)}function ur(hn,zn,jn){return Ii(hn,Ie,zn,jn)}function pr(hn){return xr[hn.getDay()]}function ti(hn){return gr[hn.getDay()]}function fo(hn){return Qr[hn.getMonth()]}function Fi(hn){return Dr[hn.getMonth()]}function qi(hn){return ar[+(hn.getHours()>=12)]}function zi(hn){return 1+~~(hn.getMonth()/3)}function to(hn){return xr[hn.getUTCDay()]}function Pr(hn){return gr[hn.getUTCDay()]}function br(hn){return Qr[hn.getUTCMonth()]}function Or(hn){return Dr[hn.getUTCMonth()]}function Bi(hn){return ar[+(hn.getUTCHours()>=12)]}function ho(hn){return 1+~~(hn.getUTCMonth()/3)}return{format:function(hn){var zn=si(hn+="",Jr);return zn.toString=function(){return hn},zn},parse:function(hn){var zn=lo(hn+="",!1);return zn.toString=function(){return hn},zn},utcFormat:function(hn){var zn=si(hn+="",di);return zn.toString=function(){return hn},zn},utcParse:function(hn){var zn=lo(hn+="",!0);return zn.toString=function(){return hn},zn}}}var A={"-":"",_:" ",0:"0"},o=/^\s*\d+/,S=/^%/,T=/[\\^$*+?|[\]().{}]/g;function E(Lt,Wt,Re){var Ie=Lt<0?"-":"",ar=(Ie?-Lt:Lt)+"",gr=ar.length;return Ie+(gr<Re?new Array(Re-gr+1).join(Wt)+ar:ar)}function b(Lt){return Lt.replace(T,"\\$&")}function C(Lt){return new RegExp("^(?:"+Lt.map(b).join("|")+")","i")}function X(Lt){for(var Wt={},Re=-1,Ie=Lt.length;++Re<Ie;)Wt[Lt[Re].toLowerCase()]=Re;return Wt}function R(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+1));return Ie?(Lt.w=+Ie[0],Re+Ie[0].length):-1}function M(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+1));return Ie?(Lt.u=+Ie[0],Re+Ie[0].length):-1}function Z(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.U=+Ie[0],Re+Ie[0].length):-1}function rt(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.V=+Ie[0],Re+Ie[0].length):-1}function N(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.W=+Ie[0],Re+Ie[0].length):-1}function Q(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+4));return Ie?(Lt.y=+Ie[0],Re+Ie[0].length):-1}function ft(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.y=+Ie[0]+(+Ie[0]>68?1900:2e3),Re+Ie[0].length):-1}function I(Lt,Wt,Re){var Ie=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(Wt.slice(Re,Re+6));return Ie?(Lt.Z=Ie[1]?0:-(Ie[2]+(Ie[3]||"00")),Re+Ie[0].length):-1}function G(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+1));return Ie?(Lt.q=Ie[0]*3-3,Re+Ie[0].length):-1}function ut(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.m=Ie[0]-1,Re+Ie[0].length):-1}function L(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.d=+Ie[0],Re+Ie[0].length):-1}function j(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+3));return Ie?(Lt.m=0,Lt.d=+Ie[0],Re+Ie[0].length):-1}function O(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.H=+Ie[0],Re+Ie[0].length):-1}function B(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.M=+Ie[0],Re+Ie[0].length):-1}function _(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+2));return Ie?(Lt.S=+Ie[0],Re+Ie[0].length):-1}function H(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+3));return Ie?(Lt.L=+Ie[0],Re+Ie[0].length):-1}function U(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re,Re+6));return Ie?(Lt.L=Math.floor(Ie[0]/1e3),Re+Ie[0].length):-1}function V(Lt,Wt,Re){var Ie=S.exec(Wt.slice(Re,Re+1));return Ie?Re+Ie[0].length:-1}function D(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re));return Ie?(Lt.Q=+Ie[0],Re+Ie[0].length):-1}function lt(Lt,Wt,Re){var Ie=o.exec(Wt.slice(Re));return Ie?(Lt.s=+Ie[0],Re+Ie[0].length):-1}function J(Lt,Wt){return E(Lt.getDate(),Wt,2)}function Rt(Lt,Wt){return E(Lt.getHours(),Wt,2)}function kt(Lt,Wt){return E(Lt.getHours()%12||12,Wt,2)}function ne(Lt,Wt){return E(1+c.Z.count((0,d.Z)(Lt),Lt),Wt,3)}function re(Lt,Wt){return E(Lt.getMilliseconds(),Wt,3)}function It(Lt,Wt){return re(Lt,Wt)+"000"}function Nt(Lt,Wt){return E(Lt.getMonth()+1,Wt,2)}function p(Lt,Wt){return E(Lt.getMinutes(),Wt,2)}function w(Lt,Wt){return E(Lt.getSeconds(),Wt,2)}function W(Lt){var Wt=Lt.getDay();return Wt===0?7:Wt}function st(Lt,Wt){return E(a.OM.count((0,d.Z)(Lt)-1,Lt),Wt,2)}function Tt(Lt){var Wt=Lt.getDay();return Wt>=4||Wt===0?(0,a.bL)(Lt):a.bL.ceil(Lt)}function Gt(Lt,Wt){return Lt=Tt(Lt),E(a.bL.count((0,d.Z)(Lt),Lt)+((0,d.Z)(Lt).getDay()===4),Wt,2)}function ze(Lt){return Lt.getDay()}function $e(Lt,Wt){return E(a.wA.count((0,d.Z)(Lt)-1,Lt),Wt,2)}function rn(Lt,Wt){return E(Lt.getFullYear()%100,Wt,2)}function gn(Lt,Wt){return Lt=Tt(Lt),E(Lt.getFullYear()%100,Wt,2)}function nt(Lt,Wt){return E(Lt.getFullYear()%1e4,Wt,4)}function Ln(Lt,Wt){var Re=Lt.getDay();return Lt=Re>=4||Re===0?(0,a.bL)(Lt):a.bL.ceil(Lt),E(Lt.getFullYear()%1e4,Wt,4)}function rr(Lt){var Wt=Lt.getTimezoneOffset();return(Wt>0?"-":(Wt*=-1,"+"))+E(Wt/60|0,"0",2)+E(Wt%60,"0",2)}function tr(Lt,Wt){return E(Lt.getUTCDate(),Wt,2)}function sr(Lt,Wt){return E(Lt.getUTCHours(),Wt,2)}function Br(Lt,Wt){return E(Lt.getUTCHours()%12||12,Wt,2)}function fi(Lt,Wt){return E(1+i.Z.count((0,m.Z)(Lt),Lt),Wt,3)}function Yn(Lt,Wt){return E(Lt.getUTCMilliseconds(),Wt,3)}function Ui(Lt,Wt){return Yn(Lt,Wt)+"000"}function Wr(Lt,Wt){return E(Lt.getUTCMonth()+1,Wt,2)}function Zt(Lt,Wt){return E(Lt.getUTCMinutes(),Wt,2)}function P(Lt,Wt){return E(Lt.getUTCSeconds(),Wt,2)}function Y(Lt){var Wt=Lt.getUTCDay();return Wt===0?7:Wt}function pt(Lt,Wt){return E(u.Ox.count((0,m.Z)(Lt)-1,Lt),Wt,2)}function Ct(Lt){var Wt=Lt.getUTCDay();return Wt>=4||Wt===0?(0,u.hB)(Lt):u.hB.ceil(Lt)}function Et(Lt,Wt){return Lt=Ct(Lt),E(u.hB.count((0,m.Z)(Lt),Lt)+((0,m.Z)(Lt).getUTCDay()===4),Wt,2)}function pe(Lt){return Lt.getUTCDay()}function ae(Lt,Wt){return E(u.l6.count((0,m.Z)(Lt)-1,Lt),Wt,2)}function xe(Lt,Wt){return E(Lt.getUTCFullYear()%100,Wt,2)}function me(Lt,Wt){return Lt=Ct(Lt),E(Lt.getUTCFullYear()%100,Wt,2)}function en(Lt,Wt){return E(Lt.getUTCFullYear()%1e4,Wt,4)}function se(Lt,Wt){var Re=Lt.getUTCDay();return Lt=Re>=4||Re===0?(0,u.hB)(Lt):u.hB.ceil(Lt),E(Lt.getUTCFullYear()%1e4,Wt,4)}function ye(){return"+0000"}function ke(){return"%"}function Rn(Lt){return+Lt}function yn(Lt){return Math.floor(+Lt/1e3)}var _n,Cn,or,Tr,Qn;Sr({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Sr(Lt){return _n=g(Lt),Cn=_n.format,or=_n.parse,Tr=_n.utcFormat,Qn=_n.utcParse,_n}},69478:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(11829),i=e(61222),a=(0,u.Z)(function(m){m.setHours(0,0,0,0)},function(m,l){m.setDate(m.getDate()+l)},function(m,l){return(l-m-(l.getTimezoneOffset()-m.getTimezoneOffset())*i.yB)/i.UD},function(m){return m.getDate()-1});const c=/^(1887|7596)$/.test(e.j)?null:a;var d=a.range},61222:(Xt,K,e)=>{"use strict";e.d(K,{UD:()=>c,Y2:()=>a,Ym:()=>u,iM:()=>d,yB:()=>i});var u=1e3,i=6e4,a=36e5,c=864e5,d=6048e5},42784:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(11829),i=e(61222),a=(0,u.Z)(function(m){m.setTime(m-m.getMilliseconds()-m.getSeconds()*i.Ym-m.getMinutes()*i.yB)},function(m,l){m.setTime(+m+l*i.Y2)},function(m,l){return(l-m)/i.Y2},function(m){return m.getHours()});const c=/^(1887|7596)$/.test(e.j)?null:a;var d=a.range},11829:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=new Date,i=new Date;function a(c,d,m,l){function r(h){return c(h=arguments.length===0?new Date:new Date(+h)),h}return r.floor=function(h){return c(h=new Date(+h)),h},r.ceil=function(h){return c(h=new Date(h-1)),d(h,1),c(h),h},r.round=function(h){var g=r(h),A=r.ceil(h);return h-g<A-h?g:A},r.offset=function(h,g){return d(h=new Date(+h),g==null?1:Math.floor(g)),h},r.range=function(h,g,A){var o=[],S;if(h=r.ceil(h),A=A==null?1:Math.floor(A),!(h<g)||!(A>0))return o;do o.push(S=new Date(+h)),d(h,A),c(h);while(S<h&&h<g);return o},r.filter=function(h){return a(function(g){if(g>=g)for(;c(g),!h(g);)g.setTime(g-1)},function(g,A){if(g>=g)if(A<0)for(;++A<=0;)for(;d(g,-1),!h(g););else for(;--A>=0;)for(;d(g,1),!h(g););})},m&&(r.count=function(h,g){return u.setTime(+h),i.setTime(+g),c(u),c(i),Math.floor(m(u,i))},r.every=function(h){return h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?r.filter(l?function(g){return l(g)%h===0}:function(g){return r.count(0,g)%h===0}):r}),r}},98179:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(11829),i=(0,u.Z)(function(){},function(d,m){d.setTime(+d+m)},function(d,m){return m-d});i.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?(0,u.Z)(function(m){m.setTime(Math.floor(m/d)*d)},function(m,l){m.setTime(+m+l*d)},function(m,l){return(l-m)/d}):i};const a=/^(1887|7596)$/.test(e.j)?null:i;var c=i.range},7197:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(11829),i=e(61222),a=(0,u.Z)(function(m){m.setTime(m-m.getMilliseconds()-m.getSeconds()*i.Ym)},function(m,l){m.setTime(+m+l*i.yB)},function(m,l){return(l-m)/i.yB},function(m){return m.getMinutes()});const c=/^(1887|7596)$/.test(e.j)?null:a;var d=a.range},4584:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(11829),i=(0,u.Z)(function(d){d.setDate(1),d.setHours(0,0,0,0)},function(d,m){d.setMonth(d.getMonth()+m)},function(d,m){return m.getMonth()-d.getMonth()+(m.getFullYear()-d.getFullYear())*12},function(d){return d.getMonth()});const a=/^(1887|7596)$/.test(e.j)?null:i;var c=i.range},15086:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(11829),i=e(61222),a=(0,u.Z)(function(m){m.setTime(m-m.getMilliseconds())},function(m,l){m.setTime(+m+l*i.Ym)},function(m,l){return(l-m)/i.Ym},function(m){return m.getUTCSeconds()});const c=/^(1887|7596)$/.test(e.j)?null:a;var d=a.range},89692:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>c});var u=e(11829),i=e(61222),a=(0,u.Z)(function(m){m.setUTCHours(0,0,0,0)},function(m,l){m.setUTCDate(m.getUTCDate()+l)},function(m,l){return(l-m)/i.UD},function(m){return m.getUTCDate()-1});const c=/^(1887|7596)$/.test(e.j)?null:a;var d=a.range},67519:(Xt,K,e)=>{"use strict";e.d(K,{Ox:()=>c,hB:()=>r,l6:()=>d});var u=e(11829),i=e(61222);function a(X){return(0,u.Z)(function(R){R.setUTCDate(R.getUTCDate()-(R.getUTCDay()+7-X)%7),R.setUTCHours(0,0,0,0)},function(R,M){R.setUTCDate(R.getUTCDate()+M*7)},function(R,M){return(M-R)/i.iM})}var c=a(0),d=a(1),m=a(2),l=a(3),r=a(4),h=a(5),g=a(6),A=c.range,o=d.range,S=m.range,T=l.range,E=r.range,b=h.range,C=g.range},31181:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(11829),i=(0,u.Z)(function(d){d.setUTCMonth(0,1),d.setUTCHours(0,0,0,0)},function(d,m){d.setUTCFullYear(d.getUTCFullYear()+m)},function(d,m){return m.getUTCFullYear()-d.getUTCFullYear()},function(d){return d.getUTCFullYear()});i.every=function(d){return!isFinite(d=Math.floor(d))||!(d>0)?null:(0,u.Z)(function(m){m.setUTCFullYear(Math.floor(m.getUTCFullYear()/d)*d),m.setUTCMonth(0,1),m.setUTCHours(0,0,0,0)},function(m,l){m.setUTCFullYear(m.getUTCFullYear()+l*d)})};const a=/^(1887|7596)$/.test(e.j)?null:i;var c=i.range},22776:(Xt,K,e)=>{"use strict";e.d(K,{OM:()=>c,bL:()=>r,wA:()=>d});var u=e(11829),i=e(61222);function a(X){return(0,u.Z)(function(R){R.setDate(R.getDate()-(R.getDay()+7-X)%7),R.setHours(0,0,0,0)},function(R,M){R.setDate(R.getDate()+M*7)},function(R,M){return(M-R-(M.getTimezoneOffset()-R.getTimezoneOffset())*i.yB)/i.iM})}var c=a(0),d=a(1),m=a(2),l=a(3),r=a(4),h=a(5),g=a(6),A=c.range,o=d.range,S=m.range,T=l.range,E=r.range,b=h.range,C=g.range},82209:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>a});var u=e(11829),i=(0,u.Z)(function(d){d.setMonth(0,1),d.setHours(0,0,0,0)},function(d,m){d.setFullYear(d.getFullYear()+m)},function(d,m){return m.getFullYear()-d.getFullYear()},function(d){return d.getFullYear()});i.every=function(d){return!isFinite(d=Math.floor(d))||!(d>0)?null:(0,u.Z)(function(m){m.setFullYear(Math.floor(m.getFullYear()/d)*d),m.setMonth(0,1),m.setHours(0,0,0,0)},function(m,l){m.setFullYear(m.getFullYear()+l*d)})};const a=/^(1887|7596)$/.test(e.j)?null:i;var c=i.range},9187:Xt=>{"use strict";Xt.exports=K,Xt.exports.default=K;function K(O,B,_){_=_||2;var H=B&&B.length,U=H?B[0]*_:O.length,V=e(O,0,U,_,!0),D=[];if(!V||V.next===V.prev)return D;var lt,J,Rt,kt,ne,re,It;if(H&&(V=l(O,B,V,_)),O.length>80*_){lt=Rt=O[0],J=kt=O[1];for(var Nt=_;Nt<U;Nt+=_)ne=O[Nt],re=O[Nt+1],ne<lt&&(lt=ne),re<J&&(J=re),ne>Rt&&(Rt=ne),re>kt&&(kt=re);It=Math.max(Rt-lt,kt-J),It=It!==0?32767/It:0}return i(V,D,_,lt,J,It,0),D}function e(O,B,_,H,U){var V,D;if(U===j(O,B,_,H)>0)for(V=B;V<_;V+=H)D=G(V,O[V],O[V+1],D);else for(V=_-H;V>=B;V-=H)D=G(V,O[V],O[V+1],D);return D&&R(D,D.next)&&(ut(D),D=D.next),D}function u(O,B){if(!O)return O;B||(B=O);var _=O,H;do if(H=!1,!_.steiner&&(R(_,_.next)||X(_.prev,_,_.next)===0)){if(ut(_),_=B=_.prev,_===_.next)break;H=!0}else _=_.next;while(H||_!==B);return B}function i(O,B,_,H,U,V,D){if(O){!D&&V&&o(O,H,U,V);for(var lt=O,J,Rt;O.prev!==O.next;){if(J=O.prev,Rt=O.next,V?c(O,H,U,V):a(O)){B.push(J.i/_|0),B.push(O.i/_|0),B.push(Rt.i/_|0),ut(O),O=Rt.next,lt=Rt.next;continue}if(O=Rt,O===lt){D?D===1?(O=d(u(O),B,_),i(O,B,_,H,U,V,2)):D===2&&m(O,B,_,H,U,V):i(u(O),B,_,H,U,V,1);break}}}}function a(O){var B=O.prev,_=O,H=O.next;if(X(B,_,H)>=0)return!1;for(var U=B.x,V=_.x,D=H.x,lt=B.y,J=_.y,Rt=H.y,kt=U<V?U<D?U:D:V<D?V:D,ne=lt<J?lt<Rt?lt:Rt:J<Rt?J:Rt,re=U>V?U>D?U:D:V>D?V:D,It=lt>J?lt>Rt?lt:Rt:J>Rt?J:Rt,Nt=H.next;Nt!==B;){if(Nt.x>=kt&&Nt.x<=re&&Nt.y>=ne&&Nt.y<=It&&b(U,lt,V,J,D,Rt,Nt.x,Nt.y)&&X(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.next}return!0}function c(O,B,_,H){var U=O.prev,V=O,D=O.next;if(X(U,V,D)>=0)return!1;for(var lt=U.x,J=V.x,Rt=D.x,kt=U.y,ne=V.y,re=D.y,It=lt<J?lt<Rt?lt:Rt:J<Rt?J:Rt,Nt=kt<ne?kt<re?kt:re:ne<re?ne:re,p=lt>J?lt>Rt?lt:Rt:J>Rt?J:Rt,w=kt>ne?kt>re?kt:re:ne>re?ne:re,W=T(It,Nt,B,_,H),st=T(p,w,B,_,H),Tt=O.prevZ,Gt=O.nextZ;Tt&&Tt.z>=W&&Gt&&Gt.z<=st;){if(Tt.x>=It&&Tt.x<=p&&Tt.y>=Nt&&Tt.y<=w&&Tt!==U&&Tt!==D&&b(lt,kt,J,ne,Rt,re,Tt.x,Tt.y)&&X(Tt.prev,Tt,Tt.next)>=0||(Tt=Tt.prevZ,Gt.x>=It&&Gt.x<=p&&Gt.y>=Nt&&Gt.y<=w&&Gt!==U&&Gt!==D&&b(lt,kt,J,ne,Rt,re,Gt.x,Gt.y)&&X(Gt.prev,Gt,Gt.next)>=0))return!1;Gt=Gt.nextZ}for(;Tt&&Tt.z>=W;){if(Tt.x>=It&&Tt.x<=p&&Tt.y>=Nt&&Tt.y<=w&&Tt!==U&&Tt!==D&&b(lt,kt,J,ne,Rt,re,Tt.x,Tt.y)&&X(Tt.prev,Tt,Tt.next)>=0)return!1;Tt=Tt.prevZ}for(;Gt&&Gt.z<=st;){if(Gt.x>=It&&Gt.x<=p&&Gt.y>=Nt&&Gt.y<=w&&Gt!==U&&Gt!==D&&b(lt,kt,J,ne,Rt,re,Gt.x,Gt.y)&&X(Gt.prev,Gt,Gt.next)>=0)return!1;Gt=Gt.nextZ}return!0}function d(O,B,_){var H=O;do{var U=H.prev,V=H.next.next;!R(U,V)&&M(U,H,H.next,V)&&Q(U,V)&&Q(V,U)&&(B.push(U.i/_|0),B.push(H.i/_|0),B.push(V.i/_|0),ut(H),ut(H.next),H=O=V),H=H.next}while(H!==O);return u(H)}function m(O,B,_,H,U,V){var D=O;do{for(var lt=D.next.next;lt!==D.prev;){if(D.i!==lt.i&&C(D,lt)){var J=I(D,lt);D=u(D,D.next),J=u(J,J.next),i(D,B,_,H,U,V,0),i(J,B,_,H,U,V,0);return}lt=lt.next}D=D.next}while(D!==O)}function l(O,B,_,H){var U=[],V,D,lt,J,Rt;for(V=0,D=B.length;V<D;V++)lt=B[V]*H,J=V<D-1?B[V+1]*H:O.length,Rt=e(O,lt,J,H,!1),Rt===Rt.next&&(Rt.steiner=!0),U.push(E(Rt));for(U.sort(r),V=0;V<U.length;V++)_=h(U[V],_);return _}function r(O,B){return O.x-B.x}function h(O,B){var _=g(O,B);if(!_)return B;var H=I(_,O);return u(H,H.next),u(_,_.next)}function g(O,B){var _=B,H=O.x,U=O.y,V=-1/0,D;do{if(U<=_.y&&U>=_.next.y&&_.next.y!==_.y){var lt=_.x+(U-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(lt<=H&&lt>V&&(V=lt,D=_.x<_.next.x?_:_.next,lt===H))return D}_=_.next}while(_!==B);if(!D)return null;var J=D,Rt=D.x,kt=D.y,ne=1/0,re;_=D;do H>=_.x&&_.x>=Rt&&H!==_.x&&b(U<kt?H:V,U,Rt,kt,U<kt?V:H,U,_.x,_.y)&&(re=Math.abs(U-_.y)/(H-_.x),Q(_,O)&&(re<ne||re===ne&&(_.x>D.x||_.x===D.x&&A(D,_)))&&(D=_,ne=re)),_=_.next;while(_!==J);return D}function A(O,B){return X(O.prev,O,B.prev)<0&&X(B.next,O,O.next)<0}function o(O,B,_,H){var U=O;do U.z===0&&(U.z=T(U.x,U.y,B,_,H)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==O);U.prevZ.nextZ=null,U.prevZ=null,S(U)}function S(O){var B,_,H,U,V,D,lt,J,Rt=1;do{for(_=O,O=null,V=null,D=0;_;){for(D++,H=_,lt=0,B=0;B<Rt&&(lt++,H=H.nextZ,!!H);B++);for(J=Rt;lt>0||J>0&&H;)lt!==0&&(J===0||!H||_.z<=H.z)?(U=_,_=_.nextZ,lt--):(U=H,H=H.nextZ,J--),V?V.nextZ=U:O=U,U.prevZ=V,V=U;_=H}V.nextZ=null,Rt*=2}while(D>1);return O}function T(O,B,_,H,U){return O=(O-_)*U|0,B=(B-H)*U|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,B=(B|B<<8)&16711935,B=(B|B<<4)&252645135,B=(B|B<<2)&858993459,B=(B|B<<1)&1431655765,O|B<<1}function E(O){var B=O,_=O;do(B.x<_.x||B.x===_.x&&B.y<_.y)&&(_=B),B=B.next;while(B!==O);return _}function b(O,B,_,H,U,V,D,lt){return(U-D)*(B-lt)>=(O-D)*(V-lt)&&(O-D)*(H-lt)>=(_-D)*(B-lt)&&(_-D)*(V-lt)>=(U-D)*(H-lt)}function C(O,B){return O.next.i!==B.i&&O.prev.i!==B.i&&!N(O,B)&&(Q(O,B)&&Q(B,O)&&ft(O,B)&&(X(O.prev,O,B.prev)||X(O,B.prev,B))||R(O,B)&&X(O.prev,O,O.next)>0&&X(B.prev,B,B.next)>0)}function X(O,B,_){return(B.y-O.y)*(_.x-B.x)-(B.x-O.x)*(_.y-B.y)}function R(O,B){return O.x===B.x&&O.y===B.y}function M(O,B,_,H){var U=rt(X(O,B,_)),V=rt(X(O,B,H)),D=rt(X(_,H,O)),lt=rt(X(_,H,B));return!!(U!==V&&D!==lt||U===0&&Z(O,_,B)||V===0&&Z(O,H,B)||D===0&&Z(_,O,H)||lt===0&&Z(_,B,H))}function Z(O,B,_){return B.x<=Math.max(O.x,_.x)&&B.x>=Math.min(O.x,_.x)&&B.y<=Math.max(O.y,_.y)&&B.y>=Math.min(O.y,_.y)}function rt(O){return O>0?1:O<0?-1:0}function N(O,B){var _=O;do{if(_.i!==O.i&&_.next.i!==O.i&&_.i!==B.i&&_.next.i!==B.i&&M(_,_.next,O,B))return!0;_=_.next}while(_!==O);return!1}function Q(O,B){return X(O.prev,O,O.next)<0?X(O,B,O.next)>=0&&X(O,O.prev,B)>=0:X(O,B,O.prev)<0||X(O,O.next,B)<0}function ft(O,B){var _=O,H=!1,U=(O.x+B.x)/2,V=(O.y+B.y)/2;do _.y>V!=_.next.y>V&&_.next.y!==_.y&&U<(_.next.x-_.x)*(V-_.y)/(_.next.y-_.y)+_.x&&(H=!H),_=_.next;while(_!==O);return H}function I(O,B){var _=new L(O.i,O.x,O.y),H=new L(B.i,B.x,B.y),U=O.next,V=B.prev;return O.next=B,B.prev=O,_.next=U,U.prev=_,H.next=_,_.prev=H,V.next=H,H.prev=V,H}function G(O,B,_,H){var U=new L(O,B,_);return H?(U.next=H.next,U.prev=H,H.next.prev=U,H.next=U):(U.prev=U,U.next=U),U}function ut(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function L(O,B,_){this.i=O,this.x=B,this.y=_,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}K.deviation=function(O,B,_,H){var U=B&&B.length,V=U?B[0]*_:O.length,D=Math.abs(j(O,0,V,_));if(U)for(var lt=0,J=B.length;lt<J;lt++){var Rt=B[lt]*_,kt=lt<J-1?B[lt+1]*_:O.length;D-=Math.abs(j(O,Rt,kt,_))}var ne=0;for(lt=0;lt<H.length;lt+=3){var re=H[lt]*_,It=H[lt+1]*_,Nt=H[lt+2]*_;ne+=Math.abs((O[re]-O[Nt])*(O[It+1]-O[re+1])-(O[re]-O[It])*(O[Nt+1]-O[re+1]))}return D===0&&ne===0?0:Math.abs((ne-D)/D)};function j(O,B,_,H){for(var U=0,V=B,D=_-H;V<_;V+=H)U+=(O[D]-O[V])*(O[V+1]+O[D+1]),D=V;return U}K.flatten=function(O){for(var B=O[0][0].length,_={vertices:[],holes:[],dimensions:B},H=0,U=0;U<O.length;U++){for(var V=0;V<O[U].length;V++)for(var D=0;D<B;D++)_.vertices.push(O[U][V][D]);U>0&&(H+=O[U-1].length,_.holes.push(H))}return _}},91780:(Xt,K,e)=>{"use strict";if(e.d(K,{Z:()=>i}),!/^(1887|7596)$/.test(e.j))var u=e(39341);function i(g,A,o,S,T,E,b,C){if(o/=A,S/=A,E>=o&&b<S)return g;if(b<o||E>=S)return null;for(var X=[],R=0;R<g.length;R++){var M=g[R],Z=M.geometry,rt=M.type,N=T===0?M.minX:M.minY,Q=T===0?M.maxX:M.maxY;if(N>=o&&Q<S){X.push(M);continue}else if(Q<o||N>=S)continue;var ft=[];if(rt==="Point"||rt==="MultiPoint")a(Z,ft,o,S,T);else if(rt==="LineString")c(Z,ft,o,S,T,!1,C.lineMetrics);else if(rt==="MultiLineString")m(Z,ft,o,S,T,!1);else if(rt==="Polygon")m(Z,ft,o,S,T,!0);else if(rt==="MultiPolygon")for(var I=0;I<Z.length;I++){var G=[];m(Z[I],G,o,S,T,!0),G.length&&ft.push(G)}if(ft.length){if(C.lineMetrics&&rt==="LineString"){for(I=0;I<ft.length;I++)X.push((0,u.Z)(M.id,rt,ft[I],M.tags));continue}(rt==="LineString"||rt==="MultiLineString")&&(ft.length===1?(rt="LineString",ft=ft[0]):rt="MultiLineString"),(rt==="Point"||rt==="MultiPoint")&&(rt=ft.length===3?"Point":"MultiPoint"),X.push((0,u.Z)(M.id,rt,ft,M.tags))}}return X.length?X:null}function a(g,A,o,S,T){for(var E=0;E<g.length;E+=3){var b=g[E+T];b>=o&&b<=S&&(A.push(g[E]),A.push(g[E+1]),A.push(g[E+2]))}}function c(g,A,o,S,T,E,b){for(var C=d(g),X=T===0?r:h,R=g.start,M,Z,rt=0;rt<g.length-3;rt+=3){var N=g[rt],Q=g[rt+1],ft=g[rt+2],I=g[rt+3],G=g[rt+4],ut=T===0?N:Q,L=T===0?I:G,j=!1;b&&(M=Math.sqrt(Math.pow(N-I,2)+Math.pow(Q-G,2))),ut<o?L>o&&(Z=X(C,N,Q,I,G,o),b&&(C.start=R+M*Z)):ut>S?L<S&&(Z=X(C,N,Q,I,G,S),b&&(C.start=R+M*Z)):l(C,N,Q,ft),L<o&&ut>=o&&(Z=X(C,N,Q,I,G,o),j=!0),L>S&&ut<=S&&(Z=X(C,N,Q,I,G,S),j=!0),!E&&j&&(b&&(C.end=R+M*Z),A.push(C),C=d(g)),b&&(R+=M)}var O=g.length-3;N=g[O],Q=g[O+1],ft=g[O+2],ut=T===0?N:Q,ut>=o&&ut<=S&&l(C,N,Q,ft),O=C.length-3,E&&O>=3&&(C[O]!==C[0]||C[O+1]!==C[1])&&l(C,C[0],C[1],C[2]),C.length&&A.push(C)}function d(g){var A=[];return A.size=g.size,A.start=g.start,A.end=g.end,A}function m(g,A,o,S,T,E){for(var b=0;b<g.length;b++)c(g[b],A,o,S,T,E,!1)}function l(g,A,o,S){g.push(A),g.push(o),g.push(S)}function r(g,A,o,S,T,E){var b=(E-A)/(S-A);return g.push(E),g.push(o+(T-o)*b),g.push(1),b}function h(g,A,o,S,T,E){var b=(E-o)/(T-o);return g.push(A+(S-A)*b),g.push(E),g.push(1),b}},39341:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(c,d,m,l){var r={id:typeof c>"u"?null:c,type:d,geometry:m,tags:l,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return i(r),r}function i(c){var d=c.geometry,m=c.type;if(m==="Point"||m==="MultiPoint"||m==="LineString")a(c,d);else if(m==="Polygon"||m==="MultiLineString")for(var l=0;l<d.length;l++)a(c,d[l]);else if(m==="MultiPolygon")for(l=0;l<d.length;l++)for(var r=0;r<d[l].length;r++)a(c,d[l][r])}function a(c,d){for(var m=0;m<d.length;m+=3)c.minX=Math.min(c.minX,d[m]),c.minY=Math.min(c.minY,d[m+1]),c.maxX=Math.max(c.maxX,d[m]),c.maxY=Math.max(c.maxY,d[m+1])}},22857:(Xt,K,e)=>{"use strict";e.d(K,{Z:()=>u});function u(a,c,d,m){for(var l=m,r=d-c>>1,h=d-c,g,A=a[c],o=a[c+1],S=a[d],T=a[d+1],E=c+3;E<d;E+=3){var b=i(a[E],a[E+1],A,o,S,T);if(b>l)g=E,l=b;else if(b===l){var C=Math.abs(E-r);C<h&&(g=E,h=C)}}l>m&&(g-c>3&&u(a,c,g,m),a[g+2]=l,d-g>3&&u(a,g,d,m))}function i(a,c,d,m,l,r){var h=l-d,g=r-m;if(h!==0||g!==0){var A=((a-d)*h+(c-m)*g)/(h*h+g*g);A>1?(d=l,m=r):A>0&&(d+=h*A,m+=g*A)}return h=a-d,g=c-m,h*h+g*g}},80645:(Xt,K)=>{K.read=function(e,u,i,a,c){var d,m,l=c*8-a-1,r=(1<<l)-1,h=r>>1,g=-7,A=i?c-1:0,o=i?-1:1,S=e[u+A];for(A+=o,d=S&(1<<-g)-1,S>>=-g,g+=l;g>0;d=d*256+e[u+A],A+=o,g-=8);for(m=d&(1<<-g)-1,d>>=-g,g+=a;g>0;m=m*256+e[u+A],A+=o,g-=8);if(d===0)d=1-h;else{if(d===r)return m?NaN:(S?-1:1)*(1/0);m=m+Math.pow(2,a),d=d-h}return(S?-1:1)*m*Math.pow(2,d-a)},K.write=function(e,u,i,a,c,d){var m,l,r,h=d*8-c-1,g=(1<<h)-1,A=g>>1,o=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=a?0:d-1,T=a?1:-1,E=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(l=isNaN(u)?1:0,m=g):(m=Math.floor(Math.log(u)/Math.LN2),u*(r=Math.pow(2,-m))<1&&(m--,r*=2),m+A>=1?u+=o/r:u+=o*Math.pow(2,1-A),u*r>=2&&(m++,r/=2),m+A>=g?(l=0,m=g):m+A>=1?(l=(u*r-1)*Math.pow(2,c),m=m+A):(l=u*Math.pow(2,A-1)*Math.pow(2,c),m=0));c>=8;e[i+S]=l&255,S+=T,l/=256,c-=8);for(m=m<<c|l,h+=c;h>0;e[i+S]=m&255,S+=T,m/=256,h-=8);e[i+S-T]|=E*128}},3614:(Xt,K,e)=>{"use strict";Xt.exports=i;var u=e(80645);function i(L){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(L)?L:new Uint8Array(L||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var a=65536*65536,c=1/a,d=12,m=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");i.prototype={destroy:function(){this.buf=null},readFields:function(L,j,O){for(O=O||this.length;this.pos<O;){var B=this.readVarint(),_=B>>3,H=this.pos;this.type=B&7,L(_,j,this),this.pos===H&&this.skip(B)}return j},readMessage:function(L,j){return this.readFields(L,j,this.readVarint()+this.pos)},readFixed32:function(){var L=N(this.buf,this.pos);return this.pos+=4,L},readSFixed32:function(){var L=ft(this.buf,this.pos);return this.pos+=4,L},readFixed64:function(){var L=N(this.buf,this.pos)+N(this.buf,this.pos+4)*a;return this.pos+=8,L},readSFixed64:function(){var L=N(this.buf,this.pos)+ft(this.buf,this.pos+4)*a;return this.pos+=8,L},readFloat:function(){var L=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,L},readDouble:function(){var L=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,L},readVarint:function(L){var j=this.buf,O,B;return B=j[this.pos++],O=B&127,B<128||(B=j[this.pos++],O|=(B&127)<<7,B<128)||(B=j[this.pos++],O|=(B&127)<<14,B<128)||(B=j[this.pos++],O|=(B&127)<<21,B<128)?O:(B=j[this.pos],O|=(B&15)<<28,l(O,L,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var L=this.readVarint();return L%2===1?(L+1)/-2:L/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var L=this.readVarint()+this.pos,j=this.pos;return this.pos=L,L-j>=d&&m?G(this.buf,j,L):I(this.buf,j,L)},readBytes:function(){var L=this.readVarint()+this.pos,j=this.buf.subarray(this.pos,L);return this.pos=L,j},readPackedVarint:function(L,j){if(this.type!==i.Bytes)return L.push(this.readVarint(j));var O=r(this);for(L=L||[];this.pos<O;)L.push(this.readVarint(j));return L},readPackedSVarint:function(L){if(this.type!==i.Bytes)return L.push(this.readSVarint());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readSVarint());return L},readPackedBoolean:function(L){if(this.type!==i.Bytes)return L.push(this.readBoolean());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readBoolean());return L},readPackedFloat:function(L){if(this.type!==i.Bytes)return L.push(this.readFloat());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readFloat());return L},readPackedDouble:function(L){if(this.type!==i.Bytes)return L.push(this.readDouble());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readDouble());return L},readPackedFixed32:function(L){if(this.type!==i.Bytes)return L.push(this.readFixed32());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readFixed32());return L},readPackedSFixed32:function(L){if(this.type!==i.Bytes)return L.push(this.readSFixed32());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readSFixed32());return L},readPackedFixed64:function(L){if(this.type!==i.Bytes)return L.push(this.readFixed64());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readFixed64());return L},readPackedSFixed64:function(L){if(this.type!==i.Bytes)return L.push(this.readSFixed64());var j=r(this);for(L=L||[];this.pos<j;)L.push(this.readSFixed64());return L},skip:function(L){var j=L&7;if(j===i.Varint)for(;this.buf[this.pos++]>127;);else if(j===i.Bytes)this.pos=this.readVarint()+this.pos;else if(j===i.Fixed32)this.pos+=4;else if(j===i.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+j)},writeTag:function(L,j){this.writeVarint(L<<3|j)},realloc:function(L){for(var j=this.length||16;j<this.pos+L;)j*=2;if(j!==this.length){var O=new Uint8Array(j);O.set(this.buf),this.buf=O,this.length=j}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(L){this.realloc(4),Q(this.buf,L,this.pos),this.pos+=4},writeSFixed32:function(L){this.realloc(4),Q(this.buf,L,this.pos),this.pos+=4},writeFixed64:function(L){this.realloc(8),Q(this.buf,L&-1,this.pos),Q(this.buf,Math.floor(L*c),this.pos+4),this.pos+=8},writeSFixed64:function(L){this.realloc(8),Q(this.buf,L&-1,this.pos),Q(this.buf,Math.floor(L*c),this.pos+4),this.pos+=8},writeVarint:function(L){if(L=+L||0,L>268435455||L<0){g(L,this);return}this.realloc(4),this.buf[this.pos++]=L&127|(L>127?128:0),!(L<=127)&&(this.buf[this.pos++]=(L>>>=7)&127|(L>127?128:0),!(L<=127)&&(this.buf[this.pos++]=(L>>>=7)&127|(L>127?128:0),!(L<=127)&&(this.buf[this.pos++]=L>>>7&127)))},writeSVarint:function(L){this.writeVarint(L<0?-L*2-1:L*2)},writeBoolean:function(L){this.writeVarint(!!L)},writeString:function(L){L=String(L),this.realloc(L.length*4),this.pos++;var j=this.pos;this.pos=ut(this.buf,L,this.pos);var O=this.pos-j;O>=128&&S(j,O,this),this.pos=j-1,this.writeVarint(O),this.pos+=O},writeFloat:function(L){this.realloc(4),u.write(this.buf,L,this.pos,!0,23,4),this.pos+=4},writeDouble:function(L){this.realloc(8),u.write(this.buf,L,this.pos,!0,52,8),this.pos+=8},writeBytes:function(L){var j=L.length;this.writeVarint(j),this.realloc(j);for(var O=0;O<j;O++)this.buf[this.pos++]=L[O]},writeRawMessage:function(L,j){this.pos++;var O=this.pos;L(j,this);var B=this.pos-O;B>=128&&S(O,B,this),this.pos=O-1,this.writeVarint(B),this.pos+=B},writeMessage:function(L,j,O){this.writeTag(L,i.Bytes),this.writeRawMessage(j,O)},writePackedVarint:function(L,j){j.length&&this.writeMessage(L,T,j)},writePackedSVarint:function(L,j){j.length&&this.writeMessage(L,E,j)},writePackedBoolean:function(L,j){j.length&&this.writeMessage(L,X,j)},writePackedFloat:function(L,j){j.length&&this.writeMessage(L,b,j)},writePackedDouble:function(L,j){j.length&&this.writeMessage(L,C,j)},writePackedFixed32:function(L,j){j.length&&this.writeMessage(L,R,j)},writePackedSFixed32:function(L,j){j.length&&this.writeMessage(L,M,j)},writePackedFixed64:function(L,j){j.length&&this.writeMessage(L,Z,j)},writePackedSFixed64:function(L,j){j.length&&this.writeMessage(L,rt,j)},writeBytesField:function(L,j){this.writeTag(L,i.Bytes),this.writeBytes(j)},writeFixed32Field:function(L,j){this.writeTag(L,i.Fixed32),this.writeFixed32(j)},writeSFixed32Field:function(L,j){this.writeTag(L,i.Fixed32),this.writeSFixed32(j)},writeFixed64Field:function(L,j){this.writeTag(L,i.Fixed64),this.writeFixed64(j)},writeSFixed64Field:function(L,j){this.writeTag(L,i.Fixed64),this.writeSFixed64(j)},writeVarintField:function(L,j){this.writeTag(L,i.Varint),this.writeVarint(j)},writeSVarintField:function(L,j){this.writeTag(L,i.Varint),this.writeSVarint(j)},writeStringField:function(L,j){this.writeTag(L,i.Bytes),this.writeString(j)},writeFloatField:function(L,j){this.writeTag(L,i.Fixed32),this.writeFloat(j)},writeDoubleField:function(L,j){this.writeTag(L,i.Fixed64),this.writeDouble(j)},writeBooleanField:function(L,j){this.writeVarintField(L,!!j)}};function l(L,j,O){var B=O.buf,_,H;if(H=B[O.pos++],_=(H&112)>>4,H<128||(H=B[O.pos++],_|=(H&127)<<3,H<128)||(H=B[O.pos++],_|=(H&127)<<10,H<128)||(H=B[O.pos++],_|=(H&127)<<17,H<128)||(H=B[O.pos++],_|=(H&127)<<24,H<128)||(H=B[O.pos++],_|=(H&1)<<31,H<128))return h(L,_,j);throw new Error("Expected varint not more than 10 bytes")}function r(L){return L.type===i.Bytes?L.readVarint()+L.pos:L.pos+1}function h(L,j,O){return O?j*4294967296+(L>>>0):(j>>>0)*4294967296+(L>>>0)}function g(L,j){var O,B;if(L>=0?(O=L%4294967296|0,B=L/4294967296|0):(O=~(-L%4294967296),B=~(-L/4294967296),O^4294967295?O=O+1|0:(O=0,B=B+1|0)),L>=18446744073709552e3||L<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");j.realloc(10),A(O,B,j),o(B,j)}function A(L,j,O){O.buf[O.pos++]=L&127|128,L>>>=7,O.buf[O.pos++]=L&127|128,L>>>=7,O.buf[O.pos++]=L&127|128,L>>>=7,O.buf[O.pos++]=L&127|128,L>>>=7,O.buf[O.pos]=L&127}function o(L,j){var O=(L&7)<<4;j.buf[j.pos++]|=O|((L>>>=3)?128:0),L&&(j.buf[j.pos++]=L&127|((L>>>=7)?128:0),L&&(j.buf[j.pos++]=L&127|((L>>>=7)?128:0),L&&(j.buf[j.pos++]=L&127|((L>>>=7)?128:0),L&&(j.buf[j.pos++]=L&127|((L>>>=7)?128:0),L&&(j.buf[j.pos++]=L&127)))))}function S(L,j,O){var B=j<=16383?1:j<=2097151?2:j<=268435455?3:Math.floor(Math.log(j)/(Math.LN2*7));O.realloc(B);for(var _=O.pos-1;_>=L;_--)O.buf[_+B]=O.buf[_]}function T(L,j){for(var O=0;O<L.length;O++)j.writeVarint(L[O])}function E(L,j){for(var O=0;O<L.length;O++)j.writeSVarint(L[O])}function b(L,j){for(var O=0;O<L.length;O++)j.writeFloat(L[O])}function C(L,j){for(var O=0;O<L.length;O++)j.writeDouble(L[O])}function X(L,j){for(var O=0;O<L.length;O++)j.writeBoolean(L[O])}function R(L,j){for(var O=0;O<L.length;O++)j.writeFixed32(L[O])}function M(L,j){for(var O=0;O<L.length;O++)j.writeSFixed32(L[O])}function Z(L,j){for(var O=0;O<L.length;O++)j.writeFixed64(L[O])}function rt(L,j){for(var O=0;O<L.length;O++)j.writeSFixed64(L[O])}function N(L,j){return(L[j]|L[j+1]<<8|L[j+2]<<16)+L[j+3]*16777216}function Q(L,j,O){L[O]=j,L[O+1]=j>>>8,L[O+2]=j>>>16,L[O+3]=j>>>24}function ft(L,j){return(L[j]|L[j+1]<<8|L[j+2]<<16)+(L[j+3]<<24)}function I(L,j,O){for(var B="",_=j;_<O;){var H=L[_],U=null,V=H>239?4:H>223?3:H>191?2:1;if(_+V>O)break;var D,lt,J;V===1?H<128&&(U=H):V===2?(D=L[_+1],(D&192)===128&&(U=(H&31)<<6|D&63,U<=127&&(U=null))):V===3?(D=L[_+1],lt=L[_+2],(D&192)===128&&(lt&192)===128&&(U=(H&15)<<12|(D&63)<<6|lt&63,(U<=2047||U>=55296&&U<=57343)&&(U=null))):V===4&&(D=L[_+1],lt=L[_+2],J=L[_+3],(D&192)===128&&(lt&192)===128&&(J&192)===128&&(U=(H&15)<<18|(D&63)<<12|(lt&63)<<6|J&63,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,V=1):U>65535&&(U-=65536,B+=String.fromCharCode(U>>>10&1023|55296),U=56320|U&1023),B+=String.fromCharCode(U),_+=V}return B}function G(L,j,O){return m.decode(L.subarray(j,O))}function ut(L,j,O){for(var B=0,_,H;B<j.length;B++){if(_=j.charCodeAt(B),_>55295&&_<57344)if(H)if(_<56320){L[O++]=239,L[O++]=191,L[O++]=189,H=_;continue}else _=H-55296<<10|_-56320|65536,H=null;else{_>56319||B+1===j.length?(L[O++]=239,L[O++]=191,L[O++]=189):H=_;continue}else H&&(L[O++]=239,L[O++]=191,L[O++]=189,H=null);_<128?L[O++]=_:(_<2048?L[O++]=_>>6|192:(_<65536?L[O++]=_>>12|224:(L[O++]=_>>18|240,L[O++]=_>>12&63|128),L[O++]=_>>6&63|128),L[O++]=_&63|128)}return O}},32676:function(Xt){(function(K,e){Xt.exports=e()})(this,function(){"use strict";function K(Zt,P){var Y={label:0,sent:function(){if(Et[0]&1)throw Et[1];return Et[1]},trys:[],ops:[]},pt,Ct,Et,pe;return pe={next:ae(0),throw:ae(1),return:ae(2)},typeof Symbol=="function"&&(pe[Symbol.iterator]=function(){return this}),pe;function ae(me){return function(en){return xe([me,en])}}function xe(me){if(pt)throw new TypeError("Generator is already executing.");for(;Y;)try{if(pt=1,Ct&&(Et=me[0]&2?Ct.return:me[0]?Ct.throw||((Et=Ct.return)&&Et.call(Ct),0):Ct.next)&&!(Et=Et.call(Ct,me[1])).done)return Et;switch(Ct=0,Et&&(me=[me[0]&2,Et.value]),me[0]){case 0:case 1:Et=me;break;case 4:return Y.label++,{value:me[1],done:!1};case 5:Y.label++,Ct=me[1],me=[0];continue;case 7:me=Y.ops.pop(),Y.trys.pop();continue;default:if(Et=Y.trys,!(Et=Et.length>0&&Et[Et.length-1])&&(me[0]===6||me[0]===2)){Y=0;continue}if(me[0]===3&&(!Et||me[1]>Et[0]&&me[1]<Et[3])){Y.label=me[1];break}if(me[0]===6&&Y.label<Et[1]){Y.label=Et[1],Et=me;break}if(Et&&Y.label<Et[2]){Y.label=Et[2],Y.ops.push(me);break}Et[2]&&Y.ops.pop(),Y.trys.pop();continue}me=P.call(Zt,Y)}catch(en){me=[6,en],Ct=0}finally{pt=Et=0}if(me[0]&5)throw me[1];return{value:me[0]?me[1]:void 0,done:!0}}}var e=function(){function Zt(P,Y){this.next=null,this.key=P,this.data=Y,this.left=null,this.right=null}return Zt}();function u(Zt,P){return Zt>P?1:Zt<P?-1:0}function i(Zt,P,Y){for(var pt=new e(null,null),Ct=pt,Et=pt;;){var pe=Y(Zt,P.key);if(pe<0){if(P.left===null)break;if(Y(Zt,P.left.key)<0){var ae=P.left;if(P.left=ae.right,ae.right=P,P=ae,P.left===null)break}Et.left=P,Et=P,P=P.left}else if(pe>0){if(P.right===null)break;if(Y(Zt,P.right.key)>0){var ae=P.right;if(P.right=ae.left,ae.left=P,P=ae,P.right===null)break}Ct.right=P,Ct=P,P=P.right}else break}return Ct.right=P.left,Et.left=P.right,P.left=pt.right,P.right=pt.left,P}function a(Zt,P,Y,pt){var Ct=new e(Zt,P);if(Y===null)return Ct.left=Ct.right=null,Ct;Y=i(Zt,Y,pt);var Et=pt(Zt,Y.key);return Et<0?(Ct.left=Y.left,Ct.right=Y,Y.left=null):Et>=0&&(Ct.right=Y.right,Ct.left=Y,Y.right=null),Ct}function c(Zt,P,Y){var pt=null,Ct=null;if(P){P=i(Zt,P,Y);var Et=Y(P.key,Zt);Et===0?(pt=P.left,Ct=P.right):Et<0?(Ct=P.right,P.right=null,pt=P):(pt=P.left,P.left=null,Ct=P)}return{left:pt,right:Ct}}function d(Zt,P,Y){return P===null?Zt:(Zt===null||(P=i(Zt.key,P,Y),P.left=Zt),P)}function m(Zt,P,Y,pt,Ct){if(Zt){pt(""+P+(Y?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ct(Zt)+`
`);var Et=P+(Y?"    ":"\u2502   ");Zt.left&&m(Zt.left,Et,!1,pt,Ct),Zt.right&&m(Zt.right,Et,!0,pt,Ct)}}var l=function(){function Zt(P){P===void 0&&(P=u),this._root=null,this._size=0,this._comparator=P}return Zt.prototype.insert=function(P,Y){return this._size++,this._root=a(P,Y,this._root,this._comparator)},Zt.prototype.add=function(P,Y){var pt=new e(P,Y);this._root===null&&(pt.left=pt.right=null,this._size++,this._root=pt);var Ct=this._comparator,Et=i(P,this._root,Ct),pe=Ct(P,Et.key);return pe===0?this._root=Et:(pe<0?(pt.left=Et.left,pt.right=Et,Et.left=null):pe>0&&(pt.right=Et.right,pt.left=Et,Et.right=null),this._size++,this._root=pt),this._root},Zt.prototype.remove=function(P){this._root=this._remove(P,this._root,this._comparator)},Zt.prototype._remove=function(P,Y,pt){var Ct;if(Y===null)return null;Y=i(P,Y,pt);var Et=pt(P,Y.key);return Et===0?(Y.left===null?Ct=Y.right:(Ct=i(P,Y.left,pt),Ct.right=Y.right),this._size--,Ct):Y},Zt.prototype.pop=function(){var P=this._root;if(P){for(;P.left;)P=P.left;return this._root=i(P.key,this._root,this._comparator),this._root=this._remove(P.key,this._root,this._comparator),{key:P.key,data:P.data}}return null},Zt.prototype.findStatic=function(P){for(var Y=this._root,pt=this._comparator;Y;){var Ct=pt(P,Y.key);if(Ct===0)return Y;Ct<0?Y=Y.left:Y=Y.right}return null},Zt.prototype.find=function(P){return this._root&&(this._root=i(P,this._root,this._comparator),this._comparator(P,this._root.key)!==0)?null:this._root},Zt.prototype.contains=function(P){for(var Y=this._root,pt=this._comparator;Y;){var Ct=pt(P,Y.key);if(Ct===0)return!0;Ct<0?Y=Y.left:Y=Y.right}return!1},Zt.prototype.forEach=function(P,Y){for(var pt=this._root,Ct=[],Et=!1;!Et;)pt!==null?(Ct.push(pt),pt=pt.left):Ct.length!==0?(pt=Ct.pop(),P.call(Y,pt),pt=pt.right):Et=!0;return this},Zt.prototype.range=function(P,Y,pt,Ct){for(var Et=[],pe=this._comparator,ae=this._root,xe;Et.length!==0||ae;)if(ae)Et.push(ae),ae=ae.left;else{if(ae=Et.pop(),xe=pe(ae.key,Y),xe>0)break;if(pe(ae.key,P)>=0&&pt.call(Ct,ae))return this;ae=ae.right}return this},Zt.prototype.keys=function(){var P=[];return this.forEach(function(Y){var pt=Y.key;return P.push(pt)}),P},Zt.prototype.values=function(){var P=[];return this.forEach(function(Y){var pt=Y.data;return P.push(pt)}),P},Zt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Zt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Zt.prototype.minNode=function(P){if(P===void 0&&(P=this._root),P)for(;P.left;)P=P.left;return P},Zt.prototype.maxNode=function(P){if(P===void 0&&(P=this._root),P)for(;P.right;)P=P.right;return P},Zt.prototype.at=function(P){for(var Y=this._root,pt=!1,Ct=0,Et=[];!pt;)if(Y)Et.push(Y),Y=Y.left;else if(Et.length>0){if(Y=Et.pop(),Ct===P)return Y;Ct++,Y=Y.right}else pt=!0;return null},Zt.prototype.next=function(P){var Y=this._root,pt=null;if(P.right){for(pt=P.right;pt.left;)pt=pt.left;return pt}for(var Ct=this._comparator;Y;){var Et=Ct(P.key,Y.key);if(Et===0)break;Et<0?(pt=Y,Y=Y.left):Y=Y.right}return pt},Zt.prototype.prev=function(P){var Y=this._root,pt=null;if(P.left!==null){for(pt=P.left;pt.right;)pt=pt.right;return pt}for(var Ct=this._comparator;Y;){var Et=Ct(P.key,Y.key);if(Et===0)break;Et<0?Y=Y.left:(pt=Y,Y=Y.right)}return pt},Zt.prototype.clear=function(){return this._root=null,this._size=0,this},Zt.prototype.toList=function(){return g(this._root)},Zt.prototype.load=function(P,Y,pt){Y===void 0&&(Y=[]),pt===void 0&&(pt=!1);var Ct=P.length,Et=this._comparator;if(pt&&S(P,Y,0,Ct-1,Et),this._root===null)this._root=r(P,Y,0,Ct),this._size=Ct;else{var pe=o(this.toList(),h(P,Y),Et);Ct=this._size+Ct,this._root=A({head:pe},0,Ct)}return this},Zt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Zt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Zt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Zt.prototype.toString=function(P){P===void 0&&(P=function(pt){return String(pt.key)});var Y=[];return m(this._root,"",!0,function(pt){return Y.push(pt)},P),Y.join("")},Zt.prototype.update=function(P,Y,pt){var Ct=this._comparator,Et=c(P,this._root,Ct),pe=Et.left,ae=Et.right;Ct(P,Y)<0?ae=a(Y,pt,ae,Ct):pe=a(Y,pt,pe,Ct),this._root=d(pe,ae,Ct)},Zt.prototype.split=function(P){return c(P,this._root,this._comparator)},Zt.prototype[Symbol.iterator]=function(){var P,Y,pt;return K(this,function(Ct){switch(Ct.label){case 0:P=this._root,Y=[],pt=!1,Ct.label=1;case 1:return pt?[3,6]:P===null?[3,2]:(Y.push(P),P=P.left,[3,5]);case 2:return Y.length===0?[3,4]:(P=Y.pop(),[4,P]);case 3:return Ct.sent(),P=P.right,[3,5];case 4:pt=!0,Ct.label=5;case 5:return[3,1];case 6:return[2]}})},Zt}();function r(Zt,P,Y,pt){var Ct=pt-Y;if(Ct>0){var Et=Y+Math.floor(Ct/2),pe=Zt[Et],ae=P[Et],xe=new e(pe,ae);return xe.left=r(Zt,P,Y,Et),xe.right=r(Zt,P,Et+1,pt),xe}return null}function h(Zt,P){for(var Y=new e(null,null),pt=Y,Ct=0;Ct<Zt.length;Ct++)pt=pt.next=new e(Zt[Ct],P[Ct]);return pt.next=null,Y.next}function g(Zt){for(var P=Zt,Y=[],pt=!1,Ct=new e(null,null),Et=Ct;!pt;)P?(Y.push(P),P=P.left):Y.length>0?(P=Et=Et.next=Y.pop(),P=P.right):pt=!0;return Et.next=null,Ct.next}function A(Zt,P,Y){var pt=Y-P;if(pt>0){var Ct=P+Math.floor(pt/2),Et=A(Zt,P,Ct),pe=Zt.head;return pe.left=Et,Zt.head=Zt.head.next,pe.right=A(Zt,Ct+1,Y),pe}return null}function o(Zt,P,Y){for(var pt=new e(null,null),Ct=pt,Et=Zt,pe=P;Et!==null&&pe!==null;)Y(Et.key,pe.key)<0?(Ct.next=Et,Et=Et.next):(Ct.next=pe,pe=pe.next),Ct=Ct.next;return Et!==null?Ct.next=Et:pe!==null&&(Ct.next=pe),pt.next}function S(Zt,P,Y,pt,Ct){if(!(Y>=pt)){for(var Et=Zt[Y+pt>>1],pe=Y-1,ae=pt+1;;){do pe++;while(Ct(Zt[pe],Et)<0);do ae--;while(Ct(Zt[ae],Et)>0);if(pe>=ae)break;var xe=Zt[pe];Zt[pe]=Zt[ae],Zt[ae]=xe,xe=P[pe],P[pe]=P[ae],P[ae]=xe}S(Zt,P,Y,ae,Ct),S(Zt,P,ae+1,pt,Ct)}}const T=(Zt,P)=>Zt.ll.x<=P.x&&P.x<=Zt.ur.x&&Zt.ll.y<=P.y&&P.y<=Zt.ur.y,E=(Zt,P)=>{if(P.ur.x<Zt.ll.x||Zt.ur.x<P.ll.x||P.ur.y<Zt.ll.y||Zt.ur.y<P.ll.y)return null;const Y=Zt.ll.x<P.ll.x?P.ll.x:Zt.ll.x,pt=Zt.ur.x<P.ur.x?Zt.ur.x:P.ur.x,Ct=Zt.ll.y<P.ll.y?P.ll.y:Zt.ll.y,Et=Zt.ur.y<P.ur.y?Zt.ur.y:P.ur.y;return{ll:{x:Y,y:Ct},ur:{x:pt,y:Et}}};let b=Number.EPSILON;b===void 0&&(b=Math.pow(2,-52));const C=b*b,X=(Zt,P)=>{if(-b<Zt&&Zt<b&&-b<P&&P<b)return 0;const Y=Zt-P;return Y*Y<C*Zt*P?0:Zt<P?-1:1};class R{constructor(){this.reset()}reset(){this.xRounder=new M,this.yRounder=new M}round(P,Y){return{x:this.xRounder.round(P),y:this.yRounder.round(Y)}}}class M{constructor(){this.tree=new l,this.round(0)}round(P){const Y=this.tree.add(P),pt=this.tree.prev(Y);if(pt!==null&&X(Y.key,pt.key)===0)return this.tree.remove(P),pt.key;const Ct=this.tree.next(Y);return Ct!==null&&X(Y.key,Ct.key)===0?(this.tree.remove(P),Ct.key):P}}const Z=new R,rt=11102230246251565e-32,N=134217729,Q=(3+8*rt)*rt;function ft(Zt,P,Y,pt,Ct){let Et,pe,ae,xe,me=P[0],en=pt[0],se=0,ye=0;en>me==en>-me?(Et=me,me=P[++se]):(Et=en,en=pt[++ye]);let ke=0;if(se<Zt&&ye<Y)for(en>me==en>-me?(pe=me+Et,ae=Et-(pe-me),me=P[++se]):(pe=en+Et,ae=Et-(pe-en),en=pt[++ye]),Et=pe,ae!==0&&(Ct[ke++]=ae);se<Zt&&ye<Y;)en>me==en>-me?(pe=Et+me,xe=pe-Et,ae=Et-(pe-xe)+(me-xe),me=P[++se]):(pe=Et+en,xe=pe-Et,ae=Et-(pe-xe)+(en-xe),en=pt[++ye]),Et=pe,ae!==0&&(Ct[ke++]=ae);for(;se<Zt;)pe=Et+me,xe=pe-Et,ae=Et-(pe-xe)+(me-xe),me=P[++se],Et=pe,ae!==0&&(Ct[ke++]=ae);for(;ye<Y;)pe=Et+en,xe=pe-Et,ae=Et-(pe-xe)+(en-xe),en=pt[++ye],Et=pe,ae!==0&&(Ct[ke++]=ae);return(Et!==0||ke===0)&&(Ct[ke++]=Et),ke}function I(Zt,P){let Y=P[0];for(let pt=1;pt<Zt;pt++)Y+=P[pt];return Y}function G(Zt){return new Float64Array(Zt)}const ut=(3+16*rt)*rt,L=(2+12*rt)*rt,j=(9+64*rt)*rt*rt,O=G(4),B=G(8),_=G(12),H=G(16),U=G(4);function V(Zt,P,Y,pt,Ct,Et,pe){let ae,xe,me,en,se,ye,ke,Rn,yn,_n,Cn,or,Tr,Qn,Sr,Lt,Wt,Re;const Ie=Zt-Ct,ar=Y-Ct,gr=P-Et,xr=pt-Et;Qn=Ie*xr,ye=N*Ie,ke=ye-(ye-Ie),Rn=Ie-ke,ye=N*xr,yn=ye-(ye-xr),_n=xr-yn,Sr=Rn*_n-(Qn-ke*yn-Rn*yn-ke*_n),Lt=gr*ar,ye=N*gr,ke=ye-(ye-gr),Rn=gr-ke,ye=N*ar,yn=ye-(ye-ar),_n=ar-yn,Wt=Rn*_n-(Lt-ke*yn-Rn*yn-ke*_n),Cn=Sr-Wt,se=Sr-Cn,O[0]=Sr-(Cn+se)+(se-Wt),or=Qn+Cn,se=or-Qn,Tr=Qn-(or-se)+(Cn-se),Cn=Tr-Lt,se=Tr-Cn,O[1]=Tr-(Cn+se)+(se-Lt),Re=or+Cn,se=Re-or,O[2]=or-(Re-se)+(Cn-se),O[3]=Re;let Dr=I(4,O),Qr=L*pe;if(Dr>=Qr||-Dr>=Qr||(se=Zt-Ie,ae=Zt-(Ie+se)+(se-Ct),se=Y-ar,me=Y-(ar+se)+(se-Ct),se=P-gr,xe=P-(gr+se)+(se-Et),se=pt-xr,en=pt-(xr+se)+(se-Et),ae===0&&xe===0&&me===0&&en===0)||(Qr=j*pe+Q*Math.abs(Dr),Dr+=Ie*en+xr*ae-(gr*me+ar*xe),Dr>=Qr||-Dr>=Qr))return Dr;Qn=ae*xr,ye=N*ae,ke=ye-(ye-ae),Rn=ae-ke,ye=N*xr,yn=ye-(ye-xr),_n=xr-yn,Sr=Rn*_n-(Qn-ke*yn-Rn*yn-ke*_n),Lt=xe*ar,ye=N*xe,ke=ye-(ye-xe),Rn=xe-ke,ye=N*ar,yn=ye-(ye-ar),_n=ar-yn,Wt=Rn*_n-(Lt-ke*yn-Rn*yn-ke*_n),Cn=Sr-Wt,se=Sr-Cn,U[0]=Sr-(Cn+se)+(se-Wt),or=Qn+Cn,se=or-Qn,Tr=Qn-(or-se)+(Cn-se),Cn=Tr-Lt,se=Tr-Cn,U[1]=Tr-(Cn+se)+(se-Lt),Re=or+Cn,se=Re-or,U[2]=or-(Re-se)+(Cn-se),U[3]=Re;const Hi=ft(4,O,4,U,B);Qn=Ie*en,ye=N*Ie,ke=ye-(ye-Ie),Rn=Ie-ke,ye=N*en,yn=ye-(ye-en),_n=en-yn,Sr=Rn*_n-(Qn-ke*yn-Rn*yn-ke*_n),Lt=gr*me,ye=N*gr,ke=ye-(ye-gr),Rn=gr-ke,ye=N*me,yn=ye-(ye-me),_n=me-yn,Wt=Rn*_n-(Lt-ke*yn-Rn*yn-ke*_n),Cn=Sr-Wt,se=Sr-Cn,U[0]=Sr-(Cn+se)+(se-Wt),or=Qn+Cn,se=or-Qn,Tr=Qn-(or-se)+(Cn-se),Cn=Tr-Lt,se=Tr-Cn,U[1]=Tr-(Cn+se)+(se-Lt),Re=or+Cn,se=Re-or,U[2]=or-(Re-se)+(Cn-se),U[3]=Re;const Oi=ft(Hi,B,4,U,_);Qn=ae*en,ye=N*ae,ke=ye-(ye-ae),Rn=ae-ke,ye=N*en,yn=ye-(ye-en),_n=en-yn,Sr=Rn*_n-(Qn-ke*yn-Rn*yn-ke*_n),Lt=xe*me,ye=N*xe,ke=ye-(ye-xe),Rn=xe-ke,ye=N*me,yn=ye-(ye-me),_n=me-yn,Wt=Rn*_n-(Lt-ke*yn-Rn*yn-ke*_n),Cn=Sr-Wt,se=Sr-Cn,U[0]=Sr-(Cn+se)+(se-Wt),or=Qn+Cn,se=or-Qn,Tr=Qn-(or-se)+(Cn-se),Cn=Tr-Lt,se=Tr-Cn,U[1]=Tr-(Cn+se)+(se-Lt),Re=or+Cn,se=Re-or,U[2]=or-(Re-se)+(Cn-se),U[3]=Re;const Ei=ft(Oi,_,4,U,H);return H[Ei-1]}function D(Zt,P,Y,pt,Ct,Et){const pe=(P-Et)*(Y-Ct),ae=(Zt-Ct)*(pt-Et),xe=pe-ae,me=Math.abs(pe+ae);return Math.abs(xe)>=ut*me?xe:-V(Zt,P,Y,pt,Ct,Et,me)}const lt=(Zt,P)=>Zt.x*P.y-Zt.y*P.x,J=(Zt,P)=>Zt.x*P.x+Zt.y*P.y,Rt=(Zt,P,Y)=>{const pt=D(Zt.x,Zt.y,P.x,P.y,Y.x,Y.y);return pt>0?-1:pt<0?1:0},kt=Zt=>Math.sqrt(J(Zt,Zt)),ne=(Zt,P,Y)=>{const pt={x:P.x-Zt.x,y:P.y-Zt.y},Ct={x:Y.x-Zt.x,y:Y.y-Zt.y};return lt(Ct,pt)/kt(Ct)/kt(pt)},re=(Zt,P,Y)=>{const pt={x:P.x-Zt.x,y:P.y-Zt.y},Ct={x:Y.x-Zt.x,y:Y.y-Zt.y};return J(Ct,pt)/kt(Ct)/kt(pt)},It=(Zt,P,Y)=>P.y===0?null:{x:Zt.x+P.x/P.y*(Y-Zt.y),y:Y},Nt=(Zt,P,Y)=>P.x===0?null:{x:Y,y:Zt.y+P.y/P.x*(Y-Zt.x)},p=(Zt,P,Y,pt)=>{if(P.x===0)return Nt(Y,pt,Zt.x);if(pt.x===0)return Nt(Zt,P,Y.x);if(P.y===0)return It(Y,pt,Zt.y);if(pt.y===0)return It(Zt,P,Y.y);const Ct=lt(P,pt);if(Ct==0)return null;const Et={x:Y.x-Zt.x,y:Y.y-Zt.y},pe=lt(Et,P)/Ct,ae=lt(Et,pt)/Ct,xe=Zt.x+ae*P.x,me=Y.x+pe*pt.x,en=Zt.y+ae*P.y,se=Y.y+pe*pt.y,ye=(xe+me)/2,ke=(en+se)/2;return{x:ye,y:ke}};class w{static compare(P,Y){const pt=w.comparePoints(P.point,Y.point);return pt!==0?pt:(P.point!==Y.point&&P.link(Y),P.isLeft!==Y.isLeft?P.isLeft?1:-1:st.compare(P.segment,Y.segment))}static comparePoints(P,Y){return P.x<Y.x?-1:P.x>Y.x?1:P.y<Y.y?-1:P.y>Y.y?1:0}constructor(P,Y){P.events===void 0?P.events=[this]:P.events.push(this),this.point=P,this.isLeft=Y}link(P){if(P.point===this.point)throw new Error("Tried to link already linked events");const Y=P.point.events;for(let pt=0,Ct=Y.length;pt<Ct;pt++){const Et=Y[pt];this.point.events.push(Et),Et.point=this.point}this.checkForConsuming()}checkForConsuming(){const P=this.point.events.length;for(let Y=0;Y<P;Y++){const pt=this.point.events[Y];if(pt.segment.consumedBy===void 0)for(let Ct=Y+1;Ct<P;Ct++){const Et=this.point.events[Ct];Et.consumedBy===void 0&&pt.otherSE.point.events===Et.otherSE.point.events&&pt.segment.consume(Et.segment)}}}getAvailableLinkedEvents(){const P=[];for(let Y=0,pt=this.point.events.length;Y<pt;Y++){const Ct=this.point.events[Y];Ct!==this&&!Ct.segment.ringOut&&Ct.segment.isInResult()&&P.push(Ct)}return P}getLeftmostComparator(P){const Y=new Map,pt=Ct=>{const Et=Ct.otherSE;Y.set(Ct,{sine:ne(this.point,P.point,Et.point),cosine:re(this.point,P.point,Et.point)})};return(Ct,Et)=>{Y.has(Ct)||pt(Ct),Y.has(Et)||pt(Et);const{sine:pe,cosine:ae}=Y.get(Ct),{sine:xe,cosine:me}=Y.get(Et);return pe>=0&&xe>=0?ae<me?1:ae>me?-1:0:pe<0&&xe<0?ae<me?-1:ae>me?1:0:xe<pe?-1:xe>pe?1:0}}}let W=0;class st{static compare(P,Y){const pt=P.leftSE.point.x,Ct=Y.leftSE.point.x,Et=P.rightSE.point.x,pe=Y.rightSE.point.x;if(pe<pt)return 1;if(Et<Ct)return-1;const ae=P.leftSE.point.y,xe=Y.leftSE.point.y,me=P.rightSE.point.y,en=Y.rightSE.point.y;if(pt<Ct){if(xe<ae&&xe<me)return 1;if(xe>ae&&xe>me)return-1;const se=P.comparePoint(Y.leftSE.point);if(se<0)return 1;if(se>0)return-1;const ye=Y.comparePoint(P.rightSE.point);return ye!==0?ye:-1}if(pt>Ct){if(ae<xe&&ae<en)return-1;if(ae>xe&&ae>en)return 1;const se=Y.comparePoint(P.leftSE.point);if(se!==0)return se;const ye=P.comparePoint(Y.rightSE.point);return ye<0?1:ye>0?-1:1}if(ae<xe)return-1;if(ae>xe)return 1;if(Et<pe){const se=Y.comparePoint(P.rightSE.point);if(se!==0)return se}if(Et>pe){const se=P.comparePoint(Y.rightSE.point);if(se<0)return 1;if(se>0)return-1}if(Et!==pe){const se=me-ae,ye=Et-pt,ke=en-xe,Rn=pe-Ct;if(se>ye&&ke<Rn)return 1;if(se<ye&&ke>Rn)return-1}return Et>pe?1:Et<pe||me<en?-1:me>en?1:P.id<Y.id?-1:P.id>Y.id?1:0}constructor(P,Y,pt,Ct){this.id=++W,this.leftSE=P,P.segment=this,P.otherSE=Y,this.rightSE=Y,Y.segment=this,Y.otherSE=P,this.rings=pt,this.windings=Ct}static fromRing(P,Y,pt){let Ct,Et,pe;const ae=w.comparePoints(P,Y);if(ae<0)Ct=P,Et=Y,pe=1;else if(ae>0)Ct=Y,Et=P,pe=-1;else throw new Error(`Tried to create degenerate segment at [${P.x}, ${P.y}]`);const xe=new w(Ct,!0),me=new w(Et,!1);return new st(xe,me,[pt],[pe])}replaceRightSE(P){this.rightSE=P,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const P=this.leftSE.point.y,Y=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:P<Y?P:Y},ur:{x:this.rightSE.point.x,y:P>Y?P:Y}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(P){return P.x===this.leftSE.point.x&&P.y===this.leftSE.point.y||P.x===this.rightSE.point.x&&P.y===this.rightSE.point.y}comparePoint(P){if(this.isAnEndpoint(P))return 0;const Y=this.leftSE.point,pt=this.rightSE.point,Ct=this.vector();if(Y.x===pt.x)return P.x===Y.x?0:P.x<Y.x?1:-1;const Et=(P.y-Y.y)/Ct.y,pe=Y.x+Et*Ct.x;if(P.x===pe)return 0;const ae=(P.x-Y.x)/Ct.x,xe=Y.y+ae*Ct.y;return P.y===xe?0:P.y<xe?-1:1}getIntersection(P){const Y=this.bbox(),pt=P.bbox(),Ct=E(Y,pt);if(Ct===null)return null;const Et=this.leftSE.point,pe=this.rightSE.point,ae=P.leftSE.point,xe=P.rightSE.point,me=T(Y,ae)&&this.comparePoint(ae)===0,en=T(pt,Et)&&P.comparePoint(Et)===0,se=T(Y,xe)&&this.comparePoint(xe)===0,ye=T(pt,pe)&&P.comparePoint(pe)===0;if(en&&me)return ye&&!se?pe:!ye&&se?xe:null;if(en)return se&&Et.x===xe.x&&Et.y===xe.y?null:Et;if(me)return ye&&pe.x===ae.x&&pe.y===ae.y?null:ae;if(ye&&se)return null;if(ye)return pe;if(se)return xe;const ke=p(Et,this.vector(),ae,P.vector());return ke===null||!T(Ct,ke)?null:Z.round(ke.x,ke.y)}split(P){const Y=[],pt=P.events!==void 0,Ct=new w(P,!0),Et=new w(P,!1),pe=this.rightSE;this.replaceRightSE(Et),Y.push(Et),Y.push(Ct);const ae=new st(Ct,pe,this.rings.slice(),this.windings.slice());return w.comparePoints(ae.leftSE.point,ae.rightSE.point)>0&&ae.swapEvents(),w.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),pt&&(Ct.checkForConsuming(),Et.checkForConsuming()),Y}swapEvents(){const P=this.rightSE;this.rightSE=this.leftSE,this.leftSE=P,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let Y=0,pt=this.windings.length;Y<pt;Y++)this.windings[Y]*=-1}consume(P){let Y=this,pt=P;for(;Y.consumedBy;)Y=Y.consumedBy;for(;pt.consumedBy;)pt=pt.consumedBy;const Ct=st.compare(Y,pt);if(Ct!==0){if(Ct>0){const Et=Y;Y=pt,pt=Et}if(Y.prev===pt){const Et=Y;Y=pt,pt=Et}for(let Et=0,pe=pt.rings.length;Et<pe;Et++){const ae=pt.rings[Et],xe=pt.windings[Et],me=Y.rings.indexOf(ae);me===-1?(Y.rings.push(ae),Y.windings.push(xe)):Y.windings[me]+=xe}pt.rings=null,pt.windings=null,pt.consumedBy=Y,pt.leftSE.consumedBy=Y.leftSE,pt.rightSE.consumedBy=Y.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const P=this.prev.consumedBy||this.prev;this._beforeState=P.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const P=this.beforeState();this._afterState={rings:P.rings.slice(0),windings:P.windings.slice(0),multiPolys:[]};const Y=this._afterState.rings,pt=this._afterState.windings,Ct=this._afterState.multiPolys;for(let ae=0,xe=this.rings.length;ae<xe;ae++){const me=this.rings[ae],en=this.windings[ae],se=Y.indexOf(me);se===-1?(Y.push(me),pt.push(en)):pt[se]+=en}const Et=[],pe=[];for(let ae=0,xe=Y.length;ae<xe;ae++){if(pt[ae]===0)continue;const me=Y[ae],en=me.poly;if(pe.indexOf(en)===-1)if(me.isExterior)Et.push(en);else{pe.indexOf(en)===-1&&pe.push(en);const se=Et.indexOf(me.poly);se!==-1&&Et.splice(se,1)}}for(let ae=0,xe=Et.length;ae<xe;ae++){const me=Et[ae].multiPoly;Ct.indexOf(me)===-1&&Ct.push(me)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const P=this.beforeState().multiPolys,Y=this.afterState().multiPolys;switch(sr.type){case"union":{const pt=P.length===0,Ct=Y.length===0;this._isInResult=pt!==Ct;break}case"intersection":{let pt,Ct;P.length<Y.length?(pt=P.length,Ct=Y.length):(pt=Y.length,Ct=P.length),this._isInResult=Ct===sr.numMultiPolys&&pt<Ct;break}case"xor":{const pt=Math.abs(P.length-Y.length);this._isInResult=pt%2===1;break}case"difference":{const pt=Ct=>Ct.length===1&&Ct[0].isSubject;this._isInResult=pt(P)!==pt(Y);break}default:throw new Error(`Unrecognized operation type found ${sr.type}`)}return this._isInResult}}class Tt{constructor(P,Y,pt){if(!Array.isArray(P)||P.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=Y,this.isExterior=pt,this.segments=[],typeof P[0][0]!="number"||typeof P[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Ct=Z.round(P[0][0],P[0][1]);this.bbox={ll:{x:Ct.x,y:Ct.y},ur:{x:Ct.x,y:Ct.y}};let Et=Ct;for(let pe=1,ae=P.length;pe<ae;pe++){if(typeof P[pe][0]!="number"||typeof P[pe][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let xe=Z.round(P[pe][0],P[pe][1]);xe.x===Et.x&&xe.y===Et.y||(this.segments.push(st.fromRing(Et,xe,this)),xe.x<this.bbox.ll.x&&(this.bbox.ll.x=xe.x),xe.y<this.bbox.ll.y&&(this.bbox.ll.y=xe.y),xe.x>this.bbox.ur.x&&(this.bbox.ur.x=xe.x),xe.y>this.bbox.ur.y&&(this.bbox.ur.y=xe.y),Et=xe)}(Ct.x!==Et.x||Ct.y!==Et.y)&&this.segments.push(st.fromRing(Et,Ct,this))}getSweepEvents(){const P=[];for(let Y=0,pt=this.segments.length;Y<pt;Y++){const Ct=this.segments[Y];P.push(Ct.leftSE),P.push(Ct.rightSE)}return P}}class Gt{constructor(P,Y){if(!Array.isArray(P))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tt(P[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let pt=1,Ct=P.length;pt<Ct;pt++){const Et=new Tt(P[pt],this,!1);Et.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Et.bbox.ll.x),Et.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Et.bbox.ll.y),Et.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Et.bbox.ur.x),Et.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Et.bbox.ur.y),this.interiorRings.push(Et)}this.multiPoly=Y}getSweepEvents(){const P=this.exteriorRing.getSweepEvents();for(let Y=0,pt=this.interiorRings.length;Y<pt;Y++){const Ct=this.interiorRings[Y].getSweepEvents();for(let Et=0,pe=Ct.length;Et<pe;Et++)P.push(Ct[Et])}return P}}class ze{constructor(P,Y){if(!Array.isArray(P))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof P[0][0][0]=="number"&&(P=[P])}catch(pt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let pt=0,Ct=P.length;pt<Ct;pt++){const Et=new Gt(P[pt],this);Et.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Et.bbox.ll.x),Et.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Et.bbox.ll.y),Et.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Et.bbox.ur.x),Et.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Et.bbox.ur.y),this.polys.push(Et)}this.isSubject=Y}getSweepEvents(){const P=[];for(let Y=0,pt=this.polys.length;Y<pt;Y++){const Ct=this.polys[Y].getSweepEvents();for(let Et=0,pe=Ct.length;Et<pe;Et++)P.push(Ct[Et])}return P}}class $e{static factory(P){const Y=[];for(let pt=0,Ct=P.length;pt<Ct;pt++){const Et=P[pt];if(!Et.isInResult()||Et.ringOut)continue;let pe=null,ae=Et.leftSE,xe=Et.rightSE;const me=[ae],en=ae.point,se=[];for(;pe=ae,ae=xe,me.push(ae),ae.point!==en;)for(;;){const ye=ae.getAvailableLinkedEvents();if(ye.length===0){const yn=me[0].point,_n=me[me.length-1].point;throw new Error(`Unable to complete output ring starting at [${yn.x}, ${yn.y}]. Last matching segment found ends at [${_n.x}, ${_n.y}].`)}if(ye.length===1){xe=ye[0].otherSE;break}let ke=null;for(let yn=0,_n=se.length;yn<_n;yn++)if(se[yn].point===ae.point){ke=yn;break}if(ke!==null){const yn=se.splice(ke)[0],_n=me.splice(yn.index);_n.unshift(_n[0].otherSE),Y.push(new $e(_n.reverse()));continue}se.push({index:me.length,point:ae.point});const Rn=ae.getLeftmostComparator(pe);xe=ye.sort(Rn)[0].otherSE;break}Y.push(new $e(me))}return Y}constructor(P){this.events=P;for(let Y=0,pt=P.length;Y<pt;Y++)P[Y].segment.ringOut=this;this.poly=null}getGeom(){let P=this.events[0].point;const Y=[P];for(let me=1,en=this.events.length-1;me<en;me++){const se=this.events[me].point,ye=this.events[me+1].point;Rt(se,P,ye)!==0&&(Y.push(se),P=se)}if(Y.length===1)return null;const pt=Y[0],Ct=Y[1];Rt(pt,P,Ct)===0&&Y.shift(),Y.push(Y[0]);const Et=this.isExteriorRing()?1:-1,pe=this.isExteriorRing()?0:Y.length-1,ae=this.isExteriorRing()?Y.length:-1,xe=[];for(let me=pe;me!=ae;me+=Et)xe.push([Y[me].x,Y[me].y]);return xe}isExteriorRing(){if(this._isExteriorRing===void 0){const P=this.enclosingRing();this._isExteriorRing=P?!P.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let P=this.events[0];for(let Ct=1,Et=this.events.length;Ct<Et;Ct++){const pe=this.events[Ct];w.compare(P,pe)>0&&(P=pe)}let Y=P.segment.prevInResult(),pt=Y?Y.prevInResult():null;for(;;){if(!Y)return null;if(!pt)return Y.ringOut;if(pt.ringOut!==Y.ringOut)return pt.ringOut.enclosingRing()!==Y.ringOut?Y.ringOut:Y.ringOut.enclosingRing();Y=pt.prevInResult(),pt=Y?Y.prevInResult():null}}}class rn{constructor(P){this.exteriorRing=P,P.poly=this,this.interiorRings=[]}addInterior(P){this.interiorRings.push(P),P.poly=this}getGeom(){const P=[this.exteriorRing.getGeom()];if(P[0]===null)return null;for(let Y=0,pt=this.interiorRings.length;Y<pt;Y++){const Ct=this.interiorRings[Y].getGeom();Ct!==null&&P.push(Ct)}return P}}class gn{constructor(P){this.rings=P,this.polys=this._composePolys(P)}getGeom(){const P=[];for(let Y=0,pt=this.polys.length;Y<pt;Y++){const Ct=this.polys[Y].getGeom();Ct!==null&&P.push(Ct)}return P}_composePolys(P){const Y=[];for(let pt=0,Ct=P.length;pt<Ct;pt++){const Et=P[pt];if(!Et.poly)if(Et.isExteriorRing())Y.push(new rn(Et));else{const pe=Et.enclosingRing();pe.poly||Y.push(new rn(pe)),pe.poly.addInterior(Et)}}return Y}}class nt{constructor(P){let Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:st.compare;this.queue=P,this.tree=new l(Y),this.segments=[]}process(P){const Y=P.segment,pt=[];if(P.consumedBy)return P.isLeft?this.queue.remove(P.otherSE):this.tree.remove(Y),pt;const Ct=P.isLeft?this.tree.add(Y):this.tree.find(Y);if(!Ct)throw new Error(`Unable to find segment #${Y.id} [${Y.leftSE.point.x}, ${Y.leftSE.point.y}] -> [${Y.rightSE.point.x}, ${Y.rightSE.point.y}] in SweepLine tree.`);let Et=Ct,pe=Ct,ae,xe;for(;ae===void 0;)Et=this.tree.prev(Et),Et===null?ae=null:Et.key.consumedBy===void 0&&(ae=Et.key);for(;xe===void 0;)pe=this.tree.next(pe),pe===null?xe=null:pe.key.consumedBy===void 0&&(xe=pe.key);if(P.isLeft){let me=null;if(ae){const se=ae.getIntersection(Y);if(se!==null&&(Y.isAnEndpoint(se)||(me=se),!ae.isAnEndpoint(se))){const ye=this._splitSafely(ae,se);for(let ke=0,Rn=ye.length;ke<Rn;ke++)pt.push(ye[ke])}}let en=null;if(xe){const se=xe.getIntersection(Y);if(se!==null&&(Y.isAnEndpoint(se)||(en=se),!xe.isAnEndpoint(se))){const ye=this._splitSafely(xe,se);for(let ke=0,Rn=ye.length;ke<Rn;ke++)pt.push(ye[ke])}}if(me!==null||en!==null){let se=null;me===null?se=en:en===null?se=me:se=w.comparePoints(me,en)<=0?me:en,this.queue.remove(Y.rightSE),pt.push(Y.rightSE);const ye=Y.split(se);for(let ke=0,Rn=ye.length;ke<Rn;ke++)pt.push(ye[ke])}pt.length>0?(this.tree.remove(Y),pt.push(P)):(this.segments.push(Y),Y.prev=ae)}else{if(ae&&xe){const me=ae.getIntersection(xe);if(me!==null){if(!ae.isAnEndpoint(me)){const en=this._splitSafely(ae,me);for(let se=0,ye=en.length;se<ye;se++)pt.push(en[se])}if(!xe.isAnEndpoint(me)){const en=this._splitSafely(xe,me);for(let se=0,ye=en.length;se<ye;se++)pt.push(en[se])}}}this.tree.remove(Y)}return pt}_splitSafely(P,Y){this.tree.remove(P);const pt=P.rightSE;this.queue.remove(pt);const Ct=P.split(Y);return Ct.push(pt),P.consumedBy===void 0&&this.tree.add(P),Ct}}const Ln=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,rr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class tr{run(P,Y,pt){sr.type=P,Z.reset();const Ct=[new ze(Y,!0)];for(let se=0,ye=pt.length;se<ye;se++)Ct.push(new ze(pt[se],!1));if(sr.numMultiPolys=Ct.length,sr.type==="difference"){const se=Ct[0];let ye=1;for(;ye<Ct.length;)E(Ct[ye].bbox,se.bbox)!==null?ye++:Ct.splice(ye,1)}if(sr.type==="intersection")for(let se=0,ye=Ct.length;se<ye;se++){const ke=Ct[se];for(let Rn=se+1,yn=Ct.length;Rn<yn;Rn++)if(E(ke.bbox,Ct[Rn].bbox)===null)return[]}const Et=new l(w.compare);for(let se=0,ye=Ct.length;se<ye;se++){const ke=Ct[se].getSweepEvents();for(let Rn=0,yn=ke.length;Rn<yn;Rn++)if(Et.insert(ke[Rn]),Et.size>Ln)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const pe=new nt(Et);let ae=Et.size,xe=Et.pop();for(;xe;){const se=xe.key;if(Et.size===ae){const ke=se.segment;throw new Error(`Unable to pop() ${se.isLeft?"left":"right"} SweepEvent [${se.point.x}, ${se.point.y}] from segment #${ke.id} [${ke.leftSE.point.x}, ${ke.leftSE.point.y}] -> [${ke.rightSE.point.x}, ${ke.rightSE.point.y}] from queue.`)}if(Et.size>Ln)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(pe.segments.length>rr)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const ye=pe.process(se);for(let ke=0,Rn=ye.length;ke<Rn;ke++){const yn=ye[ke];yn.consumedBy===void 0&&Et.insert(yn)}ae=Et.size,xe=Et.pop()}Z.reset();const me=$e.factory(pe.segments);return new gn(me).getGeom()}}const sr=new tr;var Wr={union:function(Zt){for(var P=arguments.length,Y=new Array(P>1?P-1:0),pt=1;pt<P;pt++)Y[pt-1]=arguments[pt];return sr.run("union",Zt,Y)},intersection:function(Zt){for(var P=arguments.length,Y=new Array(P>1?P-1:0),pt=1;pt<P;pt++)Y[pt-1]=arguments[pt];return sr.run("intersection",Zt,Y)},xor:function(Zt){for(var P=arguments.length,Y=new Array(P>1?P-1:0),pt=1;pt<P;pt++)Y[pt-1]=arguments[pt];return sr.run("xor",Zt,Y)},difference:function(Zt){for(var P=arguments.length,Y=new Array(P>1?P-1:0),pt=1;pt<P;pt++)Y[pt-1]=arguments[pt];return sr.run("difference",Zt,Y)}};return Wr})},81550:function(Xt){(function(K,e){Xt.exports=e()})(this,function(){"use strict";var K=function(F){return F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array||F instanceof Float32Array||F instanceof Float64Array||F instanceof Uint8ClampedArray},e=function(F,ot){for(var bt=Object.keys(ot),ee=0;ee<bt.length;++ee)F[bt[ee]]=ot[bt[ee]];return F},u=`
`;function i(F){return typeof atob<"u"?atob(F):"base64:"+F}function a(F){var ot=new Error("(regl) "+F);throw console.error(ot),ot}function c(F,ot){F||a(ot)}function d(F){return F?": "+F:""}function m(F,ot,bt){F in ot||a("unknown parameter ("+F+")"+d(bt)+". possible values: "+Object.keys(ot).join())}function l(F,ot){K(F)||a("invalid parameter type"+d(ot)+". must be a typed array")}function r(F,ot){switch(ot){case"number":return typeof F=="number";case"object":return typeof F=="object";case"string":return typeof F=="string";case"boolean":return typeof F=="boolean";case"function":return typeof F=="function";case"undefined":return typeof F>"u";case"symbol":return typeof F=="symbol"}}function h(F,ot,bt){r(F,ot)||a("invalid parameter type"+d(bt)+". expected "+ot+", got "+typeof F)}function g(F,ot){F>=0&&(F|0)===F||a("invalid parameter type, ("+F+")"+d(ot)+". must be a nonnegative integer")}function A(F,ot,bt){ot.indexOf(F)<0&&a("invalid value"+d(bt)+". must be one of: "+ot)}var o=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function S(F){Object.keys(F).forEach(function(ot){o.indexOf(ot)<0&&a('invalid regl constructor argument "'+ot+'". must be one of '+o)})}function T(F,ot){for(F=F+"";F.length<ot;)F=" "+F;return F}function E(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(F,ot){this.number=F,this.line=ot,this.errors=[]}function C(F,ot,bt){this.file=F,this.line=ot,this.message=bt}function X(){var F=new Error,ot=(F.stack||F).toString(),bt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ot);if(bt)return bt[1];var ee=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ot);return ee?ee[1]:"unknown"}function R(){var F=new Error,ot=(F.stack||F).toString(),bt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ot);if(bt)return bt[1];var ee=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ot);return ee?ee[1]:"unknown"}function M(F,ot){var bt=F.split(`
`),ee=1,ge=0,ie={unknown:new E,0:new E};ie.unknown.name=ie[0].name=ot||X(),ie.unknown.lines.push(new b(0,""));for(var fe=0;fe<bt.length;++fe){var Be=bt[fe],Me=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Be);if(Me)switch(Me[1]){case"line":var je=/(\d+)(\s+\d+)?/.exec(Me[2]);je&&(ee=je[1]|0,je[2]&&(ge=je[2]|0,ge in ie||(ie[ge]=new E)));break;case"define":var De=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Me[2]);De&&(ie[ge].name=De[1]?i(De[2]):De[2]);break}ie[ge].lines.push(new b(ee++,Be))}return Object.keys(ie).forEach(function(Ue){var Ve=ie[Ue];Ve.lines.forEach(function(Ne){Ve.index[Ne.number]=Ne})}),ie}function Z(F){var ot=[];return F.split(`
`).forEach(function(bt){if(!(bt.length<5)){var ee=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(bt);ee?ot.push(new C(ee[1]|0,ee[2]|0,ee[3].trim())):bt.length>0&&ot.push(new C("unknown",0,bt))}}),ot}function rt(F,ot){ot.forEach(function(bt){var ee=F[bt.file];if(ee){var ge=ee.index[bt.line];if(ge){ge.errors.push(bt),ee.hasErrors=!0;return}}F.unknown.hasErrors=!0,F.unknown.lines[0].errors.push(bt)})}function N(F,ot,bt,ee,ge){if(!F.getShaderParameter(ot,F.COMPILE_STATUS)){var ie=F.getShaderInfoLog(ot),fe=ee===F.FRAGMENT_SHADER?"fragment":"vertex";j(bt,"string",fe+" shader source must be a string",ge);var Be=M(bt,ge),Me=Z(ie);rt(Be,Me),Object.keys(Be).forEach(function(je){var De=Be[je];if(!De.hasErrors)return;var Ue=[""],Ve=[""];function Ne(Ze,Ht){Ue.push(Ze),Ve.push(Ht||"")}Ne("file number "+je+": "+De.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),De.lines.forEach(function(Ze){if(Ze.errors.length>0){Ne(T(Ze.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ne(Ze.line+u,"color:red; background-color:yellow; font-weight:bold");var Ht=0;Ze.errors.forEach(function(ce){var Le=ce.message,Ge=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Le);if(Ge){var Te=Ge[1];switch(Le=Ge[2],Te){case"assign":Te="=";break}Ht=Math.max(Ze.line.indexOf(Te,Ht),0)}else Ht=0;Ne(T("| ",6)),Ne(T("^^^",Ht+3)+u,"font-weight:bold"),Ne(T("| ",6)),Ne(Le+u,"font-weight:bold")}),Ne(T("| ",6)+u)}else Ne(T(Ze.number,4)+"|  "),Ne(Ze.line+u,"color:red")}),typeof document<"u"&&!window.chrome?(Ve[0]=Ue.join("%c"),console.log.apply(console,Ve)):console.log(Ue.join(""))}),c.raise("Error compiling "+fe+" shader, "+Be[0].name)}}function Q(F,ot,bt,ee,ge){if(!F.getProgramParameter(ot,F.LINK_STATUS)){var ie=F.getProgramInfoLog(ot),fe=M(bt,ge),Be=M(ee,ge),Me='Error linking program with vertex shader, "'+Be[0].name+'", and fragment shader "'+fe[0].name+'"';typeof document<"u"?console.log("%c"+Me+u+"%c"+ie,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Me+u+ie),c.raise(Me)}}function ft(F){F._commandRef=X()}function I(F,ot,bt,ee){ft(F);function ge(Me){return Me?ee.id(Me):0}F._fragId=ge(F.static.frag),F._vertId=ge(F.static.vert);function ie(Me,je){Object.keys(je).forEach(function(De){Me[ee.id(De)]=!0})}var fe=F._uniformSet={};ie(fe,ot.static),ie(fe,ot.dynamic);var Be=F._attributeSet={};ie(Be,bt.static),ie(Be,bt.dynamic),F._hasCount="count"in F.static||"count"in F.dynamic||"elements"in F.static||"elements"in F.dynamic}function G(F,ot){var bt=R();a(F+" in command "+(ot||X())+(bt==="unknown"?"":" called from "+bt))}function ut(F,ot,bt){F||G(ot,bt||X())}function L(F,ot,bt,ee){F in ot||G("unknown parameter ("+F+")"+d(bt)+". possible values: "+Object.keys(ot).join(),ee||X())}function j(F,ot,bt,ee){r(F,ot)||G("invalid parameter type"+d(bt)+". expected "+ot+", got "+typeof F,ee||X())}function O(F){F()}function B(F,ot,bt){F.texture?A(F.texture._texture.internalformat,ot,"unsupported texture format for attachment"):A(F.renderbuffer._renderbuffer.format,bt,"unsupported renderbuffer format for attachment")}var _=33071,H=9728,U=9984,V=9985,D=9986,lt=9987,J=5120,Rt=5121,kt=5122,ne=5123,re=5124,It=5125,Nt=5126,p=32819,w=32820,W=33635,st=34042,Tt=36193,Gt={};Gt[J]=Gt[Rt]=1,Gt[kt]=Gt[ne]=Gt[Tt]=Gt[W]=Gt[p]=Gt[w]=2,Gt[re]=Gt[It]=Gt[Nt]=Gt[st]=4;function ze(F,ot){return F===w||F===p||F===W?2:F===st?4:Gt[F]*ot}function $e(F){return!(F&F-1)&&!!F}function rn(F,ot,bt){var ee,ge=ot.width,ie=ot.height,fe=ot.channels;c(ge>0&&ge<=bt.maxTextureSize&&ie>0&&ie<=bt.maxTextureSize,"invalid texture shape"),(F.wrapS!==_||F.wrapT!==_)&&c($e(ge)&&$e(ie),"incompatible wrap mode for texture, both width and height must be power of 2"),ot.mipmask===1?ge!==1&&ie!==1&&c(F.minFilter!==U&&F.minFilter!==D&&F.minFilter!==V&&F.minFilter!==lt,"min filter requires mipmap"):(c($e(ge)&&$e(ie),"texture must be a square power of 2 to support mipmapping"),c(ot.mipmask===(ge<<1)-1,"missing or incomplete mipmap data")),ot.type===Nt&&(bt.extensions.indexOf("oes_texture_float_linear")<0&&c(F.minFilter===H&&F.magFilter===H,"filter not supported, must enable oes_texture_float_linear"),c(!F.genMipmaps,"mipmap generation not supported with float textures"));var Be=ot.images;for(ee=0;ee<16;++ee)if(Be[ee]){var Me=ge>>ee,je=ie>>ee;c(ot.mipmask&1<<ee,"missing mipmap data");var De=Be[ee];if(c(De.width===Me&&De.height===je,"invalid shape for mip images"),c(De.format===ot.format&&De.internalformat===ot.internalformat&&De.type===ot.type,"incompatible type for mip image"),!De.compressed)if(De.data){var Ue=Math.ceil(ze(De.type,fe)*Me/De.unpackAlignment)*De.unpackAlignment;c(De.data.byteLength===Ue*je,"invalid data for image, buffer size is inconsistent with image format")}else De.element||De.copy}else F.genMipmaps||c((ot.mipmask&1<<ee)===0,"extra mipmap data");ot.compressed&&c(!F.genMipmaps,"mipmap generation for compressed images not supported")}function gn(F,ot,bt,ee){var ge=F.width,ie=F.height,fe=F.channels;c(ge>0&&ge<=ee.maxTextureSize&&ie>0&&ie<=ee.maxTextureSize,"invalid texture shape"),c(ge===ie,"cube map must be square"),c(ot.wrapS===_&&ot.wrapT===_,"wrap mode not supported by cube map");for(var Be=0;Be<bt.length;++Be){var Me=bt[Be];c(Me.width===ge&&Me.height===ie,"inconsistent cube map face shape"),ot.genMipmaps&&(c(!Me.compressed,"can not generate mipmap for compressed textures"),c(Me.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var je=Me.images,De=0;De<16;++De){var Ue=je[De];if(Ue){var Ve=ge>>De,Ne=ie>>De;c(Me.mipmask&1<<De,"missing mipmap data"),c(Ue.width===Ve&&Ue.height===Ne,"invalid shape for mip images"),c(Ue.format===F.format&&Ue.internalformat===F.internalformat&&Ue.type===F.type,"incompatible type for mip image"),Ue.compressed||(Ue.data?c(Ue.data.byteLength===Ve*Ne*Math.max(ze(Ue.type,fe),Ue.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ue.element||Ue.copy)}}}}var nt=e(c,{optional:O,raise:a,commandRaise:G,command:ut,parameter:m,commandParameter:L,constructor:S,type:h,commandType:j,isTypedArray:l,nni:g,oneOf:A,shaderError:N,linkError:Q,callSite:R,saveCommandRef:ft,saveDrawInfo:I,framebufferFormat:B,guessCommand:X,texture2D:rn,textureCube:gn}),Ln=0,rr=0;function tr(F,ot){this.id=Ln++,this.type=F,this.data=ot}function sr(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Br(F){if(F.length===0)return[];var ot=F.charAt(0),bt=F.charAt(F.length-1);if(F.length>1&&ot===bt&&(ot==='"'||ot==="'"))return['"'+sr(F.substr(1,F.length-2))+'"'];var ee=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(F);if(ee)return Br(F.substr(0,ee.index)).concat(Br(ee[1])).concat(Br(F.substr(ee.index+ee[0].length)));var ge=F.split(".");if(ge.length===1)return['"'+sr(F)+'"'];for(var ie=[],fe=0;fe<ge.length;++fe)ie=ie.concat(Br(ge[fe]));return ie}function fi(F){return"["+Br(F).join("][")+"]"}function Yn(F,ot){return new tr(F,fi(ot+""))}function Ui(F){return typeof F=="function"&&!F._reglType||F instanceof tr}function Wr(F,ot){return typeof F=="function"?new tr(rr,F):F}var Zt={DynamicVariable:tr,define:Yn,isDynamic:Ui,unbox:Wr,accessor:fi},P={next:typeof requestAnimationFrame=="function"?function(F){return requestAnimationFrame(F)}:function(F){return setTimeout(F,16)},cancel:typeof cancelAnimationFrame=="function"?function(F){return cancelAnimationFrame(F)}:clearTimeout},Y=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function pt(){var F={"":0},ot=[""];return{id:function(bt){var ee=F[bt];return ee||(ee=F[bt]=ot.length,ot.push(bt),ee)},str:function(bt){return ot[bt]}}}function Ct(F,ot,bt){var ee=document.createElement("canvas");e(ee.style,{border:0,margin:0,padding:0,top:0,left:0}),F.appendChild(ee),F===document.body&&(ee.style.position="absolute",e(F.style,{margin:0,padding:0}));function ge(){var Be=window.innerWidth,Me=window.innerHeight;if(F!==document.body){var je=F.getBoundingClientRect();Be=je.right-je.left,Me=je.bottom-je.top}ee.width=bt*Be,ee.height=bt*Me,e(ee.style,{width:Be+"px",height:Me+"px"})}var ie;F!==document.body&&typeof ResizeObserver=="function"?(ie=new ResizeObserver(function(){setTimeout(ge)}),ie.observe(F)):window.addEventListener("resize",ge,!1);function fe(){ie?ie.disconnect():window.removeEventListener("resize",ge),F.removeChild(ee)}return ge(),{canvas:ee,onDestroy:fe}}function Et(F,ot){function bt(ee){try{return F.getContext(ee,ot)}catch(ge){return null}}return bt("webgl")||bt("experimental-webgl")||bt("webgl-experimental")}function pe(F){return typeof F.nodeName=="string"&&typeof F.appendChild=="function"&&typeof F.getBoundingClientRect=="function"}function ae(F){return typeof F.drawArrays=="function"||typeof F.drawElements=="function"}function xe(F){return typeof F=="string"?F.split():(nt(Array.isArray(F),"invalid extension array"),F)}function me(F){return typeof F=="string"?(nt(typeof document<"u","not supported outside of DOM"),document.querySelector(F)):F}function en(F){var ot=F||{},bt,ee,ge,ie,fe={},Be=[],Me=[],je=typeof window>"u"?1:window.devicePixelRatio,De=!1,Ue=function(Ze){Ze&&nt.raise(Ze)},Ve=function(){};if(typeof ot=="string"?(nt(typeof document<"u","selector queries only supported in DOM enviroments"),bt=document.querySelector(ot),nt(bt,"invalid query string for element")):typeof ot=="object"?pe(ot)?bt=ot:ae(ot)?(ie=ot,ge=ie.canvas):(nt.constructor(ot),"gl"in ot?ie=ot.gl:"canvas"in ot?ge=me(ot.canvas):"container"in ot&&(ee=me(ot.container)),"attributes"in ot&&(fe=ot.attributes,nt.type(fe,"object","invalid context attributes")),"extensions"in ot&&(Be=xe(ot.extensions)),"optionalExtensions"in ot&&(Me=xe(ot.optionalExtensions)),"onDone"in ot&&(nt.type(ot.onDone,"function","invalid or missing onDone callback"),Ue=ot.onDone),"profile"in ot&&(De=!!ot.profile),"pixelRatio"in ot&&(je=+ot.pixelRatio,nt(je>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),bt&&(bt.nodeName.toLowerCase()==="canvas"?ge=bt:ee=bt),!ie){if(!ge){nt(typeof document<"u","must manually specify webgl context outside of DOM environments");var Ne=Ct(ee||document.body,Ue,je);if(!Ne)return null;ge=Ne.canvas,Ve=Ne.onDestroy}fe.premultipliedAlpha===void 0&&(fe.premultipliedAlpha=!0),ie=Et(ge,fe)}return ie?{gl:ie,canvas:ge,container:ee,extensions:Be,optionalExtensions:Me,pixelRatio:je,profile:De,onDone:Ue,onDestroy:Ve}:(Ve(),Ue("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function se(F,ot){var bt={};function ee(fe){nt.type(fe,"string","extension name must be string");var Be=fe.toLowerCase(),Me;try{Me=bt[Be]=F.getExtension(Be)}catch(je){}return!!Me}for(var ge=0;ge<ot.extensions.length;++ge){var ie=ot.extensions[ge];if(!ee(ie))return ot.onDestroy(),ot.onDone('"'+ie+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ot.optionalExtensions.forEach(ee),{extensions:bt,restore:function(){Object.keys(bt).forEach(function(fe){if(bt[fe]&&!ee(fe))throw new Error("(regl): error restoring extension "+fe)})}}}function ye(F,ot){for(var bt=Array(F),ee=0;ee<F;++ee)bt[ee]=ot(ee);return bt}var ke=5120,Rn=5121,yn=5122,_n=5123,Cn=5124,or=5125,Tr=5126;function Qn(F){for(var ot=16;ot<=1<<28;ot*=16)if(F<=ot)return ot;return 0}function Sr(F){var ot,bt;return ot=(F>65535)<<4,F>>>=ot,bt=(F>255)<<3,F>>>=bt,ot|=bt,bt=(F>15)<<2,F>>>=bt,ot|=bt,bt=(F>3)<<1,F>>>=bt,ot|=bt,ot|F>>1}function Lt(){var F=ye(8,function(){return[]});function ot(ie){var fe=Qn(ie),Be=F[Sr(fe)>>2];return Be.length>0?Be.pop():new ArrayBuffer(fe)}function bt(ie){F[Sr(ie.byteLength)>>2].push(ie)}function ee(ie,fe){var Be=null;switch(ie){case ke:Be=new Int8Array(ot(fe),0,fe);break;case Rn:Be=new Uint8Array(ot(fe),0,fe);break;case yn:Be=new Int16Array(ot(2*fe),0,fe);break;case _n:Be=new Uint16Array(ot(2*fe),0,fe);break;case Cn:Be=new Int32Array(ot(4*fe),0,fe);break;case or:Be=new Uint32Array(ot(4*fe),0,fe);break;case Tr:Be=new Float32Array(ot(4*fe),0,fe);break;default:return null}return Be.length!==fe?Be.subarray(0,fe):Be}function ge(ie){bt(ie.buffer)}return{alloc:ot,free:bt,allocType:ee,freeType:ge}}var Wt=Lt();Wt.zero=Lt();var Re=3408,Ie=3410,ar=3411,gr=3412,xr=3413,Dr=3414,Qr=3415,Hi=33901,Oi=33902,Ei=3379,Ji=3386,Gi=34921,so=36347,uo=36348,kr=35661,Zi=35660,Ni=34930,Jr=36349,di=34076,Yi=34024,si=7936,lo=7937,Ii=7938,co=35724,Oo=34047,Ki=36063,bn=34852,hi=3553,Ti=34067,Lr=34069,ur=33984,pr=6408,ti=5126,fo=5121,Fi=36160,qi=36053,zi=36064,to=16384,Pr=function(F,ot){var bt=1;ot.ext_texture_filter_anisotropic&&(bt=F.getParameter(Oo));var ee=1,ge=1;ot.webgl_draw_buffers&&(ee=F.getParameter(bn),ge=F.getParameter(Ki));var ie=!!ot.oes_texture_float;if(ie){var fe=F.createTexture();F.bindTexture(hi,fe),F.texImage2D(hi,0,pr,1,1,0,pr,ti,null);var Be=F.createFramebuffer();if(F.bindFramebuffer(Fi,Be),F.framebufferTexture2D(Fi,zi,hi,fe,0),F.bindTexture(hi,null),F.checkFramebufferStatus(Fi)!==qi)ie=!1;else{F.viewport(0,0,1,1),F.clearColor(1,0,0,1),F.clear(to);var Me=Wt.allocType(ti,4);F.readPixels(0,0,1,1,pr,ti,Me),F.getError()?ie=!1:(F.deleteFramebuffer(Be),F.deleteTexture(fe),ie=Me[0]===1),Wt.freeType(Me)}}var je=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),De=!0;if(!je){var Ue=F.createTexture(),Ve=Wt.allocType(fo,36);F.activeTexture(ur),F.bindTexture(Ti,Ue),F.texImage2D(Lr,0,pr,3,3,0,pr,fo,Ve),Wt.freeType(Ve),F.bindTexture(Ti,null),F.deleteTexture(Ue),De=!F.getError()}return{colorBits:[F.getParameter(Ie),F.getParameter(ar),F.getParameter(gr),F.getParameter(xr)],depthBits:F.getParameter(Dr),stencilBits:F.getParameter(Qr),subpixelBits:F.getParameter(Re),extensions:Object.keys(ot).filter(function(Ne){return!!ot[Ne]}),maxAnisotropic:bt,maxDrawbuffers:ee,maxColorAttachments:ge,pointSizeDims:F.getParameter(Hi),lineWidthDims:F.getParameter(Oi),maxViewportDims:F.getParameter(Ji),maxCombinedTextureUnits:F.getParameter(kr),maxCubeMapSize:F.getParameter(di),maxRenderbufferSize:F.getParameter(Yi),maxTextureUnits:F.getParameter(Ni),maxTextureSize:F.getParameter(Ei),maxAttributes:F.getParameter(Gi),maxVertexUniforms:F.getParameter(so),maxVertexTextureUnits:F.getParameter(Zi),maxVaryingVectors:F.getParameter(uo),maxFragmentUniforms:F.getParameter(Jr),glsl:F.getParameter(co),renderer:F.getParameter(lo),vendor:F.getParameter(si),version:F.getParameter(Ii),readFloat:ie,npotTextureCube:De}};function br(F){return!!F&&typeof F=="object"&&Array.isArray(F.shape)&&Array.isArray(F.stride)&&typeof F.offset=="number"&&F.shape.length===F.stride.length&&(Array.isArray(F.data)||K(F.data))}var Or=function(F){return Object.keys(F).map(function(ot){return F[ot]})},Bi={shape:q,flatten:Xe};function ho(F,ot,bt){for(var ee=0;ee<ot;++ee)bt[ee]=F[ee]}function hn(F,ot,bt,ee){for(var ge=0,ie=0;ie<ot;++ie)for(var fe=F[ie],Be=0;Be<bt;++Be)ee[ge++]=fe[Be]}function zn(F,ot,bt,ee,ge,ie){for(var fe=ie,Be=0;Be<ot;++Be)for(var Me=F[Be],je=0;je<bt;++je)for(var De=Me[je],Ue=0;Ue<ee;++Ue)ge[fe++]=De[Ue]}function jn(F,ot,bt,ee,ge){for(var ie=1,fe=bt+1;fe<ot.length;++fe)ie*=ot[fe];var Be=ot[bt];if(ot.length-bt===4){var Me=ot[bt+1],je=ot[bt+2],De=ot[bt+3];for(fe=0;fe<Be;++fe)zn(F[fe],Me,je,De,ee,ge),ge+=ie}else for(fe=0;fe<Be;++fe)jn(F[fe],ot,bt+1,ee,ge),ge+=ie}function Xe(F,ot,bt,ee){var ge=1;if(ot.length)for(var ie=0;ie<ot.length;++ie)ge*=ot[ie];else ge=0;var fe=ee||Wt.allocType(bt,ge);switch(ot.length){case 0:break;case 1:ho(F,ot[0],fe);break;case 2:hn(F,ot[0],ot[1],fe);break;case 3:zn(F,ot[0],ot[1],ot[2],fe,0);break;default:jn(F,ot,0,fe,0)}return fe}function q(F){for(var ot=[],bt=F;bt.length;bt=bt[0])ot.push(bt.length);return ot}var At={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Yt=5120,Mt=5122,Dt=5124,$t=5121,te=5123,Qt=5125,ve=5126,le=5126,Ke={int8:Yt,int16:Mt,int32:Dt,uint8:$t,uint16:te,uint32:Qt,float:ve,float32:le},ln=35048,an=35040,Tn={dynamic:ln,stream:an,static:35044},Nr=Bi.flatten,yr=Bi.shape,Mr=35044,Li=35040,ei=5121,pi=5126,wr=[];wr[5120]=1,wr[5122]=2,wr[5124]=4,wr[5121]=1,wr[5123]=2,wr[5125]=4,wr[5126]=4;function Si(F){return At[Object.prototype.toString.call(F)]|0}function Mi(F,ot){for(var bt=0;bt<ot.length;++bt)F[bt]=ot[bt]}function Pn(F,ot,bt,ee,ge,ie,fe){for(var Be=0,Me=0;Me<bt;++Me)for(var je=0;je<ee;++je)F[Be++]=ot[ge*Me+ie*je+fe]}function Kr(F,ot,bt,ee){var ge=0,ie={};function fe(Ht){this.id=ge++,this.buffer=F.createBuffer(),this.type=Ht,this.usage=Mr,this.byteLength=0,this.dimension=1,this.dtype=ei,this.persistentData=null,bt.profile&&(this.stats={size:0})}fe.prototype.bind=function(){F.bindBuffer(this.type,this.buffer)},fe.prototype.destroy=function(){Ve(this)};var Be=[];function Me(Ht,ce){var Le=Be.pop();return Le||(Le=new fe(Ht)),Le.bind(),Ue(Le,ce,Li,0,1,!1),Le}function je(Ht){Be.push(Ht)}function De(Ht,ce,Le){Ht.byteLength=ce.byteLength,F.bufferData(Ht.type,ce,Le)}function Ue(Ht,ce,Le,Ge,Te,qe){var we;if(Ht.usage=Le,Array.isArray(ce)){if(Ht.dtype=Ge||pi,ce.length>0){var We;if(Array.isArray(ce[0])){we=yr(ce);for(var Se=1,He=1;He<we.length;++He)Se*=we[He];Ht.dimension=Se,We=Nr(ce,we,Ht.dtype),De(Ht,We,Le),qe?Ht.persistentData=We:Wt.freeType(We)}else if(typeof ce[0]=="number"){Ht.dimension=Te;var mn=Wt.allocType(Ht.dtype,ce.length);Mi(mn,ce),De(Ht,mn,Le),qe?Ht.persistentData=mn:Wt.freeType(mn)}else K(ce[0])?(Ht.dimension=ce[0].length,Ht.dtype=Ge||Si(ce[0])||pi,We=Nr(ce,[ce.length,ce[0].length],Ht.dtype),De(Ht,We,Le),qe?Ht.persistentData=We:Wt.freeType(We)):nt.raise("invalid buffer data")}}else if(K(ce))Ht.dtype=Ge||Si(ce),Ht.dimension=Te,De(Ht,ce,Le),qe&&(Ht.persistentData=new Uint8Array(new Uint8Array(ce.buffer)));else if(br(ce)){we=ce.shape;var On=ce.stride,Ye=ce.offset,_e=0,Ae=0,Nn=0,Gn=0;we.length===1?(_e=we[0],Ae=1,Nn=On[0],Gn=0):we.length===2?(_e=we[0],Ae=we[1],Nn=On[0],Gn=On[1]):nt.raise("invalid shape"),Ht.dtype=Ge||Si(ce.data)||pi,Ht.dimension=Ae;var cn=Wt.allocType(Ht.dtype,_e*Ae);Pn(cn,ce.data,_e,Ae,Nn,Gn,Ye),De(Ht,cn,Le),qe?Ht.persistentData=cn:Wt.freeType(cn)}else ce instanceof ArrayBuffer?(Ht.dtype=ei,Ht.dimension=Te,De(Ht,ce,Le),qe&&(Ht.persistentData=new Uint8Array(new Uint8Array(ce)))):nt.raise("invalid buffer data")}function Ve(Ht){ot.bufferCount--,ee(Ht);var ce=Ht.buffer;nt(ce,"buffer must not be deleted already"),F.deleteBuffer(ce),Ht.buffer=null,delete ie[Ht.id]}function Ne(Ht,ce,Le,Ge){ot.bufferCount++;var Te=new fe(ce);ie[Te.id]=Te;function qe(Se){var He=Mr,mn=null,On=0,Ye=0,_e=1;return Array.isArray(Se)||K(Se)||br(Se)||Se instanceof ArrayBuffer?mn=Se:typeof Se=="number"?On=Se|0:Se&&(nt.type(Se,"object","buffer arguments must be an object, a number or an array"),"data"in Se&&(nt(mn===null||Array.isArray(mn)||K(mn)||br(mn),"invalid data for buffer"),mn=Se.data),"usage"in Se&&(nt.parameter(Se.usage,Tn,"invalid buffer usage"),He=Tn[Se.usage]),"type"in Se&&(nt.parameter(Se.type,Ke,"invalid buffer type"),Ye=Ke[Se.type]),"dimension"in Se&&(nt.type(Se.dimension,"number","invalid dimension"),_e=Se.dimension|0),"length"in Se&&(nt.nni(On,"buffer length must be a nonnegative integer"),On=Se.length|0)),Te.bind(),mn?Ue(Te,mn,He,Ye,_e,Ge):(On&&F.bufferData(Te.type,On,He),Te.dtype=Ye||ei,Te.usage=He,Te.dimension=_e,Te.byteLength=On),bt.profile&&(Te.stats.size=Te.byteLength*wr[Te.dtype]),qe}function we(Se,He){nt(He+Se.byteLength<=Te.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Se.byteLength+" starting from offset "+He+" to a buffer of size "+Te.byteLength),F.bufferSubData(Te.type,He,Se)}function We(Se,He){var mn=(He||0)|0,On;if(Te.bind(),K(Se)||Se instanceof ArrayBuffer)we(Se,mn);else if(Array.isArray(Se)){if(Se.length>0)if(typeof Se[0]=="number"){var Ye=Wt.allocType(Te.dtype,Se.length);Mi(Ye,Se),we(Ye,mn),Wt.freeType(Ye)}else if(Array.isArray(Se[0])||K(Se[0])){On=yr(Se);var _e=Nr(Se,On,Te.dtype);we(_e,mn),Wt.freeType(_e)}else nt.raise("invalid buffer data")}else if(br(Se)){On=Se.shape;var Ae=Se.stride,Nn=0,Gn=0,cn=0,Un=0;On.length===1?(Nn=On[0],Gn=1,cn=Ae[0],Un=0):On.length===2?(Nn=On[0],Gn=On[1],cn=Ae[0],Un=Ae[1]):nt.raise("invalid shape");var In=Array.isArray(Se.data)?Te.dtype:Si(Se.data),Dn=Wt.allocType(In,Nn*Gn);Pn(Dn,Se.data,Nn,Gn,cn,Un,Se.offset),we(Dn,mn),Wt.freeType(Dn)}else nt.raise("invalid data for buffer subdata");return qe}return Le||qe(Ht),qe._reglType="buffer",qe._buffer=Te,qe.subdata=We,bt.profile&&(qe.stats=Te.stats),qe.destroy=function(){Ve(Te)},qe}function Ze(){Or(ie).forEach(function(Ht){Ht.buffer=F.createBuffer(),F.bindBuffer(Ht.type,Ht.buffer),F.bufferData(Ht.type,Ht.persistentData||Ht.byteLength,Ht.usage)})}return bt.profile&&(ot.getTotalBufferSize=function(){var Ht=0;return Object.keys(ie).forEach(function(ce){Ht+=ie[ce].stats.size}),Ht}),{create:Ne,createStream:Me,destroyStream:je,clear:function(){Or(ie).forEach(Ve),Be.forEach(Ve)},getBuffer:function(Ht){return Ht&&Ht._buffer instanceof fe?Ht._buffer:null},restore:Ze,_initBuffer:Ue}}var ni=0,Fr=0,xi=1,ui=1,ri=4,Ka=4,po={points:ni,point:Fr,lines:xi,line:ui,triangles:ri,triangle:Ka,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Vo=0,ba=1,Ur=4,Oa=5120,vo=5121,Na=5122,mo=5123,la=5124,eo=5125,ca=34963,Ia=35040,fa=35044;function da(F,ot,bt,ee){var ge={},ie=0,fe={uint8:vo,uint16:mo};ot.oes_element_index_uint&&(fe.uint32=eo);function Be(Ze){this.id=ie++,ge[this.id]=this,this.buffer=Ze,this.primType=Ur,this.vertCount=0,this.type=0}Be.prototype.bind=function(){this.buffer.bind()};var Me=[];function je(Ze){var Ht=Me.pop();return Ht||(Ht=new Be(bt.create(null,ca,!0,!1)._buffer)),Ue(Ht,Ze,Ia,-1,-1,0,0),Ht}function De(Ze){Me.push(Ze)}function Ue(Ze,Ht,ce,Le,Ge,Te,qe){Ze.buffer.bind();var we;if(Ht){var We=qe;!qe&&(!K(Ht)||br(Ht)&&!K(Ht.data))&&(We=ot.oes_element_index_uint?eo:mo),bt._initBuffer(Ze.buffer,Ht,ce,We,3)}else F.bufferData(ca,Te,ce),Ze.buffer.dtype=we||vo,Ze.buffer.usage=ce,Ze.buffer.dimension=3,Ze.buffer.byteLength=Te;if(we=qe,!qe){switch(Ze.buffer.dtype){case vo:case Oa:we=vo;break;case mo:case Na:we=mo;break;case eo:case la:we=eo;break;default:nt.raise("unsupported type for element array")}Ze.buffer.dtype=we}Ze.type=we,nt(we!==eo||!!ot.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Se=Ge;Se<0&&(Se=Ze.buffer.byteLength,we===mo?Se>>=1:we===eo&&(Se>>=2)),Ze.vertCount=Se;var He=Le;if(Le<0){He=Ur;var mn=Ze.buffer.dimension;mn===1&&(He=Vo),mn===2&&(He=ba),mn===3&&(He=Ur)}Ze.primType=He}function Ve(Ze){ee.elementsCount--,nt(Ze.buffer!==null,"must not double destroy elements"),delete ge[Ze.id],Ze.buffer.destroy(),Ze.buffer=null}function Ne(Ze,Ht){var ce=bt.create(null,ca,!0),Le=new Be(ce._buffer);ee.elementsCount++;function Ge(Te){if(!Te)ce(),Le.primType=Ur,Le.vertCount=0,Le.type=vo;else if(typeof Te=="number")ce(Te),Le.primType=Ur,Le.vertCount=Te|0,Le.type=vo;else{var qe=null,we=fa,We=-1,Se=-1,He=0,mn=0;Array.isArray(Te)||K(Te)||br(Te)?qe=Te:(nt.type(Te,"object","invalid arguments for elements"),"data"in Te&&(qe=Te.data,nt(Array.isArray(qe)||K(qe)||br(qe),"invalid data for element buffer")),"usage"in Te&&(nt.parameter(Te.usage,Tn,"invalid element buffer usage"),we=Tn[Te.usage]),"primitive"in Te&&(nt.parameter(Te.primitive,po,"invalid element buffer primitive"),We=po[Te.primitive]),"count"in Te&&(nt(typeof Te.count=="number"&&Te.count>=0,"invalid vertex count for elements"),Se=Te.count|0),"type"in Te&&(nt.parameter(Te.type,fe,"invalid buffer type"),mn=fe[Te.type]),"length"in Te?He=Te.length|0:(He=Se,mn===mo||mn===Na?He*=2:(mn===eo||mn===la)&&(He*=4))),Ue(Le,qe,we,We,Se,He,mn)}return Ge}return Ge(Ze),Ge._reglType="elements",Ge._elements=Le,Ge.subdata=function(Te,qe){return ce.subdata(Te,qe),Ge},Ge.destroy=function(){Ve(Le)},Ge}return{create:Ne,createStream:je,destroyStream:De,getElements:function(Ze){return typeof Ze=="function"&&Ze._elements instanceof Be?Ze._elements:null},clear:function(){Or(ge).forEach(Ve)}}}var Fa=new Float32Array(1),qa=new Uint32Array(Fa.buffer),ts=5123;function dr(F){for(var ot=Wt.allocType(ts,F.length),bt=0;bt<F.length;++bt)if(isNaN(F[bt]))ot[bt]=65535;else if(F[bt]===1/0)ot[bt]=31744;else if(F[bt]===-1/0)ot[bt]=64512;else{Fa[0]=F[bt];var ee=qa[0],ge=ee>>>31<<15,ie=(ee<<1>>>24)-127,fe=ee>>13&1023;if(ie<-24)ot[bt]=ge;else if(ie<-14){var Be=-14-ie;ot[bt]=ge+(fe+1024>>Be)}else ie>15?ot[bt]=ge+31744:ot[bt]=ge+(ie+15<<10)+fe}return ot}function Ar(F){return Array.isArray(F)||K(F)}var wi=function(F){return!(F&F-1)&&!!F},No=34467,vi=3553,mi=34067,$i=34069,no=6408,Ri=6406,ko=6407,Io=6409,ji=6410,go=32854,ha=32855,Fo=36194,yo=32819,Xo=32820,es=33635,Ao=34042,Bo=6402,Ho=34041,pa=35904,Eo=35906,vr=36193,ii=33776,Go=33777,Lo=33778,va=33779,Ba=35986,La=35987,Mo=34798,ma=35840,Ma=35841,ro=35842,ga=35843,wa=36196,To=5121,Yo=5123,$o=5125,So=5126,_a=10242,Da=10243,ns=10497,Wo=33071,Pa=33648,rs=10240,Ua=10241,ya=9728,Qo=9729,Vi=9984,wo=9985,Aa=9986,Jo=9987,is=33170,_o=4352,Za=4353,za=4354,os=34046,ja=3317,gi=37440,as=37441,ss=37443,Ko=37444,Do=33984,us=[Vi,Aa,wo,Jo],Po=[0,Io,ji,ko,no],Ci={};Ci[Io]=Ci[Ri]=Ci[Bo]=1,Ci[Ho]=Ci[ji]=2,Ci[ko]=Ci[pa]=3,Ci[no]=Ci[Eo]=4;function xo(F){return"[object "+F+"]"}var Ea=xo("HTMLCanvasElement"),Va=xo("OffscreenCanvas"),ka=xo("CanvasRenderingContext2D"),Uo=xo("ImageBitmap"),Zo=xo("HTMLImageElement"),Ta=xo("HTMLVideoElement"),Xa=Object.keys(At).concat([Ea,Va,ka,Uo,Zo,Ta]),t=[];t[To]=1,t[So]=4,t[vr]=2,t[Yo]=2,t[$o]=4;var n=[];n[go]=2,n[ha]=2,n[Fo]=2,n[Ho]=4,n[ii]=.5,n[Go]=.5,n[Lo]=1,n[va]=1,n[Ba]=.5,n[La]=1,n[Mo]=1,n[ma]=.5,n[Ma]=.25,n[ro]=.5,n[ga]=.25,n[wa]=.5;function v(F){return Array.isArray(F)&&(F.length===0||typeof F[0]=="number")}function x(F){if(!Array.isArray(F))return!1;var ot=F.length;return!(ot===0||!Ar(F[0]))}function $(F){return Object.prototype.toString.call(F)}function z(F){return $(F)===Ea}function et(F){return $(F)===Va}function ht(F){return $(F)===ka}function mt(F){return $(F)===Uo}function wt(F){return $(F)===Zo}function zt(F){return $(F)===Ta}function Vt(F){if(!F)return!1;var ot=$(F);return Xa.indexOf(ot)>=0?!0:v(F)||x(F)||br(F)}function de(F){return At[Object.prototype.toString.call(F)]|0}function Pe(F,ot){var bt=ot.length;switch(F.type){case To:case Yo:case $o:case So:var ee=Wt.allocType(F.type,bt);ee.set(ot),F.data=ee;break;case vr:F.data=dr(ot);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Qe(F,ot){return Wt.allocType(F.type===vr?So:F.type,ot)}function un(F,ot){F.type===vr?(F.data=dr(ot),Wt.freeType(ot)):F.data=ot}function fn(F,ot,bt,ee,ge,ie){for(var fe=F.width,Be=F.height,Me=F.channels,je=fe*Be*Me,De=Qe(F,je),Ue=0,Ve=0;Ve<Be;++Ve)for(var Ne=0;Ne<fe;++Ne)for(var Ze=0;Ze<Me;++Ze)De[Ue++]=ot[bt*Ne+ee*Ve+ge*Ze+ie];un(F,De)}function xn(F,ot,bt,ee,ge,ie){var fe;if(typeof n[F]<"u"?fe=n[F]:fe=Ci[F]*t[ot],ie&&(fe*=6),ge){for(var Be=0,Me=bt;Me>=1;)Be+=fe*Me*Me,Me/=2;return Be}else return fe*bt*ee}function on(F,ot,bt,ee,ge,ie,fe){var Be={"don't care":_o,"dont care":_o,nice:za,fast:Za},Me={repeat:ns,clamp:Wo,mirror:Pa},je={nearest:ya,linear:Qo},De=e({mipmap:Jo,"nearest mipmap nearest":Vi,"linear mipmap nearest":wo,"nearest mipmap linear":Aa,"linear mipmap linear":Jo},je),Ue={none:0,browser:Ko},Ve={uint8:To,rgba4:yo,rgb565:es,"rgb5 a1":Xo},Ne={alpha:Ri,luminance:Io,"luminance alpha":ji,rgb:ko,rgba:no,rgba4:go,"rgb5 a1":ha,rgb565:Fo},Ze={};ot.ext_srgb&&(Ne.srgb=pa,Ne.srgba=Eo),ot.oes_texture_float&&(Ve.float32=Ve.float=So),ot.oes_texture_half_float&&(Ve.float16=Ve["half float"]=vr),ot.webgl_depth_texture&&(e(Ne,{depth:Bo,"depth stencil":Ho}),e(Ve,{uint16:Yo,uint32:$o,"depth stencil":Ao})),ot.webgl_compressed_texture_s3tc&&e(Ze,{"rgb s3tc dxt1":ii,"rgba s3tc dxt1":Go,"rgba s3tc dxt3":Lo,"rgba s3tc dxt5":va}),ot.webgl_compressed_texture_atc&&e(Ze,{"rgb atc":Ba,"rgba atc explicit alpha":La,"rgba atc interpolated alpha":Mo}),ot.webgl_compressed_texture_pvrtc&&e(Ze,{"rgb pvrtc 4bppv1":ma,"rgb pvrtc 2bppv1":Ma,"rgba pvrtc 4bppv1":ro,"rgba pvrtc 2bppv1":ga}),ot.webgl_compressed_texture_etc1&&(Ze["rgb etc1"]=wa);var Ht=Array.prototype.slice.call(F.getParameter(No));Object.keys(Ze).forEach(function(gt){var ue=Ze[gt];Ht.indexOf(ue)>=0&&(Ne[gt]=ue)});var ce=Object.keys(Ne);bt.textureFormats=ce;var Le=[];Object.keys(Ne).forEach(function(gt){var ue=Ne[gt];Le[ue]=gt});var Ge=[];Object.keys(Ve).forEach(function(gt){var ue=Ve[gt];Ge[ue]=gt});var Te=[];Object.keys(je).forEach(function(gt){var ue=je[gt];Te[ue]=gt});var qe=[];Object.keys(De).forEach(function(gt){var ue=De[gt];qe[ue]=gt});var we=[];Object.keys(Me).forEach(function(gt){var ue=Me[gt];we[ue]=gt});var We=ce.reduce(function(gt,ue){var Kt=Ne[ue];return Kt===Io||Kt===Ri||Kt===Io||Kt===ji||Kt===Bo||Kt===Ho||ot.ext_srgb&&(Kt===pa||Kt===Eo)?gt[Kt]=Kt:Kt===ha||ue.indexOf("rgba")>=0?gt[Kt]=no:gt[Kt]=ko,gt},{});function Se(){this.internalformat=no,this.format=no,this.type=To,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ko,this.width=0,this.height=0,this.channels=0}function He(gt,ue){gt.internalformat=ue.internalformat,gt.format=ue.format,gt.type=ue.type,gt.compressed=ue.compressed,gt.premultiplyAlpha=ue.premultiplyAlpha,gt.flipY=ue.flipY,gt.unpackAlignment=ue.unpackAlignment,gt.colorSpace=ue.colorSpace,gt.width=ue.width,gt.height=ue.height,gt.channels=ue.channels}function mn(gt,ue){if(!(typeof ue!="object"||!ue)){if("premultiplyAlpha"in ue&&(nt.type(ue.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),gt.premultiplyAlpha=ue.premultiplyAlpha),"flipY"in ue&&(nt.type(ue.flipY,"boolean","invalid texture flip"),gt.flipY=ue.flipY),"alignment"in ue&&(nt.oneOf(ue.alignment,[1,2,4,8],"invalid texture unpack alignment"),gt.unpackAlignment=ue.alignment),"colorSpace"in ue&&(nt.parameter(ue.colorSpace,Ue,"invalid colorSpace"),gt.colorSpace=Ue[ue.colorSpace]),"type"in ue){var Kt=ue.type;nt(ot.oes_texture_float||!(Kt==="float"||Kt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(ot.oes_texture_half_float||!(Kt==="half float"||Kt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(ot.webgl_depth_texture||!(Kt==="uint16"||Kt==="uint32"||Kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(Kt,Ve,"invalid texture type"),gt.type=Ve[Kt]}var tn=gt.width,Zn=gt.height,hr=gt.channels,tt=!1;"shape"in ue?(nt(Array.isArray(ue.shape)&&ue.shape.length>=2,"shape must be an array"),tn=ue.shape[0],Zn=ue.shape[1],ue.shape.length===3&&(hr=ue.shape[2],nt(hr>0&&hr<=4,"invalid number of channels"),tt=!0),nt(tn>=0&&tn<=bt.maxTextureSize,"invalid width"),nt(Zn>=0&&Zn<=bt.maxTextureSize,"invalid height")):("radius"in ue&&(tn=Zn=ue.radius,nt(tn>=0&&tn<=bt.maxTextureSize,"invalid radius")),"width"in ue&&(tn=ue.width,nt(tn>=0&&tn<=bt.maxTextureSize,"invalid width")),"height"in ue&&(Zn=ue.height,nt(Zn>=0&&Zn<=bt.maxTextureSize,"invalid height")),"channels"in ue&&(hr=ue.channels,nt(hr>0&&hr<=4,"invalid number of channels"),tt=!0)),gt.width=tn|0,gt.height=Zn|0,gt.channels=hr|0;var ct=!1;if("format"in ue){var xt=ue.format;nt(ot.webgl_depth_texture||!(xt==="depth"||xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(xt,Ne,"invalid texture format");var qt=gt.internalformat=Ne[xt];gt.format=We[qt],xt in Ve&&("type"in ue||(gt.type=Ve[xt])),xt in Ze&&(gt.compressed=!0),ct=!0}!tt&&ct?gt.channels=Ci[gt.format]:tt&&!ct?gt.channels!==Po[gt.format]&&(gt.format=gt.internalformat=Po[gt.channels]):ct&&tt&&nt(gt.channels===Ci[gt.format],"number of channels inconsistent with specified format")}}function On(gt){F.pixelStorei(gi,gt.flipY),F.pixelStorei(as,gt.premultiplyAlpha),F.pixelStorei(ss,gt.colorSpace),F.pixelStorei(ja,gt.unpackAlignment)}function Ye(){Se.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function _e(gt,ue){var Kt=null;if(Vt(ue)?Kt=ue:ue&&(nt.type(ue,"object","invalid pixel data type"),mn(gt,ue),"x"in ue&&(gt.xOffset=ue.x|0),"y"in ue&&(gt.yOffset=ue.y|0),Vt(ue.data)&&(Kt=ue.data)),nt(!gt.compressed||Kt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ue.copy){nt(!Kt,"can not specify copy and data field for the same texture");var tn=ge.viewportWidth,Zn=ge.viewportHeight;gt.width=gt.width||tn-gt.xOffset,gt.height=gt.height||Zn-gt.yOffset,gt.needsCopy=!0,nt(gt.xOffset>=0&&gt.xOffset<tn&&gt.yOffset>=0&&gt.yOffset<Zn&&gt.width>0&&gt.width<=tn&&gt.height>0&&gt.height<=Zn,"copy texture read out of bounds")}else if(!Kt)gt.width=gt.width||1,gt.height=gt.height||1,gt.channels=gt.channels||4;else if(K(Kt))gt.channels=gt.channels||4,gt.data=Kt,!("type"in ue)&&gt.type===To&&(gt.type=de(Kt));else if(v(Kt))gt.channels=gt.channels||4,Pe(gt,Kt),gt.alignment=1,gt.needsFree=!0;else if(br(Kt)){var hr=Kt.data;!Array.isArray(hr)&&gt.type===To&&(gt.type=de(hr));var tt=Kt.shape,ct=Kt.stride,xt,qt,Jt,Ft,Pt,Ut;tt.length===3?(Jt=tt[2],Ut=ct[2]):(nt(tt.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Jt=1,Ut=1),xt=tt[0],qt=tt[1],Ft=ct[0],Pt=ct[1],gt.alignment=1,gt.width=xt,gt.height=qt,gt.channels=Jt,gt.format=gt.internalformat=Po[Jt],gt.needsFree=!0,fn(gt,hr,Ft,Pt,Ut,Kt.offset)}else if(z(Kt)||et(Kt)||ht(Kt))z(Kt)||et(Kt)?gt.element=Kt:gt.element=Kt.canvas,gt.width=gt.element.width,gt.height=gt.element.height,gt.channels=4;else if(mt(Kt))gt.element=Kt,gt.width=Kt.width,gt.height=Kt.height,gt.channels=4;else if(wt(Kt))gt.element=Kt,gt.width=Kt.naturalWidth,gt.height=Kt.naturalHeight,gt.channels=4;else if(zt(Kt))gt.element=Kt,gt.width=Kt.videoWidth,gt.height=Kt.videoHeight,gt.channels=4;else if(x(Kt)){var yt=gt.width||Kt[0].length,Bt=gt.height||Kt.length,at=gt.channels;Ar(Kt[0][0])?at=at||Kt[0][0].length:at=at||1;for(var _t=Bi.shape(Kt),oe=1,he=0;he<_t.length;++he)oe*=_t[he];var Ce=Qe(gt,oe);Bi.flatten(Kt,_t,"",Ce),un(gt,Ce),gt.alignment=1,gt.width=yt,gt.height=Bt,gt.channels=at,gt.format=gt.internalformat=Po[at],gt.needsFree=!0}gt.type===So?nt(bt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):gt.type===vr&&nt(bt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ae(gt,ue,Kt){var tn=gt.element,Zn=gt.data,hr=gt.internalformat,tt=gt.format,ct=gt.type,xt=gt.width,qt=gt.height;On(gt),tn?F.texImage2D(ue,Kt,tt,tt,ct,tn):gt.compressed?F.compressedTexImage2D(ue,Kt,hr,xt,qt,0,Zn):gt.needsCopy?(ee(),F.copyTexImage2D(ue,Kt,tt,gt.xOffset,gt.yOffset,xt,qt,0)):F.texImage2D(ue,Kt,tt,xt,qt,0,tt,ct,Zn||null)}function Nn(gt,ue,Kt,tn,Zn){var hr=gt.element,tt=gt.data,ct=gt.internalformat,xt=gt.format,qt=gt.type,Jt=gt.width,Ft=gt.height;On(gt),hr?F.texSubImage2D(ue,Zn,Kt,tn,xt,qt,hr):gt.compressed?F.compressedTexSubImage2D(ue,Zn,Kt,tn,ct,Jt,Ft,tt):gt.needsCopy?(ee(),F.copyTexSubImage2D(ue,Zn,Kt,tn,gt.xOffset,gt.yOffset,Jt,Ft)):F.texSubImage2D(ue,Zn,Kt,tn,Jt,Ft,xt,qt,tt)}var Gn=[];function cn(){return Gn.pop()||new Ye}function Un(gt){gt.needsFree&&Wt.freeType(gt.data),Ye.call(gt),Gn.push(gt)}function In(){Se.call(this),this.genMipmaps=!1,this.mipmapHint=_o,this.mipmask=0,this.images=Array(16)}function Dn(gt,ue,Kt){var tn=gt.images[0]=cn();gt.mipmask=1,tn.width=gt.width=ue,tn.height=gt.height=Kt,tn.channels=gt.channels=4}function Kn(gt,ue){var Kt=null;if(Vt(ue))Kt=gt.images[0]=cn(),He(Kt,gt),_e(Kt,ue),gt.mipmask=1;else if(mn(gt,ue),Array.isArray(ue.mipmap))for(var tn=ue.mipmap,Zn=0;Zn<tn.length;++Zn)Kt=gt.images[Zn]=cn(),He(Kt,gt),Kt.width>>=Zn,Kt.height>>=Zn,_e(Kt,tn[Zn]),gt.mipmask|=1<<Zn;else Kt=gt.images[0]=cn(),He(Kt,gt),_e(Kt,ue),gt.mipmask=1;He(gt,gt.images[0]),gt.compressed&&(gt.internalformat===ii||gt.internalformat===Go||gt.internalformat===Lo||gt.internalformat===va)&&nt(gt.width%4===0&&gt.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function zr(gt,ue){for(var Kt=gt.images,tn=0;tn<Kt.length;++tn){if(!Kt[tn])return;Ae(Kt[tn],ue,tn)}}var qr=[];function Xn(){var gt=qr.pop()||new In;Se.call(gt),gt.mipmask=0;for(var ue=0;ue<16;++ue)gt.images[ue]=null;return gt}function Hr(gt){for(var ue=gt.images,Kt=0;Kt<ue.length;++Kt)ue[Kt]&&Un(ue[Kt]),ue[Kt]=null;qr.push(gt)}function Er(){this.minFilter=ya,this.magFilter=ya,this.wrapS=Wo,this.wrapT=Wo,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=_o}function jr(gt,ue){if("min"in ue){var Kt=ue.min;nt.parameter(Kt,De),gt.minFilter=De[Kt],us.indexOf(gt.minFilter)>=0&&!("faces"in ue)&&(gt.genMipmaps=!0)}if("mag"in ue){var tn=ue.mag;nt.parameter(tn,je),gt.magFilter=je[tn]}var Zn=gt.wrapS,hr=gt.wrapT;if("wrap"in ue){var tt=ue.wrap;typeof tt=="string"?(nt.parameter(tt,Me),Zn=hr=Me[tt]):Array.isArray(tt)&&(nt.parameter(tt[0],Me),nt.parameter(tt[1],Me),Zn=Me[tt[0]],hr=Me[tt[1]])}else{if("wrapS"in ue){var ct=ue.wrapS;nt.parameter(ct,Me),Zn=Me[ct]}if("wrapT"in ue){var xt=ue.wrapT;nt.parameter(xt,Me),hr=Me[xt]}}if(gt.wrapS=Zn,gt.wrapT=hr,"anisotropic"in ue){var qt=ue.anisotropic;nt(typeof qt=="number"&&qt>=1&&qt<=bt.maxAnisotropic,"aniso samples must be between 1 and "),gt.anisotropic=ue.anisotropic}if("mipmap"in ue){var Jt=!1;switch(typeof ue.mipmap){case"string":nt.parameter(ue.mipmap,Be,"invalid mipmap hint"),gt.mipmapHint=Be[ue.mipmap],gt.genMipmaps=!0,Jt=!0;break;case"boolean":Jt=gt.genMipmaps=ue.mipmap;break;case"object":nt(Array.isArray(ue.mipmap),"invalid mipmap type"),gt.genMipmaps=!1,Jt=!0;break;default:nt.raise("invalid mipmap type")}Jt&&!("min"in ue)&&(gt.minFilter=Vi)}}function Gr(gt,ue){F.texParameteri(ue,Ua,gt.minFilter),F.texParameteri(ue,rs,gt.magFilter),F.texParameteri(ue,_a,gt.wrapS),F.texParameteri(ue,Da,gt.wrapT),ot.ext_texture_filter_anisotropic&&F.texParameteri(ue,os,gt.anisotropic),gt.genMipmaps&&(F.hint(is,gt.mipmapHint),F.generateMipmap(ue))}var Yr=0,ai={},ci=bt.maxTextureUnits,$r=Array(ci).map(function(){return null});function Mn(gt){Se.call(this),this.mipmask=0,this.internalformat=no,this.id=Yr++,this.refCount=1,this.target=gt,this.texture=F.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Er,fe.profile&&(this.stats={size:0})}function li(gt){F.activeTexture(Do),F.bindTexture(gt.target,gt.texture)}function nr(){var gt=$r[0];gt?F.bindTexture(gt.target,gt.texture):F.bindTexture(vi,null)}function En(gt){var ue=gt.texture;nt(ue,"must not double destroy texture");var Kt=gt.unit,tn=gt.target;Kt>=0&&(F.activeTexture(Do+Kt),F.bindTexture(tn,null),$r[Kt]=null),F.deleteTexture(ue),gt.texture=null,gt.params=null,gt.pixels=null,gt.refCount=0,delete ai[gt.id],ie.textureCount--}e(Mn.prototype,{bind:function(){var gt=this;gt.bindCount+=1;var ue=gt.unit;if(ue<0){for(var Kt=0;Kt<ci;++Kt){var tn=$r[Kt];if(tn){if(tn.bindCount>0)continue;tn.unit=-1}$r[Kt]=gt,ue=Kt;break}ue>=ci&&nt.raise("insufficient number of texture units"),fe.profile&&ie.maxTextureUnits<ue+1&&(ie.maxTextureUnits=ue+1),gt.unit=ue,F.activeTexture(Do+ue),F.bindTexture(gt.target,gt.texture)}return ue},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&En(this)}});function kn(gt,ue){var Kt=new Mn(vi);ai[Kt.id]=Kt,ie.textureCount++;function tn(tt,ct){var xt=Kt.texInfo;Er.call(xt);var qt=Xn();return typeof tt=="number"?typeof ct=="number"?Dn(qt,tt|0,ct|0):Dn(qt,tt|0,tt|0):tt?(nt.type(tt,"object","invalid arguments to regl.texture"),jr(xt,tt),Kn(qt,tt)):Dn(qt,1,1),xt.genMipmaps&&(qt.mipmask=(qt.width<<1)-1),Kt.mipmask=qt.mipmask,He(Kt,qt),nt.texture2D(xt,qt,bt),Kt.internalformat=qt.internalformat,tn.width=qt.width,tn.height=qt.height,li(Kt),zr(qt,vi),Gr(xt,vi),nr(),Hr(qt),fe.profile&&(Kt.stats.size=xn(Kt.internalformat,Kt.type,qt.width,qt.height,xt.genMipmaps,!1)),tn.format=Le[Kt.internalformat],tn.type=Ge[Kt.type],tn.mag=Te[xt.magFilter],tn.min=qe[xt.minFilter],tn.wrapS=we[xt.wrapS],tn.wrapT=we[xt.wrapT],tn}function Zn(tt,ct,xt,qt){nt(!!tt,"must specify image data");var Jt=ct|0,Ft=xt|0,Pt=qt|0,Ut=cn();return He(Ut,Kt),Ut.width=0,Ut.height=0,_e(Ut,tt),Ut.width=Ut.width||(Kt.width>>Pt)-Jt,Ut.height=Ut.height||(Kt.height>>Pt)-Ft,nt(Kt.type===Ut.type&&Kt.format===Ut.format&&Kt.internalformat===Ut.internalformat,"incompatible format for texture.subimage"),nt(Jt>=0&&Ft>=0&&Jt+Ut.width<=Kt.width&&Ft+Ut.height<=Kt.height,"texture.subimage write out of bounds"),nt(Kt.mipmask&1<<Pt,"missing mipmap data"),nt(Ut.data||Ut.element||Ut.needsCopy,"missing image data"),li(Kt),Nn(Ut,vi,Jt,Ft,Pt),nr(),Un(Ut),tn}function hr(tt,ct){var xt=tt|0,qt=ct|0||xt;if(xt===Kt.width&&qt===Kt.height)return tn;tn.width=Kt.width=xt,tn.height=Kt.height=qt,li(Kt);for(var Jt=0;Kt.mipmask>>Jt;++Jt){var Ft=xt>>Jt,Pt=qt>>Jt;if(!Ft||!Pt)break;F.texImage2D(vi,Jt,Kt.format,Ft,Pt,0,Kt.format,Kt.type,null)}return nr(),fe.profile&&(Kt.stats.size=xn(Kt.internalformat,Kt.type,xt,qt,!1,!1)),tn}return tn(gt,ue),tn.subimage=Zn,tn.resize=hr,tn._reglType="texture2d",tn._texture=Kt,fe.profile&&(tn.stats=Kt.stats),tn.destroy=function(){Kt.decRef()},tn}function $n(gt,ue,Kt,tn,Zn,hr){var tt=new Mn(mi);ai[tt.id]=tt,ie.cubeCount++;var ct=new Array(6);function xt(Ft,Pt,Ut,yt,Bt,at){var _t,oe=tt.texInfo;for(Er.call(oe),_t=0;_t<6;++_t)ct[_t]=Xn();if(typeof Ft=="number"||!Ft){var he=Ft|0||1;for(_t=0;_t<6;++_t)Dn(ct[_t],he,he)}else if(typeof Ft=="object")if(Pt)Kn(ct[0],Ft),Kn(ct[1],Pt),Kn(ct[2],Ut),Kn(ct[3],yt),Kn(ct[4],Bt),Kn(ct[5],at);else if(jr(oe,Ft),mn(tt,Ft),"faces"in Ft){var Ce=Ft.faces;for(nt(Array.isArray(Ce)&&Ce.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)nt(typeof Ce[_t]=="object"&&!!Ce[_t],"invalid input for cube map face"),He(ct[_t],tt),Kn(ct[_t],Ce[_t])}else for(_t=0;_t<6;++_t)Kn(ct[_t],Ft);else nt.raise("invalid arguments to cube map");for(He(tt,ct[0]),bt.npotTextureCube||nt(wi(tt.width)&&wi(tt.height),"your browser does not support non power or two texture dimensions"),oe.genMipmaps?tt.mipmask=(ct[0].width<<1)-1:tt.mipmask=ct[0].mipmask,nt.textureCube(tt,oe,ct,bt),tt.internalformat=ct[0].internalformat,xt.width=ct[0].width,xt.height=ct[0].height,li(tt),_t=0;_t<6;++_t)zr(ct[_t],$i+_t);for(Gr(oe,mi),nr(),fe.profile&&(tt.stats.size=xn(tt.internalformat,tt.type,xt.width,xt.height,oe.genMipmaps,!0)),xt.format=Le[tt.internalformat],xt.type=Ge[tt.type],xt.mag=Te[oe.magFilter],xt.min=qe[oe.minFilter],xt.wrapS=we[oe.wrapS],xt.wrapT=we[oe.wrapT],_t=0;_t<6;++_t)Hr(ct[_t]);return xt}function qt(Ft,Pt,Ut,yt,Bt){nt(!!Pt,"must specify image data"),nt(typeof Ft=="number"&&Ft===(Ft|0)&&Ft>=0&&Ft<6,"invalid face");var at=Ut|0,_t=yt|0,oe=Bt|0,he=cn();return He(he,tt),he.width=0,he.height=0,_e(he,Pt),he.width=he.width||(tt.width>>oe)-at,he.height=he.height||(tt.height>>oe)-_t,nt(tt.type===he.type&&tt.format===he.format&&tt.internalformat===he.internalformat,"incompatible format for texture.subimage"),nt(at>=0&&_t>=0&&at+he.width<=tt.width&&_t+he.height<=tt.height,"texture.subimage write out of bounds"),nt(tt.mipmask&1<<oe,"missing mipmap data"),nt(he.data||he.element||he.needsCopy,"missing image data"),li(tt),Nn(he,$i+Ft,at,_t,oe),nr(),Un(he),xt}function Jt(Ft){var Pt=Ft|0;if(Pt!==tt.width){xt.width=tt.width=Pt,xt.height=tt.height=Pt,li(tt);for(var Ut=0;Ut<6;++Ut)for(var yt=0;tt.mipmask>>yt;++yt)F.texImage2D($i+Ut,yt,tt.format,Pt>>yt,Pt>>yt,0,tt.format,tt.type,null);return nr(),fe.profile&&(tt.stats.size=xn(tt.internalformat,tt.type,xt.width,xt.height,!1,!0)),xt}}return xt(gt,ue,Kt,tn,Zn,hr),xt.subimage=qt,xt.resize=Jt,xt._reglType="textureCube",xt._texture=tt,fe.profile&&(xt.stats=tt.stats),xt.destroy=function(){tt.decRef()},xt}function _r(){for(var gt=0;gt<ci;++gt)F.activeTexture(Do+gt),F.bindTexture(vi,null),$r[gt]=null;Or(ai).forEach(En),ie.cubeCount=0,ie.textureCount=0}fe.profile&&(ie.getTotalTextureSize=function(){var gt=0;return Object.keys(ai).forEach(function(ue){gt+=ai[ue].stats.size}),gt});function bo(){for(var gt=0;gt<ci;++gt){var ue=$r[gt];ue&&(ue.bindCount=0,ue.unit=-1,$r[gt]=null)}Or(ai).forEach(function(Kt){Kt.texture=F.createTexture(),F.bindTexture(Kt.target,Kt.texture);for(var tn=0;tn<32;++tn)if(Kt.mipmask&1<<tn)if(Kt.target===vi)F.texImage2D(vi,tn,Kt.internalformat,Kt.width>>tn,Kt.height>>tn,0,Kt.internalformat,Kt.type,null);else for(var Zn=0;Zn<6;++Zn)F.texImage2D($i+Zn,tn,Kt.internalformat,Kt.width>>tn,Kt.height>>tn,0,Kt.internalformat,Kt.type,null);Gr(Kt.texInfo,Kt.target)})}return{create2D:kn,createCube:$n,clear:_r,getTexture:function(gt){return null},restore:bo}}var Vn=36161,Hn=32854,cr=32855,pn=36194,Je=33189,vn=36168,Jn=34041,Rr=35907,Ir=34836,oi=34842,bi=34843,Xr=[];Xr[Hn]=2,Xr[cr]=2,Xr[pn]=2,Xr[Je]=2,Xr[vn]=1,Xr[Jn]=4,Xr[Rr]=4,Xr[Ir]=16,Xr[oi]=8,Xr[bi]=6;function _i(F,ot,bt){return Xr[F]*ot*bt}var io=function(F,ot,bt,ee,ge){var ie={rgba4:Hn,rgb565:pn,"rgb5 a1":cr,depth:Je,stencil:vn,"depth stencil":Jn};ot.ext_srgb&&(ie.srgba=Rr),ot.ext_color_buffer_half_float&&(ie.rgba16f=oi,ie.rgb16f=bi),ot.webgl_color_buffer_float&&(ie.rgba32f=Ir);var fe=[];Object.keys(ie).forEach(function(Ne){var Ze=ie[Ne];fe[Ze]=Ne});var Be=0,Me={};function je(Ne){this.id=Be++,this.refCount=1,this.renderbuffer=Ne,this.format=Hn,this.width=0,this.height=0,ge.profile&&(this.stats={size:0})}je.prototype.decRef=function(){--this.refCount<=0&&De(this)};function De(Ne){var Ze=Ne.renderbuffer;nt(Ze,"must not double destroy renderbuffer"),F.bindRenderbuffer(Vn,null),F.deleteRenderbuffer(Ze),Ne.renderbuffer=null,Ne.refCount=0,delete Me[Ne.id],ee.renderbufferCount--}function Ue(Ne,Ze){var Ht=new je(F.createRenderbuffer());Me[Ht.id]=Ht,ee.renderbufferCount++;function ce(Ge,Te){var qe=0,we=0,We=Hn;if(typeof Ge=="object"&&Ge){var Se=Ge;if("shape"in Se){var He=Se.shape;nt(Array.isArray(He)&&He.length>=2,"invalid renderbuffer shape"),qe=He[0]|0,we=He[1]|0}else"radius"in Se&&(qe=we=Se.radius|0),"width"in Se&&(qe=Se.width|0),"height"in Se&&(we=Se.height|0);"format"in Se&&(nt.parameter(Se.format,ie,"invalid renderbuffer format"),We=ie[Se.format])}else typeof Ge=="number"?(qe=Ge|0,typeof Te=="number"?we=Te|0:we=qe):Ge?nt.raise("invalid arguments to renderbuffer constructor"):qe=we=1;if(nt(qe>0&&we>0&&qe<=bt.maxRenderbufferSize&&we<=bt.maxRenderbufferSize,"invalid renderbuffer size"),!(qe===Ht.width&&we===Ht.height&&We===Ht.format))return ce.width=Ht.width=qe,ce.height=Ht.height=we,Ht.format=We,F.bindRenderbuffer(Vn,Ht.renderbuffer),F.renderbufferStorage(Vn,We,qe,we),nt(F.getError()===0,"invalid render buffer format"),ge.profile&&(Ht.stats.size=_i(Ht.format,Ht.width,Ht.height)),ce.format=fe[Ht.format],ce}function Le(Ge,Te){var qe=Ge|0,we=Te|0||qe;return qe===Ht.width&&we===Ht.height||(nt(qe>0&&we>0&&qe<=bt.maxRenderbufferSize&&we<=bt.maxRenderbufferSize,"invalid renderbuffer size"),ce.width=Ht.width=qe,ce.height=Ht.height=we,F.bindRenderbuffer(Vn,Ht.renderbuffer),F.renderbufferStorage(Vn,Ht.format,qe,we),nt(F.getError()===0,"invalid render buffer format"),ge.profile&&(Ht.stats.size=_i(Ht.format,Ht.width,Ht.height))),ce}return ce(Ne,Ze),ce.resize=Le,ce._reglType="renderbuffer",ce._renderbuffer=Ht,ge.profile&&(ce.stats=Ht.stats),ce.destroy=function(){Ht.decRef()},ce}ge.profile&&(ee.getTotalRenderbufferSize=function(){var Ne=0;return Object.keys(Me).forEach(function(Ze){Ne+=Me[Ze].stats.size}),Ne});function Ve(){Or(Me).forEach(function(Ne){Ne.renderbuffer=F.createRenderbuffer(),F.bindRenderbuffer(Vn,Ne.renderbuffer),F.renderbufferStorage(Vn,Ne.format,Ne.width,Ne.height)}),F.bindRenderbuffer(Vn,null)}return{create:Ue,clear:function(){Or(Me).forEach(De)},restore:Ve}},Di=36160,qo=36161,oo=3553,Ro=34069,Ns=36064,Is=36096,Fs=36128,Bs=33306,Ls=36053,ou=36054,au=36055,su=36057,Ms=36061,uu=36193,lu=5121,ws=5126,ls=6407,cs=6408,cu=6402,fu=[ls,cs],fs=[];fs[cs]=4,fs[ls]=3;var Sa=[];Sa[lu]=1,Sa[ws]=4,Sa[uu]=2;var du=32854,hu=32855,pu=36194,_s=33189,vu=36168,Ds=34041,Ps=35907,xa=34836,Us=34842,mu=34843,Zs=[du,hu,pu,Ps,Us,mu,xa],ta={};ta[Ls]="complete",ta[ou]="incomplete attachment",ta[su]="incomplete dimensions",ta[au]="incomplete, missing attachment",ta[Ms]="unsupported";function gu(F,ot,bt,ee,ge,ie){var fe={cur:null,next:null,dirty:!1,setFBO:null},Be=["rgba"],Me=["rgba4","rgb565","rgb5 a1"];ot.ext_srgb&&Me.push("srgba"),ot.ext_color_buffer_half_float&&Me.push("rgba16f","rgb16f"),ot.webgl_color_buffer_float&&Me.push("rgba32f");var je=["uint8"];ot.oes_texture_half_float&&je.push("half float","float16"),ot.oes_texture_float&&je.push("float","float32");function De(Ye,_e,Ae){this.target=Ye,this.texture=_e,this.renderbuffer=Ae;var Nn=0,Gn=0;_e?(Nn=_e.width,Gn=_e.height):Ae&&(Nn=Ae.width,Gn=Ae.height),this.width=Nn,this.height=Gn}function Ue(Ye){Ye&&(Ye.texture&&Ye.texture._texture.decRef(),Ye.renderbuffer&&Ye.renderbuffer._renderbuffer.decRef())}function Ve(Ye,_e,Ae){if(Ye)if(Ye.texture){var Nn=Ye.texture._texture,Gn=Math.max(1,Nn.width),cn=Math.max(1,Nn.height);nt(Gn===_e&&cn===Ae,"inconsistent width/height for supplied texture"),Nn.refCount+=1}else{var Un=Ye.renderbuffer._renderbuffer;nt(Un.width===_e&&Un.height===Ae,"inconsistent width/height for renderbuffer"),Un.refCount+=1}}function Ne(Ye,_e){_e&&(_e.texture?F.framebufferTexture2D(Di,Ye,_e.target,_e.texture._texture.texture,0):F.framebufferRenderbuffer(Di,Ye,qo,_e.renderbuffer._renderbuffer.renderbuffer))}function Ze(Ye){var _e=oo,Ae=null,Nn=null,Gn=Ye;typeof Ye=="object"&&(Gn=Ye.data,"target"in Ye&&(_e=Ye.target|0)),nt.type(Gn,"function","invalid attachment data");var cn=Gn._reglType;return cn==="texture2d"?(Ae=Gn,nt(_e===oo)):cn==="textureCube"?(Ae=Gn,nt(_e>=Ro&&_e<Ro+6,"invalid cube map target")):cn==="renderbuffer"?(Nn=Gn,_e=qo):nt.raise("invalid regl object for attachment"),new De(_e,Ae,Nn)}function Ht(Ye,_e,Ae,Nn,Gn){if(Ae){var cn=ee.create2D({width:Ye,height:_e,format:Nn,type:Gn});return cn._texture.refCount=0,new De(oo,cn,null)}else{var Un=ge.create({width:Ye,height:_e,format:Nn});return Un._renderbuffer.refCount=0,new De(qo,null,Un)}}function ce(Ye){return Ye&&(Ye.texture||Ye.renderbuffer)}function Le(Ye,_e,Ae){Ye&&(Ye.texture?Ye.texture.resize(_e,Ae):Ye.renderbuffer&&Ye.renderbuffer.resize(_e,Ae),Ye.width=_e,Ye.height=Ae)}var Ge=0,Te={};function qe(){this.id=Ge++,Te[this.id]=this,this.framebuffer=F.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function we(Ye){Ye.colorAttachments.forEach(Ue),Ue(Ye.depthAttachment),Ue(Ye.stencilAttachment),Ue(Ye.depthStencilAttachment)}function We(Ye){var _e=Ye.framebuffer;nt(_e,"must not double destroy framebuffer"),F.deleteFramebuffer(_e),Ye.framebuffer=null,ie.framebufferCount--,delete Te[Ye.id]}function Se(Ye){var _e;F.bindFramebuffer(Di,Ye.framebuffer);var Ae=Ye.colorAttachments;for(_e=0;_e<Ae.length;++_e)Ne(Ns+_e,Ae[_e]);for(_e=Ae.length;_e<bt.maxColorAttachments;++_e)F.framebufferTexture2D(Di,Ns+_e,oo,null,0);F.framebufferTexture2D(Di,Bs,oo,null,0),F.framebufferTexture2D(Di,Is,oo,null,0),F.framebufferTexture2D(Di,Fs,oo,null,0),Ne(Is,Ye.depthAttachment),Ne(Fs,Ye.stencilAttachment),Ne(Bs,Ye.depthStencilAttachment);var Nn=F.checkFramebufferStatus(Di);!F.isContextLost()&&Nn!==Ls&&nt.raise("framebuffer configuration not supported, status = "+ta[Nn]),F.bindFramebuffer(Di,fe.next?fe.next.framebuffer:null),fe.cur=fe.next,F.getError()}function He(Ye,_e){var Ae=new qe;ie.framebufferCount++;function Nn(cn,Un){var In;nt(fe.next!==Ae,"can not update framebuffer which is currently in use");var Dn=0,Kn=0,zr=!0,qr=!0,Xn=null,Hr=!0,Er="rgba",jr="uint8",Gr=1,Yr=null,ai=null,ci=null,$r=!1;if(typeof cn=="number")Dn=cn|0,Kn=Un|0||Dn;else if(!cn)Dn=Kn=1;else{nt.type(cn,"object","invalid arguments for framebuffer");var Mn=cn;if("shape"in Mn){var li=Mn.shape;nt(Array.isArray(li)&&li.length>=2,"invalid shape for framebuffer"),Dn=li[0],Kn=li[1]}else"radius"in Mn&&(Dn=Kn=Mn.radius),"width"in Mn&&(Dn=Mn.width),"height"in Mn&&(Kn=Mn.height);("color"in Mn||"colors"in Mn)&&(Xn=Mn.color||Mn.colors,Array.isArray(Xn)&&nt(Xn.length===1||ot.webgl_draw_buffers,"multiple render targets not supported")),Xn||("colorCount"in Mn&&(Gr=Mn.colorCount|0,nt(Gr>0,"invalid color buffer count")),"colorTexture"in Mn&&(Hr=!!Mn.colorTexture,Er="rgba4"),"colorType"in Mn&&(jr=Mn.colorType,Hr?(nt(ot.oes_texture_float||!(jr==="float"||jr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(ot.oes_texture_half_float||!(jr==="half float"||jr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):jr==="half float"||jr==="float16"?(nt(ot.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Er="rgba16f"):(jr==="float"||jr==="float32")&&(nt(ot.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Er="rgba32f"),nt.oneOf(jr,je,"invalid color type")),"colorFormat"in Mn&&(Er=Mn.colorFormat,Be.indexOf(Er)>=0?Hr=!0:Me.indexOf(Er)>=0?Hr=!1:Hr?nt.oneOf(Mn.colorFormat,Be,"invalid color format for texture"):nt.oneOf(Mn.colorFormat,Me,"invalid color format for renderbuffer"))),("depthTexture"in Mn||"depthStencilTexture"in Mn)&&($r=!!(Mn.depthTexture||Mn.depthStencilTexture),nt(!$r||ot.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Mn&&(typeof Mn.depth=="boolean"?zr=Mn.depth:(Yr=Mn.depth,qr=!1)),"stencil"in Mn&&(typeof Mn.stencil=="boolean"?qr=Mn.stencil:(ai=Mn.stencil,zr=!1)),"depthStencil"in Mn&&(typeof Mn.depthStencil=="boolean"?zr=qr=Mn.depthStencil:(ci=Mn.depthStencil,zr=!1,qr=!1))}var nr=null,En=null,kn=null,$n=null;if(Array.isArray(Xn))nr=Xn.map(Ze);else if(Xn)nr=[Ze(Xn)];else for(nr=new Array(Gr),In=0;In<Gr;++In)nr[In]=Ht(Dn,Kn,Hr,Er,jr);nt(ot.webgl_draw_buffers||nr.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(nr.length<=bt.maxColorAttachments,"too many color attachments, not supported"),Dn=Dn||nr[0].width,Kn=Kn||nr[0].height,Yr?En=Ze(Yr):zr&&!qr&&(En=Ht(Dn,Kn,$r,"depth","uint32")),ai?kn=Ze(ai):qr&&!zr&&(kn=Ht(Dn,Kn,!1,"stencil","uint8")),ci?$n=Ze(ci):!Yr&&!ai&&qr&&zr&&($n=Ht(Dn,Kn,$r,"depth stencil","depth stencil")),nt(!!Yr+!!ai+!!ci<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var _r=null;for(In=0;In<nr.length;++In)if(Ve(nr[In],Dn,Kn),nt(!nr[In]||nr[In].texture&&fu.indexOf(nr[In].texture._texture.format)>=0||nr[In].renderbuffer&&Zs.indexOf(nr[In].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+In+" is invalid"),nr[In]&&nr[In].texture){var bo=fs[nr[In].texture._texture.format]*Sa[nr[In].texture._texture.type];_r===null?_r=bo:nt(_r===bo,"all color attachments much have the same number of bits per pixel.")}return Ve(En,Dn,Kn),nt(!En||En.texture&&En.texture._texture.format===cu||En.renderbuffer&&En.renderbuffer._renderbuffer.format===_s,"invalid depth attachment for framebuffer object"),Ve(kn,Dn,Kn),nt(!kn||kn.renderbuffer&&kn.renderbuffer._renderbuffer.format===vu,"invalid stencil attachment for framebuffer object"),Ve($n,Dn,Kn),nt(!$n||$n.texture&&$n.texture._texture.format===Ds||$n.renderbuffer&&$n.renderbuffer._renderbuffer.format===Ds,"invalid depth-stencil attachment for framebuffer object"),we(Ae),Ae.width=Dn,Ae.height=Kn,Ae.colorAttachments=nr,Ae.depthAttachment=En,Ae.stencilAttachment=kn,Ae.depthStencilAttachment=$n,Nn.color=nr.map(ce),Nn.depth=ce(En),Nn.stencil=ce(kn),Nn.depthStencil=ce($n),Nn.width=Ae.width,Nn.height=Ae.height,Se(Ae),Nn}function Gn(cn,Un){nt(fe.next!==Ae,"can not resize a framebuffer which is currently in use");var In=Math.max(cn|0,1),Dn=Math.max(Un|0||In,1);if(In===Ae.width&&Dn===Ae.height)return Nn;for(var Kn=Ae.colorAttachments,zr=0;zr<Kn.length;++zr)Le(Kn[zr],In,Dn);return Le(Ae.depthAttachment,In,Dn),Le(Ae.stencilAttachment,In,Dn),Le(Ae.depthStencilAttachment,In,Dn),Ae.width=Nn.width=In,Ae.height=Nn.height=Dn,Se(Ae),Nn}return Nn(Ye,_e),e(Nn,{resize:Gn,_reglType:"framebuffer",_framebuffer:Ae,destroy:function(){We(Ae),we(Ae)},use:function(cn){fe.setFBO({framebuffer:Nn},cn)}})}function mn(Ye){var _e=Array(6);function Ae(Gn){var cn;nt(_e.indexOf(fe.next)<0,"can not update framebuffer which is currently in use");var Un={color:null},In=0,Dn=null,Kn="rgba",zr="uint8",qr=1;if(typeof Gn=="number")In=Gn|0;else if(!Gn)In=1;else{nt.type(Gn,"object","invalid arguments for framebuffer");var Xn=Gn;if("shape"in Xn){var Hr=Xn.shape;nt(Array.isArray(Hr)&&Hr.length>=2,"invalid shape for framebuffer"),nt(Hr[0]===Hr[1],"cube framebuffer must be square"),In=Hr[0]}else"radius"in Xn&&(In=Xn.radius|0),"width"in Xn?(In=Xn.width|0,"height"in Xn&&nt(Xn.height===In,"must be square")):"height"in Xn&&(In=Xn.height|0);("color"in Xn||"colors"in Xn)&&(Dn=Xn.color||Xn.colors,Array.isArray(Dn)&&nt(Dn.length===1||ot.webgl_draw_buffers,"multiple render targets not supported")),Dn||("colorCount"in Xn&&(qr=Xn.colorCount|0,nt(qr>0,"invalid color buffer count")),"colorType"in Xn&&(nt.oneOf(Xn.colorType,je,"invalid color type"),zr=Xn.colorType),"colorFormat"in Xn&&(Kn=Xn.colorFormat,nt.oneOf(Xn.colorFormat,Be,"invalid color format for texture"))),"depth"in Xn&&(Un.depth=Xn.depth),"stencil"in Xn&&(Un.stencil=Xn.stencil),"depthStencil"in Xn&&(Un.depthStencil=Xn.depthStencil)}var Er;if(Dn)if(Array.isArray(Dn))for(Er=[],cn=0;cn<Dn.length;++cn)Er[cn]=Dn[cn];else Er=[Dn];else{Er=Array(qr);var jr={radius:In,format:Kn,type:zr};for(cn=0;cn<qr;++cn)Er[cn]=ee.createCube(jr)}for(Un.color=Array(Er.length),cn=0;cn<Er.length;++cn){var Gr=Er[cn];nt(typeof Gr=="function"&&Gr._reglType==="textureCube","invalid cube map"),In=In||Gr.width,nt(Gr.width===In&&Gr.height===In,"invalid cube map shape"),Un.color[cn]={target:Ro,data:Er[cn]}}for(cn=0;cn<6;++cn){for(var Yr=0;Yr<Er.length;++Yr)Un.color[Yr].target=Ro+cn;cn>0&&(Un.depth=_e[0].depth,Un.stencil=_e[0].stencil,Un.depthStencil=_e[0].depthStencil),_e[cn]?_e[cn](Un):_e[cn]=He(Un)}return e(Ae,{width:In,height:In,color:Er})}function Nn(Gn){var cn,Un=Gn|0;if(nt(Un>0&&Un<=bt.maxCubeMapSize,"invalid radius for cube fbo"),Un===Ae.width)return Ae;var In=Ae.color;for(cn=0;cn<In.length;++cn)In[cn].resize(Un);for(cn=0;cn<6;++cn)_e[cn].resize(Un);return Ae.width=Ae.height=Un,Ae}return Ae(Ye),e(Ae,{faces:_e,resize:Nn,_reglType:"framebufferCube",destroy:function(){_e.forEach(function(Gn){Gn.destroy()})}})}function On(){fe.cur=null,fe.next=null,fe.dirty=!0,Or(Te).forEach(function(Ye){Ye.framebuffer=F.createFramebuffer(),Se(Ye)})}return e(fe,{getFramebuffer:function(Ye){if(typeof Ye=="function"&&Ye._reglType==="framebuffer"){var _e=Ye._framebuffer;if(_e instanceof qe)return _e}return null},create:He,createCube:mn,clear:function(){Or(Te).forEach(We)},restore:On})}var yu=5126,zs=34962;function ds(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=yu,this.offset=0,this.stride=0,this.divisor=0}function hs(F,ot,bt,ee,ge){for(var ie=bt.maxAttributes,fe=new Array(ie),Be=0;Be<ie;++Be)fe[Be]=new ds;var Me=0,je={},De={Record:ds,scope:{},state:fe,currentVAO:null,targetVAO:null,restore:Ve()?Te:function(){},createVAO:qe,getVAO:Ze,destroyBuffer:Ue,setVAO:Ve()?Ht:ce,clear:Ve()?Le:function(){}};function Ue(we){for(var We=0;We<fe.length;++We){var Se=fe[We];Se.buffer===we&&(F.disableVertexAttribArray(We),Se.buffer=null)}}function Ve(){return ot.oes_vertex_array_object}function Ne(){return ot.angle_instanced_arrays}function Ze(we){return typeof we=="function"&&we._vao?we._vao:null}function Ht(we){if(we!==De.currentVAO){var We=Ve();we?We.bindVertexArrayOES(we.vao):We.bindVertexArrayOES(null),De.currentVAO=we}}function ce(we){if(we!==De.currentVAO){if(we)we.bindAttrs();else for(var We=Ne(),Se=0;Se<fe.length;++Se){var He=fe[Se];He.buffer?(F.enableVertexAttribArray(Se),F.vertexAttribPointer(Se,He.size,He.type,He.normalized,He.stride,He.offfset),We&&We.vertexAttribDivisorANGLE(Se,He.divisor)):(F.disableVertexAttribArray(Se),F.vertexAttrib4f(Se,He.x,He.y,He.z,He.w))}De.currentVAO=we}}function Le(){Or(je).forEach(function(we){we.destroy()})}function Ge(){this.id=++Me,this.attributes=[];var we=Ve();we?this.vao=we.createVertexArrayOES():this.vao=null,je[this.id]=this,this.buffers=[]}Ge.prototype.bindAttrs=function(){for(var we=Ne(),We=this.attributes,Se=0;Se<We.length;++Se){var He=We[Se];He.buffer?(F.enableVertexAttribArray(Se),F.bindBuffer(zs,He.buffer.buffer),F.vertexAttribPointer(Se,He.size,He.type,He.normalized,He.stride,He.offset),we&&we.vertexAttribDivisorANGLE(Se,He.divisor)):(F.disableVertexAttribArray(Se),F.vertexAttrib4f(Se,He.x,He.y,He.z,He.w))}for(var mn=We.length;mn<ie;++mn)F.disableVertexAttribArray(mn)},Ge.prototype.refresh=function(){var we=Ve();we&&(we.bindVertexArrayOES(this.vao),this.bindAttrs(),De.currentVAO=this)},Ge.prototype.destroy=function(){if(this.vao){var we=Ve();this===De.currentVAO&&(De.currentVAO=null,we.bindVertexArrayOES(null)),we.deleteVertexArrayOES(this.vao),this.vao=null}je[this.id]&&(delete je[this.id],ee.vaoCount-=1)};function Te(){var we=Ve();we&&Or(je).forEach(function(We){We.refresh()})}function qe(we){var We=new Ge;ee.vaoCount+=1;function Se(He){nt(Array.isArray(He),"arguments to vertex array constructor must be an array"),nt(He.length<ie,"too many attributes"),nt(He.length>0,"must specify at least one attribute");for(var mn=0;mn<We.buffers.length;++mn)We.buffers[mn].destroy();We.buffers.length=0;var On=We.attributes;On.length=He.length;for(var Ye=0;Ye<He.length;++Ye){var _e=He[Ye],Ae=On[Ye]=new ds;if(Array.isArray(_e)||K(_e)||br(_e)){var Nn=ge.create(_e,zs,!1,!0);Ae.buffer=ge.getBuffer(Nn),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1,We.buffers.push(Nn)}else ge.getBuffer(_e)?(Ae.buffer=ge.getBuffer(_e),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1):ge.getBuffer(_e.buffer)?(Ae.buffer=ge.getBuffer(_e.buffer),Ae.size=(+_e.size||Ae.buffer.dimension)|0,Ae.normalized=!!_e.normalized||!1,"type"in _e?(nt.parameter(_e.type,Ke,"invalid buffer type"),Ae.type=Ke[_e.type]):Ae.type=Ae.buffer.dtype,Ae.offset=(_e.offset||0)|0,Ae.stride=(_e.stride||0)|0,Ae.divisor=(_e.divisor||0)|0,Ae.state=1,nt(Ae.size>=1&&Ae.size<=4,"size must be between 1 and 4"),nt(Ae.offset>=0,"invalid offset"),nt(Ae.stride>=0&&Ae.stride<=255,"stride must be between 0 and 255"),nt(Ae.divisor>=0,"divisor must be positive"),nt(!Ae.divisor||!!ot.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in _e?(nt(Ye>0,"first attribute must not be a constant"),Ae.x=+_e.x||0,Ae.y=+_e.y||0,Ae.z=+_e.z||0,Ae.w=+_e.w||0,Ae.state=2):nt(!1,"invalid attribute spec for location "+Ye)}return We.refresh(),Se}return Se.destroy=function(){We.destroy()},Se._vao=We,Se._reglType="vao",Se(we)}return De}var js=35632,Au=35633,Eu=35718,Tu=35721;function Su(F,ot,bt,ee){var ge={},ie={};function fe(Ht,ce,Le,Ge){this.name=Ht,this.id=ce,this.location=Le,this.info=Ge}function Be(Ht,ce){for(var Le=0;Le<Ht.length;++Le)if(Ht[Le].id===ce.id){Ht[Le].location=ce.location;return}Ht.push(ce)}function Me(Ht,ce,Le){var Ge=Ht===js?ge:ie,Te=Ge[ce];if(!Te){var qe=ot.str(ce);Te=F.createShader(Ht),F.shaderSource(Te,qe),F.compileShader(Te),nt.shaderError(F,Te,qe,Ht,Le),Ge[ce]=Te}return Te}var je={},De=[],Ue=0;function Ve(Ht,ce){this.id=Ue++,this.fragId=Ht,this.vertId=ce,this.program=null,this.uniforms=[],this.attributes=[],ee.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ne(Ht,ce,Le){var Ge,Te,qe=Me(js,Ht.fragId),we=Me(Au,Ht.vertId),We=Ht.program=F.createProgram();if(F.attachShader(We,qe),F.attachShader(We,we),Le)for(Ge=0;Ge<Le.length;++Ge){var Se=Le[Ge];F.bindAttribLocation(We,Se[0],Se[1])}F.linkProgram(We),nt.linkError(F,We,ot.str(Ht.fragId),ot.str(Ht.vertId),ce);var He=F.getProgramParameter(We,Eu);ee.profile&&(Ht.stats.uniformsCount=He);var mn=Ht.uniforms;for(Ge=0;Ge<He;++Ge)if(Te=F.getActiveUniform(We,Ge),Te)if(Te.size>1)for(var On=0;On<Te.size;++On){var Ye=Te.name.replace("[0]","["+On+"]");Be(mn,new fe(Ye,ot.id(Ye),F.getUniformLocation(We,Ye),Te))}else Be(mn,new fe(Te.name,ot.id(Te.name),F.getUniformLocation(We,Te.name),Te));var _e=F.getProgramParameter(We,Tu);ee.profile&&(Ht.stats.attributesCount=_e);var Ae=Ht.attributes;for(Ge=0;Ge<_e;++Ge)Te=F.getActiveAttrib(We,Ge),Te&&Be(Ae,new fe(Te.name,ot.id(Te.name),F.getAttribLocation(We,Te.name),Te))}ee.profile&&(bt.getMaxUniformsCount=function(){var Ht=0;return De.forEach(function(ce){ce.stats.uniformsCount>Ht&&(Ht=ce.stats.uniformsCount)}),Ht},bt.getMaxAttributesCount=function(){var Ht=0;return De.forEach(function(ce){ce.stats.attributesCount>Ht&&(Ht=ce.stats.attributesCount)}),Ht});function Ze(){ge={},ie={};for(var Ht=0;Ht<De.length;++Ht)Ne(De[Ht],null,De[Ht].attributes.map(function(ce){return[ce.location,ce.name]}))}return{clear:function(){var Ht=F.deleteShader.bind(F);Or(ge).forEach(Ht),ge={},Or(ie).forEach(Ht),ie={},De.forEach(function(ce){F.deleteProgram(ce.program)}),De.length=0,je={},bt.shaderCount=0},program:function(Ht,ce,Le,Ge){nt.command(Ht>=0,"missing vertex shader",Le),nt.command(ce>=0,"missing fragment shader",Le);var Te=je[ce];Te||(Te=je[ce]={});var qe=Te[Ht];if(qe&&!Ge)return qe;var we=new Ve(ce,Ht);return bt.shaderCount++,Ne(we,Le,Ge),qe||(Te[Ht]=we),De.push(we),we},restore:Ze,shader:Me,frag:-1,vert:-1}}var xu=6408,Wi=5121,Ru=3333,Ha=5126;function Cu(F,ot,bt,ee,ge,ie,fe){function Be(De){var Ue;ot.next===null?(nt(ge.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ue=Wi):(nt(ot.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ue=ot.next.colorAttachments[0].texture._texture.type,ie.oes_texture_float?(nt(Ue===Wi||Ue===Ha,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ue===Ha&&nt(fe.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(Ue===Wi,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Ve=0,Ne=0,Ze=ee.framebufferWidth,Ht=ee.framebufferHeight,ce=null;K(De)?ce=De:De&&(nt.type(De,"object","invalid arguments to regl.read()"),Ve=De.x|0,Ne=De.y|0,nt(Ve>=0&&Ve<ee.framebufferWidth,"invalid x offset for regl.read"),nt(Ne>=0&&Ne<ee.framebufferHeight,"invalid y offset for regl.read"),Ze=(De.width||ee.framebufferWidth-Ve)|0,Ht=(De.height||ee.framebufferHeight-Ne)|0,ce=De.data||null),ce&&(Ue===Wi?nt(ce instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ue===Ha&&nt(ce instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(Ze>0&&Ze+Ve<=ee.framebufferWidth,"invalid width for read pixels"),nt(Ht>0&&Ht+Ne<=ee.framebufferHeight,"invalid height for read pixels"),bt();var Le=Ze*Ht*4;return ce||(Ue===Wi?ce=new Uint8Array(Le):Ue===Ha&&(ce=ce||new Float32Array(Le))),nt.isTypedArray(ce,"data buffer for regl.read() must be a typedarray"),nt(ce.byteLength>=Le,"data buffer for regl.read() too small"),F.pixelStorei(Ru,4),F.readPixels(Ve,Ne,Ze,Ht,xu,Ue,ce),ce}function Me(De){var Ue;return ot.setFBO({framebuffer:De.framebuffer},function(){Ue=Be(De)}),Ue}function je(De){return!De||!("framebuffer"in De)?Be(De):Me(De)}return je}function ea(F){return Array.prototype.slice.call(F)}function na(F){return ea(F).join("")}function bu(){var F=0,ot=[],bt=[];function ee(Ue){for(var Ve=0;Ve<bt.length;++Ve)if(bt[Ve]===Ue)return ot[Ve];var Ne="g"+F++;return ot.push(Ne),bt.push(Ue),Ne}function ge(){var Ue=[];function Ve(){Ue.push.apply(Ue,ea(arguments))}var Ne=[];function Ze(){var Ht="v"+F++;return Ne.push(Ht),arguments.length>0&&(Ue.push(Ht,"="),Ue.push.apply(Ue,ea(arguments)),Ue.push(";")),Ht}return e(Ve,{def:Ze,toString:function(){return na([Ne.length>0?"var "+Ne.join(",")+";":"",na(Ue)])}})}function ie(){var Ue=ge(),Ve=ge(),Ne=Ue.toString,Ze=Ve.toString;function Ht(ce,Le){Ve(ce,Le,"=",Ue.def(ce,Le),";")}return e(function(){Ue.apply(Ue,ea(arguments))},{def:Ue.def,entry:Ue,exit:Ve,save:Ht,set:function(ce,Le,Ge){Ht(ce,Le),Ue(ce,Le,"=",Ge,";")},toString:function(){return Ne()+Ze()}})}function fe(){var Ue=na(arguments),Ve=ie(),Ne=ie(),Ze=Ve.toString,Ht=Ne.toString;return e(Ve,{then:function(){return Ve.apply(Ve,ea(arguments)),this},else:function(){return Ne.apply(Ne,ea(arguments)),this},toString:function(){var ce=Ht();return ce&&(ce="else{"+ce+"}"),na(["if(",Ue,"){",Ze(),"}",ce])}})}var Be=ge(),Me={};function je(Ue,Ve){var Ne=[];function Ze(){var Te="a"+Ne.length;return Ne.push(Te),Te}Ve=Ve||0;for(var Ht=0;Ht<Ve;++Ht)Ze();var ce=ie(),Le=ce.toString,Ge=Me[Ue]=e(ce,{arg:Ze,toString:function(){return na(["function(",Ne.join(),"){",Le(),"}"])}});return Ge}function De(){var Ue=['"use strict";',Be,"return {"];Object.keys(Me).forEach(function(Ze){Ue.push('"',Ze,'":',Me[Ze].toString(),",")}),Ue.push("}");var Ve=na(Ue).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ne=Function.apply(null,ot.concat(Ve));return Ne.apply(null,bt)}return{global:Be,link:ee,block:ge,proc:je,scope:ie,cond:fe,compile:De}}var ra="xyzw".split(""),ps=5121,ia=1,vs=2,ms=0,Vs=1,ks=2,Xs=3,gs=4,Hs="dither",ys="blend.enable",Gs="blend.color",As="blend.equation",Ga="blend.func",Es="depth.enable",Ys="depth.func",$s="depth.range",Ou="depth.mask",Ts="colorMask",s="cull.enable",f="cull.face",y="frontFace",k="lineWidth",it="polygonOffset.enable",dt="polygonOffset.offset",Ot="sample.alpha",St="sample.enable",vt="sample.coverage",jt="stencil.enable",be="stencil.mask",Oe="stencil.func",sn="stencil.opFront",An="stencil.opBack",Fn="scissor.enable",Wn="scissor.box",mr="viewport",er="profile",fr="framebuffer",ir="vert",lr="frag",Cr="elements",yi="primitive",Ai="count",ki="offset",Ra="instances",oa="vao",Ya="Width",zo="Height",$a=fr+Ya,Wa=fr+zo,el=mr+Ya,nl=mr+zo,wu="drawingBuffer",_u=wu+Ya,Du=wu+zo,rl=[Ga,As,Oe,sn,An,vt,mr,Wn,dt],Qa=34962,il=34963,ol=35632,al=35633,Pu=3553,sl=34067,ul=2884,ll=3042,cl=3024,fl=2960,dl=2929,hl=3089,pl=32823,vl=32926,ml=32928,Nu=5126,Ws=35664,Qs=35665,Js=35666,Iu=5124,Ks=35667,qs=35668,tu=35669,Fu=35670,eu=35671,nu=35672,ru=35673,Ss=35674,xs=35675,Rs=35676,Cs=35678,bs=35680,Uu=4,Os=1028,Ca=1029,Zu=2304,Bu=2305,gl=32775,yl=32776,Al=519,aa=7680,zu=0,ju=1,Vu=32774,El=513,ku=36160,Tl=36064,Co={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xu=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ja={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},sa={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Hu={frag:ol,vert:al},Lu={cw:Zu,ccw:Bu};function iu(F){return Array.isArray(F)||K(F)||br(F)}function Gu(F){return F.sort(function(ot,bt){return ot===mr?-1:bt===mr?1:ot<bt?-1:1})}function Xi(F,ot,bt,ee){this.thisDep=F,this.contextDep=ot,this.propDep=bt,this.append=ee}function ua(F){return F&&!(F.thisDep||F.contextDep||F.propDep)}function Zr(F){return new Xi(!1,!1,!1,F)}function Pi(F,ot){var bt=F.type;if(bt===ms){var ee=F.data.length;return new Xi(!0,ee>=1,ee>=2,ot)}else if(bt===gs){var ge=F.data;return new Xi(ge.thisDep,ge.contextDep,ge.propDep,ot)}else return new Xi(bt===Xs,bt===ks,bt===Vs,ot)}var Yu=new Xi(!1,!1,!1,function(){});function Sl(F,ot,bt,ee,ge,ie,fe,Be,Me,je,De,Ue,Ve,Ne,Ze){var Ht=je.Record,ce={add:32774,subtract:32778,"reverse subtract":32779};bt.ext_blend_minmax&&(ce.min=gl,ce.max=yl);var Le=bt.angle_instanced_arrays,Ge=bt.webgl_draw_buffers,Te={dirty:!0,profile:Ze.profile},qe={},we=[],We={},Se={};function He(tt){return tt.replace(".","_")}function mn(tt,ct,xt){var qt=He(tt);we.push(tt),qe[qt]=Te[qt]=!!xt,We[qt]=ct}function On(tt,ct,xt){var qt=He(tt);we.push(tt),Array.isArray(xt)?(Te[qt]=xt.slice(),qe[qt]=xt.slice()):Te[qt]=qe[qt]=xt,Se[qt]=ct}mn(Hs,cl),mn(ys,ll),On(Gs,"blendColor",[0,0,0,0]),On(As,"blendEquationSeparate",[Vu,Vu]),On(Ga,"blendFuncSeparate",[ju,zu,ju,zu]),mn(Es,dl,!0),On(Ys,"depthFunc",El),On($s,"depthRange",[0,1]),On(Ou,"depthMask",!0),On(Ts,Ts,[!0,!0,!0,!0]),mn(s,ul),On(f,"cullFace",Ca),On(y,y,Bu),On(k,k,1),mn(it,pl),On(dt,"polygonOffset",[0,0]),mn(Ot,vl),mn(St,ml),On(vt,"sampleCoverage",[1,!1]),mn(jt,fl),On(be,"stencilMask",-1),On(Oe,"stencilFunc",[Al,0,-1]),On(sn,"stencilOpSeparate",[Os,aa,aa,aa]),On(An,"stencilOpSeparate",[Ca,aa,aa,aa]),mn(Fn,hl),On(Wn,"scissor",[0,0,F.drawingBufferWidth,F.drawingBufferHeight]),On(mr,mr,[0,0,F.drawingBufferWidth,F.drawingBufferHeight]);var Ye={gl:F,context:Ve,strings:ot,next:qe,current:Te,draw:Ue,elements:ie,buffer:ge,shader:De,attributes:je.state,vao:je,uniforms:Me,framebuffer:Be,extensions:bt,timer:Ne,isBufferArgs:iu},_e={primTypes:po,compareFuncs:Ja,blendFuncs:Co,blendEquations:ce,stencilOps:sa,glTypes:Ke,orientationType:Lu};nt.optional(function(){Ye.isArrayLike=Ar}),Ge&&(_e.backBuffer=[Ca],_e.drawBuffer=ye(ee.maxDrawbuffers,function(tt){return tt===0?[0]:ye(tt,function(ct){return Tl+ct})}));var Ae=0;function Nn(){var tt=bu(),ct=tt.link,xt=tt.global;tt.id=Ae++,tt.batchId="0";var qt=ct(Ye),Jt=tt.shared={props:"a0"};Object.keys(Ye).forEach(function(Bt){Jt[Bt]=xt.def(qt,".",Bt)}),nt.optional(function(){tt.CHECK=ct(nt),tt.commandStr=nt.guessCommand(),tt.command=ct(tt.commandStr),tt.assert=function(Bt,at,_t){Bt("if(!(",at,"))",this.CHECK,".commandRaise(",ct(_t),",",this.command,");")},_e.invalidBlendCombinations=Xu});var Ft=tt.next={},Pt=tt.current={};Object.keys(Se).forEach(function(Bt){Array.isArray(Te[Bt])&&(Ft[Bt]=xt.def(Jt.next,".",Bt),Pt[Bt]=xt.def(Jt.current,".",Bt))});var Ut=tt.constants={};Object.keys(_e).forEach(function(Bt){Ut[Bt]=xt.def(JSON.stringify(_e[Bt]))}),tt.invoke=function(Bt,at){switch(at.type){case ms:var _t=["this",Jt.context,Jt.props,tt.batchId];return Bt.def(ct(at.data),".call(",_t.slice(0,Math.max(at.data.length+1,4)),")");case Vs:return Bt.def(Jt.props,at.data);case ks:return Bt.def(Jt.context,at.data);case Xs:return Bt.def("this",at.data);case gs:return at.data.append(tt,Bt),at.data.ref}},tt.attribCache={};var yt={};return tt.scopeAttrib=function(Bt){var at=ot.id(Bt);if(at in yt)return yt[at];var _t=je.scope[at];_t||(_t=je.scope[at]=new Ht);var oe=yt[at]=ct(_t);return oe},tt}function Gn(tt){var ct=tt.static,xt=tt.dynamic,qt;if(er in ct){var Jt=!!ct[er];qt=Zr(function(Pt,Ut){return Jt}),qt.enable=Jt}else if(er in xt){var Ft=xt[er];qt=Pi(Ft,function(Pt,Ut){return Pt.invoke(Ut,Ft)})}return qt}function cn(tt,ct){var xt=tt.static,qt=tt.dynamic;if(fr in xt){var Jt=xt[fr];return Jt?(Jt=Be.getFramebuffer(Jt),nt.command(Jt,"invalid framebuffer object"),Zr(function(Pt,Ut){var yt=Pt.link(Jt),Bt=Pt.shared;Ut.set(Bt.framebuffer,".next",yt);var at=Bt.context;return Ut.set(at,"."+$a,yt+".width"),Ut.set(at,"."+Wa,yt+".height"),yt})):Zr(function(Pt,Ut){var yt=Pt.shared;Ut.set(yt.framebuffer,".next","null");var Bt=yt.context;return Ut.set(Bt,"."+$a,Bt+"."+_u),Ut.set(Bt,"."+Wa,Bt+"."+Du),"null"})}else if(fr in qt){var Ft=qt[fr];return Pi(Ft,function(Pt,Ut){var yt=Pt.invoke(Ut,Ft),Bt=Pt.shared,at=Bt.framebuffer,_t=Ut.def(at,".getFramebuffer(",yt,")");nt.optional(function(){Pt.assert(Ut,"!"+yt+"||"+_t,"invalid framebuffer object")}),Ut.set(at,".next",_t);var oe=Bt.context;return Ut.set(oe,"."+$a,_t+"?"+_t+".width:"+oe+"."+_u),Ut.set(oe,"."+Wa,_t+"?"+_t+".height:"+oe+"."+Du),_t})}else return null}function Un(tt,ct,xt){var qt=tt.static,Jt=tt.dynamic;function Ft(yt){if(yt in qt){var Bt=qt[yt];nt.commandType(Bt,"object","invalid "+yt,xt.commandStr);var at=!0,_t=Bt.x|0,oe=Bt.y|0,he,Ce;return"width"in Bt?(he=Bt.width|0,nt.command(he>=0,"invalid "+yt,xt.commandStr)):at=!1,"height"in Bt?(Ce=Bt.height|0,nt.command(Ce>=0,"invalid "+yt,xt.commandStr)):at=!1,new Xi(!at&&ct&&ct.thisDep,!at&&ct&&ct.contextDep,!at&&ct&&ct.propDep,function(dn,wn){var nn=dn.shared.context,Sn=he;"width"in Bt||(Sn=wn.def(nn,".",$a,"-",_t));var Bn=Ce;return"height"in Bt||(Bn=wn.def(nn,".",Wa,"-",oe)),[_t,oe,Sn,Bn]})}else if(yt in Jt){var Ee=Jt[yt],Fe=Pi(Ee,function(dn,wn){var nn=dn.invoke(wn,Ee);nt.optional(function(){dn.assert(wn,nn+"&&typeof "+nn+'==="object"',"invalid "+yt)});var Sn=dn.shared.context,Bn=wn.def(nn,".x|0"),qn=wn.def(nn,".y|0"),Vr=wn.def('"width" in ',nn,"?",nn,".width|0:","(",Sn,".",$a,"-",Bn,")"),ao=wn.def('"height" in ',nn,"?",nn,".height|0:","(",Sn,".",Wa,"-",qn,")");return nt.optional(function(){dn.assert(wn,Vr+">=0&&"+ao+">=0","invalid "+yt)}),[Bn,qn,Vr,ao]});return ct&&(Fe.thisDep=Fe.thisDep||ct.thisDep,Fe.contextDep=Fe.contextDep||ct.contextDep,Fe.propDep=Fe.propDep||ct.propDep),Fe}else return ct?new Xi(ct.thisDep,ct.contextDep,ct.propDep,function(dn,wn){var nn=dn.shared.context;return[0,0,wn.def(nn,".",$a),wn.def(nn,".",Wa)]}):null}var Pt=Ft(mr);if(Pt){var Ut=Pt;Pt=new Xi(Pt.thisDep,Pt.contextDep,Pt.propDep,function(yt,Bt){var at=Ut.append(yt,Bt),_t=yt.shared.context;return Bt.set(_t,"."+el,at[2]),Bt.set(_t,"."+nl,at[3]),at})}return{viewport:Pt,scissor_box:Ft(Wn)}}function In(tt,ct){var xt=tt.static,qt=typeof xt[lr]=="string"&&typeof xt[ir]=="string";if(qt){if(Object.keys(ct.dynamic).length>0)return null;var Jt=ct.static,Ft=Object.keys(Jt);if(Ft.length>0&&typeof Jt[Ft[0]]=="number"){for(var Pt=[],Ut=0;Ut<Ft.length;++Ut)nt(typeof Jt[Ft[Ut]]=="number","must specify all vertex attribute locations when using vaos"),Pt.push([Jt[Ft[Ut]]|0,Ft[Ut]]);return Pt}}return null}function Dn(tt,ct,xt){var qt=tt.static,Jt=tt.dynamic;function Ft(at){if(at in qt){var _t=ot.id(qt[at]);nt.optional(function(){De.shader(Hu[at],_t,nt.guessCommand())});var oe=Zr(function(){return _t});return oe.id=_t,oe}else if(at in Jt){var he=Jt[at];return Pi(he,function(Ce,Ee){var Fe=Ce.invoke(Ee,he),dn=Ee.def(Ce.shared.strings,".id(",Fe,")");return nt.optional(function(){Ee(Ce.shared.shader,".shader(",Hu[at],",",dn,",",Ce.command,");")}),dn})}return null}var Pt=Ft(lr),Ut=Ft(ir),yt=null,Bt;return ua(Pt)&&ua(Ut)?(yt=De.program(Ut.id,Pt.id,null,xt),Bt=Zr(function(at,_t){return at.link(yt)})):Bt=new Xi(Pt&&Pt.thisDep||Ut&&Ut.thisDep,Pt&&Pt.contextDep||Ut&&Ut.contextDep,Pt&&Pt.propDep||Ut&&Ut.propDep,function(at,_t){var oe=at.shared.shader,he;Pt?he=Pt.append(at,_t):he=_t.def(oe,".",lr);var Ce;Ut?Ce=Ut.append(at,_t):Ce=_t.def(oe,".",ir);var Ee=oe+".program("+Ce+","+he;return nt.optional(function(){Ee+=","+at.command}),_t.def(Ee+")")}),{frag:Pt,vert:Ut,progVar:Bt,program:yt}}function Kn(tt,ct){var xt=tt.static,qt=tt.dynamic;function Jt(){if(Cr in xt){var at=xt[Cr];iu(at)?at=ie.getElements(ie.create(at,!0)):at&&(at=ie.getElements(at),nt.command(at,"invalid elements",ct.commandStr));var _t=Zr(function(he,Ce){if(at){var Ee=he.link(at);return he.ELEMENTS=Ee,Ee}return he.ELEMENTS=null,null});return _t.value=at,_t}else if(Cr in qt){var oe=qt[Cr];return Pi(oe,function(he,Ce){var Ee=he.shared,Fe=Ee.isBufferArgs,dn=Ee.elements,wn=he.invoke(Ce,oe),nn=Ce.def("null"),Sn=Ce.def(Fe,"(",wn,")"),Bn=he.cond(Sn).then(nn,"=",dn,".createStream(",wn,");").else(nn,"=",dn,".getElements(",wn,");");return nt.optional(function(){he.assert(Bn.else,"!"+wn+"||"+nn,"invalid elements")}),Ce.entry(Bn),Ce.exit(he.cond(Sn).then(dn,".destroyStream(",nn,");")),he.ELEMENTS=nn,nn})}return null}var Ft=Jt();function Pt(){if(yi in xt){var at=xt[yi];return nt.commandParameter(at,po,"invalid primitve",ct.commandStr),Zr(function(oe,he){return po[at]})}else if(yi in qt){var _t=qt[yi];return Pi(_t,function(oe,he){var Ce=oe.constants.primTypes,Ee=oe.invoke(he,_t);return nt.optional(function(){oe.assert(he,Ee+" in "+Ce,"invalid primitive, must be one of "+Object.keys(po))}),he.def(Ce,"[",Ee,"]")})}else if(Ft)return ua(Ft)?Ft.value?Zr(function(oe,he){return he.def(oe.ELEMENTS,".primType")}):Zr(function(){return Uu}):new Xi(Ft.thisDep,Ft.contextDep,Ft.propDep,function(oe,he){var Ce=oe.ELEMENTS;return he.def(Ce,"?",Ce,".primType:",Uu)});return null}function Ut(at,_t){if(at in xt){var oe=xt[at]|0;return nt.command(!_t||oe>=0,"invalid "+at,ct.commandStr),Zr(function(Ce,Ee){return _t&&(Ce.OFFSET=oe),oe})}else if(at in qt){var he=qt[at];return Pi(he,function(Ce,Ee){var Fe=Ce.invoke(Ee,he);return _t&&(Ce.OFFSET=Fe,nt.optional(function(){Ce.assert(Ee,Fe+">=0","invalid "+at)})),Fe})}else if(_t&&Ft)return Zr(function(Ce,Ee){return Ce.OFFSET="0",0});return null}var yt=Ut(ki,!0);function Bt(){if(Ai in xt){var at=xt[Ai]|0;return nt.command(typeof at=="number"&&at>=0,"invalid vertex count",ct.commandStr),Zr(function(){return at})}else if(Ai in qt){var _t=qt[Ai];return Pi(_t,function(Ce,Ee){var Fe=Ce.invoke(Ee,_t);return nt.optional(function(){Ce.assert(Ee,"typeof "+Fe+'==="number"&&'+Fe+">=0&&"+Fe+"===("+Fe+"|0)","invalid vertex count")}),Fe})}else if(Ft)if(ua(Ft)){if(Ft)return yt?new Xi(yt.thisDep,yt.contextDep,yt.propDep,function(Ce,Ee){var Fe=Ee.def(Ce.ELEMENTS,".vertCount-",Ce.OFFSET);return nt.optional(function(){Ce.assert(Ee,Fe+">=0","invalid vertex offset/element buffer too small")}),Fe}):Zr(function(Ce,Ee){return Ee.def(Ce.ELEMENTS,".vertCount")});var oe=Zr(function(){return-1});return nt.optional(function(){oe.MISSING=!0}),oe}else{var he=new Xi(Ft.thisDep||yt.thisDep,Ft.contextDep||yt.contextDep,Ft.propDep||yt.propDep,function(Ce,Ee){var Fe=Ce.ELEMENTS;return Ce.OFFSET?Ee.def(Fe,"?",Fe,".vertCount-",Ce.OFFSET,":-1"):Ee.def(Fe,"?",Fe,".vertCount:-1")});return nt.optional(function(){he.DYNAMIC=!0}),he}return null}return{elements:Ft,primitive:Pt(),count:Bt(),instances:Ut(Ra,!1),offset:yt}}function zr(tt,ct){var xt=tt.static,qt=tt.dynamic,Jt={};return we.forEach(function(Ft){var Pt=He(Ft);function Ut(yt,Bt){if(Ft in xt){var at=yt(xt[Ft]);Jt[Pt]=Zr(function(){return at})}else if(Ft in qt){var _t=qt[Ft];Jt[Pt]=Pi(_t,function(oe,he){return Bt(oe,he,oe.invoke(he,_t))})}}switch(Ft){case s:case ys:case Hs:case jt:case Es:case Fn:case it:case Ot:case St:case Ou:return Ut(function(yt){return nt.commandType(yt,"boolean",Ft,ct.commandStr),yt},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,"typeof "+at+'==="boolean"',"invalid flag "+Ft,yt.commandStr)}),at});case Ys:return Ut(function(yt){return nt.commandParameter(yt,Ja,"invalid "+Ft,ct.commandStr),Ja[yt]},function(yt,Bt,at){var _t=yt.constants.compareFuncs;return nt.optional(function(){yt.assert(Bt,at+" in "+_t,"invalid "+Ft+", must be one of "+Object.keys(Ja))}),Bt.def(_t,"[",at,"]")});case $s:return Ut(function(yt){return nt.command(Ar(yt)&&yt.length===2&&typeof yt[0]=="number"&&typeof yt[1]=="number"&&yt[0]<=yt[1],"depth range is 2d array",ct.commandStr),yt},function(yt,Bt,at){nt.optional(function(){yt.assert(Bt,yt.shared.isArrayLike+"("+at+")&&"+at+".length===2&&typeof "+at+'[0]==="number"&&typeof '+at+'[1]==="number"&&'+at+"[0]<="+at+"[1]","depth range must be a 2d array")});var _t=Bt.def("+",at,"[0]"),oe=Bt.def("+",at,"[1]");return[_t,oe]});case Ga:return Ut(function(yt){nt.commandType(yt,"object","blend.func",ct.commandStr);var Bt="srcRGB"in yt?yt.srcRGB:yt.src,at="srcAlpha"in yt?yt.srcAlpha:yt.src,_t="dstRGB"in yt?yt.dstRGB:yt.dst,oe="dstAlpha"in yt?yt.dstAlpha:yt.dst;return nt.commandParameter(Bt,Co,Pt+".srcRGB",ct.commandStr),nt.commandParameter(at,Co,Pt+".srcAlpha",ct.commandStr),nt.commandParameter(_t,Co,Pt+".dstRGB",ct.commandStr),nt.commandParameter(oe,Co,Pt+".dstAlpha",ct.commandStr),nt.command(Xu.indexOf(Bt+", "+_t)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Bt+", "+_t+")",ct.commandStr),[Co[Bt],Co[_t],Co[at],Co[oe]]},function(yt,Bt,at){var _t=yt.constants.blendFuncs;nt.optional(function(){yt.assert(Bt,at+"&&typeof "+at+'==="object"',"invalid blend func, must be an object")});function oe(nn,Sn){var Bn=Bt.def('"',nn,Sn,'" in ',at,"?",at,".",nn,Sn,":",at,".",nn);return nt.optional(function(){yt.assert(Bt,Bn+" in "+_t,"invalid "+Ft+"."+nn+Sn+", must be one of "+Object.keys(Co))}),Bn}var he=oe("src","RGB"),Ce=oe("dst","RGB");nt.optional(function(){var nn=yt.constants.invalidBlendCombinations;yt.assert(Bt,nn+".indexOf("+he+'+", "+'+Ce+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ee=Bt.def(_t,"[",he,"]"),Fe=Bt.def(_t,"[",oe("src","Alpha"),"]"),dn=Bt.def(_t,"[",Ce,"]"),wn=Bt.def(_t,"[",oe("dst","Alpha"),"]");return[Ee,dn,Fe,wn]});case As:return Ut(function(yt){if(typeof yt=="string")return nt.commandParameter(yt,ce,"invalid "+Ft,ct.commandStr),[ce[yt],ce[yt]];if(typeof yt=="object")return nt.commandParameter(yt.rgb,ce,Ft+".rgb",ct.commandStr),nt.commandParameter(yt.alpha,ce,Ft+".alpha",ct.commandStr),[ce[yt.rgb],ce[yt.alpha]];nt.commandRaise("invalid blend.equation",ct.commandStr)},function(yt,Bt,at){var _t=yt.constants.blendEquations,oe=Bt.def(),he=Bt.def(),Ce=yt.cond("typeof ",at,'==="string"');return nt.optional(function(){function Ee(Fe,dn,wn){yt.assert(Fe,wn+" in "+_t,"invalid "+dn+", must be one of "+Object.keys(ce))}Ee(Ce.then,Ft,at),yt.assert(Ce.else,at+"&&typeof "+at+'==="object"',"invalid "+Ft),Ee(Ce.else,Ft+".rgb",at+".rgb"),Ee(Ce.else,Ft+".alpha",at+".alpha")}),Ce.then(oe,"=",he,"=",_t,"[",at,"];"),Ce.else(oe,"=",_t,"[",at,".rgb];",he,"=",_t,"[",at,".alpha];"),Bt(Ce),[oe,he]});case Gs:return Ut(function(yt){return nt.command(Ar(yt)&&yt.length===4,"blend.color must be a 4d array",ct.commandStr),ye(4,function(Bt){return+yt[Bt]})},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,yt.shared.isArrayLike+"("+at+")&&"+at+".length===4","blend.color must be a 4d array")}),ye(4,function(_t){return Bt.def("+",at,"[",_t,"]")})});case be:return Ut(function(yt){return nt.commandType(yt,"number",Pt,ct.commandStr),yt|0},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,"typeof "+at+'==="number"',"invalid stencil.mask")}),Bt.def(at,"|0")});case Oe:return Ut(function(yt){nt.commandType(yt,"object",Pt,ct.commandStr);var Bt=yt.cmp||"keep",at=yt.ref||0,_t="mask"in yt?yt.mask:-1;return nt.commandParameter(Bt,Ja,Ft+".cmp",ct.commandStr),nt.commandType(at,"number",Ft+".ref",ct.commandStr),nt.commandType(_t,"number",Ft+".mask",ct.commandStr),[Ja[Bt],at,_t]},function(yt,Bt,at){var _t=yt.constants.compareFuncs;nt.optional(function(){function Ee(){yt.assert(Bt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ee(at+"&&typeof ",at,'==="object"'),Ee('!("cmp" in ',at,")||(",at,".cmp in ",_t,")")});var oe=Bt.def('"cmp" in ',at,"?",_t,"[",at,".cmp]",":",aa),he=Bt.def(at,".ref|0"),Ce=Bt.def('"mask" in ',at,"?",at,".mask|0:-1");return[oe,he,Ce]});case sn:case An:return Ut(function(yt){nt.commandType(yt,"object",Pt,ct.commandStr);var Bt=yt.fail||"keep",at=yt.zfail||"keep",_t=yt.zpass||"keep";return nt.commandParameter(Bt,sa,Ft+".fail",ct.commandStr),nt.commandParameter(at,sa,Ft+".zfail",ct.commandStr),nt.commandParameter(_t,sa,Ft+".zpass",ct.commandStr),[Ft===An?Ca:Os,sa[Bt],sa[at],sa[_t]]},function(yt,Bt,at){var _t=yt.constants.stencilOps;nt.optional(function(){yt.assert(Bt,at+"&&typeof "+at+'==="object"',"invalid "+Ft)});function oe(he){return nt.optional(function(){yt.assert(Bt,'!("'+he+'" in '+at+")||("+at+"."+he+" in "+_t+")","invalid "+Ft+"."+he+", must be one of "+Object.keys(sa))}),Bt.def('"',he,'" in ',at,"?",_t,"[",at,".",he,"]:",aa)}return[Ft===An?Ca:Os,oe("fail"),oe("zfail"),oe("zpass")]});case dt:return Ut(function(yt){nt.commandType(yt,"object",Pt,ct.commandStr);var Bt=yt.factor|0,at=yt.units|0;return nt.commandType(Bt,"number",Pt+".factor",ct.commandStr),nt.commandType(at,"number",Pt+".units",ct.commandStr),[Bt,at]},function(yt,Bt,at){nt.optional(function(){yt.assert(Bt,at+"&&typeof "+at+'==="object"',"invalid "+Ft)});var _t=Bt.def(at,".factor|0"),oe=Bt.def(at,".units|0");return[_t,oe]});case f:return Ut(function(yt){var Bt=0;return yt==="front"?Bt=Os:yt==="back"&&(Bt=Ca),nt.command(!!Bt,Pt,ct.commandStr),Bt},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,at+'==="front"||'+at+'==="back"',"invalid cull.face")}),Bt.def(at,'==="front"?',Os,":",Ca)});case k:return Ut(function(yt){return nt.command(typeof yt=="number"&&yt>=ee.lineWidthDims[0]&&yt<=ee.lineWidthDims[1],"invalid line width, must be a positive number between "+ee.lineWidthDims[0]+" and "+ee.lineWidthDims[1],ct.commandStr),yt},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,"typeof "+at+'==="number"&&'+at+">="+ee.lineWidthDims[0]+"&&"+at+"<="+ee.lineWidthDims[1],"invalid line width")}),at});case y:return Ut(function(yt){return nt.commandParameter(yt,Lu,Pt,ct.commandStr),Lu[yt]},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,at+'==="cw"||'+at+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Bt.def(at+'==="cw"?'+Zu+":"+Bu)});case Ts:return Ut(function(yt){return nt.command(Ar(yt)&&yt.length===4,"color.mask must be length 4 array",ct.commandStr),yt.map(function(Bt){return!!Bt})},function(yt,Bt,at){return nt.optional(function(){yt.assert(Bt,yt.shared.isArrayLike+"("+at+")&&"+at+".length===4","invalid color.mask")}),ye(4,function(_t){return"!!"+at+"["+_t+"]"})});case vt:return Ut(function(yt){nt.command(typeof yt=="object"&&yt,Pt,ct.commandStr);var Bt="value"in yt?yt.value:1,at=!!yt.invert;return nt.command(typeof Bt=="number"&&Bt>=0&&Bt<=1,"sample.coverage.value must be a number between 0 and 1",ct.commandStr),[Bt,at]},function(yt,Bt,at){nt.optional(function(){yt.assert(Bt,at+"&&typeof "+at+'==="object"',"invalid sample.coverage")});var _t=Bt.def('"value" in ',at,"?+",at,".value:1"),oe=Bt.def("!!",at,".invert");return[_t,oe]})}}),Jt}function qr(tt,ct){var xt=tt.static,qt=tt.dynamic,Jt={};return Object.keys(xt).forEach(function(Ft){var Pt=xt[Ft],Ut;if(typeof Pt=="number"||typeof Pt=="boolean")Ut=Zr(function(){return Pt});else if(typeof Pt=="function"){var yt=Pt._reglType;yt==="texture2d"||yt==="textureCube"?Ut=Zr(function(Bt){return Bt.link(Pt)}):yt==="framebuffer"||yt==="framebufferCube"?(nt.command(Pt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ft+'"',ct.commandStr),Ut=Zr(function(Bt){return Bt.link(Pt.color[0])})):nt.commandRaise('invalid data for uniform "'+Ft+'"',ct.commandStr)}else Ar(Pt)?Ut=Zr(function(Bt){var at=Bt.global.def("[",ye(Pt.length,function(_t){return nt.command(typeof Pt[_t]=="number"||typeof Pt[_t]=="boolean","invalid uniform "+Ft,Bt.commandStr),Pt[_t]}),"]");return at}):nt.commandRaise('invalid or missing data for uniform "'+Ft+'"',ct.commandStr);Ut.value=Pt,Jt[Ft]=Ut}),Object.keys(qt).forEach(function(Ft){var Pt=qt[Ft];Jt[Ft]=Pi(Pt,function(Ut,yt){return Ut.invoke(yt,Pt)})}),Jt}function Xn(tt,ct){var xt=tt.static,qt=tt.dynamic,Jt={};return Object.keys(xt).forEach(function(Ft){var Pt=xt[Ft],Ut=ot.id(Ft),yt=new Ht;if(iu(Pt))yt.state=ia,yt.buffer=ge.getBuffer(ge.create(Pt,Qa,!1,!0)),yt.type=0;else{var Bt=ge.getBuffer(Pt);if(Bt)yt.state=ia,yt.buffer=Bt,yt.type=0;else if(nt.command(typeof Pt=="object"&&Pt,"invalid data for attribute "+Ft,ct.commandStr),"constant"in Pt){var at=Pt.constant;yt.buffer="null",yt.state=vs,typeof at=="number"?yt.x=at:(nt.command(Ar(at)&&at.length>0&&at.length<=4,"invalid constant for attribute "+Ft,ct.commandStr),ra.forEach(function(dn,wn){wn<at.length&&(yt[dn]=at[wn])}))}else{iu(Pt.buffer)?Bt=ge.getBuffer(ge.create(Pt.buffer,Qa,!1,!0)):Bt=ge.getBuffer(Pt.buffer),nt.command(!!Bt,'missing buffer for attribute "'+Ft+'"',ct.commandStr);var _t=Pt.offset|0;nt.command(_t>=0,'invalid offset for attribute "'+Ft+'"',ct.commandStr);var oe=Pt.stride|0;nt.command(oe>=0&&oe<256,'invalid stride for attribute "'+Ft+'", must be integer betweeen [0, 255]',ct.commandStr);var he=Pt.size|0;nt.command(!("size"in Pt)||he>0&&he<=4,'invalid size for attribute "'+Ft+'", must be 1,2,3,4',ct.commandStr);var Ce=!!Pt.normalized,Ee=0;"type"in Pt&&(nt.commandParameter(Pt.type,Ke,"invalid type for attribute "+Ft,ct.commandStr),Ee=Ke[Pt.type]);var Fe=Pt.divisor|0;"divisor"in Pt&&(nt.command(Fe===0||Le,'cannot specify divisor for attribute "'+Ft+'", instancing not supported',ct.commandStr),nt.command(Fe>=0,'invalid divisor for attribute "'+Ft+'"',ct.commandStr)),nt.optional(function(){var dn=ct.commandStr,wn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Pt).forEach(function(nn){nt.command(wn.indexOf(nn)>=0,'unknown parameter "'+nn+'" for attribute pointer "'+Ft+'" (valid parameters are '+wn+")",dn)})}),yt.buffer=Bt,yt.state=ia,yt.size=he,yt.normalized=Ce,yt.type=Ee||Bt.dtype,yt.offset=_t,yt.stride=oe,yt.divisor=Fe}}Jt[Ft]=Zr(function(dn,wn){var nn=dn.attribCache;if(Ut in nn)return nn[Ut];var Sn={isStream:!1};return Object.keys(yt).forEach(function(Bn){Sn[Bn]=yt[Bn]}),yt.buffer&&(Sn.buffer=dn.link(yt.buffer),Sn.type=Sn.type||Sn.buffer+".dtype"),nn[Ut]=Sn,Sn})}),Object.keys(qt).forEach(function(Ft){var Pt=qt[Ft];function Ut(yt,Bt){var at=yt.invoke(Bt,Pt),_t=yt.shared,oe=yt.constants,he=_t.isBufferArgs,Ce=_t.buffer;nt.optional(function(){yt.assert(Bt,at+"&&(typeof "+at+'==="object"||typeof '+at+'==="function")&&('+he+"("+at+")||"+Ce+".getBuffer("+at+")||"+Ce+".getBuffer("+at+".buffer)||"+he+"("+at+'.buffer)||("constant" in '+at+"&&(typeof "+at+'.constant==="number"||'+_t.isArrayLike+"("+at+".constant))))",'invalid dynamic attribute "'+Ft+'"')});var Ee={isStream:Bt.def(!1)},Fe=new Ht;Fe.state=ia,Object.keys(Fe).forEach(function(Sn){Ee[Sn]=Bt.def(""+Fe[Sn])});var dn=Ee.buffer,wn=Ee.type;Bt("if(",he,"(",at,")){",Ee.isStream,"=true;",dn,"=",Ce,".createStream(",Qa,",",at,");",wn,"=",dn,".dtype;","}else{",dn,"=",Ce,".getBuffer(",at,");","if(",dn,"){",wn,"=",dn,".dtype;",'}else if("constant" in ',at,"){",Ee.state,"=",vs,";","if(typeof "+at+'.constant === "number"){',Ee[ra[0]],"=",at,".constant;",ra.slice(1).map(function(Sn){return Ee[Sn]}).join("="),"=0;","}else{",ra.map(function(Sn,Bn){return Ee[Sn]+"="+at+".constant.length>"+Bn+"?"+at+".constant["+Bn+"]:0;"}).join(""),"}}else{","if(",he,"(",at,".buffer)){",dn,"=",Ce,".createStream(",Qa,",",at,".buffer);","}else{",dn,"=",Ce,".getBuffer(",at,".buffer);","}",wn,'="type" in ',at,"?",oe.glTypes,"[",at,".type]:",dn,".dtype;",Ee.normalized,"=!!",at,".normalized;");function nn(Sn){Bt(Ee[Sn],"=",at,".",Sn,"|0;")}return nn("size"),nn("offset"),nn("stride"),nn("divisor"),Bt("}}"),Bt.exit("if(",Ee.isStream,"){",Ce,".destroyStream(",dn,");","}"),Ee}Jt[Ft]=Pi(Pt,Ut)}),Jt}function Hr(tt,ct){var xt=tt.static,qt=tt.dynamic;if(oa in xt){var Jt=xt[oa];return Jt!==null&&je.getVAO(Jt)===null&&(Jt=je.createVAO(Jt)),Zr(function(Pt){return Pt.link(je.getVAO(Jt))})}else if(oa in qt){var Ft=qt[oa];return Pi(Ft,function(Pt,Ut){var yt=Pt.invoke(Ut,Ft);return Ut.def(Pt.shared.vao+".getVAO("+yt+")")})}return null}function Er(tt){var ct=tt.static,xt=tt.dynamic,qt={};return Object.keys(ct).forEach(function(Jt){var Ft=ct[Jt];qt[Jt]=Zr(function(Pt,Ut){return typeof Ft=="number"||typeof Ft=="boolean"?""+Ft:Pt.link(Ft)})}),Object.keys(xt).forEach(function(Jt){var Ft=xt[Jt];qt[Jt]=Pi(Ft,function(Pt,Ut){return Pt.invoke(Ut,Ft)})}),qt}function jr(tt,ct,xt,qt,Jt){var Ft=tt.static,Pt=tt.dynamic;nt.optional(function(){var nn=[fr,ir,lr,Cr,yi,ki,Ai,Ra,er,oa].concat(we);function Sn(Bn){Object.keys(Bn).forEach(function(qn){nt.command(nn.indexOf(qn)>=0,'unknown parameter "'+qn+'"',Jt.commandStr)})}Sn(Ft),Sn(Pt)});var Ut=In(tt,ct),yt=cn(tt,Jt),Bt=Un(tt,yt,Jt),at=Kn(tt,Jt),_t=zr(tt,Jt),oe=Dn(tt,Jt,Ut);function he(nn){var Sn=Bt[nn];Sn&&(_t[nn]=Sn)}he(mr),he(He(Wn));var Ce=Object.keys(_t).length>0,Ee={framebuffer:yt,draw:at,shader:oe,state:_t,dirty:Ce,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ee.profile=Gn(tt,Jt),Ee.uniforms=qr(xt,Jt),Ee.drawVAO=Ee.scopeVAO=Hr(tt,Jt),!Ee.drawVAO&&oe.program&&!Ut&&bt.angle_instanced_arrays){var Fe=!0,dn=oe.program.attributes.map(function(nn){var Sn=ct.static[nn];return Fe=Fe&&!!Sn,Sn});if(Fe&&dn.length>0){var wn=je.getVAO(je.createVAO(dn));Ee.drawVAO=new Xi(null,null,null,function(nn,Sn){return nn.link(wn)}),Ee.useVAO=!0}}return Ut?Ee.useVAO=!0:Ee.attributes=Xn(ct,Jt),Ee.context=Er(qt,Jt),Ee}function Gr(tt,ct,xt){var qt=tt.shared,Jt=qt.context,Ft=tt.scope();Object.keys(xt).forEach(function(Pt){ct.save(Jt,"."+Pt);var Ut=xt[Pt];Ft(Jt,".",Pt,"=",Ut.append(tt,ct),";")}),ct(Ft)}function Yr(tt,ct,xt,qt){var Jt=tt.shared,Ft=Jt.gl,Pt=Jt.framebuffer,Ut;Ge&&(Ut=ct.def(Jt.extensions,".webgl_draw_buffers"));var yt=tt.constants,Bt=yt.drawBuffer,at=yt.backBuffer,_t;xt?_t=xt.append(tt,ct):_t=ct.def(Pt,".next"),qt||ct("if(",_t,"!==",Pt,".cur){"),ct("if(",_t,"){",Ft,".bindFramebuffer(",ku,",",_t,".framebuffer);"),Ge&&ct(Ut,".drawBuffersWEBGL(",Bt,"[",_t,".colorAttachments.length]);"),ct("}else{",Ft,".bindFramebuffer(",ku,",null);"),Ge&&ct(Ut,".drawBuffersWEBGL(",at,");"),ct("}",Pt,".cur=",_t,";"),qt||ct("}")}function ai(tt,ct,xt){var qt=tt.shared,Jt=qt.gl,Ft=tt.current,Pt=tt.next,Ut=qt.current,yt=qt.next,Bt=tt.cond(Ut,".dirty");we.forEach(function(at){var _t=He(at);if(!(_t in xt.state)){var oe,he;if(_t in Pt){oe=Pt[_t],he=Ft[_t];var Ce=ye(Te[_t].length,function(Fe){return Bt.def(oe,"[",Fe,"]")});Bt(tt.cond(Ce.map(function(Fe,dn){return Fe+"!=="+he+"["+dn+"]"}).join("||")).then(Jt,".",Se[_t],"(",Ce,");",Ce.map(function(Fe,dn){return he+"["+dn+"]="+Fe}).join(";"),";"))}else{oe=Bt.def(yt,".",_t);var Ee=tt.cond(oe,"!==",Ut,".",_t);Bt(Ee),_t in We?Ee(tt.cond(oe).then(Jt,".enable(",We[_t],");").else(Jt,".disable(",We[_t],");"),Ut,".",_t,"=",oe,";"):Ee(Jt,".",Se[_t],"(",oe,");",Ut,".",_t,"=",oe,";")}}}),Object.keys(xt.state).length===0&&Bt(Ut,".dirty=false;"),ct(Bt)}function ci(tt,ct,xt,qt){var Jt=tt.shared,Ft=tt.current,Pt=Jt.current,Ut=Jt.gl;Gu(Object.keys(xt)).forEach(function(yt){var Bt=xt[yt];if(!(qt&&!qt(Bt))){var at=Bt.append(tt,ct);if(We[yt]){var _t=We[yt];ua(Bt)?at?ct(Ut,".enable(",_t,");"):ct(Ut,".disable(",_t,");"):ct(tt.cond(at).then(Ut,".enable(",_t,");").else(Ut,".disable(",_t,");")),ct(Pt,".",yt,"=",at,";")}else if(Ar(at)){var oe=Ft[yt];ct(Ut,".",Se[yt],"(",at,");",at.map(function(he,Ce){return oe+"["+Ce+"]="+he}).join(";"),";")}else ct(Ut,".",Se[yt],"(",at,");",Pt,".",yt,"=",at,";")}})}function $r(tt,ct){Le&&(tt.instancing=ct.def(tt.shared.extensions,".angle_instanced_arrays"))}function Mn(tt,ct,xt,qt,Jt){var Ft=tt.shared,Pt=tt.stats,Ut=Ft.current,yt=Ft.timer,Bt=xt.profile;function at(){return typeof performance>"u"?"Date.now()":"performance.now()"}var _t,oe;function he(nn){_t=ct.def(),nn(_t,"=",at(),";"),typeof Jt=="string"?nn(Pt,".count+=",Jt,";"):nn(Pt,".count++;"),Ne&&(qt?(oe=ct.def(),nn(oe,"=",yt,".getNumPendingQueries();")):nn(yt,".beginQuery(",Pt,");"))}function Ce(nn){nn(Pt,".cpuTime+=",at(),"-",_t,";"),Ne&&(qt?nn(yt,".pushScopeStats(",oe,",",yt,".getNumPendingQueries(),",Pt,");"):nn(yt,".endQuery();"))}function Ee(nn){var Sn=ct.def(Ut,".profile");ct(Ut,".profile=",nn,";"),ct.exit(Ut,".profile=",Sn,";")}var Fe;if(Bt){if(ua(Bt)){Bt.enable?(he(ct),Ce(ct.exit),Ee("true")):Ee("false");return}Fe=Bt.append(tt,ct),Ee(Fe)}else Fe=ct.def(Ut,".profile");var dn=tt.block();he(dn),ct("if(",Fe,"){",dn,"}");var wn=tt.block();Ce(wn),ct.exit("if(",Fe,"){",wn,"}")}function li(tt,ct,xt,qt,Jt){var Ft=tt.shared;function Pt(yt){switch(yt){case Ws:case Ks:case eu:return 2;case Qs:case qs:case nu:return 3;case Js:case tu:case ru:return 4;default:return 1}}function Ut(yt,Bt,at){var _t=Ft.gl,oe=ct.def(yt,".location"),he=ct.def(Ft.attributes,"[",oe,"]"),Ce=at.state,Ee=at.buffer,Fe=[at.x,at.y,at.z,at.w],dn=["buffer","normalized","offset","stride"];function wn(){ct("if(!",he,".buffer){",_t,".enableVertexAttribArray(",oe,");}");var Sn=at.type,Bn;if(at.size?Bn=ct.def(at.size,"||",Bt):Bn=Bt,ct("if(",he,".type!==",Sn,"||",he,".size!==",Bn,"||",dn.map(function(Vr){return he+"."+Vr+"!=="+at[Vr]}).join("||"),"){",_t,".bindBuffer(",Qa,",",Ee,".buffer);",_t,".vertexAttribPointer(",[oe,Bn,Sn,at.normalized,at.stride,at.offset],");",he,".type=",Sn,";",he,".size=",Bn,";",dn.map(function(Vr){return he+"."+Vr+"="+at[Vr]+";"}).join(""),"}"),Le){var qn=at.divisor;ct("if(",he,".divisor!==",qn,"){",tt.instancing,".vertexAttribDivisorANGLE(",[oe,qn],");",he,".divisor=",qn,";}")}}function nn(){ct("if(",he,".buffer){",_t,".disableVertexAttribArray(",oe,");",he,".buffer=null;","}if(",ra.map(function(Sn,Bn){return he+"."+Sn+"!=="+Fe[Bn]}).join("||"),"){",_t,".vertexAttrib4f(",oe,",",Fe,");",ra.map(function(Sn,Bn){return he+"."+Sn+"="+Fe[Bn]+";"}).join(""),"}")}Ce===ia?wn():Ce===vs?nn():(ct("if(",Ce,"===",ia,"){"),wn(),ct("}else{"),nn(),ct("}"))}qt.forEach(function(yt){var Bt=yt.name,at=xt.attributes[Bt],_t;if(at){if(!Jt(at))return;_t=at.append(tt,ct)}else{if(!Jt(Yu))return;var oe=tt.scopeAttrib(Bt);nt.optional(function(){tt.assert(ct,oe+".state","missing attribute "+Bt)}),_t={},Object.keys(new Ht).forEach(function(he){_t[he]=ct.def(oe,".",he)})}Ut(tt.link(yt),Pt(yt.info.type),_t)})}function nr(tt,ct,xt,qt,Jt){for(var Ft=tt.shared,Pt=Ft.gl,Ut,yt=0;yt<qt.length;++yt){var Bt=qt[yt],at=Bt.name,_t=Bt.info.type,oe=xt.uniforms[at],he=tt.link(Bt),Ce=he+".location",Ee;if(oe){if(!Jt(oe))continue;if(ua(oe)){var Fe=oe.value;if(nt.command(Fe!==null&&typeof Fe<"u",'missing uniform "'+at+'"',tt.commandStr),_t===Cs||_t===bs){nt.command(typeof Fe=="function"&&(_t===Cs&&(Fe._reglType==="texture2d"||Fe._reglType==="framebuffer")||_t===bs&&(Fe._reglType==="textureCube"||Fe._reglType==="framebufferCube")),"invalid texture for uniform "+at,tt.commandStr);var dn=tt.link(Fe._texture||Fe.color[0]._texture);ct(Pt,".uniform1i(",Ce,",",dn+".bind());"),ct.exit(dn,".unbind();")}else if(_t===Ss||_t===xs||_t===Rs){nt.optional(function(){nt.command(Ar(Fe),"invalid matrix for uniform "+at,tt.commandStr),nt.command(_t===Ss&&Fe.length===4||_t===xs&&Fe.length===9||_t===Rs&&Fe.length===16,"invalid length for matrix uniform "+at,tt.commandStr)});var wn=tt.global.def("new Float32Array(["+Array.prototype.slice.call(Fe)+"])"),nn=2;_t===xs?nn=3:_t===Rs&&(nn=4),ct(Pt,".uniformMatrix",nn,"fv(",Ce,",false,",wn,");")}else{switch(_t){case Nu:nt.commandType(Fe,"number","uniform "+at,tt.commandStr),Ut="1f";break;case Ws:nt.command(Ar(Fe)&&Fe.length===2,"uniform "+at,tt.commandStr),Ut="2f";break;case Qs:nt.command(Ar(Fe)&&Fe.length===3,"uniform "+at,tt.commandStr),Ut="3f";break;case Js:nt.command(Ar(Fe)&&Fe.length===4,"uniform "+at,tt.commandStr),Ut="4f";break;case Fu:nt.commandType(Fe,"boolean","uniform "+at,tt.commandStr),Ut="1i";break;case Iu:nt.commandType(Fe,"number","uniform "+at,tt.commandStr),Ut="1i";break;case eu:nt.command(Ar(Fe)&&Fe.length===2,"uniform "+at,tt.commandStr),Ut="2i";break;case Ks:nt.command(Ar(Fe)&&Fe.length===2,"uniform "+at,tt.commandStr),Ut="2i";break;case nu:nt.command(Ar(Fe)&&Fe.length===3,"uniform "+at,tt.commandStr),Ut="3i";break;case qs:nt.command(Ar(Fe)&&Fe.length===3,"uniform "+at,tt.commandStr),Ut="3i";break;case ru:nt.command(Ar(Fe)&&Fe.length===4,"uniform "+at,tt.commandStr),Ut="4i";break;case tu:nt.command(Ar(Fe)&&Fe.length===4,"uniform "+at,tt.commandStr),Ut="4i";break}ct(Pt,".uniform",Ut,"(",Ce,",",Ar(Fe)?Array.prototype.slice.call(Fe):Fe,");")}continue}else Ee=oe.append(tt,ct)}else{if(!Jt(Yu))continue;Ee=ct.def(Ft.uniforms,"[",ot.id(at),"]")}_t===Cs?ct("if(",Ee,"&&",Ee,'._reglType==="framebuffer"){',Ee,"=",Ee,".color[0];","}"):_t===bs&&ct("if(",Ee,"&&",Ee,'._reglType==="framebufferCube"){',Ee,"=",Ee,".color[0];","}"),nt.optional(function(){function ao(jo,tl){tt.assert(ct,jo,'bad data or missing for uniform "'+at+'".  '+tl)}function Mu(jo){ao("typeof "+Ee+'==="'+jo+'"',"invalid type, expected "+jo)}function Qi(jo,tl){ao(Ft.isArrayLike+"("+Ee+")&&"+Ee+".length==="+jo,"invalid vector, should have length "+jo,tt.commandStr)}function qu(jo){ao("typeof "+Ee+'==="function"&&'+Ee+'._reglType==="texture'+(jo===Pu?"2d":"Cube")+'"',"invalid texture type",tt.commandStr)}switch(_t){case Iu:Mu("number");break;case Ks:Qi(2,"number");break;case qs:Qi(3,"number");break;case tu:Qi(4,"number");break;case Nu:Mu("number");break;case Ws:Qi(2,"number");break;case Qs:Qi(3,"number");break;case Js:Qi(4,"number");break;case Fu:Mu("boolean");break;case eu:Qi(2,"boolean");break;case nu:Qi(3,"boolean");break;case ru:Qi(4,"boolean");break;case Ss:Qi(4,"number");break;case xs:Qi(9,"number");break;case Rs:Qi(16,"number");break;case Cs:qu(Pu);break;case bs:qu(sl);break}});var Sn=1;switch(_t){case Cs:case bs:var Bn=ct.def(Ee,"._texture");ct(Pt,".uniform1i(",Ce,",",Bn,".bind());"),ct.exit(Bn,".unbind();");continue;case Iu:case Fu:Ut="1i";break;case Ks:case eu:Ut="2i",Sn=2;break;case qs:case nu:Ut="3i",Sn=3;break;case tu:case ru:Ut="4i",Sn=4;break;case Nu:Ut="1f";break;case Ws:Ut="2f",Sn=2;break;case Qs:Ut="3f",Sn=3;break;case Js:Ut="4f",Sn=4;break;case Ss:Ut="Matrix2fv";break;case xs:Ut="Matrix3fv";break;case Rs:Ut="Matrix4fv";break}if(ct(Pt,".uniform",Ut,"(",Ce,","),Ut.charAt(0)==="M"){var qn=Math.pow(_t-Ss+2,2),Vr=tt.global.def("new Float32Array(",qn,")");ct("false,(Array.isArray(",Ee,")||",Ee," instanceof Float32Array)?",Ee,":(",ye(qn,function(ao){return Vr+"["+ao+"]="+Ee+"["+ao+"]"}),",",Vr,")")}else Sn>1?ct(ye(Sn,function(ao){return Ee+"["+ao+"]"})):ct(Ee);ct(");")}}function En(tt,ct,xt,qt){var Jt=tt.shared,Ft=Jt.gl,Pt=Jt.draw,Ut=qt.draw;function yt(){var Bn=Ut.elements,qn,Vr=ct;return Bn?((Bn.contextDep&&qt.contextDynamic||Bn.propDep)&&(Vr=xt),qn=Bn.append(tt,Vr)):qn=Vr.def(Pt,".",Cr),qn&&Vr("if("+qn+")"+Ft+".bindBuffer("+il+","+qn+".buffer.buffer);"),qn}function Bt(){var Bn=Ut.count,qn,Vr=ct;return Bn?((Bn.contextDep&&qt.contextDynamic||Bn.propDep)&&(Vr=xt),qn=Bn.append(tt,Vr),nt.optional(function(){Bn.MISSING&&tt.assert(ct,"false","missing vertex count"),Bn.DYNAMIC&&tt.assert(Vr,qn+">=0","missing vertex count")})):(qn=Vr.def(Pt,".",Ai),nt.optional(function(){tt.assert(Vr,qn+">=0","missing vertex count")})),qn}var at=yt();function _t(Bn){var qn=Ut[Bn];return qn?qn.contextDep&&qt.contextDynamic||qn.propDep?qn.append(tt,xt):qn.append(tt,ct):ct.def(Pt,".",Bn)}var oe=_t(yi),he=_t(ki),Ce=Bt();if(typeof Ce=="number"){if(Ce===0)return}else xt("if(",Ce,"){"),xt.exit("}");var Ee,Fe;Le&&(Ee=_t(Ra),Fe=tt.instancing);var dn=at+".type",wn=Ut.elements&&ua(Ut.elements);function nn(){function Bn(){xt(Fe,".drawElementsInstancedANGLE(",[oe,Ce,dn,he+"<<(("+dn+"-"+ps+")>>1)",Ee],");")}function qn(){xt(Fe,".drawArraysInstancedANGLE(",[oe,he,Ce,Ee],");")}at?wn?Bn():(xt("if(",at,"){"),Bn(),xt("}else{"),qn(),xt("}")):qn()}function Sn(){function Bn(){xt(Ft+".drawElements("+[oe,Ce,dn,he+"<<(("+dn+"-"+ps+")>>1)"]+");")}function qn(){xt(Ft+".drawArrays("+[oe,he,Ce]+");")}at?wn?Bn():(xt("if(",at,"){"),Bn(),xt("}else{"),qn(),xt("}")):qn()}Le&&(typeof Ee!="number"||Ee>=0)?typeof Ee=="string"?(xt("if(",Ee,">0){"),nn(),xt("}else if(",Ee,"<0){"),Sn(),xt("}")):nn():Sn()}function kn(tt,ct,xt,qt,Jt){var Ft=Nn(),Pt=Ft.proc("body",Jt);return nt.optional(function(){Ft.commandStr=ct.commandStr,Ft.command=Ft.link(ct.commandStr)}),Le&&(Ft.instancing=Pt.def(Ft.shared.extensions,".angle_instanced_arrays")),tt(Ft,Pt,xt,qt),Ft.compile().body}function $n(tt,ct,xt,qt){$r(tt,ct),xt.useVAO?xt.drawVAO?ct(tt.shared.vao,".setVAO(",xt.drawVAO.append(tt,ct),");"):ct(tt.shared.vao,".setVAO(",tt.shared.vao,".targetVAO);"):(ct(tt.shared.vao,".setVAO(null);"),li(tt,ct,xt,qt.attributes,function(){return!0})),nr(tt,ct,xt,qt.uniforms,function(){return!0}),En(tt,ct,ct,xt)}function _r(tt,ct){var xt=tt.proc("draw",1);$r(tt,xt),Gr(tt,xt,ct.context),Yr(tt,xt,ct.framebuffer),ai(tt,xt,ct),ci(tt,xt,ct.state),Mn(tt,xt,ct,!1,!0);var qt=ct.shader.progVar.append(tt,xt);if(xt(tt.shared.gl,".useProgram(",qt,".program);"),ct.shader.program)$n(tt,xt,ct,ct.shader.program);else{xt(tt.shared.vao,".setVAO(null);");var Jt=tt.global.def("{}"),Ft=xt.def(qt,".id"),Pt=xt.def(Jt,"[",Ft,"]");xt(tt.cond(Pt).then(Pt,".call(this,a0);").else(Pt,"=",Jt,"[",Ft,"]=",tt.link(function(Ut){return kn($n,tt,ct,Ut,1)}),"(",qt,");",Pt,".call(this,a0);"))}Object.keys(ct.state).length>0&&xt(tt.shared.current,".dirty=true;")}function bo(tt,ct,xt,qt){tt.batchId="a1",$r(tt,ct);function Jt(){return!0}li(tt,ct,xt,qt.attributes,Jt),nr(tt,ct,xt,qt.uniforms,Jt),En(tt,ct,ct,xt)}function gt(tt,ct,xt,qt){$r(tt,ct);var Jt=xt.contextDep,Ft=ct.def(),Pt="a0",Ut="a1",yt=ct.def();tt.shared.props=yt,tt.batchId=Ft;var Bt=tt.scope(),at=tt.scope();ct(Bt.entry,"for(",Ft,"=0;",Ft,"<",Ut,";++",Ft,"){",yt,"=",Pt,"[",Ft,"];",at,"}",Bt.exit);function _t(dn){return dn.contextDep&&Jt||dn.propDep}function oe(dn){return!_t(dn)}if(xt.needsContext&&Gr(tt,at,xt.context),xt.needsFramebuffer&&Yr(tt,at,xt.framebuffer),ci(tt,at,xt.state,_t),xt.profile&&_t(xt.profile)&&Mn(tt,at,xt,!1,!0),qt)xt.useVAO?xt.drawVAO?_t(xt.drawVAO)?at(tt.shared.vao,".setVAO(",xt.drawVAO.append(tt,at),");"):Bt(tt.shared.vao,".setVAO(",xt.drawVAO.append(tt,Bt),");"):Bt(tt.shared.vao,".setVAO(",tt.shared.vao,".targetVAO);"):(Bt(tt.shared.vao,".setVAO(null);"),li(tt,Bt,xt,qt.attributes,oe),li(tt,at,xt,qt.attributes,_t)),nr(tt,Bt,xt,qt.uniforms,oe),nr(tt,at,xt,qt.uniforms,_t),En(tt,Bt,at,xt);else{var he=tt.global.def("{}"),Ce=xt.shader.progVar.append(tt,at),Ee=at.def(Ce,".id"),Fe=at.def(he,"[",Ee,"]");at(tt.shared.gl,".useProgram(",Ce,".program);","if(!",Fe,"){",Fe,"=",he,"[",Ee,"]=",tt.link(function(dn){return kn(bo,tt,xt,dn,2)}),"(",Ce,");}",Fe,".call(this,a0[",Ft,"],",Ft,");")}}function ue(tt,ct){var xt=tt.proc("batch",2);tt.batchId="0",$r(tt,xt);var qt=!1,Jt=!0;Object.keys(ct.context).forEach(function(he){qt=qt||ct.context[he].propDep}),qt||(Gr(tt,xt,ct.context),Jt=!1);var Ft=ct.framebuffer,Pt=!1;Ft?(Ft.propDep?qt=Pt=!0:Ft.contextDep&&qt&&(Pt=!0),Pt||Yr(tt,xt,Ft)):Yr(tt,xt,null),ct.state.viewport&&ct.state.viewport.propDep&&(qt=!0);function Ut(he){return he.contextDep&&qt||he.propDep}ai(tt,xt,ct),ci(tt,xt,ct.state,function(he){return!Ut(he)}),(!ct.profile||!Ut(ct.profile))&&Mn(tt,xt,ct,!1,"a1"),ct.contextDep=qt,ct.needsContext=Jt,ct.needsFramebuffer=Pt;var yt=ct.shader.progVar;if(yt.contextDep&&qt||yt.propDep)gt(tt,xt,ct,null);else{var Bt=yt.append(tt,xt);if(xt(tt.shared.gl,".useProgram(",Bt,".program);"),ct.shader.program)gt(tt,xt,ct,ct.shader.program);else{xt(tt.shared.vao,".setVAO(null);");var at=tt.global.def("{}"),_t=xt.def(Bt,".id"),oe=xt.def(at,"[",_t,"]");xt(tt.cond(oe).then(oe,".call(this,a0,a1);").else(oe,"=",at,"[",_t,"]=",tt.link(function(he){return kn(gt,tt,ct,he,2)}),"(",Bt,");",oe,".call(this,a0,a1);"))}}Object.keys(ct.state).length>0&&xt(tt.shared.current,".dirty=true;")}function Kt(tt,ct){var xt=tt.proc("scope",3);tt.batchId="a2";var qt=tt.shared,Jt=qt.current;Gr(tt,xt,ct.context),ct.framebuffer&&ct.framebuffer.append(tt,xt),Gu(Object.keys(ct.state)).forEach(function(Pt){var Ut=ct.state[Pt],yt=Ut.append(tt,xt);Ar(yt)?yt.forEach(function(Bt,at){xt.set(tt.next[Pt],"["+at+"]",Bt)}):xt.set(qt.next,"."+Pt,yt)}),Mn(tt,xt,ct,!0,!0),[Cr,ki,Ai,Ra,yi].forEach(function(Pt){var Ut=ct.draw[Pt];Ut&&xt.set(qt.draw,"."+Pt,""+Ut.append(tt,xt))}),Object.keys(ct.uniforms).forEach(function(Pt){xt.set(qt.uniforms,"["+ot.id(Pt)+"]",ct.uniforms[Pt].append(tt,xt))}),Object.keys(ct.attributes).forEach(function(Pt){var Ut=ct.attributes[Pt].append(tt,xt),yt=tt.scopeAttrib(Pt);Object.keys(new Ht).forEach(function(Bt){xt.set(yt,"."+Bt,Ut[Bt])})}),ct.scopeVAO&&xt.set(qt.vao,".targetVAO",ct.scopeVAO.append(tt,xt));function Ft(Pt){var Ut=ct.shader[Pt];Ut&&xt.set(qt.shader,"."+Pt,Ut.append(tt,xt))}Ft(ir),Ft(lr),Object.keys(ct.state).length>0&&(xt(Jt,".dirty=true;"),xt.exit(Jt,".dirty=true;")),xt("a1(",tt.shared.context,",a0,",tt.batchId,");")}function tn(tt){if(!(typeof tt!="object"||Ar(tt))){for(var ct=Object.keys(tt),xt=0;xt<ct.length;++xt)if(Zt.isDynamic(tt[ct[xt]]))return!0;return!1}}function Zn(tt,ct,xt){var qt=ct.static[xt];if(!qt||!tn(qt))return;var Jt=tt.global,Ft=Object.keys(qt),Pt=!1,Ut=!1,yt=!1,Bt=tt.global.def("{}");Ft.forEach(function(_t){var oe=qt[_t];if(Zt.isDynamic(oe)){typeof oe=="function"&&(oe=qt[_t]=Zt.unbox(oe));var he=Pi(oe,null);Pt=Pt||he.thisDep,yt=yt||he.propDep,Ut=Ut||he.contextDep}else{switch(Jt(Bt,".",_t,"="),typeof oe){case"number":Jt(oe);break;case"string":Jt('"',oe,'"');break;case"object":Array.isArray(oe)&&Jt("[",oe.join(),"]");break;default:Jt(tt.link(oe));break}Jt(";")}});function at(_t,oe){Ft.forEach(function(he){var Ce=qt[he];if(Zt.isDynamic(Ce)){var Ee=_t.invoke(oe,Ce);oe(Bt,".",he,"=",Ee,";")}})}ct.dynamic[xt]=new Zt.DynamicVariable(gs,{thisDep:Pt,contextDep:Ut,propDep:yt,ref:Bt,append:at}),delete ct.static[xt]}function hr(tt,ct,xt,qt,Jt){var Ft=Nn();Ft.stats=Ft.link(Jt),Object.keys(ct.static).forEach(function(Ut){Zn(Ft,ct,Ut)}),rl.forEach(function(Ut){Zn(Ft,tt,Ut)});var Pt=jr(tt,ct,xt,qt,Ft);return _r(Ft,Pt),Kt(Ft,Pt),ue(Ft,Pt),Ft.compile()}return{next:qe,current:Te,procs:function(){var tt=Nn(),ct=tt.proc("poll"),xt=tt.proc("refresh"),qt=tt.block();ct(qt),xt(qt);var Jt=tt.shared,Ft=Jt.gl,Pt=Jt.next,Ut=Jt.current;qt(Ut,".dirty=false;"),Yr(tt,ct),Yr(tt,xt,null,!0);var yt;Le&&(yt=tt.link(Le)),bt.oes_vertex_array_object&&xt(tt.link(bt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Bt=0;Bt<ee.maxAttributes;++Bt){var at=xt.def(Jt.attributes,"[",Bt,"]"),_t=tt.cond(at,".buffer");_t.then(Ft,".enableVertexAttribArray(",Bt,");",Ft,".bindBuffer(",Qa,",",at,".buffer.buffer);",Ft,".vertexAttribPointer(",Bt,",",at,".size,",at,".type,",at,".normalized,",at,".stride,",at,".offset);").else(Ft,".disableVertexAttribArray(",Bt,");",Ft,".vertexAttrib4f(",Bt,",",at,".x,",at,".y,",at,".z,",at,".w);",at,".buffer=null;"),xt(_t),Le&&xt(yt,".vertexAttribDivisorANGLE(",Bt,",",at,".divisor);")}return xt(tt.shared.vao,".currentVAO=null;",tt.shared.vao,".setVAO(",tt.shared.vao,".targetVAO);"),Object.keys(We).forEach(function(oe){var he=We[oe],Ce=qt.def(Pt,".",oe),Ee=tt.block();Ee("if(",Ce,"){",Ft,".enable(",he,")}else{",Ft,".disable(",he,")}",Ut,".",oe,"=",Ce,";"),xt(Ee),ct("if(",Ce,"!==",Ut,".",oe,"){",Ee,"}")}),Object.keys(Se).forEach(function(oe){var he=Se[oe],Ce=Te[oe],Ee,Fe,dn=tt.block();if(dn(Ft,".",he,"("),Ar(Ce)){var wn=Ce.length;Ee=tt.global.def(Pt,".",oe),Fe=tt.global.def(Ut,".",oe),dn(ye(wn,function(nn){return Ee+"["+nn+"]"}),");",ye(wn,function(nn){return Fe+"["+nn+"]="+Ee+"["+nn+"];"}).join("")),ct("if(",ye(wn,function(nn){return Ee+"["+nn+"]!=="+Fe+"["+nn+"]"}).join("||"),"){",dn,"}")}else Ee=qt.def(Pt,".",oe),Fe=qt.def(Ut,".",oe),dn(Ee,");",Ut,".",oe,"=",Ee,";"),ct("if(",Ee,"!==",Fe,"){",dn,"}");xt(dn)}),tt.compile()}(),compile:hr}}function xl(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Rl=34918,Cl=34919,$u=35007,bl=function(F,ot){if(!ot.ext_disjoint_timer_query)return null;var bt=[];function ee(){return bt.pop()||ot.ext_disjoint_timer_query.createQueryEXT()}function ge(Le){bt.push(Le)}var ie=[];function fe(Le){var Ge=ee();ot.ext_disjoint_timer_query.beginQueryEXT($u,Ge),ie.push(Ge),Ne(ie.length-1,ie.length,Le)}function Be(){ot.ext_disjoint_timer_query.endQueryEXT($u)}function Me(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var je=[];function De(){return je.pop()||new Me}function Ue(Le){je.push(Le)}var Ve=[];function Ne(Le,Ge,Te){var qe=De();qe.startQueryIndex=Le,qe.endQueryIndex=Ge,qe.sum=0,qe.stats=Te,Ve.push(qe)}var Ze=[],Ht=[];function ce(){var Le,Ge,Te=ie.length;if(Te!==0){Ht.length=Math.max(Ht.length,Te+1),Ze.length=Math.max(Ze.length,Te+1),Ze[0]=0,Ht[0]=0;var qe=0;for(Le=0,Ge=0;Ge<ie.length;++Ge){var we=ie[Ge];ot.ext_disjoint_timer_query.getQueryObjectEXT(we,Cl)?(qe+=ot.ext_disjoint_timer_query.getQueryObjectEXT(we,Rl),ge(we)):ie[Le++]=we,Ze[Ge+1]=qe,Ht[Ge+1]=Le}for(ie.length=Le,Le=0,Ge=0;Ge<Ve.length;++Ge){var We=Ve[Ge],Se=We.startQueryIndex,He=We.endQueryIndex;We.sum+=Ze[He]-Ze[Se];var mn=Ht[Se],On=Ht[He];On===mn?(We.stats.gpuTime+=We.sum/1e6,Ue(We)):(We.startQueryIndex=mn,We.endQueryIndex=On,Ve[Le++]=We)}Ve.length=Le}}return{beginQuery:fe,endQuery:Be,pushScopeStats:Ne,update:ce,getNumPendingQueries:function(){return ie.length},clear:function(){bt.push.apply(bt,ie);for(var Le=0;Le<bt.length;Le++)ot.ext_disjoint_timer_query.deleteQueryEXT(bt[Le]);ie.length=0,bt.length=0},restore:function(){ie.length=0,bt.length=0}}},Ol=16384,Nl=256,Il=1024,Fl=34962,Wu="webglcontextlost",Qu="webglcontextrestored",Ju=1,Bl=2,Ll=3;function Ku(F,ot){for(var bt=0;bt<F.length;++bt)if(F[bt]===ot)return bt;return-1}function Ml(F){var ot=en(F);if(!ot)return null;var bt=ot.gl,ee=bt.getContextAttributes(),ge=bt.isContextLost(),ie=se(bt,ot);if(!ie)return null;var fe=pt(),Be=xl(),Me=ie.extensions,je=bl(bt,Me),De=Y(),Ue=bt.drawingBufferWidth,Ve=bt.drawingBufferHeight,Ne={tick:0,time:0,viewportWidth:Ue,viewportHeight:Ve,framebufferWidth:Ue,framebufferHeight:Ve,drawingBufferWidth:Ue,drawingBufferHeight:Ve,pixelRatio:ot.pixelRatio},Ze={},Ht={elements:null,primitive:4,count:-1,offset:0,instances:-1},ce=Pr(bt,Me),Le=Kr(bt,Be,ot,Te),Ge=hs(bt,Me,ce,Be,Le);function Te(En){return Ge.destroyBuffer(En)}var qe=da(bt,Me,Le,Be),we=Su(bt,fe,Be,ot),We=on(bt,Me,ce,function(){mn.procs.poll()},Ne,Be,ot),Se=io(bt,Me,ce,Be,ot),He=gu(bt,Me,ce,We,Se,Be),mn=Sl(bt,fe,Me,ce,Le,qe,We,He,Ze,Ge,we,Ht,Ne,je,ot),On=Cu(bt,He,mn.procs.poll,Ne,ee,Me,ce),Ye=mn.next,_e=bt.canvas,Ae=[],Nn=[],Gn=[],cn=[ot.onDestroy],Un=null;function In(){if(Ae.length===0){je&&je.update(),Un=null;return}Un=P.next(In),ci();for(var En=Ae.length-1;En>=0;--En){var kn=Ae[En];kn&&kn(Ne,null,0)}bt.flush(),je&&je.update()}function Dn(){!Un&&Ae.length>0&&(Un=P.next(In))}function Kn(){Un&&(P.cancel(In),Un=null)}function zr(En){En.preventDefault(),ge=!0,Kn(),Nn.forEach(function(kn){kn()})}function qr(En){bt.getError(),ge=!1,ie.restore(),we.restore(),Le.restore(),We.restore(),Se.restore(),He.restore(),Ge.restore(),je&&je.restore(),mn.procs.refresh(),Dn(),Gn.forEach(function(kn){kn()})}_e&&(_e.addEventListener(Wu,zr,!1),_e.addEventListener(Qu,qr,!1));function Xn(){Ae.length=0,Kn(),_e&&(_e.removeEventListener(Wu,zr),_e.removeEventListener(Qu,qr)),we.clear(),He.clear(),Se.clear(),We.clear(),qe.clear(),Le.clear(),Ge.clear(),je&&je.clear(),cn.forEach(function(En){En()})}function Hr(En){nt(!!En,"invalid args to regl({...})"),nt.type(En,"object","invalid args to regl({...})");function kn(Jt){var Ft=e({},Jt);delete Ft.uniforms,delete Ft.attributes,delete Ft.context,delete Ft.vao,"stencil"in Ft&&Ft.stencil.op&&(Ft.stencil.opBack=Ft.stencil.opFront=Ft.stencil.op,delete Ft.stencil.op);function Pt(Ut){if(Ut in Ft){var yt=Ft[Ut];delete Ft[Ut],Object.keys(yt).forEach(function(Bt){Ft[Ut+"."+Bt]=yt[Bt]})}}return Pt("blend"),Pt("depth"),Pt("cull"),Pt("stencil"),Pt("polygonOffset"),Pt("scissor"),Pt("sample"),"vao"in Jt&&(Ft.vao=Jt.vao),Ft}function $n(Jt){var Ft={},Pt={};return Object.keys(Jt).forEach(function(Ut){var yt=Jt[Ut];Zt.isDynamic(yt)?Pt[Ut]=Zt.unbox(yt,Ut):Ft[Ut]=yt}),{dynamic:Pt,static:Ft}}var _r=$n(En.context||{}),bo=$n(En.uniforms||{}),gt=$n(En.attributes||{}),ue=$n(kn(En)),Kt={gpuTime:0,cpuTime:0,count:0},tn=mn.compile(ue,gt,bo,_r,Kt),Zn=tn.draw,hr=tn.batch,tt=tn.scope,ct=[];function xt(Jt){for(;ct.length<Jt;)ct.push(null);return ct}function qt(Jt,Ft){var Pt;if(ge&&nt.raise("context lost"),typeof Jt=="function")return tt.call(this,null,Jt,0);if(typeof Ft=="function")if(typeof Jt=="number")for(Pt=0;Pt<Jt;++Pt)tt.call(this,null,Ft,Pt);else if(Array.isArray(Jt))for(Pt=0;Pt<Jt.length;++Pt)tt.call(this,Jt[Pt],Ft,Pt);else return tt.call(this,Jt,Ft,0);else if(typeof Jt=="number"){if(Jt>0)return hr.call(this,xt(Jt|0),Jt|0)}else if(Array.isArray(Jt)){if(Jt.length)return hr.call(this,Jt,Jt.length)}else return Zn.call(this,Jt)}return e(qt,{stats:Kt})}var Er=He.setFBO=Hr({framebuffer:Zt.define.call(null,Ju,"framebuffer")});function jr(En,kn){var $n=0;mn.procs.poll();var _r=kn.color;_r&&(bt.clearColor(+_r[0]||0,+_r[1]||0,+_r[2]||0,+_r[3]||0),$n|=Ol),"depth"in kn&&(bt.clearDepth(+kn.depth),$n|=Nl),"stencil"in kn&&(bt.clearStencil(kn.stencil|0),$n|=Il),nt(!!$n,"called regl.clear with no buffer specified"),bt.clear($n)}function Gr(En){if(nt(typeof En=="object"&&En,"regl.clear() takes an object as input"),"framebuffer"in En)if(En.framebuffer&&En.framebuffer_reglType==="framebufferCube")for(var kn=0;kn<6;++kn)Er(e({framebuffer:En.framebuffer.faces[kn]},En),jr);else Er(En,jr);else jr(null,En)}function Yr(En){nt.type(En,"function","regl.frame() callback must be a function"),Ae.push(En);function kn(){var $n=Ku(Ae,En);nt($n>=0,"cannot cancel a frame twice");function _r(){var bo=Ku(Ae,_r);Ae[bo]=Ae[Ae.length-1],Ae.length-=1,Ae.length<=0&&Kn()}Ae[$n]=_r}return Dn(),{cancel:kn}}function ai(){var En=Ye.viewport,kn=Ye.scissor_box;En[0]=En[1]=kn[0]=kn[1]=0,Ne.viewportWidth=Ne.framebufferWidth=Ne.drawingBufferWidth=En[2]=kn[2]=bt.drawingBufferWidth,Ne.viewportHeight=Ne.framebufferHeight=Ne.drawingBufferHeight=En[3]=kn[3]=bt.drawingBufferHeight}function ci(){Ne.tick+=1,Ne.time=Mn(),ai(),mn.procs.poll()}function $r(){ai(),mn.procs.refresh(),je&&je.update()}function Mn(){return(Y()-De)/1e3}$r();function li(En,kn){nt.type(kn,"function","listener callback must be a function");var $n;switch(En){case"frame":return Yr(kn);case"lost":$n=Nn;break;case"restore":$n=Gn;break;case"destroy":$n=cn;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return $n.push(kn),{cancel:function(){for(var _r=0;_r<$n.length;++_r)if($n[_r]===kn){$n[_r]=$n[$n.length-1],$n.pop();return}}}}var nr=e(Hr,{clear:Gr,prop:Zt.define.bind(null,Ju),context:Zt.define.bind(null,Bl),this:Zt.define.bind(null,Ll),draw:Hr({}),buffer:function(En){return Le.create(En,Fl,!1,!1)},elements:function(En){return qe.create(En,!1)},texture:We.create2D,cube:We.createCube,renderbuffer:Se.create,framebuffer:He.create,framebufferCube:He.createCube,vao:Ge.createVAO,attributes:ee,frame:Yr,on:li,limits:ce,hasExtension:function(En){return ce.extensions.indexOf(En.toLowerCase())>=0},read:On,destroy:Xn,_gl:bt,_refresh:$r,poll:function(){ci(),je&&je.update()},now:Mn,stats:Be});return ot.onDone(null,nr),nr}return Ml})},69848:function(Xt){(function(K,e){Xt.exports=e()})(this,function(){"use strict";function K(N,Q,ft,I,G,ut){if(!(G-I<=ft)){var L=I+G>>1;e(N,Q,L,I,G,ut%2),K(N,Q,ft,I,L-1,ut+1),K(N,Q,ft,L+1,G,ut+1)}}function e(N,Q,ft,I,G,ut){for(;G>I;){if(G-I>600){var L=G-I+1,j=ft-I+1,O=Math.log(L),B=.5*Math.exp(2*O/3),_=.5*Math.sqrt(O*B*(L-B)/L)*(j-L/2<0?-1:1),H=Math.max(I,Math.floor(ft-j*B/L+_)),U=Math.min(G,Math.floor(ft+(L-j)*B/L+_));e(N,Q,ft,H,U,ut)}var V=Q[2*ft+ut],D=I,lt=G;for(u(N,Q,I,ft),Q[2*G+ut]>V&&u(N,Q,I,G);D<lt;){for(u(N,Q,D,lt),D++,lt--;Q[2*D+ut]<V;)D++;for(;Q[2*lt+ut]>V;)lt--}Q[2*I+ut]===V?u(N,Q,I,lt):(lt++,u(N,Q,lt,G)),lt<=ft&&(I=lt+1),ft<=lt&&(G=lt-1)}}function u(N,Q,ft,I){i(N,ft,I),i(Q,2*ft,2*I),i(Q,2*ft+1,2*I+1)}function i(N,Q,ft){var I=N[Q];N[Q]=N[ft],N[ft]=I}function a(N,Q,ft,I,G,ut,L){for(var j=[0,N.length-1,0],O=[],B,_;j.length;){var H=j.pop(),U=j.pop(),V=j.pop();if(U-V<=L){for(var D=V;D<=U;D++)B=Q[2*D],_=Q[2*D+1],B>=ft&&B<=G&&_>=I&&_<=ut&&O.push(N[D]);continue}var lt=Math.floor((V+U)/2);B=Q[2*lt],_=Q[2*lt+1],B>=ft&&B<=G&&_>=I&&_<=ut&&O.push(N[lt]);var J=(H+1)%2;(H===0?ft<=B:I<=_)&&(j.push(V),j.push(lt-1),j.push(J)),(H===0?G>=B:ut>=_)&&(j.push(lt+1),j.push(U),j.push(J))}return O}function c(N,Q,ft,I,G,ut){for(var L=[0,N.length-1,0],j=[],O=G*G;L.length;){var B=L.pop(),_=L.pop(),H=L.pop();if(_-H<=ut){for(var U=H;U<=_;U++)d(Q[2*U],Q[2*U+1],ft,I)<=O&&j.push(N[U]);continue}var V=Math.floor((H+_)/2),D=Q[2*V],lt=Q[2*V+1];d(D,lt,ft,I)<=O&&j.push(N[V]);var J=(B+1)%2;(B===0?ft-G<=D:I-G<=lt)&&(L.push(H),L.push(V-1),L.push(J)),(B===0?ft+G>=D:I+G>=lt)&&(L.push(V+1),L.push(_),L.push(J))}return j}function d(N,Q,ft,I){var G=N-ft,ut=Q-I;return G*G+ut*ut}var m=function(N){return N[0]},l=function(N){return N[1]},r=function(Q,ft,I,G,ut){ft===void 0&&(ft=m),I===void 0&&(I=l),G===void 0&&(G=64),ut===void 0&&(ut=Float64Array),this.nodeSize=G,this.points=Q;for(var L=Q.length<65536?Uint16Array:Uint32Array,j=this.ids=new L(Q.length),O=this.coords=new ut(Q.length*2),B=0;B<Q.length;B++)j[B]=B,O[2*B]=ft(Q[B]),O[2*B+1]=I(Q[B]);K(j,O,G,0,j.length-1,0)};r.prototype.range=function(Q,ft,I,G){return a(this.ids,this.coords,Q,ft,I,G,this.nodeSize)},r.prototype.within=function(Q,ft,I){return c(this.ids,this.coords,Q,ft,I,this.nodeSize)};var h={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(N){return N}},g=Math.fround||function(N){return function(Q){return N[0]=+Q,N[0]}}(new Float32Array(1)),A=function(Q){this.options=M(Object.create(h),Q),this.trees=new Array(this.options.maxZoom+1)};A.prototype.load=function(Q){var ft=this.options,I=ft.log,G=ft.minZoom,ut=ft.maxZoom,L=ft.nodeSize;I&&console.time("total time");var j="prepare "+Q.length+" points";I&&console.time(j),this.points=Q;for(var O=[],B=0;B<Q.length;B++)Q[B].geometry&&O.push(S(Q[B],B));this.trees[ut+1]=new r(O,Z,rt,L,Float32Array),I&&console.timeEnd(j);for(var _=ut;_>=G;_--){var H=+Date.now();O=this._cluster(O,_),this.trees[_]=new r(O,Z,rt,L,Float32Array),I&&console.log("z%d: %d clusters in %dms",_,O.length,+Date.now()-H)}return I&&console.timeEnd("total time"),this},A.prototype.getClusters=function(Q,ft){var I=((Q[0]+180)%360+360)%360-180,G=Math.max(-90,Math.min(90,Q[1])),ut=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,L=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)I=-180,ut=180;else if(I>ut){var j=this.getClusters([I,G,180,L],ft),O=this.getClusters([-180,G,ut,L],ft);return j.concat(O)}for(var B=this.trees[this._limitZoom(ft)],_=B.range(b(I),C(L),b(ut),C(G)),H=[],U=0,V=_;U<V.length;U+=1){var D=V[U],lt=B.points[D];H.push(lt.numPoints?T(lt):this.points[lt.index])}return H},A.prototype.getChildren=function(Q){var ft=this._getOriginId(Q),I=this._getOriginZoom(Q),G="No cluster with the specified id.",ut=this.trees[I];if(!ut)throw new Error(G);var L=ut.points[ft];if(!L)throw new Error(G);for(var j=this.options.radius/(this.options.extent*Math.pow(2,I-1)),O=ut.within(L.x,L.y,j),B=[],_=0,H=O;_<H.length;_+=1){var U=H[_],V=ut.points[U];V.parentId===Q&&B.push(V.numPoints?T(V):this.points[V.index])}if(B.length===0)throw new Error(G);return B},A.prototype.getLeaves=function(Q,ft,I){ft=ft||10,I=I||0;var G=[];return this._appendLeaves(G,Q,ft,I,0),G},A.prototype.getTile=function(Q,ft,I){var G=this.trees[this._limitZoom(Q)],ut=Math.pow(2,Q),L=this.options,j=L.extent,O=L.radius,B=O/j,_=(I-B)/ut,H=(I+1+B)/ut,U={features:[]};return this._addTileFeatures(G.range((ft-B)/ut,_,(ft+1+B)/ut,H),G.points,ft,I,ut,U),ft===0&&this._addTileFeatures(G.range(1-B/ut,_,1,H),G.points,ut,I,ut,U),ft===ut-1&&this._addTileFeatures(G.range(0,_,B/ut,H),G.points,-1,I,ut,U),U.features.length?U:null},A.prototype.getClusterExpansionZoom=function(Q){for(var ft=this._getOriginZoom(Q)-1;ft<=this.options.maxZoom;){var I=this.getChildren(Q);if(ft++,I.length!==1)break;Q=I[0].properties.cluster_id}return ft},A.prototype._appendLeaves=function(Q,ft,I,G,ut){for(var L=this.getChildren(ft),j=0,O=L;j<O.length;j+=1){var B=O[j],_=B.properties;if(_&&_.cluster?ut+_.point_count<=G?ut+=_.point_count:ut=this._appendLeaves(Q,_.cluster_id,I,G,ut):ut<G?ut++:Q.push(B),Q.length===I)break}return ut},A.prototype._addTileFeatures=function(Q,ft,I,G,ut,L){for(var j=0,O=Q;j<O.length;j+=1){var B=O[j],_=ft[B],H=_.numPoints,U=void 0,V=void 0,D=void 0;if(H)U=E(_),V=_.x,D=_.y;else{var lt=this.points[_.index];U=lt.properties,V=b(lt.geometry.coordinates[0]),D=C(lt.geometry.coordinates[1])}var J={type:1,geometry:[[Math.round(this.options.extent*(V*ut-I)),Math.round(this.options.extent*(D*ut-G))]],tags:U},Rt=void 0;H?Rt=_.id:this.options.generateId?Rt=_.index:this.points[_.index].id&&(Rt=this.points[_.index].id),Rt!==void 0&&(J.id=Rt),L.features.push(J)}},A.prototype._limitZoom=function(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))},A.prototype._cluster=function(Q,ft){for(var I=[],G=this.options,ut=G.radius,L=G.extent,j=G.reduce,O=G.minPoints,B=ut/(L*Math.pow(2,ft)),_=0;_<Q.length;_++){var H=Q[_];if(!(H.zoom<=ft)){H.zoom=ft;for(var U=this.trees[ft+1],V=U.within(H.x,H.y,B),D=H.numPoints||1,lt=D,J=0,Rt=V;J<Rt.length;J+=1){var kt=Rt[J],ne=U.points[kt];ne.zoom>ft&&(lt+=ne.numPoints||1)}if(lt>D&&lt>=O){for(var re=H.x*D,It=H.y*D,Nt=j&&D>1?this._map(H,!0):null,p=(_<<5)+(ft+1)+this.points.length,w=0,W=V;w<W.length;w+=1){var st=W[w],Tt=U.points[st];if(!(Tt.zoom<=ft)){Tt.zoom=ft;var Gt=Tt.numPoints||1;re+=Tt.x*Gt,It+=Tt.y*Gt,Tt.parentId=p,j&&(Nt||(Nt=this._map(H,!0)),j(Nt,this._map(Tt)))}}H.parentId=p,I.push(o(re/lt,It/lt,p,lt,Nt))}else if(I.push(H),lt>1)for(var ze=0,$e=V;ze<$e.length;ze+=1){var rn=$e[ze],gn=U.points[rn];gn.zoom<=ft||(gn.zoom=ft,I.push(gn))}}}return I},A.prototype._getOriginId=function(Q){return Q-this.points.length>>5},A.prototype._getOriginZoom=function(Q){return(Q-this.points.length)%32},A.prototype._map=function(Q,ft){if(Q.numPoints)return ft?M({},Q.properties):Q.properties;var I=this.points[Q.index].properties,G=this.options.map(I);return ft&&G===I?M({},G):G};function o(N,Q,ft,I,G){return{x:g(N),y:g(Q),zoom:1/0,id:ft,parentId:-1,numPoints:I,properties:G}}function S(N,Q){var ft=N.geometry.coordinates,I=ft[0],G=ft[1];return{x:g(b(I)),y:g(C(G)),zoom:1/0,index:Q,parentId:-1}}function T(N){return{type:"Feature",id:N.id,properties:E(N),geometry:{type:"Point",coordinates:[X(N.x),R(N.y)]}}}function E(N){var Q=N.numPoints,ft=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return M(M({},N.properties),{cluster:!0,cluster_id:N.id,point_count:Q,point_count_abbreviated:ft})}function b(N){return N/360+.5}function C(N){var Q=Math.sin(N*Math.PI/180),ft=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ft<0?0:ft>1?1:ft}function X(N){return(N-.5)*360}function R(N){var Q=(180-N*360)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function M(N,Q){for(var ft in Q)N[ft]=Q[ft];return N}function Z(N){return N.x}function rt(N){return N.y}return A})}}]);
