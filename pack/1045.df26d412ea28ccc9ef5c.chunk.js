"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[1045],{91045:(q,Z,o)=>{o.r(Z),o.d(Z,{default:()=>$});var j=o(33867),P=o(85105),S=o.n(P),x=o(99663),k=o(22600),N=o(49135),D=o(93196),e=o(67294),h=o(64712),ee=o(93967),te=o(31277),F=o(31929),ne=o(12438),M=o(89552),ae=o(80176),T=o(2307),O=o(54208),le=o(34279),g=o(64749),K=o(88106),se=o(59768),A=o(82891),U=o(26581),oe=o(67272),R=o(51024),c=o(65406),B=o(71411),H=o(10929),z=o(60510),b=o(23002),V=o(30381),Y=o.n(V),f=o(67707),w=R.default.Search,W={name:0,isVerified:8,status:11,postCount:2,groupMemberCount:3,createTime:0},re={open:{title:_l("\u5F00\u542F\u7FA4\u7EC4"),description:_l("\u786E\u8BA4\u5F00\u542F\u6240\u9009\u62E9\u7684\u7FA4\u7EC4?"),success:_l("\u5F00\u542F\u7FA4\u7EC4\u6210\u529F"),fail:_l("\u5F00\u542F\u7FA4\u7EC4\u5931\u8D25"),func:c.Z.openGroup}},J=function(I){(0,D.default)(i,I);function i(){(0,x.default)(this,i);var l=(0,N.default)(this,(i.__proto__||S()(i)).call(this));return l.changPage=function(n){l.setState({pageIndex:n,selectKeys:[]},function(){return l.getGroupsList()})},l.optionAlert=function(n,t){alert({msg:n,type:t,key:"updateGroupVerified"})},l.updateDeptMappingGroup=function(n,t,a){var s={groupId:n,isVerified:t,mapDepartmentId:a};if(!s.mapDepartmentId){alert(_l("\u8BF7\u9009\u62E9\u5173\u8054\u90E8\u95E8"),3);return}l.optionAlert(_l("\u64CD\u4F5C\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),3),c.Z.updateGroupVerified(s).then(function(r){r?(l.optionAlert(_l("\u64CD\u4F5C\u6210\u529F")),l.getGroupsList()):l.optionAlert(_l("\u64CD\u4F5C\u5931\u8D25"),3)})},l.onSelectChange=function(n){l.setState({selectKeys:n})},l.state={count:0,list:[],pageIndex:1,pageSize:50,selectKeys:[],keywords:"",status:void 0,types:void 0,sortField:0,sortType:0,loading:!1},l.columns=[{title:_l("\u7FA4\u7EC4\u540D\u79F0"),dataIndex:"name",render:function(t,a){return e.createElement("div",{className:"nameBox"},e.createElement("img",{src:a.avatar,alt:"avatar"}),e.createElement("a",{className:"overflow_ellipsis",href:"/group/groupValidate?gID="+a.groupId,target:"_blank"},t))},width:150,sorter:!0},{title:_l("\u7C7B\u578B"),dataIndex:"isVerified",render:function(t,a){return e.createElement("div",{className:"typeBox"},t?e.createElement(U.Z,{popupPlacement:"bottom",text:e.createElement("span",null,_l("\u5173\u8054\u90E8\u95E8\uFF1A%0",a.mapDepartmentName))},e.createElement("i",{className:"TxtMiddle mRight5 icon-official-group Font10 color_y"})):e.createElement("i",{className:"TxtMiddle mRight5 icon-official-group Font10 transparentColor"}),t?_l("\u5B98\u65B9"):_l("\u666E\u901A"))},sorter:!0},{title:_l("\u72B6\u6001"),dataIndex:"status",render:function(t){return t?e.createElement("span",{className:"color_gr"},_l("\u6B63\u5E38")):e.createElement("span",{className:"color_g"},_l("\u5DF2\u5173\u95ED"))},sorter:!0},{title:_l("\u52A8\u6001\u6570"),dataIndex:"postCount",sorter:!0},{title:_l("\u6210\u5458\u6570"),dataIndex:"groupMemberCount",sorter:!0},{title:_l("\u521B\u5EFA\u4EBA"),dataIndex:"createAccount",render:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.createElement("div",{className:"overflow_ellipsis",style:{maxWidth:150}},t.fullname)}},{title:_l("\u521B\u5EFA\u65F6\u95F4"),dataIndex:"createTime",render:function(t){return e.createElement("span",{className:"color_g"},Y()(t).format("YYYY.MM.DD"))},sorter:!0},{title:_l("\u64CD\u4F5C"),dataIndex:"option",render:function(t,a){var s=e.createElement("div",{className:"menuOption"},a.isVerified?e.createElement(e.Fragment,null,e.createElement("div",{onClick:function(){return l.handleEditDept(a)}},_l("\u4FEE\u6539\u5173\u8054\u90E8\u95E8")),e.createElement("div",{onClick:function(){return l.hanldeDeleteDept(a)}},_l("\u53D6\u6D88\u5173\u8054\u90E8\u95E8"))):e.createElement("div",{onClick:function(){return l.handleSetDept(a)}},_l("\u8BBE\u7F6E\u5173\u8054\u90E8\u95E8")),e.createElement("div",{onClick:function(){return l.props.setLevel("member",a.name,a.groupId)}},_l("\u6210\u5458\u7BA1\u7406")),e.createElement("div",{onClick:function(){return a.status===1?l.handleClose(a.groupId):l.handleOpen(a.groupId)}},a.status===1?_l("\u5173\u95ED\u7FA4\u7EC4"):_l("\u5F00\u542F\u7FA4\u7EC4")),e.createElement("div",{onClick:function(){return l.handleDissolve(a.groupId)}},_l("\u89E3\u6563\u7FA4\u7EC4")));return e.createElement(A.default,{overlay:s,trigger:["click"]},e.createElement("span",{className:"icon-moreop Font18 pointer Gray_9e"}))}}],l}return(0,k.default)(i,[{key:"componentDidMount",value:function(){this.getGroupsList()}},{key:"getGroupsList",value:function(){var n=this;this.setState({loading:!0,selectKeys:[]});var t={pageIndex:this.state.pageIndex,pageSize:this.state.pageSize,keywords:this.state.keywords,sortType:parseInt(this.state.sortType),sortFiled:parseInt(this.state.sortField),firstLetters:[],containHidden:!0,withMapDepartment:!0,projectId:h.Z.projectId};isNaN(this.state.status)||(t.status=this.state.status),isNaN(this.state.types)||(t.groupType=this.state.types),c.Z.getGroups(t).then(function(a){n.setState({count:49,list:a.list,loading:!1})})}},{key:"handleChangeSort",value:function(n,t,a){var s=this,r=a.field,u=a.order,E=u==="ascend"?1:0;this.setState({sortField:u?W[r]:0,sortType:E},function(){s.getGroupsList()})}},{key:"handleEditDept",value:function(n){var t=this;(0,z.Z)({projectId:h.Z.projectId,unique:!0,selectFn:function(s){t.updateDeptMappingGroup(n.groupId,!0,s.departmentId)}})}},{key:"hanldeDeleteDept",value:function(n){var t=this;(0,f.Z)({title:_l("\u5173\u8054\u90E8\u95E8"),description:_l("\u786E\u8BA4\u53D6\u6D88\u5173\u8054\u90E8\u95E8?"),onOk:function(){t.updateDeptMappingGroup(n.groupId,!1,n.mapDepartmentId)}})}},{key:"handleSetDept",value:function(n){var t=this;(0,z.Z)({projectId:h.Z.projectId,callback:function(s){t.updateDeptMappingGroup(n.groupId,!0,s.departmentId)}})}},{key:"handleOpen",value:function(n){var t=this;(0,f.Z)({title:_l("\u5F00\u542F\u7FA4\u7EC4"),description:_l("\u786E\u8BA4\u5F00\u542F\u6240\u9009\u62E9\u7684\u7FA4\u7EC4?"),onOk:function(){c.Z.openGroup({groupIds:n?[n]:t.state.selectKeys}).then(function(s){s?(alert(_l("\u5F00\u542F\u7FA4\u7EC4\u6210\u529F")),t.getGroupsList()):alert(_l("\u5F00\u542F\u7FA4\u7EC4\u5931\u8D25"),2)})}})}},{key:"handleClose",value:function(n){var t=this;(0,f.Z)({title:_l("\u5173\u95ED\u7FA4\u7EC4"),description:_l("\u786E\u8BA4\u5173\u95ED\u6240\u9009\u62E9\u7684\u7FA4\u7EC4?"),onOk:function(){c.Z.closeGroup({groupIds:n?[n]:t.state.selectKeys}).then(function(s){s?(alert(_l("\u5173\u95ED\u7FA4\u7EC4\u6210\u529F")),t.getGroupsList()):alert(_l("\u5173\u95ED\u7FA4\u7EC4\u5931\u8D25"),2)})}})}},{key:"handleDissolve",value:function(n){var t=this;(0,f.Z)({title:_l("\u89E3\u6563\u7FA4\u7EC4"),description:_l("\u786E\u8BA4\u89E3\u6563\u6240\u9009\u62E9\u7684\u7FA4\u7EC4\uFF1F"),onOk:function(){c.Z.removeGroup({groupIds:n?[n]:t.state.selectKeys}).then(function(s){s?(alert(_l("\u89E3\u6563\u7FA4\u7EC4\u6210\u529F")),t.getGroupsList()):alert(_l("\u89E3\u6563\u7FA4\u7EC4\u5931\u8D25"),2)})}})}},{key:"handleCreate",value:function(){var n=this;b.Z.createInit({projectId:h.Z.projectId,callback:function(){n.getGroupsList()}})}},{key:"handleSelectChange",value:function(n,t){var a,s=this;this.setState((a={},(0,K.default)(a,t,n),(0,K.default)(a,"pageIndex",1),a),function(){s.getGroupsList()})}},{key:"handleInputChange",value:function(n){var t=this;this.setState({keywords:n,pageIndex:1},function(){t.getGroupsList()})}},{key:"render",value:function(){var n=this,t=this.state,a=t.selectKeys,s=t.types,r=t.status,u=t.loading,E=t.list,v=t.count,y=t.pageSize,L=t.pageIndex,G={selectedRowKeys:a,onChange:this.onSelectChange},d={icon:"icon-myUpload",desc:_l("\u65E0\u7FA4\u7EC4")},C=function(){return e.createElement(B.Z,{detail:d})};return e.createElement("div",{className:"groupsList"},e.createElement("div",{className:"groupTool"},e.createElement("div",{className:"groupItem"},a.length?e.createElement(e.Fragment,null,e.createElement("span",{className:"Font16 color_b Bold LineHeight35"},_l("\u5DF2\u9009\u62E9%0\u6761",a.length)),e.createElement("div",{className:"mLeft32 Hand pTop3 itemIconBox",onClick:function(){return n.handleOpen()}},e.createElement("span",{className:"icon Font14 icon-task-new-no-locked mRight5"}),e.createElement("span",{className:"LineHeight36"},_l("\u5F00\u542F"))),e.createElement("div",{className:"mLeft24 Hand pTop3 itemIconBox",onClick:function(){return n.handleClose()}},e.createElement("span",{className:"icon Font14 icon-task-new-locked mRight5"}),e.createElement("span",{className:"LineHeight36"},_l("\u5173\u95ED"))),e.createElement("div",{className:"mLeft24 Hand pTop3 itemIconBox",onClick:function(){return n.handleDissolve()}},e.createElement("span",{className:"icon Font12 icon-workflow_cancel mRight5"}),e.createElement("span",{className:"LineHeight36"},_l("\u89E3\u6563")))):e.createElement("button",{className:"ming Button Button--primary Button--small itemCreate Bold",onClick:this.handleCreate.bind(this)},_l("\u65B0\u5EFA\u7FA4\u7EC4"))),e.createElement("div",{className:"groupItem"},e.createElement(w,{allowClear:!0,placeholder:_l("\u641C\u7D22"),onSearch:function(m){return n.handleInputChange(m)}}),e.createElement(g.default,{allowClear:!0,className:"mRight10 mLeft10",value:s,onChange:function(m){return n.handleSelectChange(m,"types")},placeholder:_l("\u5168\u90E8\u7C7B\u578B")},e.createElement(g.default.Option,{value:1},_l("\u5B98\u65B9\u7FA4\u7EC4")),e.createElement(g.default.Option,{value:0},_l("\u666E\u901A\u7FA4\u7EC4"))),e.createElement(g.default,{allowClear:!0,value:r,onChange:function(m){return n.handleSelectChange(m,"status")},placeholder:_l("\u5168\u90E8\u72B6\u6001")},e.createElement(g.default.Option,{value:1},_l("\u6B63\u5E38\u7FA4\u7EC4")),e.createElement(g.default.Option,{value:0},_l("\u5DF2\u5173\u95ED\u7FA4\u7EC4"))))),e.createElement("div",{className:"tableList mdAntTable"},e.createElement(F.default,{renderEmpty:C},e.createElement(M.default,{indicator:e.createElement(O.Z,null),spinning:u},e.createElement(T.Z,{rowSelection:G,rowKey:function(m){return m.groupId},columns:this.columns,dataSource:E,pagination:!1,showSorterTooltip:!1,onChange:this.handleChangeSort.bind(this),scroll:v==0?{}:{y:v>y?"calc(100vh - 300px)":"calc(100vh - 260px)"}}),v>y&&e.createElement(H.Z,{total:v,pageIndex:L,pageSize:y,onChange:this.changPage})))))}}]),i}(e.Component),Q=R.default.Search,X=function(I){(0,D.default)(i,I);function i(l){(0,x.default)(this,i);var n=(0,N.default)(this,(i.__proto__||S()(i)).call(this,l));return n.changePage=function(t){n.setState({pageIndex:t,selectKeys:[]},function(){return n.getGroupsList()})},n.handleSet=function(t){(0,f.Z)({title:_l("\u8BBE\u7F6E\u7BA1\u7406\u5458"),description:_l("\u786E\u8BA4\u5C06\u6240\u9009\u62E9\u4EBA\u5458\u8BBE\u7F6E\u4E3A\u7BA1\u7406\u5458?"),onOk:function(){c.Z.addAdmin({accountIds:t?[t]:n.state.selectKeys,groupId:n.props.groupId}).then(function(s){s?(alert(_l("\u8BBE\u7F6E\u6210\u529F")),n.getGroupsList()):alert(_l("\u8BBE\u7F6E\u5931\u8D25"),2)})}})},n.onSelectChange=function(t){n.setState({selectKeys:t})},n.state={pageIndex:1,pageSize:20,keywords:"",count:0,list:[],selectKeys:[],loading:!1},n.columns=[{title:_l("\u59D3\u540D"),dataIndex:"fullname",render:function(a,s){return e.createElement("div",{className:"nameBox"},e.createElement("img",{src:s.avatar,alt:"avatar"}),e.createElement("span",{className:"mRight5 ellipsis"},a),s.groupUserRole===1?e.createElement("i",{class:"TxtMiddle icon-limit-othermember color_y Font10"}):"")}},{title:_l("\u90E8\u95E8"),dataIndex:"department"},{title:_l("\u7535\u5B50\u90AE\u4EF6\u5730\u5740"),dataIndex:"email"},{title:_l("\u64CD\u4F5C"),dataIndex:"option",render:function(a,s){return e.createElement("div",{className:"Hand ThemeColor3 Font13 adminHoverColor",onClick:function(){return s.groupUserRole===1?n.handleDelete(s.accountId,s.fullname):n.handleSet(s.accountId)}},s.groupUserRole===1?_l("\u79FB\u9664\u7BA1\u7406\u5458"):_l("\u8BBE\u4E3A\u7BA1\u7406\u5458"))}}],n}return(0,k.default)(i,[{key:"componentDidMount",value:function(){this.getGroupsList()}},{key:"getGroupsList",value:function(){var n=this;this.setState({loading:!0});var t={pageIndex:this.state.pageIndex,pageSize:this.state.pageSize,groupId:this.props.groupId,keywords:this.state.keyword,type:1,projectId:h.Z.projectId};c.Z.getGroupUsers(t).then(function(a){n.setState({count:a.groupMemberCount,list:a.groupUsers||[],loading:!1})})}},{key:"handleInputChange",value:function(n){var t=this;this.setState({keywords:n,pageIndex:1},function(){t.getGroupsList()})}},{key:"handleDelete",value:function(n,t){var a=this;(0,f.Z)({title:_l("\u79FB\u9664\u7BA1\u7406\u5458"),description:_l("\u786E\u8BA4\u79FB\u9664%0\u7684\u7BA1\u7406\u5458\u6743\u9650\uFF1F",t),onOk:function(){c.Z.removeAdmin({accountId:n,groupId:a.props.groupId}).then(function(r){r==1?(alert(_l("\u79FB\u9664%0\u7684\u7BA1\u7406\u5458\u6743\u9650\u6210\u529F",t)),a.getGroupsList()):r==2?alert(_l("\u5F53\u524D\u7FA4\u7EC4\u8FD8\u6709\u5176\u4ED6\u6210\u5458\u4F46\u53EA\u6709\u4F60\u4E00\u4E2A\u7BA1\u7406\u5458\uFF0C\u79FB\u51FA\u8BF7\u5148\u8BBE\u7F6E\u4E00\u4F4D\u7BA1\u7406\u5458"),3):alert(_l("\u79FB\u9664%0\u7684\u7BA1\u7406\u5458\u6743\u9650\u5931\u8D25",t),2)})}})}},{key:"render",value:function(){var n=this,t=this.state,a=t.selectKeys,s=t.pageSize,r=t.count,u=t.pageIndex,E=t.list,v=t.loading,y={selectKeys:a,onChange:this.onSelectChange,getCheckboxProps:function(C){return C.groupUserRole===1?{disabled:!0}:null}},L={icon:"icon-myUpload",desc:_l("\u65E0\u6210\u5458")},G=function(){return e.createElement(B.Z,{detail:L})};return e.createElement("div",{className:"groupsList"},e.createElement("div",{className:"groupTool"},e.createElement("div",{className:"groupItem"},a.length?e.createElement(e.Fragment,null,e.createElement("span",{className:"Font16 color_b Bold"},_l("\u5DF2\u9009\u62E9%0\u6761",a.length)),e.createElement("div",{className:"ThemeColor3 mLeft30 Hand",onClick:function(){return n.handleSet()}},e.createElement("span",{className:"icon icon-sp_filter_none_white"}),e.createElement("span",null,_l("\u8BBE\u7F6E\u4E3A\u7BA1\u7406\u5458")))):e.createElement(Q,{allowClear:!0,placeholder:_l("\u641C\u7D22"),onSearch:_.debounce(function(d){return n.handleInputChange(d)},500)}))),e.createElement("div",{className:"tableList"},e.createElement(F.default,{renderEmpty:G},e.createElement(M.default,{indicator:e.createElement(O.Z,null),spinning:v},e.createElement(T.Z,{rowSelection:y,rowKey:function(C){return C.accountId},columns:this.columns,dataSource:E,pagination:!1,scroll:r==0?{}:{y:r>s?"calc(100vh - 300px)":"calc(100vh - 260px)"}}),r>s&&e.createElement(H.Z,{total:r,pageIndex:u,pageSize:s,onChange:this.changePage})))))}}]),i}(e.Component),$=function(I){(0,D.default)(i,I);function i(){(0,x.default)(this,i);var l=(0,N.default)(this,(i.__proto__||S()(i)).call(this));return h.Z.setPageTitle(_l("\u7FA4\u7EC4")),l.state={level:"index",name:"",groupId:""},l}return(0,k.default)(i,[{key:"setLevel",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";this.setState({level:n,name:t,groupId:a})}},{key:"render",value:function(){var n=this,t=this.state,a=t.level,s=t.name,r=t.groupId;return e.createElement("div",{id:"groupDept",className:"orgManagementWrap"},e.createElement("div",{className:"orgManagementHeader"},a==="index"?_l("\u7FA4\u7EC4"):e.createElement("div",{className:"subTabBox"},e.createElement(j.Z,{icon:"backspace",className:"Hand mRight18 TxtMiddle Font24 adminHeaderIconColor",onClick:function(){return n.setLevel("index")}}),e.createElement("span",{className:"Font17 Bold"},_l("\u6210\u5458\u7BA1\u7406 - %0",s)))),e.createElement("div",{className:"groupContent"},a==="index"?e.createElement(J,{setLevel:this.setLevel.bind(this)}):e.createElement(X,{groupId:r})))}}]),i}(e.Component)}}]);
