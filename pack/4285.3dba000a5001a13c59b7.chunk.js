"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4285],{74285:(R,h,l)=>{l.r(h),l.d(h,{default:()=>X});var E=l(54208),u=l(70801),K=l(69852),p=l(97538),L=l(67272),g=l(51024),V=l(11378),y=l(56697),G=l(52262),f=l(65400),N=l(88106),k=l(85105),B=l.n(k),x=l(99663),S=l(22600),T=l(49135),F=l(93196),e=l(67294),Z=l(73935),b=l(36964),I=l.n(b),s=l(28829),D=l(15577),i=l(64712),j=l(93967),v=l.n(j),O=l(96486),C=l.n(O),P=[{key:"name",text:_l("\u516C\u4F17\u53F7\u540D\u79F0"),clickText:_l("\u53D6\u6D88\u7ED1\u5B9A"),clickKey:"unbind"},{key:"appId",text:_l("\u5F00\u53D1\u8005ID\uFF08AppID\uFF09"),clickText:_l("\u590D\u5236"),clickKey:"copy",private:!0,desc:_l("\u5FAE\u4FE1\u516C\u4F17\u53F7\u7BA1\u7406\u540E\u53F0-\u8BBE\u7F6E\u4E0E\u5F00\u53D1-\u57FA\u672C\u914D\u7F6E\u9875\u9762\u5185\u7684\u5B57\u6BB5")},{key:"appSecret",text:_l("\u5F00\u53D1\u8005\u5BC6\u7801(AppSecret)"),clickText:_l("\u590D\u5236"),clickKey:"copy",private:!0,desc:_l("\u5FAE\u4FE1\u516C\u4F17\u53F7\u7BA1\u7406\u540E\u53F0-\u8BBE\u7F6E\u4E0E\u5F00\u53D1-\u57FA\u672C\u914D\u7F6E\u9875\u9762\u5185\u7684\u5B57\u6BB5")}],W=[{key:"name",label:_l("\u516C\u4F17\u53F7\u540D\u79F0"),type:"text"},{key:"appId",label:_l("\u5F00\u53D1\u8005ID\uFF08AppID\uFF09"),type:"text",description:_l("\u5FAE\u4FE1\u516C\u4F17\u53F7\u7BA1\u7406\u540E\u53F0-\u8BBE\u7F6E\u4E0E\u5F00\u53D1-\u57FA\u672C\u914D\u7F6E\u9875\u9762\u5185\u7684\u5B57\u6BB5")},{key:"appSecret",label:_l("\u5F00\u53D1\u8005\u5BC6\u7801(AppSecret)"),type:"password",description:_l("\u5FAE\u4FE1\u516C\u4F17\u53F7\u7BA1\u7406\u540E\u53F0-\u8BBE\u7F6E\u4E0E\u5F00\u53D1-\u57FA\u672C\u914D\u7F6E\u9875\u9762\u5185\u7684\u5B57\u6BB5")}],A=[{key:"nickName",text:_l("\u516C\u4F17\u53F7\u540D\u79F0"),clickText:_l("\u53D6\u6D88\u7ED1\u5B9A"),clickKey:"unbind"},{key:"appId",text:_l("AppID"),clickText:_l("\u590D\u5236"),clickKey:"copy"},{key:"funcInfo",text:_l("\u5DF2\u6388\u6743\u6743\u9650"),clickText:_l("\u67E5\u770B"),clickKey:"view"},{key:"principalName",text:_l("\u4E3B\u4F53\u540D\u79F0")}],H=[{value:2,text:_l("\u7528\u6237\u7BA1\u7406\u6743\u9650 ")},{value:4,text:_l("\u7F51\u9875\u670D\u52A1\u6743\u9650")},{value:7,text:_l("\u7FA4\u53D1\u4E0E\u901A\u77E5\u6743\u9650")}],X=function(M){(0,F.default)(r,M);function r(d){(0,x.default)(this,r);var n=(0,T.default)(this,(r.__proto__||B()(r)).call(this,d));return n.getWeiXinBindingInfo=function(){n.setState({loading:!0}),s.Z.getWeiXinBindingInfo({projectId:i.Z.projectId}).then(function(t){n.setState({loading:!1}),C().isArray(t)&&t.length&&n.setState({isBind:!0,name:t[0].nickName,appId:t[0].appId,appSecret:t[0].appSecret,weixinInfo:t})})},n.submmit=function(){var t=n.state,a=t.name,o=t.appId,c=t.appSecret;s.Z.addTpAuthorizerInfo({projectId:i.Z.projectId,name:a,appId:o,appSecret:c}).then(function(m){m&&n.getWeiXinBindingInfo()})},n.handleClick=function(){n.setState({cancelBindVisible:!0})},n.changeFormData=function(t,a){var o=t.target.value;n.setState((0,N.default)({},a.key,o))},n.cancelBind=function(){var t=n.state.appId;s.Z.cancelBindingWeiXin({appId:t,projectId:i.Z.projectId}).then(function(a){n.setState({cancelBindVisible:!1}),a?(alert(_l("\u53D6\u6D88\u6210\u529F"),1),n.setState({isBind:!1})):alert(_l("\u53D6\u6D88\u5931\u8D25"),2)})},n.renderCancelBindModal=function(){var t=n.state.cancelBindVisible;return e.createElement(y.Z,{wrapClassName:"cancelBindModal",closable:!1,visible:t,title:e.createElement("span",{className:"Font17 Bold"},_l("\u53D6\u6D88\u7ED1\u5B9A")),onCancel:function(){return n.setState({cancelBindVisible:!1})},footer:e.createElement("div",{className:"opareationBtns"},e.createElement(f.default,{className:"cancelBtn",onClick:function(){return n.setState({cancelBindVisible:!1})}},"\u53D6\u6D88"),e.createElement(f.default,{type:"primary",className:"confirmBtn",onClick:n.cancelBind},"\u786E\u8BA4"))},e.createElement("div",{className:"content"},_l("\u53D6\u6D88\u6388\u6743\uFF0C\u672C\u7EC4\u7EC7\u516C\u4F17\u53F7\u6240\u6709\u76F8\u5173\u4FE1\u606F\u5C06\u5931\u6548\uFF08\u5305\u542B\u4F46\u4E0D\u9650\u4E8E\u5916\u90E8\u7528\u6237\u3001\u6A21\u677F\u6D88\u606F\uFF09\u8BF7\u60A8\u8C28\u614E\u64CD\u4F5C\u3002")))},n.handleBind=function(){s.Z.bindingWeiXin({projectId:i.Z.projectId}).then(function(t){location.href=t})},n.renderApplyContent=function(){var t=md.global.Config.IsPlatformLocal;return e.createElement(e.Fragment,null,e.createElement("span",{className:"icon-wechat icon"}),e.createElement("div",{className:"subTitle fontWeight600"},_l("\u7ED1\u5B9A\u5FAE\u4FE1\u516C\u4F17\u53F7")),e.createElement("div",{className:"desTxt"},_l("\u7ED1\u5B9A\u516C\u4F17\u53F7\u540E\uFF0C\u5916\u90E8\u95E8\u6237\u5C06\u53EF\u4EE5\u901A\u8FC7\u6307\u5B9A\u7684\u57DF\u540D\u83B7\u53D6\u8BE5\u670D\u52A1\u53F7\u4E0B\u5FAE\u4FE1\u7528\u6237\u7684\u6388\u6743\u53CAopenID\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5DE5\u4F5C\u6D41\u4E3A\u5916\u90E8\u7684\u5FAE\u4FE1\u7528\u6237\u63A8\u9001\u6A21\u677F\u6D88\u606F")),!t&&e.createElement("div",{className:"formGroup"},e.createElement(p.Z,{labelCol:{span:24},wrapperCol:{span:24},autoComplete:"off",onFinish:n.submmit},W.map(function(a){return e.createElement(e.Fragment,null,e.createElement(p.Z.Item,{label:a.label,name:a.label,rules:[{required:!0,message:"\u8BF7\u8F93\u5165"+a.label}]},a.type=="text"?e.createElement(g.default,{onChange:function(c){return n.changeFormData(c,a)}}):e.createElement(g.default.Password,{autoComplete:"new-password",onChange:function(c){return n.changeFormData(c,a)},visibilityToggle:!1})),a.description&&e.createElement("div",{className:"description"},a.description))}),e.createElement(p.Z.Item,null,e.createElement(f.default,{type:"primary",className:"submit",htmlType:"submit"},_l("\u63D0\u4EA4"))))),!t&&e.createElement("div",{className:"descriptions"},e.createElement("div",{className:"descriptionsInfo"},_l("1.\u4E3A\u4E86\u53EF\u4EE5\u83B7\u53D6\u5230 openID\u53CA\u57FA\u672C\u4FE1\u606F \u6216\u4F7F\u7528\u6A21\u7248\u6D88\u606F\u529F\u80FD\u5FC5\u987B\u9009\u62E9 "),e.createElement("span",{className:"Bold"},_l("\u5DF2\u8BA4\u8BC1\u7684\u5FAE\u4FE1\u670D\u52A1\u53F7"))),e.createElement("div",{className:"descriptionsInfo"},_l("2.\u4E3A\u83B7\u53D6\u5FAE\u4FE1\u6388\u6743\u9700\u8981\u5C06\u60A8\u516C\u53F8\u7684\u8BBF\u95EE\u57DF\u540D\u52A0\u5165\u5230\u516C\u4F17\u53F7\u7684\u7F51\u9875\u6388\u6743\u57DF\u540D\u5185"))),t&&e.createElement("div",null,e.createElement("div",{className:"bindBtn",onClick:function(){return n.handleBind()}},_l("\u7ACB\u5373\u6388\u6743")),e.createElement("span",{className:"TxtCenter Width300"},e.createElement("span",{className:"Gray_9e mLeft3"},_l("\u4E3A\u4E86\u53EF\u4EE5\u83B7\u53D6\u5230 OpenID \u53CA\u57FA\u672C\u4FE1\u606F\u6216")),e.createElement("br",null),e.createElement("span",{className:"Gray_9e"},_l("\u4F7F\u7528\u6A21\u677F\u6D88\u606F\u529F\u80FD\u5FC5\u987B\u9009\u62E9")),e.createElement("span",{className:"Bold"},_l("\u5DF2\u8BA4\u8BC1\u7684\u4F01\u4E1A\u670D\u52A1\u53F7")))))},n.renderPlatformContent=function(){var t=n.state.weixinInfo,a=t===void 0?[]:t;return e.createElement(e.Fragment,null,a.map(function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.createElement(e.Fragment,null,A.map(function(c){return e.createElement("div",{className:"weixin-info-row"},e.createElement("span",{className:"weixin-info-row-label"},c.text),e.createElement("span",{className:v()(c.key!=="funcInfo"?"mRight8":"",c.key==="nickName"?" Font17 Bold":"")},c.key==="funcInfo"?"":o[c.key]),c.key==="nickName"&&e.createElement("span",{className:"weixin-info-tag"},_l("\u5DF2\u8BA4\u8BC1")),c.clickKey==="copy"?e.createElement(I(),{component:"span","data-clipboard-text":o[c.key],onSuccess:function(){alert(_l("\u590D\u5236\u6210\u529F"))}},e.createElement("span",{className:"ThemeColor3 adminHoverColor Hand"},c.clickText)):e.createElement("span",{className:"ThemeColor3 adminHoverColor Hand",onClick:function(){return n.handlePlatformClick(c.clickKey,o)}},c.clickText))}))}))},n.renderSuccessContent=function(){return md.global.Config.IsPlatformLocal?n.renderPlatformContent():e.createElement(e.Fragment,null,P.map(function(t){var a=n.state[t.key],o=t.key!=="appSecret"?a:a.length<16?"*********":a.substr(0,6)+"*********"+a.substr(a.length-6);return e.createElement("div",{className:"wechatSuccessRow",key:t.key},e.createElement("div",{className:"wechatSuccessLabel"},t.text),e.createElement("div",{className:"wechatSuccessValue"},e.createElement("span",{className:v()("mRight10",t.key==="name"?"Font17 Bold":"")},o),t.clickKey==="copy"?e.createElement(I(),{component:"span","data-clipboard-text":[n.state[t.key]],onSuccess:function(){alert(_l("\u590D\u5236\u6210\u529F"))}},e.createElement("span",{className:"ThemeColor3 adminHoverColor Hand"},t.clickText)):e.createElement("span",{className:"ThemeColor3 adminHoverColor Hand",onClick:function(){return n.handleClick(t.clickKey,t)}},t.clickText)))}))},n.state={isBind:!1,name:"",appId:"",appSecret:"",cancelBindVisible:!1,loading:!1,weixinInfo:[]},n}return(0,S.default)(r,[{key:"componentDidMount",value:function(){var n=this;i.Z.setPageTitle(_l("\u5FAE\u4FE1\u516C\u4F17\u53F7"));var t=(0,D.A_)(),a=t.state,o=t.auth_code;md.global.Config.IsPlatformLocal&&o?(this.setState({loading:!0}),s.Z.callBackWeiXinBinding({state:a,authCode:o,projectId:i.Z.projectId}).then(function(c){n.setState({loading:!1}),c.flag?location.href="/admin/weixin/"+i.Z.projectId:alert(c.msg,3)})):this.getWeiXinBindingInfo()}},{key:"handleReset",value:function(){u.Z.confirm({title:e.createElement("span",{className:"Font17 Bold"},_l("\u91CD\u65B0\u6388\u6743")),description:e.createElement("span",null,e.createElement("span",null,_l("1. \u91CD\u65B0\u6388\u6743\u65F6\u4E0D\u53EF\u6362\u7ED1\u5176\u4ED6\u5FAE\u4FE1\u516C\u4F17\u53F7\uFF0C\u5426\u5219\u91CD\u65B0\u6388\u6743\u5C06\u5931\u8D25\uFF1B")),e.createElement("span",{className:"Block"},_l("2. \u4E3A\u4FDD\u8BC1\u529F\u80FD\u7684\u6B63\u5E38\u4F7F\u7528\uFF0C\u6388\u6743\u65F6\u8BF7\u4FDD\u6301\u9ED8\u8BA4\u9009\u62E9\uFF0C\u628A\u5F00\u653E\u5E73\u53F0\u8D26\u53F7\u7BA1\u7406\u6743\u9650\u7EDF\u4E00\u6388\u6743\u7ED9\u6B64\u7CFB\u7EDF"))),onOk:function(){s.Z.bindingWeiXin({projectId:i.Z.projectId}).then(function(t){location.href=t})}})}},{key:"handlePlatformClick",value:function(n){var t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==="view"){var o={title:e.createElement("span",null,_l("\u5DF2\u6388\u6743\u6743\u9650\u5217\u8868"),e.createElement("span",{className:"Hand ThemeColor3 adminHoverColor Block Font13 mTop10",onClick:function(){return t.handleReset()}},_l("\u91CD\u65B0\u6388\u6743"))),footer:null,visible:!0,width:"480",className:"weixinFuncInfoDialog",overlayClosable:!1,onCancel:function(){$(".weixinFuncInfoDialog").parents(".mui-dialog-container").parents("div").remove()}};Z.render(e.createElement(u.Z,o,e.createElement("ul",null,H.map(function(c){return e.createElement("li",{className:v()("mTop10 Gray",{Hidden:!C().includes(a.funcInfo||[],c.value)})},c.text)}))),document.createElement("div"))}else n==="unbind"&&u.Z.confirm({title:e.createElement("span",{className:"Font17 Bold"},_l("\u53D6\u6D88\u7ED1\u5B9A")),description:_l("\u53D6\u6D88\u7ED1\u5B9A\u540E\uFF0C\u672C\u7EC4\u7EC7\u5185\u4E0E\u516C\u4F17\u53F7\u6240\u6709\u76F8\u5173\u4FE1\u606F\u5C06\u5931\u6548\uFF08\u5305\u542B\u4F46\u4E0D\u9650\u4E8E\u5916\u90E8\u7528\u6237\u3001\u6A21\u677F\u6D88\u606F\uFF09\u8BF7\u60A8\u8C28\u614E\u64CD\u4F5C\u3002"),onOk:function(){s.Z.cancelBindingWeiXin({appId:a.appId,projectId:i.Z.projectId}).then(function(m){m?(alert(_l("\u6210\u529F\u53D6\u6D88\u7ED1\u5B9A")),t.setState({isBind:!1,weixinInfo:[]})):alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u5019\u91CD\u8BD5\uFF01"),2)})}})}},{key:"render",value:function(){var n=this.state,t=n.isBind,a=n.loading;return a?e.createElement("div",{className:"orgManagementWrap"},e.createElement(E.Z,null)):e.createElement("div",{className:"orgManagementWrap adminWeiXinContainer"},e.createElement("div",{className:"Font17 Bold orgManagementHeader"},_l("\u5FAE\u4FE1\u516C\u4F17\u53F7")),e.createElement("div",{className:"wechatInfo flex"},t?e.createElement("div",{className:"wechatSuccessContent"},this.renderSuccessContent()):e.createElement("div",{className:"wechatApplyContent"},this.renderApplyContent()),this.renderCancelBindModal()))}}]),r}(e.Component)}}]);
