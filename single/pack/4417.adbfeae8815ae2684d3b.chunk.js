"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4417],{23246:()=>{},62592:(X,R,e)=>{e.d(R,{Z:()=>N});var H=e(56118),L=e(80181),w=e.n(L),K=e(6100),O=e(42185),W=e(33867),U=e(88239),F=e(85105),Z=e.n(F),V=e(99663),i=e(22600),G=e(49135),z=e(93196),r=e(67294),b=e(93967),$=e.n(b),I=e(90459),A=e(65369),S=e(74666),_=e(58064),x=e(78265),T=e(53080),M=e(96486),v=e.n(M),E=e(30381),C=e.n(E),P={WAITING_DISPOSE:1,WAITING_EXAMINE:2,MY_SPONSOR:3,COMPLETE:4},N=function(y){(0,z.default)(g,y);function g(u){(0,V.default)(this,g);var a=(0,G.default)(this,(g.__proto__||Z()(g)).call(this,u));return a.processInformTabs=T.processInformTabs.map(function(n){return n.id}),a.handleApprove=function(n,t){var o=a.props.item;n.stopPropagation(),_.Z.get({id:o.id,workId:o.workId}).then(function(s){a.setState({action:t,instance:s,otherActionVisible:!0})})},a.handleAction=function(n){var t=n.action,o=n.content,s=n.forwardAccountId,l=n.backNodeId,c=n.signature,m=n.files;if(a.setState({submitLoading:!0,otherActionVisible:!1}),v().includes(["pass","overrule"],t)){var d=a.props,p=d.item,f=d.onApproveDone,h={opinion:o,backNodeId:l,signature:c,files:m};x.Z[A.SJ[t]]((0,U.default)({id:p.id,workId:p.workId},h)).then(function(D){D&&(alert(_l("\u64CD\u4F5C\u6210\u529F")),f(p)),v().get(window,"JSBridgeAdapter.approvalEvent")&&window.JSBridgeAdapter.approvalEvent({type:t==="pass"?1:2,enterType:1,result:D,workData:a.props.item})})}},a.state={otherActionVisible:!1,action:"",instance:null},a}return(0,i.default)(g,[{key:"renderTimeConsuming",value:function(){var a=this.props.item.workItem,n=a===void 0?{}:a,t=(n.workId?[n]:[]).filter(function(d){return v().includes([3,4],d.type)&&d.operationTime}),o=[],s=[];if(!t.length)return null;t.forEach(function(d){d.dueTime&&s.push(C()(d.operationTime)-C()(d.dueTime)),o.push(C()(d.operationTime)-C()(d.receiveTime))});var l=v().max(o)||0,c=v().max(s)||0;if(((t[0].opinion||"").indexOf("\u9650\u65F6\u81EA\u52A8\u901A\u8FC7")>-1||(t[0].opinion||"").indexOf("\u9650\u65F6\u81EA\u52A8\u586B\u5199")>-1)&&(c=1),!c){var m=(0,I.yP)(l);return m?r.createElement("span",{className:"overflow_ellipsis Gray_9e mLeft10"},_l("\u8017\u65F6\uFF1A%0",m)):null}return r.createElement("span",{className:"stepTimeConsuming flexRow",style:{color:c>0?"#F44336":"#4CAF50"}},r.createElement(W.Z,{icon:c>0?"overdue_network":"task",className:"Font14 mRight2"}),r.createElement("div",{className:"overflow_ellipsis"},_l("\u8017\u65F6\uFF1A%0",(0,I.yP)(l))))}},{key:"renderSurplusTime",value:function(){var a=this.props.item.workItem,n=a===void 0?{}:a,t=!1,o=(n.workId?[n]:[]).filter(function(l){return l.executeTime&&(t=!0),v().includes([3,4],l.type)&&!l.operationTime&&l.dueTime});if(!o.length)return null;var s=C()()-C()(o[0].dueTime)||0;return r.createElement("span",{className:"stepTimeConsuming flexRow",style:{color:s>0?"#F44336":t?"#FF9800":"#2196f3"}},r.createElement(W.Z,{icon:s>0?"error1":"hourglass",className:"Font14 mRight2"}),r.createElement("div",{className:"overflow_ellipsis"},s>0?_l("\u5DF2\u8D85\u65F6%0",(0,I.yP)(s)):_l("\u5269\u4F59%0",(0,I.yP)(s))))}},{key:"renderTime",value:function(){var a=this.props.item.workItem,n=a===void 0?{}:a,t=(n.workId?[n]:[]).filter(function(s){return v().includes([3,4],s.type)&&s.operationTime}),o=(n.workId?[n]:[]).filter(function(s){return v().includes([3,4],s.type)&&!s.operationTime&&s.dueTime});return t.length?this.renderTimeConsuming():o.length?this.renderSurplusTime():r.createElement("div",{className:"Gray_9e ellipsis time"},this.props.time)}},{key:"renderHeader",value:function(){var a=this.props,n=a.currentTab,t=a.item,o=a.time,s=t.flowNode,l=t.workItem,c=t.flowNodeType,m=t.currentWorkFlowNodes,d=t.completeDate,p=t.instanceLog,f=t.status,h=null;return n=="completeMySponsor"?h=this.renderInstanceStatu():n=="completeDispose"?h=this.renderNodeState():h=r.createElement("div",{className:"flowNode bold valignWrapper"},r.createElement("div",{className:"Font12 Gray_75"},s.name)),r.createElement("div",{className:"mobileProcessCardHeader valignWrapper overflow_ellipsis"},r.createElement("div",{className:"stateWrapper valignWrapper flex"},h),this.renderTime())}},{key:"renderInfo",value:function(){var a=this,n=this.props,t=n.currentTab,o=n.item,s=n.batchApproval,l=o.flowNode,c=o.flowNodeType,m=o.workItem,d=l.batch,p=l.btnMap,f=m.operationType;if(t==="waitingApproval")return s?null:r.createElement("div",{className:"valignWrapper mLeft10 approveBtnWrapper"},!d&&r.createElement(O.ZP,{className:"backlog",type:"ghostgray",size:"small"},_l("\u529E\u7406")),d&&r.createElement(O.ZP,{className:"ellipsis pass mRight5",type:"ghostgray",size:"small",onClick:function(B){a.handleApprove(B,"pass")}},p[4]||_l("\u901A\u8FC7")),d&&p[5]&&r.createElement(O.ZP,{className:"ellipsis overrule",type:"ghostgray",size:"small",onClick:function(B){a.handleApprove(B,"overrule")}},p[5]||_l("\u5426\u51B3")));if(t==="mySponsor")return r.createElement("div",{className:"Font13 mLeft10 bold Gray_75"},_l("\u5904\u7406\u4E2D\u2026"));if(["all","already","unread"].includes(t)){var h=I.VW[c][f],D=h.text,j=h.color,k=c===5&&f===1;return r.createElement("div",{className:"Font13 mLeft10 bold",style:{color:k?"#9e9e9e":j}},D)}return null}},{key:"renderNodeState",value:function(){var a=this.props.item,n=a.flowNodeType,t=a.workItem,o=t.operationType,s=I.VW[n][o];if(s){var l=s.text,c=s.color,m=s.shallowBg;return r.createElement("div",{className:"nodeState bold valignWrapper",style:{color:c,backgroundColor:m,borderRadius:3}},l)}else return null}},{key:"renderInstanceStatu",value:function(){var a=this.props.item,n=a.workItem,t=a.instanceLog,o=a.status,s=o===3||o===4?t.status:o,l=I.Gf[s],c=l.text,m=l.bg,d=l.shallowBg,p=l.icon;return r.createElement(r.Fragment,null,r.createElement("div",{className:"nodeState bold valignWrapper",style:{color:m,backgroundColor:d}},p?r.createElement(W.Z,{icon:p,className:"mRight5"}):null,r.createElement("div",{className:"Font13"},c)))}},{key:"renderFooter",value:function(){var a=this.props.item,n=a.app,t=a.process;return r.createElement("div",{className:"mobileProcessCardFooter valignWrapper"},r.createElement("div",{className:"stateWrapper valignWrapper flex overflow_ellipsis"},r.createElement("div",{className:"appIcon",style:{backgroundColor:n.iconColor}},r.createElement(K.Z,{url:n.iconUrl,fill:"#fff",size:16,addClassName:"mTop4"})),r.createElement("div",{className:"flexRow Gray_75 flex valignWrapper"},r.createElement("span",{className:"appName overflow_ellipsis"},n.name),r.createElement("span",{className:"processName overflow_ellipsis"},r.createElement("span",{className:"dot"}),t.name))),this.renderInfo())}},{key:"renderBody",value:function(){var a=this.props,n=a.currentTab,t=a.item,o=a.renderBodyTitle,s=t.createAccount,l=t.controls;return r.createElement("div",{className:"mobileProcessCardBody flexColumn"},r.createElement("div",{className:"valignWrapper"},r.createElement("img",{className:"accountAvatar",src:s.avatar}),r.createElement("span",{className:"ellipsis"},o())),this.processInformTabs.includes(n)&&r.createElement("span",{className:"Gray_9e Font13 mTop8 ellipsis"},t.workItem.opinion),r.createElement("div",{className:"flexColumn mTop10"},l.map(function(c){return r.createElement("div",{key:c.controlId,className:"Font12 flexRow mTop4"},r.createElement("div",{className:"Gray_9e mRight10"},c.controlName),r.createElement("div",{className:"flex overflow_ellipsis"},c.value||"--"))})))}},{key:"render",value:function(){var a=this,n=this.state,t=n.otherActionVisible,o=n.action,s=n.instance,l=this.props,c=l.item,m=l.approveChecked,d=l.onClick,p=l.onChangeApproveCards,f=p===void 0?v().noop:p,h=l.batchApproval,D=l.showApproveChecked,j=D===void 0?!0:D,k=c.flowNode||{},J=k.batch,B=!J;return r.createElement(r.Fragment,null,r.createElement("div",{className:$()("mobileProcessCardWrapper flexRow",{batchApproval:h,approveChecked:m})},h&&j&&r.createElement(w(),{className:"mRight5",disabled:B,checked:m,onChange:f}),r.createElement("div",{className:"mobileProcessCardContent flexColumn flex",onClick:function(){h?!B&&f({target:{checked:!m}}):d()}},this.renderHeader(),this.renderBody(),this.renderFooter())),t&&r.createElement(S.Z,{visible:t,action:o,selectedUser:{},instance:s,onAction:this.handleAction,onHide:function(){a.setState({otherActionVisible:!1})}}))}}]),g}(r.Component)},53080:(X,R,e)=>{e.r(R),e.d(R,{default:()=>g,processInformTabs:()=>y});var H=e(51097),L=e.n(H),w=e(64540),K=e(88239),O=e(85105),W=e.n(O),U=e(99663),F=e(22600),Z=e(49135),V=e(93196),i=e(67294),G=e(93967),z=e.n(G),r=e(17563),b=e(33867),$=e(54208),I=e(25273),A=e(75915),S=e(46100),_=e(58064),x=e(62509),T=e(62592),M=e(23246),v=e(96486),E=e.n(v),C,P,N,y=[{name:_l("\u5168\u90E8"),id:"all"},{name:_l("\u672A\u8BFB"),id:"unread"},{name:_l("\u5DF2\u8BFB"),id:"already"}],g=(P=C=function(u){(0,V.default)(a,u);function a(n){(0,U.default)(this,a);var t=(0,Z.default)(this,(a.__proto__||W()(a)).call(this,n));N.call(t);var o=n.location.search,s=r.parse(o),l=s.tab;return t.state={pageIndex:1,pageSize:30,list:[],loading:!1,isMore:!0,currentTab:E().find(y,{id:l})?l:y[0].id,searchValue:"",countData:{},previewRecord:{}},t}return(0,F.default)(a,[{key:"componentDidMount",value:function(){this.getTodoList(),this.getTodoCount()}},{key:"getTodoList",value:function(){var t=this,o={},s=this.state,l=s.loading,c=s.isMore,m=s.currentTab,d=s.searchValue;if(!(l||!c)){this.setState({loading:!0}),this.request&&this.request.abort(),m!=="all"&&(o.complete=m==="already"),d&&(o.keyword=d);var p=this.state,f=p.pageIndex,h=p.pageSize,D=p.list,j=p.stateTab;this.request=_.Z.getTodoList((0,K.default)({pageSize:h,pageIndex:f,type:5},o)),this.request.then(function(k){t.setState({list:D.concat(k),loading:!1,pageIndex:f+1,isMore:k.length===h})})}}},{key:"getTodoCount",value:function(){var t=this;(0,x.C)().then(function(o){t.setState({countData:o})})}},{key:"renderInput",value:function(){var t=this,o=this.state.searchValue;return i.createElement("div",{className:"searchWrapper valignWrapper"},i.createElement(b.Z,{icon:"search",className:"Gray_9e Font20 pointer"}),i.createElement("input",{value:o,type:"text",placeholder:_l("\u641C\u7D22\u8BB0\u5F55\u540D\u79F0"),onChange:function(l){t.setState({searchValue:l.target.value})},onKeyDown:function(l){l.which===13&&t.handleChangeCompleteTab({id:t.state.currentTab})}}),o?i.createElement(b.Z,{icon:"close",className:"Gray_75 Font20 pointer",onClick:function(){t.setState({searchValue:""},function(){t.handleChangeCompleteTab({id:t.state.currentTab})})}}):null)}},{key:"renderWithoutData",value:function(){return i.createElement("div",{className:"withoutData"},i.createElement("div",{className:"icnoWrapper"},i.createElement(b.Z,{icon:"ic-line"})),i.createElement("span",null,_l("\u6682\u65E0\u5185\u5BB9")))}},{key:"renderContent",value:function(){var t=this,o=this.state,s=o.stateTab,l=o.list,c=o.loading,m=o.pageIndex,d=o.filter,p=o.currentTab;return i.createElement(I.Z,{className:"flex",onScrollEnd:this.handleScrollEnd},l.map(function(f){return i.createElement("div",{className:"pLeft10 pRight10",key:f.workId},i.createElement(T.Z,{item:f,type:d?d.type:null,time:createTimeSpan(f.workItem.receiveTime),currentTab:p,renderBodyTitle:function(){return f.title},onClick:function(){t.setState({previewRecord:{instanceId:f.id,workId:f.workId}})}}))}),c?i.createElement("div",{className:z()({withoutData:m==1})},i.createElement($.Z,{size:"middle"})):null,!c&&E().isEmpty(l)?this.renderWithoutData():null)}},{key:"render",value:function(){var t=this,o=this.state,s=o.currentTab,l=o.countData,c=o.previewRecord;return i.createElement("div",{className:"processContent flexColumn h100"},i.createElement("div",{className:"flex flexColumn"},i.createElement("div",{className:"processTabs mBottom10 z-depth-1"},i.createElement(w.default,{tabBarInactiveTextColor:"#9e9e9e",tabs:y,page:s?E().findIndex(y,{id:s}):-1,onTabClick:this.handleChangeCompleteTab,renderTab:function(d){return i.createElement("span",null,d.name," ",d.id==="unread"&&l.waitingExamine?"("+l.waitingExamine+")":null)}})),i.createElement(A.Z,{className:"low",onClick:function(){history.back()}}),s==="already"?this.renderInput():null,this.renderContent(),i.createElement(S.default,{isModal:!0,className:"full",visible:!E().isEmpty(c),instanceId:c.instanceId,workId:c.workId,onClose:function(){t.setState({previewRecord:{}})}})))}}]),a}(i.Component),N=function(){var a=this;this.handleChangeCompleteTab=function(n){a.setState({loading:!1,pageIndex:1,isMore:!0,list:[],currentTab:n.id},function(){a.getTodoList()})},this.handleScrollEnd=function(n){a.getTodoList()}},P)},62509:(X,R,e)=>{e.d(R,{C:()=>S});var H=e(70264),L=e(33867),w=e(85105),K=e.n(w),O=e(99663),W=e(22600),U=e(49135),F=e(93196),Z=e(46593),V=e.n(Z),i=e(67294),G=e(58064),z=e(22013),r=e(93967),b=e.n(r),$=e(96486),I=e.n($),A=null,S=function(T){return new(V())(function(M,v){A&&A.abort(),A=G.Z.getTodoCount({archivedId:T}),A.then(function(E){var C=E[0],P=E[3],N=E[4],y=E[5],g=P+N,u=g+y;M({mySponsor:C,waitingWrite:P,waitingApproval:N,waitingExamine:y,waitingDispose:g,myProcessCount:u})})})},_=function(x){(0,F.default)(T,x);function T(M){return(0,O.default)(this,T),(0,U.default)(this,(T.__proto__||K()(T)).call(this,M))}return(0,W.default)(T,[{key:"componentDidMount",value:function(){var v=this;S().then(function(E){v.props.updateCountData(E)})}},{key:"render",value:function(){var v=this.props,E=v.countData,C=v.onClick,P=v.type,N=v.renderContent,y=v.className,g=E?E.myProcessCount>99?"99+":E.myProcessCount:0,u=P==="native",a=z.Z.getState().appPkg.iconColor;return I().isFunction(N)?N(g,C):P?i.createElement(H.Z,{text:i.createElement("span",null,_l("\u6D41\u7A0B\u5F85\u529E"))},i.createElement("div",{className:"myProcessHeader pointer mRight10 "+(u?"Gray_75":"White")+" "+y,onClick:C},i.createElement(L.Z,{icon:b()("task_alt",{appIcon:!u}),className:"mRight5 Font20"}),g?i.createElement("span",{className:"count "+(u?"native":"app"),style:{color:u?"":a}},g):null)):i.createElement("ul",{className:"mTop10"},i.createElement("li",{className:"myProcess",onClick:C},i.createElement(L.Z,{icon:"task_alt"}),i.createElement("span",{className:"Gray_75 bold"},_l("\u6D41\u7A0B\u5F85\u529E")),g?i.createElement("span",{className:"count"},g):null))}}]),T}(i.Component)}}]);
