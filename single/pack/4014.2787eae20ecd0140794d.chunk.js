(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4014],{16960:D=>{D.exports=`<div class="shareAttachmentDialogContainer">
    <div class="filePreview">
        <div class="fileIcon hide">
            <span class="fileSize"></span>
        </div>
        <div class="thumbnailCon hide">
            <div class="thumbnail">
            </div>
        </div>
    </div>
    <div class="dList">
        <div class="dItem">
            <div class="itemLabel">
                {{=_l('\u540D\u79F0')}}
            </div>
            <div class="itemContent">
                <input type="text" id="fileName" class="ming Input" placeholder="{{=_l('\u540D\u79F0')}}" />
                <span class="fileNameText ellipsis hide"></span>
            </div>
        </div>
        {{? it.showChangeDownload}}
        <div class="dItem">
            <div class="itemLabel">
                {{=_l('\u5141\u8BB8\u4E0B\u8F7D')}}
            </div>
            <div class="itemContent">
                <div class="downloadableCon">
                    <div class="switchBtnCon">
                        <input id="canDownload" type="checkbox" checked></input>
                        <label class="switchBtn" for="canDownload"></label>
                    </div>
                    <span class="canDownloadTip" data-tip="{{=_l('\u53EF\u5728\u6B64\u914D\u7F6E\u5206\u4EAB\u540E\u7684\u6587\u4EF6\u662F\u5426\u5141\u8BB8\u7528\u6237\u4E0B\u8F7D\uFF08\u5206\u4EAB\u5230\u201C\u6D88\u606F\u201D\u7684\u5C06\u81EA\u52A8\u8BBE\u4E3A\u53EF\u4E0B\u8F7D\uFF09')}}">
                        <i class="icon icon-novice-circle ThemeHoverColor3 Hand"></i>
                    </span>
                </div>
            </div>
        </div>
        {{?}}
        {{? it.showChangeShare}}
        <div class="dItem changeShare hide">
            <div class="itemLabel">
                {{=_l('\u5206\u4EAB\u94FE\u63A5')}}
            </div>
            <div class="itemContent">
                <div class="selectSharePermission">
                    <div class="preventCover"></div>
                    <input type="hidden" id="selectSharePermission" />
                    <span class="InlineBlock w100" id="selectSharePermissionBox"></span>
                </div>
                <div class="copyLinkCon hide">
                    <span class="copyLinkHover">
                        <i class="icon icon-link"></i>
                        {{=_l('\u590D\u5236\u94FE\u63A5')}}
                    </span>
                    <div class="copyLinkContent">
                        <input type="text" id="linkContent" readonly="readonly" class="ming Input"
                            onclick="this.select();">
                        <span class="copyLinkBtn ThemeBGColor3" id="copyLinkBtn">
                            {{=_l('\u590D\u5236\u94FE\u63A5')}}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="dItem closedTip hide">
            <div class="itemLabel"></div>
            <div class="itemContent">
                {{=_l('\u94FE\u63A5\u5DF2\u5173\u95ED\uFF0C\u5F00\u542F\u540E\u53EF\u8FDB\u884C\u5171\u4EAB')}}
            </div>
        </div>
        {{?}}
        <div class="selectTargetCon dItem hide">
            <div class="itemLabel"></div>
            <div class="itemContent">
                <div class="selectTargetBtnList">
                    <span class="prev icon icon-arrow-left-border ThemeHoverColor3 Hand"></span>
                    <span class="next icon icon-arrow-right-border ThemeHoverColor3 Hand"></span>
                    <div class="listBox overfllowHidden">
                        <div class="listCon">
                            <div class="targetBtn chat" data-type="{{! it.SEND_TO_TYPE.CHAT.toString()}}">
                                <span class="icon icon-to-chat-circle">
                                </span>
                                <p>{{=_l('\u53D1\u6D88\u606F')}}</p>
                            </div>
                            {{? !md.global.SysSettings.forbidSuites.includes('1')}}
                                <div class="targetBtn feed" data-type="{{! it.SEND_TO_TYPE.FEED}}">
                                    <span class="icon icon-to-feed-circle"></span>
                                    <p>{{=_l('\u53D1\u52A8\u6001')}}</p>
                                </div>
                            {{?}}
                            {{? !md.global.SysSettings.forbidSuites.includes('2')}}
                                <div class="targetBtn task" data-type="{{! it.SEND_TO_TYPE.TASK}}">
                                    <span class="icon icon-to-task-circle"></span>
                                    <p>{{=_l('\u53D1\u4EFB\u52A1')}}</p>
                                </div>
                            {{?}}
                            {{? !md.global.SysSettings.forbidSuites.includes('3')}}
                                <div class="targetBtn calendar" data-type="{{! it.SEND_TO_TYPE.CALENDAR}}">
                                    <span class="icon icon-calendar"></span>
                                    <p>{{=_l('\u53D1\u65E5\u7A0B')}}</p>
                                </div>
                            {{?}}
                            {{? !md.global.SysSettings.forbidSuites.includes('4')}}
                                <div class="targetBtn kc" data-type="{{! it.SEND_TO_TYPE.KC}}">
                                    <span class="icon icon-to-kc-circle"></span>
                                    <p>{{=_l('\u5B58\u5165\u77E5\u8BC6')}}</p>
                                </div>
                            {{?}}
                            <div class="targetBtn qr" data-type="{{! it.SEND_TO_TYPE.QR}}">
                                <span class="icon icon-invite-qrcode"></span>
                                <p>{{=_l('\u4E8C\u7EF4\u7801')}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sendToOther hide">
            <div class="dItem">
                <div class="itemLabel">
                    {{=_l('\u5206\u4EAB\u5230')}}
                </div>
                <div class="itemContent">
                    <div class="sendToTarget">
                        <input type="hidden" id="sendToTarget" />
                        <span class="InlineBlock w100" id="sendToTargetBox"></span>
                    </div>
                    <div class="sendToContent InlineBlock">
                        <input type="hidden" id="selectSendTo">
                    </div>
                </div>
            </div>
            <div class="dItem">
                <div class="itemLabel"></div>
                <div class="itemContent addDescBtn">
                    {{=_l('\u6DFB\u52A0\u8BF4\u660E')}}
                </div>
            </div>
            <div class="dItem descCon hide">
                <div class="itemLabel">
                    {{=_l('\u6DFB\u52A0\u8BF4\u660E')}}
                </div>
                <div class="itemContent">
                    <textarea name="" id="shareDesc" class="ming Input" cols="30" rows="10"
                        placeholder="{{=_l('\u6DFB\u52A0\u6587\u4EF6\u8BF4\u660E')}}"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="shareAttachmentFooter hide">
        <a href="javascript:void(0);" class="no ThemeHoverColor3">{{=_l('\u53D6\u6D88')}}</a>
        <a href="javascript:void(0);" class="yes boderRadAll_3 ThemeBGColor3 ">{{=_l('\u5206\u4EAB')}}</a>
    </div>
</div>
`},78250:D=>{D.exports=`<div class="mobileShareDialog">
    <div class="urlQrCode">
        <span class="clipLoader ThemeColor8"></span>
    </div>
    <div class="tip">
        {{! it.targetText + '\uFF0C' + it.tip }}
    </div>
    <div class="fileName ellipsis">
        {{! it.fileName}}
    </div>
    {{? it.attachmentType === 2 }}
    <div class="deadline">
        {{=_l('\u4E0B\u8F7D\u94FE\u63A5\u6709\u6548\u671F%0\u5C0F\u65F6', 48)}}
    </div>
    {{?}}
</div>
`},96934:D=>{D.exports=`<div class="searchListCon">
    <input type="text" class="searchInput ming Input" placeholder="{{!it.placeholderStr}}">
    <div class="selected ellipsis">
        \u8BF7\u9009\u62E9
    </div>
    <div class="listPanel">
        <div class="searchList">
            <p class="listTip">\u52A0\u8F7D\u4E2D...</p>
        </div>
        <div class="footerBtn">
            <i class="icon icon-addapplication ThemeColor3"></i>
            <spna class="footerStr ThemeColor3">
                {{! it.footerStr}}
            </spna>
        </div>
    </div>
</div>
`},66239:D=>{D.exports=`{{? it.isLoading}}
    <p class="listTip">\u52A0\u8F7D\u4E2D...</p>
{{?? it.list.length === 0}}
    <p class="listTip">\u65E0\u641C\u7D22\u7ED3\u679C</p>
{{??}}
    {{~it.list :item:index}}
        <div class="ThemeBGColor3">
            <div class="listItem" data-key="{{! index.toString()}}">
                {{? item.headUrl}}
                    <img src="{{! item.headUrl}}" alt="">
                {{?}}
                <span class="itemName ellipsis">{{! item.value}}</span>
            </div>
        </div>
    {{~}}
{{?}}
`},45514:D=>{D.exports=`<div class="MDUpdater">
    <input type="hidden" id="MDUpdater_hidden_UpdaterType" value="0" />
    <input type="hidden" id="MDUpdater_hidden_fromUseMD" value="" />
    <div class="Updater_Textpanel ">
        <div id="MDUpdater_msgContainer" class="msgContainer" style="margin-bottom:20px;">
            <textarea class="Updater_TextArea TextArea mRight10" id="MDUpdater_textarea_Updater" style="height: 50px;"></textarea>
        </div>

        <div class="msgExpandDiv Right" style="margin-top:-15px;">
            <a class="faceBtn icon-smile" href="javascript:void(0)" title="\u63D2\u5165\u8868\u60C5"></a>
            <div class="Clear"></div>
        </div>
        <div  class="Clear"></div>
        <div style="border-top:1px solid #eee;" class="pTop10 mTop5 Relative">

            <div class="Absolute Hidden" id="mdUpdateCloseContainer" style="right:0px; top:23px;">
                <span class="update_close" style="margin: 5px" title="\u5173\u95ED"></span>
            </div>

            <div class="myUpdateType mTop12">
                <a class="icon-attachment Font16 NoUnderLine Gray_c" style="display:none;" href="javascript:;" targetdiv="#MDUpdater_Attachment_updater" showtype="attachment"></a><a class="icon-link Font16 NoUnderLine Gray_c" style="display:none;" href="javascript:;" targetdiv="#MDUpdater_Link_updater" showtype="link"></a><a class="icon-votenobg Font16 NoUnderLine Gray_c" style="display:none;" href="javascript:;" targetdiv="#MDUpdater_Vote_updater" showtype="vote"></a>
            </div>
            <div class="Left mTop12 Hidden" id="divIsToFeed">
                <input type="checkbox" checked="checked" class="Hidden" id="isToFeed" />
                <label title="\u8F6C\u53D1\u5230\u52A8\u6001" for="isToFeed" class="icon-feed Font16 ThemeColor3 Hand divIsToFeedToggle" id="divIsToFeedToggle"></label>
            </div>


            <div id="MDUpdater_Attachment_updater" class="middleContent mBottom5 Hidden">
                <input type="hidden" id="hidMDUpdaterUpload" />
            </div>


             <!--\u94FE\u63A5-->
            <div id="MDUpdater_Link_updater" class="middleContent Hidden">
                <div class="arrowUpOuter" style="left:38px;"><div class="arrowUpInner"></div></div>
                <div class="updaterDialog_Main" style="min-height: 35px;">
                    <div class="linkViewTextBoxContainer">
                        <div class="Left">
                            <input type="text" id="MDUpdater_text_LinkUrl" class="TextBox linkTextBox textLinkUrl" value="http://" />
                        </div>
                        <div class="Right linkBtnArea">
                            <input type="button" class="btnBootstrap btnBootstrap-primary btnBootstrap-small linkBtn" value="{{! _l('\u9884\u89C8') }}" />
                        </div>
                        <div class="clear">
                        </div>
                    </div>
                    <div class="updaterLinkView uploadLinkContent "></div>
                </div>
            </div>

            <!--\u6295\u7968-->
            <div id="MDUpdater_Vote_updater" class="middleContent Hidden">
            </div>
            <!--\u52A0\u5165\u5230\u77E5\u8BC6\u95E8\u6237 2012-5-7 john -->
            <div id="MDUpdater_Div_JoinKnowledge" class="Hidden mAll5 Left" style="width: 200px;">
                <input type="text" id="MDUpdater_txtKnowledge" style="width: 370px;" />
            </div>
            <div class="mTop10 Right">
                <div class="Right">
                    <input id="MDUpdater_button_Share" style="padding:4px 19px" type="button" class="btnBootstrap btnBootstrap-primary btnBootstrap-small" value="\u5206 \u4EAB" />
                </div>
                <div class="Right groupSelect">
                <input type="hidden" id="MDUpdater_hidden_GroupID_All" value="everyone" />
                </div>
                <div class="Clear"></div>
            </div>
            <div class="Clear"></div>
        </div>
    </div>
</div>
`},94014:(D,G,p)=>{"use strict";p.r(G),p.d(G,{default:()=>Ne});var Z=p(63239),U=p.n(Z),V=p(31546),z=p(52945),E=p.n(z),M=p(69288),R=p(15577),j=p(20640),J=p.n(j),Y=p(38197),C=p.n(Y),X=p(16960),q=p.n(X),ee=p(96934),te=p.n(ee),ie=p(66239),ae=p.n(ie),F=p(17429),ne=p(2489),oe=p(45514),le=p.n(oe),w=p(67294),_=p(73935),se=p(59962),Ve=p(16461),Re=p(40440),re=p(96486),T=p.n(re),de=p(30381),ce=p.n(de),pe={init:function(e){var t=this;return e.each(function(i,o){var n=Math.random().toString(36).substring(7),a=$(o);a.attr("id")||a.attr("id",n+"Vote_updater");var s=function(v){var c=a.find(".voteOptions"),f=c.find("li"),u=f.length;if(!(u>=99)){var g={};g.canClose=v,g.idPrefix=n;var h;f.length?(h=f.last(),g.curindex=parseInt(h.attr("index")||"0")+1):g.curindex=1,g.curindex>=10?(g.width=69,g.txtWidth=84):(g.width=70,g.txtWidth=85);var m='<li class="pAll5" index="{{=it.curindex}}">          <div class="Left mRight5">            {{= _l("\u9009\u9879") }}            <span class="voteIndex"></span>            &nbsp;          </div>          <div class="Left mRight5 inputTxt" style="width: {{= it.width}}%">            <input type="text" class="TextBox"              placeholder="{{= _l("\u8BF7\u8F93\u5165\u6295\u7968\u9879") }}"              style="width:{{= it.txtWidth }}%"              value=""  />            <div id="{{= it.idPrefix + "divVoteUpload" + it.curindex }}"></div>            <div class="Clear"></div>          </div>          <div class="Left ThemeColor3 Hand" id="{{= it.idPrefix + "VotePicUpload" + it.curindex }}">{{= _l("\u4E0A\u4F20\u56FE\u7247") }}...</div>          {{? it.canClose}}          <div class="Left mLeft10">            <span class="Hand Bold Gray_a removeVoteItem" title="{{= _l("\u5173\u95ED") }}">\xD7</span>          </div>          {{?}}          <div class="Clear"></div>        </li>',x=$(C().template(m)(g));h?h.after(x):c.find("ul").append(x),c.scrollTop(c.scrollTop()+c.height()),t.initUploadify(g.curindex,n),c.find("li").find(".voteIndex").each(function(Ge){$(this).text(Ge+1)});var L=a.find(".voteAvailableNumber").val(),Be='{{ for(var i = 1; i <= it.voteCount + 1; i++) { }}          <option {{? it.oldVoteAvailableNumber == i }}selected="selected"{{?}}>{{= i}}</option>        {{ } }}';a.find(".voteAvailableNumber").html(C().template(Be)({oldVoteAvailableNumber:L,voteCount:u}))}};a.html(t.getDefaultContent(n,a.attr("left"))),s(),s(),a.off().on("click",".addItem",function(){s(!0)}).on("click",".voteOptions li .removeVoteItem",function(){var d=a.find(".voteOptions li").length;$(this).parent().parent().remove(),a.find(".voteOptions li .voteIndex").each(function(f){$(this).text(f+1)});var v=a.find(".voteAvailableNumber").val(),c='{{ for(var i = 1; i <= it.voteCount - 1; i++) { }}          <option {{? it.oldVoteAvailableNumber == i }}selected="selected"{{?}}>{{= i}}</option>        {{ } }}';a.find(".voteAvailableNumber").html(C().template(c)({oldVoteAvailableNumber:v,voteCount:d}))}),a.find(".voteLastTime").val(t.getTomorrowEnd()),a.find(".voteLastTime").mdDatePicker({selectDate:ce()(t.getTomorrowEnd()),dialogStyle:{offsetLeft:0,offsetTop:24},isShowClear:!1,zIndex:1002,onChange:function(v){var c=v;c=new Date(c);var f=new Date(new Date().getTime()-new Date().getTime()%864e5);if(f-c===0){var u=new Date().getHours();a.find(".voteLastHour").find("option").each(function(g,h){var m=parseInt($(h).val(),10)<=u;m&&$(h).hide(),$(h).prop("disabled",m)}).end().val(u+1>=24?0:u+1)}else a.find(".voteLastHour option").prop("disabled",!1).show()}})})},getDefaultContent:function(e,t){return t=t||73,'<div class="arrowUpOuter" style="left:'+t+'px;"><div class="arrowUpInner"></div></div>    <div class="updaterDialog_Main" style="min-height: 35px;">      <div class="Left voteOptions">        <ul>        </ul>        <div class="pLeft5 mTop5">          <a href="javascript:void(0)" class="addItem">            '+_l("+\u589E\u52A0\u9009\u9879")+'</a>        </div>      </div>      <div class="Clear"></div>      <div class="voteUpdaterOperate">        <table border="0" cellpadding="2" cellspacing="1">          <tr>            <td width="130" style="vertical-align: middle; height: 30px;">              '+_l("\u5141\u8BB8\u9009\u62E9")+'              <select class="voteAvailableNumber">                <option>1</option>                <option>2</option>              </select>              '+_l("\u9879")+'            </td>            <td style="vertical-align: middle;">              '+_l("\u622A\u6B62\u65E5\u671F")+'              <input class="TextBox voteLastTime" style="width: 70px" />              <select class="voteLastHour">                <option value="0">0</option>                <option value="1">1</option>                <option value="2">2</option>                <option value="3">3</option>                <option value="4">4</option>                <option value="5">5</option>                <option value="6">6</option>                <option value="7">7</option>                <option value="8">8</option>                <option value="9">9</option>                <option value="10">10</option>                <option value="11">11</option>                <option value="12">12</option>                <option value="13">13</option>                <option value="14">14</option>                <option value="15">15</option>                <option value="16">16</option>                <option value="17">17</option>                <option value="18">18</option>                <option value="19">19</option>                <option value="20">20</option>                <option value="21">21</option>                <option value="22">22</option>                <option value="23">23</option>              </select>&nbsp;'+_l("\u65F6")+'            </td>          </tr>          <tr>            <td>              <input id="'+e+'voteAnonymous" type="checkbox" class="mRight5 Left voteAnonymous" />              <label for="'+e+'voteAnonymous">'+_l("\u533F\u540D\u6295\u7968")+'</label>            </td>          </tr>        </table>      </div>    </div>    <div class="Clear"></div>  '},initUploadify:function(e,t){var i=C().template('<div class="votePicContainer Hidden votePicContainer{{=it.index}}">        <div class="votePicUploaded">          <input type="hidden" id="{{=it.idPrefix}}hidVotePicUpload{{=it.index}}" />        </div>        <div class="votePicDesc Hidden">          <div class="overflow_ellipsis votePicName Bold"></div>          <br />          <a href="javascript:;" id="re_{{=it.idPrefix}}VotePicUpload{{=it.index}}">\u6362\u4E00\u5F20</a>        </div>        <div class="Clear"></div>      </div>')({index:e,idPrefix:t}),o=$("#"+t+"divVoteUpload"+e).html(i);$("#"+t+"hidVotePicUpload"+e).uploadAttachment({filterTitle:"\u56FE\u7247",filterExtensions:"gif,png,jpg,jpeg,bmp",pluploadID:"#"+t+"VotePicUpload"+e,newPluploadID:"#re_"+t+"VotePicUpload"+e,folder:"VoteDoc",multiSelection:!1,onlyOne:!0,filesAdded:function(){o.find(".votePicContainer"+e).show()},callback:function(a,s){var d=o.find(".votePicContainer"+e);if(a.length>0){var v=a[0];d.find(".votePicDesc").show(),d.find(".votePicName").text(v.originalFileName+v.fileExt).attr("title",v.originalFileName+v.fileExt).show();var c=v.serverName+v.filePath+v.fileName+v.fileExt;d.find("img:first").attr("file",c).attr("thumbnail",c),d.find("img:first").attr("src",v.url+"&imageView2/1/w/219/h/153"),$("#"+t+"VotePicUpload"+e).hide()}else $("#"+t+"VotePicUpload"+e).show(),d.hide()}})},getTomorrowEnd:function(){var e=new Date;return e.setDate(e.getDate()+1),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},reset:function(e){var t=this;return e.each(function(i,o){var n=$(o);if(n.find(".voteOptions input").length>0&&(n.find('.voteOptions input[type = "text"]').addClass("Gray_c").val(_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")),n.find(".UploadSuccess").html(""),n.find("div[pluploadid]").show(),n.find(".voteOptions li:gt(1)").remove()),n.find(".voteAvailableNumber").length>0&&(n.find(".voteAvailableNumber").get(0).selectedIndex=0),n.find(".voteAnonymous").length>0&&n.find(".voteAnonymous").removeAttr("checked"),n.find(".voteVisble").length>0&&n.find(".voteVisble").attr("checked","checked"),$(o).find(".voteOptions li").length>0){var a=$(o).find(".voteOptions li").length;if(a>0)for(var i=0;i<a;i++)i>1&&$(o).find(".voteOptions li").eq(i).remove()}n.find(".voteLastHour").val(new Date().getHours()),n.find(".voteLastTime").val(t.getTomorrowEnd()),n.find(".voteUpdaterOperate").show()})},getData:function(e){var t=e.find(".voteOptions li"),i="",o="",n="",a="",s="",d=!1,v=!1;t.each(function(f){t.eq(f).find("input").val()!=""&&t.eq(f).find("input").val()!=_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")&&(i+=t.eq(f).find("input").val()+"[Option]",t.eq(f).find("img:first").attr("file")!=""?o+=t.eq(f).find("img:first").attr("file")+"[Option]":o+="[Option]")}),n=e.find(".voteLastTime").val(),a=e.find(".voteLastHour").val(),s=parseInt(e.find(".voteAvailableNumber").val()||"0",10),d=e.find(".voteAnonymous").prop("checked"),v=d.length>0;var c="";return i.length>0&&(c+="voteOptions="+encodeURIComponent(i||""),c+="&voteOptionFiles="+encodeURIComponent(o||"")),n.length>0&&(c+="&voteLastTime="+encodeURIComponent(n||"")),a.length>0&&(c+="&voteLastHour="+encodeURIComponent(a||"")),c+="&voteAvailableNumber="+encodeURIComponent(s||""),c+="&voteAnonymous="+encodeURIComponent(d||""),c+="&voteVisble="+encodeURIComponent(v||""),{invalid:$.grep(t,function(f){var u=$(f).find('input[type = "text"]');return u.val(T().trim(u.val())),u.val()===""||u.val()===_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")}).length,voteOptions:i,voteOptionFiles:o,voteLastTime:n,voteLastHour:a,voteAvailableNumber:s,voteAnonymous:d,voteVisble:v}},alertInvalidData:function(e){var t=$.grep(e.find('.voteOptions li input[type = "text"]'),function(i){var o=$(i);return o.val(T().trim(o.val())),o.val()===""||o.val()===_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")});t.length&&alert("\u6295\u7968\u9879\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",3)}};const O=pe;var Fe=p(91744),Pe=p(37846),ve=function(e,t){var i=this,o={viewUrl:"",linkViewData:{errorCode:"-2",title:"",desc:"",url:"",shortUrl:"",flashUrl:"",favico:"",img:"",imgArr:[],error:""},callback:function(s){}},n=$.extend(o,t);i.init=function(){i.clear(),i.getLinkViewData()},i.getLinkViewData=function(){if(!n.viewUrl)return!1;n.linkViewData.url=n.viewUrl.match(/:\/\//)?n.viewUrl:"http://"+n.viewUrl,F.Z.getLinkViewInfo({url:encodeURIComponent(n.viewUrl)}).then(function(a){n.linkViewData.errorCode="1",a&&((a.title||"").trim()||(a.title=a.url),a.shortUrl&&(n.linkViewData.shortUrl=a.shortUrl),a.title?n.linkViewData.title=a.title:n.linkViewData.title=n.linkViewData.shortUrl,a.thumbnails&&(n.linkViewData.imgArr=a.thumbnails),a.thumbnails&&a.thumbnails.length>0&&(n.linkViewData.img=a.thumbnails[0]),a.description&&(n.linkViewData.desc=a.description),i.createLinkViewHtml(n.linkViewData)),n.callback&&n.callback(n.linkViewData)}).catch(function(){n.callback&&n.callback(n.linkViewData)})},i.createLinkViewHtml=function(a){var s=`
    <div class='linkView'>
      <table class='fixed' border='0' cellspacing='0' cellpadding='0' width='100%'>
        <tr>
          `+(a.imgArr&&a.imgArr.length>0?`<td class='pRight15' width='160px' style='box-sizing: initial;'>
                `+(a.flashUrl?"<input class='linkFlashUrl' value='"+a.flashUrl+"' type='hidden'/>":"")+`
                <div class='picArea'>
                <div class='picList'>
                <table border='0' cellpadding='0' cellspacing='0'><tr><td>
                <img class='linkThumb' src='`+a.imgArr[0]+`' />
                </td></tr></table>
                </div>
                `+(a.imgArr.length>1?`<div class='thumbPages'><a class='prevPic Black Visibility' href='javascript:void(0);'> < </a>
                    <span class='thumbCurrentNum'>1</span> of <span class='thumbTotalNum'>`+a.imgArr.length+`</span>
                    <a class='nextPic Black'  href='javascript:void(0);'> > </a></div>
                    `:"")+`
                </div>
                </td>
                <td class='TxtTop'>
              `:"<td class='TxtTop' style='width:100%;'>")+`
        <div class='mBottom5'>
        `+(a.favico?"<img class='linkFavico' width='16' height='16' align='middle' src='"+a.favico+"'/> ":"")+`
        <a class='linkTitle' target='_blank' href='`+a.shortUrl+"' >"+a.title+`</a>
        </div>
        <div class='linkDesc' title='`+a.desc+"' alt='"+a.desc+`'>
        `+(a.desc.length>85?a.desc.substring(0,85)+"...":""+a.desc)+`
        </div>
        `+(a.error?`<div class='nullPrompt'>
            `+_l("\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u94FE\u63A5\u6CA1\u6709\u641C\u7D22\u5230\u76F8\u5173\u5185\u5BB9\uFF0C\u8BF7\u5C1D\u8BD5\u91CD\u65B0")+"<span class='ThemeColor3'>["+_l("\u9884\u89C8")+`]</span>
            `+_l("\u6216\u624B\u5DE5")+"<span class='ThemeColor3'>["+_l("\u7F16\u8F91")+`]</span>
            </div>
            `:"")+`
        <div class='Right mTop10'>
        <span class='linkBtnEdit Hand Font16 Gray_df icon-edit'></span>
        <a class='linkBtnSave Hidden' href='javascript:void(0);' >`+_l("\u4FDD\u5B58")+`</a>
        <a class='linkBtnCancel Hidden' href='javascript:void(0);'>`+_l("\u53D6\u6D88")+`</a>
        </div>
        <div class='Clear'></div>
        </td>
        </tr>
        <tr>
        <td colspan='2'>
        <div class='linkOperator' class='mTop5 Left'>
        `+(a.imgArr&&a.imgArr.length>0&&!a.flashUrl?"<div><label><input type='checkbox' class='withLinkImg Left' class='Left' checked='checked'/>"+_l("\u53D1\u5E03\u65F6\u52A0\u5165\u9884\u89C8\u56FE")+"</label></div>":"")+`
        </div>
        </td>
        </tr>
        </table>
    `;$(e).html(s),i.bindEvent()},i.bindEvent=function(){var a=$(e).find(".linkView");a&&(a.find(".prevPic").on("click",function(){i.changeLinkThumb("prev")}),a.find(".nextPic").on("click",function(){i.changeLinkThumb("next")}),a.find(".linkBtnEdit").on("click",function(){i.editLink()}),a.find(".linkBtnSave").on("click",function(){i.saveLink()}),a.find(".linkBtnCancel").on("click",function(){i.cancelLink()}),a.find(".withLinkImg").on("click",function(){i.withLinkImg()}))},i.changeLinkThumb=function(a){var s=$(e).find(".linkView"),d=parseInt(s.find(".thumbCurrentNum").html());a=="next"?d++:d--,d==1?(s.find(".prevPic").addClass("Visibility"),s.find(".nextPic").removeClass("Visibility")):d==n.linkViewData.imgArr.length?(s.find(".prevPic").removeClass("Visibility"),s.find(".nextPic").addClass("Visibility")):(s.find(".prevPic").removeClass("Visibility"),s.find(".nextPic").removeClass("Visibility")),s.find(".thumbCurrentNum").html(d),s.find(".linkThumb").attr("src",n.linkViewData.imgArr[d-1]);var v=s.find(".withLinkImg");v.attr("checked")&&(n.linkViewData.img=n.linkViewData.imgArr[d-1],n.callback&&n.callback(n.linkViewData))},i.editLink=function(){var a=$(e).find(".linkView"),s=a.find(".linkTitle"),d=a.find(".linkDesc");if(a.find(".linkTitleDiv").length>0)a.find(".linkTitleDiv").show(),a.find(".linkDescDiv").show();else{var v="<div class='linkTitleDiv'><input class='txtLinkTitle TextBox'  type='text' value='"+s.html()+"' style='width:98%;box-sizing: initial;'/></div>",c="<div class='linkDescDiv'><textarea class='txtLinkDesc TextArea' style='width:98%;height:50px;box-sizing: initial;'>"+d.attr("title")+"</textarea></div>";s.after(v),d.after(c)}s.hide(),d.hide(),a.find(".linkBtnEdit").hide(),a.find(".linkBtnSave").show(),a.find(".linkBtnCancel").show()},i.saveLink=function(){var a=$(e).find(".linkView");a.find(".nullPrompt").hide();var s=a.find(".txtLinkTitle").val();s&&(a.find(".linkTitle").html(s),a.find(".nullPrompt").hide());var d=a.find(".txtLinkDesc").val();d&&(d.length>85?a.find(".linkDesc").html(d.substring(0,85)+"..."):a.find(".linkDesc").html(d),a.find(".linkDesc").attr("alt",d).attr("title",d),a.find(".nullPrompt").hide()),a.find(".linkTitleDiv").hide(),a.find(".linkDescDiv").hide(),a.find(".linkTitle").show(),a.find(".linkDesc").show(),a.find(".linkBtnEdit").show(),a.find(".linkBtnSave").hide(),a.find(".linkBtnCancel").hide(),n.linkViewData.title=s,n.linkViewData.desc=d,n.callback&&n.callback(n.linkViewData)},i.cancelLink=function(){var a=$(e).find(".linkView");a.find(".linkTitleDiv").remove(),a.find(".linkDescDiv").remove(),a.find(".linkTitle").show(),a.find(".linkDesc").show(),a.find(".linkBtnEdit").show(),a.find(".linkBtnSave").hide(),a.find(".linkBtnCancel").hide()},i.withLinkImg=function(){var a=$(e).find(".linkView"),s=a.find(".withLinkImg");s.attr("checked")?n.linkViewData.img=a.find(".linkThumb").attr("src"):n.linkViewData.img="",n.callback&&n.callback(n.linkViewData)},i.createXML=function(a){if(document.all){var s=new ActiveXObject("Microsoft.XMLDOM");return s.loadXML(a),s}else{var s=new DOMParser;return s.parseFromString(a,"text/xml")}},i.clear=function(){$(e).empty()},i.init()};const he=function(r,e){return new ve(r,e)};var fe=p(68085),He=p(98110),S=_l("\u4E0A\u4F20\u9644\u4EF6"),b=_l("\u5206\u4EAB\u7F51\u7AD9")+"...",I=_l("\u8BF7\u8F93\u5165\u6295\u7968\u95EE\u9898")+"...";function ue(r){var e={options:{postType:{post:0,link:1,vote:7,attachment:9},defaultPostType:0,showType:["post","link","vote","attachment"],showToFeed:!1,knowledge:!0,appId:void 0,uploadObj:null,isUploadComplete:!0,attachmentData:[],kcAttachmentData:[],defaultAttachmentData:[],defaultKcAttachmentData:[],linkViewData:null,selectGroupOptions:{maxHeight:270,isAll:!0,isMe:!0,groupLink:!0,defaultIsNone:!0,defaultValue:"",defaultValueAllowChange:!0},callback:null,createShare:!0},handleOpen:function(){var i=$('[targetdiv="#MDUpdater_Attachment_updater"]');i.hasClass("ThemeColor3")||i.click()},handleUploadComplete:function(i){e.options.isUploadComplete=i;var o=$("#MDUpdater_textarea_Updater"),n=o.val();i&&(!n||n==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"..."||n==_l("\u4E0A\u4F20\u9644\u4EF6"))&&(e.options.attachmentData.length||e.options.kcAttachmentData.length)&&(o.val(e.options.attachmentData.length?e.options.attachmentData[0].originalFileName:e.options.kcAttachmentData[0].originalFileName),o.focus())},render:function(){var i=this;_.render(w.createElement(se.Z,{dropPasteElement:"MDUpdater_textarea_Updater",onDropPasting:function(){return i.handleOpen()},arrowLeft:4,isInitCall:!0,temporaryData:e.options.attachmentData,kcAttachmentData:e.options.kcAttachmentData,onTemporaryDataUpdate:function(n){e.options.attachmentData=n},onKcAttachmentDataUpdate:function(n){e.options.kcAttachmentData=n},onUploadComplete:function(n){i.handleUploadComplete(n)}}),document.querySelector("#MDUpdater_Attachment_updater"))},bindUploadEvent:function(){var i=e.options.defaultAttachmentData,o=e.options.defaultKcAttachmentData;i.length&&(e.options.attachmentData=i),o.length&&(e.options.kcAttachmentData=o),(e.options.defaultPostType===0||i.length||o.length)&&this.render()},resetUpdater:function(i,o){i||(i={}),o&&(e.options.callback=function(){});var n=$("#MDUpdater_textarea_Updater");if(n){var a=n.val();(!a||a==S||a==b||a==I)&&n.val(_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...").addClass("Gray_a")}e.options.defaultPostType!==9&&$("#MDUpdater_hidden_UpdaterType").val(e.options.postType.post),$("div.MDUpdater a[targetdiv='#MDUpdater_Attachment_updater']").removeClass("ThemeColor3").addClass("Gray_c"),$("div.MDUpdater a[targetdiv='#MDUpdater_Link_updater']").removeClass("ThemeColor3").addClass("Gray_c"),$("div.MDUpdater a[targetdiv='#MDUpdater_Vote_updater']").removeClass("ThemeColor3").addClass("Gray_c"),$("#MDUpdater_Attachment_updater,#MDUpdater_Link_updater,#MDUpdater_Vote_updater").hide(),e.options.attachmentData=new Array,e.options.kcAttachmentData=new Array;var s=$("#MDUpdater_Link_updater");s.find(".updaterLinkView").empty(),s.find(".textLinkUrl").val("http://").addClass("Gray_c"),e.options.linkViewData=null,$("#MDUpdater_button_Share").attr("disabled",!1).removeClass("Disabled"),$("#MDUpdater_Link_updater .linkBtn").val(_l("\u9884\u89C8")).attr("disabled",!1).removeClass("Disabled"),O.reset($("#MDUpdater_Vote_updater")),$("#mdUpdateCloseContainer").hide()},postUpdater:function(i){var o=$("#MDUpdater_textarea_Updater");o.mentionsInput("val",function(n){var a=n;if(!$.trim(a)||a==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"..."||a==S||a==b||a==I)return alert(_l("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),3),!1;if(a.length>6e3)return alert(_l("\u53D1\u8868\u5185\u5BB9\u8FC7\u957F\uFF0C\u6700\u591A\u5141\u8BB86000\u4E2A\u5B57\u7B26"),3),!1;var s=$("#MDUpdater_hidden_UpdaterType").val(),d=$("#MDUpdater_hidden_GroupID_All").SelectGroup("getScope"),v=$("#isToFeed").prop("checked"),c={postType:s,postMsg:a};if(v||(c.showType=1),s==e.options.postType.link){var f=$("#MDUpdater_text_LinkUrl").val();if(!f||f=="http://")return alert(_l("\u8BF7\u8F93\u5165\u94FE\u63A5"),3),!1;if(e.options.linkViewData){var u=e.options.linkViewData;c.linkUrl=u.url,c.linkTitle=u.title,c.linkDesc=u.desc,c.linkThumb=u.img}else return alert(_l("\u8BF7\u9884\u89C8\u94FE\u63A5"),3),!1}else if(s==e.options.postType.attachment&&e!="undefined"){if(typeof e.options.isUploadComplete<"u"&&!e.options.isUploadComplete)return alert(_l("\u6587\u4EF6\u4E0A\u4F20\u4E2D\uFF0C\u8BF7\u7A0D\u7B49"),3),!1;if(e.options.attachmentData.length==0&&e.options.kcAttachmentData.length==0)return alert(_l("\u8BF7\u9009\u62E9\u8981\u4E0A\u4F20\u7684\u9644\u4EF6"),3),!1;var g=e.options.attachmentData.filter(function(m){return m.inEdit});if(g.length>0)return alert(_l("\u8BF7\u5148\u4FDD\u5B58\u6587\u4EF6\u540D"),3),!1;if(c.attachments=U()(e.options.attachmentData),c.knowledgeAttach=U()(e.options.kcAttachmentData),e.options.attachmentData[0]&&a==e.options.attachmentData[0].originalFileName&&!confirm(_l("\u786E\u8BA4\u8981\u4EE5\u539F\u59CB\u56FE\u7247\u540D\u4F5C\u4E3A\u53D1\u5E03\u52A8\u6001\u5185\u5BB9\uFF1F")))return!1}else if(s==e.options.postType.vote){var h=O.getData($("#MDUpdater_Vote_updater"));if(h.invalid){alert(_l("\u6295\u7968\u9879\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),3);return}c.voteOptions=h.voteOptions,c.voteOptionFiles=h.voteOptionFiles,c.voteLastTime=h.voteLastTime,c.voteLastHour=h.voteLastHour,c.voteAvailableNumber=h.voteAvailableNumber,c.voteAnonymous=h.voteAnonymous,c.voteVisble=h.voteVisble}if(c.appId=e.options.appId,d)c.scope=d;else if(!v)c.scope={radioProjectIds:"",shareGroupIds:[],shareProjectIds:[e.options.selectGroupOptions.projectId]};else{alert(_l("\u8BF7\u9009\u62E9\u7FA4\u7EC4"),3),$("#MDUpdater_hidden_GroupID_All").SelectGroup("slideDown");return}$(i).attr("disabled","disabled").addClass("Disabled"),F.Z.addPost(c).then(function(m){if(!m.success){alert(_l("\u53D1\u5E03\u52A8\u6001\u5931\u8D25"),2);return}if(e.options.createShare){if(window.location.pathname.indexOf("/feed")>-1)return alert(_l("\u53D1\u5E03\u6210\u529F")),!1;(0,fe.Z)({linkURL:md.global.Config.WebUrl+"feeddetail?itemID="+m.post.postID,content:_l("\u52A8\u6001\u521B\u5EFA\u6210\u529F")})}e.options.callback?e.options.callback(m.post):alert(_l("\u5206\u4EAB\u6210\u529F")),o.val(""),o.mentionsInput("reset").mentionsInput("clearStore"),e.resetUpdater(null,!0),$("#MDUpdaterhidden_GroupID_All").SelectGroup(e.options.selectGroupOptions)}).finally(function(){$(i).removeAttr("disabled").removeClass("Disabled"),$(".easyDialogBoxMDUpdater")[0]&&$(".easyDialogBoxMDUpdater").parent().remove()})})},dialogChooseGroup:function(i,o,n){$(i).dialogSelectGroup({projectId:n,callback:function(s){var d=e.options.selectGroupOptions;d.defaultValue=s,$(o).SelectGroup(d),e.postUpdater(i)}})},showUpdaterDivForDocCenter:function(i){i&&$.extend(e.options,i),M.Z.confirm({dialogClasses:"easyDialogBoxMDUpdater",width:640,noFooter:!0,children:w.createElement("div",{dangerouslySetInnerHTML:{__html:C().template(le())()}})}),e.options.postMsg&&$("#MDUpdater_textarea_Updater").val(e.options.postMsg),e.bindEvent()},bindEvent:function(){e.bindUploadEvent(),setTimeout('$("#MDUpdater_textarea_Updater")[0].focus();',10),$("#MDUpdater_hidden_GroupID_All").SelectGroup(e.options.selectGroupOptions),$("#MDUpdater_button_Share").val(_l("\u5206\u4EAB")),$("#MDUpdater_hidden_UpdaterType").val(e.options.defaultPostType),e.options.showToFeed&&$("#divIsToFeed").show(),e.options.knowledge||$("#MDUpdater_Div_JoinKnowledge").remove();var i=$("#MDUpdater_textarea_Updater");i.focus(function(o){var n=i.val();(n==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"..."||n==S||n==b||n==I)&&i.val(""),i.removeClass("Gray_a")}).blur(function(){i.mentionsInput("store"),$.trim($(this).val())||i.val(_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...").addClass("Gray_a")}).autoTextarea({maxHeight:150,minHeight:72}),i.mentionsInput({submitBtn:"MDUpdater_button_Share",showCategory:!0,cacheKey:"updatertext",reset:!1}),e.options.postMsg||i.mentionsInput("restore",function(o){o?(i.removeClass("Gray_a"),$("#myupdaterOP").show()):e.options.postMsg||i.val(_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...").addClass("Gray_a")}),T().includes(e.options.showType,"post")?$(".Updater_Textpanel span.update_close").on("click",function(){e.resetUpdater(),i&&(i.val().trim()||i.val(_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...").addClass("Gray_a"))}):$(".Updater_Textpanel span.update_close").css("display","none"),T().includes(e.options.showType,"attachment")&&$("[targetdiv='#MDUpdater_Attachment_updater']").removeAttr("style"),T().includes(e.options.showType,"link")&&$("[targetdiv='#MDUpdater_Link_updater']").removeAttr("style"),T().includes(e.options.showType,"vote")&&$("[targetdiv='#MDUpdater_Vote_updater']").removeAttr("style"),T().includes(e.options.showType,"video")&&$("[targetdiv='#MDUpdater_Video_updater']").removeAttr("style"),$("#isToFeed").on("change",function(){$(this).prop("checked")?($("#divIsToFeedToggle").removeClass("Gray_c").addClass("ThemeColor3"),$(".Updater_Textpanel").find(".groupSelect").show()):($("#divIsToFeedToggle").removeClass("ThemeColor3").addClass("Gray_c"),$(".Updater_Textpanel").find(".groupSelect").hide())}),$("div.MDUpdater a[targetDiv]").on("click",function(){var o=$(this).attr("targetDiv");if(o=="#MDUpdater_Attachment_updater"){if(e.options.attachmentData.length==0&&e.options.kcAttachmentData.length==0&&$("#MDUpdater_Attachment_updater").is(":visible")){e.resetUpdater();return}else if($("#MDUpdater_Attachment_updater").is(":visible"))return}if(o=="#MDUpdater_Link_updater"){if(($("#MDUpdater_Link_updater").val().trim()=="http://"||$("#MDUpdater_Link_updater").val().trim()=="")&&$("#MDUpdater_Link_updater").is(":visible")){e.resetUpdater();return}else if($("#MDUpdater_Link_updater").is(":visible"))return}if(o=="#MDUpdater_Vote_updater"&&$("div.MDUpdater .voteOptions li").eq(0).find("input").val()==_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")&&$("div.MDUpdater .voteOptions li").eq(1).find("input").val()==_l("\u8BF7\u8F93\u5165\u6295\u7968\u9879")&&$("#MDUpdater_Vote_updater").is(":visible")){e.resetUpdater();return}else if(o=="#MDUpdater_Vote_updater"&&$("#MDUpdater_Vote_updater").is(":visible"))return;if(e.resetUpdater(),o=="#MDUpdater_Attachment_updater")$("#MDUpdater_Attachment_updater").show(0,function(){}),$(this).removeClass("Gray_c").addClass("ThemeColor3"),$("#MDUpdater_hidden_UpdaterType").val(e.options.postType.attachment),$("#MDUpdater_textarea_Updater")&&($("#MDUpdater_textarea_Updater").val().trim()==""||$("#MDUpdater_textarea_Updater").val().trim()==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...")&&$("#MDUpdater_textarea_Updater").val(S).addClass("Gray_a"),e.render();else if(o=="#MDUpdater_Link_updater")$("#MDUpdater_Link_updater").show(),$("#MDUpdater_hidden_UpdaterType").val(e.options.postType.link),$(this).removeClass("Gray_c").addClass("ThemeColor3"),$("#MDUpdater_textarea_Updater")&&($("#MDUpdater_textarea_Updater").val().trim()==""||$("#MDUpdater_textarea_Updater").val().trim()==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...")&&$("#MDUpdater_textarea_Updater").val(b).addClass("Gray_a"),$("#MDUpdater_Link_updater .textLinkUrl").on("keydown",function(a){var s=window.event?a.keyCode:a.which;s==13&&$("#MDUpdater_Link_updater .linkBtn").click()});else if(o=="#MDUpdater_Vote_updater"){$("#MDUpdater_hidden_UpdaterType").val(e.options.postType.vote),$(this).removeClass("Gray_c").addClass("ThemeColor3"),$("#MDUpdater_textarea_Updater")&&($("#MDUpdater_textarea_Updater").val().trim()==""||$("#MDUpdater_textarea_Updater").val().trim()==_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"...")&&$("#MDUpdater_textarea_Updater").val(I).addClass("Gray_a");var n=$("a[targetDiv='#MDUpdater_Vote_updater']").prevAll(":visible").length;$("#MDUpdater_Vote_updater").attr("left",n*36+3),O.init($("#MDUpdater_Vote_updater"))}else $("#MDUpdater_hidden_UpdaterType").val(e.options.postType.post);$(o).show(0,function(){}),o!="#MDUpdater_Video_updater"&&$("#mdUpdateCloseContainer").show()}),$("[targetdiv='#MDUpdater_Video_updater']").length>0&&e.showUploadPageForVideoCenter("[targetdiv='#MDUpdater_Video_updater']"),new ne.Z("div.MDUpdater .faceBtn",{input:"#MDUpdater_textarea_Updater",placement:"right bottom",mdBear:!1,relatedLeftSpace:22,onSelect:function(){var n=$("#MDUpdater_textarea_Updater")[0];(n.value===_l("\u77E5\u4F1A\u5DE5\u4F5C\u662F\u4E00\u79CD\u7F8E\u5FB7")+"..."||n.value===S||n.value===b||n.value===I)&&(n.value="")}}),$("#MDUpdater_Link_updater .linkBtn").on("click",function(){var o=$("#MDUpdater_text_LinkUrl").val().trim();if(!o||o=="http://")return alert(_l("\u8BF7\u8F93\u5165\u94FE\u63A5"),3),!1;var n=$(this);n.val(_l("\u63D0\u53D6\u4E2D...")).attr("disabled",!0).addClass("Disabled");var a=$("#MDUpdater_button_Share");a.attr("disabled",!0).addClass("Disabled"),he($("#MDUpdater_Link_updater .updaterLinkView"),{viewUrl:o,callback:function(d){d.errorCode!="1"&&(alert("\u94FE\u63A5\u63D0\u53D6\u5931\u8D25",3),d=null),e.options.linkViewData=d,n.val(_l("\u9884\u89C8")).attr("disabled",!1).removeClass("Disabled"),a.attr("disabled",!1).removeClass("Disabled")}})}),$("#MDUpdater_button_Share").on("click",function(){e.postUpdater(this)}),e.options.defaultPostType==e.options.postType.vote&&$("div.MDUpdater a[targetDiv='#MDUpdater_Vote_updater']").click(),e.options.defaultAttachmentData.length+e.options.defaultKcAttachmentData.length&&($("#MDUpdater_hidden_UpdaterType").val(9),$("#MDUpdater_Attachment_updater").show(),$("div.MDUpdater a[targetdiv='#MDUpdater_Attachment_updater']").addClass("ThemeColor3").removeClass("Gray_c"))},showVideoUpload:function(){var i=450,o=660,n=(window.screen.height-i)/2-50,a=(window.screen.width-o)/2-7,s="/apps/videos/uploadpage/fileupload",d="top="+n+"px,left="+a+"px,width="+o+"px,height="+i+"px,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no";window.open(s,"_blank",d)},showUploadPageForVideoCenter:function(i){$(i).click(function(){e.showVideoUpload()})}};$("#dialogSendMessage").is(":visible")||$(".easyDialogBoxMDUpdater").is(":visible")||$("#createCalendar").is(":visible")||$("#createTask").is(":visible")||e.showUpdaterDivForDocCenter(r)}var me=p(70794),ge=p(63743),N=p(48446),B=p(45231),y=p(67460),Te=p(537),A=p(98306),De=p(46593),k=p.n(De),Ce=p(96213),ke=p(65406),Ue=p(75809);function ye(r){return new(k())(function(e,t){Ce.Z.getMyTaskList(r).then(function(i){if(!i.status)t(_l("\u83B7\u53D6\u6570\u636E\u5931\u8D25"));else{var o=i.data;e(o)}}).catch(function(i){t(i)})})}function we(r){return new(k())(function(e,t){y.Z.getChatList(r).then(function(i){e(i)}).catch(function(i){t(_l("\u83B7\u53D6\u6570\u636E\u5931\u8D25"))})})}function $e(r){return new(k())(function(e,t){if(r.qiniuUrl&&r.qiniuUrl.indexOf(md.global.FileStoreConfig.pictureHost)>-1){e({data:r.qiniuUrl});return}y.Z.convertToOtherAttachment(r).then(function(i){e({data:i})}).catch(function(i){t(_l("\u83B7\u53D6\u6570\u636E\u5931\u8D25"))})})}function Se(){return new(k())(function(r,e){$.CreateTask({relationCallback:function(i){r({taskID:i.taskID,taskName:i.taskName})}})})}function be(){return new(k())(function(r,e){(0,Ue.Z)({sourceId:0,fromType:0,showMoreInvite:!1,SelectUserSettings:{filterAccountIds:[md.global.Account.accountId],callback:function(i){i.length>1?ke.Z.addDiscussionGroup({accountIds:i.map(function(o){return o.accountId})}).then(function(o){r({type:2,logo:o.avatar,name:o.name,value:o.groupId})}).catch(function(){e(_l("\u521B\u5EFA\u65B0\u804A\u5929\u5931\u8D25"))}):r({type:1,logo:i[0].avatar,name:i[0].fullname,value:i[0].accountId})}}})})}var l=p(56924),Ie=p(42506),xe=p(12424),Ae=p(78250),Le=p.n(Ae),P=p(17563),Ee=C().template(Le()),H=function(e){var t={sendToType:1,attachmentType:1,file:{}};this.options=T().assign({},t,e),this.openDialog()};H.prototype={getTip:function(e){switch(e){case l.G0.COMMON:return _l("\u53D1\u9001\u6587\u4EF6\u526F\u672C");case l.G0.KC:return _l("\u53D1\u9001\u6587\u4EF6\u5206\u4EAB\u94FE\u63A5");case l.G0.WORKSHEET:return _l("\u53D1\u9001\u5DE5\u4F5C\u8868\u5206\u4EAB\u94FE\u63A5");case l.G0.WORKSHEETROW:return _l("\u53D1\u9001\u5DE5\u4F5C\u8868\u8BB0\u5F55\u5206\u4EAB\u94FE\u63A5");default:return""}},getTargetText:function(e){switch(e){case 3:return _l("\u5FAE\u4FE1\u626B\u7801");case 6:return _l("\u624B\u673AQQ\u626B\u7801");default:return _l("\u626B\u63CF\u4E8C\u7EF4\u7801")}},openDialog:function(){var e=this,t=e.options;M.Z.confirm({dialogClasses:"sendToMobile",width:540,title:_l("\u5206\u4EAB"),children:React.createElement("div",{dangerouslySetInnerHTML:{__html:Ee({tip:e.getTip(t.attachmentType),targetText:e.getTargetText(t.sendToType),attachmentType:t.attachmentType,fileName:t.file.fullName})}}),noFooter:!0}),e.$dialog=$(".sendToMobile"),e.$QRCode=e.$dialog.find(".urlQrCode"),this.renderQR()},renderQR:function(){var e=this,t=e.options,i=t.attachmentType,o,n;switch(i){case l.G0.COMMON:n=A.Z.getShareLocalAttachmentUrl({fileID:t.file.fileID});break;case l.G0.KC:n=t.file.shareUrl;break;case l.G0.QINIU:n=e.genQiniuFileShareUrl();break;case l.G0.WORKSHEET:case l.G0.WORKSHEETROW:n=t.file.shareUrl;break;default:break}k().all([n]).then(function(a){var s=(0,xe.Z)(a,1),d=s[0],v=e.getQRCodeLink(d);o=e.getImg(v,function(){e.$QRCode.empty().append($('<p class="loadError">\u52A0\u8F7D\u4E8C\u7EF4\u7801\u5931\u8D25</p>'))}),e.$QRCode.empty().append(o)}).catch(function(){e.$QRCode.empty().append($('<p class="loadError">\u52A0\u8F7D\u4E8C\u7EF4\u7801\u5931\u8D25</p>'))})},genQiniuFileShareUrl:function(){var e=this,t=e.options,i=t.file;return new(k())(function(o,n){A.Z.getShareLocalAttachmentUrl({filePath:t.file.qiniuPath,hours:48}).then(function(a){var s=P.parse(a.slice(a.indexOf("?")+1));a=a.slice(0,a.indexOf("?")>0?a.indexOf("?"):void 0);var d=P.stringify({qiniuPath:a,qiniutoken:s.token,e:s.e,name:i.name,ext:i.ext,size:i.size,genTime:new Date().getTime()});A.Z.getShortUrl({url:escape(md.global.Config.WebUrl+"apps/kc/shareLocalAttachment.aspx?"+d)}).then(function(v){o(v.shortUrl||v)})})})},getQRCodeLink:function(e){return md.global.Config.AjaxApiUrl+"code/CreateQrCodeImage?url="+encodeURIComponent(e)},getImg:function(e,t){var i=document.createElement("img");return i.setAttribute("src",e),i.addEventListener("error",function(){t&&t()},!1),i}};function Me(r){return new H(r)}var _e=C().template(q()),Oe=C().template(te()),K=C().template(ae()),W=function(e,t){this.options=e,this.callback=t,this.options.type===l.Bw.TASK?(this.fetch=ye,this.formatTpl={value:"taskName"},this.create=Se,this.defaultStr={footerStr:_l("\u521B\u5EFA\u65B0\u4EFB\u52A1"),placeholderStr:_l("\u641C\u7D22\u4EFB\u52A1")}):this.options.type===l.Bw.CHAT&&(this.fetch=we,this.formatTpl={value:"name",headUrl:"logo"},this.create=be,this.defaultStr={footerStr:_l("\u521B\u5EFA\u65B0\u804A\u5929"),placeholderStr:_l("\u641C\u7D22\u804A\u5929")}),this.init()};W.prototype={init:function(){var e=this,t=e.options,i=$(t.el),o=$(Oe(this.defaultStr));i.after(o),e.elements={},e.elements.$searchListCon=o.find(".searchListCon"),e.elements.$searchInput=o.find(".searchInput"),e.elements.$selected=o.find(".selected"),e.elements.$listPanel=o.find(".listPanel"),e.elements.$searchList=o.find(".searchList"),e.elements.$footerBtn=o.find(".footerBtn"),e.bindEvent()},bindEvent:function(){var e=this;$(document).on("click.hideShareAttSearchList",function(t){$(t.target).closest(".searchListCon").length||e.hideList(),t.stopPropagation()}),e.elements.$searchInput.on("keyup",function(t){var i=T().trim($(this).val());t.keyCode===37||t.keyCode===38||t.keyCode===39||t.keyCode===40||e.keywordsCache===i||(e.keywordsCache=i,e.fetchList())}),e.elements.$selected.on("click",function(t){e.elements.$listPanel.show(0,0,function(){e.defaultListData||e.fetchList(!0)}),e.elements.$searchInput.show().focus(),e.elements.$selected.hide(),t.stopPropagation()}),e.elements.$searchList.on("click",".listItem",function(t){t.stopPropagation();var i=$(this),o=i.data("key");e.select(o)}),e.elements.$searchList.on("wheel",function(t){t=t.originalEvent;var i=t.currentTarget,o=i.clientHeight,n=i.scrollTop,a=i.scrollHeight,s=t.deltaY<0&&n===0,d=t.deltaY>0&&o+n>=a;(s||d)&&t.preventDefault()}),e.elements.$footerBtn.on("click",function(){e.create().then(function(t){e.listData=[t],e.listTplData=e.formatDataTplData([t]),e.defaultListData=void 0,e.select(0)}).catch(function(t){alert(_l("\u521B\u5EFA\u5931\u8D25"),2)})})},fetchList:function(e){var t=this;t.elements.$searchList.html(K({isLoading:!0})),t.fetch({keywords:T().trim(t.elements.$searchInput.val()),size:20,projectId:t.options.type===l.Bw.CHAT?void 0:"all"}).then(function(i){e&&(t.defaultListData=i),t.listData=i,t.listTplData=t.formatDataTplData(i),t.renderList()}).catch(function(i){alert(_l("\u83B7\u53D6\u6570\u636E\u5931\u8D25"),2)})},renderList:function(){var e=this;e.elements.$searchList.html(K({list:e.listTplData}))},select:function(e){var t=this,i,o=t.listTplData[e];t.selectedData=t.listData[e],t.callback&&t.callback(t.selectedData),o.headUrl?i='<img src="'+o.headUrl+'">'+o.value:i=o.value,t.elements.$selected.html(i),t.hideList()},formatDataTplData:function(e){var t=this,i=t.formatTpl;return e.map(function(o){var n={};return i.value&&(n.value=o[i.value]),i.headUrl&&(n.headUrl=o[i.headUrl]),n})},hideList:function(){var e=this;e.elements.$listPanel.hide(),e.elements.$searchInput.hide(),e.elements.$selected.show()}};var Q=function(e,t){this.options=T().assign({},{sendToTargetType:l.Bw.CHAT,isKcFolder:!1},e),this.callbacks=t||{},this.file={ext:e.ext[0]==="."?e.ext.slice(1):e.ext,name:e.name,size:e.size,imgSrc:e.imgSrc},this.init()};Q.prototype={init:function(){var e=this,t=e.options,i=_e({showChangeDownload:!(File.isPicture(e.options.ext)||e.options.attachmentType===l.G0.KC||e.options.attachmentType===l.G0.WORKSHEET||e.options.attachmentType===l.G0.WORKSHEETROW),showChangeShare:e.options.attachmentType===l.G0.KC||e.options.attachmentType===l.G0.WORKSHEET||e.options.attachmentType===l.G0.WORKSHEETROW,SEND_TO_TYPE:l.Bw,attachmentType:e.options.attachmentType}),o="shareAttachmentDialog";M.Z.confirm({dialogClasses:o+" shareAttachmentDialog darkHeader",width:540,title:e.options.dialogTitle||_l("\u5206\u4EAB"),children:w.createElement("div",{dangerouslySetInnerHTML:{__html:i}}),noFooter:!0}),e.$dialog=$("."+o),e.dialogEle={},e.dialogEle.$fileName=e.$dialog.find("#fileName"),e.dialogEle.$fileNameText=e.$dialog.find(".fileNameText"),e.dialogEle.$canDownloadSwitch=e.$dialog.find("#canDownload"),t.attachmentType===l.G0.KC||t.attachmentType===l.G0.WORKSHEET||t.attachmentType===l.G0.WORKSHEETROW?(e.dialogEle.$fileName.hide(),e.dialogEle.$fileNameText.text(e.file.name).removeClass("hide")):e.dialogEle.$fileName.val(e.file.name),t.attachmentType===l.G0.WORKSHEET&&e.$dialog.find(".shareAttachmentDialogContainer").addClass("isWorksheet"),t.attachmentType===l.G0.WORKSHEETROW&&e.$dialog.find(".shareAttachmentDialogContainer").addClass("isWorksheetRow"),e.bindEvent(),e.previewFile(),t.attachmentType===l.G0.KC&&t.node?e.initModules():e.fetchBaseData(e.initModules.bind(e))},bindEvent:function(){var e=this;e.$dialog.on("change","#fileName",function(){e.newFileName=$(this).val()}),e.$dialog.on("click",".shareAttachmentFooter .yes",function(){e.share()}),e.$dialog.on("click",".shareAttachmentFooter .no",function(){$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}),e.$dialog.on("click",".addDescBtn",function(){e.$dialog.find(".addDescBtn").hide(),e.$dialog.find(".descCon").removeClass("hide"),$("#shareDesc").focus()})},checkClose:function(e){var t=this,i=t.options,o=e||i.node.visibleType;return i.attachmentType===l.G0.KC?o===l.lo.CLOSE:i.attachmentType===l.G0.WORKSHEET||i.attachmentType===l.G0.WORKSHEETROW?o===l.hj.CLOSE:!0},initModules:function(){var e=this,t=e.options;t.attachmentType===l.G0.KC||t.attachmentType===l.G0.WORKSHEET||t.attachmentType===l.G0.WORKSHEETROW?(e.initSelectPermission(),this.checkClose()||e.initSelectTargetList()):e.initSelectTargetList()},updateWorkshhetShareUrl:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments[1],i=this,o={worksheetId:i.options.id,appId:i.options.appId,viewId:i.options.viewId,objectType:1};e===2&&(o.objectType=2,o.rowId=i.options.rowId),B.Z.getWorksheetShareUrl(o).then(function(n){i.options.node=E()({},i.options.node,{shareUrl:n}),t()})},fetchBaseData:function(e){var t=this;switch(t.options.attachmentType){case l.G0.COMMON:A.Z.shareAttachmentByPost({fileId:t.options.id}).then(function(i){t.options.node=i,e&&typeof e=="function"&&e(i)}).catch(function(i){console.log(i)});break;case l.G0.KC:N.Z.getNodeDetail({id:t.options.id}).then(function(i){if(!i){alert(_l("\u60A8\u6743\u9650\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u5206\u4EAB\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6216\u6587\u4EF6\u4E0A\u4F20\u8005"),3);return}t.options.node=i,e&&typeof e=="function"&&e(i)});break;case l.G0.QINIU:$e({qiniuUrl:t.options.qiniuPath}).then(function(i){t.options.priviteBucketUrl=i.data,t.options.node=t.formatQiniuPath(i.data),e&&typeof e=="function"&&e(i)}).catch(function(i){console.log(i)});break;case l.G0.WORKSHEET:t.options.node=E()({},t.options.node,{visibleType:t.options.shareRange}),t.options.shareRange===l.hj.CLOSE&&t.options.canChangeSharable?(t.options.node.visibleType=l.hj.ALL,t.updateShareType(l.hj.ALL,function(){alert(_l("\u5F00\u542F\u5206\u4EAB"),4),t.updateWorkshhetShareUrl(1,e)})):t.updateWorkshhetShareUrl(1,e);break;case l.G0.WORKSHEETROW:t.options.node=E()({},t.options.node,{canChangeSharable:t.options.canChangeSharable,visibleType:t.options.visibleType}),t.options.visibleType===l.hj.CLOSE?(t.options.node.visibleType=l.hj.ALL,t.updateShareType(l.hj.ALL,function(){alert(_l("\u5F00\u542F\u5206\u4EAB"),4),t.updateWorkshhetShareUrl(2,e)})):t.updateWorkshhetShareUrl(2,e);break;default:break}},initSendToTarget:function(){var e=this,t;e.options.attachmentType===l.G0.WORKSHEET?t=[{value:l.Bw.CHAT,text:_l("\u6D88\u606F")}]:e.options.attachmentType===l.G0.WORKSHEETROW?t=[{value:l.Bw.CHAT,text:_l("\u6D88\u606F")}]:t=[{value:l.Bw.CHAT,text:_l("\u6D88\u606F")},{value:l.Bw.FEED,text:_l("\u52A8\u6001")},{value:l.Bw.TASK,text:_l("\u4EFB\u52A1")},{value:l.Bw.CALENDAR,text:_l("\u65E5\u7A0B")},{value:l.Bw.KC,text:_l("\u77E5\u8BC6")}],_.render(w.createElement(V.Z,{className:"sendToTargetDropdown w100",data:t,defaultValue:e.sendToTargetType,isAppendToBody:!0,menuStyle:{width:110},onChange:function(o){e.activeSendToOther(parseInt(o,10))}}),document.getElementById("sendToTargetBox"))},initSelectTargetList:function(){var e=this,t=10,i=86,o=4,n=e.$dialog.find(".selectTargetBtnList"),a=n.find(".listCon"),s=n.find(".prev"),d=n.find(".next");e.$dialog.find(".selectTargetCon").addClass("inited").removeClass("hide"),a.width(a.find(".targetBtn").length*i),v(),n.on("click",".prev, .next",function(){t+=i*o*($(this).hasClass("prev")?1:-1),v(),a.animate({left:t})}),n.on("click",".targetBtn",function(){var c=$(this).data("type");e.activeSendToOther(c)});function v(){n.find(".prev, .next").hide(),t<0&&n.find(".prev").show(),-1*t+i*o<=a.find(".targetBtn").length*i&&n.find(".next").show()}},initSelectPermission:function(){var e=this,t=e.$dialog.find(".changeShare"),i=e.$dialog.find(".closedTip"),o=e.$dialog.find("#linkContent"),n=e.options.rootInfo||e.options.node.rootInfo||{},a=_l("\u5141\u8BB8\u6240\u6709\u8054\u7CFB\u4EBA\u67E5\u770B"),s;t.removeClass("hide"),o.val(e.options.node.shareUrl),e.options.node.visibleType!==l.lo.CLOSE?e.initCopyLinkBtn():i.removeClass("hide"),n.project?a=_l("%0 \u6210\u5458\u53EF\u9884\u89C8",n.project.companyDisplayName):n.owner&&(a=_l("%0 \u7684\u8054\u7CFB\u4EBA\u53EF\u9884\u89C8",n.owner.fullname)),e.options.attachmentType===l.G0.KC?s=e.options.node.type===1?[{value:l.lo.CLOSE,text:_l("\u5173\u95ED\u6587\u4EF6\u5939\u5206\u4EAB")},{value:l.lo.PUBLIC,text:_l("\u5141\u8BB8\u4EFB\u4F55\u4EBA\u67E5\u770B")}]:[{value:l.lo.CLOSE,text:_l("\u5173\u95ED\u6587\u4EF6\u5206\u4EAB")},{value:l.lo.PROJECT,text:a},{value:l.lo.PUBLIC,text:_l("\u5141\u8BB8\u4EFB\u4F55\u4EBA\u67E5\u770B")}]:(e.options.attachmentType===l.G0.WORKSHEET||e.options.attachmentType===l.G0.WORKSHEETROW)&&(s=[{value:1,text:_l("\u5173\u95ED\u5206\u4EAB")},{value:2,text:_l("\u5141\u8BB8\u4EFB\u4F55\u4EBA\u67E5\u770B")}]),_.render(w.createElement(V.Z,{className:"selectSharePermissionDropdown w100",data:s,defaultValue:e.options.node.visibleType,isAppendToBody:!0,menuStyle:{width:170},onChange:function(v){e.updateShareType(v,function(c){var f=e.$dialog.find(".selectTargetCon"),u=e.$dialog.find(".copyLinkCon"),g=e.$dialog.find(".sendToOther"),h=e.$dialog.find(".shareAttachmentFooter"),m=f.hasClass("inited"),x=g.hasClass("inited");e.options.node.visibleType=c;function L(){x?(g.removeClass("hide"),h.removeClass("hide")):m?f.removeClass("hide"):e.options.attachmentType===l.G0.WORKSHEETROW?e.activeSendToOther(l.Bw.CHAT):e.initSelectTargetList(),u.hasClass("inited")?u.removeClass("hide"):e.initCopyLinkBtn(),i.addClass("hide")}e.checkClose(c)?(x?(g.addClass("hide"),h.addClass("hide")):f.addClass("hide"),e.$dialog.find(".copyLinkCon").addClass("hide"),i.removeClass("hide")):e.options.attachmentType===l.G0.WORKSHEET?(u.removeClass("inited"),e.updateWorkshhetShareUrl(1,L)):L()})}}),document.getElementById("selectSharePermissionBox")),e.options.node.canChangeSharable||e.$dialog.find(".selectSharePermission").addClass("noPermission").on("click",function(d){alert(_l("\u65E0\u6743\u4FEE\u6539\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),3)})},updateShareType:function(e,t){var i=this,o=void 0;switch(i.options.attachmentType){case l.G0.KC:o=i.updateVisibleType.bind(i);break;case l.G0.WORKSHEET:o=i.updateWorkSheetVisibleType.bind(i);break;case l.G0.WORKSHEETROW:o=i.updateWorksheetRowShareRange.bind(i);break;default:o=function(){}}o(e,t)},initCopyLinkBtn:function(){var e=this;e.$dialog.find("#linkContent").val(e.options.node.shareUrl),e.$dialog.find(".copyLinkCon").removeClass("hide").addClass("inited"),e.$dialog.find("#copyLinkBtn").off().on("click",function(){J()(e.options.node.shareUrl),alert(_l("\u5DF2\u7ECF\u590D\u5236\u5230\u7C98\u8D34\u677F\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528Ctrl+V \u8D34\u5230\u9700\u8981\u7684\u5730\u65B9"))})},initSelectSendTo:function(e,t){var i=this;window.selectSendTo=new W({el:"#selectSendTo",type:e},t)},activeSendToOther:function(e){var t=this,i=t.$dialog.find(".sendToOther"),o=t.$dialog.find(".sendToContent");t.sendToTargetType=e,t.options.node.allowDown=!0;var n;switch(t.$dialog.find("#shareDesc").is(":visible")&&(n=t.$dialog.find("#shareDesc").val().trim()),delete t.selectedChat,delete t.selectedTask,[l.Bw.FEED,l.Bw.CALENDAR].indexOf(e)<0&&t.initSendToTarget(),t.options.attachmentType!==l.G0.KC&&t.dialogEle.$canDownloadSwitch.length&&(t.options.node.allowDown=t.dialogEle.$canDownloadSwitch.prop("checked")),t.dialogEle.$canDownloadSwitch.attr("disabled",!1),e){case l.Bw.CHAT:{t.dialogEle.$canDownloadSwitch.attr("disabled",!0),t.dialogEle.$canDownloadSwitch.prop("checked")===!1&&(alert(_l("\u5206\u4EAB\u5230\u6D88\u606F\u6587\u4EF6\u4E0D\u53EF\u8BBE\u4E3A\u4E0D\u5141\u8BB8\u4E0B\u8F7D\uFF0C\u5DF2\u66F4\u6539\u4E3A\u5141\u8BB8\u4E0B\u8F7D"),4),t.dialogEle.$canDownloadSwitch.prop("checked",!0)),t.showFooter(),i.addClass("inited").removeClass("hide"),o.empty().append($('<input type="hidden" id="selectSendTo">')),o.show(),t.$dialog.find(".selectTargetCon").addClass("hide"),t.initSelectSendTo(l.Bw.CHAT,function(d){t.selectedChat=d});break}case l.Bw.FEED:{o.empty();var a={callback:function(v){$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}};t.options.attachmentType===l.G0.COMMON?(t.newFileName&&(t.options.node.originalFileName=t.newFileName),a.defaultAttachmentData=[t.options.node]):t.options.attachmentType===l.G0.KC?a.defaultKcAttachmentData=[t.options.node]:t.options.attachmentType===l.G0.QINIU&&(t.options.node.originalFileName=t.options.name,t.options.node.fileSize=t.options.size,t.newFileName&&(t.options.node.originalFileName=t.newFileName),a.defaultAttachmentData=[t.options.node]),n&&(a.postMsg=n),ue(a);break}case l.Bw.TASK:{t.showFooter(),i.addClass("inited").removeClass("hide"),o.empty().append($('<input type="hidden" id="selectSendTo">')),o.show(),t.$dialog.find(".selectTargetCon").addClass("hide"),t.initSelectSendTo(l.Bw.TASK,function(d){t.selectedTask=d}),console.log("TASK");break}case l.Bw.QR:{t.sendToMobile(e),console.log("QR");break}case l.Bw.CALENDAR:{o.empty();var s={callback:function(v){v&&$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}};t.options.attachmentType===l.G0.COMMON?(t.newFileName&&(t.options.node.originalFileName=t.newFileName),s.defaultAttachmentData=[t.options.node]):t.options.attachmentType===l.G0.KC?s.defaultKcAttachmentData=[t.options.node]:t.options.attachmentType===l.G0.QINIU&&(t.options.node.originalFileName=t.options.name,t.options.node.fileSize=t.options.size,t.newFileName&&(t.options.node.originalFileName=t.newFileName),s.defaultAttachmentData=[t.options.node]),n&&(s.Message=n),(0,me.Z)(s);break}case l.Bw.KC:{if(t.options.attachmentType===l.G0.KC&&!t.options.node.canDownload){alert(_l("\u60A8\u6743\u9650\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u4E0B\u8F7D\u6216\u4FDD\u5B58\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6216\u6587\u4EF6\u4E0A\u4F20\u8005"),3);return}t.showFooter(),i.addClass("inited").removeClass("hide"),o.empty(),t.$dialog.find(".selectTargetCon").addClass("hide"),o.html('<span class="kcPath ThemeColor3">'+_l("\u8BF7\u9009\u62E9\u6587\u4EF6\u5939")+"</span>"),o.on("click",".kcPath",function(){t.selectKcPath(function(d,v){t.kcPath=d,o.html('<span class="kcPath ThemeColor3">'+v+"</span>")})}),o.find(".kcPath").trigger("click");break}default:break}},showFooter:function(){var e=this,t=e.$dialog.find(".shareAttachmentFooter");t.removeClass("hide")},selectKcPath:function(e){(0,Ie.default)({dialogTitle:_l("\u9009\u62E9\u8DEF\u5F84"),isFolderNode:1,reRootName:!0}).then(function(t){var i=t.type===3?t.rootName||"":t.node.name;if(i+="/",t.type==3){var o=t.node.position,n=o.split("/"),a=!1;n.forEach(function(s,d){if(d>1)if(d>n.length-4){var v=s;i+=v+"/"}else a||(i+=".../",a=!0)})}i=i.split("/").map(function(s){return'<span class="pathStr ellipsis">'+s+"</span>"}).join("/"),e(t,i)}).catch(function(){})},sendToMobile:function(e){var t=this,i=t.options,o=i.attachmentType,n={},a=i.ext.replace(/^\./,"");switch(n.fullName=i.name+(a?"."+a:""),o){case l.G0.COMMON:n.fileID=i.id;break;case l.G0.KC:n.shareUrl=i.node.shareUrl+"#",i.node.canChangeEditable&&t.options.node.visibleType!==l.lo.PUBLIC&&N.Z.updateNode({id:i.node.id,visibleType:l.lo.PUBLIC}).then(function(s){alert(_l("\u5DF2\u5C06\u94FE\u63A5\u8BBE\u4E3A\u201C\u4EFB\u4F55\u4EBA\u53EF\u9884\u89C8\u201D\uFF0C\u53EF\u76F4\u63A5\u6253\u5F00"),4),t.options.node.visibleType=l.lo.PUBLIC,t.$dialog.find("#selectSharePermission").data().select.setValue(l.lo.PUBLIC,_l("\u5141\u8BB8\u4EFB\u4F55\u4EBA\u67E5\u770B")),t.callbacks.performUpdateItem&&t.callbacks.performUpdateItem(parseInt(l.lo.PUBLIC,10))});break;case l.G0.QINIU:n.qiniuPath=i.qiniuPath,n.name=i.name,n.ext=i.ext.replace(/^\./,""),n.size=i.size;break;case l.G0.WORKSHEET:n.name=i.name,n.shareUrl=i.node.shareUrl;break;case l.G0.WORKSHEETROW:n.name=i.name,n.shareUrl=i.node.shareUrl;break;default:break}t.sendToMobileDialog=Me({attachmentType:o,sendToType:e,file:n})},share:function(){var e=this,t=e.options.node,i=!0,o=e.options.attachmentType,n=e.$dialog.find("#shareDesc").val().trim(),a={},s;switch(e.options.attachmentType!==l.G0.KC&&e.dialogEle.$canDownloadSwitch.length&&(i=e.dialogEle.$canDownloadSwitch.prop("checked"),t.allowDown=e.dialogEle.$canDownloadSwitch.prop("checked")),e.sendToTargetType){case l.Bw.CHAT:{if(!e.selectedChat){alert(_l("\u8BF7\u9009\u62E9\u8981\u53D1\u9001\u5230\u7684\u804A\u5929"),3);return}var d={PERSON:1,GROUP:2},v=(e.selectedChat||{}).type,c;if(o===l.G0.COMMON){e.newFileName&&(t.originalFileName=e.newFileName);var f=t.filePath+t.fileName+t.fileExt;s=[{fileName:t.originalFileName+t.fileExt,serverName:t.serverName,key:f,fileSize:t.fileSize,fileID:t.fileID}],a={files:s,message:n,toAccountId:"",toGroupId:""},a[v===d.PERSON?"toAccountId":"toGroupId"]=(e.selectedChat||{}).value,c=y.Z.sendFileToChat(a)}else if(o===l.G0.KC){var u=[{entityId:t.id,cardType:t.type===1?l.Jx.KCFOLDER:l.Jx.KCFILE,title:t.name+(t.ext?"."+t.ext:""),url:t.type===1?t.shareUrl:void 0}];a={cards:u,message:n,toAccountId:"",toGroupId:""},a[v===d.PERSON?"toAccountId":"toGroupId"]=(e.selectedChat||{}).value,c=y.Z.sendCardToChat(a)}else if(o===l.G0.QINIU){var g=e.options.name;e.newFileName&&(g=e.newFileName),s=[{fileName:g+t.fileExt,serverName:t.serverName,key:t.key,fileSize:t.fileSize}],a={files:s,message:n,toAccountId:"",toGroupId:""},a[v===d.PERSON?"toAccountId":"toGroupId"]=(e.selectedChat||{}).value,c=y.Z.sendFileToChat(a)}else(o===l.G0.WORKSHEET||o===l.G0.WORKSHEETROW)&&(a={cards:o===l.G0.WORKSHEET?[{entityId:e.options.id,extra:{appId:e.options.appId,viewId:e.options.viewId},cardType:l.Jx.WORKSHEET,title:e.options.name,url:t.shareUrl}]:[{entityId:e.options.id,cardType:l.Jx.WORKSHEETROW,title:e.options.name,extra:{rowId:e.options.rowId,viewId:e.options.viewId,appId:e.options.appId}}],message:n,toAccountId:"",toGroupId:""},a[v===d.PERSON?"toAccountId":"toGroupId"]=(e.selectedChat||{}).value,c=y.Z.sendCardToChat(a));c.then(function(m){alert(_l("\u53D1\u9001\u6210\u529F")),$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}).catch(function(m){alert(_l("\u53D1\u9001\u5931\u8D25"),m)});break}case l.Bw.FEED:{e.activeSendToOther(l.Bw.FEED);break}case l.Bw.TASK:{e.selectedTask||alert(_l("\u8BF7\u9009\u62E9\u8981\u53D1\u9001\u5230\u7684\u4EFB\u52A1"),3),a={sourceId:e.selectedTask.taskID,appId:md.global.APPInfo.taskAppID,sourceType:1,message:n||(o===l.G0.KC?"\u5206\u4EAB\u4E86\u77E5\u8BC6\u4E0B\u7684\u6587\u4EF6":"\u6DFB\u52A0\u4E86\u6587\u4EF6\uFF1A"),attachments:U()([])},o===l.G0.COMMON?(e.newFileName&&(t.originalFileName=e.newFileName),a.attachments=U()([t])):o===l.G0.KC?a.knowledgeAtts=U()([{refId:t.id,fileExt:"."+t.ext,fileSize:t.size,originalFileName:t.name,viewUrl:File.isPicture("."+t.ext)?t.viewUrl:null,type:t.type===1?1:void 0}]):o===l.G0.QINIU&&(t.originalFileName=e.options.name,e.newFileName&&(t.originalFileName=e.newFileName),a.attachments=U()([t])),Te.Z.addDiscussion(a).then(function(m){if(m.error){alert(_l("\u5206\u4EAB\u5931\u8D25"),2);return}alert(_l("\u5206\u4EAB\u6210\u529F")),$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}).catch(function(m){alert(_l("\u5206\u4EAB\u5931\u8D25"),m)});break}case l.Bw.CALENDAR:{e.activeSendToOther(l.Bw.CALENDAR);break}case l.Bw.KC:{if(!e.kcPath){alert(_l("\u8BF7\u5148\u9009\u62E9\u6587\u4EF6\u5939"),3);return}var h={};h.des=n,h.allowDown=i,o===l.G0.COMMON?(h.fileID=e.options.id,e.newFileName&&(h.originalFileName=e.newFileName)):o===l.G0.KC?h.nodeId=e.options.id:o===l.G0.QINIU&&(h.name=e.options.name+(e.options.ext[0]==="."?e.options.ext:"."+e.options.ext),h.filePath=e.options.qiniuPath,e.newFileName&&(h.name=e.newFileName)),(0,ge.default)(o,h).save(e.kcPath).then(function(m){$(".shareAttachmentDialog")[0]&&$(".shareAttachmentDialog").parent().remove()}).catch(function(m){alert(m||_l("\u4FDD\u5B58\u5931\u8D25"),3)});break}default:break}},formatQiniuPath:function(e){var t=this,i=t.parseUrl(e),o=i.pathname.slice(1),n=o.slice(o.lastIndexOf("/")+1);return{serverName:i.origin+"/",key:o,fileName:File.GetName(n),fileExt:"."+File.GetExt(n),fileSize:t.options.node.size,filePath:o.replace(n,"")}},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol,hostname:t.hostname,port:t.port,pathname:("/"+t.pathname).replace("//","/"),search:t.search,hash:t.hash,origin:t.origin}},previewFile:function(){var e=this;e.dialogEle.$fileIcon=e.$dialog.find(".fileIcon"),e.dialogEle.$fileSize=e.$dialog.find(".fileSize"),e.dialogEle.$thumbnailCon=e.$dialog.find(".thumbnailCon"),e.dialogEle.$thumbnail=e.$dialog.find(".thumbnail"),File.isPicture("."+e.file.ext)&&e.file.imgSrc?e.loadPicture():e.loadDocIcon()},loadDocIcon:function(){var e=this,t=e.options.isKcFolder?e.options.node&&e.options.node.isOpenShare?"fileIcon-folderShared":"fileIcon-folder":(0,R.kQ)("."+e.file.ext);e.options.attachmentType===l.G0.WORKSHEET?t="worksheetIcon":e.options.attachmentType===l.G0.WORKSHEETROW&&(t="worksheetRecordIcon"),e.dialogEle.$fileIcon.removeClass().addClass("fileIcon "+t),e.dialogEle.$fileSize.text((0,R.sS)(e.file.size).replace(/ /g,""))},loadPicture:function(){var e=this;e.dialogEle.$thumbnailCon.removeClass("hide");var t=new FileReader,i=document.createElement("img");i.addEventListener("error",function(){e.dialogEle.$thumbnail.hide(),e.loadDocIcon()},!1),i.src=e.file.imgSrc,e.dialogEle.$thumbnail.append(i).show()},getFullFileName:function(){var e=this;return e.dialogEle.$fileName.val()+(e.file.ext?"."+e.file.ext:"")},validate:function(e){var t=/[\/\\\:\*\?\"\<\>\|]/g,i=t.test(e);return i?(alert(_l("\u540D\u79F0\u4E0D\u80FD\u5305\u542B\u4EE5\u4E0B\u5B57\u7B26\uFF1A")+'\\ / : * ? " < > |',3),!1):!0},updateVisibleType:function(e,t){var i=this;e=parseInt(e,10),N.Z.updateNode({id:i.options.id,visibleType:e}).then(function(o){i.options.isKcFolder&&(i.options.node.visibleType=e,i.options.node.isOpenShare=e===l.lo.PUBLIC,i.loadDocIcon()),alert(_l("\u4FEE\u6539\u6210\u529F")),t&&t(parseInt(e,10)),i.callbacks.performUpdateItem&&i.callbacks.performUpdateItem(parseInt(e,10))}).catch(function(o){alert(_l("\u4FEE\u6539\u5931\u8D25"),3)})},updateWorkSheetVisibleType:function(e,t){var i=this;e=parseInt(e,10),B.Z.updateWorksheetShareRange({worksheetId:i.options.id,viewId:i.options.viewId,shareRange:e}).then(function(o){alert(_l("\u4FEE\u6539\u6210\u529F")),t(e),i.callbacks.updateView&&i.callbacks.updateView({shareRange:e})}).catch(function(o){alert(_l("\u4FEE\u6539\u5931\u8D25"),3)})},updateWorksheetRowShareRange:function(e,t){var i=this;e=parseInt(e,10),B.Z.updateWorksheetRowShareRange({worksheetId:i.options.id,rowId:i.options.rowId,shareRange:e}).then(function(o){alert(_l("\u4FEE\u6539\u6210\u529F")),t(e),i.callbacks.updateShareRangeOfRecord&&i.callbacks.updateShareRangeOfRecord(e)}).catch(function(o){alert(_l("\u4FEE\u6539\u5931\u8D25"),3)})},cutString:function(e,t,i){return e.length>t&&(e=e.substr(0,t)+(i||"...")),e},getExt:function(e){return e?e[0]==="."?e.slice(1):e:""}};function Ne(r,e){return new Q(r,e)}}}]);
