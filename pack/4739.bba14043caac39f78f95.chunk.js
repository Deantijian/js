"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4739],{54739:(x,h,a)=>{a.r(h),a.d(h,{default:()=>Z});var H=a(10524),S=a(31059),I=a(33867),y=a(54208),C=a(85105),P=a.n(C),B=a(99663),D=a(22600),V=a(49135),w=a(93196),e=a(67294),F=a(21),i=a(64712),L=a(93967),v=a.n(L),u=a(48025),U=a(28829),k=a(96486),p=a.n(k),R=a(30381),f=a.n(R),E,G=null,Z=(0,F.Z)(E=function(j){(0,w.default)(d,j);function d(){(0,B.default)(this,d);var s=(0,V.default)(this,(d.__proto__||P()(d)).call(this));return i.Z.setPageTitle(_l("\u5347\u7EA7\u4EA7\u54C1")),s.state={step:1,versionId:null,versionName:"",versionData:{},versionPrice:{},totalPrice:0,needSalesAssistance:!0,isPay:!1,allowUpgradeVersion:!0,loading:!0},s}return(0,D.default)(d,[{key:"componentDidMount",value:function(){var n=this;U.Z.getProjectLicenseSupportInfo({projectId:i.Z.projectId}).then(function(t){t.allowUpgradeVersion?n.getVersionData():(n.setState({allowUpgradeVersion:t.allowUpgradeVersion}),alert(_l("\u7248\u672C\u4E0D\u9700\u8981\u5347\u7EA7"),3,1e3))})}},{key:"getVersionData",value:function(){var n=this;u.Z.getUpgradeVersionData({projectId:i.Z.projectId}).then(function(t){if(t){var r=p().get(n.props,"match.params")||{},l=r.vertionType;if(t.versions&&p().isArray(t.versions)&&t.versions.length>0){var c=l&&p().includes(t.versions.map(function(m){return m.versionIdV2}),l)?l:t.versions[0].versionIdV2;n.setState({versionData:t,versionId:c,versionName:t.versions[0].name},function(){n.getUpgradeOrderPrice()})}}else alert(_l("\u83B7\u53D6\u5347\u7EA7\u7248\u672C\u5931\u8D25"),2,1e3)})}},{key:"getUpgradeOrderPrice",value:function(){var n=this;if(!this.state.versionId)return!1;u.Z.getUpgradeVersionOrderPrice({projectId:i.Z.projectId,versionId:this.state.versionId}).then(function(t){t&&n.setState({totalPrice:t.totalPrice,versionPrice:t.versionPrice,loading:!1})})}},{key:"handleBack",value:function(){if(!this.props.history.go(-1)){location.href="/admin/home/"+i.Z.projectId;return}this.props.history.go(-1)}},{key:"setStep",value:function(n){this.setState({step:n})}},{key:"handleCheckBox",value:function(n){this.setState({needSalesAssistance:n.target.checked})}},{key:"handleChange",value:function(n){var t=this;this.setState({versionName:n.name,versionId:n.versionIdV2},function(){t.getUpgradeOrderPrice()})}},{key:"handlePay",value:function(){var n=this;this.setState({isPay:!0});var t=this.state,r=t.versionId,l=t.needSalesAssistance;u.Z.addUpgradeVersionOrder({projectId:i.Z.projectId,versionId:r,needSalesAssistance:l}).then(function(c){c?alert(_l("\u8BA2\u5355\u5DF2\u521B\u5EFA\u6210\u529F\uFF0C\u6B63\u5728\u8F6C\u5230\u4ED8\u6B3E\u9875..."),1,500,function(){window.location.href="/admin/waitingpay/"+i.Z.projectId+"/"+c.orderId}):(n.setState({isPay:!1}),alert(_l("\u64CD\u4F5C\u5931\u8D25"),2))})}},{key:"render",value:function(){var n=this,t=this.state,r=t.step,l=t.totalPrice,c=t.versionName,m=t.versionData,T=t.versionPrice,b=t.needSalesAssistance,A=t.isPay,Y=t.versionId,M=t.allowUpgradeVersion,O=t.loading,N=m.unLimited?_l("\u4E0D\u9650\u4EBA\u6570"):_l("%0 \u4EBA",m.projectUserLimitNumber),g=m.versions||[];if(O)return e.createElement(y.Z,null);if(M)return e.createElement("div",{className:"warpCenter upgradeServiceContent"},e.createElement("div",{className:"valueAddServerHeader"},e.createElement(I.Z,{icon:"backspace",className:"Hand mRight18 TxtMiddle Font24",onClick:function(){return n.handleBack()}}),e.createElement("span",{className:"Font17 Bold"},_l("\u5347\u7EA7\u7248\u672C"))),e.createElement("div",{className:"warpOneStep"},e.createElement("div",{className:v()("stepTitle",{color_bd:r!==1})},e.createElement("div",{className:"stepNum"},e.createElement("span",{className:"Bold Font12"},"1")),e.createElement("span",null,_l("\u9009\u62E9\u7248\u672C"))),e.createElement("div",{className:"stepContent"},r===1?e.createElement("div",{className:"infoEdit"},e.createElement("ul",{className:"viewRow productList"},g.length&&g.map(function(o){return e.createElement("li",{key:o.versionIdV2,onClick:function(){return n.handleChange(o)},className:v()(Y===o.versionIdV2?"selectProduct":"")},e.createElement("span",{className:"color_b Font15 Bold"},o.name),e.createElement("span",{className:"color_9e mTop12"},_l("%0 rmb / \u4EBA / \u5E74",T[parseInt(o.versionIdV2)])))})),e.createElement("div",null,e.createElement("div",{className:"oneStepLeft"},_l("\u8D2D\u4E70\u4EBA\u6570:")),e.createElement("span",{className:"color_b"},N)),e.createElement("div",{className:"mTop8 mBottom8"},e.createElement("div",{className:"oneStepLeft"},_l("\u5230\u671F\u65F6\u95F4\uFF1A")),e.createElement("span",{className:"color_b"},f()(m.currentLicenseEndDate).format("YYYY\u5E74MM\u6708DD\u65E5"))),e.createElement("div",null,e.createElement("div",{className:"oneStepLeft"},_l("\u603B\u8BA1\u91D1\u989D\uFF1A")),e.createElement("span",{className:"Font20 color_b"},"\uFFE5"),e.createElement("span",{className:"Font20 color_b Bold"},l)),e.createElement("div",{className:"pTop30"},e.createElement("button",{type:"button",className:"ming Button Button--primary nextBtn",onClick:function(){return n.setStep(2)}},_l("\u4E0B\u4E00\u6B65")))):e.createElement("div",{className:"infoShow"},e.createElement("div",{className:"infoShowRow mTop24"},e.createElement("div",{className:"infoShowLabel"},_l("\u5DF2\u9009\u62E9")),e.createElement("div",{className:"infoShowResult"},c)),e.createElement("div",{className:"infoShowRow"},e.createElement("div",{className:"infoShowLabel"},_l("\u8D2D\u4E70\u4EBA\u6570:")),e.createElement("div",{className:"infoShowResult"},N)),e.createElement("div",{className:"infoShowRow"},e.createElement("div",{className:"infoShowLabel"},_l("\u5230\u671F\u65F6\u95F4:")),e.createElement("div",{className:"infoShowResult"},f()(m.currentLicenseEndDate).format("YYYY\u5E74MM\u6708DD\u65E5"))),e.createElement("div",{className:"infoShowRow"},e.createElement("span",{className:"infoShowLabel"},_l("\u603B\u8BA1\u91D1\u989D\uFF1A")),e.createElement("span",{className:"infoShowResult Font20"},"\uFFE5",l)),e.createElement("button",{type:"button",className:"ming Button Button--link ThemeColor3 pAll0 mTop24",onClick:function(){return n.setStep(1)}},_l("\u4FEE\u6539"))))),e.createElement("div",{className:"stepDiviceLine"}),e.createElement("div",{className:"warpTowStep"},e.createElement("div",{className:v()("stepTitle",{color_bd:r!==2})},e.createElement("div",{className:"stepNum"},e.createElement("span",{className:"Bold Font12"},"2")),e.createElement("span",null,_l("\u751F\u6210\u8BA2\u5355"))),e.createElement("div",{className:v()("stepContent",{Hidden:r!==2})},e.createElement("div",{className:"mTop25"},e.createElement("span",{className:"Font13 mRight24 Gray_9"},_l("\u5DF2\u9009\u62E9")),e.createElement("span",{className:"color_b"},c)),e.createElement("div",{className:"mTop15"},e.createElement("span",{className:"mRight8 Gray_9"},_l("\u603B\u8BA1\u91D1\u989D")),e.createElement("span",{className:"Font24 Bold color_b"},"\uFFE5",l)),e.createElement("div",{className:"pTop40"},e.createElement("button",{type:"button",disabled:A,className:"ming Button Button--primary nextBtn",onClick:function(){return n.handlePay()}},_l("\u786E\u8BA4\u4E0B\u5355"))),e.createElement("div",{className:"warpNeedHelp"},e.createElement(S.default,{onChange:this.handleCheckBox.bind(this),checked:b},_l("\u6211\u5E0C\u671B\u5F97\u5230\u9500\u552E\u4EE3\u8868\u7684\u534F\u52A9"))))))}}]),d}(e.Component))||E}}]);
