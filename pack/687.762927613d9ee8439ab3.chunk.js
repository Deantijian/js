"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[687],{40687:(ue,H,d)=>{d.r(H),d.d(H,{default:()=>de});var E=d(70801),B=d(54208),D=d(12424),G=d(46593),F=d.n(G),U=d(85105),I=d.n(U),y=d(99663),N=d(22600),k=d(49135),b=d(93196),e=d(67294),p=d(59911),w=d(88239),O=d(93967),u=d.n(O),x=d(86515),M=d(36964),J=d.n(M),W=d(72557),L=d(15577),V=d(54895),R=d(36021),z=d(96486),j=d.n(z),Y=function(f){(0,b.default)(i,f);function i(){(0,y.default)(this,i);var r=(0,k.default)(this,(i.__proto__||I()(i)).call(this));return r.state={password:"",disabled:!1},r}return(0,N.default)(i,[{key:"handleSubmit",value:function(){var t=this;this.setState({disabled:!0});var a=this.props,n=a.projectId,l=a.companyName,o=j().throttle(function(s){s.ret===0&&p.Z.validateExitProject({password:(0,L.HI)(t.state.password),projectId:n,ticket:s.ticket,randStr:s.randstr,captchaType:md.global.getCaptchaType()}).then(function(c){c===2?(alert(_l("\u5BC6\u7801\u9519\u8BEF"),3),$("inputBox").val("").focus()):c===4?E.Z.confirm({title:e.createElement("spam",{className:"Font15 Bold"},_l("\u60A8\u662F\u7EC4\u7EC7\u3010%0\u3011\u8D85\u7EA7\u7BA1\u7406\u5458",l)),description:e.createElement("span",{className:"Font13 Gray"},_l("\u8BF7\u5148\u6CE8\u9500\u7EC4\u7EC7\u6216\u4EA4\u63A5\u540E\u65B9\u53EF\u6CE8\u9500\u3002")),okText:_l("\u524D\u5F80\u6CE8\u9500"),showCancel:!1,onOk:function(){(0,R.T8)("/admin/sysinfo/"+n)}}):(t.props.closeDialog(),t.props.transferAdminProject(n,l,t.state.password,c))}).finally(function(){t.setState({disabled:!1})})},1e4,{leading:!0});md.global.getCaptchaType()===1?new V.Z(o):new TencentCaptcha(md.global.Config.CaptchaAppId.toString(),o).show()}},{key:"render",value:function(){var t=this,a=this.state.disabled;return e.createElement("div",{className:"pTop15 pBottom15 TxtLeft"},e.createElement("div",{className:"mBottom15"},e.createElement(W.Z,{onChange:function(l){var o=l.password;return t.setState({password:o})}})),e.createElement("div",null,e.createElement("button",{type:"button",disabled:a,className:u()("btn ming Button Button--primary w100",{"Button--disabled":a}),onClick:function(){a||t.handleSubmit()}},_l("\u786E\u8BA4"))))}}]),i}(e.Component),Z=d(75809),K=function(f){(0,b.default)(i,f);function i(r){(0,y.default)(this,i);var t=(0,k.default)(this,(i.__proto__||I()(i)).call(this,r));return t.toLogout=function(){var a=t.props,n=a.projectId,l=a.companyName;E.Z.confirm({title:e.createElement("spam",{className:"Font15 Bold"},_l("\u60A8\u662F\u7EC4\u7EC7\u3010%0\u3011\u8D85\u7EA7\u7BA1\u7406\u5458",l)),description:e.createElement("span",{className:"Font13 Gray"},_l("\u8BF7\u5148\u6CE8\u9500\u7EC4\u7EC7\u6216\u4EA4\u63A5\u540E\u65B9\u53EF\u6CE8\u9500\u3002")),okText:_l("\u524D\u5F80\u6CE8\u9500"),showCancel:!1,onOk:function(){navigateTo("/admin/sysinfo/"+n)}})},t.state={userInfo:{}},t}return(0,N.default)(i,[{key:"handleSelct",value:function(){var t=this;(0,Z.Z)({title:_l("\u6307\u5B9A\u7BA1\u7406\u5458"),zIndex:100,showMoreInvite:!1,SelectUserSettings:{projectId:this.props.projectId,filterAll:!0,filterFriend:!0,filterOtherProject:!0,filterAccountIds:[md.global.Account.accountId],unique:!0,callback:function(n){t.setState({userInfo:n[0]})}}})}},{key:"handleExit",value:function(){var t=this,a=this.state.userInfo.accountId;if(this.props.needTransfer&&!a){alert("\u8BF7\u6307\u5B9A\u6210\u5458");return}var n=$("#submitBtn");n.removeClass("Button--primary").addClass("Button--disabled").prop("disabled",!0),p.Z.exitProject({projectId:this.props.projectId,newAdminAccountId:a}).then(function(l){switch(l){case 1:alert(_l("\u9000\u51FA\u6210\u529F")),t.props.closeDialog(),t.props.getData();break;case 3:t.props.transferAdminProject(t.props.projectId,t.props.companyName,thi.props.password,l);break;case 4:t.toLogout();break;case 2:default:alert(_l("\u64CD\u4F5C\u5931\u8D25"),3);break}}).finally(function(){n.addClass("Button--primary").removeClass("Button--disabled").prop("disabled",!1)})}},{key:"render",value:function(){var t=this,a=this.props,n=a.needTransfer,l=a.companyName,o=this.state.userInfo;return e.createElement(e.Fragment,null,n?e.createElement("div",{className:"mTop15 mBottom20 borderBox"},e.createElement("p",null,_l("\u4F60\u662F\u8BE5\u7EC4\u7EC7\u552F\u4E00\u7BA1\u7406\u5458\uFF0C\u9700\u8981\u5148\u79FB\u4EA4\u7BA1\u7406\u8EAB\u4EFD\u518D\u9000\u51FA")),e.createElement("p",null,_l("\u9000\u51FA\u540E\uFF0C\u7BA1\u7406\u5458\u53EF\u4EE5\u5728\u540E\u53F0\u4EA4\u63A5\u6216\u5206\u914D\u60A8\u8D1F\u8D23\u7684\u5269\u4F59\u5DE5\u4F5C")),e.createElement("div",null,e.createElement("span",{className:"icon-addapplication Font32 ThemeColor3 ThemeHoverColor2 TxtMiddle Hand",onClick:function(){return t.handleSelct()}}),o.accountId?e.createElement("span",{className:"userTag TxtMiddle"},e.createElement("span",{className:"user","data-accountid":o.accountId},e.createElement("img",{src:o.avatar}),e.createElement("span",{className:"userfullname"},(0,L.u1)(o.fullname)))):e.createElement("span",{className:"userTag TxtMiddle"},_l("\u672A\u6307\u5B9A"))),e.createElement("button",{type:"button",className:"ming Button Button--primary Button--medium w100 exitProject",onClick:function(){return t.handleExit()}},_l("\u786E\u5B9A"))):e.createElement("div",{className:"mTop15 mBottom20 borderBox"},e.createElement("p",null,_l("\u4F60\u786E\u8BA4\u8981\u9000\u51FA\uFF1A%0 ?",l)),e.createElement("p",null,_l("\u9000\u51FA\u540E\uFF0C\u7BA1\u7406\u5458\u53EF\u4EE5\u5728\u540E\u53F0\u4EA4\u63A5\u6216\u5206\u914D\u60A8\u8D1F\u8D23\u7684\u5269\u4F59\u5DE5\u4F5C")),e.createElement("button",{type:"button",id:"submitBtn",className:"ming Button Button--primary Button--medium w100 exitProject",onClick:function(){return t.handleExit()}},_l("\u786E\u5B9A"))))}}]),i}(e.Component),me=d(67272),Q=d(51024),X=[{label:_l("\u59D3\u540D"),key:"fullname"},{label:_l("\u90E8\u95E8"),key:"departmentInfos"},{label:_l("\u804C\u4F4D"),key:"jobInfos"},{label:_l("\u5DE5\u4F5C\u5730\u70B9"),key:"workSite"},{label:_l("\u5DE5\u53F7"),key:"jobNumber"}],q=function(f){(0,b.default)(i,f);function i(r){(0,y.default)(this,i);var t=(0,k.default)(this,(i.__proto__||I()(i)).call(this,r));return t.state={contactPhone:t.props.userInfo.contactPhone},t}return(0,N.default)(i,[{key:"renderResult",value:function(t){var a=this.props.userInfo,n=a[t.key];switch(t.key){case"departmentInfos":return n.length?this.getItems(n,"departmentName"):_l("\u672A\u586B\u5199");case"jobInfos":return n.length?this.getItems(n,"jobName"):_l("\u672A\u586B\u5199");default:return n||_l("\u672A\u586B\u5199")}}},{key:"getItems",value:function(t,a){var n=t.map(function(l){return l[a]});return n.join(" ; ")}},{key:"handleSubmit",value:function(){var t=this,a=this.props,n=a.userInfo,l=a.updateData,o=l===void 0?function(){}:l;if(!this.state.contactPhone){alert(_l("\u5DE5\u4F5C\u7535\u8BDD\u4E0D\u80FD\u4E3A\u7A7A"),2);return}p.Z.editUserCardContactPhone({projectId:this.props.userInfo.projectId,contactPhone:this.state.contactPhone}).then(function(s){s?(t.props.closeDialog(),alert(_l("\u4FDD\u5B58\u6210\u529F")),o((0,w.default)({},n,{contactPhone:t.state.contactPhone}))):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}},{key:"render",value:function(){var t=this,a=this.state.contactPhone;return e.createElement("div",{className:"editEnterpriseCardInfo clearfix"},e.createElement("div",{className:"Font17 Bold Gray"},_l("\u7F16\u8F91\u540D\u7247")),e.createElement("div",{className:"Gray_9e mTop6"},_l("\u540D\u7247\u662F\u60A8\u5728\u8BE5\u7EC4\u7EC7\u4E0B\u7684\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u53EA\u5728\u672C\u7EC4\u7EC7\u4E2D\u5C55\u793A\u3002")),e.createElement("div",{className:"mTop24"},X.map(function(n){return e.createElement(e.Fragment,null,e.createElement("div",{className:"Gray_75"},n.label),e.createElement("div",{className:"mTop6 mBottom16 Gray"},t.renderResult(n)))}),e.createElement("div",{className:"Gray_75"},_l("\u5DE5\u4F5C\u7535\u8BDD")),e.createElement(Q.default,{className:"mTop6",placeholder:_l("\u5DE5\u4F5C\u7535\u8BDD"),value:a,onChange:function(l){return t.setState({contactPhone:l.target.value})}})),e.createElement("div",{className:"mTop32 Right"},e.createElement("span",{className:"Font14 Gray_9e mRight32 Hover_49 Hand",onClick:function(){return t.props.closeDialog()}},_l("\u53D6\u6D88")),e.createElement("button",{type:"button",className:"ming Button Button--primary submitBtn",onClick:function(){return t.handleSubmit()}},_l("\u786E\u8BA4"))))}}]),i}(e.Component),ee=d(16921),te=[{icon:"icon-edit_17",label:_l("\u7F16\u8F91\u7EC4\u7EC7\u540D\u7247"),click:"handleEdit",key:"editCard"},{icon:"icon-enterprise_tool",label:_l("\u7EC4\u7EC7\u7BA1\u7406"),click:"handleGoAdmin",key:"manage"},{icon:"icon-manage",label:_l("\u6211\u7684\u6C47\u62A5\u5173\u7CFB"),click:"handleRelation",key:"reportRelation"},{icon:"icon-exit",label:_l("\u9000\u51FA\u7EC4\u7EC7"),click:"handleExit",key:"exit"}],ae=function(f){(0,b.default)(i,f);function i(r){(0,y.default)(this,i);var t=(0,k.default)(this,(i.__proto__||I()(i)).call(this,r));return t.transferAdminProject=function(a,n,l,o){E.Z.confirm({dialogClasses:"dialogBoxTransferAdminProject",title:_l("\u63D0\u793A"),noFooter:!0,children:e.createElement(K,{needTransfer:o===3,companyName:n,projectId:a,password:l,closeDialog:function(){$(".dialogBoxTransferAdminProject.mui-dialog-container").parent().remove()},transferAdminProject:t.transferAdminProject,getData:function(){return t.props.getData()}})})},t.cancelApplication=function(a){E.Z.confirm({title:_l("\u53D6\u6D88\u7533\u8BF7"),onOk:function(){p.Z.revokedJoinProject({projectId:a.projectId}).then(function(l){t.props.getData(),l?alert(_l("\u53D6\u6D88\u6210\u529F")):alert(_l("\u53D6\u6D88\u5931\u8D25"),2)})}})},t.state={showItem:!1,loading:!1,userInfo:{}},t}return(0,N.default)(i,[{key:"formatProjectStatus",value:function(t){var a=x.Z.PROJECT_STATUS_TYPES,n=x.Z.USER_STATUS,l=t.userStatus,o=t.projectStatus,s={buttonState:"default",editCard:!1,reportRelation:!1,exit:!1,manage:!1};if(l===n.UNAUDITED)s.buttonState="review";else switch(o===a.FREE&&(s.buttonState="open"),o){case a.FREE:case a.TRIAL:case a.PAID:s=(0,w.default)({},s,{editCard:!0,manage:!0,reportRelation:!0,exit:!0});break;case a.TOPAID:case a.REPAID:s.exit=!0;break;default:s.exit=!0;break}return s}},{key:"handleChangeShow",value:function(t){var a=this;t.target.className.includes("childTag")||this.setState({showItem:!this.state.showItem},function(){a.state.showItem&&a.getAuthInfo()})}},{key:"getAuthInfo",value:function(){var t=this,a=this.props.card;this.setState({loading:!0}),p.Z.getUserCard({projectId:a.projectId}).then(function(n){n&&t.setState({userInfo:n.user,loading:!1})})}},{key:"handleEdit",value:function(t){var a=this;E.Z.confirm({dialogClasses:"editInfoEnterprise",noFooter:!0,children:e.createElement(q,{userInfo:t,updateData:function(l){return a.setState({userInfo:l})},closeDialog:function(){$(".editInfoEnterprise.mui-dialog-container").parent().remove()}})})}},{key:"handleExit",value:function(t){E.Z.confirm({title:_l("\u63D0\u793A"),dialogClasses:"dialogBoxValidate",noFooter:!0,children:e.createElement(Y,{projectId:t.projectId,companyName:t.companyName,closeDialog:function(){$(".dialogBoxValidate.mui-dialog-container").parent().remove()},transferAdminProject:this.transferAdminProject})})}},{key:"handleRelation",value:function(t){(0,R.T8)("/personal?type=reportRelation&projectId="+t.projectId)}},{key:"handleGoAdmin",value:function(t){window.location.href="/admin/home/"+t.projectId}},{key:"handleCopyTextSuccess",value:function(){return alert(_l("\u590D\u5236\u6210\u529F")),!1}},{key:"getItems",value:function(t,a){var n=t.map(function(l){return l[a]});return n.join(" ; ")}},{key:"renderOption",value:function(t){var a=this,n=this.props.card;switch(t){case"open":return md.global.Config.IsLocal?void 0:e.createElement("span",{className:"openNowBtn",onClick:function(){return a.handleOpenCard(n)}},_l("\u8D2D\u4E70"));case"review":return e.createElement("span",null,e.createElement("span",{className:"ThemeColor3 Hover_49 Hand",onClick:function(){return a.handleReview(n)}},_l("\u5F85\u5BA1\u6838")),e.createElement("span",{className:"cancelApplication Hover_49 Hand mLeft24",onClick:function(){return a.cancelApplication(n)}},_l("\u53D6\u6D88\u7533\u8BF7")));case"default":return e.createElement("span",{className:"Gray_9e"},n.isProjectAdmin?n.isCreateUser?_l("\u7BA1\u7406\u5458")+_l("(\u521B\u5EFA\u4EBA)"):_l("\u7BA1\u7406\u5458"):_l("\u666E\u901A\u6210\u5458"))}}},{key:"handleOpenCard",value:function(t){(0,ee.F)({projectId:t.projectId})}},{key:"handleReview",value:function(t){p.Z.sendSystemMessageToAdmin({projectId:t.projectId,msgType:1}).then(function(a){a?alert(_l("\u5DF2\u63D0\u9192\u7BA1\u7406\u5458\u5BA1\u6838")):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)}).catch()}},{key:"render",value:function(){var t=this,a=this.state,n=a.showItem,l=a.userInfo,o=a.loading,s=l.departmentInfos,c=s===void 0?[]:s,h=l.jobInfos,v=h===void 0?[]:h,m=this.props.card,S=m.currentLicense,T=S===void 0?{}:S,C=this.formatProjectStatus(m),A=m.projectStatus===x.Z.PROJECT_STATUS_TYPES.FREE||m.projectStatus===x.Z.PROJECT_STATUS_TYPES.TOPAID;return e.createElement("div",{className:u()("enterpriseCardItem",{active:n}),onClick:function(P){return t.handleChangeShow(P)}},e.createElement("div",{className:"cardItemHeader Hand"},e.createElement("div",{className:"cardItemLeft"},e.createElement("div",{className:"Font17 Bold mBottom12 Gray"},m.companyName),e.createElement("div",{className:"cardItemInfo"},e.createElement("div",{className:u()("itemTag",A?"grayActive":"active")},T.version?T.version.name:_l("\u514D\u8D39\u7248")),e.createElement("div",{className:"mLeft24 mRight24 itemDivice"}),e.createElement("div",{className:"Gray_75 hover_blue"},e.createElement(J(),{component:"span","data-clipboard-text":m.projectCode,onSuccess:this.handleCopyTextSuccess.bind(this)},e.createElement("span",{className:"childTag"},_l("\u7EC4\u7EC7\u95E8\u724C\u53F7\uFF1A%0",m.projectCode)),e.createElement("span",{className:"icon-content-copy Font12 mLeft5 childTag"}))))),e.createElement("div",{className:"cardItemRight"},this.renderOption(C.buttonState),e.createElement("span",{className:u()("Font20 mLeft24 Gray_70",n?"icon-expand_more":"icon-navigate_next")}))),e.createElement("div",{className:u()("infoContent",n?"extendInfo":"closeInfo")},o?e.createElement(B.Z,null):e.createElement(e.Fragment,null,e.createElement("div",{className:"extendItemBox"},e.createElement("div",{className:"extendItemLabel Gray_75"},_l("\u7EC4\u7EC7\u540D\u7247")),e.createElement("div",{className:"extendRight"},e.createElement("div",{className:"flexRow mBottom8"},e.createElement("div",{className:"extendRightLabel"},_l("\u59D3\u540D")),e.createElement("div",null,l.fullname||_l("\u672A\u586B\u5199"))),e.createElement("div",{className:"flexRow mBottom8"},e.createElement("div",{className:"extendRightLabel"},_l("\u90E8\u95E8")),e.createElement("div",null,c.length>0?this.getItems(c,"departmentName"):_l("\u672A\u586B\u5199"))),e.createElement("div",{className:"flexRow"},e.createElement("div",{className:"extendRightLabel"},_l("\u804C\u4F4D")),e.createElement("div",null,v.length>0?this.getItems(v,"jobName"):_l("\u672A\u586B\u5199"))))),e.createElement("div",{className:"extendItemBox Gray_75"},te.map(function(g,P){return e.createElement("span",{key:P,className:u()("flexRow mRight40",C[g.key]?"Hand Gray hover_blue":"Gray_9e"),onClick:function(){return C[g.key]?t[g.click](l):null}},e.createElement("span",{className:u()("mRight12 LineHeight20 childTag",g.icon)}),g.key==="manage"?e.createElement("span",{className:"childTag"},m.hasRole?g.label:_l("\u7533\u8BF7\u7BA1\u7406\u6743\u9650")):e.createElement("span",{className:"childTag"},g.label))})))))}}]),i}(e.Component),ne=function(f){(0,b.default)(i,f);function i(){return(0,y.default)(this,i),(0,k.default)(this,(i.__proto__||I()(i)).apply(this,arguments))}return(0,N.default)(i,[{key:"renderOption",value:function(t){var a=this;switch(t.status){case 0:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u5DF2\u52A0\u5165"));case 1:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u5DF2\u62D2\u7EDD"));case 2:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u5F85\u5BA1\u6279"));case 3:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u52A0\u5165\u5931\u8D25"));case 4:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u5DF2\u5931\u6548"));case 5:return e.createElement("li",{className:"Left LineHeight25 TxtLeft mLeft20"},_l("\u5DF2\u9000\u51FA"));default:return e.createElement(e.Fragment,null,e.createElement("li",{className:"Left LineHeight25 TxtLeft ThemeColor3 btnForAuthListAdd Hand mLeft20",onClick:function(){return a.handleAdd(t)}},_l("\u52A0\u5165")),e.createElement("li",{className:"Left LineHeight25 TxtLeft ThemeColor3 btnForAuthListRefused Hand mLeft20",onClick:function(){return a.handleCancel(t)}},_l("\u62D2\u7EDD")))}}},{key:"handleAdd",value:function(t){var a=this;this.props.updateAuthCount();var n=t.projectId,l=t.token;p.Z.checkJoinProjectByTokenWithCard({projectId:n,token:l}).then(function(o){switch(o.joinProjectResult){case 1:location.href="/enterpriseRegister?type=editInfo&projectId="+n+"&token="+l;break;case 3:a.props.existUserNotice(o.userCard.user.status);break;default:alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)}a.props.closeDialog()})}},{key:"handleCancel",value:function(t){var a=this;this.props.updateAuthCount();var n=t.projectId,l=t.token;p.Z.refuseJoin({projectId:n,token:l}).then(function(o){o?alert(_l("\u60A8\u5DF2\u6210\u529F\u62D2\u7EDD\u8BE5\u7EC4\u7EC7\u7684\u9080\u8BF7")):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2),a.props.closeDialog()})}},{key:"render",value:function(){var t=this,a=this.props.list,n=a===void 0?[]:a;return e.createElement("div",{className:"overflowHidden pAll10"},e.createElement("span",{className:"Normal Gray14 Left Width250"},_l("\u7EC4\u7EC7")),e.createElement("span",{className:"Normal Gray14 Left mLeft20"},_l("\u64CD\u4F5C")),e.createElement("div",{className:"Clear"}),e.createElement("ul",{className:"pTop10"},n.length?e.createElement(e.Fragment,null,n.map(function(l){return e.createElement(e.Fragment,null,e.createElement("li",{className:"Left LineHeight25 Width250 overflow_ellipsis"},l.companyName),t.renderOption(l))})):e.createElement("li",{class:"Left LineHeight25 w100"},_l("\u6682\u65E0\u9080\u8BF7\u8BB0\u5F55\uFF01"))))}}]),i}(e.Component),le=d(33867),_=d(14898),re=d(99924),oe=d(30539),ie=d(37195),se=[{label:_l("\u6211\u7684\u6C47\u62A5\u5173\u7CFB"),key:"report"},{label:_l("\u7EC4\u7EC7\u6C47\u62A5\u5173\u7CFB"),key:"enterprise"}],ce=function(f){(0,b.default)(i,f);function i(r){(0,y.default)(this,i);var t=(0,k.default)(this,(i.__proto__||I()(i)).call(this,r));return t.state={activeBar:"report",isAdmin:!1,companyName:"",allowStructureSelfEdit:!1,allowStructureForAll:!1,parents:[],me:{},children:[],loading:!1,pageIndex:1,projectId:(0,L.A_)().projectId},t}return(0,N.default)(i,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){var t=this;this.setState({loading:!0});var a="";j().every(md.global.Account.projects,function(n){n.projectId===t.state.projectId&&(a=n.companyName)}),F().all([this.fetchAdmin(),this.fetchAllow(),this.fetchSubordinates()]).then(function(n){var l=(0,D.Z)(n,3),o=l[0],s=l[1],c=l[2],h=c.parent,v=h===void 0?{}:h,m=c.mySelf,S=m===void 0?{}:m,T=c.subordinates,C=T===void 0?[]:T,A=c.subTotalCount,g=c.isLimited;!j().isEmpty(S)&&t.state.pageIndex===1?t.setState({companyName:a,isAdmin:o,allowStructureForAll:s.allowStructureForAll,allowStructureSelfEdit:s.allowStructureSelfEdit,parents:j().isEmpty(v)?[]:[v],me:S,children:C,loading:!1,subTotalCount:A,isLimited:g}):alert(_l("\u83B7\u53D6\u5931\u8D25"),2)})}},{key:"fetchRender",value:function(t){var a=this;this.fetchSubordinates(t).then(function(n){var l=n.parent,o=l===void 0?{}:l,s=n.mySelf,c=s===void 0?{}:s,h=n.subordinates,v=h===void 0?[]:h,m=n.subTotalCount;!j().isEmpty(c)&&t===1?a.setState({parent:o,me:c,children:v,subTotalCount:m}):alert(_l("\u83B7\u53D6\u5931\u8D25"),2)})}},{key:"fetchSubordinates",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return _.Z.myStructures({projectId:this.state.projectId,pageIndex:t})}},{key:"fetchAdmin",value:function(){return oe.Z.isProjectAdmin({projectId:this.state.projectId})}},{key:"fetchAllow",value:function(){return re.Z.getStructureForAll({projectId:this.state.projectId})}},{key:"handleChangeBar",value:function(t){this.setState({activeBar:t})}},{key:"handleAddSub",value:function(){var t=this.state.projectId,a=this,n=md.global.Account.accountId;(0,Z.Z)({title:_l("\u6DFB\u52A0\u4E0B\u5C5E"),showMoreInvite:!1,SelectUserSettings:{projectId:t,filterAll:!0,filterFriend:!0,filterOthers:!0,filterOtherProject:!0,unique:!1,showTabs:["structureUsers"],extraTabs:[{id:"structureUsers",name:"\u6240\u6709\u4EBA",type:4,page:!0,actions:{getUsers:function(o){return o=$.extend({},o,{accountId:n,projectId:t}),_.Z.getAllowChooseUsers(o)}}}],callback:function(o){_.Z.addStructure({accountIds:j().map(o,function(s){var c=s.accountId;return c}),parentId:n,isTop:!1,projectId:t}).then(function(s){s&&s.success?a.fetchRender(1):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}}})}},{key:"handleDelBtn",value:function(t){var a=t.accountId,n=t.fullname,l=this.state.projectId,o=this;E.Z.confirm({title:_l("\u786E\u8BA4\u79FB\u9664 %0 ?",n),description:_l("\u79FB\u9664\u540E\uFF0C\u5176\u4E0B\u5C5E\u6210\u5458\u4E5F\u5C06\u4ECE\u6C47\u62A5\u5173\u7CFB\u4E2D\u79FB\u9664"),onOk:function(){_.Z.removeParentID({accountId:a,projectId:l}).then(function(c){c?(o.setState({pageIndex:1}),o.fetchRender(1)):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}})}},{key:"handleGoAdmin",value:function(){location.href="/admin/reportRelation/"+this.state.projectId}},{key:"renderContent",value:function(){var t=this,a=this.state,n=a.isAdmin,l=a.parents,o=a.me,s=a.children,c=a.allowStructureSelfEdit,h=a.subTotalCount,v=a.loadMoreLoading,m=a.isLimited;return e.createElement("div",{className:"layoutWrapper"},e.createElement("div",null,e.createElement("div",{className:"listTitle"},_l("\u76F4\u5C5E\u4E0A\u7EA7")),e.createElement("div",{className:u()("list parents")},l.length?this.renderList(l):e.createElement("div",{className:"node Font16 LineHeight80 TxtCenter"},_l("\u6CA1\u6709\u914D\u7F6E\u4E0A\u53F8")))),e.createElement("div",null,e.createElement("div",{className:"mBottom40"}),e.createElement("div",{className:"list"},this.renderBuildItem(o))),e.createElement("div",null,e.createElement("div",{className:u()("listTitle",{Hidden:!c&&!s.length})},_l("\u6211\u7684\u4E0B\u5C5E")),e.createElement("div",{className:"list children"},s.length?this.renderList(s):null,c&&!m&&e.createElement("div",{className:"node Font16 LineHeight80 Gray_bd addSub Hand",onClick:function(){return t.handleAddSub()}},e.createElement("span",{className:"Font24 mRight15 mLeft24 TxtMiddle icon-add-member2"}),e.createElement("span",{className:"TxtMiddle"},_l("\u6DFB\u52A0\u6211\u7684\u4E0B\u5C5E"))),h>s.length&&e.createElement("div",{className:"Hand loadMore",onClick:function(){v||t.setState({pageIndex:t.state.pageIndex+1,loadMoreLoading:!0},function(){t.fetchSubordinates(t.state.pageIndex).then(function(T){var C=T.subordinates,A=C===void 0?[]:C;t.setState({children:t.state.children.concat(A),loadMoreLoading:!1})})})}},v?_l("\u52A0\u8F7D\u4E2D"):_l("\u66F4\u591A")))))}},{key:"renderList",value:function(t){var a=this;return t.map(function(n){return a.renderBuildItem(n)})}},{key:"renderBuildItem",value:function(t){var a=this,n=this.state,l=n.allowStructureSelfEdit,o=n.subTotalCount;return e.createElement("div",{className:u()("node",t.status===4?"disabled":"ThemeHoverBorderColor3")},e.createElement("div",{className:"userItem"},e.createElement("img",{src:t.avatar,className:"avatar"}),e.createElement("div",{className:"info"},e.createElement("div",{className:"name"},t.fullname),e.createElement("div",{className:"department"},t.department),e.createElement("div",{className:"job"},t.job)),t.accountId===md.global.Account.accountId&&o?e.createElement("div",{className:"subordinateCount"},e.createElement("span",{className:"icon-charger Gray_a TxtMiddle Font14"}),e.createElement("span",{className:"TxtMiddle Gray mLeft5"},o)):null,l?e.createElement("span",{className:"icon-close delBtn",onClick:function(){return a.handleDelBtn(t)}}):null))}},{key:"render",value:function(){var t=this,a=this.state,n=a.allowStructureForAll,l=a.isAdmin,o=a.activeBar,s=a.loading;return s?e.createElement(B.Z,null):e.createElement("div",{className:"reportRelationEnterprise"},e.createElement("div",{className:"reportHeader"},e.createElement("div",{className:"headerIcon"},e.createElement(le.Z,{icon:"backspace",className:"Hand mRight18 TxtMiddle Font24 Hover_49",onClick:function(){return(0,R.T8)("/personal?type=enterprise")}}),e.createElement("span",{className:"Font17 Bold"},_l("\u6211\u7684\u6C47\u62A5\u5173\u7CFB"))),e.createElement("div",{className:u()("headerOption",{Hidden:!n})},se.map(function(c){return e.createElement("div",{className:u()("headerOptionItem",{active:o===c.key}),key:c.key,onClick:function(){return t.handleChangeBar(c.key)}},c.label)})),e.createElement("div",null,e.createElement("span",{className:u()("ThemeColor3 Hand Hover_49",{Hidden:!l}),onClick:function(){return t.handleGoAdmin()}},_l("\u53BB\u7BA1\u7406\u540E\u53F0\u67E5\u770B")))),e.createElement("div",{className:"reportContent"},o==="report"?this.renderContent():e.createElement(ie.default,{projectId:this.state.projectId,from:"myReport"})))}}]),i}(e.Component),de=function(f){(0,b.default)(i,f);function i(r){(0,y.default)(this,i);var t=(0,k.default)(this,(i.__proto__||I()(i)).call(this,r));return t.state={pageIndex:1,pageSize:500,list:[],count:0,token:"",loading:!1,isEnterprise:!1,authCount:0,dialog:{visible:!1,data:null}},t}return(0,N.default)(i,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getData",value:function(){var t=this;(0,L.A_)().type==="enterprise"?(this.setState({loading:!0}),F().all([this.getList(),this.getUntreatAuthList()]).then(function(a){var n=(0,D.Z)(a,2),l=n[0],o=n[1];t.setState({list:l.list,count:l.allCount,isEnterprise:l.allCount>0,authCount:o.count,loading:!1})})):this.setState({isEnterprise:(0,L.A_)().type})}},{key:"getList",value:function(){return p.Z.getProjectList({pageIndex:this.state.pageIndex,pageSize:this.state.pageSize})}},{key:"getUntreatAuthList",value:function(){return p.Z.getUntreatAuthList({})}},{key:"renderListCard",value:function(){var t=this,a=this.state.list;return e.createElement(e.Fragment,null,a&&a.map(function(n){return e.createElement(ae,{card:n,key:n.projectId,getData:function(){return t.getData()}})}))}},{key:"handleAdd",value:function(){location.href="/enterpriseRegister?type=add"}},{key:"handleInvitation",value:function(){var t=this;p.Z.getMyAuthList({}).then(function(a){a.list?t.setState({dialog:{visible:!0,data:a.list}}):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)}).catch()}},{key:"existUserNotice",value:function(t){switch(t){case 1:alert(_l("\u60A8\u5DF2\u662F\u8BE5\u7EC4\u7EC7\u6210\u5458"),3);break;case 2:alert(_l("\u60A8\u5DF2\u88AB\u8BE5\u7EC4\u7EC7\u62D2\u7EDD\u52A0\u5165"),3);break;case 3:alert(_l("\u60A8\u5DF2\u662F\u8BE5\u7EC4\u7EC7\u6210\u5458\uFF0C\u8BF7\u7B49\u5F85\u5BA1\u6279"),3);break;case 4:alert(_l("\u60A8\u5DF2\u4ECE\u8BE5\u7EC4\u7EC7\u9000\u51FA\uFF0C\u9700\u8054\u7CFB\u8BE5\u7EC4\u7EC7\u7684\u7EC4\u7EC7\u7BA1\u7406\u5458\u8FDB\u884C\u6062\u590D"),3);break;default:alert(_l("\u60A8\u5DF2\u662F\u8BE5\u7EC4\u7EC7\u7684\u6210\u5458"),3)}}},{key:"handleCreate",value:function(){md.global.Account.superAdmin||md.global.Config.IsPlatformLocal&&md.global.SysSettings.enableCreateProject?window.open("/enterpriseRegister?type=create"):alert("\u6743\u9650\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u521B\u5EFA\u7EC4\u7EC7",3)}},{key:"renderContent",value:function(){var t=this,a=this.state.authCount;return(0,L.A_)().type==="enterprise"?e.createElement("div",{className:"enterpriceContainer"},e.createElement("div",{className:"enterpriseHeader"},e.createElement("div",{className:"Gray Font17 Bold"},_l("\u6211\u7684\u7EC4\u7EC7")),e.createElement("div",{className:"flexRow"},e.createElement("div",{className:"Gray_75 Font14 Hand Relative LineHeight32",onClick:function(){return t.handleInvitation()}},e.createElement("span",{className:"hover_blue"},_l("\u6211\u7684\u53D7\u9080\u4FE1\u606F")),e.createElement("span",{className:u()("invitationNew",{Hidden:!a})},a)),(md.global.Config.IsLocal&&md.global.Account.superAdmin||!md.global.Config.IsLocal)&&e.createElement("div",{className:"Font14 Hand mLeft40 mRight30 itemCreat",onClick:function(){return t.handleCreate()}},_l("\u521B\u5EFA\u7EC4\u7EC7")),e.createElement("button",{type:"button",className:"ming Button Button--primary itemJoin",onClick:function(){return t.handleAdd()}},_l("\u52A0\u5165\u7EC4\u7EC7")))),e.createElement("div",{className:"enterpriseContent"},this.renderListCard())):e.createElement(ce,null)}},{key:"render",value:function(){var t=this,a=this.state,n=a.loading,l=a.isEnterprise,o=a.authCount,s=a.dialog;return n?e.createElement(B.Z,{className:"mTop40"}):e.createElement(e.Fragment,null,l?this.renderContent():e.createElement("div",{className:"noEnterpriceContainer"},e.createElement("div",{className:"withoutEnterpriseHeader"},e.createElement("span",{className:"Font17 Gray Bold"},_l("\u6211\u7684\u7EC4\u7EC7")),e.createElement("span",null,e.createElement("span",{className:"Hand MyInvitation Relative LineHeight30 Fong14",onClick:function(){return t.handleInvitation()}},_l("\u6211\u7684\u53D7\u9080\u4FE1\u606F"),e.createElement("span",{className:u()("invitationNew",{Hidden:!o})},o>99?"99+":o)),e.createElement("span",{className:"Font14 Hand mLeft40 mRight30 itemCreat InlineBlock",onClick:function(){return t.handleCreate()}},_l("\u521B\u5EFA\u7EC4\u7EC7")),e.createElement("span",{className:"addBtn Hand",onClick:function(){return t.handleAdd()}},_l("\u52A0\u5165\u7EC4\u7EC7")))),e.createElement("div",{className:"withoutEnterpriseTopBox TxtCenter clearfix"},e.createElement("span",{className:"icon-business1 mBottom40 Font56"}),e.createElement("span",null,_l("\u60A8\u8FD8\u6CA1\u6709\u52A0\u5165\u4EFB\u4F55\u7EC4\u7EC7\uFF0C\u8BF7"),e.createElement("span",{className:"Hand mLeft5 mRight5 highLight InlineBlock",onClick:function(){return t.handleCreate()}},_l("\u521B\u5EFA")),_l("\u6216"),e.createElement("span",{className:"Hand mLeft5 highLight InlineBlock",onClick:function(){return t.handleAdd()}},_l("\u52A0\u5165\u7EC4\u7EC7"))))),e.createElement(E.Z,{showFooter:!1,visible:s.visible,onCancel:function(){return t.setState({dialog:{visible:!1,data:null}})}},e.createElement(ne,{list:s.data,updateAuthCount:function(){return t.setState({authCount:t.state.authCount-1})},existUserNotice:this.existUserNotice,closeDialog:function(){return t.setState({dialog:{visible:!1,data:null}})}})))}}]),i}(e.Component)}}]);
