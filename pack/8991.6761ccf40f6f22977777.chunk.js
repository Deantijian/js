(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[8991],{29166:U=>{U.exports=`<div id="privateFolder" class="folderAuth">
    <div class="ckCircle">
        <input type="radio" name="folderVisibility" checked="checked">
    </div>
    <div class="descBox">
        <div> <i class="icon-folder-private folderIocn"></i> <span class="text">{{=_l('\u4EC5\u9879\u76EE\u6210\u5458\u53EF\u89C1') }}</span> </div>
        <div class="descTip">{{=_l('\u53EA\u6709\u6DFB\u52A0\u4E3A\u9879\u76EE\u6210\u5458\u624D\u53EF\u4EE5\u67E5\u770B\u9879\u76EE') }}</div>
    </div>
</div>
<div id="publicFolder" class="folderAuth">
    <div class="ckCircle">
        <input type="radio" name="folderVisibility">
    </div>
    <div class="descBox">
        <div> <i class="icon-folder-public folderIocn"></i> <span class="text">{{=_l('\u516C\u5F00\u7ED9\u6307\u5B9A\u7FA4\u7EC4') }}</span></div>
        <div class="descTip">
            <span>{{=_l('\u6240\u9009\u8303\u56F4\u5185\u7684\u6240\u6709\u4EBA\u90FD\u53EF\u4EE5\u67E5\u770B\u9879\u76EE') }}</span><input type="hidden" id="privateRange" />
        </div>
    </div>
</div>
`},98820:U=>{U.exports=`<div class="createNewSingle ThemeBGColor5">
    <span class="markTasks2"></span>
    <input type="text" class="txtSingleName" maxlength="100" placeholder="{{=_l('\u8F93\u5165\u540D\u79F0\u540E\u6309\u56DE\u8F66\u521B\u5EFA') }}" />
    <span class="stageBox"></span>
    <span class="Right calendarBox createSingleDate"></span>
    <span class="circle chargeImgWrapQuick" data-id="{{=md.global.Account.accountId }}" data-avatar="{{=md.global.Account.avatar }}">
        <img class="circle" src="{{=md.global.Account.avatar }}" />
    </span>
    <i class="icon-star-hollow taskStar"></i>
</div>
`},81209:U=>{U.exports=`<div class="folderChartChargeList boderRadAll_3 boxShadow5">
    <div class="folderChartChargeHead relative">
        {{=_l('\u6240\u6709\u8D1F\u8D23\u4EBA')}}<span class="folderChartSelectAll folderChartSelect pointer"><i class="icon-ok"></i></span>
    </div>
    <ul class="folderChartChargeLists">
        {{~it:list}}
        <li>
            <img src="{{=list.avatar}}" />
            {{!list.fullName}}
            <span class="folderChartSelectBtn folderChartSelect pointer" data-id="{{=list.accountID}}"><i class="icon-ok"></i></span>
        </li>
        {{~}}
    </ul>
    <div class="folderChartChargeOperator">
        <span class="folderChartChargeNo">{{=_l('\u6E05\u9664')}}</span>
        <span class="folderChartChargeYes ThemeColor3">{{=_l('\u786E\u5B9A')}}</span>
    </div>
</div>`},8929:U=>{U.exports=`{{~it:item:i}}
  {{? i % 3 === 0}}
  <div class="folderChartBoxModel flexRow">
  {{?}}
    <div class="flex">
      <div class="folderChartBoxTitle">
        <span class="overflow_ellipsis">{{=item.controlName}}{{=item.unit ? '\uFF08' + item.unit +'\uFF09' : ''}}</span><span data-tip="{{=item.type === 9 || item.type === 10 || item.type === 11 ? _l('\u5BF9\u9009\u9879\u6216\u4E0B\u62C9\u83DC\u5355\u7684\u5404\u4E2A\u9009\u9879\u5185\u5BB9\u8FDB\u884C\u7EDF\u8BA1') : _l('\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u672A\u5B8C\u6210\u548C\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\u7684\u5F53\u524D\u5B57\u6BB5\u7EDF\u8BA1')}}" class="tip-bottom-right"><i class="icon-task-folder-message"></i></span>
      </div>
      <div class="folderChartModel" id="folderCharts_{{=item.controlId}}" data-id="{{=item.controlId}}" data-type="{{=item.type}}" data-model="custom">{{=LoadDiv()}}</div>
    </div>
    {{?i === it.length - 1}}
      {{? i % 3 === 0}}
        <div class="flex nullSource"></div>
        <div class="flex nullSource"></div>
      {{?}}
      {{? i % 3 === 1}}
        <div class="flex nullSource"></div>
      {{?}}
    {{?}}
  {{? ((i + 1) % 3 === 0 && i > 0) || i === item.length - 1}}
  </div>
  {{?}}
{{~}}

{{?it.length === 0}}
  <div class="folderChartCustomNull boderRadAll_3">
    <div class="Font17">{{=_l('\u6682\u65E0\u6DFB\u52A0\u81EA\u5B9A\u4E49\u5185\u5BB9')}}</div>
    <div class="Font15 mTop10">{{=_l('\u53EF\u5728\u9879\u76EE\u8BBE\u7F6E\u5185\u6DFB\u52A0\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9')}}</div>
    <div class="ThemeBG taskGroundGlass"></div></div>
{{?}}
`},25454:U=>{U.exports=`{{?it.isFirst}}
<div class="folderChartBar flexRow">
    <div class="folderChartBarLeft">
        <div>
            <span class="tip-bottom-right" data-tip="{{= _l('\u9879\u76EE\u4E0B\u7684\u5168\u90E8\u4EFB\u52A1\u6570\u91CF\uFF0C\u5305\u542B\u5DF2\u5B8C\u6210\u548C\u672A\u5B8C\u6210')}}">
                <span class="charBarNum1">{{=it.data.amount}}</span>\u4E2A
                <span class="block">{{= _l('\u5168\u90E8\u4EFB\u52A1')}}</span>
            </span>
        </div>
        <div class="ThemeColor3">
            <span data-tip="{{= _l('\u6B64\u9879\u76EE\u4E0B\u6B63\u5728\u672A\u5B8C\u6210\u7684\u4EFB\u52A1\u6570')}}">
                <span class="charBarNum2">{{=it.data.underway}}</span>\u4E2A
                <span class="block">{{= _l('\u672A\u5B8C\u6210')}}</span>
            </span>
        </div>
        <div>
            <span data-tip="{{= _l('\u672A\u5B8C\u6210\u903E\u671F\u7684\u603B\u4EFB\u52A1\u6570')}}">
                <span class="charBarNum3">{{=it.data.underway_A}}</span>\u4E2A
                <span class="block">{{= _l('\u903E\u671F\u4EFB\u52A1\u6570')}}</span>
            </span>
        </div>
        <div>
            <span data-tip="{{= _l('\u672A\u5B8C\u6210\u4EFB\u52A1\u903E\u671F\u7684\u603B\u65F6\u95F4\u5411\u4E0B\u53D6\u6574\uFF0C\u4E0D\u8DB31\u5929\u7684\u663E\u793A0\u5929\u3002\u5982\uFF1A3\u4E2A\u672A\u5B8C\u6210\u4EFB\u52A1\u903E\u671F\u65F6\u95F4\u7D2F\u8BA1\u4E3A15\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F0\u5929\uFF0C\u82E5\u7D2F\u8BA1\u4E3A26\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F1\u5929\uFF0C\u4EE5\u6B64\u7C7B\u63A8')}}" class="fixWidth">
                <span class="charBarNum4">{{=Math.floor(it.data.timespan_Und / 24)}}</span>\u5929
                <span class="block">{{= _l('\u903E\u671F\u65F6\u95F4')}}</span>
            </span>
        </div>
        <div class="ThemeColor3">
            <span data-tip="{{= _l('\u6B64\u9879\u76EE\u4E0B\u5DF2\u7ECF\u5B8C\u6210\u7684\u4EFB\u52A1\u6570')}}">
                <span class="charBarNum5">{{=it.data.completed}}</span>\u4E2A
                <span class="block">{{= _l('\u5DF2\u5B8C\u6210')}}</span>
            </span>
        </div>
        <div>
            <span data-tip="{{= _l('\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\u4E2D\u903E\u671F\u7684\u603B\u5B8C\u6210\u7684\u4EFB\u52A1\u6570')}}">
                <span class="charBarNum6">{{=it.data.completed_A}}</span>\u4E2A
                <span class="block">{{= _l('\u903E\u671F\u4EFB\u52A1\u6570')}}</span>
            </span>
        </div>
        <div>
            <span data-tip="{{= _l('\u5DF2\u5B8C\u6210\u4EFB\u52A1\u903E\u671F\u7684\u603B\u65F6\u95F4\u5411\u4E0B\u53D6\u6574\uFF0C\u4E0D\u8DB31\u5929\u7684\u663E\u793A0\u5929\u3002\u5982\uFF1A3\u4E2A\u8FDB\u884C\u4E2D\u4EFB\u52A1\u903E\u671F\u65F6\u95F4\u7D2F\u8BA1\u4E3A15\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F0\u5929\uFF0C\u82E5\u7D2F\u8BA1\u4E3A26\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F1\u5929\uFF0C\u4EE5\u6B64\u7C7B\u63A8')}}" class="fixWidth">
                <span class="charBarNum7">{{=Math.floor(it.data.timespan_Com / 24)}}</span>\u5929
                <span class="block">{{= _l('\u903E\u671F\u65F6\u95F4')}}</span>
            </span>
        </div>
    </div>
    <div class="folderChartBarRight">
        <div>
            <span data-tip="{{= _l('\u6B64\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u7684\u53C2\u4E0E\u4EBA\u6570')}}">
                <span class="charBarNum8">{{=it.data.memberAmount}}</span>\u4EBA
                <span class="block">{{= _l('\u53C2\u4E0E\u4EBA\u6570')}}</span>
            </span>
        </div>
        <div>
            <span class="tip-bottom-left" data-tip="{{= _l('\u6B64\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u7684\u8D1F\u8D23\u4EBA')}}">
                <span class="charBarNum9">{{=it.data.chargeAmount}}</span>\u4EBA
                <span class="block">{{= _l('\u8D1F\u8D23\u4EBA')}}</span>
            </span>
        </div>
    </div>
</div>
<div class="folderChartNavBox relative">
    <ul class="folderChartNav">
        <li class="active ThemeColor3 ThemeBorderColor3">{{= _l('\u4EFB\u52A1\u7EDF\u8BA1')}}</li>
        <li>{{= _l('\u6309\u8D1F\u8D23\u4EBA')}}</li>
        <li>{{= _l('\u6309\u770B\u677F')}}</li>
        <li>{{= _l('\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9')}}</li>
    </ul>
    <ul class="folderChartTime">
        <span class="folderChartTimeTxt">{{=it.timeTxt}}</span>
        <li class="activeClass ThemeBorderColor3 ThemeBGColor3" data-type='6'>{{= _l('%0\u5929',7)}}</li>
        <li data-type='13'>{{= _l('%0\u5929',14)}}</li>
        <li data-type='29'>{{= _l('%0\u5929',30)}}</li>
        <li data-type='custom'>{{= _l('\u81EA\u5B9A\u4E49')}}</li>
    </ul>
    <div class="folderChartChargeBox Hidden">
        <i class="icon-descending-order folderChartChargeSort"></i>
        <span class="folderChartChargeBtn"><span class="folderChartChargeTxt">{{= _l('\u6240\u6709\u8D1F\u8D23\u4EBA')}}</span><i class="icon-arrow-down-border"></i></span>
    </div>
</div>
<div class="folderChartBox">
{{?}}
    {{?it.type === 1}}
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u4EFB\u52A1\u603B\u6570\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u672A\u5B8C\u6210\u548C\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\u603B\u6570\u7EDF\u8BA1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts1">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u672A\u5B8C\u6210\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u672A\u5B8C\u6210\u7684\u4EFB\u52A1\u603B\u6570\u7EDF\u8BA1\uFF0C\u5305\u62EC\u6B63\u5E38\u672A\u5B8C\u6210\uFF08\u672A\u8BBE\u7F6E\u622A\u6B62\u65F6\u95F4\u7684\u4EFB\u52A1\u89C6\u4E3A\u6B63\u5E38\u672A\u5B8C\u6210\u7684\u4EFB\u52A1\uFF09\u548C\u903E\u671F\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts2">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u672A\u5F00\u59CB\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\uFF0C\u7EDF\u8BA1\u9879\u76EE\u4E0B\u6240\u6709\u672A\u5F00\u59CB\u7684\u4EFB\u52A1\u6570\uFF0C\u5305\u62EC\u672A\u5F00\u59CB\u548C\u5EF6\u671F\u672A\u5F00\u59CB\u7684\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts14">{{=LoadDiv()}}</div>
        </div>
    </div>
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u8FDB\u884C\u4E2D\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\uFF0C\u7EDF\u8BA1\u9879\u76EE\u4E0B\u6240\u6709\u8FDB\u884C\u4E2D\u7684\u4EFB\u52A1\u6570\uFF08\u8D77\u6B62\u65F6\u95F4\u90FD\u672A\u8BBE\u7F6E\u7684\u89C6\u4E3A\u8FDB\u884C\u4E2D\uFF09\uFF0C\u5305\u62EC\u672A\u8BBE\u7F6E\u7684\u3001\u6B63\u5E38\u548C\u903E\u671F\u672A\u5B8C\u6210\u7684\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts15">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u5DF2\u5B8C\u6210\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\u603B\u6570\u7EDF\u8BA1\uFF0C\u5305\u62EC\u6309\u65F6\u5B8C\u6210\uFF08\u672A\u8BBE\u7F6E\u622A\u6B62\u65F6\u95F4\u7684\u4EFB\u52A1\u89C6\u4E3A\u6309\u65F6\u5B8C\u6210\uFF09\u548C\u5DF2\u903E\u671F\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts3">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u903E\u671F\u65F6\u95F4\uFF08\u5929\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u7684\u603B\u903E\u671F\u65F6\u95F4\u7EDF\u8BA1\uFF0C\u5305\u542B\uFF1A\u603B\u903E\u671F/\u8FDB\u884C\u4E2D/\u5DF2\u5B8C\u62103\u4E2A\u7EF4\u5EA6\u3002\u65F6\u95F4\u5411\u4E0B\u53D6\u6574\uFF0C\u4E0D\u8DB31\u5929\u7684\u663E\u793A0\u5929\u3002\u4F8B\u5982\uFF1A3\u4E2A\u4EFB\u52A1\u5206\u522B\u903E\u671F 20\u300140\u300160\u5C0F\u65F6\uFF0C\u5404\u4E2A\u4EFB\u52A1\u4E2D\u5206\u522B\u663E\u793A\u5176\u903E\u671F 20\u5C0F\u65F6\u30011\u5929\u30012\u5929\uFF0C\u7D2F\u8BA1\u903E\u671F120\u5C0F\u65F6\uFF0C\u663E\u793A\u4E3A\u603B\u903E\u671F5\u5929')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts4">{{=LoadDiv()}}</div>
        </div>

    </div>
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u9879\u76EE\u8D8B\u52BF\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u65B0\u589E\u4EFB\u52A1\u4E0E\u5DF2\u5B8C\u6210\u4EFB\u52A1\u7684\u5BF9\u6BD4\u7EDF\u8BA1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts5">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u9879\u76EE\u53C2\u4E0E\u4EBA\u5458\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u7684\u53C2\u4E0E\u4EBA\u6570\u53D8\u5316\u7684\u7EDF\u8BA1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts6">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{= _l('\u672A\u5B8C\u6210\u4EFB\u52A1\u5269\u4F59\u65F6\u95F4\uFF08\u5C0F\u65F6\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u6307\u5B9A\u65E5\u671F\u9879\u76EE\u4E0B\u6240\u6709\u672A\u5B8C\u6210\u4EFB\u52A1\u7684\u5269\u4F59\u65F6\u95F4\u603B\u548C')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts13">{{=LoadDiv()}}</div>
        </div>
    </div>
    {{?}}

    {{?it.type === 2}}
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u4EFB\u52A1\u6570\u91CF\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u8D1F\u8D23\u7684\u6240\u6709\u4EFB\u52A1\u603B\u6570\u7EDF\u8BA1\uFF0C\u5305\u62EC\u672A\u5B8C\u6210\u548C\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts7">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u6309\u65F6\u5B8C\u6210\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u6309\u65F6\u5B8C\u6210\u4EFB\u52A1\u6570\u7EDF\u8BA1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts8">{{=LoadDiv()}}</div>
        </div>
    </div>
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u903E\u671F\u4EFB\u52A1\u6570\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u8D1F\u8D23\u7684\u4EFB\u52A1\u903E\u671F\u6570\u7EDF\u8BA1\uFF0C\u5305\u542B\u672A\u5B8C\u6210\u548C\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts9">{{=LoadDiv()}}</div>
        </div>
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u903E\u671F\u65F6\u95F4\uFF08\u5929\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u8D1F\u8D23\u7684\u4EFB\u52A1\u903E\u671F\u65F6\u95F4\u7EDF\u8BA1\uFF0C\u5305\u542B\u8FDB\u884C\u4E2D\u548C\u5DF2\u5B8C\u6210\u7684\u903E\u671F\u65F6\u95F4\uFF0C\u5411\u4E0B\u53D6\u6574\u3002\u5982\uFF1A3\u4E2A\u8FDB\u884C\u4E2D\u4EFB\u52A1\u903E\u671F\u65F6\u95F4\u7D2F\u8BA1\u4E3A15\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F0\u5929\uFF0C\u82E5\u7D2F\u8BA1\u4E3A26\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F1\u5929\uFF0C\u4EE5\u6B64\u7C7B\u63A8')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts10">{{=LoadDiv()}}</div>
        </div>
    </div>
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u5E73\u5747\u5B8C\u6210\u4EFB\u52A1\u65F6\u95F4\uFF08\u5929\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u5E73\u5747\u5B8C\u6210\u4EFB\u52A1\u7684\u65F6\u95F4\u7EDF\u8BA1\uFF0C\u5411\u4E0B\u53D6\u6574\u3002\u5982\uFF1A3\u4E2A\u8FDB\u884C\u4E2D\u4EFB\u52A1\u903E\u671F\u65F6\u95F4\u7D2F\u8BA1\u4E3A15\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F0\u5929\uFF0C\u82E5\u7D2F\u8BA1\u4E3A26\u5C0F\u65F6\uFF0C\u5219\u663E\u793A\u603B\u903E\u671F1\u5929\uFF0C\u4EE5\u6B64\u7C7B\u63A8')}}" class="fixWidth"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts11">{{=LoadDiv()}}</div>
        </div>
        <div class="flex nullSource"></div>
    </div>
    {{?}}

    {{?it.type === 3}}
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                {{=_l('\u5F53\u524D\u770B\u677F\u4EFB\u52A1\u60C5\u51B5\uFF08\u4E2A\uFF09')}}<span data-tip="{{= _l('\u622A\u6B62\u5230\u76EE\u524D\u4E3A\u6B62\u5404\u4E2A\u9879\u76EE\u770B\u677F\u4E0B\u672A\u5B8C\u6210\u548C\u5DF2\u5B8C\u6210\u7684\u4EFB\u52A1\u6570\u91CF\u7EDF\u8BA1')}}" class="tip-bottom-right"><i class="icon-task-folder-message"></i></span>
            </div>
            <div class="folderChartModel" id="folderCharts12">{{=LoadDiv()}}</div>
        </div>
    </div>
    {{?}}
{{?it.isFirst}}
</div>
{{?}}
`},12533:U=>{U.exports=`{{var maxH = '';}}
{{var isScroll = it.type === 2 && it.listSize > 16;}}
{{?isScroll}}
    {{maxH = 'style="height:' + it.listSize * 30 + 'px;margin-top: 0;"';}}
{{?}}
<div class="folderChartBox">
    <div class="folderChartBoxModel flexRow">
        <div class="flex">
            <div class="folderChartBoxTitle">
                <span class="overflow_ellipsis">{{=it.title}}</span><span data-tip="{{=it.tipTitle}}"><i class="icon-task-folder-message"></i></span>
            </div>
            {{?it.type === 1 || it.type === 4}}
            <ul class="folderChartTime" id="maxViewUpdateTime">
                <span class="folderChartTimeTxt">{{=it.activeTime}}</span>
                <li class="{{=it.activeBtn === 0 ? 'activeClass ThemeBorderColor3 ThemeBGColor3' : ''}}" data-type='6'>7{{= _l('\u5929')}}</li>
                <li class="{{=it.activeBtn === 1 ? 'activeClass ThemeBorderColor3 ThemeBGColor3' : ''}}" data-type='13'>14{{= _l('\u5929')}}</li>
                <li class="{{=it.activeBtn === 2 ? 'activeClass ThemeBorderColor3 ThemeBGColor3' : ''}}" data-type='29'>30{{= _l('\u5929')}}</li>
                <li class="{{=it.activeBtn === 3 ? 'activeClass ThemeBorderColor3 ThemeBGColor3' : ''}}" data-type='custom'>{{= _l('\u81EA\u5B9A\u4E49')}}</li>
            </ul>
            {{?}}
            {{?it.type === 2}}
            <div class="folderChartChargeBox">
                <i class="{{=it.sort === 'desc' ? 'icon-descending-order' : 'icon-ascending-order'}} folderChartChargeSort"></i>
                <span class="folderChartChargeBtn"><span class="folderChartChargeTxt">{{=it.isAuto ? _l('\u6240\u6709\u8D1F\u8D23\u4EBA') : _l('\u5DF2\u9009\u62E9%0\u4EBA', it.chargeAccountIDs.length)}}</span><i class="icon-arrow-down-border"></i></span>
            </div>
            {{?}}
            {{?isScroll}}
            <div class="folderChartMaxHeight">
            {{?}}
            <div class="folderChartModel {{=it.type === 3 ? 'folderChartUpdateHeight' : ''}}" id="folderChartsMax" {{=maxH !== '' ? maxH : ''}}>{{=LoadDiv()}}</div>
            {{?isScroll}}
            </div>
            {{?}}
        </div>
    </div>
</div>
`},99230:U=>{U.exports=`{{~it.data:folder}}
    {{ var folderName = folder.folderName ? folder.folderName : _l('\u672A\u5173\u8054\u9879\u76EE'); }}
    <div class="taskListFolderName" data-folderid="{{=folder.folderID || 1 }}">
        <i class="arrow-down"></i>
        <span class="listFolderNameTextList" title="{{!folderName }}">{{!folderName }}</span>
    </div>
    <div class="listStageTaskContent">
        <table cellpadding="0" cellspacing="0">
            <tbody>
                {{~folder.tasks:task:index}}
                {{?task.charge}}
                {{ var statusObj = it.formatStatus(task.status, task.locked, task.auth); }}
                    #include.nodeCommTr
                {{??}}
                  {{console.log(task);}}
                {{?}}
                {{~}}
            </tbody>
        </table>
    </div>
{{~}}
`},45005:U=>{U.exports=`
{{ var projectID = task.projectID,
    taskID = task.taskID,
    taskName = task.taskName,
    stageID = task.stageID ? 'data-stageid="' + task.StageID + '"' : '',
    auth = statusObj.auth,
    topicCount = task.notificationCount,
    subTaskCount = task.subCount,
    subCompleteCount = task.completedNum,
    statusTip = statusObj.tip,
    statusStyle = statusObj.style,
    isNewTask = task.newTask,
    isComplete = task.status==1,
    completeTime = it.formatTaskTime(task.status == 1, task.startTime, task.deadline, task.actualStartTime, task.completeTime),
    userClass = task.charge.status != 1 ? 'userdisable' : '',
    userHead = task.charge.avatar,
    userAuth = task.auth,
    accountId = task.charge.accountID,
    starClass = task.star ? 'icon-task-star' : 'icon-star-hollow',
    totalItemCount = task.totalItemCount,
    totalCompletedItemCount = task.totalCompletedItemCount;
}}
{{? index < 4 && !it.createNewTask && it.isAnimated }}
<tr class="animatedFarFast">
    {{ var height = index==0 ? 80: 20 + index*20 + 'px', opacity = index==0? 0.7 : 1-index*0.3; }}
    <td colspan="5" style="height:{{=height}};" class="animatedFarFast">
        <div class="maskBoxShadow"></div>
    </td>
</tr>
<tr data-taskid="{{=taskID}}" data-projectid="{{=projectID}}" class="onlyFourTr" style="opacity:{{=opacity}};" data-isNotice="{{=task.isNotice}}" data-auth="{{= auth }}" {{= stageID }}>
{{??}}
<tr data-taskid="{{=taskID}}" data-projectid="{{=projectID}}" class="otherTrs" style="{{= !it.createNewTask && it.isAnimated ? 'opacity: 0;' : ''}}"  data-isNotice="{{=task.isNotice}}" data-auth="{{=auth }}" {{=stageID }}>
{{?}}
    <td class="markComplete {{=it.isMyTask ? 'myTask':''}}">
        {{?it.isMyTask}}
        <span class="myTaskTag">
            {{= it.buildMyTaskIcon(type) }}
        </span>
        {{?}}
        <span tip="{{= statusTip }}" class="markTask {{= statusStyle }}"></span>
    </td>
    <td class="Relative taskListContainer">
        <div class="taskListName">
            {{?task.colorTags && task.colorTags.length}}
            <div class="colorTagsDiv">
              {{~task.colorTags:tag}}
              <span class="colorTagCircle" style="background:{{=tag.color}}"></span>
              {{~}}
            </div>
            {{?}}
            {{? isNewTask && !it.hideOpts }}
            <span class="newTaskTip boderRadAll_3">{{= _l('\u65B0\u4EFB\u52A1') }}</span>
            {{?}}
            <span class="overflow_ellipsis spanName boxSizing {{= isNewTask && !it.hideOpts ?'newTaskTipName':''}} {{= isComplete ? 'completeTask' : '' }}" title="{{!taskName}}" style="{{=topicCount > 0 ? '' : 'border-right-width: 0;' }}">{{!taskName}}</span>
            {{? topicCount > 0 && !it.hideOpts }}
            <span class="icon-replyto newTopic"><span class="newTopicCount">{{=topicCount}}</span></span>
            {{?}}
        </div>
    </td>
    <td class="taskListDate rightGap">
        {{? subTaskCount }}
        <span class="taskTagsBG">
            <i class="icon-task-card" tip="{{= _l('\u5B50\u4EFB\u52A1') }}"></i>
            <span class="subCounts"><span class="completedNum">{{=subCompleteCount > subTaskCount ? subTaskCount : subCompleteCount}}</span>/<span class="subCount">{{=subTaskCount}}</span></span>
        </span>
        {{?}}
        {{? totalItemCount > 0}}
        <span class="taskTagsBG mLeft10">
            <i class="icon-task-list Font14 cardColor" tip="{{= _l('\u68C0\u67E5\u6E05\u5355') }}"></i>
            <span class="mLeft5 cardColor">{{=totalCompletedItemCount}}/{{=totalItemCount}}</span>
        </span>
        {{?}}
        <span class="deteLine mLeft10 {{=completeTime ? '' : 'mp0'}}" data-start="{{=task.startTime}}" data-end="{{=task.deadline}}" data-actdate="{{=task.actualStartTime}}" data-comdate="{{=task.completeTime}}">{{=completeTime}}</span>
    </td>
    <td class="chargeTd updateUserHead" data-src="{{=userHead}}" data-auth="{{=userAuth}}" data-id="{{=accountId}}">
        <img class="circle chargeImg {{=userClass}}" src="{{=userHead}}"/>
    </td>
    <td class="markStar"><i class="taskStar mLeft2 ThemeColor3 {{= starClass }}"></i></td>
</tr>
`},64325:U=>{U.exports=`{{ var tasks=it.tasks || it.task; }}
{{~tasks:task:index}}
{{?task.charge}}
  {{ var statusObj = it.formatStatus(task.status, task.locked, task.auth), type = it.type!==undefined ? it.type: 0; }}
  #include.nodeCommTr
{{??}}
  {{console.log(task);}}
{{?}}
{{~}}`},97764:U=>{U.exports=`{{? !it.isExists }}
<div class="listStageTaskContent">
    <table cellpadding="0" cellspacing="0">
{{?}}
{{ var statusObj= {auth:1, style:'', tip: _l('\u6807\u8BB0\u5B8C\u6210') }, type = it.type!==undefined ? it.type : 0; }}

{{~ [it.task]:task:index}}
#include.nodeCommTr
{{~}}
{{? !it.isExists }}
    </table>
</div>
{{?}}
`},47729:U=>{U.exports=`{{? it.pageIndex == 1}}
<div class="listStageTaskContent">
  <table cellpadding="0" cellspacing="0">
{{?}}
  {{~it.data:task:index}}
    {{?task.charge}}
      {{ var statusObj = it.formatStatus(task.status, task.locked, task.auth); }}
      #include.nodeCommTr
    {{??}}
      {{console.log(task);}}
    {{?}}
  {{~}}
{{? it.pageIndex == 1}}
  </table>
</div>
{{?}}`},54427:U=>{U.exports=`{{ var i = 0;}}
{{ for (var key in it.TYPES) { }}
{{ var isCollapsed = it.FilterMeTaskClassify.indexOf(+key) > -1; }}
<div class="persist-area {{=it.data['num_' + i] === 0 ? 'Hidden' : ''}}">
    <div class="taskListFolderName persist-header" data-type="{{= key }}">
        <i class="arrow-down {{= isCollapsed ? 'downArrow':''}}"></i>
        <span class="listFolderNameTextList myTaskTip" data-tip="{{=it.TIPS[key] }}">{{=it.TYPES[key] }}</span>
        <span class="stageTaskCount"></span>
    </div>
    <div class="listStageTaskContent" style="{{= isCollapsed ? 'display:none':'display:block'}}">
        <table cellpadding="0" cellspacing="0" data-type="{{=key }}">
            <tbody>
                {{ var tasks = it.data['classify_' + key], taskcount= tasks && tasks.length, type = parseInt(key); }}
                {{~tasks:task:index}}
                    {{?task.charge}}
                        {{ var statusObj = it.formatStatus(task.status, task.locked, task.auth); }}
                        #include.nodeCommTr
                    {{??}}
                        {{console.log(task);}}
                    {{?}}
                {{~}}
            </tbody>
        </table>
    </div>
</div>
{{ i++;}}
{{ } }}
`},69754:U=>{U.exports=`{{~it:list:i}}
<div class="networkFolderList {{=it.length === 1 ? 'networkOnly' : ''}} {{=list.licenseType || !list.projectId ? '' : 'networkFolderOpacity'}}" data-projectid="{{=list.projectId}}" data-null="{{=list.projectId || 'null'}}">
  <div class="allFolders relative ThemeColor9">
    <span class="overflow_ellipsis">{{!list.companyName}}</span>{{=list.licenseType || !list.projectId ? '' : '\uFF08\u5230\u671F\uFF09'}}
    <i class="folderNewTip circle Hidden"></i>
    <i class="clipLoader Hidden"></i>
    <span class="networkFolderListLabel ThemeColor8">{{=_l('\u5C55\u5F00')}}</span>
  </div>
  <ul class="folderList">
    <li class="slideFolders Hidden" data-id="4">
      <div class="slideFolderTitle">
          <i class="icon-public-folder-hidden ThemeColor8"></i><span class="pigeonholeFolderName ThemeColor9">{{=_l('\u5DF2\u9690\u85CF\u9879\u76EE') }}</span>
          <i class="icon-arrow-down-border Right animated initFilp ThemeColor8 ThemeHoverColor9"></i>
      </div>
      <ul class="slideFolderList commFolderUl"></ul>
    </li>
    <li class="pigeonholeFolder Hidden" data-id="2">
      <div class="pigeonholeFolderTitle">
        <i class="icon-task-pigeonhole ThemeColor8"></i><span class="pigeonholeFolderName ThemeColor9">{{=_l('\u5DF2\u5F52\u6863\u9879\u76EE') }}</span><i class="icon-arrow-down-border Right animated initFilp ThemeColor8 ThemeHoverColor9"></i>
      </div>
      <ul class="pigeonholeFolderList commFolderUl"></ul>
    </li>
    <li class="nullFolderTask Hidden" data-id="1">
      <i class="icon-task-point-more iconNullFolderTask ThemeColor8"></i><span class="nullFolderText ThemeColor9">{{=_l('\u672A\u5173\u8054\u9879\u76EE\u7684\u4EFB\u52A1') }}</span>
    </li>
  </ul>
</div>
{{~}}
`},44748:U=>{U.exports=`{{~it:file}}
    {{ var isFolderOpen = file.folderList, folderIcon = file.folderList ? 'icon-folder-open' : 'icon-task-folder-solid'; }}
    <li class="projectFolder" data-fileid="{{=file.fFileID}}" data-id="3" data-projectid="{{=file.projectID}}">
        <div class="folderTitle">
            <i class="titleIcon folderHeadIcon {{=folderIcon }}"></i>
            <span class="txtProjectName overflow_ellipsis ThemeColor10">{{!file.fFileName}}</span>
            <input value="{{!file.fFileName }}" title="{{!file.fFileName }}" class="Hidden txtProjectNameEdit overflow_ellipsis ThemeColor10">
            {{? file.isNotice}}
            <i class="titleIcon folderNewTip circle"></i>
            {{?}}
            <span class="flex"></span>
            <i class="icon-task-point-more titleIcon moreOp ThemeColor8 ThemeHoverColor10 {{=isFolderOpen ? 'InlineBlock': ''}}"></i>
            <i class="icon-arrow-down-border initFilp titleIcon downShow animated ThemeColor8 ThemeHoverColor10 {{=isFolderOpen ? ' filp': '' }}"></i>
        </div>
        <ul class="projectFolderUl commFolderUl Hidden" {{=isFolderOpen ? 'style="display: block;"': '' }}>
            {{~file.folderList:folder}}
                #include.singleFolderComm
            {{~}}
        </ul>
    </li>
{{~}}
`},15177:U=>{U.exports=`<div class="topFolderList ThemeBorderColor7">
  <div class="popTops ThemeColor8">
    {{=_l('\u7F6E\u9876\u9879\u76EE') }}
    <span class="topFolderState ThemeColor8">{{=_l('\u9690\u85CF')}}</span>
  </div>
  <ul class="folderList">
    #include.singleFolder
  </ul>
</div>`},3583:U=>{U.exports=`{{ var statusObj; }}
{{~it:task}}
  {{ statusObj=it.formatStatus(task.status,task.locked,task.auth);}}
    #include.nodeLiComm 
{{~}}`},49334:U=>{U.exports=`<li class="singleStage mLeft5 taskStageAnimation">
    <div class="stageHeader boderRadAll_3 ">
        <input class="txtAddNew boderRadAll_3 ThemeBorderColor3" maxlength="100" value="" placeholder="{{=_l('\u586B\u5199\u770B\u677F\u540D\u79F0')}}" />
        <span class="stageChargeAvatar circle Hidden updateUserHeadSign" ></span>
        <span class="listStageName overflow_ellipsis Hidden">{{=_l('\u65B0\u770B\u677F')}}</span>
        <span class="listStageTaskCount"></span>
        <span class="Right icon-arrow-down-border Relative Hidden"></span>
    </div>
    <div class="stageContentBox boderRadAll_3">
        <div class="listStageContent">
            <ul></ul>
        </div>
    </div>
    <a class="bottomNewBox borderBottomRadius_3">
        <span class="btnBottomNew ThemeBGColor3 Hidden">+ {{=_l('\u65B0\u4EFB\u52A1') }}</span>
    </a>
</li>
`},98:U=>{U.exports=`<li class="addNewTask boderRadAll_3">
    <div class="topBox ThemeBorderColor3">
        <div class="teaStageNameBox boxSizing">
            <textarea class="teaStageName boxSizing" maxlength="100" placeholder="{{=_l('\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0')}}"></textarea>
        </div>
    </div>
    <img data-id="{{=it.accountId}}" class="chargeHeaderAvatar circle" src="{{=it.avatar}}" alt="">
    <i class="taskStar icon-star-hollow"></i>
    <span class="btnStagCreateTask ThemeBGColor3 ThemeHoverBGColor2">{{=_l('\u786E\u8BA4')}}</span>
    <span class="stageDate"></span>
</li>
`},90443:U=>{U.exports=`{{? it.isCreateNew}}
{{ var statusObj={auth:1,style:'',tip:'{{=_l('\u6807\u8BB0\u5B8C\u6210') }}' };  }}
{{ var task=it.task; }}
{{? }}
<li class="boderRadAll_3 singleTaskStage" data-taskid="{{=task.taskID}}" data-auth="{{=statusObj.auth}}" data-stageid="{{=task.stageID}}">
    <span class="markTask {{=statusObj.style }}" tip="{{=statusObj.tip}}"></span>
    <span class="listStageTaskName {{=task.status==1?'completeTask':''}}" title="{{!task.taskName}}">
        {{!task.taskName}}
    </span>
    <span class="chargeHeaderAvatar updateUserHead circle chargeImg {{=task.charge.status!=1?'userdisable':''}} {{=task.status==1?'opacity6':''}}" data-auth="{{=task.auth}}" data-src="{{=task.charge.avatar}}" data-id="{{=task.charge.accountID}}">
        <img class="circle {{=task.charge.status!=1?'userdisable':''}} {{=task.status==1?'opacity6':''}}" data-auth="{{=task.auth}}" src="{{=task.charge.avatar}}" alt="" data-id="{{=task.charge.accountID}}" />
    </span>
    <i class="taskStar ThemeColor3 {{=task.star ? 'icon-task-star':'icon-star-hollow'}}"></i>
    <div class="listStageDate">
        {{?task.colorTags && task.colorTags.length}}
        <div class="colorTagsDiv mTop3 mRight10">
            {{~task.colorTags:tag}}
            <span class="colorTagCircle" style="background:{{=tag.color}}"></span> {{~}}
        </div>
        {{?}}
        {{?task.subCount}}
        <span class="taskTagsBG mTop3 mRight10">
            <i class="icon-task-card" tip="{{=_l('\u5B50\u4EFB\u52A1')}}"></i>
            <span class="subCounts"><span class="completedNum">{{=task.completedNum > task.subCount ? task.subCount : task.completedNum}}</span>/<span class="subCount">{{=task.subCount}}</span></span>
        </span>
        {{?}}
        {{? task.totalItemCount > 0}}
        <span class="taskTagsBG mTop3 mRight10">
            <i class="icon-task-list Font14 cardColor" tip="{{=_l('\u68C0\u67E5\u6E05\u5355')}}"></i>
            <span class="mLeft5 cardColor">{{=task.totalCompletedItemCount}}/{{=task.totalItemCount}}</span>
        </span>
        {{?}}
        <span class="deteLine mTop3" data-start="{{=task.startTime}}" data-end="{{=task.deadline}}" data-actdate="{{=task.actualStartTime}}" data-comdate="{{=task.completeTime}}">{{=it.formatTaskTime(task.status == 1, task.startTime, task.deadline, task.actualStartTime, task.completeTime)}}</span>
    </div>
    {{?task.showControls.length}}
    <div class="listStageCustomBox">
    {{~task.showControls:item:index}}
    {{item.value = it.returnCustonValue(item);}}
    {{item.value = item.type === 28 && item.value === '0' ? '' : item.value;}}
    {{?item.value}}
        <div class="listStageCustomItem">
            {{?item.type !== 28}}
                <div class="listStageCustomItemDesc Font12"><span class="listStageCustomItemColor">{{=item.controlName}}\uFF1A</span>{{!item.value}}{{=item.type === 6 || item.type === 8 ? item.unit : ''}}</div>
            {{??}}
                <div class="flexRow Font12">
                    <span class="mRight10"><span class="listStageCustomItemColor"><span class="overflow_ellipsis">{{=item.controlName}}</span>\uFF1A</span>{{=item.enumDefault !== 1 ? item.value + '/10' : ''}}</span><span class="listStageCustomItemStar flex" data-type="score" data-enum="{{=item.enumDefault}}" data-score="{{=item.value}}"></span>
                </div>
            {{?}}
        </div>
    {{?}}
    {{~}}
    </div>
    {{?}}
</li>
`},19524:U=>{U.exports=`<ul class="listStage">
    <ul class="listStageDownOperator boderRadAll_3 boxShadow5" style="display: none;">
        <li class="updateStageName">{{=_l('\u4FEE\u6539\u770B\u677F\u540D\u79F0')}}</li>
        <li class="addNewStageToNext">{{=_l('\u5728\u6B64\u540E\u6DFB\u52A0\u65B0\u770B\u677F')}}</li>
        <li class="stageCharge">
            <span class="text mRight5">{{=_l('\u8BBE\u7F6E\u9ED8\u8BA4\u8D1F\u8D23\u4EBA')}}</span>
            <span data-tip="{{=_l('\u8BBE\u7F6E\u8D1F\u8D23\u4EBA\u540E\uFF0C\u51E1\u65B0\u6DFB\u52A0\u8FDB\u6B64\u770B\u677F\u7684\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u4F1A\u88AB\u7EDF\u4E00\u8BBE\u7F6E\u6240\u9009\u7684\u770B\u677F\u8D1F\u8D23\u4EBA')}}">
                <i class="icon-info Font14" />
            </span>
        </li>
        <li class="listStageDownOperatorHr" />
        <li class="delStage">{{=_l('\u5220\u9664\u770B\u677F')}}</li>
    </ul>
    {{~it.stages:stage}}
        <li class="singleStage" data-stageid="{{=stage.id}}" data-chargeid="{{=stage.owner.accountID}}" data-avatar="{{=stage.owner.avatar}}" data-edit="{{=it.isEdit}}">
            <div class="stageHeader boderRadAll_3">
                <span class="stageChargeAvatar updateUserHeadSign circle {{=!stage.chargeAccountID ? 'Hidden' : ''}}" data-src="{{=stage.owner.avatar}}">
                    <img class="circle {{=!stage.chargeAccountID ? 'Hidden' : ''}}" src="{{=stage.owner.avatar}}">
                </span>
                <span class="listStageName overflow_ellipsis">{{!stage.name}}</span>
                <span class="listStageTaskCount">{{=stage.count > 0 ? ' (<span class="taskCount">'+ stage.count +'</span>)' : '' }}</span>
                {{? it.isEdit }}
                <span class="Right icon-arrow-down-border Relative ThemeColor3"></span>
                {{? }}
            </div>
            <div class="stageContentBox boderRadAll_3 bottomNullAdd" data-page='1'>
                <div class="listStageContent">
                    <ul>
                        {{? stage.tasks}}
                            {{var statusObj; }}
                            {{~stage.tasks:task}}
                                {{?task.charge}}
                                    {{ statusObj=it.formatStatus(task.status,task.locked,task.auth); }}
                                    #include.nodeLiComm
                                {{??}}
                                    {{console.log(task);}}
                                {{?}}
                            {{~}}
                        {{?}}
                    </ul>
                </div>
            </div>
            <a class="bottomNewBox borderBottomRadius_3">
                <span class="btnBottomNew ThemeBGColor3">+ {{=_l('\u65B0\u4EFB\u52A1') }}</span>
            </a>
        </li>
    {{~}}
    {{? it.isEdit}}
        <li class="addNewStage"><i class="icon-plus"></i>{{=_l('\u65B0\u5EFA\u770B\u677F') }}</li>
    {{?}}
</ul>
`},88991:(U,rt,k)=>{"use strict";k.r(rt),k.d(rt,{default:()=>nn});var ra=k(85105),G=k.n(ra),j=k(99663),R=k(22600),Y=k(49135),W=k(93196),n=k(67294),sa=k(52945),ee=k.n(sa),ce=k(57853),ve=k(54208),ue=k(88239),ge=k(12424),na=k(86735),se=k(73935),L=k(96213),I=k(52106),re=k(96841),ia=k(38197),Z=k.n(ia),oa=k(70809),Ue=k.n(oa),la=k(94848),We=k.n(la),da=k(15177),ca=k.n(da),ua=k(69754),fa=k.n(ua),ma=k(44748),st=k.n(ma),ie=k(70801),pa=k(93967),w=k.n(pa),oe=k(15577),on=k(37846),nt=k(82832),ha=k(96486),y=k.n(ha),it,ot,va=(ot=it=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l)),t=l.projectId,a=_l("\u4E2A\u4EBA");if(!t){var r=window.localStorage.getItem("lastProjectId");r!==null?t=r:md.global.Account.projects.length&&(t=md.global.Account.projects[0].projectId)}return $.map(md.global.Account.projects,function(s,i){if(t===s.projectId&&s.licenseType===0){t="";return}}),y().findIndex(md.global.Account.projects,function(s){return s.projectId===t})===-1&&(t=""),$.map(md.global.Account.projects,function(s,i){if(s.projectId===t){a=s.companyName;return}}),e.state={projectId:t,companyName:a,showNetworkList:!1,showRangeBox:!1,onlyMemberLook:!0,visible:!0},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=this;$("#folderName").select(),e.bindSelectGroup(),$(document).off(".createFolder").on("click.createFolder",function(t){var a=$(t.target);!a.closest(".createFolderNetworkList").length&&!a.closest(".createFolderNetwork").length&&$(".createFolderNetworkList").is(":visible")&&e.setState({showNetworkList:!1}),!a.closest(".createFolderRangeBox").length&&!a.closest(".createFolderBox").length&&$(".createFolderRangeBox").is(":visible")&&e.setState({showRangeBox:!1})})}},{key:"networkSelect",value:function(e,t){var a=this;e!==this.state.projectId&&(0,oe.pF)(e).then(function(){a.setState({companyName:t,projectId:e},function(){a.bindSelectGroup()})}).catch(function(){a.setState({companyName:_l("\u4E2A\u4EBA"),projectId:""},function(){a.bindSelectGroup()})}),this.setState({showNetworkList:!1,onlyMemberLook:!0}),$(".SelectAllGroup").css("display","none")}},{key:"rangeSelect",value:function(e){this.setState({onlyMemberLook:e}),e?$(".SelectAllGroup").css("display","none"):$(".SelectAllGroup").css("display","inline-block")}},{key:"bindSelectGroup",value:function(){$("#privateRange").SelectGroup({isShowSelectProject:!1,projectId:this.state.projectId,autoPosition:!0,isMe:!1,everyoneOnly:!0,createGroupInProject:!0,maxHeight:260})}},{key:"folderNameKeyDown",value:function(e){e.keyCode===13&&this.create()}},{key:"create",value:function(){var e=this,t=$.trim($("#folderName").val()),a=void 0,r=[],s=$("#privateRange").SelectGroup("getScope");if(t.length===0)return alert(_l("\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0"),3),!1;if(this.state.onlyMemberLook)a=0;else{if(!s||s.shareGroupIds.length===0&&s.shareProjectIds.indexOf(this.state.projectId)===-1)return alert(_l("\u8BF7\u9009\u62E9\u516C\u5F00\u7684\u8303\u56F4"),3),!1;s.shareProjectIds.indexOf(this.state.projectId)>-1?(a=2,r.push("everyone")):(a=1,r=s.shareGroupIds)}L.Z.addFolder({mdAppId:this.props.mdAppId,folderName:t,projectId:this.state.projectId,visibility:a,groupID:r.join(","),templateId:this.props.templateId}).then(function(i){i.status?(e.props.onClose(),safeLocalStorageSetItem("lastProjectId",e.state.projectId),alert(_l("\u521B\u5EFA\u6210\u529F")),$.isFunction(e.props.createFolderCallback)&&e.props.createFolderCallback(i.data)):alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01"),2)})}},{key:"render",value:function(){var e=this,t={height:$(window).height()-180,overflow:"hidden"},a={overlayClosable:!1,visible:this.state.visible,width:1e3,onClose:this.props.onClose};return n.createElement(nt.Z,a,n.createElement("div",{className:"flexRow",id:"createFolder"},n.createElement("div",{className:"flex"},n.createElement("div",{className:"createFolderHead relative Font13"},_l("\u6A21\u677F\u9884\u89C8"),n.createElement("span",{className:"createFolderReturn ThemeColor3",onClick:function(){return e.props.onClose()}},n.createElement("i",{className:"mRight5 icon-knowledge-return"}),_l("\u8FD4\u56DE"))),n.createElement("div",{className:"createFolderSlider"},this.props.materials.filter(function(r,s){return s===0}).map(function(r,s){return n.createElement("div",{style:(0,ue.default)({},t),key:s},n.createElement("img",{src:r}))}))),n.createElement("div",{className:"folderBox relative"},n.createElement("div",{className:"folderBoxImg"},n.createElement("img",{src:this.props.background})),n.createElement("div",{className:"folderBoxPadding"},n.createElement("input",{type:"text",id:"folderName",className:"ThemeBorderColor3 boxSizing",maxLength:"100",onKeyDown:function(s){return e.folderNameKeyDown(s)},placeholder:_l("\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0"),defaultValue:this.props.templateId?this.props.templateName:""})),md.global.Account.projects.length?n.createElement("div",{className:"folderBoxPadding"},n.createElement("div",{className:"folderBoxDesc"},_l("\u5F52\u5C5E")),n.createElement("div",{className:w()("createFolderNetwork",{cursorDefault:this.props.projectId}),onClick:function(){return!e.props.projectId&&e.setState({showNetworkList:!e.state.showNetworkList})}},n.createElement("span",{className:"createFolderNetworkName"},this.state.companyName),!this.props.projectId&&n.createElement("i",{className:"icon-arrow-down-border"})),n.createElement("ul",{className:w()("createFolderNetworkList boxShadow5 boderRadAll_3",{Hidden:!this.state.showNetworkList})},md.global.Account.projects.map(function(r,s){return n.createElement("li",{className:"ThemeBGColor3",key:s,onClick:function(){return e.networkSelect(r.projectId,r.companyName)}},n.createElement("i",{className:"icon-company"}),r.companyName)}),n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.networkSelect("",_l("\u4E2A\u4EBA"))}},n.createElement("i",{className:"icon-charger"}),_l("\u4E2A\u4EBA")))):void 0,n.createElement("div",{className:"folderBoxPadding folderBoxDesc folderBoxMargin"},_l("\u516C\u5F00\u8303\u56F4\uFF1A")),n.createElement("div",{className:"folderBoxPadding"},n.createElement("span",{className:"createFolderBox",onClick:function(){return e.setState({showRangeBox:!e.state.showRangeBox})}},n.createElement("div",{className:"createFolderRange"},this.state.onlyMemberLook?_l("\u4EC5\u9879\u76EE\u6210\u5458\u53EF\u89C1"):_l("\u516C\u5F00\u7ED9\u6307\u5B9A\u7FA4\u7EC4")),n.createElement("i",{className:"icon-arrow-down-border"}),n.createElement("ul",{className:w()("createFolderRangeBox boderRadAll_3 boxShadow5",{Hidden:!this.state.showRangeBox})},n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.rangeSelect(!0)}},n.createElement("div",{className:w()("text",{ThemeColor3:this.state.onlyMemberLook})},_l("\u4EC5\u9879\u76EE\u6210\u5458\u53EF\u89C1")),n.createElement("div",{className:"descTip"},_l("\u53EA\u6709\u6DFB\u52A0\u4E3A\u9879\u76EE\u6210\u5458\u624D\u53EF\u4EE5\u67E5\u770B\u9879\u76EE"))),n.createElement("li",{className:"createFolderLine"}),n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.rangeSelect(!1)}},n.createElement("div",{className:w()("text",{ThemeColor3:!this.state.onlyMemberLook})},_l("\u516C\u5F00\u7ED9\u6307\u5B9A\u7FA4\u7EC4")),n.createElement("div",{className:"descTip"},_l("\u6240\u9009\u8303\u56F4\u5185\u7684\u6240\u6709\u4EBA\u90FD\u53EF\u4EE5\u67E5\u770B\u9879\u76EE"))))),n.createElement("input",{type:"hidden",id:"privateRange"})),n.createElement("div",{className:"createFolderBtn"},n.createElement("span",{className:"createFolderBtnCancel ThemeColor3",onClick:function(){return e.props.onClose()}},_l("\u53D6\u6D88")),n.createElement("span",{className:"createFolderBtnSave ThemeBGColor3",onClick:function(){return e.create()}},_l("\u786E\u5B9A"))))))}}]),d}(n.Component),it.defaultProps={mdAppId:"",projectId:"",templateId:"",templateName:"",createFolderCallback:null,background:"",materials:[]},ot),ga=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={selectType:"",templateType:[],templates:[],showCreateFolder:!1},e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){var e=this;L.Z.getTemplateTypes({appid:this.props.appId}).then(function(t){e.setState({selectType:t.data.templateType[0].templateTypeId,templateType:t.data.templateType,templates:t.data.templates})})}},{key:"componentWillUnmount",value:function(){$("#folderTemplate_mask, #folderTemplate_container").remove()}},{key:"getTemplates",value:function(e){var t=this;this.setState({templates:[],selectType:e}),L.Z.getTemplatesByTemplateTypeId({templateTypeId:e}).then(function(a){t.setState({templates:a.data})})}},{key:"folderTemplateListClick",value:function(e,t,a){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];this.createFolder(e,t,a,r)}},{key:"createFolder",value:function(e,t,a,r){this.setState({templateId:e,templateName:t,showCreateFolder:!0,background:a,materials:r})}},{key:"delTemplate",value:function(e,t){var a=this;t.stopPropagation(),ie.Z.confirm({title:_l("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F"),children:n.createElement("div",null,_l("\u6A21\u677F\u88AB\u5220\u9664\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D")),okText:_l("\u5220\u9664"),onOk:function(){L.Z.removeMyFolderTemplateOne({templateId:e}).then(function(s){if(s.status){alert(_l("\u5220\u9664\u6210\u529F"));var i=a.state.templates;y().remove(i,function(o){return o.templateId===e}),a.setState({templates:i})}else(0,I.N3)(s.error)})}})}},{key:"render",value:function(){var e=this,t=this.state.templateType,a=this.state.templates;return n.createElement(ie.Z,{className:"folderTemplate",visible:!0,width:t.length===1?615:760,title:_l("\u65B0\u5EFA\u9879\u76EE"),showFooter:!1,onCancel:this.props.onClose},t.length===0?n.createElement(ve.Z,null):n.createElement("div",{className:"flexRow"},t.length>1&&n.createElement("ul",{className:"folderTemplateSidebar"},t.map(function(r,s){return n.createElement("li",{className:w()({ThemeColor3:r.templateTypeId===e.state.selectType}),key:s,onClick:function(){return e.getTemplates(r.templateTypeId)}},n.createElement("i",{className:r.templateTypeIcon}),r.templateTypeName)})),n.createElement("ul",{className:"flex folderTemplateList"},a.length?void 0:n.createElement(ve.Z,null),a.filter(function(r){return r.templateId||!r.templateId&&e.state.selectType==="0"}).map(function(r,s){return n.createElement("li",{className:w()("boderRadAll_3",r.templateId===""?"folderTemplateNull ThemeColor3 ThemeBorderColor3":""),key:s,style:{backgroundImage:"url("+r.icon+")"},onClick:function(){return e.folderTemplateListClick(r.templateId,r.templateName,r.background,r.materials)}},n.createElement("div",{className:w()("folderTemplateItem ellipsis",{folderTemplateItemPosition:r.templateId})},r.templateId?void 0:n.createElement("i",{className:"icon-addapplication"}),r.templateName),r.templateId?n.createElement("div",{className:"folderTemplateBG"}):void 0,r.templateId?n.createElement("div",{className:"folderTemplateDesc"},n.createElement("div",null,r.title?r.title:n.createElement("span",{className:"Font15"},r.templateName))):void 0,r.templateId?n.createElement("div",{className:"folderTemplateOperator"},r.isCustom?n.createElement("span",{className:"ThemeColor3 tip-top","data-tip":_l("\u5220\u9664\u6A21\u677F"),onClick:function(o){return e.delTemplate(r.templateId,o)}},n.createElement("i",{className:"icon-task-new-delete"})):void 0):void 0)}))),this.state.showCreateFolder?n.createElement(va,{mdAppId:this.props.appId,projectId:this.props.projectId,templateId:this.state.templateId,templateName:this.state.templateName,createFolderCallback:this.props.callback,background:this.state.background,materials:this.state.materials,onClose:function(){e.setState({showCreateFolder:!1})}}):void 0)}}]),d}(n.Component),B=k(57482),S=k(51443),ke=k(75809),Ae=k(15405),$e=k(33126),ka=(0,$e.Z)(Ae.Z),lt=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={accountId:md.global.Account.accountId,avatar:md.global.Account.avatar,showNetwork:!1,projectId:l.projectId,taskAccountId:md.global.SystemAccounts.undefined.accountId,taskAvatar:md.global.SystemAccounts.undefined.avatar},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){$(".copyFolder").on("click",".checkOperation:not(.noClick)",function(){var e="checkOperation ";$(this).toggleClass("checked"),$(this).is($("#copyChargeUser"))&&$("#copyChargeUse").siblings(".chargeUserBox").toggleClass("Hidden"),$(this).is($("#copyTaskChargeUser"))&&$("#copyTaskChargeUser").siblings(".chargeUserBox").toggleClass("Hidden"),$(this).is($("#copyStages"))&&(e+=$(this).hasClass("checked")?"checked":"noClick",$("#copyAllTask, #copyAllTaskMember, #copyAllTaskDesc, #copyAllTaskAtts").removeClass().addClass(e)),$(this).is($("#copyAllTask"))&&(e+=$(this).hasClass("checked")?"checked":"noClick",$("#copyAllTaskMember, #copyAllTaskDesc, #copyAllTaskAtts, #copyTaskChargeUser").removeClass().addClass(e),$(this).hasClass("checked")||$("#copyTaskChargeUser").siblings(".chargeUserBox").addClass("Hidden"))})}},{key:"chargeTaskUserBtn",value:function(){var e=this,t=this.props,a=t.taskId,r=t.projectId,s=this.state.accountId;(0,ke.Z)({sourceId:a,title:_l("\u9009\u62E9\u8D1F\u8D23\u4EBA"),showMoreInvite:!1,fromType:2,SelectUserSettings:{filterAccountIds:[s],projectId:r,unique:!0,callback:function(o){e.setState({taskAccountId:o[0].accountId,taskAvatar:o[0].avatar})}}})}},{key:"chargeUserBtn",value:function(){var e=this,t=this.props,a=t.taskId,r=t.projectId,s=this.state.accountId;(0,ke.Z)({sourceId:a,title:_l("\u9009\u62E9\u8D1F\u8D23\u4EBA"),showMoreInvite:!1,fromType:2,SelectUserSettings:{filterAccountIds:[s],projectId:r,unique:!0,callback:function(o){e.setState({accountId:o[0].accountId,avatar:o[0].avatar})}}})}},{key:"submit",value:function(){var e=this,t=$.trim($("#copyFolderName").val());if(!t)return alert("\u9879\u76EE\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),!1;L.Z.duplicateFolder({projectId:this.state.projectId,folderID:this.props.folderId,chargeAccountID:$("#copyChargeUser").hasClass("checked")?this.props.chargeUser:this.state.accountId,taskChargeAccountID:$("#copyTaskChargeUser").hasClass("checked")?"":this.state.taskAccountId,folderName:t,hasDes:$("#copyDesc").hasClass("checked"),hasFolderMember:$("#copyFolderMember").hasClass("checked"),hasStage:$("#copyStages").hasClass("checked"),hasTask:$("#copyAllTask").hasClass("checked"),hasTaskMember:$("#copyAllTaskMember").hasClass("checked"),hasTaskDes:$("#copyAllTaskDesc").hasClass("checked"),hasTemplate:$("#copyFolderCustomContent").hasClass("checked"),hasTaskAtts:$("#copyAllTaskAtts").hasClass("checked"),appID:md.global.APPInfo.taskFolderAppID}).then(function(a){a.status?(e.props.callback(a.data),alert(_l("\u590D\u5236\u6210\u529F"))):(e.props.onClose(),(0,I.N3)(a.error))})}},{key:"checkMouseDownIsLeft",value:function(e){return e.button===0}},{key:"getNetWorkName",value:function(){var e=this,t="\u4E2A\u4EBA";return md.global.Account.projects.forEach(function(a){a.projectId===e.state.projectId&&(t=a.companyName)}),t}},{key:"switchNetwork",value:function(e){var t=this;(0,oe.pF)(e).then(function(){t.setState({projectId:e,showNetwork:!1})}).catch(function(){t.setState({projectId:"",showNetwork:!1})})}},{key:"render",value:function(){var e=this;return n.createElement(ie.Z,{visible:!0,className:"copyFolder",width:560,title:_l("\u590D\u5236\u9879\u76EE"),okText:_l("\u786E\u5B9A"),onOk:function(){return e.submit()},onCancel:this.props.onClose},n.createElement("div",{className:"copyDesc"},_l("\u901A\u8FC7\u590D\u5236\u9879\u76EE\uFF0C\u5FEB\u901F\u590D\u5236\u590D\u6742\u7684\u9879\u76EE\u770B\u677F\u5230\u65B0\u9879\u76EE\u4E2D")),this.props.isAdmin?n.createElement("div",{className:"copyTitleBox"},n.createElement("div",{className:"copyTitle copyTitleRight"},_l("\u5F52\u5C5E")),n.createElement("div",{className:"copyNetworkBox"},n.createElement("div",{className:"copyNetworkTitle pointer ThemeColor3",onMouseDown:function(a){return e.checkMouseDownIsLeft(a)&&e.setState({showNetwork:!e.state.showNetwork})}},n.createElement("span",{className:"copyNetworkName overflow_ellipsis"},this.getNetWorkName()),n.createElement("i",{className:"icon-arrow-down-border"})),this.state.showNetwork?n.createElement(ka,{component:"ul",className:"copyNetworkList boxShadow5 boderRadAll_3",onClickAway:function(){return e.setState({showNetwork:!1})}},md.global.Account.projects.map(function(t,a){return n.createElement("li",{key:a,className:"overflow_ellipsis ThemeColor3 ThemeBGColor3",onClick:function(){return e.switchNetwork(t.projectId)}},t.companyName)}),n.createElement("li",{className:"overflow_ellipsis ThemeColor3 ThemeBGColor3",onClick:function(){return e.switchNetwork("")}},_l("\u4E2A\u4EBA"))):void 0)):void 0,n.createElement("div",{className:this.props.isAdmin?"copyTitleBox pTop10":"copyTitleBox"},n.createElement("div",{className:"copyTitle"},_l("\u9879\u76EE\u6807\u9898")),n.createElement("input",{type:"text",id:"copyFolderName",defaultValue:_l("%0-\u7531%1\u590D\u5236",this.props.folderName,md.global.Account.fullname),className:"ThemeBorderColor3"})),n.createElement("div",{id:"copyOperation"},n.createElement("ul",null,n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyStages"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u770B\u677F\u4FE1\u606F"))),n.createElement("li",null,n.createElement("div",{className:"checkOperation",id:"copyChargeUser"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u8D1F\u8D23\u4EBA")),n.createElement("div",{className:"chargeUserBox"},n.createElement("img",{src:this.state.avatar,className:"circle chargeAvatar"}),n.createElement("i",{className:"icon-task-folder-charge pointer",id:"chargeUserBtn",onClick:function(){return e.chargeUserBtn()}}))),n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyDesc"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u9879\u76EE\u63CF\u8FF0"))),n.createElement("li",null,n.createElement("div",{className:"checkOperation",id:"copyFolderMember"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u9879\u76EE\u6210\u5458"))),n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyFolderCustomContent"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u5168\u90E8\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9"),n.createElement("span",{className:"mLeft5 copyTip","data-tip":_l("\u9879\u76EE\u7684\u5B57\u6BB5\u8BBE\u7F6E\u4F1A\u88AB\u590D\u5236\uFF0C\u6BCF\u6761\u4EFB\u52A1\u7684\u5177\u4F53\u5B57\u6BB5\u503C\u4E0D\u4F1A\u88AB\u590D\u5236")},n.createElement("i",{className:"icon-knowledge-message"}))))),n.createElement("hr",null),n.createElement("ul",null,n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyAllTask"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1"))),n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyAllTaskAtts"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u4EFB\u52A1\u9644\u4EF6"))),n.createElement("li",null,n.createElement("div",{className:"checked checkOperation",id:"copyAllTaskDesc"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u4EFB\u52A1\u63CF\u8FF0"))),n.createElement("li",null,n.createElement("div",{className:"checkOperation",id:"copyTaskChargeUser"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u4EFB\u52A1\u8D1F\u8D23\u4EBA")),n.createElement("div",{className:"chargeUserBox"},n.createElement("img",{src:this.state.taskAvatar,className:"circle chargeAvatar"}),n.createElement("i",{className:"icon-task-folder-charge pointer",id:"chargeTaskUserBtn",onClick:function(){return e.chargeTaskUserBtn()}}))),n.createElement("li",null,n.createElement("div",{className:"checkOperation",id:"copyAllTaskMember"},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u4EFB\u52A1\u53C2\u4E0E\u8005"))))))}}]),d}(n.Component),te=k(29583),Ye=k(36021),dt=k(31261),Ta=k(5017),Ca=(0,na.Z)([`
  width: 360px;
  max-height: 400px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.13), 0 2px 6px rgba(0, 0, 0, 0.1);
  -webkit-box-shadow: 0 4px 20px rgba(0, 0, 0, 0.13), 0 2px 6px rgba(0, 0, 0, 0.1);
  background: #fff;
  padding: 6px 0;
  overflow-y: scroll;
  li {
    cursor: pointer;
    height: 40px;
    line-height: 40px;
    overflow: hidden;
    padding-left: 15px;
    padding-right: 10px;
    text-overflow: ellipsis;
    white-space: nowrap;
    .icon {
      color: #ccc;
      display: inline-block;
      font-size: 14px;
      margin-right: 8px;
    }
    &.selected {
      background-color: #0091ea;
      color: #fff;
    }
  }
`],[`
  width: 360px;
  max-height: 400px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.13), 0 2px 6px rgba(0, 0, 0, 0.1);
  -webkit-box-shadow: 0 4px 20px rgba(0, 0, 0, 0.13), 0 2px 6px rgba(0, 0, 0, 0.1);
  background: #fff;
  padding: 6px 0;
  overflow-y: scroll;
  li {
    cursor: pointer;
    height: 40px;
    line-height: 40px;
    overflow: hidden;
    padding-left: 15px;
    padding-right: 10px;
    text-overflow: ellipsis;
    white-space: nowrap;
    .icon {
      color: #ccc;
      display: inline-block;
      font-size: 14px;
      margin-right: 8px;
    }
    &.selected {
      background-color: #0091ea;
      color: #fff;
    }
  }
`]),de={globalEvent:null,timer:null,chargeImgTimer:null,updatingFolderArchive:!1,pointGapX:0,pointGapY:0},ya=Ta.ZP.ul(Ca);function Sa(v){var d=v.onSelect,l=v.filterUserId,e=(0,n.useState)([]),t=(0,ge.Z)(e,2),a=t[0],r=t[1],s=(0,n.useState)(!1),i=(0,ge.Z)(s,2),o=i[0],c=i[1],u=(0,n.useState)(!1),f=(0,ge.Z)(u,2),h=f[0],g=f[1],T=(0,n.useState)({folders:[],labels:[]}),E=(0,ge.Z)(T,2),C=E[0],N=E[1],F=(0,n.useState)(""),x=(0,ge.Z)(F,2),A=x[0],H=x[1],K=(0,n.useState)({id:0,data:{}}),Q=(0,ge.Z)(K,2),X=Q[0],le=Q[1];document.onkeydown=function(_){he(_)},(0,n.useEffect)(function(){o||le({id:0,data:{}})},[o]);var Ge=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(H(q.trim()),!q.trim()){N({folders:[],labels:[]}),c(!1);return}g(!0),L.Z.searchFolderList({keywords:q.trim(),otherAccountID:l,pageIndex:1}).then(function(J){g(!1),N({folders:(J.data||{}).folders||[],labels:(J.data||{}).labels||[]}),c(!0)})},he=function(q){if(o)switch(q.keyCode){case 13:X.id===0?d({type:"task",searchText:A}):d(X.data),c(!1);return;case 38:case 40:var J={};if(X.id===0){if(q.keyCode===38||!C.folders[0]&&!C.labels[0])return;J=C.folders.concat(C.labels)[0]}else{var Me=y().last(C.folders.concat(C.labels));if(q.keyCode===40&&[Me.folderID,Me.categoryID].includes(X.id))return;var ta=C.folders.concat(C.labels),at=y().findIndex(ta,function(aa){return(aa.folderID||aa.categoryID)===X.id});if(at===0&&q.keyCode===38){le({id:0,data:{}});return}J=ta[q.keyCode===38?at-1:at+1]}le({id:J.folderID||J.categoryID,data:(0,ue.default)({},J,{type:J.folderID?"folder":"category",text:J.folderName||J.categoryName,searchText:A})});return}},Le=y().debounce(Ge,500);return n.createElement(dt.Z,{zIndex:10,popup:n.createElement(ya,null,h?n.createElement(ve.Z,{size:"middle"}):n.createElement(n.Fragment,null,n.createElement("li",{className:w()("searchTask",{selected:X.id===0}),"data-type":"task",onClick:function(){d({type:"task",searchText:A}),c(!1)},onMouseOver:function(){X.id!==0&&le({id:0,data:{}})}},n.createElement("span",{className:"icon-search icon",title:_l("\u641C\u7D22")}),_l("\u641C\u7D22\u548C\u201C%0\u201D\u76F8\u5173\u7684\u4EFB\u52A1>",A)),C.folders.map(function(_){return n.createElement("li",{className:w()("searchFolders",{selected:X.id===_.folderID}),"data-type":"folder","data-id":_.folderID,onClick:function(){d((0,ue.default)({},_,{type:"folder",text:_.folderName,searchText:A})),c(!1)},onMouseOver:function(){X.id!==_.folderID&&le({id:_.folderID,data:(0,ue.default)({},_,{type:"folder",text:_.folderName,searchText:A})})}},n.createElement("i",{className:"icon-project-new icon"}),_.folderName)}),C.labels.map(function(_){return n.createElement("li",{className:w()("searchCategorys",{selected:X.id===_.categoryID}),"data-type":"category","data-id":_.categoryID,onClick:function(){d((0,ue.default)({},folder,{type:"category",text:_.categoryName,searchText:A})),c(!1)},onMouseOver:function(){X.id!==_.categoryID&&le({id:_.categoryID,data:(0,ue.default)({},folder,{type:"category",text:_.categoryName,searchText:A})})}},n.createElement("i",{className:"icon-task-label"}),_.categoryName)}))),popupStyle:{width:374},popupVisible:o,onPopupVisibleChange:function(q){q&&C.folders.length===0&&C.labels.length===0||c(q)},action:["click"],popupAlign:{points:["tr","br"],offset:[0,5],overflow:{adjustX:!0,adjustY:!0}}},n.createElement("div",{className:"folderSearch boderRadAll_5 ThemeBorderColor8"},n.createElement("span",{className:"icon-search btnFolderSearch ThemeColor9 Font17"}),n.createElement("input",{type:"text",id:"leftSearchTaskOrFolder",className:"txtSearch boxSizing ThemeColor10",placeholder:_l("\u641C\u7D22"),onChange:function(q){Le(q.target.value)}})))}var Ia=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.createFolderCallback=function(t){e.setState({showFolderTemplate:!1,showCopyFolder:!1}),(0,te.L6)(t),e.renderFolderAvatar()},e.setFolderState=function(){var t=$("#taskNavigator .folderList .projectFolder"),a=[];$.each(t,function(r,s){$(s).find(".projectFolderUl").is(":visible")&&a.push($(s).data("fileid"))}),(0,I.bj)("folderState",a)},e.onCloseDialog=function(){e.setState({showFolderTemplate:!1,showCopyFolder:!1,folderId:"",projectId:"",folderName:"",chargeUser:"",isAdmin:!1})},e.exitLookOtherTask=function(){e.props.dispatch((0,B.gP)(ee()({},e.props.taskConfig,{filterUserId:"",taskFilter:9})))},e.state={showFolderTemplate:!1,showCopyFolder:!1,folderId:"",projectId:"",folderName:"",chargeUser:"",isAdmin:!1},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){y().isEmpty(this.props.topFolderDataSource)||this.renderSlideTopFolder(this.props.topFolderDataSource),this.getTaskNavAll(),this.bindTaskNavAllEvents()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.taskConfig.filterUserId!==this.props.taskConfig.filterUserId&&setTimeout(function(){t.getTaskNavAll()},0)}},{key:"renderFolderAvatar",value:function(){$("#taskNavigator .folderCharge").each(function(e,t){var a=$(t);a.data("hasbusinesscard")||(a.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{className:"circle",user:{userHead:a.data("src"),accountId:a.data("id")},size:24}),t))})}},{key:"getTaskNavAll",value:function(){var e=this,t=$("#taskNavigator");if(t.find(".networkFolderList,.topFolderList,.topFolderTitle").remove(),!t.find("#folderLoading").length){var a=t.find(".navContent");a.before('<div id="folderLoading"> '+LoadDiv()+"</div>")}this.getLeftMenu(),this.getTopFolderList();var r=md.global.Account.projects.concat();r.push({companyName:_l("\u4E2A\u4EBA"),projectId:""}),$(".navContent").append(Z().template(fa())(r)),$("#folderLoading").remove(),this.getProjectsFolderNotice();var s=(0,I.BO)("networkState")||[],i=(0,I.BO)("folderState")||[];r.length===1&&(s=[""]),$.map(s,function(o,c){o&&$(".networkFolderList[data-projectid="+o+"]").find(".clipLoader").removeClass("Hidden"),e.getNetworkData(o,i)})}},{key:"bindTaskNavAllEvents",value:function(){var e=this,t=$("#taskNavigator"),a=$("#leftSearchTaskOrFolder");a.on({focus:function(){$(this).closest(".folderSearch").addClass("ThemeBorderColor3").removeClass("ThemeBorderColor8")},blur:function(){$(this).closest(".folderSearch").removeClass("ThemeBorderColor3").addClass("ThemeBorderColor8")}}),t.on("click",".taskType li",function(){var r=$(this).attr("data-type"),s=void 0;r=="myTask"?s=(0,I.Hb)(6).taskFilter||6:r=="star"?s=8:r=="subordinate"?s=9:r=="responsible"?s=2:r=="trust"?s=3:r=="participate"?s=1:r=="otherAndMe"?s=7:r=="otherResponsible"&&(s=10),t.find(".folderList li").removeClass("ThemeBGColor8");var i=ee()({},e.props.taskConfig,e.props.taskConfig.filterUserId?{}:(0,I.Hb)(s),{taskFilter:s,folderId:"",projectId:""},S.ZP.clearFilterSettings);s===8&&(i.listSort=10),(r=="myTask"||r=="star"||r=="subordinate")&&(0,I.yM)(s,i),y().isEqual(i,e.props.taskConfig)&&(S.ZP.isGetData=!0),e.props.dispatch((0,B.gP)(i)),(0,Ye.T8)("/apps/task/"+(s===8?"star":s===9?"subordinate":"center"))}),t.on("click",".popTops",function(){var r=$(this),s=r.siblings(".folderList"),i=s.is(":visible");i?s.slideUp():s.slideDown(),r.find(".topFolderState").text(i?_l("\u5C55\u5F00"):_l("\u9690\u85CF"))}),t.on("click",".createNew",function(){e.setState({showFolderTemplate:!0})}),t.on("click",".networkFolderList .allFolders",function(){var r=$(this).siblings(".folderList"),s=r.is(":visible"),i=r.hasClass("notFolderList");if(i?s=!1:r.siblings(".allFolders").find(".networkFolderListLabel").html(s?_l("\u5C55\u5F00"):_l("\u9690\u85CF")),s)r.slideUp(function(){e.setNetworkState(),r.find("li").not(".slideFolders,.pigeonholeFolder,.nullFolderTask").remove()});else{var o=$(this).closest(".networkFolderList").attr("data-projectid"),c=(0,I.BO)("folderState")||[];o&&$(".networkFolderList[data-projectid="+o+"]").find(".clipLoader").removeClass("Hidden"),e.getNetworkData(o,c,function(){r.slideDown(function(){e.setNetworkState()})})}r.siblings(".allFolders").find(".networkFolderListArrow").toggleClass("filp").siblings(".overflow_ellipsis").toggleClass("bold")}),t.on({click:function(s){$(".folderList .sinSettings").addClass("Hidden"),$(".folderSettingsList").hide(),$("#taskNavigator .folderUnfinished.folderIcon").removeClass("Hidden"),$(".md_tooltip").remove();var i=$(this),o=!1,c=i.attr("data-projectid")||i.closest(".networkFolderList").attr("data-projectid")||"",u=i.data("id");if(i.hasClass("novice")&&(o=!0,i.removeClass(),$("#noviceMain").remove(),$("#noviceShadow,#folderNoviceShadow").addClass("noviceLeaver").on("webkitAnimationEnd animationend",function(){$("#noviceShadow,#folderNoviceShadow").remove()}),i.find(".folderContent").append('<span class="folderIcon icon-settings sinSettings Relative ThemeColor8 ThemeHoverColor9 Hidden"></span>')),u==2||u==3||u==4){var f=i.find(".commFolderUl"),h=f.is(":visible");if(f.is(":animated")||i.find(".txtProjectNameEdit").is(":visible"))return;u==3?(i.find(".downShow").toggleClass("filp",!h),i.find(".moreOp").toggleClass("InlineBlock",!h),i.find(".folderHeadIcon").toggleClass("icon-folder-open",!h).toggleClass("icon-task-folder-solid",h),i.find(".projectFolderUl li").length===0&&e.getMainFolderListInFile(c,i.data("fileid"))):i.find(".Right").toggleClass("filp",!h),h?f.slideUp(function(){e.setFolderState()}):(u==4?e.getHiddenFolderList(c):u==2&&e.getArchiveFolderList(c),i.find("li").length===0?(f.show(),e.setFolderState()):f.slideDown(function(){e.setFolderState()}));return}var g=ee()({},e.props.taskConfig,(0,I.oy)(),{taskFilter:"",folderId:u,projectId:c},S.ZP.clearFilterSettings);u===1?g.viewType=S.ZP.folderViewType.treeView:u&&$(".folderTabList .subMissionMode").hasClass("itemActive")&&(g.viewType=S.ZP.folderViewType.stageView),(g.listSort===0||g.listSort===4)&&(g.listSort=10),t.find(".folderList li").removeClass("ThemeBGColor8"),i.addClass("ThemeBGColor8"),e.props.taskConfig.filterUserId||(0,I.yM)("",g),y().isEqual(g,e.props.taskConfig)&&(S.ZP.isGetData=!0),e.props.dispatch((0,B.gP)(g)),u!==1&&(0,Ye.T8)("/apps/task/folder_"+u),s.stopPropagation()}},".folderList li"),t.on({click:function(s){var i=$("#taskNavigator .folderList"),o=$(".folderSettingsList");if(s.stopPropagation(),$(".folderList li .sinSettings").not($(this)).addClass("Hidden"),$("#taskNavigator .folderUnfinished.folderIcon").removeClass("Hidden"),!$(this).hasClass("Hidden")){$(this).addClass("Hidden"),$(".folderSettingsList").hide();return}$(this).removeClass("Hidden"),$(this).parent().find(".folderUnfinished").addClass("Hidden"),o.find(".addFileBox").data("build",!1);var c=$(this).closest("li"),u=c.data("projectid"),f=c.closest(".projectFolder"),h=c.data("id"),g=c.data("auth")!==S.ZP.auth.FolderCharger&&c.data("auth")!==S.ZP.auth.FolderAdmin;if(f.length>0?o.data("fileid",f.data("fileid")):o.removeData("fileid"),o.data("folderid",h).data("projectid",u).data("auth",c.data("auth")),md.global.Account.accountId===c.data("charge")){var T=c.data("ispigeonhole")?_l("\u53D6\u6D88\u5F52\u6863\u9879\u76EE"):_l("\u5F52\u6863\u9879\u76EE");o.find(".pigeonhole").show().find("span").text(T)}else o.find(".pigeonhole").hide();var E=o.find(".importantProject").show();c.data("istop")?E.data("istop",1).find("span").text(_l("\u53D6\u6D88\u7F6E\u9876")):E.data("istop",0).find("span").text(_l("\u7F6E\u9876")),c.closest(".topFolderList").length||c.closest(".pigeonholeFolder").length||c.closest(".slideFolders").length?o.find(".addFileBox").hide():o.find(".addFileBox").show(),c.data("auth")===S.ZP.auth.FolderCharger||c.data("auth")===S.ZP.auth.FolderAdmin?o.find(".copyFolder").show():o.find(".copyFolder").hide(),c.data("auth")===S.ZP.auth.FolderCharger?o.find(".chargeAuth").show():o.find(".chargeAuth").hide(),c.data("auth")!==S.ZP.auth.FolderCharger&&c.data("ismember")?o.find(".exitFolder").show():o.find(".exitFolder").hide(),c.parent().is(".projectFolderUl")&&!c.parent().is(".pigeonholeFolderList")?o.find(".exitFile").removeClass("Hidden"):o.find(".exitFile").addClass("Hidden"),c.parent().is(".pigeonholeFolderList")?(o.find(".addFileBox").addClass("Hidden"),o.find(".slideFolders").addClass("Hidden")):(o.find(".addFileBox").removeClass("Hidden"),o.find(".slideFolders").removeClass("Hidden")),o.find(".slideFolders span").text(c.data("ishidden")?_l("\u53D6\u6D88\u9690\u85CF\u9879\u76EE"):_l("\u9690\u85CF\u9879\u76EE"));var C=$(window).height(),N=o.show().height();o.hide();var F=$(this).offset(),x=F.top,A=F.left-16;x+N+24>C?x=x-N-24:x+=24,o.css({top:x-50,left:A}).show();var H=o.find(".dividerLine");$.makeArray(H.nextAll()).map(function(K){return $(K).is(":visible")}).reduce(function(K,Q){return K+Q})?o.find(".dividerLine").show():o.find(".dividerLine").hide()},mousedown:function(s){$(".projectFolderOp").addClass("Hidden")}},".folderList li .sinSettings"),$("body").on({"click.task":function(){var s=$(".folderSettingsList").data("projectid"),i=$(".folderSettingsList").data("folderid"),o=$(".folderSettingsList").data("auth"),c=o===S.ZP.auth.FolderCharger||o===S.ZP.auth.FolderAdmin,u=$(".folderList li[data-id='"+i+"']:last"),f=u.data("istop"),h=u.data("ispigeonhole"),g=u.data("ishidden"),T=u.find(".folderName").text(),E=u.data("charge"),C=function(){e.props.taskConfig.folderId===i&&e.props.dispatch((0,B.YK)(!f)),e.renderFolderAvatar()},N=function(){e.props.taskConfig.folderId===i&&e.props.dispatch((0,B.yA)(!h))};switch($(this).data("type")){case"popTop":(0,te.Jc)(i,!f,C);break;case"del":(0,te.Go)(i);break;case"pigeonhole":(0,te.om)(s,i,!h,N);break;case"exit":(0,te.Ud)(i);break;case"slide":e.updateFolderDisplay(s,i,!g);break;case"copyFolder":(0,oe.pF)(s).then(function(){e.setState({showCopyFolder:!0,projectId:s,folderId:i,isAdmin:c,folderName:T,chargeUser:E})});break}},"mouseover.task":function(s){var i=$(this),o=i.find(".fileFolders"),c=$(".folderSettingsList").data("projectid");if((0,I.Ie)(c)||(c=""),i.hasClass("addFileBox")&&!i.data("build")){o.find(".moveToFileBox").remove(),i.data("build",!0);var u=$(".networkFolderList[data-projectid="+c+"]").find(".projectFolder"),f=$(".folderSettingsList ").data("fileid"),h="",g=void 0,T=void 0;$.each(u,function(H,K){if(g=$(K),f&&g.data("fileid")==f||!g.find(".txtProjectNameEdit").val().trim())return!0;T=$("<span/>").text(g.find(".txtProjectNameEdit").val()).html(),h=h+(`
              <li data-id="`+g.data("fileid")+`" class="ThemeBGColor3 overflow_ellipsis">
              `+T+`
              </li>
              `)}),h.length>0&&(o.find(".exitFile").after(' <ul class="moveToFileBox"> <li class="moveToFile">'+_l("\u79FB\u52A8\u5230")+"</li></ul> "),o.find(".moveToFileBox .moveToFile").after(h)),o.removeClass("Hidden");var E=$(".fileFoldersBox");E.css("top","-6px");var C=E.offset(),N=E.height(),F=$(window).height();if(C.top+N>F){var x=F*.8<300?300:F*.8,A=0;x>N?A=F-N-C.top:A=F-x-C.top-10,E.css({top:A-16+"px"}),o.find(".moveToFileBox").css({"max-height":x-o.find(">li").length*32+"px"})}else E.css("top","-6px")}else o.removeClass("Hidden")},"mouseout.task":function(){$(this).find(".fileFolders").addClass("Hidden")}},".folderSettingsList > li"),t.on({mousedown:function(s){var i=$(this);i.hasClass("projectFolder")||i.closest(".pigeonholeFolder").length>0||i.closest(".topFolderList").length>0||i.hasClass("pigeonholeFolder")||i.hasClass("nullFolderTask")||i.hasClass("slideFolders")||i.closest(".slideFolderList").length>0||(de.timer=setTimeout(function(){clearTimeout(de.timer),de.pointGapY=s.clientY-i.offset().top,de.pointGapX=s.clientX-i.offset().left,e.folderDown(i)},150),s.stopPropagation())},mouseup:function(){clearTimeout(de.timer)}},".folderList li"),$("body").on("click.task",".fileFoldersBox li",function(r){var s=$(".folderSettingsList").data("projectid"),i=$(".folderSettingsList").data("folderid"),o=$(this).data("id");if((0,I.Ie)(s)||(s=""),o=="new"){var c=$(".networkFolderList[data-projectid="+s+"]"),u=c.find("li[data-id="+i+"]"),f=u.parent();e.createNewFile("",u),f.find("li").length<=0&&f.is(".projectFolderUl")&&e.abortProjectFolder(s,f.parent().data("fileid"))}else{if($(this).data("type")=="exitfile"){e.updateFolderIntoFile(s,i,"");return}if(!o)return!1;e.updateFolderIntoFile(s,i,o)}}),t.on({mousedown:function(s){var i=s.clientY+10-$("#topBarContent").height(),o=s.clientX-50,c=$(this).closest(".projectFolder").data("fileid"),u=$(this).closest(".networkFolderList").data("projectid"),f=$(".projectFolderOp");if(s.stopPropagation(),f.data("fileid")===c&&!f.hasClass("Hidden")){f.addClass("Hidden");return}c&&f.css({top:i,left:o}).data("fileid",c).data("projectid",u).removeClass("Hidden")},click:function(s){$(".folderSettingsList").hide(),s.stopPropagation()}},".folderList li .moreOp"),$("body").on("click.task",".projectFolderOp li",function(){var r=$(this),s=r.parent().data("fileid"),i=r.parent().data("projectid"),o=$(this).data("type");if(o=="rename"){var c=$(".networkFolderList[data-projectid="+i+"]").find("li[data-fileid='"+s+"'] .txtProjectNameEdit");$(".projectFolderOp").addClass("Hidden"),c.removeClass("Hidden").focus().select().siblings(".txtProjectName").addClass("Hidden")}else o=="abort"&&e.abortProjectFolder(i,s)}),t.on({blur:function(){var s=$(this);s.removeClass("ThemeBGColor8 ThemeColor10");var i=$.trim(s.val());if(i.length<=0)return alert(_l("\u8BF7\u8F93\u5165\u6587\u4EF6\u5939\u540D\u79F0"),3),$(this).focus(),!1;if(!de.isBlur){de.isBlur=!0;var o=s.closest(".projectFolder").data("fileid");o!=0?e.updateUserFolderFileName(o,s):e.addUserFolderFile(s)}},focus:function(){$(this).addClass("ThemeBGColor8 ThemeColor10"),de.isBlur=!1},keydown:function(s){s.keyCode===13&&$(this).blur()}},".txtProjectNameEdit"),$("#taskNavigator .navContent").on("scroll",function(r){$(".folderSettingsList").hide(),$(".folderList li .sinSettings").addClass("Hidden"),$(".projectFolderOp").addClass("Hidden")}),$(document).on("click",function(r){var s=$(r.target);!s.is(".folderList li .sinSettings")&&!s.closest(".folderList li .sinSettings").length&&($(".folderSettingsList").hide(),$("#taskNavigator .folderUnfinished.folderIcon").removeClass("Hidden"),$(".folderList li .sinSettings").addClass("Hidden")),!s.is(".folderList li .moreOp")&&!s.closest(".projectFolderOp").length&&$(".projectFolderOp").addClass("Hidden")})}},{key:"getLeftMenu",value:function(){var e=this.props.taskConfig,t=e.filterUserId,a=e.lastMyProjectId;(0,te.fx)(t,t?a:"all")}},{key:"getTopFolderList",value:function(){var e=this,t=this.props.taskConfig.filterUserId;L.Z.getTopFolderList({accountID:t}).then(function(a){a.status?a.data&&(e.props.dispatch((0,B.m2)(a.data)),e.renderSlideTopFolder(a.data)):(0,I.N3)(a.error)})}},{key:"renderSlideTopFolder",value:function(e){var t=this.props.taskConfig.folderId,a=ca().replace("#include.singleFolder",We()).replace("#include.singleFolderComm",Ue());$(".navContent .topFolderList").remove(),$(".navContent").prepend(Z().template(a)(e)),$("#folderLoading").remove();var r=t?$(".topFolderList .folderList li[data-id="+t+"]").removeClass("ThemeBGColor8").eq(0).addClass("ThemeBGColor8"):[];this.renderFolderAvatar(),r.length&&$(".navContent").scrollTop(r.offset().top-300)}},{key:"getProjectsFolderNotice",value:function(){L.Z.getProjectsFolderNotice().then(function(e){e.status?$.map(e.data,function(t,a){var r=t.projectID,s=t.noticeCount;s&&r&&$(".networkFolderList[data-projectid="+r+"]").attr("data-count",s).find(".allFolders .folderNewTip").removeClass("Hidden")}):(0,I.N3)(e.error)})}},{key:"getNetworkData",value:function(e,t,a){var r=this,s=this.props.taskConfig.filterUserId;L.Z.getMainFolderList({projectId:e,accountID:s,fileIDs:t.join(",")}).then(function(i){i.status?!md.global.Account.projects.length&&!i.data.folderList&&!i.data.folderFileList&&!i.data.hasHiddenFile&&!i.data.hasArchivedFile&&!i.data.hasNoFIDFile?$(".networkOnly").append('<div class="noFolderList ThemeColor9">'+_l("\u521B\u5EFA\u9879\u76EE\u7BA1\u7406\u4EFB\u52A1")+"</div>"):r.renderSlideFolder(i.data,e,a):(0,I.N3)(i.error)})}},{key:"renderSlideFolder",value:function(e,t,a){var r=We().replace("#include.singleFolderComm",Ue()),s=st().replace("#include.singleFolderComm",Ue()),i=t?$(".networkFolderList[data-projectid="+t+"]").find(".folderList"):$(".networkFolderList[data-null=null]").find(".folderList");i.find("li").not(".slideFolders,.pigeonholeFolder,.nullFolderTask").remove(),this.builFileFolder(e,s,t),this.buildFolders(e,r,t);var o=0;$.map(e.folderFileList||[],function(h,g){h.isNotice&&o++}),$.map(e.folderList||[],function(h,g){h.isNotice&&o++}),t&&$(".networkFolderList[data-projectid="+t+"]").attr("data-count",o).find(".allFolders .folderNewTip").toggleClass("Hidden",!o),i.siblings(".allFolders").find(".networkFolderListArrow").addClass("filp").siblings(".overflow_ellipsis").addClass("bold"),e.hasHiddenFile&&i.find(".slideFolders").removeClass("Hidden"),e.hasArchivedFile&&i.find(".pigeonholeFolder").removeClass("Hidden"),e.hasNoFIDFile&&i.find(".nullFolderTask").toggleClass("ThemeBGColor8",this.props.taskConfig.projectId===t&&this.props.taskConfig.folderId===1).removeClass("Hidden");var c=!1;if((e.folderList||e.folderFileList||e.hasHiddenFile||e.hasArchivedFile||e.hasNoFIDFile)&&(c=!0),i.toggleClass("notFolderList",!c).siblings(".allFolders").find(".networkFolderListLabel").html(c?_l("\u9690\u85CF"):_l("\u65E0")),t&&$(".networkFolderList[data-projectid="+t+"]").find(".clipLoader").addClass("Hidden"),$.isFunction(a)&&c)a();else{i.show();var u=this.props.taskConfig.folderId;if(t){var f=$(".networkFolderList[data-projectid="+t+"] .folderList li.ThemeBGColor8[data-id="+u+"]");f.length&&$(".navContent").scrollTop(f.offset().top-300)}}}},{key:"builFileFolder",value:function(e,t,a){var r=this.props.taskConfig.folderId;if(e.folderFileList&&e.folderFileList.length>0){e.folderFileList.folderId=r;var s=Z().template(t)(e.folderFileList);this.renderFolderAvatar(),a?$(".networkFolderList[data-projectid="+a+"]").find(".folderList").prepend(s):$(".networkFolderList[data-null=null]").find(".folderList").prepend(s)}}},{key:"buildFolders",value:function(e,t,a){if(e.folderList&&e.folderList.length>0){var r=this.props.taskConfig.folderId,s=Z().template(t)(e.folderList),i=a?$(".networkFolderList[data-projectid="+a+"]"):$(".networkFolderList[data-null=null]");i.find(".slideFolders").before(s),r&&i.find(".folderList li[data-id="+r+"]").removeClass("ThemeBGColor8").eq(0).addClass("ThemeBGColor8"),this.renderFolderAvatar()}}},{key:"buildFolderListModule",value:function(e,t){var a=this.props.taskConfig.folderId,r=We().replace("#include.singleFolderComm",Ue()),s={folderList:e};s.folderList.folderId=a;var i=Z().template(r)(s.folderList);t.html(i),this.renderFolderAvatar()}},{key:"setNetworkState",value:function(){var e=$("#taskNavigator .networkFolderList"),t=[];$.each(e,function(a,r){$(r).find(".folderList").is(":visible")&&t.push($(r).data("projectid"))}),(0,I.bj)("networkState",t)}},{key:"folderDown",value:function(e){var t=this,a=$("<div/>").attr("id","folderJoin"),r=de.pointGapY,s=de.pointGapX,i=e.closest(".folderList");$("body").addClass("userSelect"),a.append($("<img/>").attr("src",e.find("img").attr("src")).addClass("circle")),a.append($("<span/>").text(e.find(".folderName").text()).addClass("joinText overflow_ellipsis")),$("body").append(a),$(document).on("mousemove.folderJoin",function(o){if(de.globalEvent=o,a.is(":hidden")&&a.show(),!e.hasClass("folderJoin")&&!e.closest(".projectFolder").hasClass("folderJoin")){var c=e.closest(".projectFolder");if(c.length>0)c.addClass("folderJoin");else{var u=e.closest(".pigeonholeFolder");u.length>0?u.addClass("folderJoin"):e.addClass("folderJoin")}}var f=o.clientX,h=o.clientY;$("#folderJoin").css({top:h-r,left:f-s});var g=$(".navContent").offset(),T=$(".navContent").height(),E=$(".navContent").width();if(i.find("li").removeClass("folderJoinBorder"),g.top<h&&g.top+T>h&&g.left<f&&g.left+E>f){var C=h-g.top+$(".navContent").scrollTop()-$(".topFolderList").height()-($(".networkFolderList").index($(".folderJoin").closest(".networkFolderList"))+1)*40,N=40,F=Math.ceil(C/N)-1,x=i.find("li:visible").eq(F);!x.hasClass("nullFolderTask")&&!x.hasClass("pigeonholeFolder")&&x.closest(".pigeonholeFolder").length<=0&&x.closest(".folderJoin").length<=0&&!x.hasClass("folderJoin")&&!x.hasClass("allFolders")&&!x.hasClass("popTops")&&!x.hasClass("slideFolders")&&x.closest(".slideFolders").length<=0&&(x.closest(".projectFolder").length>0?x.closest(".projectFolder").addClass("folderJoinBorder"):x.closest(".pigeonholeFolder").length>0?x.closest(".pigeonholeFolder").addClass("folderJoinBorder"):x.addClass("folderJoinBorder"))}else g.left<f&&g.left+E>f&&t.moveProjectScroll();return!1}),$(document).on("mouseup.folderJoin",function(){$(document).off("mousemove.folderJoin"),$(document).off("mouseup.folderJoin"),a.remove(),i.find("li").removeClass("folderJoin"),$("body").removeClass("userSelect");var o=i.find("li.folderJoinBorder");o.length>0&&(o.hasClass("projectFolder")?t.updateFolderMember(e):t.createNewFile(e,o),o.removeClass("folderJoinBorder"))})}},{key:"moveProjectScroll",value:function(){var e=this,t=$(".navContent");if(t.height()<t[0].scrollHeight){if(t.is(":animated"))return!1;var a=de.globalEvent.clientY,r=de.globalEvent.clientX,s=t.offset(),i=s.left+t.width(),o=t.scrollTop();r>s.left&&r<i&&(s.top>a?o>0&&t.animate({scrollTop:o-150},300,function(){e.moveProjectScroll()}):$(window).height()-50<a&&t.height()+t.scrollTop()<t[0].scrollHeight&&t.animate({scrollTop:o+150},300,function(){e.moveProjectScroll()}))}}},{key:"createNewFile",value:function(e,t){var a=t.attr("data-projectid");(0,I.Ie)(a)||(a="");var r=$(".networkFolderList[data-projectid="+a+"]"),s=$(Z().template(st())([{fFileName:_l("\u65B0\u5EFA\u6587\u4EF6\u5939"),fFileID:0}])),i=r.find(".projectFolder").last();s.find(".projectFolderUl").append(t,e),i.length>0?i.after(s):r.find(".folderList").prepend(s),s.trigger("click"),s.find(".txtProjectNameEdit").removeClass("Hidden").focus().select().siblings(".txtProjectName").addClass("Hidden")}},{key:"updateFolderMember",value:function(e){var t=$(".folderList"),a=t.find("li.folderJoinIn"),r=a.data("fileid"),s=e.closest(".networkFolderList").attr("data-projectid"),i=e.data("id");a.length<=0&&(a=t.find(".folderJoinBorder"),r=a.data("fileid")),this.updateFolderIntoFile(s,i,r)}},{key:"updateFolderIntoFile",value:function(e,t,a){var r=this;L.Z.updateFolderIntoFile({folderID:t,fileID:a}).then(function(s){if(s.status){(0,I.Ie)(e)||(e="");var i=$(".networkFolderList[data-projectid="+e+"]"),o=i.find("li[data-id='"+t+"']:last").hide(),c=o.parent(),u=i.find(".projectFolder:last");if(!a)u.length==0?i.find(".folderList").prepend(o.slideDown()):u.after(o.slideDown());else{var f=i.find(".projectFolder[data-fileid="+a+"] .projectFolderUl");f.find("li").length>0&&f.prepend(o.slideDown())}c.find("li").length<=0&&c.is(".projectFolderUl")&&r.abortProjectFolder(e,c.parent().data("fileid"))}else(0,I.N3)(s.error)})}},{key:"addUserFolderFile",value:function(e){var t=this,a=e.closest(".projectFolder"),r=[],s=a.find(".projectFolderUl li"),i=a.closest(".networkFolderList").attr("data-projectid"),o=$.trim(e.val());$.each(s,function(c,u){r.push($(u).data("id"))}),L.Z.addUserFolderFile({fileName:o,folderIDs:r.join(",")}).then(function(c){c.status?(a.data("fileid",c.data.fFileID).data("projectid",i).attr({"data-fileid":c.data.fFileID,"data-projectid":i}),e.addClass("Hidden").attr("title",o).siblings(".txtProjectName").text(o).removeClass("Hidden"),t.setFolderState()):(0,I.N3)(c.error)})}},{key:"abortProjectFolder",value:function(e,t){L.Z.deleteUserFolderFile({ffileID:t}).then(function(a){if(a.status){var r=$(".networkFolderList[data-projectid="+e+"]"),s=r.find("li[data-fileid='"+t+"']"),i=s.find("li").hide();s.slideUp(function(){$(this).remove()});var o=r.find(".projectFolder").last();o.length>0?o.after(i.slideDown()):r.find(".folderList").prepend(i.slideDown()),$(".projectFolderOp").addClass("Hidden")}else(0,I.N3)(a.error)})}},{key:"updateUserFolderFileName",value:function(e,t){var a=$.trim(t.val()),r=t.attr("title"),s=function(){t.attr("title",a).addClass("Hidden").siblings(".txtProjectName").text(a).removeClass("Hidden")};if(a==r){s();return}L.Z.updateUserFolderFile({ffileID:e,fileName:a}).then(function(i){i.status?s():(0,I.N3)(i.error)})}},{key:"getMainFolderListInFile",value:function(e,t){var a=this,r=this.props.taskConfig.filterUserId;L.Z.getMainFolderListInFile({accountID:r,fileID:t}).then(function(s){if(s.status){if(s.data){var i=$(".networkFolderList[data-projectid="+e+"]").find(".projectFolder[data-fileid="+t+"] .projectFolderUl");a.buildFolderListModule(s.data,i)}}else(0,I.N3)(s.error)})}},{key:"getArchiveFolderList",value:function(e){var t=this,a=this.props.taskConfig.filterUserId;L.Z.getArchiveFolderList({accountID:a,projectId:e}).then(function(r){if(r.status){if(r.data){var s=$(".networkFolderList[data-projectid="+e+"]").find(".pigeonholeFolderList");t.buildFolderListModule(r.data,s)}}else(0,I.N3)(r.error)})}},{key:"getHiddenFolderList",value:function(e){var t=this,a=this.props.taskConfig.filterUserId;L.Z.getHiddenFolderList({accountID:a,projectId:e}).then(function(r){if(r.status){if(r.data){var s=$(".networkFolderList[data-projectid="+e+"]").find(".slideFolderList");t.buildFolderListModule(r.data,s)}}else(0,I.N3)(r.error)})}},{key:"updateFolderDisplay",value:function(e,t,a){var r=this;L.Z.updateFolderDisplay({folderID:t,isHidden:a}).then(function(s){if(s.status){(0,I.Ie)(e)||(e="");var i=$(".networkFolderList[data-projectid="+e+"]"),o=i.find("li[data-id='"+t+"']:last").hide(),c=o.parent();$(".folderList li[data-id='"+t+"']").data("ishidden",a).toggleClass("archivedFolder",a),a?i.find(".slideFolderList").prepend(o.slideDown(function(){c.find("li").length||r.abortProjectFolder(e,c.parent().data("fileid"))})).closest(".slideFolders").removeClass("Hidden"):i.find(".slideFolders").before(o.slideDown()).closest(".slideFolders").removeClass("Hidden")}else(0,I.N3)(s.error)})}},{key:"searchSelect",value:function(e){var t=e.type||"task",a=e.searchText;if(a!==""){var r=e.folderID||"",s=t!=="folder"?6:"",i=this.props.taskConfig.filterUserId?this.props.taskConfig.lastMyProjectId:"all",o={tags:[],customFilter:{},selectChargeIds:[],folderSearchRange:6};t==="category"&&o.tags.push(e.categoryID),this.props.dispatch((0,B.gP)({listSort:10,listStatus:r?(0,I.oy)().listStatus:-1,folderId:r,taskFilter:s,keyWords:t==="task"?a:e.text,searchKeyWords:t==="task"?a:"",lastMyProjectId:i,filterSettings:o})),$("#taskNavigator .folderList li").removeClass("ThemeBGColor8"),t==="folder"&&$("#taskNavigator .folderList li[data-id="+r+"]").addClass("ThemeBGColor8"),$(".searchDiv .searchContent").fadeOut()}}},{key:"renderNavMenu",value:function(){var e=this.props.taskConfig,t=e.filterUserId,a=e.isSubUser,r=e.taskFilter,s=e.keyWords;return t&&a?n.createElement("ul",{className:"taskType ThemeBorderColor7"},n.createElement("li",{className:w()("otherAndMe ThemeHoverBGColor7",{ThemeBGColor8:r===7}),"data-type":"otherAndMe"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u6211\u4E0E\u4ED6\u5171\u540C\u53C2\u4E0E\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-charger typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName responsibleText ThemeColor10"},_l("\u4E0E\u4ED6\u534F\u4F5C\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("responsible ThemeHoverBGColor7",{ThemeBGColor8:r===2}),"data-type":"responsible"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u4ED6\u4F5C\u4E3A\u8D1F\u8D23\u4EBA\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-task-responsible typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName responsibleText ThemeColor10"},_l("\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("trust ThemeHoverBGColor7",{ThemeBGColor8:r===3}),"data-type":"trust"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u4ED6\u6258\u4ED8\u7ED9\u5176\u4ED6\u4EBA\u8D1F\u8D23\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-task-trust typeIcon typeIconTrust ThemeColor9"})),n.createElement("span",{className:"typeName ThemeColor10"},_l("\u4ED6\u6258\u4ED8\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("participate ThemeHoverBGColor7",{ThemeBGColor8:r===1}),"data-type":"participate"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u4ED6\u4EC5\u4F5C\u4E3A\u4EFB\u52A1\u53C2\u4E0E\u8005\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-task-participate typeIcon typeIconParticipate ThemeColor9"})),n.createElement("span",{className:"typeName ThemeColor10"},_l("\u4ED6\u53C2\u4E0E\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"}))):t&&!a?n.createElement("ul",{className:"taskType ThemeBorderColor7"},n.createElement("li",{className:w()("otherAndMe ThemeHoverBGColor7",{ThemeBGColor8:r===7}),"data-type":"otherAndMe"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u6211\u4E0E\u4ED6\u5171\u540C\u53C2\u4E0E\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-charger typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName responsibleText ThemeColor10"},_l("\u4E0E\u4ED6\u534F\u4F5C\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("otherResponsible ThemeHoverBGColor7",{ThemeBGColor8:r===10}),"data-type":"otherResponsible"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u6211\u53EF\u89C1\u7684\u7531\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-task_custom_personnel typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName responsibleText ThemeColor10"},_l("\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"}))):n.createElement("ul",{className:"taskType ThemeBorderColor7"},n.createElement("li",{className:w()("myTask ThemeHoverBGColor7",{ThemeBGColor8:r===6&&!s||r===1||r===2||r===3}),"data-type":"myTask"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u6211\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-charger typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName responsibleText ThemeColor10"},_l("\u6211\u7684\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("aboutMeStar ThemeHoverBGColor7",{ThemeBGColor8:r===8}),"data-type":"star"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u6240\u6709\u6DFB\u52A0\u661F\u6807\u7684\u4EFB\u52A1")},n.createElement("i",{className:"icon-task-star typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName ThemeColor10"},_l("\u661F\u6807\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})),n.createElement("li",{className:w()("taskSubordinate ThemeHoverBGColor7",{ThemeBGColor8:r===9}),"data-type":"subordinate"},n.createElement("span",{className:"tip-bottom-right","data-tip":_l("\u4E0B\u5C5E\u4EFB\u52A1")},n.createElement("i",{className:"icon-group typeIcon ThemeColor9"})),n.createElement("span",{className:"typeName ThemeColor10"},_l("\u4E0B\u5C5E\u4EFB\u52A1")),n.createElement("span",{className:"allCountTask Right ThemeColor8"})))}},{key:"render",value:function(){var e=this,t=this.state,a=t.showFolderTemplate,r=t.showCopyFolder,s=t.folderId,i=t.projectId,o=t.chargeUser,c=t.folderName,u=t.isAdmin;return n.createElement("div",{id:"taskNavigator",className:"ThemeBGColor9 flexColumn"},n.createElement("div",{className:w()("otherBox",{Hidden:!this.props.taskConfig.filterUserId}),onClick:this.exitLookOtherTask},n.createElement("div",{className:"closeOther ThemeColor3 Font13"},n.createElement("i",{className:"icon-arrow-left-border Font18"}),_l("\u8FD4\u56DE\u4E0B\u5C5E\u4EFB\u52A1"))),n.createElement("div",{className:"folderSearchBox boxSizing"},n.createElement(Sa,{filterUserId:this.props.taskConfig.filterUserId,onSelect:function(h){return e.searchSelect(h)}})),this.renderNavMenu(),n.createElement("div",{className:"navContent boxSizing flex"}),n.createElement("div",{className:"createNewBox"},n.createElement("span",{className:"createNew ThemeColor9 ThemeBorderColor8 ThemeHoverBGColor7"},n.createElement("i",{className:"icon-plus"}),_l("\u521B\u5EFA\u9879\u76EE"))),n.createElement("ul",{className:"folderSettingsList boderRadAll_3 boxShadow5 Hidden"},n.createElement("li",{"data-type":"popTop",className:"ThemeBGColor3 importantProject"},n.createElement("i",{className:"icon-folder-top"}),n.createElement("span",null,_l("\u7F6E\u9876"))),n.createElement("li",{"data-type":"addfile",className:"ThemeBGColor3 addFileBox"},n.createElement("i",{className:"icon-addto-folder"}),_l("\u6DFB\u52A0\u5230\u6587\u4EF6\u5939"),n.createElement("i",{className:"arrorwRight Right "}),n.createElement("div",{className:"fileFoldersBox"},n.createElement("ul",{className:"fileFolders boderRadAll_3 boxShadow5 Hidden"},n.createElement("li",{"data-type":"exitfile",className:"ThemeBGColor3 Hidden exitFile"},_l("\u76F4\u63A5\u79FB\u51FA")),n.createElement("li",{"data-id":"new",className:"ThemeBGColor3 newFile"},_l("\u65B0\u5EFA\u9879\u76EE\u6587\u4EF6\u5939"))))),n.createElement("li",{"data-type":"copyFolder",className:"ThemeBGColor3 copyFolder"},n.createElement("i",{className:"icon-task-new-copy"}),n.createElement("span",null,_l("\u590D\u5236\u9879\u76EE"))),n.createElement("li",{className:"dividerLine"}),n.createElement("li",{"data-type":"slide",className:"ThemeBGColor3 slideFolders"},n.createElement("i",{className:"icon-public-folder-hidden"}),n.createElement("span",null,_l("\u9690\u85CF\u9879\u76EE"))),n.createElement("li",{"data-type":"pigeonhole",className:"ThemeBGColor3 pigeonhole"},n.createElement("i",{className:"icon-task-pigeonhole"}),n.createElement("span",null,_l("\u5F52\u6863\u9879\u76EE"))),n.createElement("li",{"data-type":"del",className:"ThemeBGColor3 chargeAuth"},n.createElement("i",{className:"icon-task-new-delete"}),_l("\u5220\u9664\u9879\u76EE")),n.createElement("li",{"data-type":"exit",className:"ThemeBGColor3 Hidden exitFolder"},n.createElement("i",{className:"icon-task-new-exit"}),_l("\u9000\u51FA\u9879\u76EE"))),n.createElement("ul",{className:"projectFolderOp boderRadAll_3 boxShadow5 Hidden"},n.createElement("li",{className:"ThemeBGColor3","data-type":"rename"},_l("\u91CD\u547D\u540D\u9879\u76EE\u6587\u4EF6\u5939")),n.createElement("li",{className:"ThemeBGColor3","data-type":"abort"},_l("\u89E3\u6563\u9879\u76EE\u6587\u4EF6\u5939"))),a&&n.createElement(ga,{callback:this.createFolderCallback,onClose:this.onCloseDialog}),r&&n.createElement(lt,{isAdmin:u,projectId:i,chargeUser:o,folderName:c,folderId:s,callback:this.createFolderCallback,onClose:function(){return e.setState({showCopyFolder:!1})}}))}}]),d}(n.Component);const Ea=(0,re.$j)(function(v){return v.task})(Ia);var ln=k(40440),Oe=k(61987),Na=k(98820),ct=k.n(Na),ut=k(94176),ft=k(94796),Da=function(){function v(){(0,j.default)(this,v)}return(0,R.default)(v,[{key:"init",value:function(l){var e=this,t={stageId:"",stageName:"",folderId:"",projectId:""};this.settings=$.extend(t,l);var a=function(){if($(".listCreateNew, #taskSearchNullTask").hide(),$("#taskList .listStageTaskContent").length){var s=$("#taskList .listStageTaskContent:first");s.is(":visible")||$("#taskList .taskListStageName:first").click(),s.prepend(Z().template(ct())())}else $("#taskList").append(Z().template(ct())());e.bindCreateSinlgeTaskEvent(),$("#taskList").find(".txtSingleName").focus(),e.settings.folderId&&e.bindStage()};(0,oe.pF)(this.settings.projectId).then(function(){a()})}},{key:"renderReactUserCard",value:function(){var l=this;$(".createNewSingle").find(".chargeImgWrapQuick[data-id]").each(function(e,t){var a=$(t);if(!a.data("hasbusinesscard")){var r=a.data("avatar"),s=a.data("id");a.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{className:"circle",user:{userHead:r,accountId:s},size:26,operation:n.createElement("span",{className:"quickCreateBtn ThemeColor3",onClick:function(){(0,ke.Z)({sourceId:l.settings.folderId,showMoreInvite:!1,fromType:2,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:[s],projectId:(0,I.Ie)(l.settings.projectId)?l.settings.projectId:"",unique:!0,callback:function(c){l.updateCharge(c[0].accountId,c[0].avatar)}}})}},_l("\u5C06\u4EFB\u52A1\u6258\u4ED8\u7ED9\u4ED6\u4EBA"))}),t)}})}},{key:"bindCreateSinlgeTaskEvent",value:function(){var l=this;$(".createNewSingle  .taskStar").on("click",function(){$(this).toggleClass("icon-task-star icon-star-hollow"),$(this).hasClass("icon-task-star")&&$(this).removeClass("ThemeColor3")});var e=$(".createNewSingle .createSingleDate"),t=function a(){var r=e.data(),s=r.start,i=r.end;se.render(n.createElement(ft.Z,{selectedValue:[s,i],mode:"task",timePicker:!0,separator:_l("\u81F3"),timeMode:"hour",placeholder:_l("\u672A\u6307\u5B9A\u8D77\u6B62\u65F6\u95F4"),onOk:function(c){var u=(0,ge.Z)(c,2),f=u[0],h=u[1];if(f&&h&&f>=h)return alert(_l("\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u65E9\u4E8E\u6216\u7B49\u4E8E\u5F00\u59CB\u65F6\u95F4"),2),!1;f=f?f.format("YYYY-MM-DD HH:00"):"",h=h?h.format("YYYY-MM-DD HH:00"):"",e.data("start",f),e.data("end",h)},onClear:function(){delete e.data().start,delete e.data().end,se.unmountComponentAtNode(e[0]),a()}},n.createElement("span",{class:"icon-bellSchedule"})),e[0])};t(),$(".createNewSingle  .txtSingleName").on("keyup",function(a){a.keyCode===13&&l.quickCreateTask(!0)}),$(".createNewSingle").on("click",".showStage",function(){var a=$("ul.stageDrop").show(),r=$(window).height(),s=$(this).offset().top,i=a.height(),o=30;s+i+o>r?a.css("top",-i-3):a.css("top","38px")}).on("click",".stageDrop li",function(){var a=$(this);l.settings.stageId=a.data("stageid"),l.settings.stageName=$.trim(a.text()),a.addClass("selected").siblings().removeClass("selected"),$("ul.stageDrop").hide();var r=$("#taskList span[data-stageid='"+l.settings.stageId+"']").parent();r.next().is(".listStageTaskContent")?(r.next().is(":visible")||r.find(".listFolderNameText").trigger("click"),r.next().prepend($(".createNewSingle"))):r.after($(".createNewSingle"));var s=$("#taskList"),i=s.height(),o=s[0].scrollHeight;if(o>i){var c=$(".createNewSingle").offset().top,u=s.offset().top,f=c-u,h=s.scrollTop()+f-30;s.scrollTop(h)}}),$(".createNewSingle .chargeImgWrapQuick").on("click",function(){var a=$(this),r=function(i){l.updateCharge(i[0].accountId,i[0].avatar)};(0,Oe.ZP)(a[0],{sourceId:l.settings.folderId,showMoreInvite:!1,fromType:2,filterAccountIds:[a.attr("data-id")],includeUndefinedAndMySelf:!0,SelectUserSettings:{filterAccountIds:[a.attr("data-id")],projectId:(0,I.Ie)(l.settings.projectId)?l.settings.projectId:"",unique:!0,callback:r},selectCb:r})}),l.renderReactUserCard(),$(document).off("click.quickCreateTask").on("click.quickCreateTask",function(a){var r=$(a.target);if(!(r.closest("#dialogBoxSelectUser_container").length>0||r.is($("#dialogBoxSelectUser_mask")))&&!r.parent().is(".subItem")&&!($(".md_dialog:visible").length>0)&&!(r.closest(".PositionContainer-wrapper").length>0)&&!(r.closest("#alertDialog").length>0)){var s=$(".createNewSingle ");if($(".listCreateNew, #taskSearchNullTask").length>0&&s.length>0||s.length>0&&s.is(":visible")){if(r.closest(".messageDiv").length>0)return;r.closest(".createNewSingle").length<=0&&l.quickCreateTask(!1)}if(r.closest(".stageBox").length<=0){var i=$("ul.stageDrop");i.length>0&&$("ul.stageDrop").hide()}}})}},{key:"bindStage",value:function(){var l=this;L.Z.getFolderStage({folderID:l.settings.folderId}).then(function(e){if(e.status){for(var t=e.data,a=t.length,r=void 0,s=void 0,i="",o=0;o<a;o++)r=t[o],i=i+(`
            <li data-stageid="`+r.id+'" class="overflow_ellipsis boxSizing '+(o===0?"selected":"")+'" title="'+r.name+`">
            `+r.name+`
            </li>
            `),o===0&&(l.settings.stageId=r.id,l.settings.stageName=r.name,s='<span class="showStage boderRadAll_3 icon-task-quick-stage"></span>');var c=`
          <ul class="stageDrop boderRadAll_3 boxShadow5">
          `+i+`
          </ul>
          `,u=$(".createNewSingle .stageBox");u.length>0&&(u.html("").append(s),u.append(c))}else(0,I.N3)(e.error)})}},{key:"updateCharge",value:function(l,e){var t=$(".createNewSingle .chargeImgWrapQuick").data("id");$(".createNewSingle .chargeImgWrapQuick").data("avatar",e).data("id",l).data("hasbusinesscard",!1),this.renderReactUserCard()}},{key:"quickCreateTask",value:function(l){if(!$("#taskList .createNewSingle").data("create")){var e=this,t=e.settings,a=$.trim($(".createNewSingle .txtSingleName").val());if(a){var r=$(".createNewSingle .createSingleDate").data("start"),s=$(".createNewSingle .createSingleDate").data("end");$("#taskList .createNewSingle").data("create",1);var i=$(".createNewSingle .taskStar").hasClass("icon-task-star"),o=$(".createNewSingle .chargeImgWrapQuick"),c=o.data("avatar"),u=o.data("id");L.Z.addTask({projectId:t.projectId,taskName:a,chargeAccountID:u,stageID:t.stageId,summary:"",members:"",parentID:"",groupIDstr:"",postID:"",folderID:t.folderId,star:i,startTime:r,deadline:s}).then(function(f){f.status?($("#taskList .createNewSingle").data("create",0),f.data.star=i,f.data.taskName=f.data.name,f.data.charge={status:1,avatar:c,accountID:u},f.data.stageID=t.stageId,f.data.projectId=t.projectId,f.data.projectID=t.ProjectID,f.data.stageName=t.stageName,f.data.folderId=t.folderId,f.data.actualStartTime="",f.data.completeTime="",l?($(".createNewSingle .txtSingleName").val(""),$(".createNewSingle .createSingleDate").text("").addClass("icon-bellSchedule").removeClass("selDate"),$(".createNewSingle .taskStar").removeClass("icon-task-star").addClass("icon-star-hollow")):($(document).off("click.quickCreateTask"),$(".listCreateNew, #taskSearchNullTask").remove(),$(".createNewSingle").remove()),ut.Z.dispatch((0,B.gI)(f.data))):(0,I.N3)(f.error)})}else{if(l){alert(_l("\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"),3);return}$(".listCreateNew, #taskSearchNullTask").show(),$(".createNewSingle").remove()}}}}]),v}();const mt=new Da;var Ze=k(47426),dn=k(97373),pt=k(94055),Ee=k(97553),ba=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={data:""},e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){var e=this;L.Z.getFolderConfig({folderId:this.props.folderId}).then(function(t){e.setState({data:t.data,stageConfig:t.data.stageConfig,templateScope:t.data.templateScope,folderAuthVisible:t.data.folderAuthVisible})})}},{key:"templateScopeDialog",value:function(e){var t=this;e?ie.Z.confirm({width:490,closable:!1,dialogClasses:"setFolderComfirm",title:_l("\u60A8\u786E\u5B9A\u5207\u6362\u5230\u53EA\u5728\u9879\u76EE\u4E0B1\u7EA7\u4EFB\u52A1\u663E\u793A\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9\uFF1F"),children:n.createElement("span",{class:"Font13"},_l("\u5207\u6362\u540E1\u7EA7\u4EE5\u4E0B\u4EFB\u52A1\u4E2D\u7684\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9\u6240\u6709\u6570\u636E\u5C06\u88AB\u5220\u9664\uFF0C\u65E0\u6CD5\u6062\u590D")),footer:n.createElement("div",null,n.createElement(Ee.ZP,{type:"link",onClick:function(){t.setState({templateScope:!e}),$(".setFolderComfirm").parent().remove()}},_l("\u53D6\u6D88")),n.createElement(Ee.ZP,{type:"primary",onClick:function(){t.updateFolderTemplateScope(e),$(".setFolderComfirm").parent().remove()}},_l("\u786E\u8BA4")))}):this.updateFolderTemplateScope(e)}},{key:"updateFolderTemplateScope",value:function(e){var t=this;L.Z.updateFolderTemplateScope({folderID:this.props.folderId,templateScope:e}).then(function(a){a.status?alert(_l("\u4FEE\u6539\u6210\u529F")):(alert(_l("\u4FEE\u6539\u5931\u8D25"),2),t.setState({templateScope:!e}))})}},{key:"updateStageConfig",value:function(e){var t=this;L.Z.updateStageConfig({folderID:this.props.folderId,stageConfig:e}).then(function(a){a.status?alert(_l("\u4FEE\u6539\u6210\u529F")):(alert(_l("\u4FEE\u6539\u5931\u8D25"),2),t.setState({stageConfig:e===0?1:0}))})}},{key:"folderAuthVisibleDialog",value:function(e,t){var a=this;e<t?ie.Z.confirm({dialogClasses:"setFolderComfirm",width:490,closable:!1,title:_l("\u6CE8\u610F\uFF1A"),children:n.createElement("span",{class:"Font13"},_l("\u8FD9\u5C06\u5BFC\u81F4\u6210\u5458\u80FD\u770B\u5230\u6B64\u9879\u76EE\u4E0B\u5176\u5F53\u524D\u4E0D\u53EF\u89C1\u7684\u4EFB\u52A1\uFF0C\u8BF7\u786E\u8BA4\u5176\u4E2D\u7684\u4FE1\u606F\u53EF\u4EE5\u5BF9\u6210\u5458\u516C\u5F00\u3002")),footer:n.createElement("div",null,n.createElement(Ee.ZP,{type:"link",onClick:function(){a.setState({folderAuthVisible:t}),$(".setFolderComfirm").parent().remove()}},_l("\u53D6\u6D88")),n.createElement(Ee.ZP,{type:"primary",onClick:function(){a.updateFolderAuthVisible(e),$(".setFolderComfirm").parent().remove()}},_l("\u786E\u8BA4")))}):this.updateFolderAuthVisible(e,t)}},{key:"updateFolderAuthVisible",value:function(e,t){var a=this;L.Z.updateFolderAuthVisible({folderID:this.props.folderId,folderAuthVisible:e}).then(function(r){r.status?alert(_l("\u4FEE\u6539\u6210\u529F")):(alert(_l("\u4FEE\u6539\u5931\u8D25"),2),a.setState({folderAuthVisible:t}))})}},{key:"render",value:function(){var e=this,t={dialogBoxID:"setFolder",container:{header:_l("\u9879\u76EE\u914D\u7F6E"),yesText:"",noText:"",noFn:this.props.onClose}},a={data:[{text:_l("\u53EA\u6709\u8D1F\u8D23\u4EBA\u548C\u7BA1\u7406\u5458\u53EF\u4EE5\u7F16\u8F91"),value:0},{text:_l("\u9879\u76EE\u6210\u5458\u5747\u53EF\u7F16\u8F91"),value:1}],checkedValue:this.state.stageConfig,vertical:!0,onChange:function(o){e.setState({stageConfig:o}),e.updateStageConfig(o)}},r={data:[{text:_l("\u53EA\u5728\u9879\u76EE\u4E0B\u76841\u7EA7\u4EFB\u52A1\u663E\u793A\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9"),value:!0},{text:_l("\u9879\u76EE\u4E0B\u7684\u5404\u7EA7\u4EFB\u52A1\u90FD\u663E\u793A\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9"),value:!1}],checkedValue:this.state.templateScope,vertical:!0,onChange:function(o){e.setState({templateScope:o}),e.templateScopeDialog(o)}},s={data:[{text:_l("\u53EF\u89C1\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\uFF0C\u53EF\u67E5\u770B\u6240\u6709\u4EFB\u52A1\u8BE6\u60C5"),value:0},{text:_l("\u53EF\u89C1\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u7684\u6807\u9898\uFF0C\u4F46\u4E0D\u53EF\u67E5\u770B\u672A\u53C2\u4E0E\u4EFB\u52A1\u7684\u8BE6\u60C5"),value:1},{text:_l("\u4E0D\u53EF\u89C1\u672A\u53C2\u4E0E\u7684\u4EFB\u52A1\uFF08\u4E5F\u65E0\u6CD5\u67E5\u770B\u8BE6\u60C5\uFF09"),value:2}],checkedValue:this.state.folderAuthVisible,vertical:!0,onChange:function(o){var c=e.state.folderAuthVisible;e.setState({folderAuthVisible:o}),e.folderAuthVisibleDialog(o,c)}};return n.createElement(ie.Z,{visible:!0,dialogClasses:"setFolder",title:_l("\u9879\u76EE\u914D\u7F6E"),showFooter:!1,handleClose:function(){return $(".setFolder").parent().remove()}},this.state.data?n.createElement("div",null,n.createElement("div",{className:"Font13 mBottom20"},n.createElement("div",{className:"mBottom10"},n.createElement("span",null,_l("1\u3001\u9879\u76EE\u770B\u677F\u7684\u7F16\u8F91\u6743\u9650")),n.createElement(pt.default,{title:function(){return n.createElement(n.Fragment,null,n.createElement("div",null,_l("\u9ED8\u8BA4\u8D1F\u8D23\u4EBA\u548C\u7BA1\u7406\u5458\u53EF\u7F16\u8F91\u770B\u677F\uFF1B")),n.createElement("div",null,_l("\u9879\u76EE\u6210\u5458\u53EA\u80FD\u67E5\u770B\u770B\u677F\u5185\u5BB9\uFF0C\u521B\u5EFA\u4EFB\u52A1\uFF0C\u5BF9\u770B\u677F\u6CA1\u6709\u7F16\u8F91\u6743\u9650")))}},n.createElement("span",{className:"msgTip"},n.createElement("i",{className:"icon-task-folder-message"})))),n.createElement(Ze.ZP,a)),n.createElement("div",{className:"Font13 mBottom20"},n.createElement("div",{className:"mBottom10"},_l("2\u3001\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9\u5728\u9879\u76EE\u4E0B\u591A\u7EA7\u4EFB\u52A1\u7684\u5448\u73B0")),n.createElement(Ze.ZP,r)),n.createElement("div",{className:"Font13 mBottom20"},n.createElement("div",{className:"mBottom10"},n.createElement("span",null,_l("3\u3001\u6210\u5458\u5BF9\u9879\u76EE\u4E0B\u4EFB\u52A1\u7684\u53EF\u89C1\u6743\u9650")),n.createElement("span",{className:"msgTip tip-top","data-tip":_l("\u4EC5\u5F71\u54CD\u9879\u76EE\u6210\u5458\u548C\u5728\u516C\u5F00\u8303\u56F4\u5185\u4EBA\u5458\uFF0C\u7BA1\u7406\u5458\u56FA\u5B9A\u4E3A\u5BF9\u9879\u76EE\u4E0B\u6240\u6709\u4EFB\u52A1\u53EF\u89C1\u4E14\u53EF\u67E5\u770B\u8BE6\u60C5")},n.createElement("i",{className:"icon-task-folder-message"}))),n.createElement(Ze.ZP,s))):"")}}]),d}(n.Component),wa=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={folderArry:[{key:"folderDesc",name:_l("\u9879\u76EE\u540D\u79F0"),disabled:!0},{key:null},{key:"folderCharge",name:_l("\u9879\u76EE\u8D1F\u8D23\u4EBA")},{key:"folderDesc",name:_l("\u9879\u76EE\u63CF\u8FF0")},{key:"stageName",name:_l("\u770B\u677F\u540D\u79F0")},{key:"control",name:_l("\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9")}],taskType:[{key:"topLevelTask",name:"\u9879\u76EE\u4E0B\u4E00\u7EA7\u4EFB\u52A1",disabled:!0},{key:"subtask",name:_l("\u5404\u7EA7\u5B50\u4EFB\u52A1"),noSelect:!0}],taskArray:[{key:"taskName",name:"\u4EFB\u52A1\u6807\u9898",disabled:!0},{key:null},{key:"taskCharge",name:_l("\u4EFB\u52A1\u8D1F\u8D23\u4EBA")},{key:"taskDesc",name:_l("\u4EFB\u52A1\u63CF\u8FF0")},{key:"completeTime",name:_l("\u5B8C\u6210\u72B6\u6001\u53CA\u5B8C\u6210\u65F6\u95F4")},{key:"taskMember",name:_l("\u4EFB\u52A1\u53C2\u4E0E\u8005")},{key:"time",name:_l("\u8D77\u6B62\u65F6\u95F4")},{key:"createTime",name:_l("\u521B\u5EFA\u65E5\u671F")},{key:"tag",name:_l("\u5206\u7C7B\u6807\u7B7E")},{key:"checklist",name:_l("\u68C0\u67E5\u6E05\u5355")},{key:"parentTaskName",name:_l("\u6BCD\u4EFB\u52A1\u540D\u79F0")},{key:"subtaskName",name:_l("\u5B50\u4EFB\u52A1\u540D\u79F0")}]},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){$(".exportFolder").on("click",".printOperation .checkOperation",function(){$(this).toggleClass("checked")})}},{key:"submit",value:function(){this.props.onClose();var e="folderId="+this.props.folderId+"&timestamp="+new Date().getTime();$(".printOperation .checkOperation:not(.checkOperationDisabled)").each(function(){e+="&"+$(this).attr("name")+"="+$(this).hasClass("checked")}),window.open((0,oe.Z6)(md.global.Config.AjaxApiUrl+"download/exportFolderToExcel?"+e))}},{key:"render",value:function(){var e=this;return n.createElement(ie.Z,{visible:!0,className:"exportFolder",title:_l("\u9009\u62E9\u60A8\u9700\u8981\u5BFC\u51FA\u7684\u90E8\u5206"),okText:_l("\u5BFC\u51FA"),onOk:function(){return e.submit()},onCancel:this.props.onClose},n.createElement("div",{className:"printMessage Font16"},_l("\u9879\u76EE")),n.createElement("ul",{className:"printOperation"},this.state.folderArry.map(function(t,a){return t.key?n.createElement("li",{key:a},n.createElement("div",{className:w()({checked:!t.noSelect},t.disabled?"checkOperationDisabled":"checkOperation"),name:t.key},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),t.name)):n.createElement("li",{key:a})})),n.createElement("div",{className:"printMessage Font16 mTop15"},_l("\u4EFB\u52A1")),n.createElement("ul",{className:"printOperation"},this.state.taskType.map(function(t,a){return t.key?n.createElement("li",{key:a},n.createElement("div",{className:w()({checked:!t.noSelect},t.disabled?"checkOperationDisabled":"checkOperation"),name:t.key},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),t.name)):n.createElement("li",{key:a})})),n.createElement("div",{className:"printMessage Font16 mTop15"},_l("\u4EFB\u52A1\u4FE1\u606F")),n.createElement("ul",{className:"printOperation"},this.state.taskArray.map(function(t,a){return t.key?n.createElement("li",{key:a},n.createElement("div",{className:w()({checked:!t.noSelect},t.disabled?"checkOperationDisabled":"checkOperation"),name:t.key},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),t.name)):n.createElement("li",{key:a})})))}}]),d}(n.Component),Fa=k(17344),xa=k(30381),p=k.n(xa),Ve=k(43727),ht=k(92531),vt=k(25273),La=k(20845),Ma=(0,$e.Z)(Ae.Z),Aa=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.switchNetwork=function(t){var a=e.props.taskConfig.taskFilter;(0,I.yM)(a,ee()({},e.props.taskConfig,{lastMyProjectId:t})),e.props.dispatch((0,B.Jb)(t))},e.switchTaskStatus=function(t){var a=e.props.taskConfig,r=a.listSort,s=a.folderId,i=a.taskFilter,o=a.filterUserId;t!==0&&(r===0||r===2)&&(r=10),t===0&&r===8&&(r=10),o||(0,I.yM)(s?"":i,ee()({},e.props.taskConfig,{listStatus:t,listSort:r})),e.props.dispatch((0,B.QW)(t,r))},e.switchCompleteTime=function(t){var a=e.props.taskConfig,r=a.folderId,s=a.taskFilter,i=a.filterUserId;i||(0,I.yM)(r?"":s,ee()({},e.props.taskConfig,{completeTime:t})),e.props.dispatch((0,B.sq)(t))},e.switchListSort=function(t){var a=e.props.taskConfig,r=a.folderId,s=a.taskFilter,i=a.filterUserId;i||(0,I.yM)(r?"":s,ee()({},e.props.taskConfig,{listSort:t})),e.props.dispatch((0,B.Te)(t))},e.switchTaskAscription=function(t){(0,I.yM)(t,ee()({},e.props.taskConfig,{taskFilter:t})),e.props.dispatch((0,B.UO)(t))},e.clearAllCharges=function(){e.props.dispatch((0,B.qv)([]))},e.switchTags=function(t,a){e.props.dispatch((0,B.y)(a))},e.clearTags=function(t){var a=y().cloneDeep(e.props.taskConfig.filterSettings.tags);y().remove(a,function(r){return r===t}),e.props.dispatch((0,B.y)(a))},e.clearAllTags=function(){e.props.dispatch((0,B.y)([]))},e.switchCustoms=function(t,a){var r=y().cloneDeep(e.props.taskConfig.filterSettings.customFilter);a.length?r[t]=a:delete r[t],e.props.dispatch((0,B.iO)(r))},e.clearCustoms=function(t,a){var r=y().cloneDeep(e.props.taskConfig.filterSettings.customFilter);y().remove(r[t],function(s){return s===a}),r[t].length||delete r[t],e.props.dispatch((0,B.iO)(r))},e.clearAllCustoms=function(t){var a=y().cloneDeep(e.props.taskConfig.filterSettings.customFilter);delete a[t],e.props.dispatch((0,B.iO)(a))},e.reset=function(){var t=e.props.taskConfig,a=t.folderId,r=t.taskFilter,s=t.filterUserId,i=!s&&(r===6||r===1||r===2||r===3)?6:r,o=ee()({},e.props.taskConfig,S.ZP.clearFilterSettings,{lastMyProjectId:"all",listStatus:0,completeTime:"",taskFilter:i,listSort:10});s||(0,I.yM)(o.taskFilter,o),e.props.dispatch((0,B.gP)(o))},e.clickAway=function(){e.props.taskFilterLeave()},e.state={openAllCharges:!1,getTagsComplete:!1,overNotStarted:0,expiredUnfinished:0,tags:[],customs:[],members:[]},e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){var e=this,t=this.props.taskConfig,a=t.folderId,r=t.filterUserId,s=t.taskFilter,i=t.projectId;s!==8&&L.Z.getTags({folderId:a,projectId:"all",fromType:a?a===1?2:1:0,other:!!r}).then(function(o){o.status?o.data.length&&(o.data.push({tagID:"null",tagName:_l("\u672A\u5173\u8054\u6807\u7B7E")}),e.setState({tags:o.data})):(0,I.N3)(o.error),e.setState({getTagsComplete:!0})}),a&&a!==1&&(L.Z.getTaskOptionsInFolder({folderId:a}).then(function(o){o.status?e.setState({customs:o.data}):(0,I.N3)(o.error)}),L.Z.getFolderTaskCharges({folderId:a}).then(function(o){o.status?e.setState({members:o.data}):(0,I.N3)(o.error)})),this.getTwoTypeTaskCount(),this.mounted=!0,$("#taskList .listStage").css("paddingRight",270)}},{key:"componentDidMount",value:function(){this.props.taskConfig.searchKeyWords&&(this.search.value=this.props.taskConfig.searchKeyWords)}},{key:"componentWillReceiveProps",value:function(e){e.taskConfig.searchKeyWords||(this.search.value=""),e.taskConfig.lastMyProjectId!==this.props.taskConfig.lastMyProjectId&&this.getTwoTypeTaskCount()}},{key:"componentWillUnmount",value:function(){$("#taskList .listStage").css("paddingRight",0),this.mounted=!1}},{key:"getTwoTypeTaskCount",value:function(){var e=this,t=this.props.taskConfig,a=t.taskFilter,r=t.folderId,s=t.projectId,i=t.lastMyProjectId;L.Z.getTwoTypeTaskCount({folderId:r!==1?r:"",projectId:r?s:i,fromType:r?r===1?2:1:0,isStar:a===8}).then(function(o){o.status?e.mounted&&e.setState({overNotStarted:o.data.overNotStarted,expiredUnfinished:o.data.expiredUnfinished}):(0,I.N3)(o.error)})}},{key:"renderLabel",value:function(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return n.createElement("div",{className:"filterLabel relative"},e,a?n.createElement("span",{"data-tip":a,className:"mLeft5 Font14"},n.createElement("i",{className:"icon-help"})):void 0,t?n.createElement("span",{className:"ThemeColor3 filterClear pointer",onClick:t},_l("\u6E05\u9664\u6761\u4EF6")):void 0)}},{key:"renderNetworkList",value:function(){var e=this.props.taskConfig,t=e.lastMyProjectId,a=e.filterUserId,r=md.global.Account.projects.map(function(s){return{text:s.companyName,value:s.projectId}});return r.unshift({text:_l("\u5168\u90E8\u7EC4\u7EC7"),value:"all"}),r.push({text:_l("\u4E2A\u4EBA"),value:""}),n.createElement("div",{className:"mTop10"},n.createElement(Ve.Z,{data:r,value:t,onChange:this.switchNetwork,disabled:!!a}))}},{key:"switchFolderRange",value:function(e){this.props.dispatch((0,B.dq)(e))}},{key:"updateKeyWords",value:function(e){!e&&this.search.value&&(this.search.value=""),this.props.dispatch((0,B.sO)(e))}},{key:"renderCompleteList",value:function(){var e=this.props.taskConfig.completeTime,t=[{text:_l("\u6240\u6709\u5DF2\u5B8C\u6210\u4EFB\u52A1"),value:""},{text:_l("\u67E5\u770B\u8FD1\u671F\u5B8C\u6210\u4EFB\u52A1"),disabled:!0},{text:_l("\u4ECA\u5929"),value:p()().format("YYYY-MM-DD")},{text:_l("\u6628\u5929"),value:p()().add(-1,"d").format("YYYY-MM-DD")},{text:_l("\u4E00\u5468"),value:p()().add(-7,"d").format("YYYY-MM-DD")},{text:_l("\u4E00\u4E2A\u6708"),value:p()().add(-30,"d").format("YYYY-MM-DD")}];return n.createElement("div",{className:"mTop10"},n.createElement(Ve.Z,{data:t,value:e,onChange:this.switchCompleteTime}))}},{key:"renderListSort",value:function(){var e=this.props.taskConfig,t=e.listSort,a=e.folderId,r=e.listStatus,s=e.filterUserId,i=[{text:_l("\u4F18\u5148\u7EA7"),value:0},{text:_l("\u6700\u8FD1\u66F4\u65B0"),value:10},{text:_l("\u7ED3\u675F\u65F6\u95F4"),value:2},{text:_l("\u5B8C\u6210\u65F6\u95F4"),value:8},{text:_l("\u521B\u5EFA\u65F6\u95F4"),value:3},{text:_l("\u8D1F\u8D23\u4EBA"),value:5},{text:_l("\u9879\u76EE"),value:4},{text:_l("\u540D\u79F0A-Z"),value:1}];return a&&y().remove(i,function(o){return o.value===4||o.value===0}),r===0?y().remove(i,function(o){return o.value===8}):r===2||r===3||r===4||r===5?y().remove(i,function(o){return o.value===0||o.value===8}):y().remove(i,function(o){return o.value===0||o.value===2}),s&&y().remove(i,function(o){return o.value===0}),n.createElement("div",{className:"mTop10"},n.createElement(Ve.Z,{data:i,value:t,renderValue:""+_l("\u6309%0\u6392\u5E8F","{{value}}"),onChange:this.switchListSort}))}},{key:"renderTaskAscription",value:function(e,t){var a=this,r=this.props.taskConfig.taskFilter;return n.createElement("span",{key:t,className:w()("filterTaskSolidBtn",{ThemeBGColor3:r===e.taskFilter}),onClick:function(){return a.switchTaskAscription(e.taskFilter)}},e.value)}},{key:"renderCharges",value:function(){var e=this,t=this.state,a=t.members,r=t.openAllCharges;return a.length?n.createElement("div",{className:"mTop10"},a.slice(0,r?a.length:12).map(function(s,i){return e.renderChargeItem(s,i)}),r&&n.createElement("div",{className:"mTop10"},n.createElement("span",{className:"pointer ThemeColor3",onClick:function(){return e.setState({openAllCharges:!1})}},_l("\u6536\u8D77")))):n.createElement("div",{className:"mTop10"},_l("\u65E0"))}},{key:"renderChargeItem",value:function(e,t){var a=this,r=this.state,s=r.members,i=r.openAllCharges,o=this.props.taskConfig.filterSettings,c=!i&&t===11,u=function(){c?a.setState({openAllCharges:!0}):a.selectCharges(e.accountID)};return n.createElement("span",{key:e.accountID,"data-tip":c?"":e.fullName,className:w()("filterMemberItem relative tip-top",{ThemeBorderColor3:y().includes(o.selectChargeIds,e.accountID)}),onClick:u},n.createElement("img",{src:e.avatar}),c&&n.createElement("span",{className:"filterMemberItemMore"},"+",s.length-12>99?99:s.length-12))}},{key:"selectCharges",value:function(e){var t=this.props.taskConfig.filterSettings,a=y().cloneDeep(t.selectChargeIds);y().includes(a,e)?y().remove(a,function(r){return r===e}):a.push(e),this.props.dispatch((0,B.qv)(a))}},{key:"renderTags",value:function(){var e=this,t=this.state,a=t.getTagsComplete,r=t.tags,s=this.props.taskConfig.filterSettings,i=s.tags.length?_l("\u5DF2\u9009\u62E9%0\u4E2A\u6807\u7B7E",s.tags.length):_l("\u8BF7\u9009\u62E9\u6807\u7B7E"),o=r.map(function(c){return{label:e.getTagsIcons(c.tagName,c.color),value:c.tagID}});if(r.length)return n.createElement("div",{className:"mTop10"},n.createElement(ht.Z,{value:s.tags,options:o,multipleSelect:!0,label:i,multipleLevel:!1,multipleHideDropdownNav:!0,onChange:this.switchTags}),n.createElement("div",{className:"mTop10"},s.tags.map(function(c){return r.map(function(u){if(u.tagID===c)return n.createElement("span",{key:c,className:"filterOptions"},n.createElement("span",{className:"filterOptionsBtn ThemeBorderColor3"},u.color&&n.createElement("span",{className:"tagCircle",style:{background:u.color}}),u.tagName),n.createElement("span",{className:"filterOptionsDel ThemeBGColor3",onClick:function(){return e.clearTags(c)}},n.createElement("i",{className:"icon-close"})))})})));if(a)return n.createElement("div",{className:"mTop10"},_l("\u65E0"))}},{key:"getTagsIcons",value:function(e,t){return n.createElement("span",null,t&&n.createElement("span",{className:"tagCircle",style:{background:t}}),n.createElement("span",{className:"Font13"},e))}},{key:"renderCustoms",value:function(e,t){var a=this,r=this.props.taskConfig.filterSettings,s=r.customFilter[e.controlId]||[],i=s.length?_l("\u5DF2\u9009\u62E9%0\u9879",s.length):_l("\u6309%0\u7B5B\u9009",e.controlName),o=e.options.map(function(c){return{label:c.value,value:c.key}});return n.createElement("div",{key:t},this.renderLabel(e.controlName,s.length>0?function(){return a.clearAllCustoms(e.controlId)}:!1),n.createElement("div",{className:"mTop10"},n.createElement(ht.Z,{value:s,options:o,multipleSelect:!0,label:i,multipleLevel:!1,multipleHideDropdownNav:!0,onChange:function(u,f){return a.switchCustoms(e.controlId,f)}}),n.createElement("div",{className:"mTop10"},s.map(function(c,u){return o.map(function(f){if(f.value===c)return n.createElement("span",{key:u+f.value,className:"filterOptions"},n.createElement("span",{className:"filterOptionsBtn ThemeBorderColor3"},f.label),n.createElement("span",{className:"filterOptionsDel ThemeBGColor3",onClick:function(){return a.clearCustoms(e.controlId,f.value)}},n.createElement("i",{className:"icon-close"})))})}))))}},{key:"render",value:function(){var e=this,t=this.props.taskConfig,a=t.searchKeyWords,r=t.folderId,s=t.filterSettings,i=t.listStatus,o=t.taskFilter,c=t.filterUserId,u=s.folderSearchRange,f=this.state,h=f.tags,g=f.members,T=f.customs,E=f.overNotStarted,C=f.expiredUnfinished,N=[{value:_l("\u6211\u8D1F\u8D23"),taskFilter:2},{value:_l("\u6211\u53C2\u4E0E"),taskFilter:1},{value:_l("\u6211\u6258\u4ED8"),taskFilter:3},{value:_l("\u5168\u90E8"),taskFilter:6}];return n.createElement(Ma,{className:"taskFilterBox",onClickAwayExceptions:[$(".taskFilterBtn")],onClickAway:this.clickAway},n.createElement("div",{className:"filterHead relative flexRow"},n.createElement("span",{className:w()("Font16",{Hidden:this.props.showReset})},_l("\u7B5B\u9009\u4E0E\u6392\u5E8F")),n.createElement("span",{className:w()("filterHeadReset pointer Font13 ThemeColor3 ThemeBorderColor3 ThemeHoverColor2 ThemeHoverBorderColor2",{Hidden:!this.props.showReset}),onClick:this.reset},_l("\u91CD\u7F6E\u9009\u62E9")),n.createElement("div",{className:"flex"}),n.createElement("i",{className:"icon-delete Font20 ThemeColor3 pointer",onClick:this.props.taskFilterLeave})),n.createElement(vt.Z,{className:"flex"},n.createElement("div",{className:"filterContent"},!r&&this.renderNetworkList(),n.createElement("div",{className:w()("relative mTop5",{Hidden:!r})},n.createElement("i",{className:"icon-search filterSearchIcon"}),n.createElement("input",{ref:function(x){e.search=x},type:"text",placeholder:_l("\u641C\u7D22\u4EFB\u52A1"),className:"filterSearch boderRadAll_5 ThemeBorderColor3",onBlur:function(x){return e.updateKeyWords(x.currentTarget.value)},onKeyDown:function(x){return x.keyCode===13&&e.updateKeyWords(x.currentTarget.value)}}),a&&n.createElement("i",{className:"icon-closeelement-bg-circle filterSearchClear ThemeColor8",onClick:function(){return e.updateKeyWords("")}})),r&&r!==1?n.createElement("div",{className:"filterFolderSearch"},n.createElement(La.Z,{checked:u===7,onClick:function(x){return e.switchFolderRange(x?6:7)}},_l("\u4EC5\u770B\u4E0E\u6211\u6709\u5173\u7684\u4EFB\u52A1"))):void 0,this.renderLabel(_l("\u72B6\u6001")),n.createElement("div",{className:"mTop10"},n.createElement("div",{className:"flexRow"},n.createElement("div",{className:w()("taskDelayAndOverdue flexColumn taskDelay",{active:i===4}),onClick:function(){return e.switchTaskStatus(4)}},n.createElement("div",{className:"Font20"},E),n.createElement("div",null,_l("\u5EF6\u671F\u672A\u5F00\u59CB"))),n.createElement("div",{className:"flex"}),n.createElement("div",{className:w()("taskDelayAndOverdue flexColumn taskOverdue",{active:i===5}),onClick:function(){return e.switchTaskStatus(5)}},n.createElement("div",{className:"Font20"},C),n.createElement("div",null,_l("\u903E\u671F\u672A\u5B8C\u6210")))),n.createElement("div",{className:"flexRow"},n.createElement("div",{className:w()("taskStatusNoComplete",{ThemeBGColor3:i===0}),onClick:function(){return e.switchTaskStatus(0)}},_l("\u672A\u5B8C\u6210\u4EFB\u52A1")),n.createElement("div",{className:"flex"}),n.createElement("div",{className:w()("taskStatusAll",{ThemeBGColor3:i===-1}),onClick:function(){return e.switchTaskStatus(-1)}},_l("\u6240\u6709\u4EFB\u52A1"))),n.createElement("div",{className:"flexRow taskStatusBtns"},n.createElement("div",{className:w()("taskStatusBtn",{active:i===-1||i===0},{"ThemeBGColor3 ThemeBorderColor3":i===2}),onClick:function(){return e.switchTaskStatus(2)}},_l("\u672A\u5F00\u59CB")),n.createElement("div",{className:w()("flex taskStatusLine",{active:i===-1||i===0})}),n.createElement("div",{className:w()("taskStatusBtn",{active:i===-1||i===0},{"ThemeBGColor3 ThemeBorderColor3":i===3}),onClick:function(){return e.switchTaskStatus(3)}},_l("\u8FDB\u884C\u4E2D")),n.createElement("div",{className:w()("flex taskStatusLine",{active:i===-1})}),n.createElement("div",{className:w()("taskStatusBtn",{active:i===-1},{"ThemeBGColor3 ThemeBorderColor3":i===1}),onClick:function(){return e.switchTaskStatus(1)}},_l("\u5DF2\u5B8C\u6210")))),i===1&&this.renderCompleteList(),o!==8&&this.renderLabel(_l("\u6392\u5E8F")),o!==8&&this.renderListSort(),!r&&o!==8&&!c&&this.renderLabel(_l("\u76F8\u5173\u6027")),!r&&o!==8&&!c&&n.createElement("div",{className:"mTop10"},N.map(function(F,x){return e.renderTaskAscription(F,x)})),n.createElement("div",{className:"filterLine"}),r&&r!==1&&this.renderLabel(_l("\u6309\u4EFB\u52A1\u8D1F\u8D23\u4EBA\u7B5B\u9009"),s.selectChargeIds.length>0?this.clearAllCharges:!1),r&&r!==1&&this.renderCharges(),o!==8&&this.renderLabel(_l("\u6309\u6807\u7B7E\u7B5B\u9009"),s.tags.length>0?this.clearAllTags:!1,_l("\u4F60\u53EF\u4EE5\u4E3A\u4EFB\u52A1\u6DFB\u52A0\u6807\u7B7E\u5C5E\u6027\uFF0C\u901A\u8FC7\u6807\u7B7E\u7B5B\u9009\u51FA\u4EFB\u52A1")),o!==8&&this.renderTags(),T.map(function(F,x){return e.renderCustoms(F,x)}))))}}]),d}(n.Component);const $a=(0,re.$j)(function(v){return v.task})(Aa);var Ba=(0,$e.Z)(Ae.Z),_a=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.createTask=function(){var t=e.props.taskConfig,a=t.folderId,r=t.viewType,s=t.projectId;a===1||a&&r===S.ZP.folderViewType.treeView?setTimeout(function(){mt.init({folderId:a===1?"":a,projectId:s})},10):$.CreateTask()},e.showFilter=function(t){var a=e.state.showFilter;e.checkMouseDownIsLeft(t)&&(a?e.taskFilterLeave():e.setState({showFilter:!a}),$("#tasks").toggleClass("showTaskFilter",!a))},e.taskFilterLeave=function(){$(".taskFilterBox").addClass("reverse"),$("#tasks").removeClass("showTaskFilter"),setTimeout(function(){return e.setState({showFilter:!1})},250)},e.openNewPage=function(){var t=e.props.folderSettings.folderID;e.setState({showOperator:!1}),window.open("/apps/task/folder_"+t+"?"+(0,oe.tQ)())},e.saveTemplate=function(){var t=e.props.taskConfig.folderId;e.setState({showOperator:!1}),L.Z.saveAsMyFolderTemplate({folderId:t}).then(function(a){a.status?alert(_l("\u4FDD\u5B58\u6210\u529F")):(0,I.N3)(a.error)})},e.updateFolderArchived=function(){var t=e.props.folderSettings,a=t.projectID,r=t.folderID,s=t.isArchived;e.setState({showOperator:!1}),(0,te.om)(a,r,!s),e.props.dispatch((0,B.yA)(!s))},e.updateFolderTop=function(){var t=e.props.folderSettings,a=t.folderID,r=t.isTop;(0,te.Jc)(a,!r,function(){e.props.dispatch((0,B.YK)(!r))})},e.editFolderName=function(){var t=e.props.folderSettings.auth;(t===S.ZP.auth.FolderCharger||t===S.ZP.auth.FolderAdmin)&&e.setState({showEdit:!0})},e.updateFolderName=function(t){e.setState({folderName:t.currentTarget.value})},e.folderKeyDown=function(t){t.keyCode===13&&e.saveFolderName()},e.saveFolderName=function(){e.setState({showEdit:!1});var t=$.trim(e.state.folderName),a=e.props.taskConfig.folderId;t&&t!==e.props.folderSettings.folderName?e.props.dispatch((0,B.PS)(a,t,function(){$(".folderList li[data-id="+a+"] .folderName").text(t).attr("title",(0,oe.u1)(t))})):e.setState({folderName:e.props.folderSettings.folderName})},e.updateFolderNotice=function(){var t=e.props.folderSettings,a=t.folderID,r=t.folderNotice;e.props.dispatch((0,B.lZ)(a,!r))},e.switchTabs=function(t){var a=ee()({},e.props.taskConfig,{viewType:t});t!==S.ZP.folderViewType.treeView&&t!==S.ZP.folderViewType.stageView&&e.taskFilterLeave(),(0,I.yM)("",a),e.props.dispatch((0,B.gP)(a))},e.state={folderName:"",showEdit:!1,showOperator:!1,showSetFolder:!1,showCopyFolder:!1,showExportFolder:!1,showFilter:!1,showShareDialog:!1},e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){var e=this.props.taskConfig.folderId;e===1?this.setState({folderName:_l("\u672A\u5173\u8054\u9879\u76EE")}):e&&this.props.dispatch((0,B.aK)(e))}},{key:"componentWillReceiveProps",value:function(e){(e.taskConfig.folderId!==this.props.taskConfig.folderId||this.state.showFilter&&e.taskConfig.taskFilter===8&&this.props.taskConfig.taskFilter!==8||this.props.taskConfig.taskFilter===8&&e.taskConfig.taskFilter!==8)&&this.taskFilterLeave(),e.taskConfig.folderId&&e.taskConfig.folderId!==1&&e.taskConfig.folderId!==this.props.taskConfig.folderId&&this.props.dispatch((0,B.aK)(e.taskConfig.folderId)),e.folderSettings.folderName!==this.state.folderName&&this.setState({folderName:e.folderSettings.folderName})}},{key:"componentDidUpdate",value:function(){this.state.showEdit&&!$(".txtName").is(":focus")&&$(".txtName").select()}},{key:"checkMouseDownIsLeft",value:function(e){return e.button===0}},{key:"renderRightOperatorBtn",value:function(){var e=this,t=this.state,a=t.showSetFolder,r=t.showCopyFolder,s=t.showExportFolder,i=t.showOperator,o=t.showFilter,c=t.showShareDialog,u=this.props.taskConfig,f=u.folderId,h=u.viewType,g=u.lastMyProjectId,T=u.listStatus,E=u.listSort,C=u.searchKeyWords,N=u.filterSettings,F=u.taskFilter,x=u.filterUserId,A=this.props.folderSettings,H=A.auth,K=A.isMember,Q=A.projectID,X=A.folderName,le=A.chargeUser,Ge=A.isArchived,he=H===S.ZP.auth.FolderCharger,Le=H===S.ZP.auth.FolderAdmin,_=0,q=function(){C!==""&&_++,N.tags.length&&_++,y().isEmpty(N.customFilter)||_++,N.selectChargeIds.length&&_++,N.folderSearchRange!==6&&_++};return f?(T!==0&&_++,E!==10&&_++,q()):F===8?(T!==0&&_++,g!=="all"&&_++):x?(T!==0&&_++,E!==10&&_++,q()):(g!=="all"&&_++,T!==0&&_++,E!==10&&_++,F!==6&&_++,q()),n.createElement("div",{className:"flex"},n.createElement("div",{className:"createNewTaskBtn ThemeBGColor3 Right ThemeHoverBGColor2",onClick:this.createTask},n.createElement("i",{className:"icon-plus"}),_l("\u65B0\u4EFB\u52A1")),!f||f&&(h===S.ZP.folderViewType.treeView||h===S.ZP.folderViewType.stageView)?n.createElement("div",{className:"Right"},n.createElement("span",{className:w()("taskFilterBtn pointerEventAll",{ThemeColor3:_>0||o}),onMouseDown:this.showFilter,"data-tip":_l("\u7B5B\u9009\u4E0E\u6392\u5E8F")},_===0?o?n.createElement("i",{className:"icon-screen_active"}):n.createElement("i",{className:"icon-screen_normal"}):n.createElement("i",{className:"icon-screen_"+_}))):void 0,f&&f!==1?n.createElement("div",{className:"Right mRight20","data-tip":_l("\u8BBE\u7F6E")},n.createElement("i",{className:"icon-settings folderSettingsBtn",onMouseDown:function(Me){return e.checkMouseDownIsLeft(Me)&&e.setState({showOperator:!e.state.showOperator})}})):void 0,o&&n.createElement($a,{taskFilterLeave:this.taskFilterLeave,showReset:_>0}),i?n.createElement(Ba,{component:"ul",className:w()("folderOperatorList boxShadow5 boderRadAll_3"),onClickAway:function(){return e.setState({showOperator:!1})}},he||Le?n.createElement(n.Fragment,null,n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.setState({showEdit:!0,showOperator:!1})}},n.createElement("i",{className:"icon-hr_edit"}),_l("\u91CD\u547D\u540D")),n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.setState({showSetFolder:!0,showOperator:!1})}},n.createElement("i",{className:"icon-settings"}),_l("\u9879\u76EE\u914D\u7F6E")),n.createElement("li",{className:"dividerLine"}),n.createElement("li",{className:"ThemeBGColor3",onClick:function(){(0,oe.pF)(Q).then(function(){e.setState({showCopyFolder:!0,showOperator:!1})})}},n.createElement("i",{className:"icon-task-new-copy"}),_l("\u590D\u5236\u9879\u76EE"))):void 0,n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.setState({showShareDialog:!0,showOperator:!1})}},n.createElement("i",{className:"icon-link2"}),_l("\u83B7\u53D6\u94FE\u63A5\u4E0E\u4E8C\u7EF4\u7801")),n.createElement("li",{className:"ThemeBGColor3",onClick:this.openNewPage},n.createElement("i",{className:"icon-task-new-detail Font12"}),_l("\u65B0\u9875\u9762\u6253\u5F00")),n.createElement("li",{className:"ThemeBGColor3",onClick:this.saveTemplate},n.createElement("i",{className:"icon-task_set_administrator"}),_l("\u4FDD\u5B58\u5230\u6211\u7684\u6A21\u677F"),n.createElement("span",{className:"mLeft5 tip-bottom-left","data-tip":_l("\u9879\u76EE\u53CA\u770B\u677F\u540D\u79F0\u3001\u81EA\u5B9A\u4E49\u4EFB\u52A1\u5185\u5BB9\u88AB\u4FDD\u5B58\u4E3A\u6A21\u677F\u7684\u4FE1\u606F")},n.createElement("i",{className:"icon-knowledge-message"}))),he||Le?n.createElement("li",{className:"ThemeBGColor3",onClick:function(){return e.setState({showExportFolder:!0,showOperator:!1})}},n.createElement("i",{className:"icon-task_custom_excel_01"}),_l("\u5BFC\u51FA\u4EFB\u52A1\u5217\u8868\u5230Excel")):void 0,he||Le||K?n.createElement("li",{className:"dividerLine"}):void 0,he?n.createElement(n.Fragment,null,n.createElement("li",{className:"ThemeBGColor3",onClick:this.updateFolderArchived},n.createElement("i",{className:"icon-task-pigeonhole"}),Ge?_l("\u53D6\u6D88\u5F52\u6863\u9879\u76EE"):_l("\u5F52\u6863\u9879\u76EE")),n.createElement("li",{className:"ThemeBGColor3 delColor",onClick:function(){e.setState({showOperator:!1}),(0,te.Go)(f,e.props.hideNavigation)}},n.createElement("i",{className:"icon-task-new-delete"}),_l("\u5220\u9664\u9879\u76EE"))):void 0,!he&&K?n.createElement("li",{className:"ThemeBGColor3",onClick:function(){e.setState({showOperator:!1}),(0,te.Ud)(f,e.props.hideNavigation)}},n.createElement("i",{className:"icon-task-new-exit"}),_l("\u9000\u51FA\u9879\u76EE")):void 0):void 0,a&&n.createElement(ba,{folderId:f,onClose:function(){return e.setState({showSetFolder:!1})}}),r&&n.createElement(lt,{isAdmin:he||Le,projectId:Q,chargeUser:le.accountID,folderName:X,folderId:f,onClose:function(){return e.setState({showCopyFolder:!1})},callback:function(Me){e.setState({showCopyFolder:!1}),!e.props.hideNavigation&&(0,te.L6)(Me)}}),c&&n.createElement(Fa.Z,{shareUrl:md.global.Config.WebUrl+"apps/task/folder_"+f,shareMessage:_l("\u7528App\u626B\u4E00\u626B\uFF0C\u53EF\u5728\u624B\u673A\u4E0A\u5FEB\u901F\u663E\u793A\u67E5\u770B\u9879\u76EE\u8BE6\u60C5"),linkText:_l("\u590D\u5236\u9879\u76EE\u94FE\u63A51"),onClose:function(){return e.setState({showShareDialog:!1})}}),s&&n.createElement(wa,{folderId:f,onClose:function(){return e.setState({showExportFolder:!1})}}))}},{key:"renderTaskToolbar",value:function(){var e=this.props.searchTaskCount,t=this.props.taskConfig,a=t.folderId,r=t.taskFilter,s=t.keyWords,i=t.searchKeyWords,o=t.filterUserId,c=function(){var f=void 0;switch(r){case 8:f=_l("\u661F\u6807\u4EFB\u52A1");break;case 2:f=o?_l("\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1"):_l("\u6211\u7684\u4EFB\u52A1");break;case 3:f=o?_l("\u4ED6\u6258\u4ED8\u7684\u4EFB\u52A1"):_l("\u6211\u7684\u4EFB\u52A1");break;case 1:f=o?_l("\u4ED6\u53C2\u4E0E\u7684\u4EFB\u52A1"):_l("\u6211\u7684\u4EFB\u52A1");break;case 7:f=_l("\u4E0E\u4ED6\u534F\u4F5C\u7684\u4EFB\u52A1");break;case 10:f=_l("\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1");break;default:f=_l("\u6211\u7684\u4EFB\u52A1")}return i?f=_l("\u6240\u6709\u548C\u201C%0\u201D\u6709\u5173\u7684\u4EFB\u52A1",i)+(" "+(e||"")):s&&(f=_l("\u6240\u6709\u548C\u6807\u7B7E\u201C%0\u201D\u6709\u5173\u7684\u4EFB\u52A1",s)+(" "+(e||""))),f};return n.createElement("div",{className:"flexRow"},n.createElement("div",{className:"taskTypeName"},a===1?_l("\u672A\u5173\u8054\u9879\u76EE\u7684\u4EFB\u52A1"):c()),this.renderRightOperatorBtn())}},{key:"renderFolderToolbar",value:function(){var e=this.props.folderSettings,t=this.props.taskConfig,a=t.projectId,r=t.folderId,s=t.viewType,i="",o=!1,c=!1,u=!1,f=!1,h=_l("\u4E2A\u4EBA");return $.map(md.global.Account.projects,function(g){g.projectId===a&&(h=g.companyName)}),e.folderID===r&&(i=e.folderName,o=e.auth===S.ZP.auth.FolderCharger||e.auth===S.ZP.auth.FolderAdmin,c=e.isTop,u=e.folderNotice,f=e.isNotice),n.createElement("div",{className:"flexRow"},n.createElement("div",{className:"flex relative"},n.createElement("div",{className:"flexRow folderBarBox"},this.props.hideNavigation?null:n.createElement("span",{className:w()("folderTop tip-bottom-right",{active:c}),"data-tip":c?_l("\u53D6\u6D88\u7F6E\u9876"):_l("\u7F6E\u9876"),onClick:this.updateFolderTop},n.createElement("i",{className:"icon-folder-top"})),n.createElement("span",{className:"networkLabel tip-bottom-right","data-tip":h},n.createElement("i",{className:a?"icon-company":"icon-charger"})),this.state.showEdit?n.createElement("input",{type:"text",value:this.state.folderName,className:"txtName boderRadAll_3 flex",maxLength:"100",onChange:this.updateFolderName,onKeyDown:this.folderKeyDown,onBlur:this.saveFolderName}):n.createElement("span",{className:w()("folderName",{"ThemeColor3 pointer":o}),onClick:this.editFolderName},i),o?n.createElement("span",{className:"mLeft5 folderNoticeBtn","data-tip":u?_l("\u5DF2\u5173\u95ED\u63D0\u9192"):_l("\u5DF2\u5F00\u542F\u63D0\u9192"),onClick:this.updateFolderNotice},n.createElement("i",{className:u?"icon-chat-bell-nopush":"icon-inbox"})):void 0,!this.state.showEdit&&n.createElement("div",{className:"flex"}))),n.createElement("ul",{className:"folderTabList"},n.createElement("li",{className:w()("ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.treeView}),title:_l("\u5217\u8868\u89C6\u56FE"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.treeView)},_l("\u5217\u8868")),n.createElement("li",{className:w()("ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.stageView}),title:_l("\u770B\u677F\u89C6\u56FE"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.stageView)},_l("\u770B\u677F")),n.createElement("li",{className:w()("ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.taskGantt}),title:_l("\u65F6\u95F4"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.taskGantt)},_l("\u65F6\u95F4")),n.createElement("li",{className:w()("folderDetailMode ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.folderDetail},{hasNewTipRight:f}),title:_l("\u8BE6\u60C5"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.folderDetail)},_l("\u8BE6\u60C5"),n.createElement("i",{className:w()("folderNewTip circle",{Hidden:!f})})),n.createElement("li",{className:w()("ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.attachment}),title:_l("\u6587\u4EF6"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.attachment)},_l("\u6587\u4EF6")),n.createElement("li",{className:w()("ThemeBorderColor3 ThemeColor3",{active:s===S.ZP.folderViewType.folderChart}),title:_l("\u7EDF\u8BA1"),onClick:this.switchTabs.bind(this,S.ZP.folderViewType.folderChart)},_l("\u7EDF\u8BA1"))),this.renderRightOperatorBtn())}},{key:"render",value:function(){var e=this.props.taskConfig,t=e.folderId,a=e.viewType;return t&&this.props.folderSettings.code?null:n.createElement("div",{className:w()("taskToolbar",{taskToolbarBottomClear:t&&(a===S.ZP.folderViewType.taskGantt||a===S.ZP.folderViewType.attachment)})},t&&t!==1?this.renderFolderToolbar():this.renderTaskToolbar())}}]),d}(n.Component);const Ha=(0,re.$j)(function(v){return v.task})(_a);var Ke=k(90937),Pa=k(52815);const m={isReady:!0,isRequestComplete:!0,projectId:"",folderId:"",timeStamp:"",minStartTime:"",maxEndTime:"",TASKSTATUS:{NO_COMPLETED:0,COMPLETED:1,ALL:-1},workingTimes:[["09:00","18:00"]],workingSumHours:9,VIEWTYPE:{DAY:1,WEEK:2,MONTH:3},GRANULARITY:{DAY:8,WEEK:4,MONTH:1},filterWeekendDay:[0,6],SUBTASKLEVEL:{ALL:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5},SINGLE_TIME:{START:1,END:2},ARROW_STATUS:{NULL:0,OPEN:1,CLOSED:2},TASK_NAME_SIZE:136,TASK_MESSAGE_SIZE:80,DRAG_GANTT:"gantt",mouseOffset:{left:0,top:0},offset:{x:0,y:0},diffHours:0,originalStartTime:"",originalEndTime:"",oldStartTime:"",oldEndTime:"",newStartTime:"",newEndTime:"",offsetX:0,scrollLeft:0,setInterval:"",singleDragTaskId:"",recordSingleTime:"",isHiddenLastTips:!1,DRAG_DIRECTION:{LEFT:1,RIGHT:2},dragItem:"",DARG_INDEX:0,isEndDrag:!1,isSingleDrag:!1,scrollSelector:""};var Ua=k(45697),gt=k.n(Ua),Ne=k(33867),Ya=[{type:"day",text:"\u6309\u5929"},{type:"week",text:"\u6309\u5468"},{type:"month",text:"\u6309\u6708"}],Oa=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.data,r=e.name,s=e.switchDisplayType,i=e.refresh,o=e.exportData,c=e.closeLayer,u=e.scrollToToday;return n.createElement("div",{className:"ganttHeader flexRow"},n.createElement("div",{className:"projectName ellipsis"},r),a&&a.length?n.createElement(n.Fragment,null,n.createElement("div",{className:"controlWrap flex flexRow"},n.createElement("div",{className:"today",onClick:u},"\u4ECA\u5929"),n.createElement("div",{className:"chooseDisplayType "},Ya.map(function(f){return n.createElement("span",{onClick:function(){return s(f.type)},className:w()(f.type,{active:f.type===t}),key:f.type},f.text)}))),n.createElement("div",{className:"operationWrap flexRow"},n.createElement("div",{className:"refresh operation ThemeColor3",onClick:i},n.createElement(Ne.Z,{icon:"refresh"}),n.createElement("span",null,"\u5237\u65B0")),n.createElement("div",{className:"export operation ThemeColor3",onClick:o},n.createElement(Ne.Z,{icon:"export"}),n.createElement("span",null,"\u5BFC\u51FA")),n.createElement("canvas",{id:"ganttCanvas",className:"Hidden"}))):n.createElement("div",{className:"flex"}),n.createElement("div",{className:"close operation ThemeColor3 pointer",onClick:c},n.createElement(Ne.Z,{icon:"delete"})))}}]),d}(n.Component);const fe={scrollingEle:"",scrollLeft:0,beginTime:"",endTime:"",TYPE_TO_WIDTH:{day:44,week:18,month:6}};var ja,kt,Tt,Ra=20,Ga=(kt=ja=function(v){(0,W.default)(d,v);function d(){var l,e,t,a;(0,j.default)(this,d);for(var r=arguments.length,s=Array(r),i=0;i<r;i++)s[i]=arguments[i];return a=(e=(t=(0,Y.default)(this,(l=d.__proto__||G()(d)).call.apply(l,[this].concat(s))),t),Tt.call(t),e),(0,Y.default)(t,a)}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=document.querySelector(".graphWrap");this.taskList.addEventListener("scroll",function(t){t.currentTarget.className==fe.scrollingEle&&(e.scrollTop=t.target.scrollTop)}),this.taskList.addEventListener("mouseover",function(t){fe.scrollingEle=t.currentTarget.className})}},{key:"render",value:function(){var e=this,t=this.props.data;return n.createElement("div",{className:"ganttSideBarWrap flexColumn"},n.createElement("header",null,_l("\u4EFB\u52A1\u5217\u8868")),n.createElement("div",{className:"taskListWrap",ref:function(r){return e.taskList=r}},this.renderTaskList(t)))}}]),d}(n.Component),Tt=function(){var d=this;this.renderTaskList=function(l){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=e.length?e.map(function(a){return++a}).join(".")+".":"";return l&&l.map(function(a,r){var s=e.slice();return s.push(r),n.createElement("div",{key:r+t,className:"taskItem"},n.createElement("div",{style:{paddingLeft:12+Ra*e.length},className:w()("taskInfo flexRow"),onMouseOver:function(o){return d.props.handleTaskItemHover(!0,o)},onMouseOut:function(){return d.props.handleTaskItemHover(!1)}},n.createElement("div",{className:w()("toggleTask ThemeColor3",{haveChildren:a.child&&a.child.length,childrenVisible:a.childrenVisible},a.childrenVisible?"icon-remove_circle_outline":"icon-addapplication"),onClick:function(){return d.props.toggleTask(s)}}),n.createElement("span",{className:"seq"},""+t+(r+1)+")"),n.createElement("span",{className:"name textOverflow",onClick:function(){return d.props.showDetail(a.taskID)}},a.taskName)),a.child&&a.childrenVisible&&n.createElement("div",{className:"childrenWrap"},d.renderTaskList(a.child,s)))})}},kt),Wa=k(42723),Za=k(24043),Va=k.n(Za),Ka=k(88902),Ce=k.n(Ka),Xe=function(d){return Ce()(d).map(function(l){return{pub:l,sub:d[l]}})},Xa=function(d,l){d=d.clone(),l=l.clone();for(var e=p().duration(l.diff(d)).asDays(),t={},a=0;a<e;a++){var r=d.format("YYYY.MM"),s=""+d.date();t[r]?t[r].push(s):t[r]=[s],d.add(1,"day")}return Xe(t)},za=function(d,l){d=d.clone(),l=l.clone();for(var e=Math.round(p().duration(l.diff(d)).asDays()/7),t={},a=0;a<e;a++){var r=d.format("YYYY.MM"),s=d.date()+"-"+d.add(6,"day").date()+"\u65E5 "+d.week()+"\u5468";t[r]?t[r].push(s):t[r]=[s],d.add(1,"day")}return Xe(t)},Ja=function(d,l){d=d.clone(),l=l.clone();for(var e=Math.round(p().duration(l.diff(d)).asMonths()),t={},a=0;a<e;a++){var r=""+d.year(),s=d.month()+1+"\u6708";t[r]?t[r].push(s):t[r]=[s],d.add(1,"month")}return Xe(t)},De=function(d,l){return p().duration(l.diff(d)).asDays()},Be=function(d){return d&&d.split(" ")[0]},Ct=function(d){return p()(Be(d))},Qa=fe.TYPE_TO_WIDTH,qa=function(d){return d.sub.reduce(function(l,e){return l+p()(""+d.pub+e,"YYYYM\u6708").daysInMonth()},0)},er=function(v){(0,W.default)(d,v);function d(){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).apply(this,arguments))}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=document.querySelectorAll(".pubTime");this.props.getPosList(e)}},{key:"componentDidUpdate",value:function(){var e=document.querySelectorAll(".pubTime");this.props.getPosList(e)}},{key:"shouldComponentUpdate",value:function(e){return!y().isEqual(this.props.time,e.time)}},{key:"render",value:function(){var e=this.props,t=e.time,a=e.type,r=Qa[a],s=void 0,i=void 0;return n.createElement("div",{className:"timeHeader flexRow"},t.map(function(o,c){return a==="day"&&(s=r*o.sub.length,i=r),a==="week"&&(s=r*o.sub.length*7,i=r*7),a==="month"&&(s=r*qa(o)),n.createElement("div",{key:"pub-"+c,style:{width:s},className:"timeBox"},n.createElement("div",{className:"pubTime"},o.pub),n.createElement("div",{className:"subTimeBox"},o.sub.map(function(u,f){var h=void 0;if(a==="day"){var g=p()().format("YYYY.MMD");h=g===""+o.pub+u}return a==="month"&&(i=r*p()(""+o.pub+u,"YYYYMM\u6708").daysInMonth()),n.createElement("div",{key:"sub-"+f,style:{width:i},className:w()({isToday:h},"subTime")},u)})))}))}}]),d}(n.Component),tr=fe.TYPE_TO_WIDTH,ar=function(v){(0,W.default)(d,v);function d(){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).apply(this,arguments))}return(0,R.default)(d,[{key:"shouldComponentUpdate",value:function(e){return!y().isEqual(e.time,this.props.time)}},{key:"render",value:function(){var e=this.props,t=e.time,a=e.type,r=e.durFromBeginToToday,s=tr[a],i=s;return a==="week"&&(i=s*7),n.createElement("div",{className:"graphBg flex flexRow"},t.map(function(o,c){return n.createElement("div",{key:"graphFiled-"+c,className:"fields flexRow"},o.sub.map(function(u,f){if(a==="month"){var h=p()(""+o.pub+u,"YYYYM\u6708").daysInMonth();i=s*h}return n.createElement("div",{key:"graphSub-"+f,style:{width:i-1,background:a==="day"&&(p()(o.pub+"."+u).days()===6||p()(o.pub+"."+u).days()===0)&&p()(o.pub+"."+u).format("YYYY-MM-DD")!==p()().format("YYYY-MM-DD")?"#F8F8F8":"#fff"},className:"subBg"})}))}),n.createElement("div",{className:"isToday",style:{width:s,left:r*s}}))}}]),d}(n.Component);const yt=function(v){var d=v.width,l=v.left,e=v.state,t=v.className,a=v.status;return n.createElement("div",{style:{marginLeft:l},className:w()("processBar flexRow",t,e)},e==="noStart"&&n.createElement("div",{className:w()("before",a,e)}),n.createElement("div",{className:w()("day",a,e,{tooShort:d<24}),style:{width:d}}),e==="noEnd"&&n.createElement("div",{className:w()("after",a,e)}))};var St=function(d,l,e){return l.isValid()&&e.isValid()?{leftDays:De(d,l),widthDays:De(l,e)+1}:l.isValid()&&!e.isValid()?{leftDays:De(d,l),widthDays:1}:!l.isValid()&&e.isValid()?{leftDays:De(d,e),widthDays:1}:{leftDays:0,widthDays:0}},rr=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"renderProcess",value:function(e){var t=this,a=this.props,r=a.width,s=a.handleTaskItemHover,i=a.beginTime;return e.map(function(o,c){var u=void 0,f=void 0,h=void 0,g=o.actualStartTime,T=o.completeTime,E=o.deadline,C=o.startTime;!C&&E&&(u="noStart"),C&&!E&&(u="noEnd"),!g&&T&&(f="noStart"),g&&!T&&(f="noEnd"),T&&p()(T).isBefore(p()())&&(h="inAdvance"),(g&&!T||T&&p()(T)>p()())&&(h="normal"),g=p()(Be(g)),T=p()(Be(T)),E=p()(Be(E)),C=p()(Be(C));var N=St(i,C,E),F=St(i,g,T),x=N.leftDays*r,A=N.widthDays*r,H=F.leftDays*r,K=F.widthDays*r;return n.createElement("div",{key:c,className:"processWrap"},n.createElement("div",{className:w()("processBox flexRow"),onClick:function(){return t.props.showDetail(o.taskID)},onMouseOver:function(X){return s(!0,X)},onMouseOut:function(X){return s(!1)}},n.createElement("div",null,!!A&&n.createElement("div",{className:"expectProcess"},n.createElement(yt,{width:A,left:x,className:"expectBar",state:u})),!!K&&n.createElement("div",{className:"actualProcess"},n.createElement(yt,{width:K,left:H,className:"actualBar",state:f,status:h}))),n.createElement("div",{className:"taskName ellipsis"},o.taskName)),o.child&&o.childrenVisible&&n.createElement("div",{className:"childrenProcess"},t.renderProcess(o.child)))})}},{key:"render",value:function(){var e=this.props.data;return n.createElement("div",{className:"graphContent"},this.renderProcess(e))}}]),d}(n.Component),cn=function(d){return _Array$from({length:d},function(l,e){return++e})},sr=fe.TYPE_TO_WIDTH,nr=function(v){(0,W.default)(d,v);function d(){var l,e,t,a;(0,j.default)(this,d);for(var r=arguments.length,s=Array(r),i=0;i<r;i++)s[i]=arguments[i];return a=(e=(t=(0,Y.default)(this,(l=d.__proto__||G()(d)).call.apply(l,[this].concat(s))),t),t.getPosList=function(o){t.posList=[],t.timeBox=o,t.getIndex=function(c){if(t.posList.length<=1)return 0;for(var u=0;u<t.posList.length;u++)if(t.posList[u]<=c&&c<=t.posList[u+1])return u;return t.posList.length-1},Va()(o).forEach(function(c){t.posList.push(c.offsetLeft)})},t.handleScroll=function(o){var c=o.scrollLeft,u=t.getIndex(c);t.timeBox[u].style.paddingLeft=c-t.posList[u]+15+"px"},e),(0,Y.default)(t,a)}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=document.querySelector(".taskListWrap");this.graphWrap.addEventListener("scroll",function(t){t.currentTarget.className==fe.scrollingEle&&(e.scrollTop=t.target.scrollTop)}),this.graphWrap.addEventListener("mouseover",function(t){fe.scrollingEle=t.currentTarget.className}),this.computeBgHeight()}},{key:"computeBgHeight",value:function(){var e=document.querySelector(".graphContent").getBoundingClientRect().height,t=document.querySelector(".graphWrap").getBoundingClientRect().height,a=document.querySelector(".graphBg"),r=document.querySelector(".taskListWrap");a.style.height=r.style.height=Math.max(e,t)+"px"}},{key:"componentDidUpdate",value:function(){this.computeBgHeight()}},{key:"render",value:function(){var e=this,t=this.props,a=t.type,r=t.beginTime,s=t.endTime,i=(0,Wa.Z)(t,["type","beginTime","endTime"]),o=r.clone(),c=Math.floor(De(p()(o),p()())),u=sr[a],f=void 0;return a==="day"&&(f=Xa(r,s)),a==="week"&&(f=za(r,s)),a==="month"&&(f=Ja(r,s)),n.createElement("div",{className:"ganttContentBox flex flexColumn",onScroll:function(g){return e.handleScroll(g.target)}},n.createElement(er,(0,ue.default)({time:f,type:a},{getPosList:this.getPosList})),n.createElement("div",{className:"graphWrap",ref:function(g){return e.graphWrap=g}},n.createElement(ar,{time:f,type:a,durFromBeginToToday:c}),n.createElement(rr,(0,ue.default)({time:f,width:u,type:a,beginTime:r},i))))}}]),d}(n.Component),be=k(3567),ze=k(44036),ir=k(87753),or=k.n(ir),lr=k(19575),dr=k(51120),Je,It,Et,cr=(It=Je=function(v){(0,W.default)(d,v);function d(){var l,e,t,a;(0,j.default)(this,d);for(var r=arguments.length,s=Array(r),i=0;i<r;i++)s[i]=arguments[i];return a=(e=(t=(0,Y.default)(this,(l=d.__proto__||G()(d)).call.apply(l,[this].concat(s))),t),Et.call(t),e),(0,Y.default)(t,a)}return(0,R.default)(d,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getData",value:function(){var e=this,t=this.props.folderID;L.Z.getTaskStaticGanttChart({folderID:t}).then(function(a){var r=a.status;if(!r){e.setState({loading:!1,refreshLoading:!1,errorMsg:a.error.msg});return}var s=a.data,i=s.taskData,o=s.maxCompleteTime,c=s.minStartTime,u=s.folderName,f=e.dealWithData(i),h=Ct(c),g=Ct(o);fe.beginTime=h,fe.endTime=g;var T=e.handleTime(h.clone(),g.clone()),E=T.beginTime,C=T.endTime;e.setState({loading:!1,refreshLoading:!1,data:f,beginTime:E,endTime:C,name:u})})}},{key:"dealWithData",value:function(e){var t=this;if(Array.isArray(e))return e.forEach(function(a){a.child&&(a.childrenVisible=!0),t.dealWithData(a.child)}),e}},{key:"putb64",value:function(e){var t=this;(0,oe.LP)([{bucket:2,ext:".png"}]).then(function(a){if(a.error)alert(a.error);else{var r=md.global.FileStoreConfig.uploadHost+"/putb64/-1/key/"+lr.Base64.encode(a[0].key);dr.Z.post(r,e.replace("data:image/png;base64,",""),{headers:{"Content-Type":"application/octet-stream",Authorization:"UpToken "+a[0].uptoken}}).then(function(s){var i=s.data,o=i||{},c=o.key,u=c===void 0?"":c;t.setState({buildImgSuccess:!0,url:md.global.FileStoreConfig.pubHost+u+"?attname="+encodeURIComponent(t.state.name+p()().format("YYYY-MM-DD"))+".png"})}).catch(function(s){console.log(s),alert(_l("\u4FDD\u5B58\u5931\u8D25!"),2)})}})}},{key:"getFileKey",value:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],a=[],r=0;r<e;r++)a.push(t[Math.floor(Math.random()*t.length)]);return a.join("")}},{key:"render",value:function(){var e=this,t=this.state,a=t.type,r=t.data,s=t.loading,i=t.refreshLoading,o=t.errorMsg,c=t.taskID,u=t.taskDetailVisible,f=t.name,h=t.showExportDialog,g=t.buildImgSuccess,T=this.switchDisplayType,E=this.refresh,C=this.exportData,N=this.closeLayer,F=this.toggleTask,x=this.handleTaskItemHover,A=this.showDetail,H=this.scrollToToday,K=0;return i&&(K=$(".timeHeader").width()>$(".ganttContentBox").width()?$(".ganttContentBox").width():$(".timeHeader").width()),n.createElement(nt.Z,{dialogClasses:"flatFishGanttDialog",visible:!0,onCancel:this.handleClose},n.createElement("div",{className:"flatFishGanttWrap flexColumn"},n.createElement(Oa,{type:a,name:f,data:r,switchDisplayType:T,refresh:E,exportData:C,closeLayer:N,scrollToToday:H}),s?n.createElement(ve.Z,null):o?n.createElement(ze.Z,{text:o}):n.createElement("div",{className:"ganttContentWrap flex flexRow"},r.length?n.createElement(n.Fragment,null,n.createElement(Ga,(0,ue.default)({},this.state,{handleTaskItemHover:x,toggleTask:F,showDetail:A})),n.createElement(nr,(0,ue.default)({},this.state,{handleTaskItemHover:x,showDetail:A}))):n.createElement("div",{className:"emptyGantt"},n.createElement("img",{src:"/staticfiles/images/empty_gantt.png",alt:"empty"}),n.createElement("div",{className:"explain"},_l("\u8BE5\u7518\u7279\u56FE\u4E0B\u6682\u65E0\u4EFB\u52A1"))),n.createElement("div",{className:"activeLayer"}),i&&n.createElement("div",{className:"refreshLoading",style:{width:K}},n.createElement(ve.Z,null))),u&&n.createElement(be.Z,{visible:u,taskId:c,openType:3,closeCallback:function(){return e.setState({taskDetailVisible:!1})}}),h&&n.createElement(ie.Z,{visible:!0,title:_l("\u5BFC\u51FA\u56FE\u7247"),okText:_l("\u4E0B\u8F7D"),className:g?"":"saveImgBtnDisabled",onCancel:function(){return e.setState({showExportDialog:!1})},onOk:this.onOk},n.createElement("span",{className:"Gray_9e"},g?_l("\u5DF2\u751F\u6210\u56FE\u7247"):_l("\u6B63\u5728\u6574\u7406\u8981\u5BFC\u51FA\u7684\u6570\u636E\uFF0C\u8BF7\u7A0D\u5019...")))))}}]),d}(n.Component),Je.propTypes={folderID:gt().string.isRequired,closeLayer:gt().func},Je.defaultProps={closeLayer:function(){}},Et=function(){var d=this;this.state={taskID:"",name:"",beginTime:"",endTime:"",data:[],type:"day",taskDetailVisible:!1,loading:!0,refreshLoading:!1,showExportDialog:!1,buildImgSuccess:!1,errorMsg:""},this.handleTime=function(l,e){var t=d.state.type;return t==="day"&&(l.subtract(7,"day"),e.add(8,"day")),t==="week"&&(l.subtract(1,"week").startOf("week"),e.add(1,"week").endOf("week")),t==="month"&&(l.subtract(1,"month").startOf("month"),e.add(1,"month").endOf("month")),{beginTime:l,endTime:e}},this.switchDisplayType=function(l){d.setState({type:l},function(){var e=d.handleTime(fe.beginTime.clone(),fe.endTime.clone()),t=e.beginTime,a=e.endTime;d.setState({beginTime:t,endTime:a})})},this.refresh=function(){d.setState({refreshLoading:!0},function(){d.getData()})},this.exportData=function(){var l=d.state.name,e=$(".ganttContentBox"),t=e.find(".graphWrap").width(),a=e.find(".graphContent").height()+70,r=e.clone(!0);r.css({minWidth:t,maxWidth:t,minHeight:a}),$("body").append(r),or()($("body > .ganttContentBox")[0]).then(function(s){var i=document.getElementById("ganttCanvas");i.width=t,i.height=a+51;var o=i.getContext("2d");o.fillStyle="#fff",o.fillRect(0,0,t,50),o.font="20px Microsoft YaHei",o.fillStyle="#333",o.textAlign="center",o.textBaseline="middle",o.fillText(l,t/2,25),o.moveTo(0,51),o.lineTo(t,51),o.strokeStyle="#e0e0e0",o.stroke(),o.drawImage(s,0,51),i.toDataURL()==="data:,"?alert(_l('\u957F\u5EA6\u8FC7\u957F\uFF0C\u8BF7\u5207\u6362"\u5468"\u6216"\u6708"\u89C6\u56FE\u540E\u91CD\u8BD5'),2):(d.setState({showExportDialog:!0,buildImgSuccess:!1}),d.putb64(i.toDataURL())),$("body > .ganttContentBox").remove()})},this.closeLayer=function(){d.props.closeLayer(!1)},this.toggleTask=function(l){var e=d.state.data,t=y().cloneDeep(e);d.toggleData(t,l),d.setState({data:t})},this.toggleData=function(l,e){e.length===1?l[e[0]].childrenVisible=!l[e[0]].childrenVisible:d.toggleData(l[e[0]].child,e.slice(1))},this.handleTaskItemHover=function(l,e){var t=document.querySelector(".activeLayer");if(l){var a=e.currentTarget,r=a.getBoundingClientRect().top-51;r>=50&&(t.style.display="block",t.style.top=r+"px")}else t.style.display="none"},this.showDetail=function(l){d.setState({taskID:l,taskDetailVisible:!0})},this.scrollToToday=function(){var l=d.state,e=l.type,t=l.beginTime,a=fe.TYPE_TO_WIDTH,r=a[e],s=document.querySelector(".ganttContentBox"),i=Math.round(s.getBoundingClientRect().width/2),o=Math.round(De(t,p()())*r+r/2-i);s.scrollLeft=o},this.onOk=function(){var l=d.state,e=l.buildImgSuccess,t=l.url;e&&(window.open((0,oe.Sv)(t)),d.setState({showExportDialog:!1}))}},It),P=m.workingTimes,Te=m.workingSumHours,ne=m.filterWeekendDay,V=m.VIEWTYPE,me=m.GRANULARITY,Nt=m.TASKSTATUS,Dt=m.SUBTASKLEVEL,Qe=m.TASK_NAME_SIZE,qe=m.SINGLE_TIME,we=m.ARROW_STATUS,bt=function(d,l,e){if(!d&&!l)return 0;var t=Math.floor((p()(l)-p()(d))/24/60/60/1e3)*Te,a=parseInt(p()(d).format("HH:00")),r=parseInt(p()(l).format("HH:00")),s=0,i=!1;if(a>r){var o=a;i=!0,a=r,r=o}for(var c=0;c<P.length;c++){var u=parseInt(P[c][0]),f=parseInt(P[c][1]);a>=u&&a<f&&(r<=f?s+=r-a:s+=f-a),a<u&&r>f&&(s+=f-u),a<u&&r>u&&r<=f&&(s+=r-u)}if(i&&(s=Te-s),t+=s,e){var h=(p()(l.split(" ")[0])-p()(d.split(" ")[0]))/24/60/60/1e3,g=Math.floor(h/7)*ne.length;h=h%7;for(var T=0;T<h;T++){var E=p()(d.split(" ")[0]).add(T,"d").day();y().includes(ne,E)&&g++}t-=g*Te}return t},_e=function(d,l,e){var t=P[P.length-1][1];if(d){var a=p()(d).format("HH:00"),r=p()(d).day(),s=function(){for(var C=0;C<P.length;C++){var N=P[C][0],F=P[C][1];if(parseInt(a)<parseInt(N)){a=N;break}if(parseInt(a)>=parseInt(F)&&parseInt(a)>=parseInt(t)){var x=parseInt(t)-1;a=x>=10?x+":00":"0"+x+":00";break}if(parseInt(a)===parseInt(F)){var A=parseInt(F)-1;a=A>=10?A+":00":"0"+A+":00";break}if(parseInt(a)>=parseInt(N)&&parseInt(a)<parseInt(F))break}d=d.split(" ")[0]+" "+a};if(e&&y().includes(ne,r)){var i=parseInt(t)-1,o=0;for(a=i>=10?i+":00":"0"+i+":00";y().includes(ne,r);)r===0&&(r=7),r--,o--;d=p()(d.split(" ")[0]).add(o,"d").format("YYYY-MM-DD")+" "+a}else s()}if(l){var c=p()(l).format("HH:00"),u=p()(l).day(),f=function(){for(var C=0;C<P.length;C++){var N=P[C][0],F=P[C][1];if(parseInt(c)>parseInt(t)){c=t;break}if(parseInt(c)<=parseInt(N)){var x=parseInt(N)+1;c=x>=10?x+":00":"0"+x+":00";break}if(parseInt(c)>parseInt(N)&&parseInt(c)<=parseInt(F))break}l=l.split(" ")[0]+" "+c};if(e&&y().includes(ne,u)){var h=parseInt(P[0][0])+1,g=0;for(c=h>=10?h+":00":"0"+h+":00";y().includes(ne,u);)u++,g++,u===7&&(u=0);l=p()(l.split(" ")[0]).add(g,"d").format("YYYY-MM-DD")+" "+c}else f()}var T=bt(d,l,e);return{showStartTime:d,showEndTime:l,showHourLong:T}},wt=function(d,l,e){var t=void 0;return l===V.DAY&&(t=Qe/me.DAY),l===V.WEEK&&(t=Qe/me.WEEK),l===V.MONTH&&(t=Qe/me.MONTH),d.forEach(function(a){var r=y().cloneDeep(a.tasks),s=[],i=[];r.forEach(function(g){g.showStartTime===""&&g.showEndTime===""&&g.isShow&&i.push([g])}),y().remove(r,function(g){return g.showStartTime===""&&g.showEndTime===""||!g.isShow}),r=r.sort(function(g,T){return p()(g.showStartTime)>p()(T.showStartTime)?1:-1});var o=function(T){var E=!1;return s.forEach(function(C){return C.forEach(function(N){N.taskId===T&&(E=!0)})}),E},c=function(T){var E=T.showEndTime;return T.status&&p()(E)<p()(T.completeTime)?E=_e(T.showStartTime,T.completeTime,e).showEndTime:p()(E)<p()(m.timeStamp)&&(E=_e(T.showStartTime,m.timeStamp,e).showEndTime),E},u=function(T){var E=p()(c(T)),C=je(t),N=Mt(p()(E),C.hour),F=N.day,x=N.time;return Re(p()(x),C.day+F,e)},f=function(T){var E=T.showStartTime;if(T.arrowStatus!==we.NULL){var C=20,N=void 0;l===V.DAY&&(N=Math.ceil(C/me.DAY)),l===V.WEEK&&(N=Math.ceil(C/me.WEEK)),l===V.MONTH&&(N=Math.ceil(C/me.MONTH));var F=je(-N),x=Lt(p()(T.showStartTime),Math.abs(F.hour)),A=x.day,H=x.time;E=Re(p()(H),F.day+A,e)}return E},h=!1;r.forEach(function(g,T){if(o(g.taskId)||(m.dragItem&&s.length===m.DARG_INDEX&&(h=!0,s.push([m.dragItem])),g.taskId!==m.singleDragTaskId&&s.push([g])),g.deadline){var E=p()(u(g));r.forEach(function(C){C.startTime&&p()(f(C))>=E&&!o(C.taskId)&&C.taskId!==m.singleDragTaskId&&(E=p()(u(C)),s[s.length-1].push(C))})}}),m.dragItem&&!h&&s.push([m.dragItem]),a.taskTimeBars=s.concat(i)}),d},Ft=function(d,l,e,t,a){var r=l.startTime,s=l.deadline;l.isShow=!0,l.singleTime="",e!==l.status&&e!==Nt.ALL&&(l.isShow=!1);var i=!1;d.forEach(function(c){c.taskId===l.parentId&&c.arrowStatus===we.OPEN&&(i=!0)}),a<=l.ancestorIds.length&&a!==Dt.ALL&&!i&&(l.isShow=!1),l.startTime&&!l.deadline&&(s=p()(l.startTime).add(1,"d").format("YYYY-MM-DD HH:mm:ss"),l.singleTime=qe.START),!l.startTime&&l.deadline&&(r=p()(l.deadline).add(-1,"d").format("YYYY-MM-DD HH:mm:ss"),l.singleTime=qe.END),l.status===Nt.COMPLETED&&(l.startTime||l.deadline?(l.deadline&&p()(l.completeTime)<p()(l.deadline)&&(s=p()(l.completeTime).add(1,"h").format("YYYY-MM-DD HH:00:00")),l.deadline||(s=p()(l.completeTime).add(1,"h").format("YYYY-MM-DD HH:00:00"),l.singleTime=""),(!l.startTime||p()(l.startTime)>=p()(s))&&(r=p()(s).add(-1,"d").format("YYYY-MM-DD HH:00:00"))):(s=p()(l.completeTime).add(1,"h").format("YYYY-MM-DD HH:00:00"),r=p()(s).add(-1,"d").format("YYYY-MM-DD HH:00:00"),l.singleTime=qe.END));var o=_e(r,s,t);ee()(l,o)},ur=function(d,l,e){if(l.subTaskIds.length===0)l.arrowStatus=we.NULL;else{var t=!1;d.forEach(function(a){y().includes(l.subTaskIds,a.taskId)&&(t=!0)}),t?e===Dt.ALL||e>l.ancestorIds.length+1?l.arrowStatus=we.OPEN:l.arrowStatus=we.CLOSED:l.arrowStatus=we.NULL}},fr=function(d,l,e,t,a){return d.forEach(function(r){r.tasks.forEach(function(s){ur(r.tasks,s,a)}),r.tasks.forEach(function(s){Ft(r.tasks,s,l,t,a)})}),wt(d,e,t)},mr=function(d){for(var l=m.folderId?p()(m.minStartTime).subtract(7,"d").format("YYYY-MM-DD"):p()(m.minStartTime).format("YYYY-MM-DD"),e=p()(m.maxEndTime).add(28,"d").format("YYYY-MM-DD"),t=(p()(e)-p()(l))/24/60/60/1e3,a={},r=0;r<=t;r++){var s=p()(l).add(r,"d"),i=s.day(),o=s.month()+1,c=s.year(),u=c+"-"+o;d&&y().includes(ne,i)||(a[u]?a[u].push(s.format("YYYY-MM-DD")):a[u]=[s.format("YYYY-MM-DD")])}return Ce()(a).map(function(f){return{month:f,dateList:a[f]}})},pr=function(d){for(var l=p()(m.minStartTime).day(),e=p()(m.maxEndTime).day(),t=p()(m.minStartTime).subtract((l===0?7:l)-1,"d"),a=p()(m.maxEndTime).add(e===0?0:7-e,"d"),r=m.folderId?t.subtract(1,"w").format("YYYY-MM-DD"):t.format("YYYY-MM-DD"),s=a.add(8,"w").format("YYYY-MM-DD"),i=(p()(s)-p()(r))/24/60/60/1e3,o={},c=0;c<=i;c++){var u=p()(r).add(c,"d"),f=u.day(),h=u.isoWeekYear(),g=u.isoWeek(),T=h+"-"+g,E=u.format("YYYY-MM-DD");d&&y().includes(ne,f)||(o[T]?o[T].push(E):o[T]=[E])}return o=Ce()(o).reduce(function(C,N){var F=o[N][0],x=p()(F),A=x.isoWeekYear(),H=x.month()+1,K=A+"-"+H;return C[K]?C[K].push(o[N]):C[K]=[o[N]],C},{}),Ce()(o).map(function(C){return{month:C,dateList:o[C]}})},hr=function(){for(var d=m.folderId?p()(m.minStartTime).add(-1,"M"):p()(m.minStartTime),l=p()(m.maxEndTime).add(6,"M"),e=(l.year()-d.year())*12+(l.month()-d.month()),t={},a=0;a<=e;a++){var r=p()(d).add(a,"M"),s=r.month()+1,i=r.year(),o=""+i;t[o]?t[o].push(r.format("YYYY-MM")):t[o]=[r.format("YYYY-MM")]}return Ce()(t).map(function(c){return{year:c,dateList:t[c]}})},vr=function(d,l){if(d===V.DAY)return mr(l);if(d===V.WEEK)return pr(l);if(d===V.MONTH)return hr()},xt=function(d){if(d===V.DAY)return me.DAY;if(d===V.WEEK)return me.WEEK;if(d===V.MONTH)return me.MONTH},He=function(d){if(d===V.DAY)return Te*me.DAY;if(d===V.WEEK)return Te*me.WEEK;if(d===V.MONTH)return Te*me.MONTH},gr=function(d,l,e){if(d===V.DAY)return He(d);if(d===V.WEEK)return l?He(d)*(7-ne.length):He(d)*7;if(d===V.MONTH){for(var t=(p()(e).add(1,"M")-p()(e))/24/60/60/1e3,a=e+"-01",r=0,s=0;s<t;s++){var i=p()(a).add(s,"d");l&&y().includes(ne,i.days())||r++}return r*He(d)}},kr=function(d,l,e){var t=0;return d===V.DAY&&l.forEach(function(a){t+=a.dateList.length}),d===V.WEEK&&l.forEach(function(a){a.dateList.forEach(function(r){t+=r.length})}),d===V.MONTH&&l.forEach(function(a){a.dateList.forEach(function(r){for(var s=(p()(r).add(1,"M")-p()(r))/24/60/60/1e3,i=r+"-01",o=0;o<s;o++){var c=p()(i).add(o,"d");e&&y().includes(ne,c.days())||t++}})}),t*He(d)},Tr=function(d,l){for(var e=0;l[e]<=d;)e++;return e},Cr=function(){var d=$(".timeBarContainer").scrollLeft()*-1,l=Math.abs(d);$(".timeAxisContent .timeAxisContentScroll").css("transform","translateX("+d+"px)");var e=65,t=$(".timeAxisContent .timeAxisMonths"),a=t.map(function(s,i){return i.offsetLeft}),r=Tr(l,a);l>a[r]-e||(t.eq(r+1).css("padding-left",l-a[r+1]),t.eq(r).css("padding-left",0),t.eq(r-1).css("padding-left",l-a[r-1]))},yr=function(d,l,e,t){e===V.WEEK&&(d=d[0]),e===V.MONTH&&(d=d+"-01");var a=p()(l).format("YYYY-MM-DD"),r=(p()(a)-p()(d))/24/60/60/1e3,s=0;if(t)if(r>=0){s=Math.floor(r/7)*(7-ne.length),r=r%7;for(var i=0;i<r;i++){var o=p()(d).add(i,"d");t&&y().includes(ne,o.days())||s++}}else{s=Math.ceil(r/7)*(7-ne.length),r=r%7;for(var c=0;c<Math.abs(r);c++){var u=p()(d).add(-c,"d");t&&y().includes(ne,u.days())||(s+=-1)}}else s=r;var f=0;return p()(l).format("HH:mm")!==P[0][0]&&(f=_e(a+" 00:00",l).showHourLong),(s*Te+f)*xt(e)},je=function(d){return{day:parseInt(d/Te),hour:d%Te}},Re=function(d,l,e){if(!e)d=d.add(l,"d");else{var t=l>0?1:-1;for(l=Math.abs(l);l;)d=d.add(t,"d"),y().includes(ne,d.day())||l--}return d.format("YYYY-MM-DD HH:00")},Sr=function(d,l){for(var e=0,t=0;t<l;t++){d=d.add(1,"h");for(var a=0;a<P.length;a++){var r=P[a][0],s=P[a][1];if(d.hour()>=parseInt(r)&&d.hour()<parseInt(s))break;d.hour()>=parseInt(P[P.length-1][1])?(e++,d=p()(d.format("YYYY-MM-DD "+P[0][0]))):d.hour()===parseInt(s)&&(d=p()(d.format("YYYY-MM-DD "+P[a+1][0])))}}return{day:e,time:d.format("YYYY-MM-DD HH:00")}},Lt=function(d,l){for(var e=0,t=0;t<l;t++){d=d.add(-1,"h");for(var a=0;a<P.length;a++){var r=P[a][0],s=P[a][1];if(d.hour()>=parseInt(r)&&d.hour()<parseInt(s))break;if(d.hour()<=parseInt(P[0][0])){e--;var i=parseInt(P[P.length-1][1])-1;d=p()(d.format("YYYY-MM-DD "+(i<10?"0"+i:i)))}else if(d.hour()===parseInt(r)){var o=parseInt(P[a-1][1])-1;d=p()(d.format("YYYY-MM-DD "+(o<10?"0"+o:o)))}}}return{day:e,time:d.format("YYYY-MM-DD HH:00")}},Mt=function(d,l){for(var e=0,t=0;t<l;t++){d=d.add(1,"h");for(var a=0;a<P.length;a++){var r=P[a][0],s=P[a][1];if(d.hour()>parseInt(r)&&d.hour()<=parseInt(s))break;if(d.hour()>parseInt(P[P.length-1][1])){e++;var i=parseInt(P[0][0])+1;d=p()(d.format("YYYY-MM-DD "+(i<10?"0"+i:i)))}else if(d.hour()===parseInt(r)){var o=parseInt(r)+1;d=p()(d.format("YYYY-MM-DD "+(o<10?"0"+o:o)))}}}return{day:e,time:d.format("YYYY-MM-DD HH:00")}},Ir=function(d,l){for(var e=0,t=0;t<l;t++){d=d.add(-1,"h");for(var a=0;a<P.length;a++){var r=P[a][0],s=P[a][1];if(d.hour()>parseInt(r)&&d.hour()<=parseInt(s))break;if(d.hour()<=parseInt(P[0][0])){e--;var i=parseInt(P[P.length-1][1]);d=p()(d.format("YYYY-MM-DD "+(i<10?"0"+i:i)))}else if(d.hour()===parseInt(s)){var o=parseInt(s);d=p()(d.format("YYYY-MM-DD "+(o<10?"0"+o:o)))}}}return{day:e,time:d.format("YYYY-MM-DD HH:00")}},Er=function(d,l,e,t,a,r,s){var i=je(t),o=je(t),c=i.day,u=o.day,f=P[0][0],h=P[P.length-1][1];if(s===V.DAY&&(a=a+" "+f,r=r+" "+h),s===V.WEEK&&(a=a[0]+" "+f,r=r[r.length-1]+" "+h),s===V.MONTH&&(a=a+"-01 "+f,r=p()(r).add(1,"M").add(-1,"d").format("YYYY-MM-DD ")+h),d){if(i.hour>0){var g=Sr(p()(d),i.hour),T=g.day,E=g.time;d=E,c+=T}else if(i.hour<0){var C=Lt(p()(d),Math.abs(i.hour)),N=C.day,F=C.time;d=F,c+=N}c!==0&&(d=Re(p()(d),c,e),p()(d)<p()(a)&&m.singleDragTaskId&&(d=a))}if(l){if(o.hour>0){var x=Mt(p()(l),o.hour),A=x.day,H=x.time;l=H,u+=A}else if(o.hour<0){var K=Ir(p()(l),Math.abs(o.hour)),Q=K.day,X=K.time;l=X,u+=Q}u!==0&&(l=Re(p()(l),u,e),p()(l)>p()(r)&&m.singleDragTaskId&&(l=r),m.singleDragTaskId&&(m.isHiddenLastTips=!1,s===V.DAY&&p()(l)>p()(r).add(-1,"d")&&(m.isHiddenLastTips=!0),s===V.WEEK&&p()(l)>p()(r).add(-2,"d")&&(m.isHiddenLastTips=!0),s===V.MONTH&&p()(l)>p()(r).add(-10,"d")&&(m.isHiddenLastTips=!0)))}return{start:d,end:l}};const O={getValidHours:bt,checkTime:_e,taskTimeBars:wt,singleTaskSourceUpdate:Ft,updateTasksDataSource:fr,getTimeAxisSource:vr,getViewSumWidth:kr,singleTableWidth:gr,getOneHourWidth:xt,syncUpdateScroll:Cr,getTimePosition:yr,offsetTime:Er};var At=function(d){return{type:"CHANGE_TASK_STATUS",status:d}},Nr=function(d){return{type:"CHANGE_VIEW",viewType:d}},Dr=function(d){return{type:"CHANGE_FILTER_WEEKEND",filter:d}},br=function(d){return{type:"CHANGE_SUB_TASK_LEVEL",level:d}},Fe=function(d){return function(l,e){var t=e().task,a=t.accountTasksKV,r=t.stateConfig;d=y().cloneDeep(d||a);var s=O.updateTasksDataSource(d,r.currentStatus,r.currentView,r.filterWeekend,r.currentLevel);l({type:"UPDATE_DATA_SOURCE",data:s})}},wr=function(d){return function(l,e){var t=e().task.accountTasksKV;t=y().cloneDeep(t),d.reverse().forEach(function(a){t.unshift({account:{accountId:a.accountId,fullname:a.fullname,avatar:a.avatar},taskTimeBars:[],tasks:[]})}),l({type:"ADD_MEMBERS",accountTasksKV:t})}},ye=function(){return function(d,l){var e=l().task.stateConfig,t=O.getTimeAxisSource(e.currentView,e.filterWeekend);d({type:"GET_TIME_AXIS_SOURCE",timeAxis:t})}},Fr=function(d,l,e){return function(t,a){var r=a().task,s=r.accountTasksKV,i=r.stateConfig;s=y().cloneDeep(s),s[d].tasks.forEach(function(o){o.taskId===l&&(o.arrowStatus=e),y().includes(o.ancestorIds,l)&&(o.isShow=m.ARROW_STATUS.OPEN===e,o.arrowStatus!==m.ARROW_STATUS.NULL&&(o.arrowStatus=e))}),s[d]=O.taskTimeBars([s[d]],i.currentView,i.filterWeekend)[0],t({type:"UPDATE_DATA_SOURCE",data:s})}},xr=function(d){return{type:"GANTT_DRAG_RECORD_ID",taskId:d}},Lr=function(d){return{type:"GANTT_DRAG_RECORD_INDEX",index:d}},Mr=function(d,l,e,t,a){return function(r,s){var i=s().task,o=i.accountTasksKV,c=i.stateConfig;o=y().cloneDeep(o),o[l].tasks.forEach(function(u,f){u.taskId===d&&(t===m.DRAG_DIRECTION.LEFT?(u.singleTime===m.SINGLE_TIME.END&&(u.singleTime=""),u.showStartTime=e):(u.singleTime===m.SINGLE_TIME.START&&(u.singleTime=""),u.showEndTime=e),a?(u.singleTime=m.recordSingleTime,m.singleDragTaskId=""):m.dragItem=u,u.showHourLong=O.getValidHours(u.showStartTime,u.showEndTime,c.filterWeekend))}),o[l].taskTimeBars.forEach(function(u,f){return u.forEach(function(h){h.taskId===d&&(m.DARG_INDEX=f)})}),o[l]=O.taskTimeBars([o[l]],c.currentView,c.filterWeekend)[0],m.dragItem="",m.DARG_INDEX=0,r({type:"UPDATE_DATA_SOURCE",data:o})}},Ar=function(d){return function(l,e){var t=e().task,a=t.accountTasksKV,r=t.stateConfig,s=y().cloneDeep(a);if(a=y().cloneDeep(a),d.data.length===1&&d.data[0].eventType==="D_folder")return $(".taskType .myTask").click(),alert("\u9879\u76EE\u5DF2\u5220\u9664",3),!1;d.data.forEach(function(i){if(i.eventType==="D_task")a.forEach(function(c){c.account.accountId===i.charge.accountId&&y().remove(c.tasks,function(u){return u.taskId===i.taskId})});else if(i.eventType==="A_task"){var o=!1;a.forEach(function(c){c.account.accountId===i.charge.accountId&&(c.tasks.push(i),o=!0)}),o||a.unshift({account:{accountId:i.charge.accountId,fullname:i.charge.fullname,avatar:i.charge.avatar},taskTimeBars:[],tasks:[i]})}else a.forEach(function(c){return c.tasks.forEach(function(u){u.taskId===i.taskId&&(i.eventType==="U_name"&&(u.taskName=i.taskName),(i.eventType==="U_time"||i.eventType==="U_parent")&&(u.startTime=i.startTime,u.deadline=i.deadline),i.eventType==="U_status"&&(u.status=i.status,u.completeTime=i.completeTime),i.eventType==="U_parent"&&(u.ancestorIds=i.ancestorIds,u.parentId=i.parentId),i.eventType==="U_subTaskIds"&&(u.subTaskIds=i.subTaskIds),i.eventType==="Pull_subTaskIds"&&i.subTaskIds.forEach(function(f){y().remove(u.subTaskIds,function(h){return h===f})}),i.eventType==="Push_subTaskIds"&&i.subTaskIds.forEach(function(f){y().includes(u.subTaskIds,f)||u.subTaskIds.push(f)}))})})}),a.forEach(function(i,o){y().isEqual(i,s[o])||(i=O.updateTasksDataSource([i],r.currentStatus,r.currentView,r.filterWeekend,r.currentLevel)[0])}),l({type:"UPDATE_DATA_SOURCE",data:a})}},$r=function(d){return function(l,e){var t=e().task,a=t.accountTasksKV,r=t.stateConfig,s=y().cloneDeep(a),i=d.id.split("|")[2];a=y().cloneDeep(a),d.data.forEach(function(o){o.eventType==="D_task"?a.forEach(function(c){c.account.accountId===i&&y().remove(c.tasks,function(u){return u.taskId===o.taskId})}):o.eventType==="A_task"?a.forEach(function(c){c.account.accountId===i&&!c.account.hidden&&c.tasks.push(o)}):a.forEach(function(c){c.account.accountId===i&&c.tasks.forEach(function(u){u.taskId===o.taskId&&(o.eventType==="U_name"&&(u.taskName=o.taskName),(o.eventType==="U_time"||o.eventType==="U_parent")&&(u.startTime=o.startTime,u.deadline=o.deadline),o.eventType==="U_status"&&(u.status=o.status,u.completeTime=o.completeTime),o.eventType==="U_parent"&&(u.ancestorIds=o.ancestorIds,u.parentId=o.parentId),o.eventType==="U_subTaskIds"&&(u.subTaskIds=o.subTaskIds),o.eventType==="Pull_subTaskIds"&&o.subTaskIds.forEach(function(f){y().remove(u.subTaskIds,function(h){return h===f})}),o.eventType==="Push_subTaskIds"&&o.subTaskIds.forEach(function(f){y().includes(u.subTaskIds,f)||u.subTaskIds.push(f)}))})})}),a.forEach(function(o,c){y().isEqual(o,s[c])||(o=O.updateTasksDataSource([o],r.currentStatus,r.currentView,r.filterWeekend,r.currentLevel)[0])}),l({type:"UPDATE_DATA_SOURCE",data:a})}},Br=function(d){return function(l,e){var t=e().task.accountTasksKV;t=y().cloneDeep(t),d.forEach(function(a){t.push({account:{accountId:a.accountId,fullname:a.fullname,avatar:a.avatar,hidden:!1,type:4},taskTimeBars:[],tasks:[]})}),l({type:"UPDATE_DATA_SOURCE",data:t})}},_r=function(d){return function(l,e){var t=e().task.accountTasksKV;t=y().cloneDeep(t),y().remove(t,function(a){return a.account.accountId===d}),l({type:"UPDATE_DATA_SOURCE",data:t})}},$t=function(d,l){return function(e,t){var a=t().task.accountTasksKV;a=y().cloneDeep(a),a.forEach(function(r){r.account.accountId===d&&(r.account.hidden=l,r.taskTimeBars=[],r.tasks=[])}),e({type:"UPDATE_DATA_SOURCE",data:a})}},Hr=function(d){return function(l,e){var t=e().task,a=t.accountTasksKV,r=t.stateConfig,s=y().cloneDeep(a);a=y().cloneDeep(a),a.forEach(function(i){d.forEach(function(o){i.account.accountId===o.account.accountId&&o.tasks.forEach(function(c){y().find(i.tasks,{taskId:c.taskId})||i.tasks.push(c)})})}),a.forEach(function(i,o){y().isEqual(i,s[o])||(i=O.updateTasksDataSource([i],r.currentStatus,r.currentView,r.filterWeekend,r.currentLevel)[0])}),l({type:"UPDATE_DATA_SOURCE",data:a})}},Bt=(0,$e.Z)(Ae.Z),Pr=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.switchGanttDialogVisible=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;e.setState({ganttDialogVisible:t})},e.state={ganttDialogVisible:!1,showOperator:!1,showLevel:!1},e}return(0,R.default)(d,[{key:"componentWillReceiveProps",value:function(e){y().isEqual(e.taskConfig,this.props.taskConfig)||this.setState({ganttDialogVisible:!1})}},{key:"getTaskStatusName",value:function(){switch(this.props.stateConfig.currentStatus){case 0:return _l("\u8FDB\u884C\u4E2D");case 1:return _l("\u5DF2\u5B8C\u6210");case-1:return _l("\u5168\u90E8")}}},{key:"switchStatus",value:function(e){this.setState({showOperator:!1}),this.props.dispatch(At(e)),this.props.dispatch(Fe())}},{key:"checkMouseDownIsLeft",value:function(e){return e.button===0}},{key:"switchView",value:function(e){this.props.dispatch(Nr(e)),this.props.dispatch(ye()),this.props.dispatch(Fe())}},{key:"filterWeekend",value:function(e){this.props.dispatch(Dr(e)),this.props.dispatch(ye()),this.props.dispatch(Fe())}},{key:"showTaskLevel",value:function(e){this.checkMouseDownIsLeft(e),this.setState({showLevel:!this.state.showLevel,taskLevelOffsetLeft:e.currentTarget.offsetLeft})}},{key:"switchLevel",value:function(e){this.setState({showLevel:!1}),this.props.dispatch(br(e)),this.props.dispatch(Fe())}},{key:"createTask",value:function(){$.CreateTask()}},{key:"render",value:function(){var e=this,t=this.props.stateConfig,a=this.state.ganttDialogVisible,r=[{text:_l("\u8FDB\u884C\u4E2D"),icon:"icon-task-have-in",value:m.TASKSTATUS.NO_COMPLETED},{text:_l("\u5DF2\u5B8C\u6210"),icon:"icon-task-complete",value:m.TASKSTATUS.COMPLETED},{text:_l("\u5168\u90E8"),icon:"icon-task-all",value:m.TASKSTATUS.ALL}],s=[{text:_l("\u5929"),value:m.VIEWTYPE.DAY},{text:_l("\u5468"),value:m.VIEWTYPE.WEEK},{text:_l("\u6708"),value:m.VIEWTYPE.MONTH}],i=[{text:_l("\u4EC5\u5DE5\u4F5C\u65E5"),value:!0},{text:_l("\u663E\u793A\u5468\u672B"),value:!1}],o=[{text:_l("\u5C55\u5F00\u5168\u90E8\u5C42\u7EA7"),value:m.SUBTASKLEVEL.ALL},{text:_l("\u5C55\u5F00\u5230%0\u7EA7\u4EFB\u52A1",1),value:m.SUBTASKLEVEL.ONE},{text:_l("\u5C55\u5F00\u5230%0\u7EA7\u4EFB\u52A1",2),value:m.SUBTASKLEVEL.TWO},{text:_l("\u5C55\u5F00\u5230%0\u7EA7\u4EFB\u52A1",3),value:m.SUBTASKLEVEL.THREE},{text:_l("\u5C55\u5F00\u5230%0\u7EA7\u4EFB\u52A1",4),value:m.SUBTASKLEVEL.FOUR},{text:_l("\u5C55\u5F00\u5230%0\u7EA7\u4EFB\u52A1",5),value:m.SUBTASKLEVEL.FIVE}];return n.createElement("div",{className:"folderToolbar"},n.createElement("span",{className:"taskStatusBox"},n.createElement("span",{className:"taskStatus pointer",onMouseDown:function(u){return e.checkMouseDownIsLeft(u)&&e.setState({showOperator:!e.state.showOperator})}},n.createElement("span",null,this.getTaskStatusName()),n.createElement("i",{className:"Font12 icon-arrow-down-border"}))),this.state.showOperator?n.createElement(Bt,{component:"ul",className:w()("taskStatusList boxShadow5 boderRadAll_3",{Hidden:!this.state.showOperator}),onClickAway:function(){return e.setState({showOperator:!1})}},r.map(function(c,u){return n.createElement("li",{key:u,className:w()("ThemeBGColor3",{ThemeColor3:t.currentStatus===c.value}),onClick:function(){return e.switchStatus(c.value)}},n.createElement("i",{className:c.icon}),c.text)})):void 0,n.createElement("ul",{className:"folderGanttBtn"},s.map(function(c,u){return n.createElement("li",{key:u,className:w()({active:t.currentView===c.value}),onClick:function(){return e.switchView(c.value)}},c.text)})),n.createElement("ul",{className:"folderGanttBtn folderGanttWeekBtn"},i.map(function(c,u){return n.createElement("li",{key:u,className:w()({active:t.filterWeekend===c.value}),onClick:function(){return e.filterWeekend(c.value)}},c.text)})),n.createElement("span",{className:"folderGanttLevelBtn pointer","data-tip":_l("\u5C55\u5F00\u5C42\u7EA7"),onMouseDown:function(u){return e.showTaskLevel(u)}},n.createElement("i",{className:"icon-task-show-tree Font15"})),this.state.showLevel?n.createElement(Bt,{component:"ul",className:w()("taskLevel boxShadow5 boderRadAll_3",{Hidden:!this.state.showLevel}),style:{left:this.state.taskLevelOffsetLeft},onClickAway:function(){return e.setState({showLevel:!1})}},o.map(function(c,u){return n.createElement("li",{key:u,className:"ThemeBGColor3",onClick:function(){return e.switchLevel(c.value)}},c.text)})):void 0,this.props.showStaticGantt&&n.createElement("span",{className:"Right pointer mRight20 folderStaticGantt ThemeColor3",onClick:function(){return e.switchGanttDialogVisible()}},n.createElement("i",{className:"Font16 icon-gantt_chart mRight5"}),_l("\u7518\u7279\u56FE")),a&&n.createElement(cr,{folderID:m.folderId,closeLayer:this.switchGanttDialogVisible}))}}]),d}(n.Component);const Ur=(0,re.$j)(function(v){var d=v.task,l=d.stateConfig,e=d.taskConfig;return{stateConfig:l,taskConfig:e}})(Pr);var Yr=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"componentDidMount",value:function(){$(this.ganttMembersList).on({mouseover:function(){m.scrollSelector=$(this)},scroll:function(){m.scrollSelector&&!m.scrollSelector.is($(".ganttMain .timeBarContainer"))&&$(".ganttMain .timeBarContainer").scrollTop(this.scrollTop)}})}},{key:"addMembers",value:function(e){var t=this,a=this.props.accountTasksKV.map(function(r){return r.account.accountId});(0,ke.Z)({sourceId:m.folderId,title:_l("\u6DFB\u52A0\u8D1F\u8D23\u4EBA"),showMoreInvite:!1,fromType:6,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:a,projectId:m.projectId,callback:function(s){t.props.dispatch(wr(s)),t.addMembersJoinFolder(s),$(t.ganttMembersList).scrollTop(0)}}})}},{key:"addMembersJoinFolder",value:function(e){var t=this;L.Z.checkAccountNeedAddIntoFolder({folderId:m.folderId,accountIds:y().map(e,function(a){return a.accountId})}).then(function(a){a.status&&a.data.length>0&&t.addFolderMembers(a.data)})}},{key:"addFolderMembers",value:function(e){for(var t=[],a=0;a<e.length&&a<3;a++)t.push('<span class="ThemeColor3">'+e[a].fullname+"</span>");ie.Z.confirm({title:_l("\u52A0\u4E3A\u9879\u76EE\u6210\u5458"),cancelText:_l("\u6682\u4E0D\u9700\u8981"),okText:_l("\u52A0\u5165\u9879\u76EE"),closable:!1,children:n.createElement("div",{style:"color: #999;"},_l("\u60A8\u6DFB\u52A0\u7684%0\u4E0D\u662F\u9879\u76EE\u6210\u5458\u4E5F\u4E0D\u5728\u9879\u76EE\u5F53\u524D\u516C\u5F00\u8303\u56F4\u5185\uFF0C\u662F\u5426\u8981\u5C06\u4ED6\u4EEC\u52A0\u5165\u9879\u76EE\uFF1F",t.join("\u3001")+(e.length>3?_l(" \u7B49%0\u4EBA",e.length):""))),onOk:function(){L.Z.addFolderMembers({folderID:m.folderId,memberIDs:y().map(e,function(s){return s.accountId}).join(",")})}})}},{key:"getTaskCount",value:function(e){var t=0;return e.forEach(function(a){t+=a.length}),t}},{key:"render",value:function(){var e=this,t=this.props.accountTasksKV;return n.createElement("div",{className:"ganttMembers"},n.createElement("div",{className:"flexColumn"},n.createElement("header",null,_l("\u4EBA\u5458\u5217\u8868 (%0)",t.length),n.createElement("i",{className:"icon-invite Font18 ThemeColor3 pointer",onClick:function(r){return e.addMembers(r)}})),n.createElement("ul",{className:"ganttMembersList flex",ref:function(r){e.ganttMembersList=r}},t.map(function(a,r){return n.createElement("li",{key:r,style:{height:a.taskTimeBars.length*26}},n.createElement(ce.Z,{className:"ganttMembersAvatar",user:{userHead:a.account.avatar,accountId:a.account.accountId},size:24}),n.createElement("span",{className:"overflow_ellipsis"},a.account.fullname),"(",e.getTaskCount(a.taskTimeBars),")")}))))}}]),d}(n.Component);const Or=(0,re.$j)(function(v){var d=v.task.accountTasksKV;return{accountTasksKV:d}})(Yr);var _t=k(26581),jr=(0,$e.Z)(Ae.Z),Rr=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={showNetwork:!1},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){$(this.ganttMembersList).on({mouseover:function(){m.scrollSelector=$(this)},scroll:function(){m.scrollSelector&&!m.scrollSelector.is($(".ganttMain .timeBarContainer"))&&$(".ganttMain .timeBarContainer").scrollTop(this.scrollTop)}})}},{key:"switchNetwork",value:function(e){this.setState({showNetwork:!1}),this.props.getSetting(e)}},{key:"checkMouseDownIsLeft",value:function(e){return e.button===0}},{key:"ganttSubordinateNullStyle",value:function(){return{height:$(document).height()-338}}},{key:"getNetWorkName",value:function(){var e="";return md.global.Account.projects.forEach(function(t){t.projectId===m.projectId&&(e=t.companyName)}),e}},{key:"getTaskCount",value:function(e){var t=0;return e.forEach(function(a){t+=a.length}),t>99?"99+":t}},{key:"updateUserStatus",value:function(e,t){L.Z.updateUserStatusOfSetting({projectId:m.projectId,accountId:e,isHidden:t}),this.props.dispatch($t(e,t)),t||this.props.getMoreSubordinateTasks([e],m.minStartTime,"")}},{key:"addSubordinate",value:function(){var e=void 0;md.global.Account.projects.forEach(function(t){t.projectId===m.projectId&&(e=t.licenseType)}),e===0?(0,oe.Yg)({projectId:m.projectId,explainText:_l("\u8BF7\u5347\u7EA7\u81F3\u4ED8\u8D39\u7248\u89E3\u9501\u5F00\u542F"),isFree:!0}):(0,Ye.T8)("/admin/reportRelation/"+m.projectId)}},{key:"addFollowMembers",value:function(e){var t=this,a=this.props.accountTasksKV.map(function(r){return r.account.accountId});(0,ke.Z)({sourceId:m.folderId,title:_l("\u6DFB\u52A0\u5173\u6CE8\u7684\u540C\u4E8B"),showMoreInvite:!1,fromType:6,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:a,projectId:m.projectId,callback:function(s){L.Z.followUserOfSetting({projectId:m.projectId,accountIds:s.map(function(i){return i.accountId})}).then(function(i){i.status&&(t.props.dispatch(Br(s)),t.props.getMoreSubordinateTasks(s.map(function(o){return o.accountId}),m.minStartTime,""),t.props.subordinateSocketSubscribe(s.map(function(o){return o.accountId})))})}}})}},{key:"tooltip",value:function(){return n.createElement("span",null,_l("\u6DFB\u52A0\u7ECF\u5E38\u534F\u4F5C\u7684\u540C\u4E8B\uFF0C\u5C06\u663E\u793A\u4ED6\u8D1F\u8D23\u7684\u4EFB\u52A1\u4E2D\u60A8\u53EF\u89C1\u7684\u90E8\u5206"))}},{key:"createTask",value:function(e,t){t.stopPropagation(),$.CreateTask({ProjectID:m.projectId,ChargeArray:[{accountId:e.accountId,fullname:e.fullname,avatar:e.avatar}]})}},{key:"renderPopup",value:function(e){var t=this;return n.createElement("ul",{className:"ganttSubordinateMembersOp boxShadow5 boderRadAll_3"},n.createElement("li",{className:"ThemeColor3 ThemeBGColor3",onClick:function(){return t.lookOtherTasks(e)}},n.createElement("i",{className:"icon-abstract"}),_l("\u66F4\u591A\u4EFB\u52A1")),e.type===4?n.createElement("li",{className:"ThemeColor3 ThemeBGColor3",onClick:function(){return t.removeMembers(e.accountId)}},n.createElement("i",{className:"icon-task-new-delete"}),_l("\u79FB\u9664")):void 0)}},{key:"lookOtherTasks",value:function(e){this.props.dispatch((0,B.gP)(ee()({},this.props.taskConfig,{listStatus:0,listSort:10,filterUserId:e.accountId,isSubUser:e.type===3,lastMyProjectId:m.projectId,folderId:"",taskFilter:e.type===3?2:7})))}},{key:"removeMembers",value:function(e){var t=this;L.Z.unfollowUserOfSetting({projectId:m.projectId,accountIds:[e]}).then(function(a){a.status&&t.props.dispatch(_r(e))})}},{key:"render",value:function(){var e=this,t=this.props.accountTasksKV,a={bottomLeft:{points:["tl","bl"]}};return n.createElement("div",{className:"ganttMembers subordinateMembers"},n.createElement("div",{className:"flexColumn"},n.createElement("div",{className:"ganttNetwork relative"},n.createElement("div",{className:"ganttNetworkName ThemeColor3 overflow_ellipsis",onMouseDown:function(s){return e.checkMouseDownIsLeft(s)&&e.setState({showNetwork:!e.state.showNetwork})}},this.getNetWorkName()," ",n.createElement("i",{className:"icon-arrow-down-border"})),this.state.showNetwork?n.createElement(jr,{component:"ul",className:w()("boxShadow5 boderRadAll_3",{Hidden:!this.state.showNetwork}),onClickAway:function(){return e.setState({showNetwork:!1})}},md.global.Account.projects.map(function(r,s){return n.createElement("li",{key:s,className:"overflow_ellipsis ThemeColor3 ThemeBGColor3",onClick:function(){return e.switchNetwork(r.projectId)}},n.createElement("i",{className:"icon-company"}),r.companyName)})):void 0),n.createElement("ul",{className:"ganttMembersList flex",ref:function(s){e.ganttMembersList=s}},t.length===2&&t[0].account.hidden&&t[1].account.hidden?n.createElement("div",{className:"ganttSubordinateNull",style:this.ganttSubordinateNullStyle()},n.createElement("i",{className:"Font40 icon-group"}),n.createElement("div",{className:"Font14 mTop15"},_l("\u60A8\u8FD8\u6CA1\u6709\u4E0B\u5C5E")),n.createElement("div",{className:"mTop5 ganttTextAlignLeft"},_l("\u53EF\u524D\u5F80 \u7EC4\u7EC7\u7BA1\u7406-\u5458\u5DE5\u6C47\u62A5\u5173\u7CFB\u4E2D\u8BBE\u7F6E\uFF0C\u6216\u5173\u6CE8\u4E0E\u60A8\u534F\u4F5C\u7684\u540C\u4E8B\uFF0C\u67E5\u770B\u76F8\u5173\u4EFB\u52A1\u8FDB\u5C55\u3002")),n.createElement("div",{className:"ganttSubordinateAddMember ThemeColor3 ThemeBorderColor3 mTop25",onClick:function(){return e.addSubordinate()}},_l("\u6DFB\u52A0\u4E0B\u5C5E"))):void 0,t.map(function(r,s){return n.createElement("li",{key:r.account.accountId,style:{height:r.taskTimeBars.length*26},onClick:function(){return e.updateUserStatus(r.account.accountId,!r.account.hidden)}},r.account.type===3?n.createElement("i",{className:"ganttTriangle"}):void 0,n.createElement(ce.Z,{className:w()("ganttMembersAvatar",{ThemeBorderColor3:r.account.type===4}),user:{userHead:r.account.avatar,accountId:r.account.accountId},size:24}),n.createElement("span",{className:"overflow_ellipsis"},md.global.Account.accountId===r.account.accountId?_l("\u6211"):r.account.fullname),r.account.hidden?void 0:n.createElement("span",null,"(",e.getTaskCount(r.taskTimeBars),")"),n.createElement("span",{className:"ganttMembersAddTask Font16 ThemeColor3 tip-bottom-left","data-tip":_l("\u521B\u5EFA\u65B0\u4EFB\u52A1"),onClick:function(o){return e.createTask(r.account,o)}},n.createElement("i",{className:"icon-plus"})),r.account.type===3||r.account.type===4?n.createElement(dt.Z,{action:["click"],prefixCls:"ganttSubordinateBox",popup:e.renderPopup(r.account),builtinPlacements:a,popupPlacement:"bottomLeft"},n.createElement("span",{className:"ganttMembersOperation",onClick:function(o){return o.stopPropagation()}},n.createElement("i",{className:"icon-moreop ThemeColor3 Font16"}))):void 0)})),n.createElement("div",{className:"ganttSubordinate ThemeColor3",onClick:function(s){return e.addFollowMembers(s)}},n.createElement("i",{className:"icon-hr_person_add Font18 mRight5"}),_l("\u6DFB\u52A0\u540C\u4E8B"),n.createElement(_t.Z,{popupPlacement:"top",text:this.tooltip()},n.createElement("i",{className:"icon-knowledge-message Font14 mLeft5"})))))}}]),d}(n.Component);const Gr=(0,re.$j)(function(v){var d=v.task,l=d.accountTasksKV,e=d.taskConfig;return{accountTasksKV:l,taskConfig:e}})(Rr);var un=m.GRANULARITY,fn=m.workingSumHours,Wr=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.currentYear=p()().isoWeekYear(),e}return(0,R.default)(d,[{key:"componentDidUpdate",value:function(){O.syncUpdateScroll()}},{key:"getYearCount",value:function(e,t,a){return e.reduce(function(r,s){return r+=O.singleTableWidth(t,a,s),r},0)}},{key:"adjustYear",value:function(e){return this.currentYear==e.split("-")[0]?p()(new Date(e.split("-").concat([1]))).format("MMM"):e.replace("-",".")}},{key:"getScrollValue",value:function(){return($(".ganttMain .timeBarContainer").scrollLeft()||0)*-1}},{key:"renderDays",value:function(e,t){var a=this,r=this.props.stateConfig.filterWeekend,s=O.singleTableWidth(e),i={width:s},o="translateX("+this.getScrollValue()+"px)";return n.createElement("div",{className:"timeAxisContent"},n.createElement("div",{className:"timeAxisContentScroll",style:{width:O.getViewSumWidth(e,t,r),transform:o}},n.createElement("div",{className:"timeAxisMonthsWrapper"},t.map(function(c,u){return n.createElement("div",{className:"timeAxisMonths",style:{width:s*c.dateList.length},key:u},a.adjustYear(c.month))})),n.createElement("div",{className:"timeAxisDaysWrapper"},t.map(function(c,u){return n.createElement("div",{className:"timeAxisDays",key:u},c.dateList.map(function(f,h){return n.createElement("div",{className:"timeAxisDay",style:i,key:h},n.createElement("span",null,p()(f).format("DD")),n.createElement("span",null,p()(f).format("dd")))}))}))))}},{key:"renderWeeks",value:function(e,t){var a=this,r=this.props.stateConfig.filterWeekend,s=O.singleTableWidth(e,r),i={width:s},o="translateX("+this.getScrollValue()+"px)";return n.createElement("div",{className:"timeAxisContent"},n.createElement("div",{className:"timeAxisContentScroll",style:{width:O.getViewSumWidth(e,t,r)}},n.createElement("div",{className:"timeAxisMonthsWrapper"},t.map(function(c,u){return n.createElement("div",{className:"timeAxisMonths",style:{width:s*c.dateList.length},key:u},a.adjustYear(c.month))})),n.createElement("div",{className:"timeAxisDaysWrapper"},t.map(function(c,u){return n.createElement("div",{className:"timeAxisDays",key:u},c.dateList.map(function(f,h){return n.createElement("div",{className:"timeAxisDay",style:i,key:h},n.createElement("span",null,p()(f[0]).format("DD")+"~"+p()(f[f.length-1]).format("Do")),n.createElement("span",null,""+p()(f[0]).isoWeek()+_l("\u5468")))}))}))))}},{key:"renderMonths",value:function(e,t){var a=this,r=this.props.stateConfig.filterWeekend,s="translateX("+this.getScrollValue()+"px)";return n.createElement("div",{className:"timeAxisContent"},n.createElement("div",{className:"timeAxisContentScroll",style:{width:O.getViewSumWidth(e,t,r),transform:s}},n.createElement("div",{className:"timeAxisMonthsWrapper"},t.map(function(i,o){return n.createElement("div",{className:"timeAxisMonths",style:{width:a.getYearCount(i.dateList,e,r)},key:o},i.year)})),n.createElement("div",{className:"timeAxisDaysWrapper"},t.map(function(i,o){return n.createElement("div",{className:"timeAxisDays",key:o},i.dateList.map(function(c,u){return n.createElement("div",{className:"timeAxisDay",style:{width:O.singleTableWidth(e,r,c)},key:u},n.createElement("span",null,p()(c).format("MMM")))}))}))))}},{key:"render",value:function(){var e=this.props,t=e.stateConfig,a=e.timeAxisSource,r=t.currentView;return n.createElement("div",{className:"timeAxis"},r===m.VIEWTYPE.DAY?this.renderDays(r,a):void 0,r===m.VIEWTYPE.WEEK?this.renderWeeks(r,a):void 0,r===m.VIEWTYPE.MONTH?this.renderMonths(r,a):void 0)}}]),d}(n.Component);const Zr=(0,re.$j)(function(v){var d=v.task,l=d.stateConfig,e=d.timeAxisSource;return{stateConfig:l,timeAxisSource:e}})(Wr);var Vr=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=this.getTimePosition();e<=$(".timeBarContainer .timeBarBox").width()&&$(".timeBarContainer").scrollLeft(e-200)}},{key:"getTimePosition",value:function(){var e=this.props,t=e.viewType,a=e.filterWeekend,r=e.timeAxisSource;return O.getTimePosition(r[0].dateList[0],p()(m.timeStamp).format("YYYY-MM-DD ")+m.workingTimes[0][0],t,a)}},{key:"timeBarTodayStyle",value:function(){return{left:this.getTimePosition(),width:O.getOneHourWidth(this.props.viewType)*m.workingSumHours-1}}},{key:"fencesBGColor",value:function(e){var t=this.props,a=t.timeAxisSource,r=t.viewType,s=t.filterWeekend,i=p()(m.timeStamp),o=i.days();if(r===m.VIEWTYPE.DAY){var c=i.add(-(o||7),"d");return p()(e)<=c?"rgba(240, 240, 240, .3)":"transparent"}if(r===m.VIEWTYPE.WEEK)return p()(e[e.length-1])<i?"rgba(240, 240, 240, .3)":"transparent";if(r===m.VIEWTYPE.MONTH)return p()(e)<p()(i.format("YYYY-MM"))?"rgba(240, 240, 240, .3)":"transparent"}},{key:"render",value:function(){var e=this,t=this.props,a=t.timeAxisSource,r=t.viewType,s=t.filterWeekend,i=[];return a.forEach(function(o){return o.dateList.forEach(function(c){i.push(c)})}),n.createElement("div",{className:"timeBarFences"},i.map(function(o,c){return n.createElement("div",{key:c,className:"timeBarFencesSingle",style:{width:O.singleTableWidth(r,s,o),background:e.fencesBGColor(o)}})}),!s||!y().includes(m.filterWeekendDay,p()(m.timeStamp).days())?n.createElement("div",{className:"timeBarToday",style:this.timeBarTodayStyle()}):void 0)}}]),d}(n.Component),Kr=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.preview;return n.createElement("div",{id:"ganttDragPreview"},t.startTime?n.createElement("div",{className:"dragPreviewStartTime"},p()(t.startTime).format("Do HH")):void 0,n.createElement("div",{dangerouslySetInnerHTML:{__html:a}}),t.deadline?n.createElement("div",{className:"dragPreviewEndTime"},p()(t.deadline).format("Do HH")):void 0)}}]),d}(n.Component),Ht,Pt,Xr={beginDrag:function(d,l,e){if(m.isSingleDrag)return{};$("body").addClass("ganttDraging");var t=$((0,se.findDOMNode)(e)).find(".timeBar")[0],a=t.outerHTML,r=t.getBoundingClientRect();return m.offset={x:m.mouseOffset.left-r.left,y:m.mouseOffset.top-r.top},m.offsetX=r.left,m.scrollLeft=$(".ganttMain .timeBarContainer").scrollLeft(),m.originalStartTime=d.data.startTime,m.originalEndTime=d.data.deadline,m.oldStartTime=d.data.showStartTime,m.oldEndTime=d.data.showEndTime,m.SINGLE_TIME.START===d.data.singleTime&&(m.oldEndTime=""),m.SINGLE_TIME.END===d.data.singleTime&&(m.oldStartTime=""),(0,se.render)(n.createElement(Kr,{preview:a,data:d.data}),document.getElementById("ganttDragPreviewBox")),d.ganttBeginDrag(d.data.taskId),{index:d.index,taskId:d.data.taskId}},isDragging:function(d,l){if(d.data.taskId!==l.getItem().taskId)return!1;var e=document.getElementById("ganttDragPreview"),t=l.getClientOffset();if(e&&t){e.style.left=t.x-m.offset.x+"px",e.style.top=t.y-m.offset.y+"px";var a=$(".ganttMain .timeBarContainer").scrollLeft(),r=t.x-m.offset.x+a-m.offsetX-m.scrollLeft,s=Math.floor(r/O.getOneHourWidth(d.viewType));if(m.diffHours===s)return!1;if(m.diffHours=s,s===0)m.oldStartTime&&$(e).find(".dragPreviewStartTime").html(p()(m.originalStartTime).format("Do HH")),m.oldEndTime&&$(e).find(".dragPreviewEndTime").html(p()(m.originalEndTime).format("Do HH"));else{var i=O.offsetTime(m.oldStartTime,m.oldEndTime,d.filterWeekend,s,d.minStartTime,d.maxEndTime,d.viewType);m.newStartTime=i.start,m.newEndTime=i.end,m.newStartTime&&$(e).find(".dragPreviewStartTime").html(p()(m.newStartTime).format("Do HH")),m.newEndTime&&$(e).find(".dragPreviewEndTime").html(p()(m.newEndTime).format("Do HH"))}clearInterval(m.setInterval),m.setInterval=setInterval(function(){var o=$(".ganttMain .timeBarContainer"),c=t.y-m.offset.y,u=t.x-m.offset.x;c<=210?o.scrollTop(o.scrollTop()-100):$(window).height()-c<=40&&o.scrollTop(o.scrollTop()+100),u<=300+$(".taskGanttContainer .ganttMembers").width()?(o.scrollLeft(o.scrollLeft()-100),O.syncUpdateScroll()):$(window).width()-u-$(e).width()<=50&&(o.scrollLeft(o.scrollLeft()+100),O.syncUpdateScroll())},200)}},endDrag:function(d,l,e){m.isSingleDrag||(m.isEndDrag=!0,d.ganttEndDrop(),clearInterval(m.setInterval),se.unmountComponentAtNode($("#ganttDragPreviewBox")[0]),$("body").removeClass("ganttDraging"))}},zr=(Ht=(0,Ke.Ej)(m.DRAG_GANTT,Xr,function(v,d){return{connectDragSource:v.dragSource(),isDragging:d.isDragging()}}),Ht(Pt=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.state={offsetX:0},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){this.noDateListAlignLeft()}},{key:"shouldComponentUpdate",value:function(e,t){return!(y().isEqual(e.data,this.props.data)&&this.props.viewType===e.viewType&&this.props.filterWeekend===e.filterWeekend&&e.dragTaskId!==e.data.taskId&&this.props.dragTaskId!==this.props.data.taskId&&t.offsetX===this.state.offsetX&&e.data.taskId!==m.singleDragTaskId&&this.props.data.taskId!==m.singleDragTaskId&&this.getTimeBarStyle().left!==parseInt($(this.timeBars).css("left")))}},{key:"componentDidUpdate",value:function(){this.noDateListAlignLeft()}},{key:"noDateListAlignLeft",value:function(){$(this.timeBars).css("padding-left",this.props.data.showHourLong===0?$(".timeBarContainer").scrollLeft()+20:0)}},{key:"dragMouseMove",value:function(e){var t=this;$(document).on({"mousemove.ganttDragSingle":function(r){r.stopPropagation();var s=$(".ganttMain .timeBarContainer").scrollLeft(),i=r.clientX+s-m.offsetX-m.scrollLeft,o=Math.floor(i/O.getOneHourWidth(t.props.viewType)),c=O.offsetTime(m.oldStartTime,m.oldEndTime,t.props.filterWeekend,o,t.props.minStartTime,t.props.maxEndTime,t.props.viewType),u=c.start,f=c.end;clearInterval(m.setInterval),e===m.DRAG_DIRECTION.LEFT&&(p()(u)>=p()(m.originalEndTime)&&(u=p()(m.originalEndTime).add(-1,"h").format("YYYY-MM-DD HH:mm")),m.newStartTime=u,t.props.updateStartTimeAndEndTime(m.singleDragTaskId,t.props.index,u,e),t.dragTriggerScroll(r)),e===m.DRAG_DIRECTION.RIGHT&&(p()(f)<=p()(m.originalStartTime)&&(f=p()(m.originalStartTime).add(1,"h").format("YYYY-MM-DD HH:mm")),m.newEndTime=f,t.props.updateStartTimeAndEndTime(m.singleDragTaskId,t.props.index,f,e),t.dragTriggerScroll(r))},"mouseup.ganttDragSingle":function(r){r.stopPropagation(),e===m.DRAG_DIRECTION.LEFT&&m.newStartTime&&(t.props.updateTaskStartTimeAndDeadline(m.singleDragTaskId,!0,m.newStartTime,""),t.props.updateStartTimeAndEndTime(m.singleDragTaskId,t.props.index,m.oldStartTime,e,!0)),e===m.DRAG_DIRECTION.RIGHT&&m.newEndTime&&(t.props.updateTaskStartTimeAndDeadline(m.singleDragTaskId,!1,"",m.newEndTime),t.props.updateStartTimeAndEndTime(m.singleDragTaskId,t.props.index,m.oldEndTime,e,!0)),m.isEndDrag=!0,m.isSingleDrag=!1,m.singleDragTaskId="",clearInterval(m.setInterval),$(document).off("mousemove.ganttDragSingle"),$(document).off("mouseup.ganttDragSingle")}})}},{key:"timeBarDragLeft",value:function(e){m.isSingleDrag=!0,m.offsetX=e.clientX,m.scrollLeft=$(".ganttMain .timeBarContainer").scrollLeft(),m.oldStartTime=this.props.data.showStartTime,m.oldEndTime="",m.originalEndTime=this.props.data.showEndTime,m.singleDragTaskId=this.props.data.taskId,m.recordSingleTime=this.props.data.singleTime,e.stopPropagation(),this.dragMouseMove(m.DRAG_DIRECTION.LEFT)}},{key:"timeBarDragRight",value:function(e){m.isSingleDrag=!0,m.offsetX=e.clientX,m.scrollLeft=$(".ganttMain .timeBarContainer").scrollLeft(),m.oldStartTime="",m.oldEndTime=this.props.data.showEndTime,m.originalStartTime=this.props.data.showStartTime,m.singleDragTaskId=this.props.data.taskId,m.recordSingleTime=this.props.data.singleTime,e.stopPropagation(),this.dragMouseMove(m.DRAG_DIRECTION.RIGHT)}},{key:"dragTriggerScroll",value:function(e){m.setInterval=setInterval(function(){var t=$(".ganttMain .timeBarContainer"),a=e.clientX;a<=460?(t.scrollLeft(t.scrollLeft()-100),O.syncUpdateScroll()):$(window).width()-a<=50&&(t.scrollLeft(t.scrollLeft()+100),O.syncUpdateScroll())},200)}},{key:"getTimePosition",value:function(e,t){var a=this.props,r=a.viewType,s=a.filterWeekend,i=a.minStartTime;return O.getTimePosition(t||i,e,r,s)}},{key:"getTimeBarStyle",value:function(){var e=this.props,t=e.data,a=e.row,r=e.col,s=e.filterWeekend,i={top:a*26+10};if(t.showHourLong===0)return i.left=0,i.right=0,i.background="rgba(240, 240, 240, .7)",i;if(t.singleTime===m.SINGLE_TIME.START)return i.left=this.getTimePosition(t.showStartTime),i.right=0,i;if(t.singleTime===m.SINGLE_TIME.END){i.left=0;var o=m.timeStamp;if(t.status===m.TASKSTATUS.COMPLETED&&(o=p()(t.completeTime).add(1,"h").format("YYYY-MM-DD HH:mm")),p()(o)<=p()(t.showEndTime))i.width=this.getTimePosition(t.showEndTime)+(t.taskId!==m.singleDragTaskId?m.TASK_NAME_SIZE:0);else{var c=O.checkTime(t.showStartTime,o,s).showEndTime;i.width=this.getTimePosition(c)+(t.taskId!==m.singleDragTaskId?m.TASK_NAME_SIZE:0)}return i}return i.left=this.getTimePosition(t.showStartTime),i}},{key:"getBGColor",value:function(){var e=this.props.data;return e.showHourLong===0?"transparent":e.status===m.TASKSTATUS.COMPLETED?"#81c784":e.singleTime===m.SINGLE_TIME.START||p()(m.timeStamp)<=p()(e.deadline)?"#64b5f6":"#ff7043"}},{key:"getColorBlockStyle",value:function(){var e=this.props,t=e.data,a=e.viewType,r={width:O.getOneHourWidth(a)*t.showHourLong,background:this.getBGColor()};return r.width>=72&&(r.borderRadius=10),r}},{key:"timeBarArrowBtnStyle",value:function(){var e=this.props.data;return e.showHourLong===0?{marginRight:-8,marginLeft:-12}:e.startTime&&e.deadline||e.singleTime===m.SINGLE_TIME.START||!e.singleTime?{marginLeft:-20}:{marginLeft:this.getTimePosition(e.showStartTime)-28}}},{key:"timeBarArrowStyle",value:function(){var e=this.props.data;if(e.singleTime===m.SINGLE_TIME.START)return{borderLeftColor:this.getBGColor()};if(e.singleTime===m.SINGLE_TIME.END)return{borderRightColor:this.getBGColor(),marginLeft:e.arrowStatus===m.ARROW_STATUS.NULL?this.getTimePosition(e.showStartTime)-16:-8}}},{key:"timeBarDashedStyle",value:function(){var e=this.props.data,t={background:"#fbe9e7"};return e.singleTime===m.SINGLE_TIME.START?(t.right=0,t.borderTopLeftRadius=10,t.borderBottomLeftRadius=10):t.width=this.getTimePosition(e.showStartTime),(e.singleTime===m.SINGLE_TIME.START||p()(m.timeStamp)<=p()(e.deadline))&&(t.background="rgba(240, 240, 240, .7)"),e.status===m.TASKSTATUS.COMPLETED&&(t.background="#e8f5e9"),t}},{key:"getOverdueHour",value:function(){var e=this.props,t=e.data,a=e.filterWeekend,r=m.timeStamp;return t.status===m.TASKSTATUS.COMPLETED&&(r=p()(t.completeTime).add(1,"h").format("YYYY-MM-DD HH:00")),p()(r)<=p()(t.showEndTime)?0:O.checkTime(t.showStartTime,r,a).showHourLong-t.showHourLong}},{key:"getOverdueMessage",value:function(){var e=this.props.data;if(e.taskId===m.singleDragTaskId)return"";var t=Math.ceil((p()(e.completeTime||m.timeStamp)-p()(e.deadline))/60/60/1e3);if(this.getOverdueHour()*O.getOneHourWidth(this.props.viewType)>=m.TASK_MESSAGE_SIZE)return n.createElement("span",{className:"timeBarMessageP"},t<24?_l("\u903E\u671F%0\u5C0F\u65F6",t):_l("\u903E\u671F%0\u5929",Math.floor(t/24)))}},{key:"showOrHideTask",value:function(){var e=this.props,t=e.data,a=e.index;m.isEndDrag=!0,this.props.showOrHideTask(a,t.taskId,t.arrowStatus===m.ARROW_STATUS.OPEN?m.ARROW_STATUS.CLOSED:m.ARROW_STATUS.OPEN)}},{key:"openTaskDetailDialog",value:function(){m.isEndDrag?m.isEndDrag=!1:this.props.openTaskDetail(this.props.data.taskId)}},{key:"tooltipTimeMessage",value:function(){var e=this.props.data,t=0;return!e.startTime&&!e.deadline||e.status===m.TASKSTATUS.NO_COMPLETED&&(!e.deadline||p()(m.timeStamp)<=p()(e.deadline))?"":n.createElement("div",{className:"Font13",dangerouslySetInnerHTML:{__html:(0,I.Mq)(e.status,e.startTime,e.deadline,e.actualStartTime,e.completeTime)}})}},{key:"tooltip",value:function(){var e=this.props.data;return n.createElement("div",null,n.createElement("div",{className:"Font13",style:{lineHeight:"18px",width:200,wordBreak:"break-all"}},e.taskName),n.createElement("div",null,n.createElement("span",{style:{color:"#757575"}},_l("\u5F00\u59CB\uFF1A")),e.startTime?p()(e.startTime).format("YYYY/MM/DD HH:00"):"--"),e.status===m.TASKSTATUS.COMPLETED?n.createElement("div",null,n.createElement("span",{style:{color:"#757575"}},_l("\u5B8C\u6210\uFF1A")),p()(e.completeTime).format("YYYY/MM/DD HH:mm")):n.createElement("div",null,n.createElement("span",{style:{color:"#757575"}},_l("\u622A\u6B62\uFF1A")),e.deadline?p()(e.deadline).format("YYYY/MM/DD HH:00"):"--"),this.tooltipTimeMessage())}},{key:"onMouseOver",value:function(e){var t=e.clientX-$(e.currentTarget).offset().left-$(e.currentTarget).outerWidth()/2;$(window).width()-e.clientX<120&&(t-=120-$(window).width()+e.clientX),this.setState({offsetX:t})}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,r=t.viewType,s=t.connectDragSource,i=t.dragTaskId,o=this.getColorBlockStyle(),c=[this.state.offsetX,1];return n.createElement(_t.Z,{popupPlacement:"top",text:this.tooltip(),themeColor:"white",mouseEnterDelay:.5,offset:c,overflow:[0,0]},n.createElement("div",{className:w()("timeBars pointer",{isDragging:a.taskId===i},{noDateList:a.showHourLong===0}),style:this.getTimeBarStyle(),ref:function(f){e.timeBars=f},onMouseOver:function(f){return e.onMouseOver(f)},onClick:function(){return e.openTaskDetailDialog()}},a.singleTime===m.SINGLE_TIME.START||a.singleTime===m.SINGLE_TIME.END?n.createElement("span",{className:"timeBarDashed",style:this.timeBarDashedStyle()}):void 0,a.arrowStatus!==m.ARROW_STATUS.NULL?n.createElement("span",{className:"timeBarArrowBtn",style:this.timeBarArrowBtnStyle(),onClick:function(){return e.showOrHideTask()}},n.createElement("i",{className:w()(a.arrowStatus===m.ARROW_STATUS.OPEN?"icon-remove_circle_outline":"icon-addapplication")})):void 0,a.singleTime===m.SINGLE_TIME.END?n.createElement("span",{className:"timeBarArrow timeBarArrowLeft",style:this.timeBarArrowStyle()}):void 0,a.showHourLong===0?void 0:a.status===m.TASKSTATUS.COMPLETED?n.createElement("span",{className:w()("timeBar pointer",{clearLeftBorder:a.singleTime===m.SINGLE_TIME.END},{clearRightBorder:a.singleTime===m.SINGLE_TIME.START}),style:o}):s(n.createElement("span",{className:w()("timeBar",{clearLeftBorder:a.singleTime===m.SINGLE_TIME.END},{clearRightBorder:a.singleTime===m.SINGLE_TIME.START}),style:o},n.createElement("div",null,o.width<8?void 0:n.createElement("i",{className:w()("timeBarDragLeft",{dragBigRadius:o.width>=72}),onMouseDown:function(f){return e.timeBarDragLeft(f)}}),n.createElement("i",{className:w()("timeBarDragRight",{dragBigRadius:o.width>=72}),onMouseDown:function(f){return e.timeBarDragRight(f)}}),a.taskId===m.singleDragTaskId&&m.oldStartTime?n.createElement("div",{className:"dragPreviewTipsLeft"},p()(a.showStartTime).format("Do HH")):void 0,a.taskId===m.singleDragTaskId&&m.oldEndTime&&!m.isHiddenLastTips?n.createElement("div",{className:"dragPreviewTipsRight"},p()(a.showEndTime).format("Do HH")):void 0))),a.singleTime===m.SINGLE_TIME.START?n.createElement("span",{className:"timeBarArrow timeBarArrowRight",style:this.timeBarArrowStyle()}):void 0,a.deadline?n.createElement("span",{className:w()("timeBarOverdue",{Hidden:O.getOneHourWidth(r)*this.getOverdueHour()===0},{timeBarOverdueStyle:o.width>=72}),style:{width:O.getOneHourWidth(r)*this.getOverdueHour()}},this.getOverdueMessage()):void 0,a.taskId!==m.singleDragTaskId?n.createElement("span",{className:w()("overflow_ellipsis",{noDateColor:a.showHourLong===0},{timeBarTaskName:a.status===m.TASKSTATUS.COMPLETED})},a.taskName):void 0))}}]),d}(n.Component))||Pt),Ut,Yt,Jr={hover:function(d,l,e){if(!m.isSingleDrag){var t=l.getItem().index;t!==d.index&&d.dragHoverIndex!==d.index?d.ganttDragHover(d.index):t===d.index&&d.dragHoverIndex!==-1&&d.ganttDragHover(-1)}}},Qr=(Ut=(0,Ke.GR)(m.DRAG_GANTT,Jr,function(v,d){return{connectDropTarget:v.dropTarget(),isOver:d.isOver(),canDrop:d.canDrop()}}),Ut(Yt=function(v){(0,W.default)(d,v);function d(){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).apply(this,arguments))}return(0,R.default)(d,[{key:"render",value:function(){var e=this,t=this.props,a=t.item,r=t.connectDropTarget;return r(n.createElement("div",{className:w()("taskTimeBars",{taskTimeBarsHover:this.props.dragHoverIndex===this.props.index}),style:{height:a.taskTimeBars.length*26}},a.taskTimeBars.map(function(s,i){return s.map(function(o,c){return n.createElement(zr,(0,ue.default)({data:o,row:i,col:c,key:o.taskId},e.props))})}),!m.folderId&&a.account.hidden?n.createElement("div",{className:"taskTimeBarsHidden",onClick:function(){return e.props.updateUserStatus(a.account.accountId)}}):void 0))}}]),d}(n.Component))||Yt),Ot=k(20454),qr=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.openTaskDetail=function(t){e.setState({openTaskDetail:!0,taskId:t})},e.state={openTaskDetail:!1,taskId:""},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=this;$(this.timeBarContainer).on({mouseover:function(){m.scrollSelector=$(this)},scroll:function(){if(m.scrollSelector&&!m.scrollSelector.is($(".ganttMembers .ganttMembersList"))&&$(".ganttMembers .ganttMembersList").scrollTop(this.scrollTop),O.syncUpdateScroll(),$(".timeBars.noDateList").css("padding-left",$(".timeBarContainer").scrollLeft()+20),!m.folderId&&$(this).scrollLeft()<50&&m.isReady&&!m.isSingleDrag&&!$("#ganttDragPreview").length){var a=[];e.props.accountTasksKV.forEach(function(i){i.account.hidden||a.push(i.account.accountId)});var r="";e.props.stateConfig.currentView===m.VIEWTYPE.DAY?r=p()(m.minStartTime).add(-6,"w").format("YYYY-MM-DD HH:00"):e.props.stateConfig.currentView===m.VIEWTYPE.WEEK?r=p()(m.minStartTime).add(-12,"w").format("YYYY-MM-DD HH:00"):e.props.stateConfig.currentView===m.VIEWTYPE.MONTH&&(r=p()(m.minStartTime).add(-24,"w").format("YYYY-MM-DD HH:00"));var s=m.minStartTime;m.minStartTime=r,e.props.dispatch(ye()),e.props.getMoreSubordinateTasks(a,r,s)}}}),$(document).on("mousedown.ganttDrag",".timeBars .timeBar",function(t){m.mouseOffset={left:t.clientX,top:t.clientY}})}},{key:"showOrHideTask",value:function(e,t,a){this.props.dispatch(Fr(e,t,a))}},{key:"ganttBeginDrag",value:function(e){this.props.dispatch(xr(e))}},{key:"ganttDragHover",value:function(e){this.props.dispatch(Lr(e))}},{key:"ganttEndDrop",value:function(){var e="",t="";m.newStartTime?m.newEndTime||(e=!0):e=!1,this.props.stateConfig.dragHoverIndex!==-1&&(t=this.props.accountTasksKV[this.props.stateConfig.dragHoverIndex].account.accountId),this.updateTaskStartTimeAndDeadline(this.props.stateConfig.dragTaskId,e,m.newStartTime,m.newEndTime,0,t),this.ganttBeginDrag(""),this.ganttDragHover(-1)}},{key:"updateTaskStartTimeAndDeadline",value:function(e,t,a,r){var s=this,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"";L.Z.updateTaskStartTimeAndDeadline({taskId:e,startTime:a,deadline:r,timeLock:t,chargeAccountId:o,updateType:i}).then(function(c){if(m.isEndDrag=!1,c.status){var u=!1;if(a&&p()(a)<p()(m.minStartTime)&&(m.minStartTime=a,u=!0),r&&p()(r)>p()(m.maxEndTime)&&(m.maxEndTime=r,u=!0),u&&s.props.dispatch(ye()),c.data.updateTypes){var f=function(g){s.updateTaskStartTimeAndDeadline(e,c.data.timeLock,a,r,g)};(0,Ot.zV)(c,a,f)}}else(0,Ot.mP)(c)})}},{key:"updateStartTimeAndEndTime",value:function(e,t,a,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;this.props.dispatch(Mr(e,t,a,r,s))}},{key:"updateUserStatus",value:function(e){L.Z.updateUserStatusOfSetting({projectId:m.projectId,accountId:e,isHidden:!1}),this.props.dispatch($t(e,!1)),this.props.getMoreSubordinateTasks([e],m.minStartTime,"")}},{key:"taskTimeBarBoxStyle",value:function(){return this.props.accountTasksKV.length===2&&this.props.accountTasksKV[0].account.hidden&&this.props.accountTasksKV[1].account.hidden?{paddingTop:$(document).height()-338}:{}}},{key:"render",value:function(){var e=this,t=this.props,a=t.accountTasksKV,r=t.stateConfig,s=t.timeAxisSource,i=r.currentView,o=r.filterWeekend,c=s[0].dateList[0],u=s[s.length-1].dateList,f=u[u.length-1],h=r.dragTaskId,g=r.dragHoverIndex;return n.createElement("div",{className:"flex relative"},n.createElement("div",{className:"timeBarContainer",ref:function(E){e.timeBarContainer=E}},n.createElement("div",{className:"timeBarBox",style:{width:O.getViewSumWidth(i,s,o)}},n.createElement(Vr,{viewType:i,timeAxisSource:s,filterWeekend:o}),n.createElement("div",{className:"taskTimeBarBox",style:this.taskTimeBarBoxStyle()},a.map(function(T,E){return n.createElement(Qr,{key:E,item:T,index:E,dragTaskId:h,dragHoverIndex:g,viewType:i,filterWeekend:o,minStartTime:c,maxEndTime:f,updateUserStatus:e.updateUserStatus.bind(e),updateTaskStartTimeAndDeadline:e.updateTaskStartTimeAndDeadline.bind(e),updateStartTimeAndEndTime:e.updateStartTimeAndEndTime.bind(e),showOrHideTask:e.showOrHideTask.bind(e),ganttBeginDrag:e.ganttBeginDrag.bind(e),ganttDragHover:e.ganttDragHover.bind(e),ganttEndDrop:e.ganttEndDrop.bind(e),openTaskDetail:e.openTaskDetail})})))),n.createElement("div",{id:"ganttDragPreviewBox"}),n.createElement(be.Z,{visible:this.state.openTaskDetail,taskId:this.state.taskId,openType:3,closeCallback:function(){return e.setState({openTaskDetail:!1})}}))}}]),d}(n.Component);const es=(0,re.$j)(function(v){var d=v.task,l=d.accountTasksKV,e=d.stateConfig,t=d.timeAxisSource;return{accountTasksKV:l,stateConfig:e,timeAxisSource:t}})(qr);var ts=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return m.projectId=l.taskConfig.projectId,m.folderId=l.taskConfig.folderId,m.isRequestComplete=!1,e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){this.getSource()}},{key:"componentDidMount",value:function(){var e=this;this.socketMonitor(),m.folderId?(this.socketSubscribe(),setInterval(function(){e.socketSubscribe()},6e5)):setInterval(function(){e.props.accountTasksKV&&e.subordinateSocketSubscribe(e.props.accountTasksKV.map(function(t){return t.account.accountId}))},6e5)}},{key:"componentWillReceiveProps",value:function(e){y().isEqual(e.taskConfig,this.props.taskConfig)||(m.projectId=e.taskConfig.projectId,m.folderId=e.taskConfig.folderId,this.getSource())}},{key:"getSource",value:function(){var e=this;m.folderId?this.getFolderTaskGantt():L.Z.getSettingDefualtProjectId().then(function(t){t.status&&e.getSetting(t.data)})}},{key:"socketSubscribe",value:function(){IM.socket.emit("subscribe",{type:"folder2",sourceId:m.folderId+"|"+md.global.Account.accountId})}},{key:"socketMonitor",value:function(){var e=this;IM.socket.removeAllListeners("subscribe message"),IM.socket.on("subscribe message",function(t){if(m.folderId===t.fid||t.id.indexOf(m.projectId)>=0&&$(".subordinateTabs .active").index()===0){var a=!1;t.data.forEach(function(r){(r.eventType==="U_time"||r.eventType==="U_parent"||r.eventType==="A_task")&&(r.startTime&&p()(r.startTime)<p()(m.minStartTime)&&(a=!0,m.minStartTime=r.startTime),r.deadline&&p()(r.deadline)>p()(m.maxEndTime)&&(a=!0,m.maxEndTime=r.deadline))}),a&&e.props.dispatch(ye()),m.folderId===t.fid?e.props.dispatch(Ar(t)):e.props.dispatch($r(t))}})}},{key:"subordinateSocketSubscribe",value:function(e){e.forEach(function(t){IM.socket.emit("subscribe",{type:"subordinate",sourceId:m.projectId+"|"+md.global.Account.accountId+"|"+t})})}},{key:"getFolderTaskGantt",value:function(){var e=this;L.Z.getFolderTaskGantt({folderId:m.folderId}).then(function(t){t.status?(m.timeStamp=p()(t.data.timeStamp).add(1,"h").format("YYYY-MM-DD HH:00"),m.minStartTime=t.data.minTime,m.maxEndTime=t.data.maxTime,m.isRequestComplete=!0,e.props.dispatch(ye()),e.props.dispatch(Fe(t.data.accountTasksKV))):alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"),2)})}},{key:"getSetting",value:function(e){var t=this;m.projectId=e,L.Z.getSetting({projectId:e}).then(function(a){a.status&&(t.props.stateConfig.currentView===m.VIEWTYPE.DAY?m.minStartTime=p()().add(-6,"w").format("YYYY-MM-DD HH:00"):t.props.stateConfig.currentView===m.VIEWTYPE.WEEK?m.minStartTime=p()().add(-12,"w").format("YYYY-MM-DD HH:00"):t.props.stateConfig.currentView===m.VIEWTYPE.MONTH&&(m.minStartTime=p()().add(-24,"w").format("YYYY-MM-DD HH:00")),m.maxEndTime="",t.getFirstSubordinateTasks(a.data),t.subordinateSocketSubscribe(a.data.map(function(r){return r.accountId})))})}},{key:"getFirstSubordinateTasks",value:function(e){var t=this,a=[];e.forEach(function(s){s.hidden||a.push(s.accountId)});var r=e.map(function(s){return{account:s,tasks:[]}});L.Z.getSubordinateTaskGantt({projectId:m.projectId,accountIds:a,startTime:m.minStartTime,endTime:m.maxEndTime}).then(function(s){s.status&&(m.isRequestComplete=!0,m.timeStamp=p()(s.data.timeStamp).add(1,"h").format("YYYY-MM-DD HH:00"),(!m.maxEndTime||p()(m.maxEndTime)<p()(s.data.maxTime))&&(m.maxEndTime=s.data.maxTime,t.props.dispatch(ye())),s.data.accountTasksKV.forEach(function(i){r.forEach(function(o){i.account.accountId===o.account.accountId&&(o.tasks=i.tasks)})}),t.props.dispatch(At(m.TASKSTATUS.NO_COMPLETED)),t.props.dispatch(Fe(r)))})}},{key:"getMoreSubordinateTasks",value:function(e,t,a){var r=this;m.isReady=!1,L.Z.getSubordinateTaskGantt({projectId:m.projectId,accountIds:e,startTime:t,endTime:a}).then(function(s){s.status&&((!m.maxEndTime||p()(m.maxEndTime)<p()(s.data.maxTime))&&(m.maxEndTime=s.data.maxTime,r.props.dispatch(ye())),r.props.dispatch(Hr(s.data.accountTasksKV)),(s.data.length||$(".timeBarContainer").scrollLeft()<50)&&$(".timeBarContainer").scrollLeft(50),m.isReady=!0)})}},{key:"render",value:function(){return n.createElement("div",{className:"taskGanttContainer flexColumn"},n.createElement(Ur,{showStaticGantt:!!m.folderId}),m.isRequestComplete&&this.props.accountTasksKV.length?n.createElement("div",{className:"ganttMain flex flexRow"},m.folderId?n.createElement(Or,null):n.createElement(Gr,{getSetting:this.getSetting.bind(this),getMoreSubordinateTasks:this.getMoreSubordinateTasks.bind(this),subordinateSocketSubscribe:this.subordinateSocketSubscribe.bind(this)}),n.createElement("div",{className:"flex flexColumn"},n.createElement(Zr,null),n.createElement(es,{getMoreSubordinateTasks:this.getMoreSubordinateTasks.bind(this)}))):n.createElement("div",{id:"taskFilterLoading"},n.createElement("div",{className:"loadingCenter",dangerouslySetInnerHTML:{__html:LoadDiv()}})))}}]),d}(n.Component),as=(0,Ke.Z5)(Pa.Z)((0,re.$j)(function(v){var d=v.task,l=d.accountTasksKV,e=d.stateConfig,t=d.taskConfig;return{accountTasksKV:l,stateConfig:e,taskConfig:t}})(ts));const jt=as;var rs=function(v){(0,W.default)(d,v);function d(){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).apply(this,arguments))}return(0,R.default)(d,[{key:"joinNetwork",value:function(){(0,Ye.T8)("/personal?type=enterprise")}},{key:"render",value:function(){var e=this;return md.global.Account.projects.length?n.createElement("div",{className:"subordinateContainer flexColumn"},n.createElement("div",{className:"subordinateHead relative"},n.createElement("div",{className:"subordinateLabel"},_l("\u4E0B\u5C5E\u4EFB\u52A1"))),n.createElement("div",{className:"flex folderGanttMain relative"},n.createElement(jt,null))):n.createElement("div",{className:"subordinateNull"},n.createElement("div",{className:"subordinateNullImg"}),n.createElement("div",{className:"Font17 mTop40"},_l("\u521B\u5EFA\u6216\u52A0\u5165\u7EC4\u7EC7\u4EE5\u542F\u7528\u201C\u4E0B\u5C5E\u4EFB\u52A1\u201D\uFF0C\u67E5\u770B\u4E0B\u5C5E\u548C\u534F\u4F5C\u540C\u4E8B\u7684\u4EFB\u52A1\u8FDB\u5C55")),n.createElement("div",{className:"Font16 mTop40 subordinateAdd ThemeColor3 ThemeBorderColor3 pointer",onClick:function(){return e.joinNetwork()}},_l("\u521B\u5EFA\u7EC4\u7EC7")),n.createElement("div",{className:"Font13 mTop20 ThemeColor3"},_l("\u6216")," ",n.createElement("span",{className:"pointer",onClick:function(){return e.joinNetwork()}},_l("\u52A0\u5165\u7EC4\u7EC7"))))}}]),d}(n.Component),ss=k(46593),Rt=k.n(ss),ns=k(45005),Ie=k.n(ns),is=k(99230),Gt=k.n(is),os=k(64325),Wt=k.n(os),ls=k(47729),ds=k.n(ls),cs=k(54427),us=k.n(cs),fs=k(97764),ms=k.n(fs),M={pageIndex:1,isMore:!0,isLoading:!1,timer:null,isFirst:!0,categoryTime:null,categoryNumber:null,isAnimated:!0,myTaskIsMore:{0:!0,1:!0,2:!0,3:!0},typeNum:{},taskListPost:null},ps=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.quickCreateTaskCallback=function(t){alert(_l("\u521B\u5EFA\u6210\u529F"));var a=e.props.taskConfig,r=a.lastMyProjectId,s=a.projectId,i=a.listSort,o=a.filterUserId;if(!(r!=="all"&&r!==t.data.projectId)){var c={formatTaskTime:I.Mq,formatStatus:I.LR,buildMyTaskIcon:I.ep,Sort:i,isMyTask:i===0,createNewTask:!0,task:t.data},u=t.data.parentTaskId;if(u){var f=$("#taskList tr[data-taskid='"+u+"']");if(f.find(".icon-task-card").length>0){var h=f.find(".subCount");h.text(parseInt(h.text(),10)+1)}else f.find(".taskListDate").prepend('<i class="icon-task-card" data-tip="'+_l("\u5B50\u4EFB\u52A1")+'"></i><span class="subCounts"><span class="completedNum">0</span>/<span class="subCount">1</span></span> ')}c.task.auth=1,c.task.newTask=!1,c.task.status=0,$("#taskList table").length>0&&(c.isExists=!0),i==4&&($(".taskListFolderName[data-folderid=null]").length<=0?c.isExists=!1:c.isExists=!0),$("#taskList .listCreateNew").remove();var g=ms().replace("#include.nodeCommTr",Ie()),T=Z().template(g)(c);if(i==4){var E=c.data.folderID;if(c.isExists)$(".taskListFolderName[data-folderid='"+E+"']").next().find("table tbody").prepend(T);else{var C=$('<div class="taskListFolderName" data-folderid="null"> <i class="arrow-down"></i> <span class="listFolderNameTextList ThemeColor9" title="'+_l("\u672A\u5173\u8054\u9879\u76EE")+'">'+_l("\u672A\u5173\u8054\u9879\u76EE")+'</span> <span class="folderTaskCount">1</span> </div>');$("#taskList").append(C).append(T)}}else c.isExists?$("#taskList table:first tbody").prepend(T).closest(".persist-area").removeClass("Hidden"):$("#taskList").html(T);if(!o){var N=$(".myTask .allCountTask:first");N.text(parseInt(N.text()||0,10)+1)}e.renderChargeHeaderAvatar()}},e.openTaskDetailCallback=function(){var t=$("#taskList tr[data-taskid="+e.state.taskId+"]"),a=t.find(".newTopic"),r=t.find(".newTaskTip"),s=function(){if(t.data("isnotice")){var o=$("#taskNavigator .myTask .newTip");if(o.length){var c=parseInt(o.attr("data-count"),10);c===1?o.remove():o.attr("data-count",c-1)}}};r.length&&(r.animate({width:"0px"},150,function(){$(this).remove()}),t.find(".spanName").animate({"border-left-width":"0px"},150,function(){$(this).removeClass("newTaskTipName")})),a.length&&(a.animate({"margin-top":"5px"},150),a.fadeOut(function(){a.remove(),s()}))},e.state={openTaskDetail:!1,taskId:"",isForceUpdate:!1},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){if(this.mounted=!0,!y().isEmpty(this.props.myTaskDataSource)){var e=this.props.taskConfig,t=e.taskFilter,a=e.filterUserId,r=e.listSort,s=e.listStatus,i=e.filterSettings,o=!a&&r===0&&(t===6||t===1||t===2||t===3)&&!i.tags.length&&s===0,c=this.props.myTaskDataSource;c.hideOpts=!0,M.isFirst=!0,o?this.renderMyTask(c):this.renderTask(c),M.isAnimated=!1}this.init(),this.bindEvents(),this.props.emitter.removeListener("CREATE_TASK_TO_LIST",this.quickCreateTaskCallback),this.props.emitter.addListener("CREATE_TASK_TO_LIST",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar),this.props.emitter.addListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this;!e.taskConfig.folderId&&(!y().isEqual(e.taskConfig,this.props.taskConfig)||S.ZP.isGetData)&&setTimeout(function(){M.taskListPost.abort(),t.init()},0)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,M.taskListPost.abort(),clearTimeout(M.timer),this.props.emitter.removeListener("CREATE_TASK_TO_LIST",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar)}},{key:"init",value:function(){M.pageIndex=1,M.isMore=!0,M.isLoading=!1,M.isFirst=!0,M.myTaskIsMore={0:!0,1:!0,2:!0,3:!0},M.typeNum={};var e=this.props.taskConfig,t=e.taskFilter,a=e.filterUserId,r=e.listSort,s=e.listStatus,i=e.filterSettings;S.ZP.isMyTask=!a&&r===0&&(t===6||t===1||t===2||t===3)&&s===0,S.ZP.FilterMeTaskClassify=[3],S.ZP.FilterTaskID=[],S.ZP.isMyTask?this.getMyTaskByType():this.getTasksByType()}},{key:"renderChargeHeaderAvatar",value:function(e){var t=this,a=this.props.taskConfig;$("#tasks .listStageTaskContent tr .chargeTd").each(function(r,s){var i=$(s);if(!i.data("hasbusinesscard")){var o=a.folderId,c=a.projectId,u=void 0;o?u=i.closest("li").data("taskid"):(u=i.closest("tr").data("taskid"),c=i.closest("tr").data("projectid"));var f=e?y().get(e.data,"data.charge.accountID"):i.data("id"),h=e?y().get(e.data,"data.charge.avatar"):i.data("src"),g=e?y().get(e.data,"data.auth"):i.data("auth");e&&i.data("auth",g),i.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{user:{userHead:h,accountId:f},size:26,operation:g===S.ZP.auth.Charger?n.createElement("span",{className:"updateChargeBtn ThemeColor3",onClick:function(){(0,ke.Z)({sourceId:o,showMoreInvite:!1,fromType:2,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:[f],projectId:(0,I.Ie)(c)?c:"",unique:!0,callback:function(C){var N=C[0];t.props.dispatch((0,B.rv)(u,N,"",function(){i.data("id",N.accountId).data("src",N.avatar).data("hasbusinesscard",!1),t.renderChargeHeaderAvatar()}))}}})}},_l("\u5C06\u4EFB\u52A1\u6258\u4ED8\u7ED9\u4ED6\u4EBA")):null}),s)}})}},{key:"bindEvents",value:function(){var e=$("#taskList"),t=this;e.on("click",".listStageTaskContent tr",function(a){var r=$(this),s=!1,i=void 0;if(!($(a.target).hasClass("markTask")||$(a.target).hasClass("taskStar"))){if((a.ctrlKey||a.metaKey)&&a.shiftKey?(i="shiftCtrl",s=!0):a.ctrlKey||a.metaKey?(i="ctrl",s=!0):a.shiftKey&&(i="shift",s=!0),s)t.setState({openTaskDetail:!1,taskId:""}),k.e(9214).then(k.bind(k,9214)).then(function(u){u.default.shiftCtrlKey(r,i)});else{S.ZP.$prevNode=r;var o=r.find(".txtName");$("#taskList table tr").removeClass("selectTask ThemeBGColor6"),r.addClass("selectTask ThemeBGColor6");var c=r.data("taskid");t.setState({openTaskDetail:!0,taskId:c,isForceUpdate:!0})}return $("#taskList")[0]&&$(".floatingHeader").css("right",660-$("#taskList")[0].scrollWidth+$("#taskList")[0].offsetWidth+$("#chat").width()),!1}}),e.on({click:function(r){var s=$(this).closest(".persist-area").length?$(this).parentsUntil("#taskList"):$(this),i=$(this).closest(".persist-area").length?$(this).parentsUntil("#taskList").find(".listStageTaskContent"):$(this).next(".listStageTaskContent");if(!i.is(":animated")){var o=t.props.taskConfig.listSort;i.toggle(1,function(){o!=4&&t.myTaskManipulation(i)}),s.find(".arrow-down").toggleClass("downArrow"),t.hideTaskSetting(),r.stopPropagation()}},hover:function(r){var s=r.type=="mouseenter";$(this).find(".listFolderNameTextList").toggleClass("ThemeColor3",s),$(this).find(".arrow-down").toggleClass("ThemeBorderColor3",s)}},".taskListFolderName"),e.on("scroll",function(){var a=t.props.taskConfig,r=a.folderId,s=a.taskFilter,i=a.listSort;if(!(r||s===9)){t.hideTaskSetting();var o=$(this),c=o.height(),u=o[0].scrollHeight,f=o[0].scrollTop,h=!1;f+c+100>=u&&($(".listStageTaskContent").filter(":visible").each(function(g,T){M.myTaskIsMore[T]&&(h=!0)}),(M.isMore||h)&&!M.isLoading&&(M.pageIndex++,S.ZP.isMyTask?t.getMyTaskByType():t.getTasksByType()))}}),e.on("click",".myTaskTag",function(a){a.stopPropagation();var r=$(this).closest("tr").data("projectid"),s=$(this).closest("tr").data("taskid"),i=$(this).closest("table").data("type"),o=$(".myTaskSettingList").data("taskid",s).data("projectid",r),c=$(this).offset(),u=parseInt(window.innerHeight,10);if(t.hideTaskSetting(),!$(this).children().hasClass("Hidden"))return!1;o.removeClass("Hidden").data("type",i),o.find("li").removeClass("ThemeColor3"),o.find("[data-type="+i+"]").addClass("ThemeColor3"),$(this).children().removeClass("Hidden"),c.top+o.height()+$("#topBarContent").height()>u?o.css({left:c.left-14,top:c.top-5-o.height()}):o.css({left:c.left-14,top:c.top+40})}),$(".myTaskSettingList li").on("click",function(){var a=$(this),r=a.closest("ul").data("taskid"),s=a.data("type"),i=a.parent();i.data("type")!=s&&(t.hideTaskSetting(),t.updateMyTaskClassify(r,s))}),e.on("mousedown","table",function(a){a.ctrlKey&&a.preventDefault()}),e.on("click",".creatNewContent",function(){$.CreateTask()}),$(document).on("click",function(a){var r=$(a.target);r.closest(".myTaskSettingList").length<=0&&r.closest(".myTaskTag").length<=0&&!r.is(".myTaskIcon")&&t.hideTaskSetting()})}},{key:"getTasksByType",value:function(){var e=this;M.isLoading=!0,(0,te.a0)(M.pageIndex);var t=this.props.taskConfig,a=t.lastMyProjectId,r=t.taskFilter,s=t.listSort,i=t.listStatus,o=t.filterUserId,c=t.completeTime,u=t.filterSettings,f=y().filter(u.tags,function(T){return T!=="null"}),h=!1,g=this.props.taskConfig.searchKeyWords;y().findIndex(u.tags,function(T){return T==="null"})>=0&&(h=!0),r!==8?M.taskListPost=L.Z.getTaskList({page:M.pageIndex,size:S.ZP.pageSize,sort:s,other:o,filterType:r||6,completeTime:c,status:i,tagIDs:f,withoutTag:h,folderID:"",structure:s===4?S.ZP.structure.folderList:S.ZP.structure.list,isFirst:M.isFirst,projectId:a,keyWords:g}):M.taskListPost=L.Z.getTaskListWithStar({pageIndex:M.pageIndex,pageSize:S.ZP.pageSize,completeTime:c,status:i,projectId:a}),M.taskListPost.then(function(T){M.isLoading=!1,S.ZP.isGetData=!1,T.status?(M.pageIndex===1&&!o&&e.props.dispatch((0,B.nL)(y().cloneDeep(T.data))),M.isAnimated?e.renderTask(T.data):M.timer=setTimeout(function(){e.renderTask(T.data)},100)):(0,I.N3)(T.error)})}},{key:"renderTask",value:function(e){var t=this,a=this.props.taskConfig,r=a.keyWords,s=a.listSort,i=a.listStatus,o=a.filterSettings,c=e.data&&e.data.length;if(this.props.dispatch((0,B.YP)(e.taskNum)),c)if(e.formatTaskTime=I.Mq,e.formatStatus=I.LR,e.isAnimated=M.isAnimated,s===4){var u=0;if($.map(e.data,function(T,E){u+=(T.tasks||[]).length}),M.isMore=u>=S.ZP.pageSize,M.pageIndex==1){var f=Gt().replace("#include.nodeCommTr",Ie());$("#taskList").html(Z().template(f)(e)),this.slideUpTd()}else(function(){var T=[];$("#taskList .taskListFolderName").each(function(){var H=$(this).data("folderid");T.indexOf(H)<0&&T.push(H)});for(var E=e.data,C=E.length,N=void 0,F=0;F<C;F++)if(E[F].folderID||(E[F].folderID=1),N=E[F],T.indexOf(N.folderID)>-1){N.formatTaskTime=I.Mq,N.formatStatus=I.LR,y().remove(E,function(H){return H.folderID===N.folderID});var x=Wt().replace("#include.nodeCommTr",Ie());$("#taskList .taskListFolderName[data-folderid='"+N.folderID+"']").next().find("table tbody").append(Z().template(x)(N)),t.slideUpTd(),F--,C=E.length}if(e.data.length>0){var A=Gt().replace("#include.nodeCommTr",Ie());$("#taskList").append(Z().template(A)(e)),t.slideUpTd()}})()}else{e.pageIndex=M.pageIndex;var h=ds().replace("#include.nodeCommTr",Ie()),g=Z().template(h)(e);M.pageIndex===1?$("#taskList").html(g):$("#taskList table tbody").append(g),this.slideUpTd(),M.isMore=e.data.length>=S.ZP.pageSize}else M.pageIndex===1&&(r?$("#taskList").html(S.ZP.configHtml.searchNullHtml):o.tags.length?$("#taskList").html(S.ZP.configHtml.filterNullHtml):i===1?$("#taskList").html(S.ZP.configHtml.noCompleteNullHtml):this.renderNoData()),M.isMore=!1;M.isAnimated=!0,$("#taskFilterLoading, #taskFilterLoadingBottom").remove(),this.renderChargeHeaderAvatar()}},{key:"getMyTaskByType",value:function(){var e=this;M.isLoading=!0,(0,te.a0)(M.pageIndex);var t=!1,a=$.grep([0,1,2,3],function(T){return $.inArray(T,S.ZP.FilterMeTaskClassify)==-1});if(a.length==0&&a.push(0),$.each(a,function(T,E){if(M.myTaskIsMore[E])return t=!0,!1}),!t)return $("#taskFilterLoading, #taskFilterLoadingBottom").remove(),!1;var r=this.props.taskConfig,s=r.listStatus,i=r.listSort,o=r.filterUserId,c=r.taskFilter,u=r.completeTime,f=r.lastMyProjectId,h=r.filterSettings,g=y().filter(h.tags,function(T){return T!=="null"});M.taskListPost=L.Z.getTaskList({page:M.pageIndex,size:S.ZP.pageSize,sort:i,other:o,filterType:c||6,completeTime:u,status:s,tagIDs:g,withoutTag:!1,structure:S.ZP.structure.myClassify,classify:S.ZP.FilterMeTaskClassify.length==3?a.join(","):-1,filterTaskIDs:S.ZP.FilterTaskID.join(","),filterMeTaskClassifys:S.ZP.FilterMeTaskClassify.join(","),isFirst:M.isFirst,projectId:f,keyWords:""}),M.taskListPost.then(function(T){M.isLoading=!1,S.ZP.isGetData=!1,T.status?(M.pageIndex===1&&!o&&e.props.dispatch((0,B.nL)(y().cloneDeep(T.data))),M.isAnimated?e.renderMyTask(T.data):M.timer=setTimeout(function(){e.renderMyTask(T.data)},100)):(0,I.N3)(T.error)})}},{key:"renderMyTask",value:function(e){if(e.formatTaskTime=I.Mq,e.formatStatus=I.LR,e.buildMyTaskIcon=I.ep,e.isMyTask=!0,e.pageIndex=M.pageIndex,e.TYPES=S.ZP.MYTASKTYPES,e.TIPS=S.ZP.TIPS,e.FilterMeTaskClassify=S.ZP.FilterMeTaskClassify,e.isAnimated=M.isAnimated,this.updateMyTaskIsMore(e),M.isFirst){var t=us().replace("#include.nodeCommTr",Ie());$("#taskList").html(Z().template(t)(e)),e.taskNum===0&&this.renderNoData(),this.renderMyTaskNum(e)}else{var a=Wt().replace("#include.nodeCommTr",Ie());Ce()(e.data).forEach(function(r){if(r=r.substring(r.indexOf("num_")+4),r in e.TYPES){e.type=parseInt(r,10),e.tasks=e.data["classify_"+r];var s=Z().template(a)(e);$("#taskList .taskListFolderName[data-type="+r+"]").next(".listStageTaskContent").find("tbody").append(s)}})}M.isFirst=!1,M.isAnimated=!0,this.fixTitle(),$("#taskFilterLoading, #taskFilterLoadingBottom, #trInlineLoading").remove(),this.slideUpTd(),this.renderChargeHeaderAvatar()}},{key:"renderNoData",value:function(){var e=this.props.taskConfig.listSort,t=`
      <div class="listCreateNew boderRadAll_3">
        <div class="creatNewContent">
          <i class="taskQuickCreate"></i>
          <span>
            `+_l("\u70B9\u51FB\u521B\u5EFA\u4EFB\u52A1")+`<br>
            <span class="Font14">`+_l("\u6216\u4F7F\u7528\u53F3\u4E0A\u89D2 + \u53F7\u521B\u5EFA\u4EFB\u52A1")+`</span>
          </span>
        </div>
        <div class="ThemeBG taskGroundGlass"></div>
      </div>`;e===0?$("#taskList").append(t):$("#taskList").html(t)}},{key:"updateMyTaskIsMore",value:function(e){var t=$.grep([0,1,2,3],function(r){return $.inArray(r,S.ZP.FilterMeTaskClassify)==-1}),a=0;$.each(t,function(r,s){for(var i=e.data["classify_"+s],o=0;o<s+1;o++)a+=e.data["classify_"+o]?e.data["classify_"+o].length:0;if(!i)M.myTaskIsMore[s]=!1;else{if(a>=S.ZP.pageSize)return M.myTaskIsMore[s]=!0,!1;M.myTaskIsMore[s]=!1}})}},{key:"renderMyTaskNum",value:function(e){S.ZP.FilterMeTaskClassify.length!==4&&$.each(e.data,function(t,a){if(/^num_\d$/.test(t)&&!M.typeNum[t]){var r=t.slice(-1),s=$("#taskList .taskListFolderName").filter("[data-type="+r+"]").find(".stageTaskCount");s.text(a||""),M.typeNum[t]=a}})}},{key:"fixTitle",value:function(){$("#taskList").find(".floatingHeader").length<=0&&($(".persist-area").each(function(){var e=$(".persist-header",this);e.before(e.clone()).addClass("floatingHeader")}),$("#taskList").on("scroll",function(){$(".persist-area").each(function(){var e=$(this),t=e.offset(),a=t.top-152,r=$("#taskList").scrollTop(),s=$(".floatingHeader",this);if($(".floatingHeader").css({visibility:"hidden",right:$(".taskDetail").width()+20-$("#taskList")[0].scrollWidth+$("#taskList")[0].offsetWidth+$("#chat").width()+$(".taskFilterBox").width()}),r>0&&a+e.height()>0)return s.css({visibility:"visible"}),!1;s.css({visibility:"hidden"})})}))}},{key:"myTaskManipulation",value:function(e){var t=$("#taskList"),a=t.find(".taskListFolderName[data-type]").not(".floatingHeader");S.ZP.FilterMeTaskClassify=[],S.ZP.FilterTaskID=[],M.pageIndex=0,a.each(function(r,s){var i=$(this),o=i.siblings(".listStageTaskContent").find("tr"),c=i.find(".downArrow").length>0,u=i.data("type");c?(S.ZP.FilterMeTaskClassify.push(u),$(".listStageTaskContent").filter(":visible").find("tr").each(function(){var f=$(this),h=f.data("taskid");S.ZP.FilterTaskID.indexOf(h)<0&&S.ZP.FilterTaskID.push(h)})):o.each(function(){var f=$(this),h=f.data("taskid");S.ZP.FilterTaskID.push(h)})}),this.myTaskPreLoad(e)}},{key:"myTaskPreLoad",value:function(e){var t=$("#taskList"),a=t.find("table tr").filter(":visible");(a.length<S.ZP.pageSize||!e.find("tr").length)&&(M.pageIndex=1,this.getMyTaskByType())}},{key:"hideTaskSetting",value:function(){var e=$(".myTaskSettingList");$("#taskList .myTaskTag").children().add(e).addClass("Hidden")}},{key:"slideUpTd",value:function(){var e=$("#taskList tr.animatedFarFast td.animatedFarFast"),t=$("#taskList tr");e.each(function(a){$(this).animate({height:"0px"},300).delay((a+1)*30)}),t.each(function(a){$(this).animate({opacity:1},300)}),Rt().all([e.promise(),t.promise()]).then(function(){$("#taskList tr.animatedFarFast").remove()})}},{key:"updateMyTaskClassify",value:function(e,t){var a=this,r=this.props.taskConfig.listSort;L.Z.updateTaskMemberClassify({taskIDstr:e,classify:t}).then(function(s){s.status?(r===0&&a.afterUpdateClassify(e.split(","),t),S.ZP.FilterTaskID=S.ZP.FilterTaskID.concat(e.split(",")),alert(_l("\u64CD\u4F5C\u6210\u529F"),1)):(0,I.N3)(s.error)})}},{key:"afterUpdateClassify",value:function(e,t){$("#taskList .taskListFolderName").filter("[data-type=0]").removeClass("Hidden");var a=$("#taskList .taskListFolderName").filter("[data-type="+t+"]").removeClass("Hidden"),r=a.next().find("table tbody"),s=a.find(".stageTaskCount"),i=parseInt(s.html(),10)||0;a.parents(".persist-area").removeClass("Hidden"),s.html((i<=0?0:i)+e.length),$.each(e,function(o,c){$("#taskList tr[data-taskid="+c+"]").find(".myTaskTag").html((0,I.ep)(t));var u=$("#taskList tr[data-taskid="+c+"]"),f=u.closest(".listStageTaskContent").siblings(".taskListFolderName"),h=f.find(".stageTaskCount"),g=parseInt(h.html(),10)-1||0;h.html(g<=0?0:g),u.find(".myTaskTag").html((0,I.ep)(t)),u.prependTo(r)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.openTaskDetail,r=t.taskId,s=t.isForceUpdate;return n.createElement(n.Fragment,null,n.createElement("ul",{className:"myTaskSettingList borderRadAll_3 Hidden"},n.createElement("li",{"data-type":"1",className:"myTaskChoice ThemeBGColor3"},n.createElement("i",{className:"icon-task-today"}),_l("\u4ECA\u5929\u8981\u505A")),n.createElement("li",{"data-type":"2",className:"myTaskChoice ThemeBGColor3"},n.createElement("i",{className:"icon-task-soon"}),_l("\u6700\u8FD1\u8981\u505A")),n.createElement("li",{"data-type":"3",className:"myTaskChoice ThemeBGColor3"},n.createElement("i",{className:"icon-task-later"}),_l("\u4EE5\u540E\u8003\u8651"))),n.createElement("div",{id:"taskList"}),n.createElement(be.Z,{visible:a,taskId:r,isForceUpdate:s,closeForceUpdate:function(){return e.setState({isForceUpdate:!1})},openType:1,hasNotice:r&&!!$("#taskList tr[data-taskid="+r+"] .newTopic").length,openCallback:this.openTaskDetailCallback,closeCallback:function(){return e.setState({taskId:""})},animationEndRemoveDetail:function(){return e.mounted&&e.setState({openTaskDetail:!1})}}))}}]),d}(n.Component);const hs=(0,re.$j)(function(v){return v.task})(ps);var vs=k(88311),mn=k(98110),gs=k(90443),et=k.n(gs),ks=k(19524),Ts=k.n(ks),Cs=k(3583),ys=k.n(Cs),Ss=k(49334),Is=k.n(Ss),Es=k(98),Ns=k.n(Es),b={timer:null,pointInitX:0,pointInitY:0,pointGapX:0,pointGapY:0,$draggableObjMirror:null,oldValue:null,globalEvent:null,isDragEnd:!0,dragAuth:!1,ajaxPost:""},Ds=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.quickCreateTaskCallback=function(t,a){var r={formatTaskTime:I.Mq,returnCustonValue:I.B_,isCreateNew:!0,task:t.data};r.task.auth=1,r.task.status=0;var s=Z().template(et())(r),i=$("#taskList li.singleStage[data-stageid='"+r.task.stageID+"']");i.find(".listStageContent ul .addNewTask").length?(i.find(".listStageContent ul .addNewTask").before(s),i.find(".listStageContent ul .btnStagCreateTask").data("create",0)):i.find(".listStageContent ul").append(s);var o=i.find(".stageHeader .taskCount");if(o.length?o.html(parseInt(o.html(),10)+1):i.find(".stageHeader .listStageTaskCount").html('(<span class="taskCount">1</span>)'),e.canelCreateStageTask(i),e.renderChargeHeaderAvatar(),a&&a.click(),!e.props.taskConfig.filterUserId){var c=$(".myTask .allCountTask:first");c.text(parseInt(c.text()||0,10)+1)}},e.state={openTaskDetail:!1,taskId:"",isForceUpdate:!1},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){this.mounted=!0,this.init(),this.bindEvents(),this.props.emitter.removeListener("CREATE_TASK_TO_STAGE",this.quickCreateTaskCallback),this.props.emitter.addListener("CREATE_TASK_TO_STAGE",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar),this.props.emitter.addListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=ee()({},e.taskConfig),r=ee()({},this.props.taskConfig);a.projectId="",r.projectId="",(e.taskConfig.folderId&&!y().isEqual(a,r)||S.ZP.isGetData)&&setTimeout(function(){t.init()},0)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,this.props.emitter.removeListener("CREATE_TASK_TO_STAGE",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.renderChargeHeaderAvatar)}},{key:"init",value:function(){var e=this;(0,te.a0)(1);var t=this.props.taskConfig,a=t.filterSettings,r=t.folderId,s=t.listSort,i=t.listStatus,o=t.completeTime,c=t.viewType,u=t.searchKeyWords,f=r===1?"":r,h=!1,g=y().filter(a.tags,function(T){return T!=="null"});y().findIndex(a.tags,function(T){return T==="null"})>=0&&(h=!0),L.Z.getTaskListWithStageView({folderID:f,tagIDs:g,chargeIds:a.selectChargeIds,controlSelectedDic:this.returnCustomFilterArray(),sort:s,status:i,completeTime:o,withoutTag:h,pageSize:S.ZP.pageSize,filterType:a.folderSearchRange,keywords:u}).then(function(T){S.ZP.isGetData=!1,c===S.ZP.folderViewType.stageView&&(T.status?(b.dragAuth=T.data.canEditStages,e.renderStageDom(T.data)):(0,I.N3)(T.error))})}},{key:"renderStageChargeUser",value:function(){$("#taskList .singleStage .stageChargeAvatar").each(function(e,t){var a=$(t);if(!a.data("hasbusinesscard")){var r=a.closest(".singleStage").data("chargeid");a.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{user:{userHead:$(t).data("src"),accountId:r},size:26}),t)}})}},{key:"renderChargeHeaderAvatar",value:function(e){var t=this,a=this.props.taskConfig;$("#tasks .listStageContent .chargeHeaderAvatar").each(function(r,s){var i=$(s);if(!i.data("hasbusinesscard")){var o=a.folderId,c=a.projectId,u=void 0;o?u=i.closest("li").data("taskid"):(u=i.closest("tr").data("taskid"),c=i.closest("tr").data("projectid"));var f=e?y().get(e.data,"data.charge.accountID"):i.data("id"),h=e?y().get(e.data,"data.charge.avatar"):i.data("src"),g=e?y().get(e.data,"data.auth"):i.data("auth");e&&i.data("auth",g),i.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{user:{userHead:h,accountId:f},size:26,operation:g===S.ZP.auth.Charger?n.createElement("span",{className:"updateChargeBtn ThemeColor3",onClick:function(){(0,ke.Z)({sourceId:o,showMoreInvite:!1,fromType:2,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:[f],projectId:(0,I.Ie)(c)?c:"",unique:!0,callback:function(C){var N=C[0];t.props.dispatch((0,B.rv)(u,N,"",function(){i.data("id",N.accountId).data("src",N.avatar).data("hasbusinesscard",!1),t.renderChargeHeaderAvatar()}))}}})}},_l("\u5C06\u4EFB\u52A1\u6258\u4ED8\u7ED9\u4ED6\u4EBA")):null}),s)}})}},{key:"bindEvents",value:function(){var e=this,t=$("#taskList");t.on("click",".singleStage .stageChargeAvatar",function(a){var r=$(this),s=r.closest(".singleStage").data("edit");s&&e.addStageCharge(r.closest(".singleStage"),r)}),t.on("mousewheel DOMMouseScroll",function(a){if(!$(a.target).closest(".listStageContent").length){var r=$(this).children("ul"),s=r.scrollLeft(),i=r[0]?r[0].scrollWidth:0,o=r.width(),c=120;a.preventDefault();var u=parseInt(a.originalEvent.wheelDelta||-a.originalEvent.detail,10),f=/mac/i.test(navigator.platform);if(f&&Math.abs(u)<50)return;u>0?r.scrollLeft(s-c>0?s-c:0):u<0&&r.scrollLeft(s+c+o>i?i-o:s+c)}}),t.on("click",".singleStage .icon-arrow-down-border",function(a){var r=$("#taskList .listStageDownOperator"),s=-15;if($(this).find(".listStageDownOperator").length&&r.is(":visible")){r.hide();return}$(this).append(r),$(this).offset().left+r.width()>$(window).width()&&(s=-170);var i=$(this).closest(".singleStage").data("chargeid");$("#taskList .listStageDownOperator .stageCharge .text").text(i?_l("\u53D6\u6D88\u9ED8\u8BA4\u8D1F\u8D23\u4EBA"):_l("\u8BBE\u7F6E\u9ED8\u8BA4\u8D1F\u8D23\u4EBA")),$("#taskList .listStageDownOperator").css("left",s).show(),a.stopPropagation()}),t.on({mousedown:function(r){var s=$(r.target),i=$(this);if(!(r.button===2||s.is(".markTask")))return b.oldValue=i.closest("li.singleStage").data("stageid"),b.timer=setTimeout(function(){return clearTimeout(b.timer),b.timer=null,b.pointInitX=r.clientX,b.pointInitY=r.clientY,b.isDragEnd=!1,e.draggableTask(i),r.stopPropagation(),!1},200),r.stopPropagation(),!1},click:function(r){clearTimeout(b.timer),b.timer=null;var s=$(this),i=!1,o=void 0;if(!(s.hasClass("addNewTask")||$(r.target).hasClass("markTask")||$(r.target).hasClass("taskStar"))){if((r.ctrlKey||r.metaKey)&&r.shiftKey?(o="shiftCtrl",i=!0):r.ctrlKey||r.metaKey?(o="ctrl",i=!0):r.shiftKey&&(o="shift",i=!0),i)return e.setState({openTaskDetail:!1,taskId:""}),k.e(9214).then(k.bind(k,9214)).then(function(u){u.default.shiftCtrlKey(s,o)}),r.stopPropagation(),!1;S.ZP.$prevNode=s,$("#taskList .singleStage li").removeClass("selectTask"),s.addClass("selectTask");var c=s.data("taskid");e.setState({openTaskDetail:!0,taskId:c,isForceUpdate:!0}),$("#taskList .addNewTask").length>0&&e.canelCreateStageTask($("#taskList .addNewTask").closest("li.singleStage"))}}},".singleStage .listStageContent li.singleTaskStage"),t.on("click",".listStageDownOperator li.updateStageName",function(){var a=$(this).closest("ul").closest("li");a.find(".listStageTaskCount").hide();var r=a.find(".listStageName").hide(),s=$.trim(r.text());a.find(".stageChargeAvatar").addClass("Hidden"),a.find(".icon-arrow-down-border").hide().end().find(".stageHeader").append('<input class="updateStageName boderRadAll_3 ThemeBorderColor3" maxlength="100" />').end().find("input.updateStageName").focus().val(s),b.isBlur=!1}),t.on("click",".listStageDownOperator li.addNewStageToNext",function(a){e.addStageToNext($(this)),a.stopPropagation()}),t.on("click",".listStageDownOperator li.stageCharge",function(a){var r=$(this).closest("li.singleStage");r.data("chargeid")?e.setStageOwner(r):e.addStageCharge(r,r.find(".icon-arrow-down-border")),$(".listStageDownOperator").hide(),a.stopPropagation()}),t.on("click",".listStageDownOperator li.delStage",function(a){var r=$(this).closest("li.singleStage");$("#taskList .listStage").append($(".listStageDownOperator").hide()),e.delStage(r),a.stopPropagation()}),t.on({blur:function(){b.isBlur||(b.isBlur=!0,e.updateStageName($(this)))},keyup:function(r){r.keyCode===13&&$(this).blur()}},".stageHeader .updateStageName"),t.on({mousedown:function(r){if(!(!b.dragAuth||$(this).find("input").length>0||r.button===2||$(r.target).is(".icon-arrow-down-border")||$(r.target).closest(".listStageDownOperator").length)){var s=$(this).closest("li.singleStage");return b.oldValue=s.index(),b.timer=setTimeout(function(){return clearTimeout(b.timer),b.timer=null,b.pointInitX=r.clientX,b.pointInitY=r.clientY,b.isDragEnd=!1,e.draggableStage(s),$("html").addClass("overflowHidden"),r.stopPropagation(),!1},200),r.stopPropagation(),!1}},mouseup:function(r){clearTimeout(b.timer),b.timer=null;var s=$(this),i=s.closest("li.singleStage"),o=s.find(".listStageName");if($(r.target).is(o)){var c=o.hide();o.siblings(".icon-arrow-down-border,.listStageTaskCount").hide(),o.siblings(".stageChargeAvatar").addClass("Hidden"),o.closest(".stageHeader").append('<input class="updateStageName boderRadAll_3" maxlength="100" />'),o.siblings(".updateStageName").focus().val($.trim(c.text())),b.isBlur=!1}}},".singleStage .stageHeader"),t.on("mousedown",".listStage",function(a){var r=$("#taskList .listStage"),s=r.width(),i=$("#taskList .listStage > li").length*$("#taskList .listStage > li:first").width();if(!($(a.target).is(":input")||a.button===2||s>i||$(".singleStage .txtAddNew").length))return b.pointGapX=a.clientX,b.isDragEnd=!1,$(document).on({"mousemove.moveStage":function(c){b.globalEvent=c,e.movePageScroll(c),S.ZP.isDrop=!0},"mouseup.moveStage":function(){$(document).off("mousemove.moveStage"),$(document).off("mouseup.moveStage")}}),a.stopPropagation(),!1}),t.on({blur:function(){if(!b.isBlur){b.isBlur=!0;var r=$.trim($(this).val());if($(".listStage .addNewStage").removeClass("Hidden"),!r){$(this).closest("li.singleStage").remove();return}e.addNewStage($(this))}},keydown:function(r){r.keyCode==13&&$(this).blur()}},".singleStage .txtAddNew"),t.on("click",".singleStage .bottomNewBox",function(a){var r=$(this);$("li.addNewTask").each(function(){$.trim(r.find(".teaStageName").val())||e.canelCreateStageTask(r.closest("li.singleStage"))}),(0,oe.pF)(e.props.taskConfig.projectId).then(function(){e.addNewTask(r.parent())}),a.stopPropagation()}),t.on("click",".addNewTask .btnStagCreateTask",function(){var a=$(this);a.data("create")||(a.text(_l("\u521B\u5EFA\u4E2D\u2026")).data("create",1),e.addNewTaskEnter(a))}),t.on("click",".addNewTask .chargeHeaderAvatar",function(){var a=$(this),r=function(i){var o=i[0];a.attr({"data-id":o.accountId,src:o.avatar}).data("id",o.accountId)};(0,Oe.ZP)(a[0],{sourceId:e.props.taskConfig.folderId,showMoreInvite:!1,fromType:2,filterAccountIds:[a.attr("data-id")],includeUndefinedAndMySelf:!0,SelectUserSettings:{filterAccountIds:[a.attr("data-id")],projectId:(0,I.Ie)(e.props.taskConfig.projectId)?e.props.taskConfig.projectId:"",unique:!0,callback:r},selectCb:r})}),t.on("click",".addNewTask .taskStar",function(){$(this).toggleClass("icon-task-star icon-star-hollow")}),t.on("keydown",".addNewTask .teaStageName",function(a){if(a.keyCode==13)return $.trim($(this).val())&&e.addNewTaskEnter($(this).closest("li").find(".btnStagCreateTask"),!0),!1;a.stopPropagation()}),t.on("click",".addNewStage",function(){$(this).addClass("Hidden"),e.addStageToNext($(".listStage .singleStage:last"))}),t.on("mousedown",".singleStage .txtAddNew,li.addNewTask,.addNewTask .btnStagCreateTask,.addNewTask .stageDate,.addNewTask .chargeHeaderAvatar,.listStageDownOperator li.delStage,.listStageDownOperator li.updateStageName,.listStageDownOperator li.addNewStageToNext",function(a){a.stopPropagation()})}},{key:"returnCustomFilterArray",value:function(){var e=this.props.taskConfig.filterSettings.customFilter,t={};return Ce()(e).forEach(function(a){var r="",s=[];e[a].forEach(function(i){r?r.length>i.length?(s=r.split(""),s.splice(r.length-i.length,1,"1"),r=s.join("")):r=i.substr(0,i.length-r.length)+r:r=i}),t[a]=r}),t}},{key:"renderStageDom",value:function(e){e.formatTaskTime=I.Mq,e.formatStatus=I.LR,e.isEdit=b.dragAuth,e.returnCustonValue=I.B_;var t=Ts().replace("#include.nodeLiComm",et());$("#taskList").html(Z().template(t)(e)),this.renderStageChargeUser(),this.renderChargeHeaderAvatar(),this.customScore(),this.scrollFun()}},{key:"customScore",value:function(){$(".listStageCustomItemStar[data-type=score]").map(function(e,t){if(!$(t).find(".Score-wrapper").length){var a=$(t).data("enum"),r=$(t).data("score"),s="#f44336";r===6||a===1?s="#fed156":r>6&&(s="#4caf50"),se.render(n.createElement(vs.Z,{type:a===1?"star":"line",score:r,foregroundColor:s,backgroundColor:a===1?"#9e9e9e":"#e0e0e0",disabled:!0,count:a===1?5:10}),$(t)[0])}})}},{key:"scrollFun",value:function(){var e=this;$("#taskList .bottomNullAdd").on("scroll",function(){if(!b.ajaxPost){var t=$(this),a=t.height(),r=t[0].scrollHeight,s=t[0].scrollTop,i=parseInt(t.attr("data-page"),10);if(s+a+30>=r){if(i===0)return;var o=e.props.taskConfig,c=o.folderId,u=o.listSort,f=o.listStatus,h=o.completeTime,g=o.filterSettings,T=o.searchKeyWords,E=!1,C=y().filter(g.tags,function(N){return N!=="null"});y().findIndex(g.tags,function(N){return N==="null"})>=0&&(E=!0),b.ajaxPost=L.Z.getFolderTaskListByStageID({folderID:c,stageID:t.closest(".singleStage").data("stageid"),sort:u,status:f,completeTime:h,withoutTag:E,tagIDs:C,chargeIds:g.selectChargeIds,controlSelectedDic:e.returnCustomFilterArray(),pageIndex:i+1,pageSize:S.ZP.pageSize,filterType:g.folderSearchRange,keywords:T}),b.ajaxPost.then(function(N){if(N.status){b.ajaxPost=!1;var F=N.data;F.formatTaskTime=I.Mq,F.formatStatus=I.LR,F.returnCustonValue=I.B_;var x=ys().replace("#include.nodeLiComm",et()),A=Z().template(x)(F);t.find("ul .addNewTask").length?(t.find("ul .addNewTask").before(A),t.scrollTop(1e5)):t.find("ul").append(A),e.customScore(),e.renderChargeHeaderAvatar(),t.find(".singleTaskStage").length>=parseInt(t.parent().find(".taskCount").html(),10)?t.attr("data-page",0):t.attr("data-page",i+1)}else(0,I.N3)(N.error)})}}})}},{key:"canelCreateStageTask",value:function(e){e.find("li.addNewTask:last").hide(),e.find(".bottomNewBox").show(),e.find(".stageContentBox").removeClass("addNewTask")}},{key:"addStageToNext",value:function(e){$(".listStageDownOperator").hide(),$(".listStage .addNewStage").addClass("Hidden"),e.closest("li.singleStage").after(Z().template(Is())({})),$(".singleStage.taskStageAnimation").on("webkitAnimationEnd animationend",function(){$(this).removeClass("taskStageAnimation"),$(".singleStage .txtAddNew").focus(),b.isBlur=!1})}},{key:"delStage",value:function(e){if($("#taskList .listStage .singleStage").length===1){alert(_l("\u770B\u677F\u6700\u5C11\u5B58\u5728\u4E00\u4E2A"),3);return}var t=this.props.taskConfig.folderId;ie.Z.confirm({title:_l("\u786E\u8BA4\u5220\u9664\u6B64\u770B\u677F\u5417\uFF1F1"),closable:!1,okText:_l("\u5220\u9664"),onOk:function(){var r=e.data("stageid");L.Z.deleteFolderStage({folderID:t,stageID:r,newStageID:""}).then(function(s){if(s.status){alert(_l("\u5220\u9664\u6210\u529F"));var i=e.prev().length>0?e.prev():e.next();i.find(".listStageContent ul").append(e.find(".listStageContent li")),e.fadeOut(function(){$(this).remove()})}else(0,I.N3)(s.error)})}})}},{key:"updateStageName",value:function(e){var t=$.trim(e.val()),a=e.siblings(".listStageName"),r=$.trim(a.text()),s=function(){e.remove(),a.show(),a.closest(".singleStage").data("chargeid")&&a.siblings(".stageChargeAvatar").removeClass("Hidden"),a.siblings(".icon-arrow-down-border, .listStageTaskCount").show()};if($(".listStageDownOperator").hide(),!t||r===t)s();else{var i=this.props.taskConfig.folderId,o=e.closest("li.singleStage").data("stageid");L.Z.updateFolderStage({folderID:i,stageID:o,sort:0,stageName:t}).then(function(c){c.status?a.text(t):(0,I.N3)(c.error),s()})}}},{key:"draggableStage",value:function(e){b.pointGapY=b.pointInitY-e.offset().top,b.pointGapX=b.pointInitX-e.offset().left,b.pointInitX-=b.pointGapX,b.pointInitY-=b.pointGapY;var t=e.find(".stageContentBox"),a=t.height()+parseInt(t.css("border-top-width"),10)+parseInt(t.css("border-bottom-width"),10),r=0;$("#insertVirtualStage").length>0?e.before($("#insertVirtualStage")):e.before('<li id="insertVirtualStage" class="boderRadAll_3 singleStage" style="height:'+a+'px;"></li>'),b.$draggableObjMirror=e,$("body").append(b.$draggableObjMirror.addClass("draggableElementStage").css({left:b.pointInitX,top:b.pointInitY})),this.draggableStageMouseMove()}},{key:"draggableStageMouseMove",value:function(){var e=this;$(document).on({"mousemove.draggableStage":function(a){return b.globalEvent=a,e.insetVirtualElemByStage(),b.$draggableObjMirror.css({left:a.clientX-=b.pointGapX,top:a.clientY-=b.pointGapY}),e.moveStageScroll(),!1},"mouseup.draggableStage":function(){b.isDragEnd=!0,e.draggableStageMouseUp()}})}},{key:"insetVirtualElemByStage",value:function(){var e=b.globalEvent.clientY,t=b.globalEvent.clientX,a=$("#taskList .singleStage"),r=$("#taskList .listStage").offset(),s=null,i=void 0,o=void 0,c=void 0,u=0,f=void 0;e>r.top&&t>r.left&&a.each(function(){if(o=$(this),i=o.offset(),f=o.find(".stageContentBox "),u=f.height()+parseInt(f.css("border-top-width"),10)+parseInt(f.css("border-bottom-width"),10),t>i.left&&t<i.left+o.width()&&e<i.top+u)return o.offset().left-$(window).scrollLeft()+o.width()/2>t?o.before($("#insertVirtualStage").addClass("mRight5").removeClass("mLeft5")):o.after($("#insertVirtualStage").addClass("mLeft5").removeClass("mRight5")),!1})}},{key:"moveStageScroll",value:function(){var e=this,t=$("#taskList .listStage"),a=t.width(),r=$("#taskList .listStage > li").length*$("#taskList .listStage > li:first").width(),s=t.scrollLeft();if(!b.isDragEnd&&a<r){if(b.globalEvent.clientX<500){if(s<=0)return;t.is(":animated")||t.animate({scrollLeft:s-200},300,function(){e.moveStageScroll()})}else if(b.globalEvent.clientX>$(window).width()-300){var i=t.width(),o=t[0].scrollWidth,c=t[0].scrollLeft;c+i<o&&(t.is(":animated")||t.animate({scrollLeft:s+200},300,function(){e.moveStageScroll()}))}}}},{key:"draggableStageMouseUp",value:function(){$(document).off("mousemove.draggableStage"),$(document).off("mouseup.draggableStage"),$("#insertVirtualStage").hasClass("mLeft5")?b.$draggableObjMirror.removeClass("draggableElementStage").removeAttr("style").addClass("mLeft5"):b.$draggableObjMirror.removeClass("draggableElementStage").removeAttr("style").addClass("mRight5"),$("#insertVirtualStage").before(b.$draggableObjMirror),this.updateStageSort(b.$draggableObjMirror),$("#insertVirtualStage").remove(),$("html").removeClass("overflowHidden")}},{key:"updateStageSort",value:function(e){var t=e.data("stageid"),a=e.index();b.oldValue!=a&&(e.prevAll("ul").length<=0&&(a+=1),L.Z.updateFolderStage({folderID:this.props.taskConfig.folderId,stageID:t,sort:a,stageName:""}).then(function(r){r.status||($(".listStage .singleStage").eq(b.oldValue).before(e),(0,I.N3)(r.error))}))}},{key:"movePageScroll",value:function(e){var t=e.clientX-b.pointGapX,a=$("#taskList .listStage"),r=a.scrollLeft(),s=r-t;if(s<0)s=0;else{var i=a[0].scrollWidth,o=a.width();r+o>i&&(s=i-o)}$("#taskList .listStage").scrollLeft(s),b.pointGapX=e.clientX}},{key:"addNewStage",value:function(e){var t=this.props.taskConfig.folderId,a=e.closest("li.singleStage"),r=$.trim(e.val());L.Z.addFolderStage({folderID:t,stageName:r,sort:a.index()+1}).then(function(s){s.status?(e.remove(),a.attr("data-stageid",s.data).find(".stageHeader .listStageName").text(r).show(),a.find(".stageHeader .icon-arrow-down-border").show(),a.find(".btnBottomNew").removeClass("Hidden"),$(".listStage .singleStage").length===a.index()+1&&$("#taskList .listStage").scrollLeft(1e5)):(a.remove(),(0,I.N3)(s.error))})}},{key:"addNewTask",value:function(e){if(e.find(".stageContentBox .addNewTask").length)e.find(".stageContentBox .addNewTask").show(),e.find(".stageContentBox").addClass("addNewTask").scrollTop(1e5).next().hide(),e.find(".stageContentBox .teaStageName").height(80).val("").focus(),e.find(".stageContentBox .btnStagCreateTask").html(_l("\u786E\u8BA4"));else{var t=e.closest(".singleStage").data("chargeid"),a=e.closest(".singleStage").data("avatar");e.find(".stageContentBox").addClass("addNewTask").find("ul").append(Z().template(Ns())({accountId:t||md.global.Account.accountId,avatar:t?a:md.global.Account.avatar})).end().next().hide();var r=e.find(".stageDate"),s=function i(){var o=r.data(),c=o.start,u=o.end;se.render(n.createElement(ft.Z,{selectedValue:[c,u],mode:"task",timePicker:!0,separator:_l("\u81F3"),timeMode:"hour",placeholder:_l("\u672A\u6307\u5B9A\u8D77\u6B62\u65F6\u95F4"),onOk:function(h){var g=(0,ge.Z)(h,2),T=g[0],E=g[1];if(T&&E&&T>=E)return alert(_l("\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u65E9\u4E8E\u6216\u7B49\u4E8E\u5F00\u59CB\u65F6\u95F4"),2),!1;T=T?T.format("YYYY-MM-DD HH:00"):"",E=E?E.format("YYYY-MM-DD HH:00"):"",r.data("start",T),r.data("end",E)},onClear:function(){delete r.data().start,delete r.data().end,se.unmountComponentAtNode(r[0]),i()}},n.createElement("span",{class:"icon-bellSchedule"})),r[0])};s(),$(".addNewTask .teaStageName").autoTextarea({maxHeight:273,minHeight:73}),e.find(".stageContentBox").scrollTop(e.find(".listStageContent").height()).end().find(".teaStageName").focus()}}},{key:"draggableTask",value:function(e){b.pointGapY=b.pointInitY-e.offset().top,b.pointGapX=b.pointInitX-e.offset().left,b.pointInitX-=b.pointGapX,b.pointInitY-=b.pointGapY,$("#insertVirtual").length>0?e.before($("#insertVirtual")):e.before('<li id="insertVirtual" class="boderRadAll_3"></li>'),b.$draggableObjMirror=e,$("body").append(b.$draggableObjMirror.addClass("draggableElement").css({left:b.pointInitX,top:b.pointInitY})),this.draggableTaskMouseMove()}},{key:"draggableTaskMouseMove",value:function(){var e=this;$(document).on({"mousemove.draggableTask":function(a){return b.globalEvent=a,e.insetVirtualElemByTask(),b.$draggableObjMirror.css({left:a.clientX-=b.pointGapX,top:a.clientY-=b.pointGapY}),e.moveStageScroll(),!1},"mouseup.draggableTask":function(){e.draggableTaskMouseUp()}}),$(document).on("mousemove.draggableTask").on()}},{key:"insetVirtualElemByTask",value:function(){var e=this,t=null,a=b.globalEvent.clientY,r=b.globalEvent.clientX,s=$("#taskList .singleStage"),i=(s.first()||{}).top||0,o=0,c=0,u=null,f=void 0,h=void 0,g=void 0,T=5,E=0,C=void 0,N=!1,F=0,x=0,A=0,H=0;a>i&&s.each(function(){if(h=$(this),f=h.offset(),N)return!1;C=h.find(".stageContentBox "),E=C.height()+parseInt(C.css("border-top-width"),10)+parseInt(C.css("border-bottom-width"),10),r>f.left&&r<f.left+h.width()&&a<f.top+E&&(e.moveTaskScroll(C),N=!0,h.find(".stageContentBox li").each(function(){if(g=$(this),a>g.offset().top&&a<g.offset().top+g.height()+T)return t=g,t.is("#insertVirtual")||(t.offset().top-$(window).scrollTop()+t.height()/2>a?t.before($("#insertVirtual")):t.after($("#insertVirtual"))),!1}),t==null&&(h.find(".stageContentBox li:not(.addNewTask)").length||h.find(".stageContentBox ul").append($("#insertVirtual"))))})}},{key:"moveTaskScroll",value:function(e){var t=this,a=b.globalEvent.clientY,r=b.globalEvent.clientX,s=e.closest("li.singleStage"),i=s.offset(),o=e.height()+parseInt(e.css("border-top-width"),10)+parseInt(e.css("border-bottom-width"),10),c=0;if(!b.isDragEnd&&r>i.left&&r<i.left+s.width()&&a<i.top+o&&e.height()<e.find("ul").height()){if(c=e.scrollTop(),a<i.top+85)c>0&&(e.is(":animated")||e.animate({scrollTop:c-150},300,function(){t.moveTaskScroll(e)}));else if(a>i.top+o-85){var u=e.height(),f=e[0].scrollHeight,h=e[0].scrollTop;h+u<f&&(e.is(":animated")||e.animate({scrollTop:c+150},300,function(){t.moveTaskScroll(e)}))}}}},{key:"draggableTaskMouseUp",value:function(){b.isDragEnd=!0,$(document).off("mousemove.draggableTask"),$(document).off("mouseup.draggableTask"),$("#insertVirtual").before(b.$draggableObjMirror.removeClass("draggableElement")),$("#insertVirtual").remove(),this.updateTaskStage(b.$draggableObjMirror.css({top:"0px",left:"0px"}))}},{key:"updateTaskStage",value:function(e){var t=e.data("taskid"),a=e.closest("li.singleStage").data("stageid");a!=b.oldValue&&L.Z.updateTaskStageID({taskID:t,stageID:a}).then(function(r){r.status?($(".listStageContent ul li[data-taskid='"+t+"']").data("stageid",a),r.data.accountID&&e.find(".chargeHeaderAvatar").data("src",r.data.avatar).attr("data-id",r.data.accountID).data("id",r.data.accountID).data("hasbusinesscard",!1)):($(".singleStage[data-stageid='"+b.oldValue+"']").find(".listStageContent ul").prepend(e),(0,I.N3)(r.error))})}},{key:"addStageCharge",value:function(e,t){var a=this,r=e.data("chargeid"),s=function(o){a.setStageOwner(e,o[0].accountId,o[0].avatar)};(0,Oe.ZP)(t[0],{sourceId:this.props.taskConfig.folderId,showMoreInvite:!1,fromType:2,filterAccountIds:[r],includeUndefinedAndMySelf:!0,SelectUserSettings:{filterAccountIds:[r],projectId:(0,I.Ie)(this.props.taskConfig.projectId)?this.props.taskConfig.projectId:"",unique:!0,callback:s},selectCb:s})}},{key:"setStageOwner",value:function(e){var t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";L.Z.setStageOwner({folderID:this.props.taskConfig.folderId,stageID:e.data("stageid"),ownerId:a}).then(function(s){s.status?(e.data("chargeid",a).data("avatar",r),e.find(".stageChargeAvatar").toggleClass("Hidden",!a).data("src",r).data("hasbusinesscard",!1),t.renderStageChargeUser()):(0,I.N3)(s.error)})}},{key:"addNewTaskEnter",value:function(e,t){var a=this,r=e.parent(),s=$.trim(r.find(".teaStageName").val());if(!s){alert(_l("\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"),3),r.find(".btnStagCreateTask ").data("create",0).text(_l("\u786E\u8BA4"));return}var i=void 0;t&&(i=e.closest(".singleStage").find(".btnBottomNew"));var o=e.closest("li.singleStage").data("stageid"),c=e.siblings(".stageDate").data("start"),u=e.siblings(".stageDate").data("end"),f=e.siblings(".chargeHeaderAvatar").attr("data-id"),h=r.find(".taskStar").hasClass("icon-task-star");r.find(".teaStageName").val(""),L.Z.addTask({taskName:s,stageID:o,summary:"",folderID:this.props.taskConfig.folderId,chargeAccountID:f,members:"",startTime:c,deadline:u,parentID:"",groupIDstr:"",postID:"",projectId:this.props.taskConfig.projectId,star:h,attachments:null,color:0}).then(function(g){g.status?(g.data.taskName=g.data.name,g.data.star=h,g.data.stageID=o,g.data.actualStartTime="",g.data.completeTime="",a.quickCreateTaskCallback(g,i)):(0,I.N3)(g.error)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.openTaskDetail,r=t.taskId,s=t.isForceUpdate;return n.createElement(n.Fragment,null,n.createElement("div",{id:"taskList"}),n.createElement(be.Z,{visible:a,taskId:r,isForceUpdate:s,closeForceUpdate:function(){return e.setState({isForceUpdate:!1})},openType:1,closeCallback:function(){return e.setState({taskId:""})},animationEndRemoveDetail:function(){return e.mounted&&e.setState({openTaskDetail:!1})}}))}}]),d}(n.Component);const bs=(0,re.$j)(function(v){return v.task})(Ds);var ws=k(63239),Zt=k.n(ws),Fs=k(95283),xs=k(66344),pe={dialog:'<ul id="attachmentOperation" class="boxShadow5"><li data-type="share" class="ThemeBGColor3">'+_l("\u5206\u4EAB")+'</li><li data-type="download" class="ThemeBGColor3">'+_l("\u4E0B\u8F7D")+"</li></ul>",itemData:null,ajaxPost:!1},Ls=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.switch=function(){var t=e.props.taskConfig.attachmentViewType,a=t===1?2:1,r=ee()({},e.props.taskConfig,{attachmentViewType:a});(0,I.yM)("",r),e.props.dispatch((0,B.Hl)(a))},e.state={pageIndex:1,isMore:!0,isFirstPostComplete:!0,dataSource:[],openTaskDetail:!1,taskId:""},e}return(0,R.default)(d,[{key:"componentWillMount",value:function(){this.getFolderFiles()}},{key:"componentDidMount",value:function(){var e=this,t=$("#taskList");t.on("click",".taskAttachmentListBox .attachmentListOperation, .taskThumbnail .taskThumbnailOperation",function(a){var r=$(this);if(r.hasClass("operationActive"))return r.removeClass("operationActive"),$("#attachmentOperation").addClass("Hidden"),!1;$(".operationActive").removeClass("operationActive");var s=r.offset().left,i=r.offset().top;i=i+100>$(window).height()?i-75:i+25,s=s+105>$(window).width()?s-90:s-20,r.addClass("operationActive"),pe.itemData=r.data("source"),$("#attachmentOperation").length>0?$("#attachmentOperation").removeClass("Hidden"):$("body").append(pe.dialog),$("#attachmentOperation").css({left:s,top:i}),a.stopPropagation()}),$("body").on("click.taskAttchment","#attachmentOperation li",function(){if($(this).attr("data-type")==="download")pe.itemData.allowDown==="ok"&&pe.itemData.downloadUrl?window.open((0,oe.Sv)(pe.itemData.downloadUrl)):alert(_l("\u60A8\u6743\u9650\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u4E0B\u8F7D\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6216\u6587\u4EF6\u4E0A\u4F20\u8005"),3);else{var a=pe.itemData;k.e(1050).then(k.bind(k,51050)).then(function(r){r.default({attachmentType:a.refId?2:1,id:a.refId?a.refId:a.fileID,name:a.originalFilename,ext:a.ext.replace(".",""),size:a.filesize,imgSrc:a.attachmentType===1?a.middlePath+a.middleName.split("?")[0]:""})})}$(this).parent().addClass("Hidden"),$(".operationActive").removeClass("operationActive")}),$(document).on("click",function(a){var r=$(a.target),s=$("#attachmentOperation");s.length&&s.is(":visible")&&!r.closest("#attachmentOperation").length&&!r.is($(".operationActive"))&&(s.addClass("Hidden"),$(".operationActive").removeClass("operationActive"))})}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.taskConfig.folderId&&e.taskConfig.folderId!==this.props.taskConfig.folderId&&this.setState({pageIndex:1,isFirstPostComplete:!0,dataSource:[]},function(){t.getFolderFiles()})}},{key:"componentDidUpdate",value:function(){var e=this,t=$("#taskAttachmentList .taskAttachmentListBox").height(),a=$("#taskAttachmentList .taskAttachmentListBox ul").height(),r=0;t<a&&(r=window.isChrome?10:17),$("#taskAttachmentList .attachmentheader").css("marginRight",r),$("#taskList").find(".taskAttachmentScroll").on("scroll",function(s){if(!pe.ajaxPost&&e.state.isMore){var i=$(this),o=i.height(),c=i.scrollTop(),u=i.children()[0].scrollHeight;if(c+o+30>=u){$("#attachmentLoading").removeClass("Hidden");var f=e.state.pageIndex+1;e.setState({pageIndex:f},function(){e.getFolderFiles()})}}})}},{key:"componentWillUnmount",value:function(){$("body").off(".taskAttchment")}},{key:"getFolderFiles",value:function(){var e=this;if(!pe.ajaxPost){pe.ajaxPost=!0;var t=this.props.taskConfig,a=t.folderId,r=t.viewType;L.Z.getFolderFiles({folderID:a,pageIndex:this.state.pageIndex,pageSize:S.ZP.pageSize}).then(function(s){if(s.status){if(pe.ajaxPost=!1,r!==S.ZP.folderViewType.attachment)return;e.setState({dataSource:$.merge(e.state.dataSource,s.data||[]),isFirstPostComplete:!1,isMore:s.data?s.data.length>=S.ZP.pageSize:!1}),$("#attachmentLoading").addClass("Hidden")}else(0,I.N3)(s.error)})}}},{key:"openDetail",value:function(e,t){e.isFolder||(this.setState({openTaskDetail:!0,taskId:e.sourceID}),t.stopPropagation())}},{key:"renderNoData",value:function(){var e=this.state.isFirstPostComplete;return e?n.createElement(ve.Z,null):n.createElement("div",{className:"listCreateNew boderRadAll_3 boxShadow5 relative"},n.createElement("div",{className:"attachmentNoData Font14"},n.createElement("div",{className:"attachmentNoDataBG"}),n.createElement("span",{className:"Font17"},_l("\u6682\u65E0\u9879\u76EE\u6587\u4EF6")),n.createElement("br",null),_l("\u5F53\u524D\u9879\u76EE\u53CA\u5176\u4EFB\u52A1\u4E0B\u7684\u6240\u6709\u6587\u4EF6\u90FD\u5C06\u6C47\u805A\u5728\u8FD9\u91CC")),n.createElement("div",{className:"ThemeBG taskGroundGlass"}))}},{key:"renderList",value:function(){var e=this,t=this.state.dataSource,a=function(s,i){var o=(0,oe.kQ)(s.ext);return n.createElement("li",{className:"flexRow",key:i,onClick:e.showDetail.bind(e,s)},n.createElement("span",{className:"attachmentName flex relative"},n.createElement("div",{className:"attachmentNameBox flexRow"},n.createElement("span",{className:"attachmentImg"},o.indexOf("img")>=0&&!(s.refId&&!s.shareUrl)?n.createElement("img",{src:s.previewUrl.replace("imageView2/1/w/200/h/140","imageView2/1/w/32/h/32")}):n.createElement("span",{className:w()("attachmentType",s.attachmentType===5?"fileIcon-folder":o)})),n.createElement("span",{className:"overflow_ellipsis"},s.originalFilename),n.createElement("span",{className:"flex attachmentExt overflow_ellipsis"},s.ext))),n.createElement("span",{className:w()("attachmentTask ThemeColor3 overflow_ellipsis attachmentTaskName",{pointer:!s.isFolder}),onClick:e.openDetail.bind(e,s)},s.isFolder?"-":s.taskName),n.createElement("span",{className:"attachmentDate"},createTimeSpan(s.createTime)),n.createElement("span",{className:"attachmentPerson"},n.createElement("img",{src:s.createUserAvatar,className:"taskFolderAvatar pointer","data-accountid":s.accountId}),n.createElement("span",{className:"icon-task-point-more attachmentListOperation Font16 ThemeColor3","data-source":Zt()(s)})))};return n.createElement("div",{id:"taskAttachmentList",className:"taskAttachmentList boderRadAll_3"},n.createElement("div",{className:"attachmentheader flexRow"},n.createElement("span",{className:"attachmentName flex"},_l("\u540D\u79F0")),n.createElement("span",{className:"attachmentTask"},_l("\u6240\u5C5E\u4EFB\u52A1")),n.createElement("span",{className:"attachmentDate"},_l("\u4E0A\u4F20\u65E5\u671F")),n.createElement("span",{className:"attachmentPerson"},_l("\u4E0A\u4F20\u8005"))),n.createElement("div",{className:"taskAttachmentListBox boxSizing taskAttachmentScroll"},n.createElement("ul",null,t.map(function(r,s){return a(r,s)})),n.createElement("div",{id:"attachmentLoading",className:"Hidden"},n.createElement(ve.Z,null))))}},{key:"renderThumbnail",value:function(){var e=this,t=this.state.dataSource,a=function(s,i){var o=(0,oe.kQ)(s.ext);return n.createElement("li",{className:"boxSizing",onClick:e.showDetail.bind(e,s),key:i},n.createElement("div",{className:"taskThumbnailBox boxSizing boderRadAll_3 animatedFast"},n.createElement("div",{className:"taskThumbnailImg"},o.indexOf("img")>=0&&!(s.refId&&!s.shareUrl)||xs.Z.isVideo(s.ext)&&s.previewUrl?n.createElement("img",{src:s.previewUrl}):n.createElement("span",{className:w()("attachmentType antiIcon",s.attachmentType===5?"fileIcon-folder":o)})),n.createElement("div",{className:"taskThumbnailContent boxSizing"},n.createElement("img",{src:s.createUserAvatar,className:"taskFolderAvatar pointer","data-accountid":s.accountId}),n.createElement("div",{className:"taskThumbnailTitle"},n.createElement("span",{className:"overflow_ellipsis"},s.originalFilename),n.createElement("span",{className:"taskSuffix overflow_ellipsis"},s.ext)),n.createElement("div",{className:w()("taskThumbnailName overflow_ellipsis ThemeColor3 attachmentTaskName",{pointer:!s.isFolder}),onClick:e.openDetail.bind(e,s)},s.isFolder?"-":s.taskName),n.createElement("span",{className:"icon-task-point-more taskThumbnailOperation Font16 ThemeColor3","data-source":Zt()(s)}))))};return n.createElement("ul",{id:"taskThumbnail",className:"taskThumbnail taskAttachmentScroll"},t.map(function(r,s){return a(r,s)}),n.createElement("div",{id:"attachmentLoading",className:"Hidden"},n.createElement(ve.Z,null)))}},{key:"showDetail",value:function(e){e.attachmentType===5?window.open(e.shareUrl):e.refId&&!e.shareUrl?alert(_l("\u5DF2\u7ECF\u5220\u9664\u6216\u65E0\u6743\u67E5\u770B"),2):(0,Fs.Z)({attachments:[e],callFrom:"player",sourceID:e.sourceID,commentID:e.commentID,fromType:e.fromType,fileID:e.fileID,hideFunctions:["editFileName"]},{postDetails:null,openCallback:function(){$(".btnAttNameEdit,.ctrlHistory,.ctrlNewVersion,.ctrlDelete").remove()}})}},{key:"render",value:function(){var e=this,t=this.props.taskConfig.attachmentViewType,a=this.state,r=a.dataSource,s=a.openTaskDetail,i=a.taskId;return n.createElement("div",{id:"taskList",className:"flexColumn attachmentBox"},n.createElement("div",{className:"attachmentBar boxSizing"},n.createElement("span",{className:"switchView ThemeColor3"},n.createElement("i",{className:w()("switchViewBtn pointer",t===1?"icon-home-navigation":"icon-task-list"),onClick:this.switch}))),n.createElement("div",{className:"flex attachmentMain"},r.length?t===1?this.renderList():this.renderThumbnail():this.renderNoData()),n.createElement(be.Z,{visible:s,taskId:i,openType:3,closeCallback:function(){return e.setState({openTaskDetail:!1})}}))}}]),d}(n.Component);const Ms=(0,re.$j)(function(v){return v.task})(Ls);var As=k(26378),ae=k.n(As);const Se={getFolderStatisticsNow:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetFolderStatisticsNow",d,l)},getDailyFolderStatistics:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetDailyFolderStatistics",d,l)},getFolderControlsPieChart:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetFolderControlsPieChart",d,l)},getFolderControlsBarChart:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetFolderControlsBarChart",d,l)},getTaskCharges:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetTaskCharges",d,l)},getSubordinate:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetSubordinate",d,l)},getTaskChargeStatistics:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetTaskChargeStatistics",d,l)},getFolderStageStatistics:function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return mdyAPI("TaskFolderStatistics","GetFolderStageStatistics",d,l)}};var $s=k(68924),Pe=k.n($s),Bs=k(25454),Vt=k.n(Bs),_s=k(12533),Hs=k.n(_s),Ps=k(81209),Us=k.n(Ps),Ys=k(8929),Os=k.n(Ys),Kt=k(80955),D={type:1,startDate:"",endDate:"",chartView:"",data:"",isAuto:!0,chargeAccountIDs:[],sort:"desc"},Xt=se.render,zt=se.unmountComponentAtNode,js=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=this;Promise.all([k.e(9704),k.e(2122),k.e(1119)]).then(k.bind(k,1119)).then(function(t){e.Column=t.Column,e.Pie=t.Pie,e.init(),e.bindEvents()})}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.taskConfig.folderId&&e.taskConfig.folderId!==this.props.taskConfig.folderId&&setTimeout(function(){t.init()},0)}},{key:"componentWillUnmount",value:function(){delete window.feedSelectDate,delete window.feedCustomDate,zt(document.querySelector(".folderChartTime"))}},{key:"init",value:function(){var e=this;(0,te.a0)(1),D.type=1,D.data="",D.startDate=p()().subtract(6,"d").format("YYYY-MM-DD"),D.endDate=p()().format("YYYY-MM-DD"),D.isAuto=!0,D.chargeAccountIDs=[],D.sort="desc";var t=this.props.taskConfig,a=t.folderId,r=t.viewType;Se.getFolderStatisticsNow({folderID:a}).then(function(s){r===S.ZP.folderViewType.folderChart&&($("#taskList").html(Z().template(Vt())({isFirst:!0,type:D.type,data:s.data,timeTxt:p()().subtract(6,"d").format("YYYY/MM/DD")+" - "+p()().format("YYYY/MM/DD")})),e.getDailyFolderStatistics(),e.renderCustomTime())})}},{key:"bindEvents",value:function(){var e=this;$("body").off(".folderChart"),$("#taskList").on({mouseover:function(){$(this).addClass("ThemeColor3 ThemeBorderColor3")},mouseout:function(){$(this).removeClass("ThemeColor3 ThemeBorderColor3")},click:function(){var a=$(".folderChartNavBox .folderChartTime"),r=$(".folderChartNavBox .folderChartChargeBox");$(this).addClass("active ThemeColor3 ThemeBorderColor3").siblings().removeClass(),D.type=$(this).index()+1,$("#taskList .folderChartBox").html(Z().template(Vt())({type:D.type})),D.type===1?(a.removeClass("Hidden"),r.addClass("Hidden"),e.getDailyFolderStatistics()):D.type===2?(a.addClass("Hidden"),r.removeClass("Hidden"),e.getTaskChargeStatistics()):D.type===3?(a.add(r).addClass("Hidden"),e.getFolderStageStatistics()):D.type===4&&(a.removeClass("Hidden"),r.addClass("Hidden"),e.getCustomData())}},".folderChartNavBox .folderChartNav li:not(.active)"),$("body").on("click.folderChart",".folderChartTime li:not(.activeClass):not([data-type=custom])",function(){var t=$(this).data("type"),a=$(this).closest(".folderChartMaxView").length,r=a?$(".folderChartMaxView .folderChartTime li[data-type=custom]"):$(".folderChartNavBox .folderChartTime li[data-type=custom]");$(this).addClass("activeClass ThemeBorderColor3 ThemeBGColor3").siblings("li").removeClass(),$(this).siblings(".folderChartTimeTxt").html(p()().subtract(t,"d").format("YYYY/MM/DD")+" - "+p()().format("YYYY/MM/DD")),e.updateTimeRefreshChart(a,p()().subtract(t,"d").format("YYYY-MM-DD"),p()().format("YYYY-MM-DD"))}),$("body").on("click.folderChart",".folderChartChargeSort",function(){$(this).toggleClass("icon-descending-order icon-ascending-order");var t=$(this).closest(".folderChartMaxView").length;e.updateSortRefreshChart(t)}),$("body").on("click.folderChart",".folderChartChargeBtn",function(){var t=$(this).siblings(".folderChartChargeList");t.length?(t.toggleClass("Hidden"),t.hasClass("Hidden")||e.updateChargeSelect()):e.getTaskCharges()}),$("body").on("click.folderChart",".folderChartSelectAll",function(){$(this).toggleClass("ThemeBorderColor3 ThemeBGColor3"),$(this).hasClass("ThemeBGColor3")?$(this).closest(".folderChartChargeList").find(".folderChartSelect").addClass("ThemeBorderColor3 ThemeBGColor3"):$(this).closest(".folderChartChargeList").find(".folderChartSelect").removeClass("ThemeBorderColor3 ThemeBGColor3")}),$("body").on("click.folderChart",".folderChartChargeLists .folderChartSelectBtn",function(){$(this).toggleClass("ThemeBorderColor3 ThemeBGColor3");var t=$(this).closest(".folderChartChargeList");t.find(".folderChartChargeLists .ThemeBGColor3").length===t.find(".folderChartChargeLists li").length?t.find(".folderChartSelectAll").addClass("ThemeBorderColor3 ThemeBGColor3"):t.find(".folderChartSelectAll").removeClass("ThemeBorderColor3 ThemeBGColor3")}),$("body").on("click.folderChart",".folderChartChargeNo",function(){e.updateChargeSelect()}),$("body").on("click.folderChart",".folderChartChargeYes",function(){var t=$(this).closest(".folderChartChargeList"),a=!1,r=[],s=$(this).closest(".folderChartMaxView").length;if(!t.find(".folderChartSelect.ThemeBGColor3").length)return alert(_l("\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA!"),3),!1;t.addClass("Hidden"),t.find(".folderChartSelectAll.ThemeBGColor3").length?a=!0:t.find(".folderChartSelect.ThemeBGColor3").each(function(o,c){r.push($(c).attr("data-id"))});var i=a?_l("\u6240\u6709\u8D1F\u8D23\u4EBA"):_l("\u5DF2\u9009\u62E9%0\u4EBA",r.length);s?$(".folderChartMaxView .folderChartChargeTxt").html(i):$(".folderChartNavBox .folderChartChargeTxt").html(i),e.updateChargeRefreshChart(a,r,s)}),$("#taskList").on("click",".folderChartModel",function(){var t=$(this).siblings(".folderChartBoxTitle"),a=t.text(),r=t.find("span:last").attr("data-tip"),s=$("#taskList").find(".folderChartTimeTxt").html(),i=$("#taskList").find(".activeClass").index()-1;D.maxSort=D.sort,D.chartView=D.type===4?$(this).data("id"):parseInt($(this).attr("id").replace(/\D/g,""),10),D.isAutoMax=D.isAuto,D.chargeAccountIDsMax=D.chargeAccountIDs,e.folderChartMaxView({title:a,tipTitle:r,activeTime:s,activeBtn:i,type:D.type,sort:D.sort,isAuto:D.isAuto,chargeAccountIDs:D.chargeAccountIDs,listSize:D.data.length})}),$(window).on("resize",function(){e.props.taskConfig.viewType===S.ZP.folderViewType.folderChart&&e.updateCharts()}),$(document).on("click.folderChart",function(t){var a=$(t.target);!a.is($(".folderChartChargeBtn"))&&!a.parent().is($(".folderChartChargeBtn"))&&!a.closest(".folderChartChargeList").length&&$(".folderChartChargeList").addClass("Hidden")})}},{key:"componentWillUnmount",value:function(){$("body").off(".folderChart")}},{key:"getDailyFolderStatistics",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.startDate,t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.endDate,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=this.props.taskConfig.folderId;Se.getDailyFolderStatistics({folderID:s,startDate:e,endDate:a}).then(function(i){r?t["folderCharts"+D.chartView]("folderChartsMax",i.data):(D.data=i.data,t.updateCharts())})}},{key:"getTaskChargeStatistics",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.isAuto,t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.chargeAccountIDs,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=this.props.taskConfig.folderId;Se.getTaskChargeStatistics({folderID:s,isAuto:e,chargeAccountIDs:a}).then(function(i){r?t["folderCharts"+D.chartView]("folderChartsMax",i.data):(D.data=i.data,t.updateCharts())})}},{key:"getFolderStageStatistics",value:function(){var e=this,t=this.props.taskConfig.folderId;Se.getFolderStageStatistics({folderID:t}).then(function(a){D.data=a.data,e.updateCharts()})}},{key:"getTaskCharges",value:function(){var e=this,t=this.props.taskConfig.folderId;Se.getTaskCharges({folderID:t}).then(function(a){if(a.data){var r=Z().template(Us())(a.data);$(".folderChartMaxView").length?$(".folderChartMaxView .folderChartChargeBox").append(r):$(".folderChartNavBox .folderChartChargeBox").append(r),e.updateChargeSelect()}})}},{key:"getCustomData",value:function(){var e=this,t=this.props.taskConfig.folderId,a=Se.getFolderControlsPieChart({folderID:t}),r=Se.getFolderControlsBarChart({folderID:t,startDate:D.startDate,endDate:D.endDate});Rt().all([a,r]).then(function(s){var i=(0,ge.Z)(s,2),o=i[0],c=i[1];o.code===1&&c.code===1&&(D.data=o.data.concat(c.data),D.data.sort(function(u,f){return u.row*1e3+u.col>f.row*1e3+f.col?1:-1}),$("#taskList .folderChartBox").html(Z().template(Os())(D.data)),e.updateCharts())})}},{key:"getFolderControlsBarChart",value:function(e,t){var a=this,r=this.props.taskConfig.folderId;Se.getFolderControlsBarChart({folderID:r,startDate:e,endDate:t}).then(function(s){s.code===1&&a.folderChartsBar("folderChartsMax",y().find(s.data,function(i){var o=i.controlId;return o===D.chartView}))})}},{key:"folderChartMaxView",value:function(e){var t=Z().template(Hs())(e);if(ie.Z.confirm({dialogClasses:"folderChartMaxView",noFooter:!0,width:860,children:n.createElement("div",{dangerouslySetInnerHTML:{__html:t}}),handleClose:function(){zt(document.querySelector("#maxViewUpdateTime")),$(".folderChartMaxView").parent().remove()}}),D.type===4){var a=$(".folderChartModel[data-id="+D.chartView+"]").data("type"),r=y().find(D.data,function(i){var o=i.controlId;return o===D.chartView});a===9||a===10||a===11?($("#maxViewUpdateTime").addClass("Hidden"),this.folderChartsPie("folderChartsMax",r)):($("#maxViewUpdateTime").removeClass("Hidden"),this.folderChartsBar("folderChartsMax",r))}else{var s=Math.floor((D.endDate-D.startDate)/24/3600/1e3);this.renderMaxCustomTime(),this["folderCharts"+D.chartView]("folderChartsMax")}}},{key:"folderCharts1",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts1",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD"+(t.length===7?" ddd":""));a.push({date:f,name:_l("\u672A\u5B8C\u6210"),value:u.underway}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.completed})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts2",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts2",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u6B63\u5E38"),value:u.underway_N}),a.push({date:f,name:_l("\u903E\u671F"),value:u.underway_A}),a.push({date:f,name:_l("\u672A\u8BBE\u7F6E"),value:u.underway_U})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts3",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts3",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u6B63\u5E38"),value:u.completed_N}),a.push({date:f,name:_l("\u903E\u671F"),value:u.completed_A}),a.push({date:f,name:_l("\u672A\u8BBE\u7F6E"),value:u.completed_U})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts4",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts4",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u603B\u65F6\u95F4"),value:u.timespan}),a.push({date:f,name:_l("\u672A\u5B8C\u6210"),value:u.timespan_Und}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.timespan_Com})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts5",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts5",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD"+(t.length===7?" ddd":""));a.push({date:f,name:_l("\u65B0\u589E"),value:u.newTasks}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.completedTasks})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts6",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts6",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u4EBA\u6570"),value:u.memberAmount})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts13",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts13",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u6240\u6709\u672A\u5B8C\u6210\u4EFB\u52A1\u7684\u603B\u5269\u4F59\u65F6\u95F4"),value:u.timespan_BurnDown})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts14",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts14",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u672A\u5F00\u59CB"),value:u.notStarted}),a.push({date:f,name:_l("\u5EF6\u671F\u672A\u5F00\u59CB"),value:u.notStarted_A})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts15",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts15",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data,a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD");a.push({date:f,name:_l("\u672A\u8BBE\u7F6E"),value:u.going_U}),a.push({date:f,name:_l("\u6B63\u5E38"),value:u.going-u.going_U-u.going_A}),a.push({date:f,name:_l("\u903E\u671F"),value:u.going_A})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts7",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts7",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data;t=this.dataDisposeFun(this.dataSortFun("amount",t));var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=Pe()(u.fullName).substr(0,10);a.push({date:f,name:_l("\u672A\u5B8C\u6210"),value:u.underway}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.completed})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts8",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts8",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data;t=this.dataDisposeFun(this.dataSortFun("completed_N",t));var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=Pe()(u.fullName).substr(0,10);a.push({date:f,name:_l("\u6309\u65F6\u5B8C\u6210\u4EFB\u52A1\u6570"),value:u.completed_N})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts9",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts9",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data;t=this.dataDisposeFun(this.dataSortFun("underway_A",t));var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=Pe()(u.fullName).substr(0,10);a.push({date:f,name:_l("\u672A\u5B8C\u6210"),value:u.underway_A}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.completed_A})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts10",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts10",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data;t=this.dataDisposeFun(this.dataSortFun("timespan_Und",t));var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=Pe()(u.fullName).substr(0,10);a.push({date:f,name:_l("\u672A\u5B8C\u6210"),value:this.updateChartTime(u.timespan_Und)}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:this.updateChartTime(u.timespan_Com)})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts11",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts11",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.data;t=this.dataDisposeFun(this.dataSortFun("completedTimeAvg",t));var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=Pe()(u.fullName).substr(0,10);a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:this.updateChartTime(u.completedTimeAvg)})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderCharts12",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"folderCharts12",t=[],a=!0,r=!1,s=void 0;try{for(var i=ae()(D.data.stages),o;!(a=(o=i.next()).done);a=!0){var c=o.value,u=c.stageName;t.push({date:u,name:_l("\u5DF2\u5B8C\u6210"),value:c.sUnderway}),t.push({date:u,name:_l("\u5DF2\u5B8C\u6210"),value:c.sCompleted})}}catch(h){r=!0,s=h}finally{try{!a&&i.return&&i.return()}finally{if(r)throw s}}var f={label:{position:"middle",layout:[]},data:t,isGroup:!1,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],f).render()}},{key:"folderChartsPie",value:function(e,t){var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t.options),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=u.name.length>6&&e!=="folderChartsMax"?u.name.substring(0,5)+"...":u.name,h=u.count;a.push({name:f,count:h})}}catch(T){s=!0,i=T}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var g={appendPadding:10,data:a,angleField:"count",colorField:"type",radius:.9};$("#"+e).empty(),new this.Pie($("#"+e)[0],g).render()}},{key:"folderChartsBar",value:function(e,t){var a=[],r=!0,s=!1,i=void 0;try{for(var o=ae()(t.dailyStatistics),c;!(r=(c=o.next()).done);r=!0){var u=c.value,f=p()(u.date).format("MM/DD"+(t.length===7?" ddd":""));a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.underway_Sum}),a.push({date:f,name:_l("\u5DF2\u5B8C\u6210"),value:u.completed_Sum})}}catch(g){s=!0,i=g}finally{try{!r&&o.return&&o.return()}finally{if(s)throw i}}var h={label:{position:"middle",layout:[]},data:a,isGroup:!0,xField:"name",yField:"value",seriesField:"name"};$("#"+e).empty(),new this.Column($("#"+e)[0],h).render()}},{key:"folderChartsCustom",value:function(){var e=this;$(".folderChartBoxModel .folderChartModel[data-model=custom]").map(function(t,a){var r=$(a).data("id"),s=$(a).data("type"),i=y().find(D.data,function(o){var c=o.controlId;return c===r});s===9||s===10||s===11?e.folderChartsPie("folderCharts_"+r,i):e.folderChartsBar("folderCharts_"+r,i)})}},{key:"updateCharts",value:function(){this.props.taskConfig.viewType===S.ZP.folderViewType.folderChart&&(D.type===1?(this.folderCharts1(),this.folderCharts2(),this.folderCharts3(),this.folderCharts4(),this.folderCharts5(),this.folderCharts6(),this.folderCharts13(),this.folderCharts14(),this.folderCharts15()):D.type===2?(this.folderCharts7(),this.folderCharts8(),this.folderCharts9(),this.folderCharts10(),this.folderCharts11()):D.type===3?this.folderCharts12():D.type===4&&this.folderChartsCustom())}},{key:"updateTimeRefreshChart",value:function(e,t,a){e?D.type===1?this.getDailyFolderStatistics(t,a,e):D.type===4&&this.getFolderControlsBarChart(t,a):(D.startDate=t,D.endDate=a,D.type===1?this.getDailyFolderStatistics():D.type===4&&this.getCustomData())}},{key:"updateSortRefreshChart",value:function(e){e?(D.maxSort=D.maxSort==="desc"?"asc":"desc",this["folderCharts"+D.chartView]("folderChartsMax")):(D.sort=D.sort==="desc"?"asc":"desc",this.updateCharts())}},{key:"updateChargeRefreshChart",value:function(e,t,a){a?(D.isAutoMax=e,D.chargeAccountIDsMax=t,this.getTaskChargeStatistics(e,t,a)):(D.isAuto=e,D.chargeAccountIDs=t,this.getTaskChargeStatistics())}},{key:"dataDisposeFun",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return e.length<=t||$(".folderChartMaxView").length?e:e.slice(e.length-t)}},{key:"dataSortFun",value:function(e,t){var a=function(){return t.sort(function(i,o){return i[e]>o[e]?1:-1})},r=function(){return t.sort(function(i,o){return i[e]>o[e]?-1:1})};if($(".folderChartMaxView").length){if(D.maxSort==="desc")return a();if(D.maxSort==="asc")return r()}if(D.sort==="desc")return a();if(D.sort==="asc")return r()}},{key:"updateChargeSelect",value:function(){var e=$(".folderChartMaxView").length,t=void 0;if(e){if($(".folderChartMaxView .folderChartSelect").toggleClass("ThemeBorderColor3 ThemeBGColor3",D.isAutoMax),!D.isAutoMax){var a=!0,r=!1,s=void 0;try{for(var i=ae()(D.chargeAccountIDsMax),o;!(a=(o=i.next()).done);a=!0)t=o.value,$(".folderChartMaxView .folderChartSelect[data-id="+t+"]").addClass("ThemeBorderColor3 ThemeBGColor3")}catch(T){r=!0,s=T}finally{try{!a&&i.return&&i.return()}finally{if(r)throw s}}}}else if($(".folderChartNavBox .folderChartSelect").toggleClass("ThemeBorderColor3 ThemeBGColor3",D.isAuto),!D.isAuto){var c=!0,u=!1,f=void 0;try{for(var h=ae()(D.chargeAccountIDs),g;!(c=(g=h.next()).done);c=!0)t=g.value,$(".folderChartNavBox .folderChartSelect[data-id="+t+"]").addClass("ThemeBorderColor3 ThemeBGColor3")}catch(T){u=!0,f=T}finally{try{!c&&h.return&&h.return()}finally{if(u)throw f}}}}},{key:"renderCustomTime",value:function(){var e=this;Xt(n.createElement(Kt.Z,{noClear:!0,onChange:function(a,r){a=a?a.format("YYYY-MM-DD"):void 0,r=r?r.format("YYYY-MM-DD"):void 0,e.updateTimeRefreshChart(!1,a,r)}},n.createElement("div",{className:"mTop10 mRight10 pointer"},n.createElement(Ne.Z,{icon:"calander",className:"Font16 Gray_9"}))),document.querySelector(".folderChartTime"))}},{key:"renderMaxCustomTime",value:function(){var e=this;Xt(n.createElement(Kt.Z,{noClear:!0,onChange:function(a,r){a=a?a.format("YYYY-MM-DD"):void 0,r=r?r.format("YYYY-MM-DD"):void 0,e.updateTimeRefreshChart(!0,a,r)}},n.createElement("div",{className:"mTop10 mRight10 pointer"},n.createElement(Ne.Z,{icon:"calander",className:"Font16 Gray_9"}))),document.querySelector("#maxViewUpdateTime"))}},{key:"updateChartTime",value:function(e){return Math.floor(e/24)}},{key:"render",value:function(){return n.createElement("div",{id:"taskList"})}}]),d}(n.Component);const Rs=(0,re.$j)(function(v){return v.task})(js);var Gs=k(81931),xe=k.n(Gs),z={pageIndex:1,isMore:!0,isLoading:!1,ajaxPost:null},Ws=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.quickCreateTaskCallback=function(t){var a=t.data,r=e.props.taskConfig,s=r.folderId,i=r.projectId,o=r.filterUserId;if(a.folderID===s||a.projectId===i&&s===1){var c=a.parentID,u=void 0,f=void 0,h=void 0,g=void 0,T=void 0;a.auth=1,a.status=0,a.subCount=0;var E={formatStatus:I.LR,formatTaskTime:I.Mq,isNew:!0,data:{stages:[{tasks:[a]}]}};if(c)u=$("#taskList .listStageTaskContent li[data-taskid='"+c+"']"),f=u.parent(),h=f.hasClass("singleFolderTask"),g=u.children("ul").length>0;else{var C=a.stageID||"undefined",N=a.StageName?a.StageName:_l("\u8FDB\u884C\u4E2D"),F=$("#taskList span[data-stageid='"+C+"']").parent();if(F.length)u=F.next();else{F=$('<div class="taskListStageName"> <i class="arrow-down"></i> <span data-stageid="'+C+'" class="listFolderNameText boderRadAll_3 overflow_ellipsis" title="'+N+'" >'+N+'</span> <span class="stageTaskCount">0</span></div><div class="listStageTaskContent"><ul class="singleFolderTask"></ul></div>'),$("#taskList").append(F),u=$(F[1]);var x=$("#taskList .createNewSingle");x.parent().is(".createNewTask")||(F.eq(1).prepend(x),x.wrap('<div class="createNewTask"></div>'),x.find("input").focus()),$(".listCreateNew, #taskSearchNullTask").remove()}h=!0,g=!0}if(u.find("ul").length<=0&&u.find(".nodeSwitch.on").length>0&&c){T=u.children(".singleTreeTask").find(".subCount"),T.text(parseInt(T.text()||0,10)+1);return}h?(E.deep=0,E.pageIndex=2,c?(E.data=[a],E.deep=1):E.data.stages[0].id="1",g||(E.isNew=!1)):(E.deep=u.data("deep"),g||(E.isNew=!1),E.data=[a]);var A=Z().template(xe())(E),H=u.children(".singleTreeTask");if(h)u.children("ul").length<=0?(H.find(".nodeSwitch").addClass("off"),H.append('<div class="joinLine"></div>'),u.append(A),H.find(".icon-task-card").length<=0&&H.find(".taskListDate").before('<i class="icon-task-card" tip="'+_l("\u5B50\u4EFB\u52A1")+'"></i> <span class="subCounts"><span class="completeCount">0</span>/<span class="subCount">1</span></span> ')):(u.children("ul").prepend(A),u.is(".listStageTaskContent")||(T=H.find(".subCount"),T.text(parseInt(T.text()||0,10)+1)));else{var K=20,Q=E.deep;Q!=1&&(K=Q*20),u.children("ul").length<=0?(H.find(".subNoneNode").remove(),H.find(".nodeCircleSmall").replaceWith('<span class="nodeSwitch off "></span>'),H.append('<div style="left:'+K+'px;" class="joinLine"></div>'),u.append(A),H.find(".icon-task-card").length<=0&&H.find(".taskListDate").before('<i class="icon-task-card" tip="'+_l("\u5B50\u4EFB\u52A1")+'"></i> <span class="subCounts"><span class="completeCount">0</span>/<span class="subCount">1</span></span> ')):(u.children("ul").prepend(A),T=H.find(".subCount"),T.text(parseInt(T.text()||0,10)+1))}if($("#taskList .chargeImgWrap").each(function(Ge,he){e.renderUserCard(he)}),!o){if(!c){var X=u.prev(".taskListStageName").find(".stageTaskCount");X.text(parseInt(X.text()||0,10)+1)}var le=$(".myTask .allCountTask:first");le.text(parseInt(le.text()||0,10)+1)}}},e.state={openTaskDetail:!1,taskId:"",isForceUpdate:!1,data:null},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){this.mounted=!0,this.init(),this.bindEvents(),this.props.emitter.removeListener("CREATE_TASK_TO_TREE",this.quickCreateTaskCallback),this.props.emitter.addListener("CREATE_TASK_TO_TREE",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.updateChargeHeaderAvatar),this.props.emitter.addListener("UPDATE_TASK_CHARGE",this.updateChargeHeaderAvatar.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=ee()({},e.taskConfig),r=ee()({},this.props.taskConfig),s=!1;a.folderId===r.folderId&&a.projectId!==r.projectId&&(s=!0),a.projectId="",r.projectId="",(e.taskConfig.folderId&&!y().isEqual(a,r)||S.ZP.isGetData||s)&&setTimeout(function(){t.init()},0)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,this.props.emitter.removeListener("CREATE_TASK_TO_TREE",this.quickCreateTaskCallback),this.props.emitter.removeListener("UPDATE_TASK_CHARGE",this.updateChargeHeaderAvatar)}},{key:"init",value:function(){z.isMore=!0,z.isLoading=!1,z.pageIndex=1,this.getTaskListByFolderId()}},{key:"bindEvents",value:function(){var e=$("#taskList"),t=this;e.on("click",".creatNewContent",function(a){mt.init({folderId:t.props.taskConfig.folderId===1?"":t.props.taskConfig.folderId,projectId:t.props.taskConfig.projectId}),a.stopPropagation()}),e.on("click",".nodeSwitch.on",function(a){var r=$(this).closest("li"),s=r.children("ul");if(s.length>0){var i=r.children(".singleTreeTask");i.find(".nodeSwitch").removeClass("on").addClass("off").end().find(".joinLine").show(),s.slideDown()}else{if(r.find(".treeLoadingSingleTask").length>0)return;t.getNodeTask(r)}a.stopPropagation()}),e.on("click",".nodeSwitch.off",function(a){var r=$(this).closest("li"),s=r.children(".singleTreeTask");s.find(".nodeSwitch").removeClass("off").addClass("on"),r.children("ul").slideUp(function(){s.find(".joinLine").hide()}),a.stopPropagation()}),e.on({mouseover:function(){$(".singleTreeTask .markTask").removeClass("markTaskHover"),$(this).find(".markTask").addClass("markTaskHover")},mouseout:function(){$(this).find(".markTask").removeClass("markTaskHover")},click:function(r){var s=$(this),i=s.parent(),o=i.data("taskid"),c=!1,u=void 0;if(!(s.hasClass("addNewTask")||$(r.target).hasClass("markTask")||$(r.target).hasClass("taskStar"))){if((r.ctrlKey||r.metaKey)&&r.shiftKey?(u="shiftCtrl",c=!0):r.ctrlKey||r.metaKey?(u="ctrl",c=!0):r.shiftKey&&(u="shift",c=!0),c)return t.setState({openTaskDetail:!1,taskId:""}),k.e(9214).then(k.bind(k,9214)).then(function(f){f.default.shiftCtrlKey(s,u)}),!1;S.ZP.$prevNode=s,$("#taskList .singleTreeTask").removeClass("selectTask ThemeBGColor6"),s.addClass("selectTask ThemeBGColor6"),t.setState({openTaskDetail:!0,taskId:o,isForceUpdate:!0})}}},".singleTreeTask"),e.on({click:function(r){var s=$(this).next(".listStageTaskContent");s.is(":animated")||(s.slideToggle(),$(this).find(".arrow-down").toggleClass("downArrow"),r.stopPropagation())},hover:function(){$(this).find(".listFolderNameText").toggleClass("ThemeColor3"),$(this).find(".arrow-down").toggleClass("ThemeBorderColor3")}},".taskListStageName"),e.on("scroll",function(){if(!(t.props.taskConfig.listStatus!=1&&t.props.taskConfig.listStatus!=-1||!z.isMore||z.isLoading)){var a=$(this),r=a.height(),s=a[0].scrollHeight,i=a[0].scrollTop;i+r+30>=s&&(z.pageIndex++,t.getTaskListByFolderId())}})}},{key:"updateCharge",value:function(e,t,a,r){var s=this,i=this.props.taskConfig;(0,ke.Z)({sourceId:i.folderId,showMoreInvite:!1,fromType:2,SelectUserSettings:{includeUndefinedAndMySelf:!0,filterAccountIds:[e],projectId:(0,I.Ie)(a)?a:"",unique:!0,callback:function(c){var u=c[0];s.props.dispatch((0,B.rv)(t,u,"",function(){s.renderUserCard(r,!0,u)}))}}})}},{key:"updateChargeHeaderAvatar",value:function(e){var t=this;$("#taskList .listStageTaskContent .chargeImgWrap").each(function(a,r){var s=$(r);if(!s.data("hasbusinesscard")){var i=(0,ue.default)({},e.data.data.charge,{accountId:e.data.data.charge.accountID});$(r).attr({"data-sourceid":i.accountId,"data-src":i.avatar,"data-auth":e.data.data.auth}),t.renderUserCard(r,!0,i)}})}},{key:"renderUserCard",value:function(e){var t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(e.innerHtml&&!a)){var s=$(e),i=a?r.accountId:s.attr("data-sourceid"),o=a?r.avatar:s.attr("data-src"),c=this.props.taskConfig.folderId,u=this.props.taskConfig.projectId,f=void 0;c?f=s.closest("li").data("taskid"):(f=s.closest("tr").data("taskid"),u=s.closest("tr").data("projectid")),s.data("hasbusinesscard",!0),se.render(n.createElement(ce.Z,{className:"circle",user:{userHead:o,accountId:i},size:26,operation:s.attr("data-auth")==S.ZP.auth.Charger?n.createElement("span",{className:"updateChargeBtn ThemeColor3",onClick:function(){return t.updateCharge(i,f,u,e)}},_l("\u5C06\u4EFB\u52A1\u6258\u4ED8\u7ED9\u4ED6\u4EBA")):null}),e)}}},{key:"getTaskListByFolderId",value:function(){var e=this,t=this.props.taskConfig,a=t.projectId,r=t.folderId,s=t.viewType,i=t.filterUserId,o=t.listSort,c=t.listStatus,u=t.completeTime,f=t.filterSettings,h=t.searchKeyWords;z.ajaxPost&&z.ajaxPost.abort(),z.isLoading=!0,(0,te.a0)(z.pageIndex);var g="";c==1&&(g=1),c==-1&&z.pageIndex>1&&(g=1);var T=!1,E=y().filter(f.tags,function(C){return C!=="null"});y().findIndex(f.tags,function(C){return C==="null"})>=0&&(T=!0),r===1?z.ajaxPost=L.Z.getTaskListInProjectWithOutFolder({pageIndex:z.pageIndex,pageSize:S.ZP.pageSize,completeTime:u,tagIDs:E,chargeIds:f.selectChargeIds,controlSelectedDic:this.returnCustomFilterArray(),withoutTag:T,projectId:a,sort:o,status:c,other:i,keywords:h}):z.ajaxPost=L.Z.getFolderTaskList({page:z.pageIndex,size:S.ZP.pageSize,folderID:r,completeTime:u,tagIDs:E,chargeIds:f.selectChargeIds,controlSelectedDic:this.returnCustomFilterArray(),withoutTag:T,sort:o,status:c,filterType:f.folderSearchRange,keywords:h}),z.ajaxPost.then(function(C){if(S.ZP.isGetData=!1,C.status){if(e.setState({data:y().flatMap(C.stages,function(){return C.stages.tasks})}),z.ajaxPost=!1,s!==S.ZP.folderViewType.treeView)return;var N=C.data.stages;if(z.pageIndex>1){var F=C.data.stages.length,x=[{sort:0,id:1,name:_l("\u5DF2\u5B8C\u6210"),tasks:C.data.stages[F-1].tasks}];C.data.stage=x,N=C.data.stage}if(r===1||g===1)if(c==1||c==0)S.ZP.pageSize>(N[0].tasks?N[0].tasks.length:0)&&(z.isMore=!1);else{var A=0;$.map(N,function(Q){A+=Q.tasks?Q.tasks.length:0}),S.ZP.pageSize>A&&(z.isMore=!1)}if(N.length===1&&$.trim(N[0].name)===_l("\u8FDB\u884C\u4E2D")&&!N[0].tasks&&z.pageIndex===1)e.renderNoData();else if(c===1&&!N[0].tasks&&!f.tags.length&&!f.customFilter.length&&z.pageIndex===1)$("#taskList").html(S.ZP.configHtml.noCompleteNullHtml);else if(C.deep=0,C.pageIndex=z.pageIndex,C.formatStatus=I.LR,C.formatTaskTime=I.Mq,z.pageIndex===1)$("#taskList").html(Z().template(xe())(C)),$("#taskList .chargeImgWrap").each(function(Q,X){e.renderUserCard(X)});else if(c===1||c===0||g===1){var H=Z().template(xe())(C);g===1?H.indexOf("nullCompleteTask")>-1&&$("#taskList .nullCompleteTask").length||$("#taskList .singleFolderTask:last").append(H):$("#taskList .singleFolderTask:first").append(H),$("#taskList .chargeImgWrap").each(function(Q,X){e.renderUserCard(X)})}else{if(C.data.stages[0].tasks.length>0){var H=Z().template(xe())(C);$("#taskList .singleFolderTask:first").append(H),$("#taskList .chargeImgWrap").each(function(X,le){e.renderUserCard(le)})}var K={deep:0,pageIndex:z.pageIndex,formatStatus:I.LR,formatTaskTime:I.Mq,data:C.data.stages.splice(1,1)};if(K.data[0].tasks.length){var H=Z().template(xe())(K);$("#taskList .singleFolderTask:last").append(H),$("#taskList .chargeImgWrap").each(function(X,le){e.renderUserCard(le)})}}z.isLoading=!1,$("#taskFilterLoading,#taskFilterLoadingBottom").remove()}else(0,I.N3)(C.error)})}},{key:"renderNoData",value:function(){var e=`
      <div class="listCreateNew boderRadAll_3">
        <div class="creatNewContent">
          <i class="taskQuickCreate"></i>
          <span>
            `+_l("\u70B9\u51FB\u521B\u5EFA\u4EFB\u52A1")+`<br>
            <span class="Font14">`+_l("\u6216\u4F7F\u7528\u53F3\u4E0A\u89D2 + \u53F7\u521B\u5EFA\u4EFB\u52A1")+`</span>
          </span>
        </div>
        <div class="ThemeBG taskGroundGlass"></div>
      </div>`;$("#taskList").html(this.props.taskConfig.searchKeyWords?S.ZP.configHtml.searchNullHtml:e)}},{key:"returnCustomFilterArray",value:function(){var e=this.props.taskConfig.filterSettings.customFilter,t={};return Ce()(e).forEach(function(a){var r="",s=[];e[a].forEach(function(i){r?r.length>i.length?(s=r.split(""),s.splice(r.length-i.length,1,"1"),r=s.join("")):r=i.substr(0,i.length-r.length)+r:r=i}),t[a]=r}),t}},{key:"getNodeTask",value:function(e){var t=this,a=this.props.taskConfig.listSort,r=e.data("taskid");e.append('<div class="treeLoadingSingleTask"> '+LoadDiv()+"  </div>");var s=e.data("deep");L.Z.getSubTask({taskID:r,sort:a}).then(function(i){if(i.status){var o=i.data;if(o.length<=0){e.find(".treeLoadingSingleTask").remove(),e.data("deep")===1?e.find(".nodeSwitch").removeClass("on off"):e.find(".subJoinLine,.nodeSwitch ").remove().end().find(".singleTreeTask").prepend('<span class="subJoinLine"></span><span class="InlineBlockTop subNoneNode"></span><span class="nodeCircleSmall circle "></span>');return}var c=e.children(".singleTreeTask"),u=20;s!=1&&(u=s*20),c.append('<div style="left:'+u+'px;" class="joinLine"></div>'),c.find(".nodeSwitch").removeClass("on").addClass("off"),o.length>0&&(i.deep=s,i.formatStatus=I.LR,i.formatTaskTime=I.Mq,e.append(Z().template(xe())(i)).hide().slideDown(),e.find(".treeLoadingSingleTask").remove()),$("#taskList .chargeImgWrap").each(function(f,h){t.renderUserCard(h)})}else e.find(".treeLoadingSingleTask").remove(),(0,I.N3)(i.error)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.openTaskDetail,r=t.taskId,s=t.isForceUpdate;return n.createElement(n.Fragment,null,n.createElement("div",{id:"taskList"}),n.createElement(be.Z,{visible:a,taskId:r,isForceUpdate:s,closeForceUpdate:function(){return e.setState({isForceUpdate:!1})},openType:1,closeCallback:function(){return e.setState({taskId:""})},animationEndRemoveDetail:function(){return e.mounted&&e.setState({openTaskDetail:!1})}}))}}]),d}(n.Component);const Zs=(0,re.$j)(function(v){return v.task})(Ws);var Vs=k(56493),Ks=k(29166),Xs=k.n(Ks),Jt=function(d){var l={folderId:null,visibility:null,selectGroup:null,callback:null,projectId:null,projectName:""};this.settings=$.extend(l,d),this.init()};$.extend(Jt.prototype,{init:function(){var d=this,l=this.settings,e=Z().template(Xs())(l);ie.Z.confirm({dialogClasses:"editFolder",title:l.projectName===_l("\u4E2A\u4EBA")?_l("\u7F16\u8F91\u9879\u76EE"):_l("\u5728\u7EC4\u7EC7 \u201C%0\u201D \u4E0B\u7F16\u8F91\u9879\u76EE",l.projectName),okText:_l("\u4FDD\u5B58"),children:n.createElement("div",{dangerouslySetInnerHTML:{__html:e}}),footer:n.createElement("div",{className:"Dialog-footer-btns"},n.createElement(Ee.ZP,{type:"link",onClick:function(){return $(".editFolder").parent().remove()}},_l("\u53D6\u6D88")),n.createElement(Ee.ZP,{type:"primary",onClick:function(){var a=d.edit();a!==!1&&$(".editFolder").parent().remove()}},_l("\u4FDD\u5B58"))),width:570}),d.initEvent()},initEvent:function(){var d=this.settings,l=[],e=[];d.visibility===2?l.push(d.projectId):d.visibility===1&&(e=d.selectGroup.split(",")),$("#privateRange").SelectGroup({defaultValue:{project:l,group:e},defaultIsNone:!1,isShowSelectProject:!1,autoPosition:!0,projectId:d.projectId,isMe:!1,everyoneOnly:!0,createGroupInProject:!0}),d.visibility!==0&&$("#publicFolder").find(":radio").prop("checked",!0),$(".editFolder .folderAuth").on("click",function(){$(this).find(":radio").prop("checked",!0)})},returnCheck:function(){var d=this.settings,l=void 0,e=[],t=$("#privateRange").SelectGroup("getScope");if($("#privateFolder :radio").prop("checked"))l=0;else{if(!t||t.shareGroupIds.length===0&&t.shareProjectIds.indexOf(d.projectId)===-1)return alert(_l("\u8BF7\u9009\u62E9\u516C\u5F00\u7684\u8303\u56F4"),3),!1;t.shareProjectIds.indexOf(d.projectId)>-1?(l=2,e.push("everyone")):(l=1,e=t.shareGroupIds)}return{visibility:l,groupIds:e.join(",")}},edit:function(){var d=this,l=d.settings,e=d.returnCheck();if(!e)return!1;e.visibility===1&&(e.groupInfo=[],$("#privateRange").next().find(":checkbox:checked").closest(".groupItem").each(function(){e.groupInfo.push({groupID:$(this).attr("data-groupid"),groupName:$(this).text()})})),L.Z.updateFolderVisibility({folderID:l.folderId,projectId:l.projectId,visibility:e.visibility,groupID:e.groupIds}).then(function(t){t.status?$.isFunction(l.callback)&&l.callback(e):alert(_l("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),2)})}});function zs(v){return new Jt(v)}var tt=k(14761),Qt=k(62231),Js=k(83650),Qs=function(v){(0,W.default)(d,v);function d(l){(0,j.default)(this,d);var e=(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l));return e.folderPostPromise=null,e.updateFolderDesc=function(t){var a=e.state.data;e.setState({isEditing:!1}),a.describe!==t&&L.Z.updateFolderDes({folderID:e.props.taskConfig.folderId,describe:t}).then(function(r){r.status?(alert("\u4FEE\u6539\u6210\u529F"),e.setState({data:ee()({},a,{describe:r.data})})):(0,I.N3)(r.error)})},e.updateFolderChargeEvents=function(){var t=e.state.data;(0,ke.Z)({sourceId:t.folderID,title:_l("\u9009\u62E9\u8D1F\u8D23\u4EBA"),showMoreInvite:!1,fromType:6,SelectUserSettings:{filterAccountIds:[md.global.Account.accountId],projectId:(0,I.Ie)(t.projectID)?t.projectID:"",unique:!0,callback:function(r){e.updateFolderCharge(r[0].accountId,r[0].avatar,r[0].fullname)}}})},e.editRange=function(){var t=e.props.taskConfig,a=t.folderId,r=t.projectId,s=y().cloneDeep(e.state.data),i=$(".networkFolderList[data-projectid="+r+"] .allFolders .overflow_ellipsis").html()||_l("\u4E2A\u4EBA");zs({projectId:r,projectName:i,folderId:a,visibility:s.visibility,selectGroup:s.groupInfo.map(function(o){return o.groupID}).join(","),callback:function(c){s.visibility=c.visibility,s.groupInfo=c.groupInfo||[],e.setState({data:s})}})},e.scroll=function(t,a){a.maximum-a.position<=30&&(e.state.tabIndex===1&&e.commentList&&e.commentList.updatePageIndex(),e.state.tabIndex===2&&e.state.logs.length===e.state.logPageIndex*20&&e.setState({logPageIndex:e.state.logPageIndex+1},function(){e.getFolderLog()}))},e.onSubmit=function(t){var a=[t].concat(e.state.discussions);e.setState({discussions:a})},e.removeDiscussionsCallback=function(t){var a=[].concat(e.state.discussions);y().remove(a,function(r){return r.discussionId===t}),e.setState({discussions:a})},e.state={isEditing:!1,data:{},discussions:[],tabIndex:1,onlyLook:!1,logPageIndex:1,logs:[]},e}return(0,R.default)(d,[{key:"componentDidMount",value:function(){this.mounted=!0,this.getFolderDetail()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.taskConfig.folderId&&e.taskConfig.folderId!==this.props.taskConfig.folderId&&setTimeout(function(){t.setState({isEditing:!1,tabIndex:1,onlyLook:!1,logPageIndex:1,logs:[]}),$("#taskList").nanoScroller({scrollTop:0}),t.getFolderDetail()},0)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"getFolderDetail",value:function(){var e=this,t=this.props.taskConfig.folderId,a=this.props.folderSettings.isNotice;this.folderPostPromise&&this.folderPostPromise.abort(),this.folderPostPromise=L.Z.getFolderDetail({folderID:t}),this.folderPostPromise.then(function(r){if(e.folderPostPromise=!1,!!e.mounted){if(a){var s=$(".folderList li[data-id="+t+"]"),i=0;s.find(".folderNewTip").remove();var o=s.closest(".projectFolder");if(o.length){var c=o.find(".projectFolderUl .folderNewTip").length;c||o.find(".folderTitle .folderNewTip").addClass("Hidden")}var u=s.closest(".networkFolderList");u.length&&(i=parseInt(u.attr("data-count"),10)-1,u.attr("data-count",i),i||u.find(".allFolders .folderNewTip").addClass("Hidden"));var f=s.closest(".topFolderList");if(f.length&&s.length===1){var h=s.data("projectid"),g=!1;if($.map(md.global.Account.projects,function(T,E){if(h===T.projectId){g=!0;return}}),h=g?h:"",!h)return;u=$(".networkFolderList[data-projectid="+h+"]"),i=parseInt(u.attr("data-count"),10)-1,u.attr("data-count",i),i||u.find(".allFolders .folderNewTip").addClass("Hidden")}}e.props.dispatch((0,B.V$)()),e.setState({data:r.data})}})}},{key:"renderFolderCharge",value:function(){var e=this.state.data,t=n.createElement("span",{className:"folderDetailOpBtn updateFolderCharge ThemeColor3",onClick:this.updateFolderChargeEvents},_l("\u9879\u76EE\u6258\u4ED8\u7ED9\u4ED6\u4EBA"));return n.createElement("li",null,n.createElement("div",{className:"folderDetailMemberLabel"},_l("\u8D1F\u8D23\u4EBA")),n.createElement("div",{className:"folderMemberList"},n.createElement(ce.Z,{user:{userHead:e.chargeUser.avatar,accountId:e.chargeUser.accountID},size:28,secretType:1,operation:e.chargeUser.accountID===md.global.Account.accountId?t:null})))}},{key:"renderFolderAdmin",value:function(){var e=this,t=this.state.data,a=function(s){var i=s.accountID,o=s.avatar,c=s.fullName;return t.chargeUser.accountID===md.global.Account.accountId?n.createElement(n.Fragment,null,n.createElement("span",{className:"folderDetailOpBtn updateFolderChargeFix borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderChargeFix",i,o,c)}},_l("\u8BBE\u4E3A\u8D1F\u8D23\u4EBA")),n.createElement("span",{className:"folderDetailOpBtn updateFolderMember borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderMember",i,o,c)}},_l("\u8BBE\u4E3A\u6210\u5458")),n.createElement("span",{className:"folderDetailOpBtn updateFolderLeave fixWidth ThemeColor3",onClick:function(){return e.clickEvents("updateFolderLeave",i,o,c)}},_l("\u79FB\u51FA"))):t.isAdmin?n.createElement(n.Fragment,null,n.createElement("span",{className:"folderDetailOpBtn updateFolderMember borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderMember",i,o,c)}},_l("\u8BBE\u4E3A\u6210\u5458")),n.createElement("span",{className:"folderDetailOpBtn updateFolderLeave ThemeColor3",onClick:function(){return e.clickEvents("updateFolderLeave",i,o,c)}},i===md.global.Account.accountId?_l("\u9000\u51FA"):_l("\u79FB\u51FA"))):null};return n.createElement("li",null,n.createElement("div",{className:"folderDetailMemberLabel"},_l("\u7BA1\u7406\u5458")),t.admins.map(function(r,s){return n.createElement("div",{key:s,className:"folderMemberList"},n.createElement(ce.Z,{user:{userHead:r.avatar,accountId:r.accountID},size:28,secretType:1,operation:t.isAdmin?a(r):null}))}),t.isAdmin&&n.createElement("span",{"data-tip":_l("\u6DFB\u52A0\u9879\u76EE\u7BA1\u7406\u5458")},n.createElement("i",{className:"icon-task-add-member-circle pointer ThemeColor3",onClick:function(s){return e.addFolderMembersEvents(s,!0)}})))}},{key:"renderFolderMember",value:function(){var e=this,t=this.state.data,a=function(s,i){var o=s.accountID,c=s.avatar,u=s.fullName;if(i&&t.isAdmin)return n.createElement(n.Fragment,null,n.createElement("span",{className:"folderDetailOpBtn updateFolderApplyAdmin borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderApplyAdmin",o,c,u)}},_l("\u8BBE\u4E3A\u7BA1\u7406\u5458")),n.createElement("span",{className:"folderDetailOpBtn updateFolderApplyMember borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderApplyMember",o,c,u)}},_l("\u8BBE\u4E3A\u6210\u5458")),n.createElement("span",{className:"folderDetailOpBtn updateFolderRefuse fixWidth ThemeColor3",onClick:function(){return e.clickEvents("updateFolderRefuse",o,c,u)}},_l("\u62D2\u7EDD")));if(t.isAdmin)return n.createElement(n.Fragment,null,t.chargeUser.accountID===md.global.Account.accountId&&n.createElement("span",{className:"folderDetailOpBtn updateFolderChargeFix borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderChargeFix",o,c,u)}},_l("\u8BBE\u4E3A\u8D1F\u8D23\u4EBA")),n.createElement("span",{className:"folderDetailOpBtn updateFolderAdmin borderRight ThemeColor3",onClick:function(){return e.clickEvents("updateFolderAdmin",o,c,u)}},_l("\u8BBE\u4E3A\u7BA1\u7406\u5458")),n.createElement("span",{className:w()("folderDetailOpBtn updateFolderLeave ThemeColor3",{fixWidth:t.chargeUser.accountID===md.global.Account.accountId}),onClick:function(){return e.clickEvents("updateFolderLeave",o,c,u)}},_l("\u79FB\u51FA")));if(o===md.global.Account.accountId)return n.createElement("span",{className:"folderDetailOpBtn updateFolderLeave ThemeColor3",onClick:function(){return e.clickEvents("updateFolderLeave",o,c,u)}},_l("\u9000\u51FA"))};return n.createElement("li",null,n.createElement("div",{className:"folderDetailMemberLabel"},_l("\u6210\u5458")),t.ordinaryMembers.map(function(r,s){return n.createElement("div",{key:s,className:"folderMemberList"},n.createElement(ce.Z,{user:{userHead:r.avatar,accountId:r.accountID},size:28,secretType:1,operation:t.isAdmin||r.accountID===md.global.Account.accountId?a(r,!1):null}))}),t.applyMembers.map(function(r,s){return n.createElement("div",{key:s,className:"folderMemberList"},n.createElement("span",{className:"applyBox"}),n.createElement(ce.Z,{user:{userHead:r.avatar,accountId:r.accountID},size:28,secretType:1,operation:t.isAdmin?a(r,!0):null}))}),t.isAdmin&&n.createElement("span",{"data-tip":_l("\u6DFB\u52A0\u9879\u76EE\u6210\u5458")},n.createElement("i",{className:"icon-task-add-member-circle pointer ThemeColor3",onClick:function(s){return e.addFolderMembersEvents(s,!1)}})))}},{key:"bindEvents",value:function(e,t,a,r){var s=this;e.find(".updateFolderChargeFix").on("click",function(){s.updateFolderCharge(t,a,r)}),e.find(".updateFolderMember").on("click",function(){s.updateFolderMemberAuth(t,a,r,!1)}),e.find(".updateFolderAdmin").on("click",function(){s.updateFolderMemberAuth(t,a,r,!0)}),e.find(".updateFolderLeave").on("click",function(){s.removeFolderMember(t)}),e.find(".updateFolderApplyAdmin").on("click",function(){s.updateFolderMemberStatusAndAuth(t,a,r,!0)}),e.find(".updateFolderApplyMember").on("click",function(){s.updateFolderMemberStatusAndAuth(t,a,r,!1)}),e.find(".updateFolderRefuse").on("click",function(){s.refuseFolderMember(t)})}},{key:"clickEvents",value:function(e,t,a,r){switch(e){case"updateFolderChargeFix":this.updateFolderCharge(t,a,r);return;case"updateFolderMember":this.updateFolderMemberAuth(t,a,r,!1);return;case"updateFolderAdmin":this.updateFolderMemberAuth(t,a,r,!0);return;case"updateFolderLeave":this.removeFolderMember(t);return;case"updateFolderApplyAdmin":this.updateFolderMemberStatusAndAuth(t,a,r,!0);return;case"updateFolderApplyMember":this.updateFolderMemberStatusAndAuth(t,a,r,!1);return;case"updateFolderRefuse":this.refuseFolderMember(t);return;default:return}}},{key:"addFolderMembersEvents",value:function(e,t){var a=this,r=this.state.data,s=this.props.taskConfig,i=s.folderId,o=s.projectId,c=[r.chargeUser.accountID],u=function(h){a.addFolderMembers(h,t)};c=c.concat(r.admins.map(function(f){return f.accountID})),t||(c=c.concat(r.ordinaryMembers.map(function(f){return f.accountID}))),(0,Oe.ZP)(e.target,{sourceId:i,projectId:o,fromType:6,filterAccountIds:c,SelectUserSettings:{filterAccountIds:c,projectId:(0,I.Ie)(o)?o:"",callback:u},selectCb:u})}},{key:"updateFolderCharge",value:function(e,t,a){var r=this;ie.Z.confirm({dialogClasses:"updateFolderCharge",closable:!1,title:n.createElement("div",{style:{color:"#f44336"}},_l("\u5C06\u9879\u76EE\u8D1F\u8D23\u4EBA\u79FB\u4EA4\u7ED9\u201C%0\u201D",a)),children:n.createElement("div",{className:"Font14",style:{color:"#9e9e9e"}},_l("\u5982\u679C\u60A8\u79FB\u4EA4\u540E\uFF0C\u5C06\u65E0\u6CD5\u628A\u81EA\u5DF1\u91CD\u65B0\u8BBE\u4E3A\u8BE5\u9879\u76EE\u7684\u8D1F\u8D23\u4EBA")),okText:_l("\u786E\u5B9A"),onOk:function(){L.Z.updateFolderCharge({folderID:r.props.taskConfig.folderId,chargeAccountID:e}).then(function(i){if(i.status){var o=y().cloneDeep(r.state.data),c=y().cloneDeep(o.chargeUser);o.chargeUser.accountID=e,o.chargeUser.avatar=t,o.chargeUser.fullName=a,o.admins.push(c),y().remove(o.ordinaryMembers,function(f){return f.accountID===e}),y().remove(o.applyMembers,function(f){return f.accountID===e}),r.setState({data:o});var u=$(".folderList .commFolder").filter("[data-id="+r.props.taskConfig.folderId+"]");u.data("charge",e).data("auth",8).find(".folderCharge").attr("src",t).data("id",e).data("hasbusinesscard",!1).off()}else(0,I.N3)(i.error)})}})}},{key:"updateFolderMemberAuth",value:function(e,t,a,r){var s=this;L.Z.updateFolderMemberAuth({folderID:this.props.taskConfig.folderId,accountID:e,isAdmin:r}).then(function(i){if(i.status){var o=y().cloneDeep(s.state.data),c={accountID:e,avatar:t,fullName:a,status:1};y().remove(o.admins,function(u){return u.accountID===e}),y().remove(o.ordinaryMembers,function(u){return u.accountID===e}),r?o.admins.push(c):o.ordinaryMembers.push(c),s.setState({data:o}),!r&&e===md.global.Account.accountId&&(o.isAdmin=!1,s.setState({data:o}),$(".folderList .commFolder").filter("[data-id="+s.props.taskConfig.folderId+"]").data("auth",6))}else(0,I.N3)(i.error)})}},{key:"removeFolderMember",value:function(e){var t=this,a=_l("\u662F\u5426\u786E\u8BA4\u79FB\u9664\u8BE5\u6210\u5458");e===md.global.Account.accountId&&(a=_l("\u786E\u5B9A\u9000\u51FA\u8BE5\u9879\u76EE\uFF1F")),ie.Z.confirm({title:"",description:a,onOk:function(){L.Z.removeFolderMember({folderID:t.props.taskConfig.folderId,accountID:e,isRemoveTaskMember:!1}).then(function(s){if(s.status)if(e===md.global.Account.accountId)alert(_l("\u9000\u51FA\u6210\u529F")),location.href.indexOf("application")>-1?location.reload():($(".folderList .commFolder[data-id='"+t.props.taskConfig.folderId+"']").remove(),$("#taskNavigator .taskType li:first").click());else{var i=y().cloneDeep(t.state.data);y().remove(i.admins,function(o){return o.accountID===e}),y().remove(i.ordinaryMembers,function(o){return o.accountID===e}),t.setState({data:i}),alert(_l("\u79FB\u9664\u6210\u529F"))}else(0,I.N3)(s.error)})}})}},{key:"updateFolderMemberStatusAndAuth",value:function(e,t,a,r){var s=this;L.Z.updateFolderMemberStatusAndAuth({folderID:this.props.taskConfig.folderId,memberID:e,isAdmin:r}).then(function(i){if(i.status){var o=y().cloneDeep(s.state.data),c={accountID:e,avatar:t,fullName:a,status:1};y().remove(o.applyMembers,function(u){return u.accountID===e}),r?o.admins.push(c):o.ordinaryMembers.push(c),s.setState({data:o})}else(0,I.N3)(i.error)})}},{key:"refuseFolderMember",value:function(e){var t=this;ie.Z.confirm({title:"",description:_l("\u786E\u8BA4\u62D2\u7EDD\u8BE5\u6210\u5458\uFF1F"),onOk:function(){L.Z.refuseFolderMember({folderID:t.props.taskConfig.folderId,accountID:e}).then(function(r){if(r.status){var s=y().cloneDeep(t.state.data);y().remove(s.applyMembers,function(i){return i.accountID===e}),t.setState({data:s})}else(0,I.N3)(r.error)})}})}},{key:"addFolderMembers",value:function(e,t,a){var r=this,s=[],i={};$.isFunction(a)?e.forEach(function(o){i[o.account]=o.fullname}):e.forEach(function(o){s.push(o.accountId)}),L.Z.addFolderMembers({folderID:this.props.taskConfig.folderId,memberIDs:s.join(","),specialAccounts:i,isAdmin:t}).then(function(o){if($.isFunction(a)&&a({status:o.status}),o.status){if(o.data&&o.data.limitedCount&&alert(_l("\u6709%0\u4F4D\u5916\u90E8\u7528\u6237\u9080\u8BF7\u5931\u8D25\u3002\u5916\u90E8\u7528\u6237\u77ED\u4FE1\u9080\u8BF7\u7528\u91CF\u8FBE\u5230\u4E0A\u9650",o.data.limitedCount),3),o.data&&o.data.successMember){var c=y().cloneDeep(r.state.data);t?c.admins=c.admins.concat(o.data.successMember):c.ordinaryMembers=c.ordinaryMembers.concat(o.data.successMember),r.setState({data:c})}}else(0,I.N3)(o.error)})}},{key:"switchTabs",value:function(e){var t=this,a=e===this.state.tabIndex;a?e===1?this.commentList.updatePageIndex(!0):this.logPageIndex===1?this.getFolderLog():this.setState({logPageIndex:1},function(){t.getFolderLog()}):this.setState({tabIndex:e,logPageIndex:1},function(){e===2&&t.getFolderLog()})}},{key:"nullCommentList",value:function(){return n.createElement("div",{className:"folderDetailNoTalk Font16"},_l("\u8981\u7ECF\u5E38\u5BF9\u9879\u76EE\u8FDB\u884C\u6C9F\u901A\u548C\u8BA8\u8BBA\u5594\u2026"))}},{key:"getFolderLog",value:function(){var e=this,t=this.state.logPageIndex,a=this.props.taskConfig.folderId;this.folderPostPromise&&this.folderPostPromise.abort(),L.Z.getFolderLog({folderID:a,pageIndex:t,pageSize:20}).then(function(r){if(r.status){if(!e.mounted)return;e.folderPostPromise=!1,t===1?e.setState({logs:r.data}):e.setState({logs:e.state.logs.concat(r.data)})}else(0,I.N3)(r.error)})}},{key:"renderLogItems",value:function(e,t){return n.createElement("div",{key:t,className:"projectLogs boxSizing"},n.createElement("i",{className:w()("logsType",this.returnIcons(e.type))}),n.createElement("div",{dangerouslySetInnerHTML:{__html:e.msg}}),n.createElement("span",{className:"logsTime"},createTimeSpan(e.createTime)))}},{key:"returnIcons",value:function(e){return e===17?"icon-plus":e===1||e===16?"icon-task-pigeonhole":e===2||e===3||e===12||e===13||e===14||e===18||e===21?"icon-edit":e===15?"icon-eye":e===19||e===99?"icon-task-new-delete":"icon-charger"}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,r=t.isEditing,s=t.tabIndex,i=t.onlyLook,o=t.discussions,c=t.logs,u=this.props.taskConfig.folderId,f=this.props.folderSettings.folderName,h=a.isAddedApk,g=a.apkName,T={sourceId:u,textareaMinHeight:22,sourceType:tt.Z.TYPES.FOLDER,appId:md.global.APPInfo.taskFolderAppID,remark:u+"|"+f+"|"+_l("\u9879\u76EE"),storageId:u,selectGroupOptions:{projectId:a.projectID},onSubmit:this.onSubmit},E=(a.groupInfo||[]).map(function(C){return C.groupName}).join(",");return y().isEmpty(a)?n.createElement(ve.Z,null):n.createElement(vt.Z,{id:"taskList",updateEvent:this.scroll},n.createElement("div",{className:"folderDetailWrapper"},n.createElement("div",{className:"folderDesc boderRadAll_3"},n.createElement("div",{className:"descTitle flexRow pLeft20"},n.createElement("span",{className:"projectDetail"}," ",_l("\u9879\u76EE\u63CF\u8FF0")),h&&n.createElement("div",{className:"ellipsis mLeft8 Gray_75"},n.createElement(Ne.Z,{icon:"info",className:"Font17"}),n.createElement("span",{className:"mLeft3"},_l('\u6B64\u9879\u76EE\u5DF2\u88AB"%0"\u5E94\u7528\u5173\u8054',g)))),n.createElement("div",{className:"descContainer"},r?n.createElement(Js.Z,{toorIsBottom:!0,className:"taskDetailEdit appIntroDescriptionEditor",dropdownPanelPosition:{right:"initial"},maxHeight:500,summary:a.describe,isEditing:a.isAdmin&&r,permissionType:100,onSave:this.updateFolderDesc,onCancel:function(){return e.setState({isEditing:!1})},cacheKey:u,title:_l("\u63CF\u8FF0")}):n.createElement(Vs.Z,{key:u,className:"taskDetailEdit",dropdownPanelPosition:{right:"initial"},data:a.describe,disabled:!0,maxHeight:500,minHeight:40,placeholder:_l("\u8BF4\u660E\u8FD9\u4E2A\u9879\u76EE\u5E0C\u671B\u8FBE\u6210\u7684\u76EE\u6807\u548C\u8BA1\u5212\u2026"),onClickNull:function(N){a.isAdmin&&e.setState({isEditing:!0})}}))),n.createElement("div",{className:"folderDetailMembers boderRadAll_3 mTop10"},n.createElement("div",{className:"folderDetailHead"},_l("\u9879\u76EE\u6240\u6709\u6210\u5458")," (",a.admins.length+a.ordinaryMembers.length+1,")",n.createElement(pt.default,{title:function(){return n.createElement(n.Fragment,null,n.createElement("div",null,_l("\u8D1F\u8D23\u4EBA\uFF1A\u53EF\u4EE5\u8BBE\u7F6E\u7BA1\u7406\u5458\u6765\u534F\u52A9\u7BA1\u7406\u9879\u76EE")),n.createElement("div",null,_l("\u7BA1\u7406\u5458\uFF1A\u53EF\u4EE5\u4FEE\u6539\u9879\u76EE\u548C\u9879\u76EE\u4E0B\u7684\u4EFB\u52A1")),n.createElement("div",null,_l("\u6210\u5458\uFF1A\u53EF\u4EE5\u67E5\u770B\u9879\u76EE\u53CA\u9879\u76EE\u4E0B\u5168\u90E8\u4EFB\u52A1")))}},n.createElement("i",{className:"icon-help Font16"}))),n.createElement("ul",{className:"folderDetailMemberList"},this.renderFolderCharge(),this.renderFolderAdmin(),this.renderFolderMember()),n.createElement("div",{className:"folderDetailLine"}),n.createElement("div",{className:"folderDetailRange"},n.createElement("div",{className:"folderDetailRangeLabel"},n.createElement("i",{className:"icon-folder-public Font14"})," ",_l("\u9879\u76EE\u516C\u5F00\u8303\u56F4\uFF1A")),n.createElement("div",{className:"folderDetailRanges"},n.createElement("span",{className:"folderDetailRangesDesc"},a.visibility===0?_l("\u4EC5\u9879\u76EE\u6210\u5458\u53EF\u89C1"):a.visibility===2?_l("\u5BF9\u6240\u6709\u540C\u4E8B\u516C\u5F00"):n.createElement("span",{dangerouslySetInnerHTML:{__html:_l("\u5BF9\u7FA4\u7EC4 %0 \u516C\u5F00",'<span class="bold">'+E+"</span>")}})),a.isAdmin&&n.createElement("span",{className:"ThemeColor3 pointer mLeft5",onClick:this.editRange},_l("\u66F4\u6539"))))),n.createElement("div",{className:"folderComment boderRadAll_3 mTop10 pAll10"},n.createElement(tt.Z,T)),n.createElement("div",{className:"folderDetailTabList boderRadAll_3 mTop10"},n.createElement("ul",{className:"folderDetailTab relative"},n.createElement("li",{className:w()("commItem ThemeBorderColor3 ThemeColor3",{active:s===1}),onClick:function(){return e.switchTabs(1)}},_l("\u8BA8\u8BBA")),n.createElement("li",{className:w()("commItem ThemeBorderColor3 ThemeColor3",{active:s===2}),onClick:function(){return e.switchTabs(2)}},_l("\u65E5\u5FD7")),s===1&&n.createElement("span",{className:w()("isOnlyLook",{checked:i}),onClick:function(){return e.setState({onlyLook:!i})}},n.createElement("i",{className:"operationCheckbox icon-ok ThemeBGColor3 ThemeBorderColor3"}),_l("\u53EA\u663E\u793A\u548C\u6211\u6709\u5173"))),n.createElement("div",{className:"folderDetailList"},s===1?n.createElement(Qt.Z,{isFocus:i,sourceId:u,sourceType:Qt.Z.TYPES.FOLDER,commentList:o,nullCommentList:this.nullCommentList(),updateCommentList:function(N){return e.setState({discussions:N})},removeComment:this.removeDiscussionsCallback,manualRef:function(N){e.commentList=N}},n.createElement(tt.Z,T)):c.map(function(C,N){return e.renderLogItems(C,N)})))))}}]),d}(n.Component);const qs=(0,re.$j)(function(v){return v.task})(Qs);var qt,ea,en=(ea=qt=function(v){(0,W.default)(d,v);function d(l){return(0,j.default)(this,d),(0,Y.default)(this,(d.__proto__||G()(d)).call(this,l))}return(0,R.default)(d,[{key:"componentDidMount",value:function(){var e=this,t=$("#container");$("html").addClass("AppTask"),this.init(this.props.folderId),t.on({"click.task":function(r){var s=$(this),i=e.props.taskConfig.folderId?s.closest("li"):s.closest("tr"),o=i.data("taskid"),c=i.data("auth"),u=!0,f=i.data("projectid"),h=e.props.taskConfig,g=h.isSubUser,T=h.filterUserId;(c===S.ZP.auth.None||c===S.ZP.auth.Look||c===S.ZP.auth.Member&&s.hasClass("lockTask"))&&(u=!1),g&&T&&(u=!0),s.hasClass("disable")&&(u=!1),u?(0,te.wY)(o,function(E,C,N){e.props.dispatch((0,B.hC)(o,C,N,"",function(F){return(0,te.sC)(F,C,N,E)}))}):alert(_l("\u60A8\u65E0\u6743\u64CD\u4F5C"),3),r.stopPropagation()}},"#tasks .markTask"),t.on("click.task","#tasks .taskStar:not(.createNewSingle .taskStar, .addNewTask .taskStar)",function(a){var r=$(this).closest("li").data("taskid")||$(this).closest("tr").data("taskid"),s=$(this).hasClass("icon-star-hollow");e.props.dispatch((0,B.IX)(r,s,function(){return(0,te.S0)(r,s)})),a.stopPropagation()}),$(document).off(".task").on("click.task",function(a){var r=$(a.target);if(r.closest("#batchTask").length<=0&&r.closest(".listStageTaskContent").length<=0&&r.closest(".dialogScroll").length<=0&&r.closest(".maskTaskBox").length<=0&&r.closest("#dialogBoxSelectUser").length<=0&&r.closest("#dialogBoxSelectUseroverlay").length<=0&&!r.parent().is(".subItem")&&r.closest(".messageDiv").length<=0&&r.closest("#batchTaskFolder_autocomplete").length<=0&&r.closest("#chooseInviteDialog").length<=0&&r.closest("#chooseInviteDialogoverlay").length<=0&&!r.closest(".quickSelectUser").length&&!r.closest(".confirm").length&&!r.closest(".selectizeiItem").length&&!r.closest("#chat").length&&!r.closest("#chatPanel").length&&$("#batchTask").length>0&&$("#batchTask").hasClass("slideLeft")&&($("#taskList .selectTask").removeClass("selectTask ThemeBGColor6"),$("#batchTask").removeClass("slideLeft").on("webkitTransitionEnd transitionEnd",function(){$(this).html("")}),$("#tasks").removeClass("slideDetail"),$("body").removeClass("userSelect")),r.closest(".singleStage .icon-arrow-down-border").length<=0&&$(".singleStage .icon-arrow-down-border ul").hide(),r.closest("#folderNavigator .folderSearch").length<=0&&$(".searchDiv .searchContent").hide(),r.closest("li.addNewTask").length<=0){if(r.closest(".addNewTask").length>0||r.closest("#dialogBoxSelectUser_container").length>0||r.is($("#dialogBoxSelectUser_mask"))||r.closest(".messageDiv").length>0||r.closest(".PositionContainer-wrapper").length>0||r.closest("#alertDialog").length>0||r.is("#dialogBoxSelectUseroverlay")||r.closest(".Calendar-range").length>0||r.closest(".TimePicker").length>0)return;$("li.addNewTask").each(function(){if(!$.trim($(this).find(".teaStageName").val())){var s=$(this).closest("li.singleStage");s.find("li.addNewTask:last").hide(),s.find(".bottomNewBox").show(),s.find(".stageContentBox").removeClass("addNewTask")}})}})}},{key:"componentWillReceiveProps",value:function(e){var t=e.pathname||"",a=t.indexOf("folder_")>-1?t.indexOf("folder_"):t.indexOf("center_folderId=");if(t!==this.props.pathname&&a>0){var r=t.indexOf("folder_")>-1?7:16,s=t.substring(a+r);s!==this.props.taskConfig.folderId&&(this.init(s),$(".folderList li").removeClass("ThemeBGColor8"),$(".folderList li[data-id="+t.substring(a+7)+"]").eq(0).addClass("ThemeBGColor8"))}this.props.hideNavigation&&e.folderId!==this.props.folderId&&this.init(e.folderId)}},{key:"componentWillUnmount",value:function(){$("html").removeClass("AppTask")}},{key:"componentWillUnmount",value:function(){$("#container").off(".task"),$("body").off(".task").removeClass("taskDetailOpen"),this.props.dispatch((0,B.os)())}},{key:"init",value:function(e){var t=(0,I.BO)("TaskCenterState"),a=location.pathname,r=a.indexOf("folder_")>-1?a.indexOf("folder_"):a.indexOf("center_folderId="),s=a.indexOf("folder_")>-1?7:16;if(r>0||e)this.setFolderOptions(e||a.substring(r+s));else if(t){var i=ee()({},this.props.taskConfig,{taskFilter:t.Active},t.Active?(0,I.Hb)(t.Active):(0,I.oy)());i.folderId&&i.folderId!==1&&a.indexOf("star")<0&&a.indexOf("subordinate")<0?this.setFolderOptions(i.folderId):(i.taskFilter=a.indexOf("star")>=0?8:a.indexOf("subordinate")>=0?9:t.Active,i.folderId="",this.props.dispatch((0,B.gP)(i)))}else{var o=a.indexOf("star")>=0?8:a.indexOf("subordinate")>=0?9:6;this.props.dispatch((0,B.gP)(ee()({},this.props.taskConfig,{taskFilter:o})))}this.props.dispatch((0,B.hp)())}},{key:"setFolderOptions",value:function(e){var t=ee()({},(0,I.oy)(),{taskFilter:"",projectId:"",folderId:e},S.ZP.clearFilterSettings);location.href.indexOf("#detail")>0&&(t.viewType=S.ZP.folderViewType.folderDetail),(0,I.yM)("",t),this.props.dispatch((0,B.gP)(t))}},{key:"renderContainer",value:function(){var e=this.props.taskConfig,t=e.taskFilter,a=e.folderId,r=e.searchKeyWords,s=e.projectId,i=this.props,o=i.folderSettings,c=i.hideNavigation;return n.createElement("div",{className:"taskMainBox flexRow borderContainer"},c?null:n.createElement(n.Fragment,null,n.createElement("div",{className:"Fixed ThemeBG leftNavHairGlass"}),n.createElement(Ea,null)),n.createElement("div",{id:"tasks",className:"flex flexColumn","data-pid":s,"data-fid":a},t!==9&&n.createElement(Ha,{hideNavigation:c}),a&&r&&this.renderFolderSearchBar(),a&&!y().isEmpty(o)&&o.code?this.renderErrorPage():n.createElement("div",{className:"taskContent flex animatedBorderFast"},t!==9&&!a&&n.createElement(hs,{emitter:this.props.emitter}),t===9&&n.createElement(rs,null),this.props.folderId&&this.props.folderId!==a?null:(a&&!y().isEmpty(o)&&a===o.folderID||a===1)&&this.renderFolderContainers())))}},{key:"renderFolderContainers",value:function(){var e=this.props,t=e.emitter,a=e.taskConfig,r=a.viewType,s=a.folderId,i=a.projectId;if(r===S.ZP.folderViewType.treeView)return n.createElement(Zs,{emitter:t});if(r===S.ZP.folderViewType.stageView)return n.createElement(bs,{emitter:t});if(r===S.ZP.folderViewType.taskGantt)return n.createElement(jt,null);if(r===S.ZP.folderViewType.folderDetail)return n.createElement(qs,null);if(r===S.ZP.folderViewType.attachment)return n.createElement(Ms,null);if(r===S.ZP.folderViewType.folderChart)return n.createElement(Rs,null)}},{key:"renderFolderSearchBar",value:function(){var e=this,t=this.props.taskConfig.searchKeyWords;return n.createElement("div",{className:"folderSearchBar boderRadAll_3"},n.createElement("span",{className:"pointer ThemeColor3",onClick:function(){return e.props.dispatch((0,B.sO)(""))}},_l("\u6E05\u9664")),n.createElement("span",{className:"mLeft20"},_l("\u6240\u6709\u4E0E\u201C%0\u201D\u76F8\u5173\u7684\u4EFB\u52A1",t)))}},{key:"renderErrorPage",value:function(){var e=this.props.folderSettings.code,t=this.props.taskConfig,a=t.taskFilter,r=t.folderId,s=t.searchKeyWords,i=t.projectId;return e===300020101?n.createElement("div",{className:"errorFolderBox"},n.createElement(ze.Z,{text:_l("\u60A8\u7684\u6743\u9650\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u67E5\u770B\u6B64\u9879\u76EE"),showBtn:!0,callback:function(){return(0,te.Al)(r)}}),";"):n.createElement("div",{className:"errorFolderBox"},n.createElement(ze.Z,{text:_l("\u9879\u76EE\u5DF2\u88AB\u5220\u9664\uFF0C\u65E0\u6CD5\u67E5\u770B")}),";")}},{key:"render",value:function(){return this.props.taskFirstSetStorage?n.createElement("div",{className:"taskMain relative"},this.renderContainer(),n.createElement("div",{id:"batchTask",className:"animatedBorderFast"})):null}}]),d}(n.Component),qt.defaultProps={folderId:"",hideNavigation:!1},ea);const tn=(0,re.$j)(function(v){return v.task})(en);var an=k(88283),rn={center:_l(" \u4EFB\u52A1"),star:_l("\u661F\u6807\u4EFB\u52A1-\u4EFB\u52A1 "),subordinate:_l("\u4E0B\u5C5E\u4EFB\u52A1-\u4EFB\u52A1 ")},sn=function(v){(0,W.default)(d,v);function d(){var l,e,t,a;(0,j.default)(this,d);for(var r=arguments.length,s=Array(r),i=0;i<r;i++)s[i]=arguments[i];return a=(e=(t=(0,Y.default)(this,(l=d.__proto__||G()(d)).call.apply(l,[this].concat(s))),t),t.renderPageTitle=function(){var o=t.props.location.pathname,c=o.match(/\/apps\/task\/(\w+)/)?o.match(/\/apps\/task\/(\w+)/)[1]:"center";if(y().includes(["center","star","subordinate"],c))return rn[c];var u=t.props.folderSettings.folderName,f=u===void 0?"":u;return f+"-\u4EFB\u52A1"},e),(0,Y.default)(t,a)}return(0,R.default)(d,[{key:"componentDidMount",value:function(){$("html").addClass("AppTask")}},{key:"componentWillUnmount",value:function(){$("html").removeClass("AppTask")}},{key:"render",value:function(){var e=this.props.location.pathname;return n.createElement(an.Z,{title:this.renderPageTitle(),pathname:e,emitter:ut.Z.emitter,component:tn})}}]),d}(n.Component);const nn=(0,re.$j)(function(v){return v.task})(sn)}}]);
