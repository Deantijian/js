"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[1926],{11926:(Ie,F,i)=>{i.r(F),i.d(F,{default:()=>fe});var U=i(88239),S=i(97553),Q=i(20845),X=i(33867),q=i(85105),L=i.n(q),R=i(99663),k=i(22600),j=i(49135),T=i(93196),e=i(67294),w=i(15028),M=i(6121),_=i(22626),z=i(70801),Ae=i(67272),ee=i(51024),te=i(45697),g=i.n(te),ae=i(93967),P=i.n(ae),E=i(30539),W=i(36021),B=i(57853),O=i(54208),le=i(46593),Z=i.n(le),G=i(10929),ne=i(96486),y=i.n(ne),x,V,se=(V=x=function(f){(0,T.default)(c,f);function c(){(0,R.default)(this,c);var s=(0,j.default)(this,(c.__proto__||L()(c)).call(this));return s.state={pageIndex:1,pageSize:50,isLoading:!1,users:null,allCount:null,keywords:""},s.getUserList=s.getUserList.bind(s),s}return(0,k.default)(c,[{key:"componentDidMount",value:function(){this.props.manualDef(this)}},{key:"componentWillMount",value:function(){this.getUserList()}},{key:"componentWillReceiveProps",value:function(t){var a=this;t.keywords!==this.props.keywords&&this.setState({keywords:t.keywords,pageIndex:1},function(){a.getUserList()})}},{key:"getUserList",value:function(){var t=this,a=this.state,l=a.pageIndex,o=a.pageSize,r=a.keywords,n=this.props,u=n.projectId,m=n.roleId,d=n.callback;return this.setState({isLoading:!0}),E.Z.getPageUserIds({pageIndex:l,pageSize:o,projectId:u,roleId:m,keywords:r}).then(function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.allCount,A=h.list;if(p===void 0)return Z().reject();t.setState({isLoading:!1,users:A,allCount:p}),d(p!==0)}).catch(function(){t.setState({isLoading:!1})})}},{key:"renderUserList",value:function(){var t=this,a=this.props,l=a.userOpAuth,o=a.isSuperAdmin,r=a.projectId,n=a.roleId,u=a.isApply,m=this.state,d=m.users,h=m.isLoading;return h?e.createElement("tr",null,e.createElement("td",{colSpan:"5",className:"listEmpty"},e.createElement(O.Z,null))):d&&d.length?e.createElement(e.Fragment,null,y().map(d,function(p){var A=p.accountId===md.global.Account.accountId;return e.createElement("tr",{key:p.accountId,className:"tdHover"},e.createElement("td",{className:"userHeadBox"},e.createElement(B.Z,{user:{userHead:p.avatar,accountId:p.accountId},size:32,projectId:r})),e.createElement("td",{className:"userName"},p.fullName),e.createElement("td",{className:"userProfession"},p.profession),e.createElement("td",{className:"userDepartment"},(p.departName||"").replace(/;/g,"\uFF1B")),u?null:e.createElement("td",{className:P()("userOperation ThemeHoverColor3",{pLeft8:t.roleUserList.clientHeight>t.roleAuthDetailScroll.clientHeight})},l&&!(A&&o)?e.createElement("span",{className:"adminHoverDeleteColor",onClick:function(){E.Z.removeUserFromRole({accountId:p.accountId,projectId:r,roleId:n}).then(function(N){N?(alert(_l("\u64CD\u4F5C\u6210\u529F")),A?location.href="/admin/sysroles/"+r:t.getUserList()):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}},A?_l("\u9000\u51FA"):_l("\u79FB\u9664")):null))})):e.createElement("tr",null,e.createElement("td",{colSpan:u?4:5,className:"listEmpty"},e.createElement("div",null,e.createElement("span",{className:"icon-empty_member mainIcon"})),e.createElement("div",{className:"mTop20"},_l("\u6682\u65E0\u6210\u5458"))))}},{key:"render",value:function(){var t=this,a=this.props.isApply,l=this.state,o=l.users,r=l.allCount,n=l.pageSize,u=l.isLoading;return e.createElement("div",{className:"roleAuthDetailTable"},e.createElement("table",{className:"w100"},e.createElement("thead",{className:"roleUserTitle"},e.createElement("tr",null,e.createElement("th",{className:"userAvatar"}),e.createElement("th",{className:"userName"},_l("\u59D3\u540D")),e.createElement("th",{className:"userProfession"},_l("\u804C\u4F4D")),e.createElement("th",{className:"userDepartment"},_l("\u90E8\u95E8")),a?null:e.createElement("th",{className:"userOperation"},_l("\u64CD\u4F5C"))))),e.createElement("div",{className:"roleAuthDetailScroll",ref:function(d){return t.roleAuthDetailScroll=d}},e.createElement("table",{className:"w100"},e.createElement("tbody",{className:"roleUserList roleUserListEmpty",ref:function(d){return t.roleUserList=d}},this.renderUserList()))),!u&&o&&r>n?e.createElement(G.Z,{total:r,pageSize:n,pageIndex:this.state.pageIndex,onChange:function(d){return t.setState({pageIndex:d},t.getUserList)}}):null)}}]),c}(e.Component),x.propTypes={projectId:g().string,roleId:g().string,userOpAuth:g().bool,isSuperAdmin:g().bool,isApply:g().bool,manualDef:g().func,callback:g().func},x.defaultProps={manualDef:function(){},callback:function(){},isApply:!1},V);const re=se;var oe=function(f){(0,T.default)(c,f);function c(){return(0,R.default)(this,c),(0,j.default)(this,(c.__proto__||L()(c)).apply(this,arguments))}return(0,k.default)(c,[{key:"renderSubPermissions",value:function(t){var a=t.length,l=function(r){var n=r.isChild,u=r.noBorder,m=r.permissionName,d=r.description,h=r.permissionId,p=r.isTypeAdmin;return p?null:e.createElement("tr",{className:P()({childPermission:n,permission:!n,noBorder:u}),key:h},e.createElement("td",{className:"pLeft25 Font13"},_l(m)),e.createElement("td",{className:"Gray_9e",colSpan:"2"},_l(d)))};return y().map(t,function(o,r){return l((0,U.default)({},o,{isChild:r>0,noBorder:a>1&&r!==a-1}))})}},{key:"renderPermissions",value:function(){var t=this,a=this.props.permissionTypes;return e.createElement(e.Fragment,null,y().map(a,function(l,o){var r=y().groupBy(l.subPermissions,function(n){var u=n.permissionId;return String(u).slice(0,3)});return e.createElement(e.Fragment,{key:l.typeId},e.createElement("tr",null,e.createElement("td",{className:"pLeft25"},e.createElement("span",{className:"Font18"},_l(l.typeName))),e.createElement("td",null,e.createElement("span",{className:"Gray_9e Font13"},_l(l.typeDescription))),l.isAdmin?e.createElement("td",{className:"TxtRight Gray_9e Font13"},e.createElement("span",null,_l("\u62E5\u6709%0\u6240\u6709\u6743\u9650",l.typeName))):null),y().map(y().keys(r),function(n){return t.renderSubPermissions(r[n])}),e.createElement("tr",null,e.createElement("td",{className:"placeholder",colSpan:"3"})))}))}},{key:"render",value:function(){var t=this.props.permissionTypes;return e.createElement("div",{className:"permissionTable"},e.createElement("table",{className:"w100"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{className:"permissionTitle pLeft25"},_l("\u6743\u9650")),e.createElement("th",{className:"permissionDescription"},_l("\u63CF\u8FF0")),e.createElement("th",{className:"permissionPlaceholder"}))),e.createElement("tbody",null,t.length?this.renderPermissions():e.createElement("tr",null,e.createElement("td",{colSpan:"3",className:"listEmpty"},e.createElement("div",{className:"mTop20"},_l("\u6682\u65E0\u6743\u9650\u8BE6\u60C5")))))))}}]),c}(e.Component);const ie=oe;var D=i(27494),Y=i(15577),ce=i(75809),H,$,me=ee.default.Search,ue=($=H=function(f){(0,T.default)(c,f);function c(){(0,R.default)(this,c);var s=(0,j.default)(this,(c.__proto__||L()(c)).call(this));return s.addMemberHander=function(t){var a=s.props,l=a.projectId,o=a.roleId;t.stopPropagation(),(0,ce.Z)({sourceId:0,fromType:0,fromAdmin:!0,SelectUserSettings:{filterAll:!0,filterFriend:!0,filterOthers:!0,filterOtherProject:!0,projectId:l,inProject:!0,callback:function(n){var u=y().map(n,function(m){return m.accountId});E.Z.addUserToRole({projectId:l,roleId:o,accountIds:u}).then(function(m){m?(alert(_l("\u64CD\u4F5C\u6210\u529F")),s.userList&&s.userList.getUserList&&s.userList.getUserList()):alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}}})},s.state={tab:"",showEdit:!1,roleName:"",addAuth:!1,userOpAuth:!1,editOpAuth:!1,deleteOpAuth:!1,isSuperAdmin:!1,permissionTypes:[],hasMember:void 0,keywords:""},s.getRolePermission=s.getRolePermission.bind(s),s}return(0,k.default)(c,[{key:"componentWillMount",value:function(){this.getRolePermission()}},{key:"getRolePermission",value:function(){var t=this,a=this.props,l=a.projectId,o=a.roleId;return E.Z.getRolePermisson({projectId:l,roleId:o}).then(function(r){M.Z.formatRoleAuth(r);var n=r.roleName,u=r.auth,m=r.addAuth,d=r.isSuperAdmin,h=r.permissionTypes;t.props.setDetailTitle(n),t.setState({roleName:n,addAuth:m,userOpAuth:u.add,editOpAuth:u.edit,deleteOpAuth:u.delete,isSuperAdmin:d,permissionTypes:h})})}},{key:"render",value:function(){var t=this,a=this.props,l=a.projectId,o=a.roleId,r=a.isApply,n=this.state,u=n.hasMember,m=n.userOpAuth,d=n.editOpAuth,h=n.deleteOpAuth,p=n.isSuperAdmin,A=n.addAuth,b=n.permissionTypes,N=n.tab,ve=n.keywords,ge=(0,Y.vo)(l,!0),K=ge.isHrVisible;return e.createElement("div",{className:"roleAuthDetailContainer"},e.createElement("div",{className:"clearfix pBottom20"},r?e.createElement("div",{className:"Left"},e.createElement(S.ZP,{type:"ghost",size:"small",className:"mLeft20",onClick:function(v){E.Z.applyRole({projectId:l,roleId:o}).then(function(C){C===1?alert(_l("\u7533\u8BF7\u6210\u529F")):C===-1?alert(_l("\u4E0D\u5141\u8BB8\u7533\u8BF7\u7BA1\u7406\u5458"),3):C===0&&alert(_l("\u7533\u8BF7\u5931\u8D25"),2)})}},_l("\u7533\u8BF7\u8BE5\u89D2\u8272\u6743\u9650"))):e.createElement("div",{className:"Left"},!md.global.Config.IsLocal&&K&&h&&u===!1?e.createElement(S.ZP,{type:"danger",size:"small",onClick:function(){z.Z.confirm({title:_l("\u60A8\u786E\u5B9A\u5220\u9664\u8BE5\u89D2\u8272\uFF1F"),description:"",onOk:function(){E.Z.removeRole({projectId:l,roleId:o}).then(function(C){var Ee=C.message,ye=C.deleteSuccess;ye?alert(_l("\u64CD\u4F5C\u6210\u529F")):alert(Ee||_l("\u64CD\u4F5C\u5931\u8D25"),2),(0,W.T8)("/admin/sysroles/"+l)})}})}},_l("\u5220\u9664")):null,K&&d?e.createElement(S.ZP,{type:"ghost",size:"small",className:"mLeft20",onClick:function(v){v.stopPropagation(),t.setState({showEdit:!0})}},_l("\u7F16\u8F91\u89D2\u8272\u6743\u9650")):null,e.createElement(S.ZP,{type:"primary",disabled:!m,size:"small",className:"mLeft20",onClick:this.addMemberHander},_l("\u6DFB\u52A0\u6210\u5458"))),e.createElement("div",{className:"Right",style:{width:"192px"}},e.createElement(me,{allowClear:!0,placeholder:_l("\u641C\u7D22"),onSearch:function(v){return t.setState({keywords:v})}}))),this.state.showEdit?e.createElement(D.Z,{type:D.Z.TYPES.EDIT,visible:!0,roleId:o,projectId:l,onOk:function(v){v?(alert(_l("\u4FEE\u6539\u6210\u529F")),t.setState({showEdit:!1}),t.getRolePermission()):alert(_l("\u4FEE\u6539\u5931\u8D25"),2)},onClose:function(){t.setState({showEdit:!1})}}):null,e.createElement("div",{className:"tabList clearfix"},e.createElement("span",{className:P()("tabItem",{"menuTab-active":N==="users"||N===""}),onClick:function(){t.setState({tab:"users"})}},_l("\u6210\u5458\u5217\u8868")),e.createElement("span",{className:P()("tabItem",{"menuTab-active":N==="permissions"}),onClick:function(){t.setState({tab:"permissions"})}},_l("\u6743\u9650\u8BE6\u60C5")),A&&N==="permissions"?e.createElement("span",{className:"Right LineHeight30 Gray_9e"},_l("\u5141\u8BB8\u89D2\u8272\u6210\u5458\u6388\u4E88\u4ED6\u4EBA\u62E5\u6709\u76F8\u540C\u6743\u9650\uFF08\u5DF2\u5F00\u542F\uFF09")):null),N!=="permissions"?e.createElement(re,{userOpAuth:m,isSuperAdmin:p,isApply:r,projectId:l,roleId:o,keywords:ve,manualDef:function(v){return t.userList=v},callback:function(v){t.setState({hasMember:v})}}):e.createElement(ie,{permissionTypes:b}))}}]),c}(e.Component),H.propTypes={projectId:g().string,roleId:g().string,isApply:g().bool},H.defaultProps={isApply:!1},$);const de=ue;var pe=function(f){(0,T.default)(c,f);function c(){(0,R.default)(this,c);var s=(0,j.default)(this,(c.__proto__||L()(c)).call(this));return s.state={pageIndex:1,pageSize:10,totalCount:null,list:null,isLoading:!1},s.fetchData=s.fetchData.bind(s),s}return(0,k.default)(c,[{key:"componentWillMount",value:function(){this.fetchData()}},{key:"fetchData",value:function(){var t=this,a=this.props.projectId,l=this.state,o=l.pageIndex,r=l.pageSize;this.setState({isLoading:!0}),this.promise=E.Z.getUnauditedUserDetail({projectId:a,pageIndex:o,pageSize:r}).then(function(n){if(n)t.setState({totalCount:n.allCount,list:n.list,isLoading:!1});else return Z().reject()}).catch(function(){t.setState({isLoading:!1})})}},{key:"renderUsers",value:function(){var t=this,a=this.props.projectId,l=this.state.list;return e.createElement(e.Fragment,null,l&&l.length?y().map(l,function(o){return e.createElement("tr",{key:o.accountId},e.createElement("td",null,e.createElement(B.Z,{className:"avatarImg",user:{userHead:o.avatar,accountId:o.accountId},size:30,projectId:a})),e.createElement("td",null,o.fullName),e.createElement("td",null,o.departName),e.createElement("td",null,o.jobName),e.createElement("td",null,o.roleName),e.createElement("td",null,e.createElement("span",{className:"Hand ThemeColor3",onClick:function(){E.Z.agreeUserToRole({accountId:o.accountId,roleId:o.roleId,projectId:a}).then(function(n){if(n)alert(_l("\u64CD\u4F5C\u6210\u529F"),1),t.fetchData();else return Z().reject()}).catch(function(){alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}},_l("\u6388\u4E88\u89D2\u8272")),e.createElement("span",{className:"Hand Red mLeft24",onClick:function(){E.Z.refuseUserToRole({accountId:o.accountId,roleId:o.roleId,projectId:a}).then(function(n){if(n)alert(_l("\u64CD\u4F5C\u6210\u529F"),1),t.fetchData();else return Z().reject()}).catch(function(){alert(_l("\u64CD\u4F5C\u5931\u8D25"),2)})}},_l("\u62D2\u7EDD"))))}):e.createElement("tr",null,e.createElement("td",{colSpan:"6",className:"listEmpty"},e.createElement("div",null,e.createElement("span",{className:"icon-empty_member mainIcon"})),e.createElement("div",{className:"mTop20"},_l("\u6682\u65E0\u7533\u8BF7")))))}},{key:"render",value:function(){var t=this,a=this.props,l=a.visible,o=a.onOk,r=a.onClose,n=this.state,u=n.isLoading,m=n.list,d=n.totalCount,h=n.pageSize,p={className:"applyRoleDialog",width:850,height:668,title:"\u7533\u8BF7\u89D2\u8272\u8BF7\u6C42",visible:l,onCancel:r,onOk:o,anim:!1,footer:null};return e.createElement(z.Z,p,u?e.createElement(O.Z,null):e.createElement(e.Fragment,null,e.createElement("div",{className:"roleApplyContainer"},e.createElement("table",{className:"w100"},e.createElement("thead",{className:"roleUserTitle"},e.createElement("tr",null,e.createElement("th",{className:"userAvatar"}),e.createElement("th",{className:"userName"},_l("\u59D3\u540D")),e.createElement("th",{className:"userDepartment"},_l("\u90E8\u95E8")),e.createElement("th",{className:"userProfession"},_l("\u804C\u4F4D")),e.createElement("th",{className:"userApplyRole"},_l("\u7533\u8BF7\u89D2\u8272")),e.createElement("th",{className:"userOperation"},_l("\u64CD\u4F5C")))),e.createElement("tbody",null,u?null:this.renderUsers())),u?e.createElement(O.Z,null):null,!u&&m&&d>h?e.createElement(G.Z,{total:d,pageSize:h,pageIndex:this.state.pageIndex,onChange:function(b){return t.setState({pageIndex:b},t.fetchData)}}):null)))}}]),c}(e.Component),J=i(99924),he=i(64712),fe=function(f){(0,T.default)(c,f);function c(s){(0,R.default)(this,c);var t=(0,j.default)(this,(c.__proto__||L()(c)).call(this,s));return t.getAllowApplyManageRole=function(a){J.Z.getAllowApplyManageRole({projectId:a.projectId}).then(function(l){t.setState({allowApplyManage:l})})},t.allowApplyAdmin=function(a){t.setState({allowApplyManage:!a},function(){J.Z.setAllowApplyManageRole({projectId:y().get(t.props,"match.params.projectId"),allowApplyManageRole:!a}).then(function(l){l?alert(_l("\u8BBE\u7F6E\u6210\u529F")):alert(_l("\u8BBE\u7F6E\u5931\u8D25"),2)})})},t.state={count:0,showCreateRole:!1,showApplyForRole:!1,detailTitle:"",allowApplyManage:!1,isSuperAdmin:!1},he.Z.setPageTitle(_l("\u7BA1\u7406\u5458")),t}return(0,k.default)(c,[{key:"componentWillMount",value:function(){var t=this,a=this.props.match.params;M.Z.checkIsSuperAdmin(a.projectId).then(function(l){t.setState({isSuperAdmin:l}),l&&(t.getCount(),t.getAllowApplyManageRole(a))})}},{key:"getCount",value:function(){var t=this,a=this.props.match.params;M.Z.getUnauditedCount(a.projectId).then(function(l){t.setState({count:l})})}},{key:"setDetailTitle",value:function(t){this.setState({detailTitle:t})}},{key:"renderMenu",value:function(){var t=this,a=this.props.match.params,l=a.projectId,o=a.roleId,r=this.state,n=r.count,u=r.allowApplyManage;return o?e.createElement("div",{className:"roleAuthHeader"},e.createElement("div",{className:"flexRow alignItemsCenter"},e.createElement(X.Z,{icon:"backspace",className:"Hand mRight10 TxtMiddle Font22 ThemeHoverColor3",onClick:function(){return(0,W.T8)("/admin/sysroles/"+l)}}),e.createElement("span",{className:"Font17 Bold"},this.state.detailTitle))):this.state.isSuperAdmin?e.createElement("div",{className:"roleListAction flexRow alignItemsCenter Normal Font13"},e.createElement(Q.Z,{className:"LineHeight36",checked:u,onClick:this.allowApplyAdmin},_l("\u5141\u8BB8\u7533\u8BF7\u7BA1\u7406\u5458")),e.createElement("div",{className:"Hand Gray_75 bold mRight32 mLeft32",onClick:function(){return t.setState({showApplyForRole:!0})}},_l("\u7533\u8BF7\u89D2\u8272\u8BF7\u6C42"),n?e.createElement("span",{className:"applyRecordCount"},n):null),(0,Y.vo)(a.projectId,!0).isHrVisible&&!md.global.Config.IsLocal&&e.createElement(S.ZP,{type:"primary",radius:!0,onClick:function(d){t.setState({showCreateRole:!0})}},_l("\u89D2\u8272")),this.state.showCreateRole?e.createElement(D.Z,{projectId:a.projectId,visible:this.state.showCreateRole,type:D.Z.TYPES.CREATE,onOk:function(d){d?(alert(_l("\u521B\u5EFA\u6210\u529F")),t.setState({showCreateRole:!1}),t.roleList&&t.roleList.fetchRoles(!0)):alert(_l("\u521B\u5EFA\u5931\u8D25"),2)},onClose:function(){t.setState({showCreateRole:!1})}}):null,this.state.showApplyForRole?e.createElement(pe,{projectId:a.projectId,visible:this.state.showApplyForRole,onClose:function(){t.setState({showApplyForRole:!1}),t.getCount()},onOk:function(){t.setState({showApplyForRole:!1}),t.getCount()}}):null):null}},{key:"render",value:function(){var t=this,a=this.props.match.params,l=a||{},o=l.roleId,r=this.state.isSuperAdmin;return e.createElement("div",{className:"orgManagementWrap"},e.createElement("div",{className:"orgManagementHeader"},!o&&e.createElement("div",null,r?_l("\u914D\u7F6E\u7BA1\u7406\u89D2\u8272"):_l("\u6211\u7684\u89D2\u8272")),this.renderMenu()),e.createElement("div",{className:"orgManagementContent"},e.createElement(w.Z,{path:"/admin/sysroles/:projectId",exact:!0,render:function(u){var m=u.match.params;return e.createElement(_.Z,(0,U.default)({},m,{manualRef:function(h){t.roleList=h}}))}}),e.createElement(w.Z,{path:"/admin/sysroles/:projectId/:roleId",exact:!0,render:function(u){var m=u.match.params;return e.createElement(de,(0,U.default)({},m,{setDetailTitle:t.setDetailTitle.bind(t)}))}})))}}]),c}(e.Component)}}]);
