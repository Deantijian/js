"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[2405],{92405:(te,y,e)=>{e.r(y),e.d(y,{default:()=>k});var ae=e(66814),N=e(91880),R=e.n(N),re=e(48388),z=e(29914),C=e.n(z),T=e(12424),Z=e(46593),H=e.n(Z),ne=e(73221),$=e(25002),E=e.n($),oe=e(80426),j=e(59012),B=e.n(j),G=e(88239),K=e(85105),V=e.n(K),J=e(99663),L=e(22600),O=e(49135),P=e(93196),r=e(67294),se=e(50533),Q=e(49227),I=e(45231),U=e(25758),m=e(26358),S=e(15577),X=e(96486),f=e.n(X),M=20,Y=function(b){(0,P.default)(h,b);function h(w){(0,J.default)(this,h);var t=(0,O.default)(this,(h.__proto__||V()(h)).call(this,w));t.requestFilterRows=function(){var a=t.props.match.params,n=t.state,o=n.loading,l=n.isMore,c=n.pageIndex,s=n.filterControls,u=n.sheetInfo,d=f().get(u,["template","controls"])||[],v=(0,S.A_)(),F=v.keyWords,x=v.searchId;t.setState({loading:!0});var A=f().find(d,{controlId:x}),p=null;if(A){var q=(0,m.z$)((0,m.BM)(A));p=(0,m.sq)((0,G.default)({},q,{type:2,values:[F]}),1)}I.Z.getFilterRows({appId:a.appId,worksheetId:a.worksheetId,searchType:1,pageSize:M,pageIndex:c,status:1,viewId:a.viewId,keyWords:x?void 0:F,filterControls:p?s.concat(p):s}).then(function(_){var W=_.data,ee=t.state.rows,g=ee.concat(W);if(g.length===1){var D="/mobile/record/"+a.appId+"/"+a.worksheetId+"/"+a.viewId+"/"+g[0].rowid;window.isMingDaoApp?location.href=D:window.mobileNavigateTo(D,!0)}t.setState({rows:g,isMore:W.length===M,pageIndex:c+1,loading:!1,dataSource:t.state.dataSource.cloneWithRows(g)})})},t.handleEndReached=function(){var a=t.state,n=a.loading,o=a.isMore;!n&&o&&t.requestFilterRows()},t.renderRow=function(a){var n=t.props.match,o=n.params,l=t.state.sheetInfo,c=l.views,s=f().find(c,{viewId:o.viewId}),u=l.template.controls.filter(function(d){return d.attribute===1||f().isEmpty(s)?!0:!s.controls.includes(d.controlId)});return r.createElement(B(),{size:"md",key:a.rowid},r.createElement(Q.Z,{key:a.rowid,data:a,view:s,controls:u,allowAdd:l.allowAdd,onClick:function(){var v="/mobile/record/"+o.appId+"/"+o.worksheetId+"/"+o.viewId+"/"+a.rowid;window.isMingDaoApp?location.href=v:window.mobileNavigateTo(v)}}))};var i=new(E()).DataSource({rowHasChanged:function(n,o){return n!==o}});return t.state={sheetInfo:{},rows:[],filterControls:[],dataSource:i,isMore:!0,loading:!0,pageIndex:1},t}return(0,L.default)(h,[{key:"componentDidMount",value:function(){var t=this,i=this.props.match.params,a=(0,S.A_)(),n=a.filterId,o=I.Z.getWorksheetInfo({appId:i.appId,worksheetId:i.worksheetId,getTemplate:!0,getViews:!0}).then(),l=n?I.Z.getWorksheetFilterById({filterId:n}):void 0;H().all([o,l]).then(function(c){var s=(0,T.Z)(c,2),u=s[0],d=s[1],v=d===void 0?{}:d;t.setState({sheetInfo:u,filterControls:(0,m.Gt)(v.items||[])}),t.requestFilterRows()})}},{key:"render",value:function(){var t=this.state,i=t.loading,a=t.isMore,n=t.rows,o=t.dataSource;return r.createElement("div",{className:"searchRecordWrapper flexColumn h100"},r.createElement("div",{className:"flex"},i&&f().isEmpty(n)?r.createElement(R(),{justify:"center",align:"center",className:"h100"},r.createElement(C(),{size:"large"})):r.createElement(r.Fragment,null,n.length?r.createElement(E(),{className:"searchSheetRowsWrapper h100",dataSource:o,renderHeader:function(){return r.createElement(r.Fragment,null)},renderFooter:function(){return a?r.createElement(R(),{justify:"center"},i?r.createElement(C(),{animating:!0}):null):r.createElement(r.Fragment,null)},pageSize:10,scrollRenderAheadDistance:500,onEndReached:this.handleEndReached,onEndReachedThreshold:10,renderRow:this.renderRow}):r.createElement("div",{className:"h100"},r.createElement(U.Kc,{text:_l("\u6CA1\u6709\u641C\u7D22\u7ED3\u679C")})))))}}]),h}(r.Component);const k=Y}}]);
