"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[7819],{37819:(O,Z,r)=>{r.r(Z),r.d(Z,{default:()=>z});var g=r(3540),N=r(97553),F=r(70801),U=r(88239),j=r(54208),A=r(33867),V=r(85105),b=r.n(V),y=r(99663),x=r(22600),C=r(49135),S=r(93196),D=r(86735),e=r(67294),T=r(93967),P=r.n(T),R=r(31261),v=r(64712),G=r(5017),E=r(27884),M=r(15577),B=r(66344),W=(0,D.Z)([`
  align-items: flex-end;
  #uploadAppIcon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    border: 1px dashed #d9d9d9;
    border-radius: 2px;
    cursor: pointer;
    margin-right: 10px;
  }
  .MdLoader-path {
    stroke: #9e9e9e;
  }
  .avatarUrl {
    width: 88%;
    border-radius: 4px;
  }
`],[`
  align-items: flex-end;
  #uploadAppIcon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    border: 1px dashed #d9d9d9;
    border-radius: 2px;
    cursor: pointer;
    margin-right: 10px;
  }
  .MdLoader-path {
    stroke: #9e9e9e;
  }
  .avatarUrl {
    width: 88%;
    border-radius: 4px;
  }
`]),H=G.ZP.div(W),K=function(f){(0,S.default)(s,f);function s(c){(0,y.default)(this,s);var a=(0,C.default)(this,(s.__proto__||b()(s)).call(this,c));return a.state={menuVisible:!1},a}return(0,x.default)(s,[{key:"render",value:function(){var a=this;return e.createElement(R.Z,{action:["click"],popupVisible:this.state.menuVisible,onPopupVisibleChange:function(l){a.setState({menuVisible:l})},popup:e.createElement("div",{className:"card pTop10 pBottom10 z-depth-2 applicationTriggerWrapper"},e.createElement("div",{className:"item pointer",onClick:function(){a.setState({menuVisible:!1}),a.props.onEdit()}},_l("\u7F16\u8F91")),e.createElement("div",{className:"item pointer",onClick:function(){a.setState({menuVisible:!1}),a.props.onDelete()}},_l("\u5220\u9664"))),popupAlign:{points:["tr","br"],offset:[0,10],overflow:{adjustX:!0,adjustY:!0}}},e.createElement(A.Z,{className:"pointer Font17 Gray_75",icon:"moreop"}))}}]),s}(e.Component),w=function(f){(0,S.default)(s,f);function s(c){(0,y.default)(this,s);var a=(0,C.default)(this,(s.__proto__||b()(s)).call(this,c));return a.state={loading:!1,uploadAvatarUrl:"",uploadAvatar:""},a}return(0,x.default)(s,[{key:"componentDidMount",value:function(){this.uploadFile()}},{key:"uploadFile",value:function(){var a=this;$(this.uploadFileEl).plupload({url:md.global.FileStoreConfig.uploadHost,file_data_name:"file",multi_selection:!1,max_file_size:"10mb",filters:{mime_types:[{title:_l("\u56FE\u7247"),extensions:"gif,png,jpg,jpeg,bmp"}],prevent_duplicates:!1,max_file_size:0},autoUpload:!1,method:{FilesAdded:function(l,n){a.setState({loading:!0});var o=[];n.forEach(function(i){var m="."+File.GetExt(i.name);o.push({bucket:2,ext:m})}),(0,M.LP)(o,6).then(function(i){n.forEach(function(m,d){m.token=i[d].uptoken,m.key=i[d].key,m.serverName=i[d].serverName,m.fileName=i[d].fileName}),l.start()})},BeforeUpload:function(l,n){var o="."+File.GetExt(n.name);l.settings.multipart_params={token:n.token},l.settings.multipart_params.key=n.key,l.settings.multipart_params["x:serverName"]=n.serverName,l.settings.multipart_params["x:filePath"]=n.key.replace(n.fileName,""),l.settings.multipart_params["x:fileName"]=n.fileName.replace(/\.[^\.]*$/,""),l.settings.multipart_params["x:originalFileName"]=encodeURIComponent(n.name.indexOf(".")>-1?n.name.split(".").slice(0,-1).join("."):n.name),l.settings.multipart_params["x:fileExt"]=o},FileUploaded:function(l,n,o){var i=JSON.parse(o.response);a.setState({uploadAvatar:""+i.fileName+i.fileExt,uploadAvatarUrl:""+i.serverName+i.key})},UploadComplete:function(){var l=a.state,n=l.uploadAvatar,o=l.uploadAvatarUrl;a.setState({loading:!1}),a.props.update({uploadAvatar:n,uploadAvatarUrl:o})}}})}},{key:"render",value:function(){var a=this,t=this.props.avatarUrl,l=this.state.uploadAvatarUrl;return e.createElement(H,{className:"flexRow"},e.createElement("div",{id:"uploadAppIcon",ref:function(o){return a.uploadFileEl=o}},this.state.loading?e.createElement(j.Z,{size:"small"}):l||t?e.createElement("img",{src:l||t,className:"avatarUrl"}):e.createElement(e.Fragment,null,e.createElement(A.Z,{icon:"add",className:"Font22 Gray_9e"}),e.createElement("div",{className:"ant-upload-text Gray_9e mTop10"},_l("\u4E0A\u4F20")))),e.createElement("span",{className:"Gray_9e"},_l("\u63A8\u8350\u5C3A\u5BF8")),e.createElement("span",{className:"Gray_9e"},"240*240px"))}}]),s}(e.Component),z=function(f){(0,S.default)(s,f);function s(c){(0,y.default)(this,s);var a=(0,C.default)(this,(s.__proto__||b()(s)).call(this,c));return a.handleSetAppSecretVisible=function(t){var l=t.appId,n=a.state.applicationList,o=n.map(function(i){return i.appId===l&&(i.appSecretVisible=!i.appSecretVisible),i});a.setState({applicationList:o})},a.handleCreateApp=function(){var t=a.state,l=t.appName,n=t.about,o=t.appUrl,i=t.callbackUrl,m=t.applicationList,d=t.currentAppItem,h=t.uploadAvatar,I=t.uploadAvatarUrl,u=t.avatarUrl;if(_.isEmpty(l)){alert("\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0",3);return}if(_.isEmpty(o)){alert("\u8BF7\u8F93\u5165\u5E94\u7528\u5730\u5740",3);return}else if(!B.Z.isUrlRequest(o)){alert("\u8BF7\u6B63\u786E\u7684 url \u5730\u5740",3);return}if(_.isEmpty(i)){alert("\u8BF7\u8F93\u5165\u56DE\u8C03\u5730\u5740",3);return}else if(!B.Z.isUrlRequest(i)){alert("\u8BF7\u6B63\u786E\u7684 url \u5730\u5740",3);return}var p={appName:l,about:n,appUrl:o,callbackUrl:i};a.setState({requestLoading:!0}),h?(p.avatar=h,p.avatarUrl=I):(p.avatar=u.replace(/.*\//g,""),p.avatarUrl=u),d?E.Z.editApplication((0,U.default)({appId:d.appId,projectId:v.Z.projectId},p)).then(function(k){a.setState({requestLoading:!1}),k?(alert(_l("\u4FEE\u6539\u6210\u529F")),a.handleHideDialog(),a.setState({applicationList:m.map(function(L){return L.appId===d.appId?(0,U.default)({},L,p):L})})):alert(_l("\u4FEE\u6539\u5931\u8D25"),2)}):E.Z.addApplication((0,U.default)({projectId:v.Z.projectId},p)).then(function(k){a.setState({requestLoading:!1}),k?(a.handleHideDialog(),a.setState({loading:!0},a.getProjectApplicationList)):alert(_l("\u521B\u5EFA\u5931\u8D25"),2)})},a.handleEdit=function(t){a.setState({dialogVisible:!0,currentAppItem:t,appName:t.appName,about:t.about,appUrl:t.appUrl,callbackUrl:t.callbackUrl,avatarUrl:t.avatarUrl})},a.handleDelete=function(t){var l=a.state.applicationList;F.Z.confirm({title:_l("\u786E\u8BA4\u5220\u9664 %0 ?",t.appName),onOk:function(){return E.Z.removeApplication({appId:t.appId,projectId:v.Z.projectId}).then(function(o){o?(alert(_l("\u5220\u9664\u6210\u529F")),a.setState({applicationList:l.filter(function(i){return i.appId!==t.appId})})):alert(_l("\u5220\u9664\u5931\u8D25"),2)})}})},a.handleHideDialog=function(){a.setState({dialogVisible:!1,currentAppItem:null,appName:"",about:"",appUrl:"",callbackUrl:"",avatarUrl:""})},v.Z.setPageTitle(_l("\u7B2C\u4E09\u65B9\u5E94\u7528")),a.state={applicationList:[],dialogVisible:!1,loading:!0,appName:"",about:"",appUrl:"",callbackUrl:"",avatarUrl:"",uploadAvatarUrl:"",currentAppItem:null,requestLoading:!1,imageLoading:!1},a}return(0,x.default)(s,[{key:"componentWillMount",value:function(){this.getProjectApplicationList()}},{key:"getProjectApplicationList",value:function(){var a=this;E.Z.getProjectApplicationList({projectId:v.Z.projectId}).then(function(t){a.setState({loading:!1,applicationList:t.map(function(l){return l.appSecretVisible=!1,l})})})}},{key:"renderItme",value:function(a){var t=this,l=a.appSecretVisible;return e.createElement("div",{className:"applicationItem flexRow TxtCenter",key:a.appId},e.createElement("div",{className:"appName overflow_ellipsis flexRow valignWrapper"},e.createElement("img",{className:"avatarUrl",src:a.avatarUrl}),e.createElement("span",null,a.appName)),e.createElement("div",{className:"about overflow_ellipsis"},a.about||"-"),e.createElement("div",{className:"appKey overflow_ellipsis"},a.appKey),e.createElement("div",{className:"appSecret flexRow valignWrapper overflow_ellipsis"},e.createElement("div",{className:"overflow_ellipsis mRight10"},l?a.appSecret:"********"),e.createElement(A.Z,{className:P()("pointer",{mBottom8:!l}),icon:l?"visibility_off":"eye",onClick:function(){t.handleSetAppSecretVisible(a)}})),e.createElement("div",{className:"appUrl overflow_ellipsis"},a.appUrl),e.createElement("div",{className:"callbackUrl overflow_ellipsis"},a.callbackUrl),e.createElement("div",{className:"operation"},e.createElement(K,{onEdit:function(){t.handleEdit(a)},onDelete:function(){t.handleDelete(a)}})))}},{key:"renderDialog",value:function(){var a=this,t=this.state,l=t.dialogVisible,n=t.appName,o=t.about,i=t.appUrl,m=t.callbackUrl,d=t.currentAppItem,h=t.requestLoading,I=t.avatarUrl;return e.createElement(F.Z,{overlayClosable:!h,title:e.createElement("span",{className:"bold"},d?_l("\u7F16\u8F91\u5E94\u7528"):_l("\u65B0\u5EFA\u5E94\u7528")),visible:l,onCancel:this.handleHideDialog,footer:e.createElement(e.Fragment,null,e.createElement(N.ZP,{onClick:this.handleHideDialog,type:"link"},_l("\u53D6\u6D88")),e.createElement(N.ZP,{onClick:this.handleCreateApp,loading:h},_l("\u786E\u5B9A")))},d&&e.createElement(e.Fragment,null,e.createElement("div",{className:"mBottom24 mTop24"},e.createElement("div",{className:"mBottom5 Gray_75 Font13"},_l("App Key")),e.createElement("div",null,d.appKey)),e.createElement("div",{className:"mBottom24 mTop24"},e.createElement("div",{className:"mBottom5 Gray_75 Font13"},_l("App Secret")),e.createElement("div",null,d.appSecret))),e.createElement("div",{className:"mBottom24 mTop24"},e.createElement("div",{className:"mBottom12"},_l("\u5E94\u7528\u56FE\u6807")),e.createElement(w,{avatarUrl:I,update:function(p){a.setState({uploadAvatar:p.uploadAvatar,uploadAvatarUrl:p.uploadAvatarUrl})}})),e.createElement("div",{className:"mBottom24 mTop24"},e.createElement("div",{className:"mBottom12"},_l("\u5E94\u7528\u540D\u79F0")),e.createElement(g.Z,{className:"w100",value:n,onChange:function(p){a.setState({appName:p})}})),e.createElement("div",{className:"mBottom24"},e.createElement("div",{className:"mBottom12"},_l("\u5E94\u7528\u7B80\u4ECB")),e.createElement(g.Z,{className:"w100",value:o,onChange:function(p){a.setState({about:p})}})),e.createElement("div",{className:"mBottom24"},e.createElement("div",{className:"mBottom12"},_l("\u5E94\u7528\u5730\u5740")),e.createElement(g.Z,{className:"w100",value:i,onChange:function(p){a.setState({appUrl:p})}})),e.createElement("div",{className:"mBottom24"},e.createElement("div",{className:"mBottom12"},_l("\u56DE\u8C03\u5730\u5740")),e.createElement(g.Z,{className:"w100",value:m,onChange:function(p){a.setState({callbackUrl:p})}})))}},{key:"render",value:function(){var a=this,t=this.state,l=t.applicationList,n=t.loading;return e.createElement("div",{className:"thirdpartyAppWrapper card"},e.createElement("div",{className:"header flexRow valignWrapper"},e.createElement("div",{className:"flex Font17 bold"},_l("\u7B2C\u4E09\u65B9\u5E94\u7528\u7BA1\u7406")),e.createElement(N.ZP,{onClick:function(){a.setState({dialogVisible:!0})}},_l("\u65B0\u5EFA"))),e.createElement("div",{className:"applicationListWrapper"},e.createElement("div",{className:"applicationHeader flexRow TxtCenter"},e.createElement("div",{className:"appName"},_l("\u5E94\u7528\u540D\u79F0")),e.createElement("div",{className:"about"},_l("\u7B80\u4ECB")),e.createElement("div",{className:"appKey"},_l("App Key")),e.createElement("div",{className:"appSecret"},_l("App Secret")),e.createElement("div",{className:"appUrl"},_l("\u5E94\u7528\u5730\u5740")),e.createElement("div",{className:"callbackUrl"},_l("\u56DE\u8C03\u5730\u5740")),e.createElement("div",{className:"operation"},_l("\u64CD\u4F5C"))),n?e.createElement(j.Z,{className:"mTop20 mBottom20",size:"big"}):l.length?l.map(function(o){return a.renderItme(o)}):e.createElement("div",{className:"TxtCenter mTop20 mBottom20 Font15 Gray_75"},_l("\u6682\u65E0\u6570\u636E"))),this.renderDialog())}}]),s}(e.Component)}}]);
