"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[9501],{49501:(et,g,t)=>{t.r(g),t.d(g,{default:()=>k});var x=t(54208),R=t(85105),L=t.n(R),p=t(99663),y=t(22600),T=t(49135),B=t(93196),F=t(88239),a=t(67294),M=t(96841),N=t(74127),E=t(15308),Y=t(31623),j=t(49611),C=t.n(j),P=t(94942),H=t.n(P),Z=t(36803),V=t(46593),m=t.n(V),z=t(29306),A=t.n(z),J=function(o){return new(m())(function(i,n){A().toPng(o).then(function(e){var r=new Image;r.onload=function(){i(r)},r.src=e}).catch(function(e){console.error("oops, something went wrong!",e),i()})})},K=function(){function l(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,p.default)(this,l),this.canvas=document.createElement("canvas"),this.canvas.width=o.bgWidth,this.canvas.height=o.bgHeight,this.ctx=this.canvas.getContext("2d"),this.title=o.title}return(0,y.default)(l,[{key:"mergeRun",value:function(){var o=(0,Z.Z)(H().mark(function n(e){var r=this,s,u;return H().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s=e.map(function(c){var h=c.el;return J(h)}),d.next=3,m().all(s);case 3:u=d.sent,u.map(function(c,h){if(c){var W=e[h],I=W.x,b=I===void 0?0:I,G=W.y,q=G===void 0?0:G,D=e[h].el,_=D.offsetWidth,tt=D.offsetHeight;r.ctx.drawImage(c,b,q,_,tt)}});case 5:case"end":return d.stop()}},n,this)}));function i(n){return o.apply(this,arguments)}return i}()},{key:"download",value:function(){var i=this;return new(m())(function(n,e){i.canvas.toBlob(function(r){try{saveAs(r,i.title),setTimeout(function(){n(r)},1e3)}catch(s){e()}})})}}]),l}(),O=function(o){return new(m())(function(i,n){var e=document.querySelector(".gunterDirectoryHeader"),r=document.querySelector(".gunterGroupingScroller"),s=document.querySelector(".gunterChartHeader .headerScroll"),u=document.querySelector(".gunterChartScroller"),f=new K({bgWidth:r.offsetWidth+s.offsetWidth,bgHeight:e.offsetHeight+r.offsetHeight,title:o});f.mergeRun([{el:e,x:0,y:0},{el:r,x:0,y:e.offsetHeight},{el:s,x:e.offsetWidth,y:0},{el:u,x:e.offsetWidth,y:s.offsetHeight}]).then(function(){f.download().then(function(d){d?window.close():i(!0)}).catch(function(){i(!0)})})})};const Q=O;var U=t(96486),v=t.n(U),X=t(30381),$=t.n(X),S,w,k=(S=(0,M.$j)(function(l){return(0,F.default)({},v().pick(l.sheet,["base","views"]),v().pick(l.sheet.gunterView,["loading"]))},function(l){return(0,N.DE)({updateBase:E.updateBase,loadWorksheet:E.loadWorksheet},l)}),S(w=function(l){(0,B.default)(o,l);function o(i){(0,p.default)(this,o);var n=(0,T.default)(this,(o.__proto__||L()(o)).call(this,i));return n.state={error:!1},n}return(0,y.default)(o,[{key:"componentDidMount",value:function(){var n=this.props.match;this.props.updateBase(n.params),this.props.loadWorksheet(n.params.worksheetId)}},{key:"componentWillReceiveProps",value:function(n){var e=this,r=n.loading,s=n.views,u=n.base;r!==this.props.loading&&setTimeout(function(){var f=v().find(s,{viewId:u.viewId}),d=""+f.name+$()().format("_YYYYMMDDHHmmSS");Q(d).then(function(c){c&&e.setState({error:!0})})},1e3)}},{key:"renderContent",value:function(){var n=this.props,e=n.base,r=n.views;if(r.length){var s=v().find(r,{viewId:e.viewId});return a.createElement(a.Fragment,null,a.createElement(Y.Z,{view:s}),a.createElement(C(),{title:_l("%0\u6B63\u5728\u5BFC\u51FA\uFF0C\u8BF7\u7A0D\u5019...",s.name)}))}else return a.createElement("div",null,"gunter loading")}},{key:"renderLoading",value:function(){var n=this.state.error,e=this.props,r=e.base,s=e.views,u=v().find(s,{viewId:r.viewId});return a.createElement("div",{className:"gunterExportLoading"},a.createElement("div",{className:"flexColumn"},n?a.createElement(a.Fragment,null,a.createElement("div",{className:"mTop10 Gray_75"},_l("\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u7F29\u5C0F\u89C6\u56FE\u7C7B\u578B\u518D\u5C1D\u8BD5~")),a.createElement(C(),{title:_l("\u5BFC\u51FA\u5931\u8D25")})):a.createElement(a.Fragment,null,a.createElement(x.Z,{size:"big"}),a.createElement("div",{className:"mTop10 Gray_75"},_l("%0\u6B63\u5728\u5BFC\u51FA\uFF0C\u8BF7\u7A0D\u7B49...",u?u.name:"")))))}},{key:"render",value:function(){return a.createElement(a.Fragment,null,this.renderContent(),this.renderLoading())}}]),o}(a.Component))||w)}}]);
