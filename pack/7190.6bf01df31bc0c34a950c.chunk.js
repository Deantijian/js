"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[7190],{17190:(me,L,a)=>{a.r(L),a.d(L,{default:()=>te});var b=a(25273),Z=a(57853),O=a(66215),G=a(54208),ge=a(34279),y=a(64749),v=a(33867),F=a(88239),W=a(85105),P=a.n(W),M=a(99663),H=a(22600),$=a(49135),z=a(93196),e=a(67294),B=a(53825),V=a(36070),X=a(71411),Y=a(63025),J=a(10929),K=a(49365),Q=a(28829),x=a(60235),h=a(15577),N=a(77863),w=a(36021),p=a(81872),q=a(32415),ee=a(93967),T=a.n(ee),te=function(ae){(0,z.default)(f,ae);function f(I){(0,M.default)(this,f);var t=(0,$.default)(this,(f.__proto__||P()(f)).call(this,I));return t.getList=function(){var l=t.props.match.params.projectId,r=t.state,c=r.appId,o=r.keyWords,n=r.pageIndex,i=r.taskStatus,g=r.isAsc,u=r.sortId;t.setState({loading:!0}),t.ajaxPromise&&t.ajaxPromise.abort(),t.ajaxPromise=x.Z.list({projectId:l,pageNo:n-1,pageSize:50,searchBody:o,sort:{fieldName:u,sortDirection:g?"ASC":"DESC"},taskType:1,appId:c||void 0,status:i||void 0,type:1}),t.ajaxPromise.then(function(m){m&&t.setState({list:m.content,count:m.totalElements,loading:!1})})},t.getAggregationTableUsage=function(){var l=t.props.match.params||{},r=l.projectId;Q.Z.getProjectLicenseSupportInfo({projectId:r,onlyUsage:!0}).then(function(c){var o=c.limitAggregationTableCount,n=o===void 0?20:o,i=c.effectiveAggregationTableCount,g=i===void 0?0:i;t.setState({limitAggregationTableCount:n,effectiveAggregationTableCount:g})})},t.searchDataList=_.throttle(function(){t.getList()},200),t.changeTask=function(l){var r=t.props.match.params||{},c=r.projectId,o=t.state.list,n=o===void 0?[]:o;t.changeTaskAjax&&t.changeTaskAjax.abort(),l.taskStatus===p.xO.RUNNING?t.changeTaskAjax=x.Z.stopTask({projectId:c,taskId:l.id}):t.changeTaskAjax=x.Z.startTask({projectId:c,taskId:l.id}),t.changeTaskAjax.then(function(i){var g=l.taskStatus===p.xO.RUNNING?i:(i||{}).isSucceeded,u=i.errorMsg;g?t.setState({list:n.map(function(m){return l.id===m.id?(0,F.default)({},l,{taskStatus:l.taskStatus!==p.xO.RUNNING?p.xO.RUNNING:p.xO.STOP}):m})}):alert(u||_l("\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),2)},function(){setState({updating:!1})})},t.state={appList:[{label:_l("\u5168\u90E8\u5E94\u7528"),value:""}],appId:"",taskStatus:"",pageIndex:1,list:[],sortId:"createDate"},t.ajaxPromise=null,t.changeTaskAjax=null,t}return(0,H.default)(f,[{key:"componentDidMount",value:function(){var t=this.props.match.params||{},l=t.projectId,r=(0,h.XH)(l,N.UU.aggregation);this.getList(),!(!r||r==="2")&&this.getAggregationTableUsage()}},{key:"getAppList",value:function(){var t=this,l=this.state.appList,r=this.props.match.params||{},c=r.projectId;K.Z.getAppsForProject({projectId:c,status:"",order:3,pageIndex:1,pageSize:1e5,keyword:""}).then(function(o){var n=o.apps,i=n.map(function(g){return{label:g.appName,value:g.appId}});t.setState({appList:l.concat(i)})})}},{key:"render",value:function(){var t=this,l=this.props.match,r=l===void 0?{}:l,c=r.params||{},o=c.projectId,n=this.state,i=n.appList,g=n.appId,u=n.sortId,m=n.isAsc,ne=n.loading,R=n.pageIndex,U=n.list,A=U===void 0?[]:U,se=n.count,le=n.taskStatus,k=n.limitAggregationTableCount,E=k===void 0?0:k,D=n.effectiveAggregationTableCount,S=D===void 0?0:D,re=(0,h.XH)(o,N.UU.aggregation);return e.createElement("div",{className:"orgManagementWrap aggregationTableWrap"},e.createElement(V.Z,{prefix:_l("\u4F7F\u7528\u5206\u6790")}),e.createElement("div",{className:"orgManagementHeader"},_l("\u805A\u5408\u8868")),e.createElement("div",{className:"orgManagementContent flexColumn"},e.createElement("div",{className:"appManagementCount"},re==="2"?e.createElement(e.Fragment,null,e.createElement("span",null,_l("\u5347\u7EA7\u7248\u672C\u540E\u53EF\u5728\u5E94\u7528\u4E2D\u521B\u5EFA\u805A\u5408\u8868")),e.createElement("a",{href:"javascript:void(0);",className:"ThemeColor3 ThemeHoverColor2 mLeft20 NoUnderline",onClick:function(){return(0,h.j0)(o,N.UU.aggregation)}},_l("\u5347\u7EA7"))):e.createElement(e.Fragment,null,e.createElement("span",{className:"Gray_9e mRight5"},_l("\u5DF2\u542F\u7528\u805A\u5408\u8868\u4E2A\u6570")),e.createElement("span",{className:"bold"},_l("%0 / %1 \u4E2A",S,E)),e.createElement("span",{className:"Gray_9e mLeft15 mRight5"},_l("\u5269\u4F59")),e.createElement("span",{className:"bold"},_l("%0\u4E2A",E-S)),e.createElement(B.Z,{className:T()("ThemeColor3 ThemeHoverColor2  NoUnderline mLeft5"),to:"/admin/exaggregationtable/"+o+"/aggregationtable"},_l("\u6269\u5145")))),e.createElement("div",{className:"flexRow"},e.createElement(y.default,{className:"w180 mdAntSelect mRight20",showSearch:!0,defaultValue:g,options:i,onFocus:function(){return i.length===1&&t.getAppList(o)},filterOption:function(d,j){return i.find(function(C){return C.value===j.value}).label.toLowerCase().indexOf(d.toLowerCase())>-1},suffixIcon:e.createElement(v.Z,{icon:"arrow-down-border Font14"}),notFoundContent:e.createElement("span",{className:"Gray_9e"},_l("\u65E0\u641C\u7D22\u7ED3\u679C")),onChange:function(d){return t.setState({appId:d,pageIndex:1},t.searchDataList)}}),e.createElement(y.default,{className:"w180 mdAntSelect mLeft15",defaultValue:le,options:[{label:_l("\u5168\u90E8\u72B6\u6001"),value:""},{label:_l("\u672A\u53D1\u5E03"),value:"UN_PUBLIC"},{label:_l("\u8FD0\u884C\u4E2D"),value:"RUNNING"},{label:_l("\u505C\u6B62"),value:"STOP"},{label:_l("\u5F02\u5E38"),value:"ERROR"},{label:_l("\u521B\u5EFA\u4E2D"),value:"CREATING"}],suffixIcon:e.createElement(v.Z,{icon:"arrow-down-border Font14"}),onChange:function(d){return t.setState({taskStatus:d},t.searchDataList)}}),e.createElement("div",{className:"flex"}),e.createElement(Y.Z,{placeholder:_l("\u805A\u5408\u8868\u540D\u79F0 / \u521B\u5EFA\u4EBA"),handleChange:function(d){t.setState({keyWords:d,list:[],pageIndex:1},t.searchDataList)}})),e.createElement("div",{className:"flexRow listHeader bold mTop16"},e.createElement("div",{className:"flex pLeft10"},_l("\u805A\u5408\u8868\u540D\u79F0")),e.createElement("div",{className:"columnWidth"},_l("\u72B6\u6001")),e.createElement("div",{className:"columnWidth flexRow"},e.createElement("div",{className:"pointer ThemeHoverColor3 pRight12",onClick:function(){return t.setState({isAsc:u==="createDate"?!m:!1,sortId:"createDate"},t.searchDataList)}},_l("\u521B\u5EFA\u65F6\u95F4")),e.createElement("div",{className:"flexColumn manageListOrder pointer",onClick:function(){return t.setState({isAsc:u==="createDate"?!m:!1,sortId:"createDate"},t.searchDataList)}},e.createElement(v.Z,{icon:"arrow-up",className:T()({ThemeColor3:m&&u==="createDate"})}),e.createElement(v.Z,{icon:"arrow-down",className:T()({ThemeColor3:!m&&u==="createDate"})}))),e.createElement("div",{className:"w140"},_l("\u521B\u5EFA\u4EBA"))),e.createElement("div",{className:"flex"},ne&&R===1?e.createElement(G.Z,{className:"mTop15"}):_.isEmpty(A)?e.createElement(X.Z,{className:"pTop0 h100",detail:{icon:"icon-business1",desc:_l("\u6682\u65E0\u805A\u5408\u8868")}}):e.createElement(b.Z,{className:"w100 h100"},A.map(function(s){var d=s.name,j=s.appName,C=s.taskStatus,oe=s.createDate,ie=s.creatorName,ce=s.creatorAvatar,de=s.createBy;return e.createElement("div",{className:"flexRow alignItemsCenter listContent"},e.createElement("div",{className:"flex flexRow pLeft10"},e.createElement("div",{className:"iconWrap",style:{backgroundColor:s.taskStatus!==p.xO.RUNNING?"#bdbdbd":"#0096EF"}},e.createElement(v.Z,{icon:"aggregate_table",className:"Font24 White"})),e.createElement("div",{className:"flex flexColumn name mLeft10 mRight40 ellipsis"},e.createElement("div",{className:"ellipsis Font14",title:d},d),e.createElement("div",{className:"ellipsis Font12 Gray_bd",title:s.apkName},j))),e.createElement("div",{className:"columnWidth"},e.createElement(O.Z,{className:"TxtMiddle tableSwitch mRight10",checked:C===p.xO.RUNNING,text:C===p.xO.RUNNING?_l("\u540C\u6B65"):_l("\u5173\u95ED"),onClick:function(){if(E&&S===E){(0,h.Yg)({projectId:o,featureId:N.UU.aggregation,okText:_l("\u7ACB\u5373\u8D2D\u4E70"),onOk:function(){return(0,w.T8)("/admin/exaggregationtable/"+o+"/aggregationtable")}});return}t.changeTask(s)}})),e.createElement("div",{className:"columnWidth"},(0,q.p6)(oe)),e.createElement("div",{className:"w140 flexRow alignItemsCenter"},e.createElement(Z.Z,{projectId:o,size:28,user:{userHead:ce,accountId:de}}),e.createElement("div",{className:"mLeft12 ellipsis flex mRight20"},ie)))}))),!_.isEmpty(A)&&e.createElement(J.Z,{total:se,pageIndex:R,pageSize:50,onChange:function(d){return t.setState({pageIndex:d},t.getList)}})))}}]),f}(e.Component)}}]);
