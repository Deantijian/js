"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[4506],{44506:(_,C,t)=>{t.r(C),t.d(C,{default:()=>w});var c=t(12424),e=t(67294),G=t(36070),F=t(96486),x=t.n(F),M=t(25273),B=t(6100),T=t(54208),R=t(33867),D=t(66946),O=t(93002),z=t(93967),N=t.n(z),H=t(12935),P=t(49365);function K(s){var o=s.projectId,u=s.activeItem,E=s.onSelect,r=(0,e.useState)([]),S=(0,c.Z)(r,2),I=S[0],p=S[1],d=(0,O.Z)({pageIndex:1,loading:!0,noMore:!1,keyWords:""}),i=(0,c.Z)(d,2),a=i[0],v=i[1],V=function(){a.loading&&P.Z.getAppsByProject({projectId:o,status:"",order:3,pageSize:50,pageIndex:a.pageIndex,keyword:a.keyWords}).then(function(m){var n=m.apps;p(a.pageIndex>1?I.concat(n):n),v({loading:!1,noMore:n.length<50})})};(0,e.useEffect)(V,[a.loading,a.pageIndex,a.keyWords]);var f=(0,e.useCallback)(x().debounce(function(l){v({loading:!0,pageIndex:1,keyWords:l})},500),[]),L=function(){!a.noMore&&!a.loading&&v({loading:!0,pageIndex:a.pageIndex+1})};return e.createElement("div",{className:"globalVarLeft"},e.createElement("div",{className:"leftTitle"},e.createElement("div",{className:"Bold Font17"},_l("\u5168\u5C40\u53D8\u91CF")),e.createElement(D.Z,{text:_l("\u5E2E\u52A9"),type:2,href:"https://help.mingdao.com/workflow/node-update-global-variables"})),e.createElement("div",{className:N()("listItem",{isActive:u==="project"}),onClick:function(){return E("project")}},e.createElement(R.Z,{icon:"company"}),_l("\u7EC4\u7EC7")),e.createElement(H.Z,{className:"searchCon mLeft18",placeholder:_l("\u641C\u7D22\u5E94\u7528"),onChange:f}),e.createElement("div",{className:"Gray_9e mBottom8 pLeft30"},_l("\u6309\u5E94\u7528")),e.createElement(M.Z,{onScrollEnd:L},a.pageIndex===1&&a.loading?e.createElement(T.Z,{className:"mTop10"}):e.createElement("div",null,I.length?I.map(function(l){return e.createElement("div",{className:N()("listItem",{isActive:u===l.appId}),onClick:function(){return E(l.appId)}},e.createElement("div",{className:"appIcon",style:{background:l.iconColor}},e.createElement(B.Z,{url:l.iconUrl,fill:"#fff",size:12})),e.createElement("span",{className:"overflow_ellipsis",title:l.appName},l.appName))}):e.createElement("div",{className:"mTop10 pLeft30 Gray_9e"},a.keyWords?_l("\u6682\u65E0\u641C\u7D22\u7ED3\u679C"):_l("\u6682\u65E0\u5E94\u7528")))),a.pageIndex>1&&a.loading&&e.createElement(T.Z,{className:"mTop10"}))}var X=t(51197),J=t(63025),Q=t(92410),Y=t(47004),b=t(15577),U=t(77863);function $(s){var o=s.projectId,u=s.activeItem,E=s.loading,r=s.varList,S=s.onRefreshVarList,I=(0,e.useState)(""),p=(0,c.Z)(I,2),d=p[0],i=p[1],a=(0,e.useState)({visible:!1,isEdit:!1}),v=(0,c.Z)(a,2),V=v[0],f=v[1],L=(0,e.useState)({}),l=(0,c.Z)(L,2),m=l[0],n=l[1],g=(0,e.useState)(""),h=(0,c.Z)(g,2),q=h[0],y=h[1],A=(0,b.XH)(o,U.UU.globalVariable);return e.createElement("div",{className:"globalVarRight flexColumn"},e.createElement("div",{className:"rightHeader"},e.createElement(J.Z,{className:"varSearch",placeholder:_l("\u641C\u7D22\u53D8\u91CF\u540D\u79F0"),handleChange:x().debounce(function(Z){i(Z)},500)}),e.createElement("div",{className:N()("addBtn",{needUpgrade:A==="2"}),onClick:function(){A==="2"?(0,b.j0)(o,U.UU.globalVariable):f({visible:!0,isEdit:!1})}},e.createElement(R.Z,{icon:"add"}),e.createElement("span",null,u==="project"?_l("\u7EC4\u7EC7\u53D8\u91CF"):_l("\u5E94\u7528\u53D8\u91CF")),A==="2"&&e.createElement(X.Z,null))),e.createElement("div",{className:"flex mTop8"},e.createElement(Q.Z,{data:r.filter(function(Z){return Z.name.indexOf(d)>-1}),loading:E,onRefreshVarList:S,emptyText:d?_l("\u6682\u65E0\u641C\u7D22\u7ED3\u679C"):_l("\u6682\u65E0\u5168\u5C40\u53D8\u91CF"),onAdd:function(j){f({visible:!0,isEdit:!1}),n({name:j})},onEdit:function(j){y(j.id),f({visible:!0,isEdit:!0}),n(j)},activeId:q,setActiveId:y,projectId:o})),e.createElement(Y.Z,{visible:V.visible,isEdit:V.isEdit,onClose:function(){f({visible:!1}),n({}),y("")},projectId:o,appId:u==="project"?"":u,defaultFormValue:m,onRefreshVarList:S}))}var k=t(25488),W=t(11797);function w(s){var o=s.match.params.projectId,u=(0,e.useState)("project"),E=(0,c.Z)(u,2),r=E[0],S=E[1],I=(0,e.useState)([]),p=(0,c.Z)(I,2),d=p[0],i=p[1],a=(0,e.useState)(!0),v=(0,c.Z)(a,2),V=v[0],f=v[1];(0,e.useEffect)(function(){k.Z.gets({sourceId:r==="project"?o:r,sourceType:r==="project"?0:1}).then(function(l){f(!1),l.resultCode===1?i(l.variables):i([])})},[r]);var L=function(m,n){var g=[];m===W.nt.ADD?(g=d.concat([n]),i(g)):m===W.nt.UPDATE?(g=d.map(function(h){return h.id===n.id?n:h}),i(g)):(g=d.filter(function(h){return h.id!==n.id}),i(g))};return e.createElement("div",{className:"globalVarWrapper"},e.createElement(G.Z,{prefix:_l("\u5168\u5C40\u53D8\u91CF")}),e.createElement(K,{projectId:o,activeItem:r,onSelect:function(m){return S(m)}}),e.createElement($,{key:r,projectId:o,activeItem:r,loading:V,varList:d,onRefreshVarList:L}))}}}]);
