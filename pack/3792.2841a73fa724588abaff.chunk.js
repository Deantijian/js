"use strict";(self.webpackChunkmingdao_web=self.webpackChunkmingdao_web||[]).push([[3792],{3792:(ke,K,l)=>{l.r(K),l.d(K,{default:()=>De});var te=l(85105),P=l.n(te),j=l(99663),H=l(22600),M=l(49135),Y=l(93196),e=l(67294),ae=l(36070),ne=l(81274),N=l(88106),F=l(12424),le=l(43727),re=l(97553),se=l(70801),oe=l(57853),V=l(20845),ie=l(25273),G=l(54208),L=l(33867),ce=l(88239),de=l(53825),me=l(93967),h=l.n(me),ue=l(63025),b=l(10929),A=l(35989),pe=l(28829),he=l(96486),J=l.n(he),fe=l(30381),D=l.n(fe),ve=[{key:["lastTimeStart","lastTimeTimeEnd"],text:_l("\u6700\u8FD1\u767B\u5F55\u65F6\u95F4"),id:"last"},{key:["createTimeStart","createTimeEnd"],text:_l("\u6CE8\u518C\u65F6\u95F4"),id:"create"}],Q=function(s){return D()(s).format("YYYY-MM-DD")},v=function(s,i){return i==="start"?s&&s+" 00:00":s&&s+" 23:59"},ge=function(f){(0,Y.default)(s,f);function s(i){(0,j.default)(this,s);var t=(0,M.default)(this,(s.__proto__||P()(s)).call(this,i));return t.postList=null,t.updateState=function(a){t.setState((0,ce.default)({list:null,pageIndex:1},a),t.getPortalList)},t.changPage=function(a){t.setState({pageIndex:a},t.getPortalList)},t.state={list:null,total:0,selectedColumnIds:[],loading:!1,projectId:"",apps:[],appId:"",keywords:"",pageIndex:1,pageSize:50,createTimeStart:"",createTimeEnd:"",lastTimeStart:"",lastTimeTimeEnd:"",sortType:0,expireDays:0,limitExternalUserCount:0,allowUpgradeExternalPortal:!1,showOption:!1,allCount:0},t}return(0,H.default)(s,[{key:"componentDidMount",value:function(){var t=this,a=this.props.projectId;pe.Z.getProjectLicenseSupportInfo({projectId:a}).then(function(n){t.setState({expireDays:(n.nextLicense||{}).expireDays,limitExternalUserCount:n.limitExternalUserCount,allowUpgradeExternalPortal:n.allowUpgradeExternalPortal,projectId:a,showOption:n.licenseType===1,loading:!0},function(){t.getPortalList(),t.getApps()})})}},{key:"getApps",value:function(){var t=this;A.Z.getAppInfoByProject({projectId:this.state.projectId,pageIndex:0,pageSize:0}).then(function(a){t.setState({apps:(a.apps||[]).map(function(n){var r=n.appId,o=n.appName;return{text:o,value:r}})})})}},{key:"getPortalList",value:function(){var t=this,a=this.state,n=a.pageIndex,r=a.pageSize,o=a.keywords,c=a.createTimeStart,m=a.createTimeEnd,k=a.lastTimeStart,g=a.lastTimeTimeEnd,y=a.sortType,x=a.appId,u=a.projectId;this.setState({loading:!0}),this.postList&&this.postList.abort(),this.postList=A.Z.getUsers({projectId:u,pageIndex:n,pageSize:r,keywords:o,createTimeStart:v(c,"start"),createTimeEnd:v(m,"end"),lastTimeStart:v(k,"start"),lastTimeTimeEnd:v(g,"end"),appId:x,sortType:y,isReturnTotal:n===1}),this.postList.then(function(E){var U=E.users,T=E.total;t.setState({list:U,loading:!1,total:n===1?T:t.state.total,allCount:n===1&&!x&&!v(c,"start")&&!v(m,"end")&&!v(k,"start")&&!v(g,"end")&&!o&&y===0?T:t.state.allCount})})}},{key:"renderList",value:function(){var t=this,a=this.state,n=a.list,r=a.pageIndex,o=a.loading;if(n!==null)return n.length?e.createElement(ie.Z,{className:"flex"},o?e.createElement(G.Z,{className:"mTop15",size:"small"}):n.map(function(c){return t.renderListItem(c)})):e.createElement("div",{className:"manageListNull flex flexColumn"},e.createElement("div",{className:"iconWrap"},e.createElement(L.Z,{icon:"draft-box"})),e.createElement("div",{className:"emptyExplain"},_l("\u65E0\u6570\u636E")))}},{key:"renderListItem",value:function(t){var a=this,n=this.state.selectedColumnIds,r=n===void 0?[]:n;return e.createElement("div",{className:"flexRow manageList",key:t.accountId},e.createElement("div",{className:"w40 mRight20"},e.createElement(V.Z,{size:"small",checked:r.includes(t.accountId),onClick:function(){return a.handleSelect(t.accountId)}})),e.createElement("div",{className:"flex name mLeft10 mRight40 flexRow minWidth110"},e.createElement(oe.Z,{size:28,user:{userHead:t.avatar,accountId:t.accountId},appId:t.appId,projectId:this.props.projectId}),e.createElement("div",{className:"mLeft12 ellipsis flex mRight20"},t.name)),e.createElement("div",{className:"w150 ellipsis"},t.mobilePhone),e.createElement("div",{className:"w150 ellipsis"},t.email),e.createElement("div",{className:"columnWidth ellipsis"},t.appName),e.createElement("div",{className:"columnWidth ellipsis"},t.createTime?D()(t.createTime).format("YYYY\u5E74MM\u6708DD\u65E5 HH:mm"):""),e.createElement("div",{className:"columnWidth ellipsis"},t.lastTime?D()(t.lastTime).format("YYYY\u5E74MM\u6708DD\u65E5 HH:mm"):""),e.createElement("div",{className:"w60 mRight20 TxtCenter"},e.createElement("span",{className:"Hand deleteBtn",onClick:function(){return a.handleDelete([t.accountId])}},_l("\u5220\u9664"))))}},{key:"handleSelect",value:function(t){this.setState({selectedColumnIds:J().includes(this.state.selectedColumnIds,t)?this.state.selectedColumnIds.filter(function(a){return a!==t}):this.state.selectedColumnIds.concat([t])})}},{key:"handleDelete",value:function(t){var a=this;se.Z.confirm({title:e.createElement("span",{className:"Red Font17 Bold"},_l("\u5220\u9664\u7528\u6237")),description:_l("\u5220\u9664\u540E\u7528\u6237\u9700\u8981\u91CD\u65B0\u6CE8\u518C\u624D\u53EF\u8BBF\u95EE\u6240\u5728\u7684\u5E94\u7528"),onOk:function(){var r=t.map(function(o){return{exAccountId:o,appId:(J().find(a.state.list||[],function(c){return c.accountId===o})||{}).appId}});A.Z.removeUsersByPorject({projectId:a.state.projectId,exAccountInfos:r}).then(function(o){o&&(alert(_l("\u5220\u9664\u6210\u529F")),a.updateState({selectedColumnIds:[]}))})}})}},{key:"render",value:function(){var t=this,a=this.state,n=a.loading,r=a.pageIndex,o=a.list,c=a.selectedColumnIds,m=a.allowUpgradeExternalPortal,k=a.expireDays,g=a.limitExternalUserCount,y=a.apps,x=a.appId,u=a.sortType,E=a.showOption,U=a.total,T=a.allCount,q=(o||[]).length;return e.createElement("div",{className:"portalManagementList h100 flexColumn"},e.createElement("div",{className:"appManagementCount flexRow"},e.createElement("span",{className:"Gray_9e mRight5"},_l("\u8BA1\u8D39\u5916\u90E8\u7528\u6237\u4EBA\u6570")),e.createElement("span",{className:"bold"},T," / ",g),e.createElement("span",{className:"Gray_9e mLeft15 mRight5"},_l("\u5269\u4F59")),e.createElement("span",{className:"bold"},_l("%0\u4EBA",g-T<0?0:g-T)),m&&E&&e.createElement("span",{className:"mLeft20"},e.createElement(de.Z,{className:"ThemeColor3 ThemeHoverColor2  NoUnderline",to:"/admin/expansionservice/"+this.props.projectId+"/portalupgrade"},_l("\u7EED\u8D39")),e.createElement("span",{className:"Gray_9e mLeft5 mRight5"},_l("\u6216")))),c.length>0?e.createElement("div",{className:"manageListSearch flexRow"},e.createElement("span",{className:"Font17 Bold mRight32"},_l("\u5DF2\u9009\u62E9%0\u6761",c.length)),e.createElement(re.ZP,{type:"danger ghost",size:"medium",onClick:function(){return t.handleDelete(c)}},_l("\u5220\u9664"))):e.createElement("div",{className:"manageListSearch flexRow"},e.createElement(le.Z,{className:"w200",placeholder:_l("\u5E94\u7528"),data:y,value:x||void 0,border:!0,isAppendToBody:!0,openSearch:!0,cancelAble:!0,onChange:function(I){return t.updateState({appId:I})}}),ve.map(function(d){var I=(0,F.Z)(d.key,2),S=I[0],z=I[1],Z=t.state[S],w=t.state[z];return e.createElement("span",{className:"InlineBlock mLeft12"},e.createElement(ne.Z.RangePicker,{selectedValue:[Z?D()(Z):"",w?D()(w):""],onClear:function(){var p;return t.updateState((p={},(0,N.default)(p,S,""),(0,N.default)(p,z,""),p))},locale:{lang:{today:_l("\u4ECA\u5929"),clear:_l("\u53D6\u6D88"),ok:_l("\u786E\u8BA4"),tomorrow:_l("\u660E\u5929"),timepicker:_l("\u65F6\u95F4"),dateTimeFormat:"YYYY/MM/DD",dateFormat:"YYYY/MM/DD"}},onOk:function(p){var C=(0,F.Z)(p,2),_=C[0],ee=C[1];if(_&&ee){var B;t.updateState((B={},(0,N.default)(B,S,Q(_)),(0,N.default)(B,z,Q(ee)),B))}}},e.createElement("div",{className:"selectDateInput",ref:function(p){return t.dateInput=p},onMouseEnter:function(){Z&&w&&($("#dateArrowIcon_"+d.id).hide(),$("#dateDeleteIcon_"+d.id).show())},onMouseLeave:function(){$("#dateArrowIcon_"+d.id).show(),$("#dateDeleteIcon_"+d.id).hide()}},e.createElement("span",{className:"flex overflow_ellipsis"},Z&&w?_l("%0 \u81F3 %1",Z,w):e.createElement("span",{className:"Gray_9e"},d.text)),e.createElement("span",{className:"icon-arrow-down-border icon Gray_9e",id:"dateArrowIcon_"+d.id}),e.createElement("span",{className:"icon-delete_out icon Gray_9e Hidden",id:"dateDeleteIcon_"+d.id,onClick:function(p){var C;p.stopPropagation(),t.updateState((C={},(0,N.default)(C,S,""),(0,N.default)(C,z,""),C))}}))))}),e.createElement("div",{className:"flex"}),e.createElement(ue.Z,{className:"w200",placeholder:_l("\u59D3\u540D / \u624B\u673A\u53F7 / \u90AE\u7BB1"),handleChange:function(I){return t.updateState({keywords:I.trim()})}})),e.createElement("div",{className:"flexRow manageList manageListHeader bold mTop16"},e.createElement("div",{className:"w40 mRight20"},e.createElement(V.Z,{size:"small",checked:q>0&&c.length===q,onClick:function(I){return t.setState({selectedColumnIds:I?[]:(o||[]).map(function(S){return S.accountId})})}})),e.createElement("div",{className:"flex mLeft10 minWidth150"},_l("\u59D3\u540D")),e.createElement("div",{className:"w150 flexRow"},_l("\u624B\u673A\u53F7")),e.createElement("div",{className:"w150 flexRow"},_l("\u90AE\u7BB1")),e.createElement("div",{className:"columnWidth flexRow"},_l("\u52A0\u5165\u5E94\u7528")),e.createElement("div",{className:"columnWidth flexRow"},e.createElement("div",{className:"pointer ThemeHoverColor3 pRight12",style:{zIndex:1},onClick:function(){return t.updateState({sortType:u===10?11:10})}},_l("\u6CE8\u518C\u65F6\u95F4")),e.createElement("div",{className:"flexColumn manageListOrder"},e.createElement(L.Z,{icon:"arrow-up",className:h()({ThemeColor3:u===10})}),e.createElement(L.Z,{icon:"arrow-down",className:h()({ThemeColor3:u===11})}))),e.createElement("div",{className:"columnWidth flexRow"},e.createElement("div",{className:"pointer ThemeHoverColor3 pRight12",style:{zIndex:1},onClick:function(){return t.updateState({sortType:u===20?21:20})}},_l("\u6700\u8FD1\u767B\u5F55\u65F6\u95F4")),e.createElement("div",{className:"flexColumn manageListOrder"},e.createElement(L.Z,{icon:"arrow-up",className:h()({ThemeColor3:u===20})}),e.createElement(L.Z,{icon:"arrow-down",className:h()({ThemeColor3:u===21})}))),e.createElement("div",{className:"w60 mRight20"},_l("\u64CD\u4F5C"))),e.createElement("div",{className:"flex flexColumn mTop16"},n?e.createElement(G.Z,{className:"mTop15"}):this.renderList()),e.createElement(b.Z,{total:U,pageIndex:r,pageSize:this.state.pageSize,onChange:this.changPage}))}}]),s}(e.Component),Ze=l(31277),Ee=l(31929),we=l(12438),Ie=l(89552),Re=l(80176),Ce=l(2307),Pe=l(67272),Ne=l(51024),O=l(3274),W=l(64712),ye=function(f){(0,Y.default)(s,f);function s(i){return(0,j.default)(this,s),(0,M.default)(this,(s.__proto__||P()(s)).call(this,i))}return(0,H.default)(s,[{key:"render",value:function(){var t=this.props,a=t.typeName,n=t.data,r=n===void 0?[]:n,o=t.url,c=t.urlDetail;return e.createElement("div",{className:"mationBox pBottom20"},e.createElement("h3",{className:"Font15 Normal Gray"},_l("%0\u5217\u8868",a)),e.createElement("ul",{style:{maxHeight:"300px",overflowY:"auto"}},e.createElement("li",{className:"headerLi GrayBG LineHeight35"},e.createElement("span",{className:"InlineBlock pLeft40 Width200"},a),e.createElement("span",{className:"InlineBlock "},_l("\u64CD\u4F5C"))),!!r.length&&r.map(function(m){return e.createElement("li",{className:"LineHeight35",key:m.sourceId},e.createElement("span",{className:"InlineBlock pLeft40 Width200 color_b overflow_ellipsis"},m.sourceName),e.createElement("span",{className:"InlineBlock Hand ThemeColor3"},e.createElement("a",{href:o+m.sourceId+c,target:"_blank"},_l("\u67E5\u770B%0",a))))})))}}]),s}(e.Component),xe=l(71411),X=l(67707),Te=Ne.default.Search,Se=function(f){(0,Y.default)(s,f);function s(i){(0,j.default)(this,s);var t=(0,M.default)(this,(s.__proto__||P()(s)).call(this,i));return t.changePage=function(a){t.setState({pageIndex:a,selectKeys:[]},function(){return t.getGroupsList()})},t.handleDelete=function(a){(0,X.Z)({title:_l("\u60A8\u786E\u5B9A\u8981\u5C06\u6210\u5458\u4ECE\u5404\u4E2A\u6A21\u5757\u79FB\u9664\u5417?"),description:_l("\u60A8\u9009\u62E9\u7684\u6210\u5458\u53EF\u80FD\u6709\u4EFB\u52A1\u8D1F\u8D23\u4EBA/\u7FA4\u7EC4\u7BA1\u7406\u5458\uFF0C\u79FB\u9664\u540E\u76F8\u5173\u8D1F\u8D23\u4EBA\u5C06\u66FF\u6362\u4E3A\u4F01\u4E1A\u5C0F\u79D8\u4E66\uFF08\u4F01\u4E1A\u5C0F\u79D8\u4E66\u4F5C\u4E3A\u6682\u65F6\u63A5\u7BA1\u76F8\u5173\u6A21\u5757\u7684\u8D1F\u8D23\u4EBA\uFF0C\u540E\u7EED\u6210\u5458\u53EF\u6839\u636E\u81EA\u5DF1\u7684\u9700\u6C42\u968F\u65F6\u8FDB\u884C\u66FF\u6362\uFF09"),onOk:function(){O.Z.exitAllRelation({projectId:W.Z.projectId,accountIds:a?[a]:t.state.selectKeys}).then(function(r){r.length>0?t.setState({pageIndex:1,selectKeys:[]},function(){t.getGroupsList()}):alert(_l("\u79FB\u9664\u6210\u5458\u5931\u8D25"),2)})}})},t.onSelectChange=function(a){t.setState({selectKeys:a})},t.state={count:0,list:[],pageIndex:1,pageSize:20,selectKeys:[],keywords:"",loading:!1},t.columns=[{title:_l("\u59D3\u540D"),dataIndex:"fullname",render:function(n,r){return e.createElement("div",{className:"nameBox"},e.createElement("img",{src:r.avatar,alt:"avatar"}),e.createElement("span",{className:"overflow_ellipsis"},n))},width:150},{title:_l("\u7EC4\u7EC7"),dataIndex:"companyName",render:function(n){return e.createElement("div",{className:"overflow_ellipsis"},n)},width:200},{title:_l("\u7FA4\u7EC4"),dataIndex:"groupCount",render:function(n,r){return e.createElement("div",{className:h()(n?"adminHoverGreenColor":"color_b"),onClick:t.handleView.bind(t,n,3,r.accountId)},n)}},{title:_l("\u4EFB\u52A1"),dataIndex:"taskCount",render:function(n,r){return e.createElement("div",{className:h()(n?"adminHoverGreenColor":"color_b"),onClick:t.handleView.bind(t,n,2,r.accountId)},n)}},{title:_l("\u9879\u76EE"),dataIndex:"folderCount",render:function(n,r){return e.createElement("div",{className:h()(n?"adminHoverGreenColor":"color_b"),onClick:t.handleView.bind(t,n,1,r.accountId)},n)}},{title:_l("\u5171\u4EAB\u6587\u4EF6"),dataIndex:"kcCount",render:function(n,r){return e.createElement("div",{className:h()(n?"adminHoverGreenColor":"color_b"),onClick:t.handleView.bind(t,n,4,r.accountId)},n)}},{title:_l("\u64CD\u4F5C"),dataIndex:"option",render:function(n,r){return e.createElement("div",{className:"adminHoverDeleteColor",onClick:function(){return t.handleDelete(r.accountId)}},_l("\u79FB\u9664"))}}],t}return(0,H.default)(s,[{key:"componentDidMount",value:function(){this.getGroupsList()}},{key:"getGroupsList",value:function(){var t=this;this.setState({loading:!0}),O.Z.getRelationStatistics({pageIndex:this.state.pageIndex,pageSize:this.state.pageSize,projectId:W.Z.projectId,keyWords:this.state.keywords}).then(function(a){t.setState({list:a.list,count:a.allCount,loading:!1})})}},{key:"handleView",value:function(t,a,n){Number(t)<=0||O.Z.getRelationDetailByAid({projectId:W.Z.projectId,type:a,pageSize:1e3,accountId:n}).then(function(r){var o=_l("\u9879\u76EE"),c="",m="";switch(a){case 1:o=_l("\u9879\u76EE"),c="/apps/task/folder_",m="#detail";break;case 2:o=_l("\u4EFB\u52A1"),c="/apps/task/task_";break;case 3:o=_l("\u7FA4\u7EC4"),c="/group/groupValidate?gID=";break;default:o=_l("\u5171\u4EAB\u6587\u4EF6\u5939"),c="/apps/kc/"}(0,X.Z)({description:e.createElement(ye,{data:r.list,typeName:o,url:c,urlDetail:m}),showFooter:!1})})}},{key:"handleInputChange",value:function(t){var a=this;this.setState({keywords:t,pageIndex:1},function(){a.getGroupsList()})}},{key:"render",value:function(){var t=this,a=this.state,n=a.selectKeys,r=a.count,o=a.pageSize,c=a.pageIndex,m=a.loading,k=a.list,g={selectKeys:n,onChange:this.onSelectChange},y={icon:"icon-myUpload",desc:_l("\u65E0\u5916\u534F\u4EBA\u5458")},x=function(){return e.createElement(xe.Z,{detail:y})};return e.createElement("div",{className:"outsourcingWrap flexColumn"},e.createElement("div",{className:"flexRow alignItemsCenter searchWrap"},e.createElement("div",{className:"groupItem"},n.length?e.createElement(e.Fragment,null,e.createElement("span",{className:"Font16 color_b Bold"},_l("\u5DF2\u9009\u62E9%0\u6761",n.length)),e.createElement("div",{className:"ThemeColor3 mLeft30 Hand pTop3",onClick:function(){return t.handleDelete()}},e.createElement("span",{className:"icon icon-sp_filter_none_white"}),e.createElement("span",null,_l("\u79FB\u9664")))):e.createElement("div",{className:"color_b Font13"},e.createElement("div",null,_l("Ta\u4EEC\u88AB\u9080\u8BF7\u52A0\u5165\u5404\u4E2A\u6A21\u5757\u4E0E\u672C\u7EC4\u7EC7\u534F\u4F5C")),e.createElement("div",null,_l("\u4F46\u4E0D\u662F\u672C\u7EC4\u7EC7\u6210\u5458\u79F0\u4E3A\u201C\u5916\u534F\u4EBA\u5458\u201D")))),e.createElement("div",{className:"groupItem"},e.createElement(Te,{allowClear:!0,placeholder:_l("\u641C\u7D22\u59D3\u540D/\u804C\u4F4D/\u7EC4\u7EC7"),onSearch:function(E){return t.handleInputChange(E)}}))),e.createElement("div",{className:"mdAntTable flex"},e.createElement(Ee.default,{renderEmpty:x},e.createElement(Ie.default,{indicator:e.createElement(G.Z,null),spinning:m},e.createElement(Ce.Z,{rowSelection:g,rowKey:function(E){return E.accountId},columns:this.columns,dataSource:k,pagination:!1,scroll:r==0?{}:{y:r>o?"calc(100vh - 300px)":"calc(100vh - 260px)"}}),r>o&&e.createElement(b.Z,{total:r,pageIndex:c,pageSize:o,onChange:this.changePage})))))}}]),s}(e.Component),Le=[{routeType:"portal",tabName:_l("\u5916\u90E8\u95E8\u6237")},{routeType:"outsourcing",tabName:_l("\u5916\u534F")}],De=function(f){(0,Y.default)(s,f);function s(i){(0,j.default)(this,s);var t=(0,M.default)(this,(s.__proto__||P()(s)).call(this,i));return t.state={currentTab:"portal"},t}return(0,H.default)(s,[{key:"render",value:function(){var t=this,a=this.state.currentTab,n=this.props.match.params.projectId;return e.createElement("div",{className:"orgManagementWrap"},e.createElement(ae.Z,{prefix:_l("\u5916\u90E8\u95E8\u6237")}),e.createElement("div",{className:"orgManagementHeader"},e.createElement("div",{className:"tabBox"},Le.map(function(r){return e.createElement("span",{key:r.routeType,className:h()("tabItem Hand",{active:a===r.routeType}),onClick:function(){return t.setState({currentTab:r.routeType})}},r.tabName)}))),e.createElement("div",{className:"orgManagementContent"},a==="portal"?e.createElement(ge,{projectId:n}):e.createElement(Se,null)))}}]),s}(e.Component)}}]);
